/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _azure_communication_calling__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1);
/* harmony import */ var _azure_communication_calling__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_azure_communication_calling__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _azure_communication_common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(2);
/* harmony import */ var _Cookies_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(154);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getCookie", function() { return _Cookies_js__WEBPACK_IMPORTED_MODULE_2__["getCookie"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "setCookie", function() { return _Cookies_js__WEBPACK_IMPORTED_MODULE_2__["setCookie"]; });

ï»¿



let callClient;
let deviceManager;
let callAgent;
let call;

let localVideoStream;
let localView;


let myCameraMuted = true;
let myMicrophoneMuted = true;

let lastCamera = 0;
let lastMicrophone = 0;
let lastSpeaker = 0;


const hangUpButton = document.getElementById("hang-up-button");
const vidButton = document.getElementById("video-button");
const videoElement = document.getElementById("video");
const refreshElement = document.getElementById("refresh-participants");

const cameraDropdown = document.getElementById("camera-list");
const microphoneDropdown = document.getElementById("mic-list");
const speakerDropdown = document.getElementById("speaker-list");

const localVideoSwitch = document.getElementById("local-video-switch");
const localMicrophoneSwitch = document.getElementById("local-microphone-switch");


const groupId = '9fef326a-b48c-43e3-8ceb-a19025bc2624';

document.addEventListener('DOMContentLoaded', startup);

async function startup() {

    $('#modal-login').on('shown.bs.modal', function () {
        $('#user-name').trigger('focus')
    })

    let name = Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["getCookie"])("name");
    if (name === null) {
        $('#modal-login').modal('show');
    } else {
        $("#login-name").val(name);
        $("#call-panel").removeClass("hidden");
    }


    LoadSettings();
    //will assume all are new users for brevity
    //Get the ACS Auth Token
    let postObject = new Object();
    postObject.UserId = "";
    postObject.UserEmail = "foo@bar.com";
    
    const response = await fetch("/api/ACS/AuthGet", {
        method: "POST",
        body: JSON.stringify(postObject),
        headers: { "Content-Type": "application/json; charset=utf-8" }
    });
    const result = response.json();

    result.then(async (tokenResponse) => {

        var token = tokenResponse.Token;

        callClient = new _azure_communication_calling__WEBPACK_IMPORTED_MODULE_0__["CallClient"]();

        let tokenCredential = new _azure_communication_common__WEBPACK_IMPORTED_MODULE_1__["AzureCommunicationUserCredential"](token);

        callAgent = await callClient.createCallAgent(tokenCredential, { displayName: Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["getCookie"])("name") });

        vidButton.disabled = false;

        deviceManager = await callClient.getDeviceManager();

        LoadDeviceDropdowns(deviceManager);

        //browser consent
        await deviceManager.askDevicePermission(true, true);

        document.getElementById('local-panel').style.display = 'block';
        document.getElementById('partipant-list').style.display = 'block';
        document.getElementById('media-selectors').style.display = 'block';;

    }).catch(error => {

        alert("Error creating meeting : " + error.responseText);
    });

}

const JoinVideo = async () => {
    //setup the video device to be used
    if (localVideoStream === undefined) {
        //localVideoStream = new LocalVideoStream(GetActiveCamera());
        //myCameraMuted = true;
        await ToggleVideo();
    }
    const placeCallOptions = { videoOptions: { localVideoStreams: [localVideoStream] }, audioOptions: { muted: myMicrophoneMuted } };
    const context = { groupId: groupId };

    call = callAgent.join(context, placeCallOptions);
    document.getElementById('status-box').style.display = 'block'
    document.getElementById('participant-panel').style.display = 'block';
    ShowCallState();

    hangUpButton.disabled = false;
    document.getElementById('hang-up-button').style.display = 'block';
    vidButton.disabled = true;

    //call on state changed
    call.on('callStateChanged', (e) => {
        ShowCallState();
        if (call.state === 'Connected') {
            processNewParticipants(call.remoteParticipants);
        }
    });

    //remote participants check
    call.on("remoteParticipantsUpdated", (e) => {
        processNewParticipants(e.added);
        if (e.removed.length > 0) {
            console.log("hung up " + e.removed[0].displayName);
            //look for the remote
            e.removed.forEach((remoteParticipant) => {
                let removodedId = "remote-" + GetId(remoteParticipant.identifier.communicationUserId);
                console.log('Removing Id:  ' + removodedId);
                // $("#remote-displays").find($("#" + removodedId)).remove();
                document.querySelector("#remote-displays #" + removodedId).remove();
            });
        }


        document.getElementById("call-participants").innerText = call.remoteParticipants.length
    });

    //show local stream  
    await DisplayLocalVideo();
};

const processNewVideoSteams = (participant, newStreams) => {
    console.log(newStreams);
    if (!newStreams || newStreams.length === 0) {
        return;
    }
    for (let addedStream of newStreams) {
        if (addedStream.type !== 'Video') {
            return;
        }
        if (addedStream.isAvailable) {
            CreateRemoteParticipantElement(participant);
            DisplayRemoteVideo(participant, addedStream);
            return;
        }
    }
};

const processNewParticipants = (remoteParticipants) => {
    if (remoteParticipants.length === 0) return;
    for (let addedParticipant of remoteParticipants) {
        processNewVideoSteams(addedParticipant, addedParticipant.videoStreams);
        addedParticipant.on('videoStreamsUpdated', (rpvEvent) => {
            processNewVideoSteams(addedParticipant, rpvEvent.added);
        });
        addedParticipant.on("displayNameChanged", () => {
            console.log('have streamid for participant: ' + addedParticipant.videoStreams[0].id);
            ShowParticipantList();
        });

    }
    ShowParticipantList();
};

const LoadDeviceDropdowns = (deviceMgr) => {
    //get all the camera devices
    let cameraList = deviceMgr.getCameraList();
    //add the cameras to the dropdown list
    let cameraSelector = document.getElementById('camera-list');
    let i = 0;
    cameraList.forEach(camera => {
        let option = document.createElement('option');
        option.value = camera.id;
        option.innerHTML = camera.name;
        if (i === lastCamera) {
            option.selected = true;
        }
        cameraSelector.appendChild(option);
        i++;
    });

    //cameraSelector.options[cameraSelector.options.length - 1]

    document.getElementById('cameras').style.display = 'block';

    //get all the mics
    let micList = deviceMgr.getMicrophoneList();
    //add the mics to the dropdown list
    let micSelector = document.getElementById('mic-list');
    i = 0;
    micList.forEach(mic => {
        let option = document.createElement('option');
        option.value = mic.id;
        option.innerHTML = mic.name;
        if (i === lastMicrophone) {
            option.selected = true;
        }
        micSelector.appendChild(option);
        i++;
    });
    // micSelector.options[micSelector.options.length - 1]
    document.getElementById('mics').style.display = 'block';

    //get all the speakers
    let speakerList = deviceMgr.getSpeakerList();
    //add the mics to the dropdown list
    let speakerSelector = document.getElementById("speaker-list");
    i = 0;
    console.log("last speaker: " + lastSpeaker);
    speakerList.forEach((speaker) => {

        let option = document.createElement('option');

        option.value = speaker.id;
        option.innerHTML = speaker.name;
        if (i === lastSpeaker) {
            option.selected = true;
        }
        speakerSelector.appendChild(option);
        i++;
    });

    // speakerSelector.options[speakerSelector.options.length - 1]
    document.getElementById('speakers').style.display = 'block';


    SetupListeners();

};

const ShowParticipantList = () => {

    let partElement = document.getElementById('participants');
    //remove all the participants
    // partElement.find('option').remove();
    partElement.innerHTML = null;

    //add the local users
    let me = Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["getCookie"])("name");
    // var option = $("<option />");
    // option.html(me);
    let option = document.createElement('option');
    option.innerHTML = me;

    partElement.appendChild(option);

    //add remote users
    var participants = call.remoteParticipants;


    participants.forEach(part => {
        part.videoStreams.forEach((stream) => {
            if (stream.type === 'Video') {
                UpdateRemoteParticipantName(GetId(part.identifier.communicationUserId), part.displayName);
                console.log(part.identifier);
            }
        });

        let option = document.createElement('option');
        option.innerHTML = part.displayName;

        partElement.appendChild(option);

    });

};

async function DisplayRemoteVideo(User, stream) {
    let id = GetId(User.identifier.communicationUserId);
    let targetElement = User.identifier.communicationUserId;
    let renderer = new _azure_communication_calling__WEBPACK_IMPORTED_MODULE_0__["Renderer"](stream);
    var view = await renderer.createView();
    //FIX THIS as the doc manipution seems to break the video
    document.getElementById(id).appendChild(view.target);
}

const DisplayLocalVideo = async () => {
    if (localView === undefined) {
        if (localVideoStream === undefined) {
            localVideoStream = new _azure_communication_calling__WEBPACK_IMPORTED_MODULE_0__["LocalVideoStream"](GetActiveCamera());
        }
        const placeCallOptions = { videoOptions: { localVideoStreams: [localVideoStream] }, audioOptions: { muted: myMicrophoneMuted } };
        let renderer = new _azure_communication_calling__WEBPACK_IMPORTED_MODULE_0__["Renderer"](localVideoStream);
        localView = await renderer.createView();
        videoElement.appendChild(localView.target);
        document.getElementById("local-video-switch").setAttribute("data-value", "on");
        return localVideoStream;
    }
};

const GetActiveCamera = () => {
    let list = document.getElementById("camera-list");
    let cameraIndex = list.selectedIndex;
    const videoDeviceInfo = deviceManager.getCameraList()[cameraIndex];
    return videoDeviceInfo;
};

const LoadSettings = () => {
    //see if a different camera was set
    let cameraCheck = Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["getCookie"])("camera");
    if (cameraCheck !== null) {
        lastCamera = parseInt(cameraCheck);
    }
    //see if a different mic was set
    let microphoneCheck = Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["getCookie"])("microphone");
    if (microphoneCheck !== null) {
        lastMicrophone = parseInt(microphoneCheck);
    }
    //see if a different speaker was set
    let speakerCheck = Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["getCookie"])("speaker");
    if (speakerCheck !== null) {
        lastSpeaker = parseInt(speakerCheck);
    }

};

const SetupListeners = () => {

    //join video
    vidButton.addEventListener("click", async () => JoinVideo(), false);

    //refresh participants
    refreshElement.addEventListener("click", () => {
        console.log('remote participants');
        if (call !== undefined) {
            ShowParticipantList();
        } else {
            alert('there is no call');
        }
    });

    //change camera
    cameraDropdown.addEventListener("change", async () => {
        let cameraIndex = document.getElementById("camera-list").selectedIndex;
        Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["setCookie"])("camera", cameraIndex);
        const camDeviceInfo = deviceManager.getCameraList()[cameraIndex];
        if (localVideoStream !== undefined) {
            localVideoStream.switchSource(camDeviceInfo);
        }
    });

    //change microphone
    microphoneDropdown.addEventListener("change", async () => {
        let micIndex = document.getElementById("mic-list").selectedIndex;
        const micDeviceInfo = deviceManager.getMicrophoneList()[micIndex];
        Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["setCookie"])("microphone", micIndex);
        deviceManager.setMicrophone(micDeviceInfo);

    });

    //change speaker
    speakerDropdown.addEventListener("change", async () => {
        let speakerIndex = document.getElementById("speaker-list").selectedIndex;
        const speakerDeviceInfo = deviceManager.getMicrophoneList()[speakerIndex];
        Object(_Cookies_js__WEBPACK_IMPORTED_MODULE_2__["setCookie"])("speaker", speakerIndex);
        deviceManager.setMicrophone(speakerDeviceInfo);
    });

    //hangup the call
    hangUpButton.addEventListener("click", async () => {

        // end the current call
        await call.stopVideo(localVideoStream);
        call.hangUp({ forEveryone: false });
        localView.dispose();

        //let remotePannel =  document.querySelector("remote-panel");
        let remotePannel = document.querySelector("#remote-displays .remote-panel")
        if (remotePannel === null) { }
        else {
            remotePannel.remove();
        }
        // $("#remote-displays").find($(".remote-panel")).remove();
        /// remotePannel.remove();

        // toggle button states
        hangUpButton.disabled = true;
        document.getElementById("hang-up-button").style.display = 'none';

        vidButton.disabled = false;
    });

    //toggle local video
    localVideoSwitch.addEventListener("click", async () => {

        await ToggleVideo();
    });

    //toggle mute
    localMicrophoneSwitch.addEventListener("click", () => {
        let status = document.getElementById("local-microphone-switch").getAttribute("data-value");
        let mic = document.getElementById("local-microphone-switch")

        if (status === "off") {

            mic.classList.remove("inactive-control");
            mic.classList.add("active-control");
            mic.setAttribute("data-value", "on");
            document.getElementById("my-mic-on").classList.remove("hidden");
            document.getElementById("my-mic-off").classList.add("hidden");
            myMicrophoneMuted = false;
            if (call !== undefined) {
                console.log("unmute call");
                call.unmute();
            }
        } else {

            mic.classList.remove("active-control");
            mic.classList.add("inactive-control");
            mic.setAttribute("data-value", "off");
            document.getElementById("my-mic-on").classList.add("hidden");
            document.getElementById("my-mic-off").classList.remove("hidden");

            myMicrophoneMuted = true;
            if (call !== undefined) {
                console.log("mute call");
                call.mute();
            }

        }

    });

};

const ToggleVideo = async () => {
    let videoSwitch = document.getElementById("local-video-switch")

    if (myCameraMuted) {

        videoSwitch.classList.remove("inactive-control");
        videoSwitch.classList.add("active-control");
        document.getElementById("my-cam-on").classList.remove("hidden");
        document.getElementById("my-cam-off").classList.add("hidden");

        if (localVideoStream === undefined) {
            await DisplayLocalVideo();
        }
        else {
            videoElement.appendChild(localView.target);
        }

        if (call !== undefined) {
            await call.startVideo(localVideoStream);
        }
        myCameraMuted = false;
    } else {

        videoSwitch.classList.remove("active-control");
        videoSwitch.classList.add("inactive-control");
        document.getElementById("my-cam-on").classList.add("hidden");
        document.getElementById("my-cam-off").classList.remove("hidden");

        if (call !== undefined) {
            await call.stopVideo(localVideoStream);
        }
        videoElement.removeChild(localView.target);
        myCameraMuted = true;
    }
};

const ShowCallState = (e) => {
    //  let icon = "<i class='fas fa-phone-alt'></i>";
    //might do something here later
    switch (e) {
        case 'None':
            break;
        case 'Incoming':
            break;
        case 'Connecting':
            break;
        case 'Ringing':
            break;
        case 'Connected':
            break;
        case 'Hold':
            break;
        case 'InLobby':
            break;
        case 'Disconnecting':
            break;
        case 'Disconnected':
            break;
        case 'EarlyMedia':
            break;
        default:
            break;
    }
    document.getElementById("call-state").innerText = call.state;
};

const CreateRemoteParticipantElement = (User) => {
    let id = GetId(User.identifier.communicationUserId);

    let remoteElement = document.getElementById("remote-" + id);
    if (remoteElement !== null) {
        return;
    }
    console.log(remoteElement);

    let userName = User.displayName;
    //    let newElement = '<div id="remote-' + id + '" class="col-5 formal-section video-card-holder remote-panel"><h5 class="drag-bar">Remote Participant Video</h5><div  class="video-card"><div id="' + id + '" class="video-panel"></div><div id="remote-video-bar" class="toolbar"><div id="remote-name-' + id + '" class="form-group form-inline">' + userName + '</div></div></div>';
    let newElement = '<h5 class="drag-bar">Remote Participant Video</h5><div  class="video-card"><div id="' + id + '" class="video-panel"></div><div id="remote-video-bar" class="toolbar"><div id="remote-name-' + id + '" class="form-group form-inline">' + userName + '</div></div>';

    let remoteDisplays = document.getElementById('remote-displays');
    var remoteEl = document.createElement("div");
    remoteEl.id = "remote-" + id;
    remoteEl.classList.add("col-5");
    remoteEl.classList.add("formal-section");
    remoteEl.classList.add("video-card-holder");
    remoteEl.classList.add("remote-panel");
    remoteEl.innerHTML = newElement;
    remoteDisplays.append(remoteEl);

    //remoteDisplays.innerHTML = remoteDisplays.innerHTML + newElement;

    //$("#remote-displays").append(newElement);

    // $("#remote-" + id).draggable({stack:"div"});
    return id;
};

const UpdateRemoteParticipantName = (userId, name) => {
    document.getElementById("remote-name-" + userId).innerHTML = name;
};

const GetId = (data) => {
    let array = data.split(':');
    let len = array.length;
    return array[len - 1];
};




/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the Microsoft Software License Terms for the Azure Communications Services, Azure CPaaS, AZURE COMMUNICATION SERVICES VOICE AND VIDEO CALLING CLIENT LIBRARY
// See EULA.txt for license information.
!function(e,t){ true?module.exports=t():undefined}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=139)}([function(e,t,n){"use strict";var i=n(45),r=n(90),o=Object.prototype.toString;function a(e){return"[object Array]"===o.call(e)}function s(e){return null!==e&&"object"==typeof e}function c(e){return"[object Function]"===o.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),a(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===o.call(e)},isBuffer:r,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function n(n,i){"object"==typeof t[i]&&"object"==typeof n?t[i]=e(t[i],n):t[i]=n}for(var i=0,r=arguments.length;i<r;i++)l(arguments[i],n);return t},extend:function(e,t,n){return l(t,function(t,r){e[r]=n&&"function"==typeof t?i(t,n):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unspecified=0]="Unspecified",e[e.String=1]="String",e[e.Int64=2]="Int64",e[e.Double=3]="Double",e[e.Boolean=4]="Boolean",e[e.Date=5]="Date"}(t.AWTPropertyType||(t.AWTPropertyType={})),function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(t.AWTPiiKind||(t.AWTPiiKind={})),function(e){e[e.NotSet=0]="NotSet",e[e.GenericContent=1]="GenericContent"}(t.AWTCustomerContentKind||(t.AWTCustomerContentKind={})),function(e){e[e.Low=1]="Low",e[e.Normal=2]="Normal",e[e.High=3]="High",e[e.Immediate_sync=5]="Immediate_sync"}(t.AWTEventPriority||(t.AWTEventPriority={})),function(e){e[e.NonRetryableStatus=1]="NonRetryableStatus",e[e.QueueFull=3]="QueueFull"}(t.AWTEventsDroppedReason||(t.AWTEventsDroppedReason={})),function(e){e[e.InvalidEvent=1]="InvalidEvent",e[e.SizeLimitExceeded=2]="SizeLimitExceeded",e[e.KillSwitch=3]="KillSwitch"}(t.AWTEventsRejectedReason||(t.AWTEventsRejectedReason={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e){return super(e||"UnknownError"),this._code=0,this._subcode=0,this.setCode=(e=>(this._code=e,this)),this.setMessage=(e=>(this.message=e,this)),this.setSubcode=(e=>(this._subcode=e,this)),e instanceof i?(this._code=e.code,this._subcode=e.subcode,this.message=e.message,void(this.stack=e.stack)):e instanceof Error?(this.message=e.message,this._code=400,void(this.stack=e.stack)):void(this._code=400)}get code(){return this._code}get subcode(){return this._subcode}}t.CommunicationErrorImpl=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Outgoing="Outgoing",e.Incoming="Incoming"}(t.CallDirection||(t.CallDirection={})),function(e){e.CreateCallAgent="CreateCallAgent",e.GetDeviceManager="GetDeviceManager"}(t.CallClientOpeartion||(t.CallClientOpeartion={})),function(e){e.Call="Call",e.Join="Join",e.HandlePushNotifications="HandlePushNotification",e.Dispose="Dispose"}(t.CallAgentOperation||(t.CallAgentOperation={})),function(e){e.Call="Call",e.StartCall="StartCall",e.CallGroup="CallGroup",e.JoinGroup="JoinGroup",e.Accept="Accept",e.Reject="Reject",e.Mute="Mute",e.Unmute="Unmute",e.SendDtmf="SendDtmf",e.HangUp="HangUp",e.StartVideo="StartVideo",e.StopVideo="StopVideo",e.AddParticipant="AddParticipant",e.RemoveParticipant="RemoveParticipant",e.Hold="Hold",e.Unhold="Unhold",e.StartScreenShare="StartScreenShare",e.StopScreenShare="StopScreenShare"}(t.CallOperation||(t.CallOperation={})),function(e){e.GetCameraList="GetCameraList",e.GetMicrophoneList="GetMicrophoneList",e.GetSpeakerList="GetSpeakerList",e.GetCamera="GetCamera",e.SetCamera="SetCamera",e.GetMicrophone="GetMicrophone",e.SetMicrophone="SetMicrophone",e.GetSpeaker="GetSpeaker",e.SetSpeaker="SetSpeaker",e.RenderPreviewVideo="RenderPreviewVideo",e.AskDevicePermission="AskDevicePermission",e.GetPermissionState="GetPermissionState"}(t.DeviceManagerOperation||(t.DeviceManagerOperation={})),function(e){e.Dispose="Dispose",e.UpdateScalingMode="UpdateScalingMode",e.Render="Render"}(t.RendererViewOperation||(t.RendererViewOperation={})),function(e){e.Dispose="Dispose",e.CreateView="CreateView"}(t.RendererOperation||(t.RendererOperation={})),function(e){e.SwitchSource="SwitchSource"}(t.LocalVideoStreamOperation||(t.LocalVideoStreamOperation={})),function(e){e.SwitchVideo="SwitchVideo"}(t.LocalVideoStreamOperation||(t.LocalVideoStreamOperation={})),function(e){e.SetScalingMode="SetScalingMode",e.Start="Start",e.Stop="Stop",e.SwitchDevice="SwitchDevice",e.Dispose="Dispose"}(t.PreviewRendererOperation||(t.PreviewRendererOperation={})),function(e){e.Render="Render"}(t.RemoteVideoStreamOperation||(t.RemoteVideoStreamOperation={})),function(e){e.Resume="Resume",e.Pause="Pause",e.SetScalingMode="SetScalingMode"}(t.RemoteVideoRendererOperation||(t.RemoteVideoRendererOperation={})),function(e){e.SourceUnavailableError="SourceUnavailableError",e.PermissionDeniedError="permissionDeniedError",e.UnknownFailureForVideoOperation="UnknownFailureForVideoOperation"}(t.VideoOperationFailureMessages||(t.VideoOperationFailureMessages={})),function(e){e.BrowserNotSupported="BrowserNotSupported",e.IncompatibleVersions="IncompatibleVersions"}(t.CallStackErrorMessages||(t.CallStackErrorMessages={}))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),o=n(48);t.syncOperation=function(e){return a(e||"",!1)},t.asyncOperation=function(e){return a(e||"",!0)};const a=(e,t)=>{return t?(t,n,o)=>{const a=o.value;return o.value=function(...t){return i(this,void 0,void 0,function*(){let n;s(this,e,"started");try{n=yield a.apply(this,t),s(this,e,"succeeded")}catch(t){const n=new r.CommunicationErrorImpl(t);throw c(this,e,t),n}return n})},o}:(t,n,i)=>{const o=i.value;return i.value=function(...t){let n;s(this,e,"started");try{n=o.apply(this,t),s(this,e,"succeeded")}catch(t){const n=new r.CommunicationErrorImpl(t);throw c(this,e,t),n}return n},i}};function s(e,t,...n){const i=l(e);i&&i.log(`[${t}][${n.join("")}]`)}function c(e,t,n){const i=l(e);i&&(n&&n.code?i.log(`[${t}][failed][error code=${n.code}${n.subcode?`subcode=${n.subcode}`:""}]`):i.log(`[${t}][failed][${n}]`))}function l(e){try{const t=Reflect.getMetadata(o.loggerKeySymbol,e);if(t)return e[t]}catch(e){console.warn("unable to get logger instance")}}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});function i(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function o(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),r=n(1),o=/[xy]/g,a=621355968e5,s=1e4,c=null;t.EventNameAndTypeRegex=/^[a-zA-Z]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,t.EventNameDotRegex=/\./g,t.PropertyNameRegex=/^[a-zA-Z](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,t.StatsApiKey="a387cfcf60114a43a7699f9fbb49289e-9bceb9fe-1c06-460f-96c5-6a0b247358bc-7238";var l=c,u=c,d=c;function p(e){return"string"==typeof e}function f(e){return"number"==typeof e}function h(e){return"boolean"==typeof e}function g(e){return e instanceof Date}function m(e){return(e+a)*s}function v(){return!("undefined"==typeof navigator||!navigator.product)&&"ReactNative"===navigator.product}function y(e){return e<10?"0"+e:e.toString()}function S(e){return void 0===e||e===c||""===e}t.numberToBondInt64=function(e){var t=new i.Int64("0");return t.low=4294967295&e,t.high=Math.floor(e/4294967296),t},t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(o,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},t.isString=p,t.isNumber=f,t.isBoolean=h,t.isDate=g,t.msToTicks=m,t.getTenantId=function(e){var t=e.indexOf("-");return t>-1?e.substring(0,t):""},t.isBeaconsSupported=function(){return l===c&&(l="undefined"!=typeof navigator&&Boolean(navigator.sendBeacon)),l},t.isUint8ArrayAvailable=function(){return u===c&&(u="undefined"!=typeof Uint8Array&&!function(){if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.toLowerCase();if((e.indexOf("safari")>=0||e.indexOf("firefox")>=0)&&e.indexOf("chrome")<0)return!0}return!1}()&&!v()),u},t.isPriority=function(e){return!(!f(e)||!(e>=1&&e<=3||5===e))},t.sanitizeProperty=function(e,n){return!t.PropertyNameRegex.test(e)||S(n)?c:(S(n.value)&&(n={value:n,type:r.AWTPropertyType.Unspecified}),n.type=function(e,t){switch(t=function(e){return!!(f(e)&&e>=0&&e<=4)}(t)?t:r.AWTPropertyType.Unspecified){case r.AWTPropertyType.Unspecified:return function(e){switch(typeof e){case"string":return r.AWTPropertyType.String;case"boolean":return r.AWTPropertyType.Boolean;case"number":return r.AWTPropertyType.Double;case"object":return g(e)?r.AWTPropertyType.Date:c}return c}(e);case r.AWTPropertyType.String:return p(e)?t:c;case r.AWTPropertyType.Boolean:return h(e)?t:c;case r.AWTPropertyType.Date:return g(e)&&NaN!==e.getTime()?t:c;case r.AWTPropertyType.Int64:return f(e)&&e%1==0?t:c;case r.AWTPropertyType.Double:return f(e)?t:c}return c}(n.value,n.type),n.type?(g(n.value)&&(n.value=m(n.value.getTime())),n.pii>0&&n.cc>0?c:n.pii?function(e){return!!(f(e)&&e>=0&&e<=13)}(n.pii)?n:c:n.cc?function(e){return!!(f(e)&&e>=0&&e<=1)}(n.cc)?n:c:n):c)},t.getISOString=function(e){return e.getUTCFullYear()+"-"+y(e.getUTCMonth()+1)+"-"+y(e.getUTCDate())+"T"+y(e.getUTCHours())+":"+y(e.getUTCMinutes())+":"+y(e.getUTCSeconds())+"."+function(e){return e<10?"00"+e:e<100?"0"+e:e.toString()}(e.getUTCMilliseconds())+"Z"},t.useXDomainRequest=function(){if(d===c){var e=new XMLHttpRequest;d=void 0===e.withCredentials&&"undefined"!=typeof XDomainRequest}return d},t.isReactNative=v},function(e,t,n){"use strict";(function(e){function n(e){return null!=e&&"function"==typeof e.then}function i(e){return null!=e&&"function"==typeof e.cancel}function r(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var o,a=[],s=void 0!==e;function c(t){a.push(t),1===a.length&&(s?e(l):setTimeout(l,0))}function l(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function d(e){return(new o.SyncTask).resolve(e).promise()}function p(e){var t=u(),r=!1;return t.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){n(e)?e.then(function(e){r||(r=!0,t.resolve(e))},function(e){r||(r=!0,t.reject(e))}):r||(r=!0,t.resolve(e))}),t.promise()}t.asyncCallback=c,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var i=this,r=new e;return r.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,i._cancelInternal(e)}),t.task=r,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:r._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),r.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?r(function(){var r=t.successFunc(o._storedResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?r(function(){var r=t.failFunc(o._storedErrResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return d([]);var t,r=u(),a=e.length,s=Array(e.length);r.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})});var c=function(){0==--a&&(void 0!==t?r.reject(t):r.resolve(s))};return e.forEach(function(e,i){n(e)?e.then(function(e){s[i]=e,c()},function(e){void 0===t&&(t=void 0===e||e),c()}):(s[i]=e,c())}),r.promise()},t.Defer=u,t.Resolved=d,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=p,t.raceTimer=function(e,t){var n=u(),i=setTimeout(function(){n.resolve({timedOut:!0})},t);return p([e.then(function(e){return clearTimeout(i),{timedOut:!1,result:e}}),n.promise()])}}).call(this,n(129).setImmediate)},function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise(function(n,i){function r(){void 0!==o&&e.removeListener("error",o),n([].slice.call(arguments))}var o;"error"!==t&&(o=function(n){e.removeListener(t,r),i(n)},e.once("error",o)),e.once(t,r)})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,i){var r,o,a;if(l(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(r=u(e))>0&&a.length>r&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,function(e){console&&console.warn&&console.warn(e)}(s)}return e}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(i);return r.listener=n,i.wrapFn=r,r}function f(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):g(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var l=c.length,u=g(c,l);for(n=0;n<l;++n)o(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return l(t),this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,i,r,o,a;if(l(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r});n(140),n(141);var i=void 0!==e&&!!e.version&&!!e.versions&&!!e.versions.node;function r(e,t,n){return e&&t?e.split(t).join(n||""):e}}).call(this,n(11))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.addNotificationListener=function(e){this.listeners.push(e)},e.removeNotificationListener=function(e){for(var t=this.listeners.indexOf(e);t>-1;)this.listeners.splice(t,1),t=this.listeners.indexOf(e)},e.eventsSent=function(e){for(var t=this,n=function(n){i.listeners[n].eventsSent&&setTimeout(function(){return t.listeners[n].eventsSent(e)},0)},i=this,r=0;r<this.listeners.length;++r)n(r)},e.eventsDropped=function(e,t){for(var n=this,i=function(i){r.listeners[i].eventsDropped&&setTimeout(function(){return n.listeners[i].eventsDropped(e,t)},0)},r=this,o=0;o<this.listeners.length;++o)i(o)},e.eventsRetrying=function(e){for(var t=this,n=function(n){i.listeners[n].eventsRetrying&&setTimeout(function(){return t.listeners[n].eventsRetrying(e)},0)},i=this,r=0;r<this.listeners.length;++r)n(r)},e.eventsRejected=function(e,t){for(var n=this,i=function(i){r.listeners[i].eventsRejected&&setTimeout(function(){return n.listeners[i].eventsRejected(e,t)},0)},r=this,o=0;o<this.listeners.length;++o)i(o)},e.listeners=[],e}();t.default=i},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],u=!1,d=-1;function p(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&f())}function f(){if(!u){var e=s(p);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new h(e,t)),1!==l.length||u||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";(function(e){var i,r=n(5),o=n(142),a=void 0!==e&&e.env&&e.env.DEBUG||void 0,s=[],c=[],l=[];function u(e){var t,n,o,a;i=e,s=[],c=[];var u=/\*/g,p=e.split(",").map(function(e){return e.trim().replace(u,".*?")});try{for(var f=Object(r.b)(p),h=f.next();!h.done;h=f.next()){var g=h.value;g.startsWith("-")?c.push(new RegExp("^"+g.substr(1)+"$")):s.push(new RegExp("^"+g+"$"))}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}try{for(var m=Object(r.b)(l),v=m.next();!v.done;v=m.next()){var y=v.value;y.enabled=d(y.namespace)}}catch(e){o={error:e}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}}function d(e){var t,n,i,o;if(e.endsWith("*"))return!0;try{for(var a=Object(r.b)(c),l=a.next();!l.done;l=a.next()){if(l.value.test(e))return!1}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}try{for(var u=Object(r.b)(s),d=u.next();!d.done;d=u.next()){if(d.value.test(e))return!0}}catch(e){i={error:e}}finally{try{d&&!d.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return!1}function p(e){var t=Object.assign(function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];t.enabled&&(n.length>0&&(n[0]=e+" "+n[0]),t.log.apply(t,Object(r.a)(n)))},{enabled:d(e),destroy:f,log:g.log,namespace:e,extend:h});return l.push(t),t}function f(){var e=l.indexOf(this);return e>=0&&(l.splice(e,1),!0)}function h(e){var t=p(this.namespace+":"+e);return t.log=this.log,t}a&&u(a);var g=Object.assign(function(e){return p(e)},{enable:u,enabled:d,disable:function(){var e=i||"";return u(""),e},log:o.a});t.a=g}).call(this,n(11))},function(e,t,n){"use strict";n.r(t);function i(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})}Object.create;Object.create;var r=n(58),o=n.n(r);const a=e=>{const{exp:t}=o()(e);return{token:e,expiresOnTimestamp:1e3*t}};class s{constructor(e){this.token=e}getToken(){return i(this,void 0,void 0,function*(){return this.token})}dispose(){}}const c={token:"",expiresOnTimestamp:-10},l=(e=>1e3*e*60)(10);class u{constructor(e){this.refreshingIntervalInMs=l,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.disposed=!1;const{tokenRefresher:t,initialToken:n,refreshProactively:i}=e;this.refresh=t,this.currentToken=n?a(n):c,this.refreshProactively=null!=i&&i,this.refreshProactively&&this.scheduleRefresh()}getToken(e){return i(this,void 0,void 0,function*(){if(!this.isCurrentTokenExpiringSoon)return this.currentToken;const t=this.updateTokenAndReschedule(e);return this.isCurrentTokenValid||(yield t),this.currentToken})}dispose(){this.disposed=!0,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.currentToken=c,this.activeTimeout&&clearTimeout(this.activeTimeout)}updateTokenAndReschedule(e){return i(this,void 0,void 0,function*(){if(this.activeTokenUpdating)return this.activeTokenUpdating;this.activeTokenUpdating=this.refreshTokenAndReschedule(e);try{yield this.activeTokenUpdating}finally{this.activeTokenUpdating=null}})}refreshTokenAndReschedule(e){return i(this,void 0,void 0,function*(){this.currentToken=yield this.refreshToken(e),this.refreshProactively&&this.scheduleRefresh()})}refreshToken(e){return i(this,void 0,void 0,function*(){try{return this.activeTokenFetching||(this.activeTokenFetching=this.refresh(e)),a(yield this.activeTokenFetching)}finally{this.activeTokenFetching=null}})}scheduleRefresh(){if(this.disposed)return;this.activeTimeout&&clearTimeout(this.activeTimeout);const e=this.currentToken.expiresOnTimestamp-Date.now()-this.refreshingIntervalInMs;this.activeTimeout=setTimeout(()=>this.updateTokenAndReschedule(),e)}get isCurrentTokenValid(){return this.currentToken&&Date.now()<this.currentToken.expiresOnTimestamp}get isCurrentTokenExpiringSoon(){return!this.currentToken||Date.now()>=this.currentToken.expiresOnTimestamp-this.refreshingIntervalInMs}}class d{constructor(e){this.disposed=!1,this.userCredential="string"==typeof e?new s(a(e)):new u(e)}getToken(e){return i(this,void 0,void 0,function*(){this.throwIfDisposed();const t=yield this.userCredential.getToken(e);return this.throwIfDisposed(),t})}dispose(){this.disposed=!0,this.userCredential.dispose()}throwIfDisposed(){if(this.disposed)throw new Error("User credential is disposed")}}var p;!function(e){e[e.OFF=0]="OFF",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO"}(p||(p={}));var f=function(){function e(e,t){this._nextPolicy=e,this._options=t}return e.prototype.shouldLog=function(e){return this._options.shouldLog(e)},e.prototype.log=function(e,t){this._options.log(e,t)},e}(),h=(function(){function e(e){this._logger=e}e.prototype.shouldLog=function(e){return!!this._logger&&e!==p.OFF&&e<=this._logger.minimumLogLevel},e.prototype.log=function(e,t){this._logger&&this.shouldLog(e)&&this._logger.log(e,t)}}(),n(9)),g=function(){function e(){this._rawQuery={}}return e.prototype.any=function(){return Object.keys(this._rawQuery).length>0},e.prototype.keys=function(){return Object.keys(this._rawQuery)},e.prototype.set=function(e,t){if(e)if(null!=t){var n=Array.isArray(t)?t:t.toString();this._rawQuery[e]=n}else delete this._rawQuery[e]},e.prototype.get=function(e){return e?this._rawQuery[e]:void 0},e.prototype.toString=function(){var e="";for(var t in this._rawQuery){e&&(e+="&");var n=this._rawQuery[t];if(Array.isArray(n)){for(var i=[],r=0,o=n;r<o.length;r++){var a=o[r];i.push(t+"="+a)}e+=i.join("&")}else e+=t+"="+n}return e},e.parse=function(t){var n=new e;if(t){t.startsWith("?")&&(t=t.substring(1));for(var i="ParameterName",r="",o="",a=0;a<t.length;++a){var s=t[a];switch(i){case"ParameterName":switch(s){case"=":i="ParameterValue";break;case"&":r="",o="";break;default:r+=s}break;case"ParameterValue":switch(s){case"&":n.set(r,o),r="",o="",i="ParameterName";break;default:o+=s}break;default:throw new Error("Unrecognized URLQuery parse state: "+i)}}"ParameterValue"===i&&n.set(r,o)}return n},e}(),m=function(){function e(){}return e.prototype.setScheme=function(e){e?this.set(e,"SCHEME"):this._scheme=void 0},e.prototype.getScheme=function(){return this._scheme},e.prototype.setHost=function(e){e?this.set(e,"SCHEME_OR_HOST"):this._host=void 0},e.prototype.getHost=function(){return this._host},e.prototype.setPort=function(e){null==e||""===e?this._port=void 0:this.set(e.toString(),"PORT")},e.prototype.getPort=function(){return this._port},e.prototype.setPath=function(e){if(e){var t=e.indexOf("://");if(-1!==t){var n=e.lastIndexOf("/",t);this.set(-1===n?e:e.substr(n+1),"SCHEME")}else this.set(e,"PATH")}else this._path=void 0},e.prototype.appendPath=function(e){if(e){var t=this.getPath();t&&(t.endsWith("/")||(t+="/"),e.startsWith("/")&&(e=e.substring(1)),e=t+e),this.set(e,"PATH")}},e.prototype.getPath=function(){return this._path},e.prototype.setQuery=function(e){this._query=e?g.parse(e):void 0},e.prototype.setQueryParameter=function(e,t){e&&(this._query||(this._query=new g),this._query.set(e,t))},e.prototype.getQueryParameterValue=function(e){return this._query?this._query.get(e):void 0},e.prototype.getQuery=function(){return this._query?this._query.toString():void 0},e.prototype.set=function(e,t){for(var n=new y(e,t);n.next();){var i=n.current(),r=void 0;if(i)switch(i.type){case"SCHEME":this._scheme=i.text||void 0;break;case"HOST":this._host=i.text||void 0;break;case"PORT":this._port=i.text||void 0;break;case"PATH":r=i.text||void 0,this._path&&"/"!==this._path&&"/"===r||(this._path=r);break;case"QUERY":this._query=g.parse(i.text);break;default:throw new Error("Unrecognized URLTokenType: "+i.type)}}},e.prototype.toString=function(){var e="";return this._scheme&&(e+=this._scheme+"://"),this._host&&(e+=this._host),this._port&&(e+=":"+this._port),this._path&&(this._path.startsWith("/")||(e+="/"),e+=this._path),this._query&&this._query.any()&&(e+="?"+this._query.toString()),e},e.prototype.replaceAll=function(e,t){e&&(this.setScheme(Object(h.b)(this.getScheme(),e,t)),this.setHost(Object(h.b)(this.getHost(),e,t)),this.setPort(Object(h.b)(this.getPort(),e,t)),this.setPath(Object(h.b)(this.getPath(),e,t)),this.setQuery(Object(h.b)(this.getQuery(),e,t)))},e.parse=function(t){var n=new e;return n.set(t,"SCHEME_OR_HOST"),n},e}(),v=function(){function e(e,t){this.text=e,this.type=t}return e.scheme=function(t){return new e(t,"SCHEME")},e.host=function(t){return new e(t,"HOST")},e.port=function(t){return new e(t,"PORT")},e.path=function(t){return new e(t,"PATH")},e.query=function(t){return new e(t,"QUERY")},e}();var y=function(){function e(e,t){this._text=e,this._textLength=e?e.length:0,this._currentState=null!=t?t:"SCHEME_OR_HOST",this._currentIndex=0}return e.prototype.current=function(){return this._currentToken},e.prototype.next=function(){if(S(this))switch(this._currentState){case"SCHEME":!function(e){var t=function(e){return C(e,function(e){return function(e){var t=e.charCodeAt(0);return 48<=t&&t<=57||65<=t&&t<=90||97<=t&&t<=122}(e)})}(e);e._currentToken=v.scheme(t),S(e)?e._currentState="HOST":e._currentState="DONE"}(this);break;case"SCHEME_OR_HOST":!function(e){var t=I(e,":","/","?");S(e)?":"===_(e)?"://"===T(e,3)?(e._currentToken=v.scheme(t),e._currentState="HOST"):(e._currentToken=v.host(t),e._currentState="PORT"):(e._currentToken=v.host(t),"/"===_(e)?e._currentState="PATH":e._currentState="QUERY"):(e._currentToken=v.host(t),e._currentState="DONE")}(this);break;case"HOST":!function(e){"://"===T(e,3)&&E(e,3);var t=I(e,":","/","?");e._currentToken=v.host(t),S(e)?":"===_(e)?e._currentState="PORT":"/"===_(e)?e._currentState="PATH":e._currentState="QUERY":e._currentState="DONE"}(this);break;case"PORT":!function(e){":"===_(e)&&E(e);var t=I(e,"/","?");e._currentToken=v.port(t),S(e)?"/"===_(e)?e._currentState="PATH":e._currentState="QUERY":e._currentState="DONE"}(this);break;case"PATH":!function(e){var t=I(e,"?");e._currentToken=v.path(t),S(e)?e._currentState="QUERY":e._currentState="DONE"}(this);break;case"QUERY":!function(e){"?"===_(e)&&E(e);var t=function(e){var t="";e._currentIndex<e._textLength&&(t=e._text.substring(e._currentIndex),e._currentIndex=e._textLength);return t}(e);e._currentToken=v.query(t),e._currentState="DONE"}(this);break;default:throw new Error("Unrecognized URLTokenizerState: "+this._currentState)}else this._currentToken=void 0;return!!this._currentToken},e}();function S(e){return e._currentIndex<e._textLength}function _(e){return e._text[e._currentIndex]}function E(e,t){S(e)&&(t||(t=1),e._currentIndex+=t)}function T(e,t){var n=e._currentIndex+t;return e._textLength<n&&(n=e._textLength),e._text.substring(e._currentIndex,n)}function C(e,t){for(var n="";S(e);){var i=_(e);if(!t(i))break;n+=i,E(e)}return n}function I(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return C(e,function(e){return-1===t.indexOf(e)})}const A=e=>(new TextEncoder).encode(e);function b(e){if("function"!=typeof btoa)throw new Error("Your browser environment is missing the global `btoa` function");const t=new Uint8Array(e);let n="";for(const e of t)n+=String.fromCharCode(e);return btoa(n)}const R=globalThis,O=()=>{if(!R)throw new Error("Could not find global");if(!R.crypto||!R.crypto.subtle)throw new Error("Browser does not support cryptography functions");return R.crypto.subtle},P=e=>i(void 0,void 0,void 0,function*(){const t=A(e);return b(yield O().digest("SHA-256",t))}),N=(e,t)=>i(void 0,void 0,void 0,function*(){const n={name:"HMAC",hash:{name:"SHA-256"}},i=A(t),r=function(e){if("function"!=typeof atob)throw new Error("Your browser environment is missing the global `atob` function");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),o=O(),a=yield o.importKey("raw",r,n,!1,["sign"]);return b(yield o.sign(n,a,i))}),M=e=>({create:(t,n)=>new class extends f{constructor(e,t,n){super(t,n),this.accessKey=e}signRequest(e){return i(this,void 0,void 0,function*(){const t=e.method.toUpperCase(),n=(new Date).toUTCString(),i=yield P(e.body||""),r=h.a?"date":"x-ms-date",o=`${r};host;x-ms-content-sha256`,a=m.parse(e.url),s=a.getQuery(),c=s?`${a.getPath()}?${s}`:a.getPath(),l=a.getPort(),u=l?`${a.getHost()}:${l}`:a.getHost(),d=`${t}\n${c}\n${n};${u};${i}`,p=yield N(this.accessKey.key,d);return h.a&&e.headers.set("Host",u||""),e.headers.set(r,n),e.headers.set("x-ms-content-sha256",i),e.headers.set("Authorization",`HMAC-SHA256 SignedHeaders=${o}&Signature=${p}`),e})}sendRequest(e){return i(this,void 0,void 0,function*(){if(!e)throw new Error("webResource cannot be null or undefined");return this._nextPolicy.sendRequest(yield this.signRequest(e))})}}(e,t,n)});var w=function(){function e(e){if(!e)throw new Error("key must be a non-empty string");this._key=e}return Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),e.prototype.update=function(e){this._key=e},e}();const D=/endpoint=(.*);accesskey=(.*)/i,L=e=>{const t=(e=>{const t=e.match(D);if((null==t?void 0:t[1])&&t[2])return{endpoint:t[1],credential:new w(t[2])}})(e);if(t)return t;throw new Error(`Invalid connection string ${e}`)},k=e=>{if(!(e=>{var t;const n=m.parse(e);return!!(null===(t=n.getScheme())||void 0===t?void 0:t.match(/^http[s]?/))&&void 0!==n.getHost()&&""!==n.getHost()&&(void 0===n.getPath()||""===n.getPath()||"/"===n.getPath())})(e))throw new Error(`Invalid endpoint url ${e}`)},x=e=>e&&"string"==typeof e.key&&void 0===e.getToken,F=(e,t)=>{if(x(t))return k(e),{url:e,credential:t};{const{endpoint:t,credential:n}=L(e);return k(t),{url:t,credential:n}}},U=e=>"string"==typeof e.communicationUserId,j=e=>"string"==typeof e.phoneNumber,H=e=>"string"==typeof e.callingApplicationId,B=e=>"string"==typeof e.id,G=e=>U(e)?Object.assign(Object.assign({},e),{kind:"CommunicationUser"}):j(e)?Object.assign(Object.assign({},e),{kind:"PhoneNumber"}):H(e)?Object.assign(Object.assign({},e),{kind:"CallingApplication"}):Object.assign(Object.assign({},e),{kind:"Unknown"});n.d(t,"AzureCommunicationUserCredential",function(){return d}),n.d(t,"createCommunicationAccessKeyCredentialPolicy",function(){return M}),n.d(t,"isKeyCredential",function(){return x}),n.d(t,"parseClientArguments",function(){return F}),n.d(t,"isCommunicationUser",function(){return U}),n.d(t,"isPhoneNumber",function(){return j}),n.d(t,"isCallingApplication",function(){return H}),n.d(t,"isUnknownIdentifier",function(){return B}),n.d(t,"getIdentifierKind",function(){return G})},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(47)),a=n(40),s=n(17),c=n(26),l=n(2),u=n(16),d=n(32),p=n(39),f=n(3),h=n(18),g=n(71),m=n(70);class v{constructor(e){if(this._logger=e,this._telemetryService=m.TelemetryService.instance,"https:"!==location.protocol&&"localhost"!==location.hostname)throw new l.CommunicationErrorImpl("Http not allowed. Please use Https");const t=p.getBrowserInfo();if("chrome"!==t.name&&"chromium"!==t.name&&"edgeanaheim"!==t.name&&"safari"!==t.name)throw(new l.CommunicationErrorImpl).setMessage(f.CallStackErrorMessages.BrowserNotSupported).setCode(405)}getStack(e){return i(this,void 0,void 0,function*(){if(this._getStackPromise)return this._getStackPromise;if(v._stackInitialized)throw new l.CommunicationErrorImpl("Multiple call clients are not supported, dispose previous stack first").setCode(500);this._trouterService=new g.Trouter,this._callAgent=e,v._stackInitialized=!0;let t=h.defer();const n=setTimeout(()=>{this._getStackPromise=void 0,this.sendStackInitializedEvent(!1,"timeout"),this.dispose(),t.reject((new l.CommunicationErrorImpl).setCode(500).setMessage("Calling stack initialization timeout"))},3e4),r=this._initTrouter().then(()=>i(this,void 0,void 0,function*(){this._logger.log("Trouter initialized");const e=this._getConfig();return v._tsStack=yield o.pluginlessStackFactory.build(e),yield v._tsStack.init(),this.sendStackInitializedEvent(!0),clearTimeout(n),t=void 0,v._tsStack})).catch(()=>{throw this.sendStackInitializedEvent(!1,"failed"),(new l.CommunicationErrorImpl).setCode(500).setMessage("Failed to initialize calling client")});return this._getStackPromise=Promise.race([r,t.promise]),this._getStackPromise})}static getInitializedTsStack(){return v._tsStack}dispose(){return i(this,void 0,void 0,function*(){if(!this._getStackPromise)return;this._logger.info("Dispose calling stack"),this._trouterService&&(this._trouterService.clearMessageHandlers(),this._trouterService.stop(),this._trouterService=void 0),yield(yield this._getStackPromise).dispose().catch(e=>{this._logger.warn("Failed to dispose calling stack",e)}),v._tsStack=void 0,this._getStackPromise=void 0,this._logger.info("Calling stack disposed"),v._stackInitialized=!1})}_getConfig(){const e=this._getMediaAgentFactoryConfig();return this._logger.log("Before stack is built try to get versions:"),this._logger.log(`getOvb=${o.getOvb()}`),this._logger.log(`getTsCallingVersion=${o.getVersion()}`),this._logger.log("initialize stack"),{signalingAgentConfig:this._getSignalingConfig(),mediaAgentFactoryConfig:e,imageRendererConfig:this._getImageRendererConfig(),trouterService:this._trouterService,logger:this._logger,telemetryService:this._telemetryService,platformType:p.getPlatformName(),callSettings:{useLwjForAllCalls:!1},usePlatformSupportApi:!0,telemetryTenants:{media:"mediaAgent",signaling:"signalingAgent"}}}_getSignalingConfig(){return{conversationServiceUrl:c.EcsProvider.instance.getJsCsaConfig().conversationServiceUrl,languageCode:c.EcsProvider.instance.getJsCsaConfig().languageCode,clientInformation:c.EcsProvider.instance.getJsCsaConfig().clientInformation,emergencyCallCountry:c.EcsProvider.instance.getJsCsaConfig().emergencyCallCountry,useInternalHttpDispatcher:c.EcsProvider.instance.getJsCsaConfig().useInternalHttpDispatcher,supportsHostlessGroupCalls:c.EcsProvider.instance.getJsCsaConfig().supportsHostlessGroupCalls,doHostlessCalling:c.EcsProvider.instance.getJsCsaConfig().doHostlessCalling,shouldServiceSendCallEventMessages:c.EcsProvider.instance.getJsCsaConfig().shouldServiceSendCallEventMessages,shouldServiceSendNGCUpgradeMessages:c.EcsProvider.instance.getJsCsaConfig().shouldServiceSendNGCUpgradeMessages,supportsCompressedServicePayload:c.EcsProvider.instance.getJsCsaConfig().supportsCompressedServicePayload,handleNewOfferRequest:c.EcsProvider.instance.getJsCsaConfig().handleNewOfferRequest,handleMediaOfferFromPushNotification:c.EcsProvider.instance.getJsCsaConfig().handleMediaOfferFromPushNotification,isWebRtcEnabled:c.EcsProvider.instance.getJsCsaConfig().isWebRtcEnabled,supportsSynchronousTrouterResponse:c.EcsProvider.instance.getJsCsaConfig().supportsSynchronousTrouterResponse,autoJoinOnConflict:c.EcsProvider.instance.getJsCsaConfig().autoJoinOnConflict,brokerEnabledOutgoing:c.EcsProvider.instance.getJsCsaConfig().brokerEnabledOutgoing,brokerEnabledIncoming:c.EcsProvider.instance.getJsCsaConfig().brokerEnabledIncoming,brokerExclusively:c.EcsProvider.instance.getJsCsaConfig().brokerExclusively,brokerRequestBatching:c.EcsProvider.instance.getJsCsaConfig().brokerRequestBatching,isGVCOutgoingEnabled:c.EcsProvider.instance.getJsCsaConfig().isGVCOutgoingEnabled,isGVCJoiningEnabled:c.EcsProvider.instance.getJsCsaConfig().isGVCJoiningEnabled,enableTokenCache:c.EcsProvider.instance.getJsCsaConfig().enableTokenCache,httpRequestDispatcher:new o.HttpRequestDispatcherImplementation,telemetryManager:this._telemetryService.getCallingAdapter(),logger:this._logger,skypeToken:()=>this._callAgent.tokenProvider(),trouterServiceProvider:this._trouterService}}_getImageRendererConfig(){return{tokenProvider:()=>this._callAgent.tokenProvider(),callingLogger:this._logger,httpRequestDispatcher:new o.HttpRequestDispatcherImplementation}}_getMediaAgentFactoryConfig(){return{logger:this._logger,tokenProvider:()=>this._callAgent.tokenProvider(),configProvider:{getSkypeConfig:()=>Promise.resolve({}),getRelayConfig:()=>{const e=c.EcsProvider.instance.getMdnTrapSettings();return Promise.resolve(e)}},settings:this._getMediaAgentConfig(),appStateProvider:this._getAppStateProvider(),telemetryAdapter:this._telemetryService.getMediaAdapter()}}_getMediaAgentConfig(){return{debug:c.EcsProvider.instance.getJamaSettings().debug,maxVideoChannels:c.EcsProvider.instance.getJamaSettings().maxVideoChannels,numVideoChannelsGvc:c.EcsProvider.instance.getJamaSettings().numVideoChannelsGvc,requestTimeoutMs:c.EcsProvider.instance.getJamaSettings().requestTimeoutMs,ortcPreferBundling:c.EcsProvider.instance.getJamaSettings().ortcPreferBundling,webrtcOutgoingScreenSharingEnabled:c.EcsProvider.instance.getJamaSettings().webrtcOutgoingScreenSharingEnabled,webrtcGetDisplayMediaEnabled:c.EcsProvider.instance.getJamaSettings().webrtcGetDisplayMediaEnabled}}_getAppStateProvider(){return{isOnline:()=>!0}}_initTrouter(){return i(this,void 0,void 0,function*(){if(this._trouterService)return this._trouterService.init(this._logger,this._getTrouterSettings(),()=>this._callAgent.tokenProvider(),(new o.HttpRequestDispatcherImplementation).requestDispatcherImpl),new Promise(e=>{const t=n=>{n===a.TrouterState.Connected&&(this._trouterService&&this._trouterService.offStateChanged(t),e())};this._trouterService&&(this._trouterService.onStateChanged(t),this._trouterService.start(),this.sendTrouterInitializedEvent(!0))})})}_getTrouterSettings(){const e=s.REGISTRAR_URL;return{version:u.getSdkVersion(),productName:"SpoolWeb",trouterServiceUrl:s.TROUTER_URL,registrarServiceUrl:e,registrarRefreshTimeoutInMs:35e4,timeoutOptions:{connectionTimeoutMs:2e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:5e4,requestTimeoutMs:5e3},maxRegistrationTimeInMs:864e5,pnhAppId:"SpoolWeb",pnhTemplate:"SpoolWeb_1.0"}}sendStackInitializedEvent(e,t){d.TelemetryLogManager.instance.sendEvent({name:d.Events.spool_tscalling_stack_initialized,tenant:d.TelemetryLogManager.SPOOL_TENANT,properties:Object.assign({success:e,reason:t},this._callAgent.getTelemetryMetadata())})}sendTrouterInitializedEvent(e){d.TelemetryLogManager.instance.sendEvent({name:d.Events.spool_trouter_initialized,tenant:d.TelemetryLogManager.SPOOL_TENANT,properties:Object.assign({success:e},this._callAgent.getTelemetryMetadata())})}}t.CallStack=v,v._stackInitialized=!1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(55),r=n(1),o=n(112),a=n(53),s=n(21),c=n(50),l=n(6),u=function(){function e(){}return e.setEventsHandler=function(e){this._eventHandler=e},e.getEventsHandler=function(){return this._eventHandler},e.scheduleTimer=function(){var e=this,t=this._profiles[this._currentProfile][2];this._timeout<0&&t>=0&&!this._paused&&(this._eventHandler.hasEvents()?(0===t&&this._currentBackoffCount>0&&(t=1),this._timeout=setTimeout(function(){return e._batchAndSendEvents()},t*(1<<this._currentBackoffCount)*1e3)):this._timerCount=0)},e.initialize=function(e){var t=this;this._newEventsAllowed=!0,this._config=e,this._eventHandler=new o.default(e.collectorUri,e.cacheMemorySizeLimitInNumberOfEvents,e.httpXHROverride,e.clockSkewRefreshDurationInMins),this._initializeProfiles(),a.default.initialize(function(e,n){if(t._config.canSendStatEvent("awt_stats")){var i=new s.default("awt_stats");for(var o in i.setEventPriority(r.AWTEventPriority.High),i.setProperty("TenantId",n),e)e.hasOwnProperty(o)&&i.setProperty(o,e[o].toString());c.default.getLogger(l.StatsApiKey).logEvent(i)}})},e.setTransmitProfile=function(e){this._currentProfile!==e&&void 0!==this._profiles[e]&&(this.clearTimeout(),this._currentProfile=e,this.scheduleTimer())},e.loadTransmitProfiles=function(e){for(var t in this._resetTransmitProfiles(),e)if(e.hasOwnProperty(t)){if(3!==e[t].length)continue;for(var n=2;n>=0;--n)if(e[t][n]<0){for(var i=n;i>=0;--i)e[t][i]=-1;break}for(n=2;n>0;--n)if(e[t][n]>0&&e[t][n-1]>0){var r=e[t][n-1]/e[t][n];e[t][n-1]=Math.ceil(r)*e[t][n]}this._profiles[t]=e[t]}},e.sendEvent=function(e){this._newEventsAllowed&&(this._currentBackoffCount>0&&e.priority===r.AWTEventPriority.Immediate_sync&&(e.priority=r.AWTEventPriority.High),this._eventHandler.addEvent(e),this.scheduleTimer())},e.flush=function(e){var t=(new Date).getTime();!this._paused&&this._lastUploadNowCall+3e4<t&&(this._lastUploadNowCall=t,this._timeout>-1&&(clearTimeout(this._timeout),this._timeout=-1),this._eventHandler.uploadNow(e))},e.pauseTransmission=function(){this._paused||(this.clearTimeout(),this._eventHandler.pauseTransmission(),this._paused=!0)},e.resumeTransmision=function(){this._paused&&(this._paused=!1,this._eventHandler.resumeTransmission(),this.scheduleTimer())},e.flushAndTeardown=function(){a.default.teardown(),this._newEventsAllowed=!1,this.clearTimeout(),this._eventHandler.teardown()},e.backOffTransmission=function(){this._currentBackoffCount<4&&(this._currentBackoffCount++,this.clearTimeout(),this.scheduleTimer())},e.clearBackOff=function(){this._currentBackoffCount>0&&(this._currentBackoffCount=0,this.clearTimeout(),this.scheduleTimer())},e._resetTransmitProfiles=function(){this.clearTimeout(),this._initializeProfiles(),this._currentProfile=i.AWT_REAL_TIME,this.scheduleTimer()},e.clearTimeout=function(){this._timeout>0&&(clearTimeout(this._timeout),this._timeout=-1,this._timerCount=0)},e._batchAndSendEvents=function(){var e=r.AWTEventPriority.High;this._timerCount++,this._timerCount*this._profiles[this._currentProfile][2]===this._profiles[this._currentProfile][0]?(e=r.AWTEventPriority.Low,this._timerCount=0):this._timerCount*this._profiles[this._currentProfile][2]===this._profiles[this._currentProfile][1]&&(e=r.AWTEventPriority.Normal),this._eventHandler.sendEventsForPriorityAndAbove(e),this._timeout=-1,this.scheduleTimer()},e._initializeProfiles=function(){this._profiles={},this._profiles[i.AWT_REAL_TIME]=[4,2,1],this._profiles[i.AWT_NEAR_REAL_TIME]=[12,6,3],this._profiles[i.AWT_BEST_EFFORT]=[36,18,9]},e._newEventsAllowed=!1,e._currentProfile=i.AWT_REAL_TIME,e._timeout=-1,e._currentBackoffCount=0,e._paused=!1,e._timerCount=0,e._lastUploadNowCall=0,e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSdkVersion=function(){return"1.0.0.0"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i="3617";t.setPlatformId=(e=>i=e),t.getPlatformId=(()=>i),t.CALL_CONTROLLER_URL="https://api.cc.skype.com/conv/",t.REGISTRAR_URL="https://edge.skype.com/registrar/prod/v3/registrations",t.TROUTER_URL="https://go.trouter.skype.com/v4/a",t.UI_VERSION="0.0.0.100"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(13),r=n(2);t.toTsScalingMode=function(e){switch(e){case"Crop":return 1;case"Fit":return 2;case"Stretch":return 0;default:return 1}},t.stringifyObject=function(e){return e.toString===Object.prototype.toString?JSON.stringify(e):e.toString()},t.defer=function(){let e,t,n=!0;const i=new Promise((n,i)=>{e=n,t=i});return{isPending:()=>n,promise:i,resolve:t=>{n&&(e(t),n=!1)},reject:e=>{n&&(t(e),n=!1)},dispose:()=>{i=void 0}}},t.assertNotNull=function(e,t){if(null===e)throw new r.CommunicationErrorImpl(`AssertNotNull failed. ${void 0!==t?`: ${t}`:""}`).setCode(422)},t.assertIsString=function(e,t){if("string"!=typeof e)throw new r.CommunicationErrorImpl(`AssertIsString failed. ${void 0!==t?`: ${t}`:""}`).setCode(422)},t.assertIsNumber=function(e,t){if("number"!=typeof e)throw new r.CommunicationErrorImpl(`AssertIsNumber failed. ${void 0!==t?`: ${t}`:""}`).setCode(422)},t.assertIsBoolean=function(e,t){if("boolean"!=typeof e)throw new r.CommunicationErrorImpl(`AssertIsBoolean failed. ${void 0!==t?`: ${t}`:""}`).setCode(422)},t.assertIsObject=function(e,t){if("object"!=typeof e)throw new r.CommunicationErrorImpl(`AssertIsObject failed. ${void 0!==t?`: ${t}`:""}`).setCode(422)},t.assertIsArrayOfSupportedIdentifiers=function(e,t){if(!(e instanceof Array))throw new r.CommunicationErrorImpl(`AssertIsArrayOfIdentifiers failed. ${void 0!==t?`: ${t}`:""}`).setCode(422);e.forEach(e=>{if(i.isUnknownIdentifier(e))throw new r.CommunicationErrorImpl(`AssertIsArrayOfIdentifiers failed. ${void 0!==t?`: ${t}`:""}`).setCode(422)})},t.parseJWT=function(e){let[,t]=null==e?void 0:e.split(".");if(void 0===t)throw new r.CommunicationErrorImpl("Invalid token").setCode(400);return t=t.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape(atob(t))))},t.validateGuid=function(e){return new RegExp("^[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}$","i").test(e)}},function(e,t,n){"use strict";
/*!
 *  AufLog.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function i(e,t){var n=0;return e.replace(/%[dixs%]/g,function(e){var i=0;if("%"!==e[i++])return"";var r=e[i++];return"%"===r?"%":"s"===r?t[n++]:"d"===r||"i"===r?t[n++]:"x"===r?t[n++].toString(16):e})}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=10]="Trace",e[e.Debug6=16]="Debug6",e[e.Debug5=18]="Debug5",e[e.Debug4=20]="Debug4",e[e.Debug3=30]="Debug3",e[e.Debug2=40]="Debug2",e[e.Debug1=50]="Debug1",e[e.Warning=60]="Warning",e[e.Error=70]="Error",e[e.Fatal=80]="Fatal",e[e.MetaData=90]="MetaData"}(t.LogLevel||(t.LogLevel={})),function(e){e[e.UseDefault=0]="UseDefault",e[e.Compress=1]="Compress",e[e.Disabled=2]="Disabled"}(t.LogFileCompression||(t.LogFileCompression={})),function(e){e[e.Raw=0]="Raw",e[e.Base64=1]="Base64"}(t.LogFileEncoding||(t.LogFileEncoding={})),function(e){e[e.Unencrypted=0]="Unencrypted",e[e.Encrypted=1]="Encrypted"}(t.LogFileEncryption||(t.LogFileEncryption={})),function(e){e[e.PEM=0]="PEM",e[e.DER=1]="DER",e[e.BER=2]="BER"}(t.CertStoreFormat||(t.CertStoreFormat={})),function(e){e[e.InsertFront=8]="InsertFront"}(t.AppenderFlags||(t.AppenderFlags={})),t.vsprintf=i,t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return i(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e,10),this.low<0&&(this.high=-1)}return e.prototype._Equals=function(t){var n=new e(t);return this.low===n.low&&this.high===n.high},e}();t.Int64=i;var r=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e,10)}return e.prototype._Equals=function(t){var n=new e(t);return this.low===n.low&&this.high===n.high},e}();t.UInt64=r;var o=function(){function e(){}return e._ToByte=function(e){return this._ToUInt8(e)},e._ToUInt8=function(e){return 255&e},e._ToInt32=function(e){return 2147483647&e|2147483648&e},e._ToUInt32=function(e){return 4294967295&e},e}();t.Number=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(1),o=function(){function e(e){this._event={name:"",properties:{}},e&&this.setName(e)}return e.prototype.setName=function(e){this._event.name=e},e.prototype.getName=function(){return this._event.name},e.prototype.setType=function(e){this._event.type=e},e.prototype.getType=function(){return this._event.type},e.prototype.setTimestamp=function(e){this._event.timestamp=e},e.prototype.getTimestamp=function(){return this._event.timestamp},e.prototype.setEventPriority=function(e){this._event.priority=e},e.prototype.getEventPriority=function(){return this._event.priority},e.prototype.setProperty=function(e,t,n){void 0===n&&(n=r.AWTPropertyType.Unspecified);var o={value:t,type:n,pii:r.AWTPiiKind.NotSet,cc:r.AWTCustomerContentKind.NotSet};null!==(o=i.sanitizeProperty(e,o))?this._event.properties[e]=o:delete this._event.properties[e]},e.prototype.setPropertyWithPii=function(e,t,n,o){void 0===o&&(o=r.AWTPropertyType.Unspecified);var a={value:t,type:o,pii:n,cc:r.AWTCustomerContentKind.NotSet};null!==(a=i.sanitizeProperty(e,a))?this._event.properties[e]=a:delete this._event.properties[e]},e.prototype.setPropertyWithCustomerContent=function(e,t,n,o){void 0===o&&(o=r.AWTPropertyType.Unspecified);var a={value:t,type:o,pii:r.AWTPiiKind.NotSet,cc:n};null!==(a=i.sanitizeProperty(e,a))?this._event.properties[e]=a:delete this._event.properties[e]},e.prototype.getPropertyMap=function(){return this._event.properties},e.prototype.getEvent=function(){return this._event},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.MSACID=1]="MSACID",e[e.MSAPUID=2]="MSAPUID",e[e.ANID=3]="ANID",e[e.OrgIdCID=4]="OrgIdCID",e[e.OrgIdPUID=5]="OrgIdPUID",e[e.UserObjectId=6]="UserObjectId",e[e.Skype=7]="Skype",e[e.Yammer=8]="Yammer",e[e.EmailAddress=9]="EmailAddress",e[e.PhoneNumber=10]="PhoneNumber",e[e.SipAddress=11]="SipAddress",e[e.MUID=12]="MUID"}(t.AWTUserIdType||(t.AWTUserIdType={})),function(e){e[e.Started=0]="Started",e[e.Ended=1]="Ended"}(t.AWTSessionState||(t.AWTSessionState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Default=0]="Default",e[e.User=1]="User"}(t.EcsConfigType||(t.EcsConfigType={}))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(4),s=n(2),c=n(14),l=n(3),u=n(38);class d{constructor(e){if(!(e instanceof u.VideoDeviceInfoImpl))throw new s.CommunicationErrorImpl("source was not of type VideoDeviceInfo");this._source=e,this._mediaStreamType="Video"}getSource(){return this._source}getMediaStreamType(){return this._mediaStreamType}switchSource(e){var t;return o(this,void 0,void 0,function*(){if(this._source===e)throw new s.CommunicationErrorImpl("Unable to switch source").setCode(400);yield null===(t=c.CallStack.getInitializedTsStack())||void 0===t?void 0:t.getDeviceManager().selectDevices({camera:e.id}),this._source=e})}}i([a.asyncOperation(l.LocalVideoStreamOperation.SwitchSource),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],d.prototype,"switchSource",null),t.LocalVideoStream=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(17),r=n(16),o=n(39),a=n(29);class s{constructor(){this._JsCsaConfigDefaults={languageCode:"en",emergencyCallCountry:"",autoResolveConflictedCall:!1,handleRosterFromCreateAndJoin:!0,conversationServiceUrl:i.CALL_CONTROLLER_URL,useInternalHttpDispatcher:!0,supportsHostlessGroupCalls:!0,doHostlessCalling:!0,shouldServiceSendCallEventMessages:!0,shouldServiceSendNGCUpgradeMessages:!0,supportsCompressedServicePayload:!0,handleNewOfferRequest:!0,handleMediaOfferFromPushNotification:!0,isWebRtcEnabled:!0,supportsSynchronousTrouterResponse:!0,autoJoinOnConflict:!0,brokerEnabledOutgoing:!0,brokerEnabledIncoming:!0,brokerExclusively:!1,brokerRequestBatching:!0,isGVCOutgoingEnabled:!0,isGVCJoiningEnabled:!0,enableTokenCache:!0},this._JamaSettingsDefaults={debug:!1,numVideoChannelsGvc:6,requestTimeoutMs:3e4,ortcPreferBundling:!0,webrtcVideoSubscriptionDisposeTimeout:0,webrtcOutgoingScreenSharingEnabled:!0,webrtcGetDisplayMediaEnabled:!0,ortcOutgoingScreensharingEnabled:!0},this._MDNTrapSettingsDefaults={Relay:{Turn:{url:"https://euaz.turn.skype.com/relay"}}},this.setConfigOrDefault=((e,t)=>{e&&Object.keys(e).forEach(n=>{void 0!==e[n]&&(t[n]=e[n])})})}getTrouterTelemetryConfig(){return{enabled:!1,logHealthCheckError:!1,trouter_js_client_connected:!1,trouter_js_client_disconnected:!1,trouter_js_client_error:!1,trouter_js_client_progress:!1,trouter_js_client_response:!1,numberOfStepsToMaintain:0,sendProgressTimeoutSecs:0}}getJamaSettings(){return this._JamaSettingsDefaults}getJsCsaConfig(){return Object.assign(Object.assign({},this._JsCsaConfigDefaults),{clientInformation:`SpoolWeb(${i.getPlatformId()}/${r.getSdkVersion()})`})}getMdnTrapSettings(){return this._MDNTrapSettingsDefaults}getTrouterSettings(){return{version:r.getSdkVersion(),productName:"SpoolWeb",trouterServiceUrl:i.TROUTER_URL,registrarTtlInSeconds:360,registrarRefreshTimeoutInMs:35e4,trouterConnectTimeoutInMs:2e4,maxRegistrationTimeInMs:864e5,pnhAppId:"SpoolWeb",pnhTemplate:"SpoolWeb_1.0",environment:"Prod",sessionId:a.generateGuid(),platform:o.getPlatformName()}}setConfig(e){this.setConfigOrDefault(null==e?void 0:e.SkypeWebMedia,this._JamaSettingsDefaults),this.setConfigOrDefault(null==e?void 0:e.SkypeCalling,this._JsCsaConfigDefaults),this.setConfigOrDefault(null==e?void 0:e.MDN_TRAP,this._MDNTrapSettingsDefaults)}}t.EcsProvider=s,s.instance=new s},function(e,t,n){"use strict";(function(t){var i=n(0),r=n(88),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s={adapter:function(){var e;return"undefined"!=typeof XMLHttpRequest?e=n(44):void 0!==t&&(e=n(44)),e}(),transformRequest:[function(e,t){return r(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],function(e){s.headers[e]={}}),i.forEach(["post","put","patch"],function(e){s.headers[e]=i.merge(o)}),e.exports=s}).call(this,n(11))},function(e,t,n){"use strict";
/*!
 *  LogFactory.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(19);function a(e){if(null===e)return-1;for(var t=0,n=e.length-1;n>=0;n--)t=37*t+e.charCodeAt(n)|0;var i="__auf_literal:";for(n=i.length-1;n>=0;n--)t=37*t+i.charCodeAt(n)|0;return t}!function(e){e[e.Unsafe=0]="Unsafe",e[e.Safe=1]="Safe",e[e.Inherited_Unsafe=2]="Inherited_Unsafe",e[e.Inherited_Safe=3]="Inherited_Safe",e[e.Blacklisted_Unsafe=4]="Blacklisted_Unsafe"}(r||(r={}));var s,c=function(){function e(e,t){this._level=o.LogLevel.Debug4,this._threshold=255,this._safe=r.Inherited_Unsafe,this._name=e,t&&(this._level=t.level(),this._safe=t.safe()?r.Inherited_Safe:r.Inherited_Unsafe,this._extendedInfo=t.extendedInfo())}return e.prototype.name=function(){return this._name},e.prototype.safe=function(){return this._safe===r.Safe||this._safe===r.Inherited_Safe},e.prototype.safety=function(){return this._safe},e.prototype.setSafety=function(e){this._safe=e},e.prototype.description=function(){return this._desc},e.prototype.setDescription=function(e){this._desc=e},e.prototype.level=function(){return this._level},e.prototype.setLevel=function(e){s.setLevel(this,e)},e.prototype._setLevel=function(e){this._level=e},e.prototype._setThreshold=function(e){this._threshold=e},e.prototype.isEnabled=function(e){return this._threshold<=e},e.prototype.setExtendedInfo=function(e){this._extendedInfo=e},e.prototype.extendedInfo=function(){return this._extendedInfo},e.prototype.trace=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Trace,a(e),e].concat(t))},e.prototype.debug6=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Debug6,a(e),e].concat(t))},e.prototype.debug5=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Debug5,a(e),e].concat(t))},e.prototype.debug4=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Debug4,a(e),e].concat(t))},e.prototype.debug3=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Debug3,a(e),e].concat(t))},e.prototype.debug2=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Debug2,a(e),e].concat(t))},e.prototype.debug1=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Debug1,a(e),e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Warning,a(e),e].concat(t))},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Error,a(e),e].concat(t))},e.prototype.fatal=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.Fatal,a(e),e].concat(t))},e.prototype.meta=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.log.apply(s,[this,o.LogLevel.MetaData,a(e),e].concat(t))},e}(),l=function(){function e(){}return e.instance=function(){return s},e.levelToString=function(e){return e<=o.LogLevel.Trace?"TRACE":e<=o.LogLevel.Debug6?"DEBUG6":e<=o.LogLevel.Debug5?"DEBUG5":e<=o.LogLevel.Debug4?"DEBUG4":e<=o.LogLevel.Debug3?"DEBUG3":e<=o.LogLevel.Debug2?"DEBUG2":e<=o.LogLevel.Debug1?"DEBUG1":e<=o.LogLevel.Warning?"WARN":e<=o.LogLevel.Error?"ERROR":e<=o.LogLevel.Fatal?"FATAL":(o.LogLevel.MetaData,"META")},e.levelFromString=function(e){return this._levelFromString[e]||parseInt(e,10)},e}();function u(e,t){for(var n=t.name();n.length>0;){if(e[n])return e[n];var i=n.lastIndexOf(".");n=i<0?"":n.substr(0,i)}return e[""]?e[""]:o.LogLevel.Debug4}function d(e,t){var n=255;return t.forEach(function(t){var i=255;t.appender.levels()?i=Math.min(i,u(t.appender.levels(),e)):t.appender.receiveAll()||(i=Math.min(i,e.level())),n=Math.min(n,i)}),n}l._levelFromString={TRACE:o.LogLevel.Trace,DEBUG6:o.LogLevel.Debug6,DEBUG5:o.LogLevel.Debug5,DEBUG4:o.LogLevel.Debug4,DEBUG3:o.LogLevel.Debug3,DEBUG2:o.LogLevel.Debug2,DEBUG1:o.LogLevel.Debug1,WARN:o.LogLevel.Warning,ERROR:o.LogLevel.Error,FATAL:o.LogLevel.Fatal,META:o.LogLevel.MetaData},t.LogFactory=l;var p=function(e){function t(){var t=e.call(this)||this;return t._nextId=0,t._appenders=[],t._components={},t._componentBlacklist=[],t._components[""]=new c("",null),t}return i(t,e),t.prototype.toHex=function(e){return(4294967296+e).toString(16).substr(-8)},t.prototype.addAppender=function(e,t){void 0===t&&(t=0);var n=this._nextId++;return t&o.AppenderFlags.InsertFront?this._appenders.unshift({appender:e,handle:n}):this._appenders.push({appender:e,handle:n}),this.recalcComponentThresholds(),n},t.prototype.removeAppender=function(e){for(var t=0;t<this._appenders.length;t++)if(this._appenders[t].handle===e){this._appenders.splice(t,1);break}this.recalcComponentThresholds()},t.prototype.log=function(e,t,n,i){for(var r=[],o=4;o<arguments.length;o++)r[o-4]=arguments[o];try{if(e.isEnabled(t)){var a={timestamp:(new Date).getTime(),component:e,level:t};this._appenders.forEach(function(o){(function(e,t,n){return!!e.appender.receiveAll()||(e.appender.levels()?n>=u(e.appender.levels(),t):n>=t.level())})(o,e,t)&&o.appender.log(a,n,i,r)})}}catch(e){}},t.prototype.parent=function(e){for(;;){var t=e.lastIndexOf(".");if(e=t>=0?e.substr(0,t):"",this._components[e])return this._components[e]}},t.prototype.children=function(e){var t=[];for(var n in this._components)this.parent(n).name()===e&&t.push(this._components[n]);return t},t.prototype.component=function(e){if(this._components[e])return this._components[e];var t=new c(e,this.parent(e));this._components[e]=t;var n=d(t,this._appenders);return t._setThreshold(n),t},t.prototype.rootComponent=function(){return this.component("")},t.prototype.setSafetyRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){e.safety()!==r.Inherited_Safe&&e.safety()!==r.Inherited_Unsafe||(e.setSafety(t),n.setSafetyRecursive(e.name(),t))})},t.prototype.declareComponentSafe=function(e,t){var n=this.component(e);-1!==this._componentBlacklist.indexOf(n.name())?n.setSafety(r.Blacklisted_Unsafe):n.setSafety(t?r.Safe:r.Unsafe),this.setSafetyRecursive(e,t?r.Inherited_Safe:r.Inherited_Unsafe)},t.prototype.declareComponentDescription=function(e,t){this.component(e).setDescription(t)},t.prototype.setExtendedInfoRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){void 0===e.extendedInfo()&&(e.setExtendedInfo(t),n.setExtendedInfoRecursive(e.name(),t))})},t.prototype.declareComponentExtendedInfo=function(e,t){var n=this.component(e);n.setExtendedInfo(t),this.setExtendedInfoRecursive(n.name(),t)},t.prototype.recalcComponentThresholds=function(){for(var e in this._components){var t=this._components[e],n=d(t,this._appenders);t._setThreshold(n)}},t.prototype.setLevel=function(e,t){if(""===e.name())for(var n in this._components){(o=this._components[n])._setLevel(t);var i=d(o,this._appenders);o._setThreshold(i)}else{var r=e.name()+".";e._setLevel(t);i=d(e,this._appenders);for(var n in e._setThreshold(i),this._components){var o;if((o=this._components[n]).name().substr(0,r.length)===r){o._setLevel(t);var a=d(o,this._appenders);o._setThreshold(a)}}}},t.prototype.setComponentBlacklist=function(e){for(var t in this._componentBlacklist=e,this._components){var n=this._components[t];-1!==this._componentBlacklist.indexOf(n.name())&&n.setSafety(r.Blacklisted_Unsafe)}},t}(l);s=new p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r="MicrosoftApplicationsTelemetryDeviceId",o="MicrosoftApplicationsTelemetryFirstLaunchTime",a="MSIE",s="Chrome",c="Firefox",l="Safari",u="Edge",d="Electron",p="SkypeShell",f="PhantomJS",h="Opera",g="Windows",m="Mac OS X",v="Windows Phone",y="Windows RT",S="iOS",_="Android",E="Linux",T="Chrome OS",C=/(windows|win32)/i,I=/ arm;/i,A=/windows\sphone\s\d+\.\d+/i,b=/(macintosh|mac os x)/i,R=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,O=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,P=/android/i,N=/CrOS/i,M={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},w=function(){function e(){}return e.addPropertyStorageOverride=function(e){return!!e&&(this._propertyStorage=e,!0)},e.autoCollect=function(e,t,n){if(this._semanticContext=e,this._disableCookies=t,this._autoCollect(),n||"undefined"==typeof navigator||(n=navigator.userAgent||""),this._autoCollectFromUserAgent(n),this._disableCookies&&!this._propertyStorage)return this._deleteCookie(r),void this._deleteCookie(o);(this._propertyStorage||this._areCookiesAvailable&&!this._disableCookies)&&this._autoCollectDeviceId()},e.checkAndSaveDeviceId=function(e){if(e){var t=this._getData(r),n=this._getData(o);t!==e&&(n=i.getISOString(new Date)),this._saveData(r,e),this._saveData(o,n),this._setFirstLaunchTime(n)}},e._autoCollectDeviceId=function(){var e=this._getData(r);e||(e=i.newGuid()),this._semanticContext.setDeviceId(e)},e._autoCollect=function(){"undefined"!=typeof document&&document.documentElement&&this._semanticContext.setAppLanguage(document.documentElement.lang),"undefined"!=typeof navigator&&this._semanticContext.setUserLanguage(navigator.userLanguage||navigator.language);var e=(new Date).getTimezoneOffset(),t=e%60,n=(e-t)/60,i="+";n>0&&(i="-"),n=Math.abs(n),t=Math.abs(t),this._semanticContext.setUserTimeZone(i+(n<10?"0"+n:n.toString())+":"+(t<10?"0"+t:t.toString()))},e._autoCollectFromUserAgent=function(e){if(e){var t=this._getBrowserName(e);this._semanticContext.setDeviceBrowserName(t),this._semanticContext.setDeviceBrowserVersion(this._getBrowserVersion(e,t));var n=this._getOsName(e);this._semanticContext.setDeviceOsName(n),this._semanticContext.setDeviceOsVersion(this._getOsVersion(e,n))}},e._getBrowserName=function(e){return this._userAgentContainsString("OPR/",e)?h:this._userAgentContainsString(f,e)?f:this._userAgentContainsString(u,e)?u:this._userAgentContainsString(d,e)?d:this._userAgentContainsString(s,e)?s:this._userAgentContainsString("Trident",e)?a:this._userAgentContainsString(c,e)?c:this._userAgentContainsString(l,e)?l:this._userAgentContainsString(p,e)?p:"Unknown"},e._setFirstLaunchTime=function(e){if(!isNaN(e)){var t=new Date;t.setTime(parseInt(e,10)),e=i.getISOString(t)}this.firstLaunchTime=e},e._userAgentContainsString=function(e,t){return t.indexOf(e)>-1},e._getBrowserVersion=function(e,t){return t===a?this._getIeVersion(e):this._getOtherVersion(t,e)},e._getIeVersion=function(e){var t=e.match(new RegExp(a+" ([\\d,.]+)"));if(t)return t[1];var n=e.match(new RegExp("rv:([\\d,.]+)"));return n?n[1]:void 0},e._getOtherVersion=function(e,t){e===l&&(e="Version");var n=t.match(new RegExp(e+"/([\\d,.]+)"));return n?n[1]:"Unknown"},e._getOsName=function(e){return e.match(A)?v:e.match(I)?y:e.match(R)?S:e.match(P)?_:e.match(O)?E:e.match(b)?m:e.match(C)?g:e.match(N)?T:"Unknown"},e._getOsVersion=function(e,t){return t===g?this._getGenericOsVersion(e,"Windows NT"):t===_?this._getGenericOsVersion(e,t):t===m?this._getMacOsxVersion(e):"Unknown"},e._getGenericOsVersion=function(e,t){var n=e.match(new RegExp(t+" ([\\d,.]+)"));return n?M[n[1]]?M[n[1]]:n[1]:"Unknown"},e._getMacOsxVersion=function(e){var t=e.match(new RegExp(m+" ([\\d,_,.]+)"));if(t){var n=t[1].replace(/_/g,".");if(n){var i=this._getDelimiter(n);return i?n.split(i)[0]:n}}return"Unknown"},e._getDelimiter=function(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null},e._saveData=function(e,t){if(this._propertyStorage)this._propertyStorage.setProperty(e,t);else if(this._areCookiesAvailable){var n=new Date;n.setTime(n.getTime()+31536e6);var i="expires="+n.toUTCString();document.cookie=e+"="+t+"; "+i}},e._getData=function(e){if(this._propertyStorage)return this._propertyStorage.getProperty(e)||"";if(this._areCookiesAvailable){e+="=";for(var t=document.cookie.split(";"),n=0;n<t.length;n++){for(var i=t[n],r=0;" "===i.charAt(r);)r++;if(0===(i=i.substring(r)).indexOf(e))return i.substring(e.length,i.length)}}return""},e._deleteCookie=function(e){this._areCookiesAvailable&&(document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;")},e._disableCookies=!1,e._areCookiesAvailable="undefined"!=typeof document&&void 0!==document.cookie,e}();t.default=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(30),r=n(1),o=n(22),a=function(){function e(e,t){this._allowDeviceFields=e,this._properties=t}return e.prototype.setAppId=function(e){this._addContext("AppInfo.Id",e)},e.prototype.setAppVersion=function(e){this._addContext("AppInfo.Version",e)},e.prototype.setAppLanguage=function(e){this._addContext("AppInfo.Language",e)},e.prototype.setDeviceId=function(e){this._allowDeviceFields&&(i.default.checkAndSaveDeviceId(e),this._addContext("DeviceInfo.Id",e))},e.prototype.setDeviceOsName=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.OsName",e)},e.prototype.setDeviceOsVersion=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.OsVersion",e)},e.prototype.setDeviceBrowserName=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.BrowserName",e)},e.prototype.setDeviceBrowserVersion=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.BrowserVersion",e)},e.prototype.setDeviceMake=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.Make",e)},e.prototype.setDeviceModel=function(e){this._allowDeviceFields&&this._addContext("DeviceInfo.Model",e)},e.prototype.setUserId=function(e,t,n){if(!isNaN(n)&&null!==n&&n>=0&&n<=12)this._addContext("UserInfo.IdType",n.toString());else{var i=void 0;switch(t){case r.AWTPiiKind.SipAddress:i=o.AWTUserIdType.SipAddress;break;case r.AWTPiiKind.PhoneNumber:i=o.AWTUserIdType.PhoneNumber;break;case r.AWTPiiKind.SmtpAddress:i=o.AWTUserIdType.EmailAddress;break;default:i=o.AWTUserIdType.Unknown}this._addContext("UserInfo.IdType",i.toString())}if(isNaN(t)||null===t||t===r.AWTPiiKind.NotSet||t>13)switch(n){case o.AWTUserIdType.Skype:t=r.AWTPiiKind.Identity;break;case o.AWTUserIdType.EmailAddress:t=r.AWTPiiKind.SmtpAddress;break;case o.AWTUserIdType.PhoneNumber:t=r.AWTPiiKind.PhoneNumber;break;case o.AWTUserIdType.SipAddress:t=r.AWTPiiKind.SipAddress;break;default:t=r.AWTPiiKind.NotSet}this._addContextWithPii("UserInfo.Id",e,t)},e.prototype.setUserAdvertisingId=function(e){this._addContext("UserInfo.AdvertisingId",e)},e.prototype.setUserTimeZone=function(e){this._addContext("UserInfo.TimeZone",e)},e.prototype.setUserLanguage=function(e){this._addContext("UserInfo.Language",e)},e.prototype._addContext=function(e,t){"string"==typeof t&&this._properties.setProperty(e,t)},e.prototype._addContextWithPii=function(e,t,n){"string"==typeof t&&this._properties.setPropertyWithPii(e,t,n)},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(113),r=n(17),o=n(16);class a{constructor(){this._telemetryLoggers={}}getLogger(e){const t=e;if(this._telemetryLoggers[t])return this._telemetryLoggers[t];const n=new s(t);return this._telemetryLoggers[t]=n,n}sendEvent(e){const t=JSON.parse(JSON.stringify(e));void 0===t.properties&&(t.properties={}),t.properties.sdkVersion=o.getSdkVersion(),t.properties.platformId=r.getPlatformId();const n=`${r.getPlatformId()}/${o.getSdkVersion()}`;t.properties.uiVersion=n,t.properties.ui_version=n,t.properties.Platform_Uiversion=n,this.getLogger(e.tenant).sendEvent(t)}flushAllEvents(){const e=[];return Object.keys(this._telemetryLoggers).forEach(t=>{e.push(this._telemetryLoggers[t].flushEvents())}),Promise.all(e).then(()=>void 0)}}t.TelemetryLogManager=a,a.instance=new a,a.SPOOL_TENANT="a06afae46f2f4d279be95d40f0579331-6aeb6d18-8e9b-42d0-8cf4-5f93faece1cb-7421";t.TelemetryData=class{};class s{constructor(e,t){this._tenantId=e,i.AWTLogManager.initialize(this._tenantId),i.AWTLogManager.setTransmitProfile(i.AWT_BEST_EFFORT),this._logger=i.AWTLogManager.getLogger(this._tenantId)}sendEvent(e){this._logger.logEvent(e)}flushEvents(){return new Promise(e=>{i.AWTLogManager.flush(e)})}}!function(e){e.spool_tscalling_call_started="spool_tscalling_call_started",e.spool_tscalling_stack_initialized="spool_tscalling_stack_initialized",e.spool_trouter_initialized="spool_trouter_initialized",e.spool_get_composite_token="spool_get_composite_token",e.spool_signaling="spool_signaling"}(t.Events||(t.Events={}))},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error(t)},t.isObject=function(e){return null!==e&&"object"==typeof e},t.isString=function(e){return"string"==typeof e},t.attempt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];try{return e.apply(void 0,t)}catch(e){return new Error(e)}},t.remove=function(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)},t.clone=function(e){return Array.isArray(e)?e.map(t.clone):t.isObject(e)?Object.keys(e).reduce(function(n,r){var o;return i(i({},n),((o={})[r]=t.clone(e[r]),o))},{}):e}},function(e,t,n){"use strict";n.r(t),n.d(t,"SubscriptionToken",function(){return i});var i=function(){function e(e,t){this._event=e,this._callback=t}return e.prototype.unsubscribe=function(){this._event.unsubscribe(this._callback)},e}(),r=function(){function e(e){void 0===e&&(e=!1);var t=this;this._allowStopPropagation=e,this.fire=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var i=t._subscribers,r=i.length-1;r>=0;r--){var o=i[r].apply(null,e);if(t._allowStopPropagation&&o)return!0}return!1},this._subscribers=[]}return e.prototype.dispose=function(){this._subscribers=[]},e.prototype.subscribe=function(e){return this._subscribers=this._subscribers.concat(e),new i(this,e)},e.prototype.unsubscribe=function(e){this._subscribers=this._subscribers.filter(function(t){return t!==e})},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(13),r=n(2);t.getMriFromIdentifier=function(e){const t=i.getIdentifierKind(e);switch(t.kind){case"CommunicationUser":return t.communicationUserId;case"PhoneNumber":return`4:${t.phoneNumber}`;case"CallingApplication":return t.callingApplicationId;case"Unknown":return t.id;default:throw new r.CommunicationErrorImpl("Unable to parse Identifier object").setCode(400)}},t.constructIdentifierFromMri=function(e){return e.startsWith("8:")?{communicationUserId:e}:e.startsWith("4:")?{phoneNumber:e.substring(2)}:e.startsWith("28:")?{callingApplicationId:e}:{id:e}}},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(8),s=n(4),c=n(2),l=n(3),u=n(68);class d{constructor(e,t){this._tsStream=e,this._logger=t,this._eventEmitter=new a.EventEmitter,this._isAvailable=!1,this._type="Video",this._disposed=!1,this._setIsAvailable=(e=>{e!==this.isAvailable&&(this._isAvailable=!!e,this._logger.log(`isAvailable changed to=${this._isAvailable}`),this._eventEmitter.emit("availabilityChanged",this._isAvailable))}),this._setType=(e=>{0===e.type?this._type="Video":1===e.type&&(this._type="ScreenSharing")}),this._disposeRenderer=(e=>{this._logger.log("disposing renderer");try{e.dispose(),this._logger.log("renderer disposed")}catch(e){this._logger.log(`failed to dispose renderer, e=${e}`)}this._eventEmitter.emit("activeRenderersChanged",{added:[],removed:[e]})}),this._setType(this._tsStream),this._logger=this._logger.createChild(()=>`[Stream{id=${this._tsStream.id}}{type=${this._type}}]`),this._setIsAvailable(this._tsStream.isAvailable),this._streamChangedHandler=this._tsStream.changed(()=>this._setIsAvailable(this._tsStream.isAvailable))}get id(){return this._tsStream.id}get isAvailable(){return this._isAvailable}get type(){return this._type}on(e,t){this._eventEmitter.on(e,t)}off(e,t){this._eventEmitter.off(e,t)}render(e,t){return o(this,void 0,void 0,function*(){if(this._logger.log(`render, isAvailable=${this.isAvailable}`),this._disposed)throw this._logger.log("failed to render, stream disposed!"),new c.CommunicationErrorImpl("failed to render, stream disposed!");const n=new u.RemoteVideoRenderer(e,this._tsStream,this._logger,this._disposeRenderer);try{yield n.start(t),this._logger.log("render success")}catch(e){this._logger.log(`render failed, e=${e}`),this._disposeRenderer(n)}return n})}dispose(){this._logger.log("dispose"),this._disposed?this._logger.log("already disposed"):(this._disposed=!0,this._setIsAvailable(!1),this._streamChangedHandler&&this._streamChangedHandler.dispose(),this._eventEmitter.removeAllListeners())}}i([s.asyncOperation(l.RemoteVideoStreamOperation.Render),r("design:type",Function),r("design:paramtypes",[Object,String]),r("design:returntype",Promise)],d.prototype,"render",null),t.RemoteVideoStreamImpl=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatTimeOnBrowser=function(e){let t="";const n=e.getMilliseconds();return n<10?t="  ":n<100&&(t=" "),`${e.toLocaleDateString()}, ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}:${e.getMilliseconds()}${t}`},t.parseParams=function(e){const t={},n=e.replace(/^[?#]/,"").split("&");for(const e of n){const n=e.split("="),i=decodeURIComponent(n.shift()||"");i&&(t[i]=decodeURIComponent(n.shift()||""))}return t},t.isNonEmptyArray=function(e){return Array.isArray(e)&&0!==e.length},t.sleep=function(e){return void 0!==window?new Promise(t=>window.setTimeout(t,e)):new Promise(t=>setTimeout(t,e))},t.isThenable=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VideoDeviceInfoImpl=class{constructor(e,t,n,i){this._name=e,this._id=t,this._cameraFacing=n,this._deviceType=i}get name(){return this._name}get id(){return this._id}get cameraFacing(){return this._cameraFacing}get deviceType(){return this._deviceType}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlatformName=function(){const e=navigator.userAgent;return-1!==e.indexOf("Edge")?"edge":-1!==e.indexOf("Chrome")?"chrome":-1!==e.indexOf("Firefox")?"firefox":-1!==e.indexOf("Safari")?"safari":-1!==e.indexOf("Trident")?"ie":"unknown"};const i="0.0";t.getBrowserInfo=function(){const e=[{name:"edge",engine:"Edge",key:"Edge",masks:[new RegExp("Edge/(\\d+.\\d+)")]},{name:"edgeanaheim",engine:"Chromium",key:"Edg",masks:[new RegExp("Edg/(\\d+.\\d+)")]},{name:"chromium",engine:"Chromium",key:"Chromium",masks:[new RegExp("Chromium/(\\d+.\\d+)")]},{name:"opera",engine:"Chromium",key:"OPR",masks:[new RegExp("OPR/(\\d+.\\d+)")]},{name:"yandexbrowser",engine:"Chromium",key:"YaBrowser",masks:[new RegExp("YaBrowser/(\\d+.\\d+)")]},{name:"chrome",engine:"Chromium",key:"Chrome",masks:[new RegExp("Chrome/(\\d+.\\d+)")]},{name:"firefox",engine:"Firefox",key:"Firefox",masks:[new RegExp("Firefox/(\\d+.\\d+)")]},{name:"safari",engine:"Safari",key:"Safari",masks:[new RegExp("Version/(\\d+.\\d+).*?Safari/")]},{name:"ie",engine:"MSIE",key:"Trident",masks:[new RegExp("MSIE (\\d+.\\d+)"),new RegExp("rv:(\\d+.\\d+)")]}],t=navigator.userAgent;let n={name:"unknown",engine:"Unknown",version:i};return e.some(e=>-1!==t.indexOf(e.key)&&(n={name:e.name,engine:e.engine,version:function(e,t){let n=[];return t.some(t=>!!(n=e.match(t))),!n||n.length<2?i:n[1]||i}(t,e.masks)},!0)),n}},function(module,exports,__webpack_require__){module.exports=function(__WEBPACK_EXTERNAL_MODULE_10__){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=21)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("["+this.name+"] "+e)},e.prototype.info=function(e){this.logger.info("["+this.name+"] "+e)},e.prototype.warn=function(e){this.logger.warn("["+this.name+"] "+e)},e.prototype.error=function(e){this.logger.error("["+this.name+"] "+e)},e}();t.Logger=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.Active=1]="Active",e[e.Inactive=2]="Inactive"}(t.UserActivityState||(t.UserActivityState={}));var i=function(){};t.HttpHeaders=i,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2020.50.01.1",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e};var i=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=i},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=function(){function e(e,t,n,i,r,o,a){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=i,this.url=r,this.c2cUrlBase=o,this.expirationTsSec=a}return e.prototype.getRemainingTtlInSec=function(){return i.calculateTtlInSec(this.expirationTsSec)},e}();t.ServerState=r,function(e){e[e.Unknown=0]="Unknown",e[e.Modified=1]="Modified",e[e.Snapshot=2]="Snapshot",e[e.Connected=3]="Connected"}(t.UserActivityEventReason||(t.UserActivityEventReason={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(e){this.logger=e,this.messageHandlers=[]}return e.prototype.register=function(e){if(this.messageHandlers.some(function(t){return t===e}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.active=function(){return this.messageHandlers.length>0},e.prototype.handleMessage=function(e){for(var t={resultCode:i.UNHANDLED_MESSAGE_ACK,isHandled:!1},n=0,r=this.messageHandlers;n<r.length;n++){var o=r[n],a=this.safeExecuteHandle(o,e);if(void 0!==a&&(void 0===a.isHandled||a.isHandled))return void 0===a.resultCode&&(a.resultCode=i.HANDLED_MESSAGE_ACK),a}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("A trouter message handler is throwing exceptions. exception: "+e)}},e}();t.MessageHandlerRegistry=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(a=(a=c.trys).length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=function(e){var t,n=this;return function(o){return i(n,void 0,void 0,function(){return r(this,function(n){return o&&(t=void 0),[2,new Promise(function(n,i){e(o).then(function(e){t=e,n(e)}).catch(function(e){void 0!==t&&t.length>0&&n(t),i(e)})})]})})}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(a=(a=c.trys).length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(0),c=n(18),l=n(20),u=function(){function e(e,t,n,i){this.logFunc=e,this.options=t,this.tokenProvider=n,this.listener=i,this.logger=new s.Logger("Manager",e),this.logger.info("Created TrouterManager with options "+o.toJson(this.options)),this.fsm=new l.TrouterManagerFsm(e,this),this.baseEndpointUrl="",this.processedMessageLoss={}}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(){this.fsm.stop()},e.prototype.configure=function(e){this.options=e,void 0!==this.firstConnection&&this.firstConnection.configure(e),void 0!==this.secondConnection&&this.secondConnection.configure(e),this.logger.info("Reconfigured TrouterManager with options "+o.toJson(this.options))},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.resendRegistration=function(){return i(this,void 0,void 0,function(){return r(this,function(e){return void 0!==this.secondConnection?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):void 0!==this.firstConnection?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])})})},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.startFirstConnection=function(){this.firstConnection=new c.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.firstConnection.start().catch()},e.prototype.startSecondConnection=function(){var e=void 0!==this.firstConnection?this.firstConnection.getUserActivityState():a.UserActivityState.Unknown;this.secondConnection=new c.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,e),this.secondConnection.start().catch()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.firstConnection.stop(e),this.storedFirstConnection=this.firstConnection,this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.stopSecondConnectionDelayed=function(){if(void 0!==this.secondConnection){var e=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in "+Math.round(this.options.lingeringConnectionDelayMs/1e3)+"s"),setTimeout(function(){e.stop(!0)},this.options.lingeringConnectionDelayMs)}},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var e=this.firstConnection.getServerState(),t="/"===e.url.slice(-1)?e.url.slice(0,-1):e.url,n={baseEndpointUrl:t,newEndpointUrl:t!==this.baseEndpointUrl,c2cUrlBase:e.c2cUrlBase,clientId:e.connectedClientId,connectionId:e.connectionId,connectionTtlSec:e.getRemainingTtlInSec()};this.baseEndpointUrl=t,this.listener.onTrouterConnected(e.url,n)}},e.prototype.dispatchReconnecting=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchStopped=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.onDownstreamRequest=function(e,t,n){var i={id:t.id,method:t.method,path:"/"+t.shortUrl,body:t.body,headers:t.headers},r={id:t.id,status:0,headers:{},body:"",send:function(){return r.status<=100||r.status>=999?3:(n.writeHead(r.status,r.headers),n.end(r.body))}};this.listener.onTrouterRequest(i,r)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e){this.fsm.onReconnectionRequired(e===this.firstConnection)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.storedFirstConnection)},e.prototype.onGetConnectionCache=function(){var e=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then(function(e){return e?JSON.parse(e):void 0}).catch(function(t){return e.logger.warn("Invalid connection cache content provided: "+t),e.connectionCache})):Promise.resolve(this.connectionCache)},e.prototype.onSetConnectionCache=function(e){if(this.connectionCache=e,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(e))}catch(e){this.logger.warn("Error setting external connection cache: "+e)}},e.prototype.setUserActivityState=function(e){if(void 0!==this.secondConnection)return this.logger.info("Setting user activity state "+a.UserActivityState[e]+" on the second/new connection"),void this.secondConnection.setUserActivityState(e);if(void 0!==this.firstConnection)return this.logger.info("Setting user activity state "+a.UserActivityState[e]+" on the first/current connection"),void this.firstConnection.setUserActivityState(e);throw new Error("setUserActivityState called too early")},e.prototype.onTrouterMessageLost=function(e){var t=this;if(this.listener.onTrouterMessageLoss)if(e&&e.length){var n=e.filter(function(e){return void 0!==t.processedMessageLoss[e.tag+"-"+e.etag]});if(n.length&&(this.logger.warn("onTrouterMessageLoss - removing duplicates and sending event to server"),this.sendProcessedDroppedIndicators(n),!(e=e.filter(function(e){return void 0===t.processedMessageLoss[e.tag+"-"+e.etag]})).length))return void this.logger.warn("onTrouterMessageLoss - All the data are duplicated");var i=this.listener.onTrouterMessageLoss(e.map(function(e){return e.tag}));if(!i)return void this.logger.warn("onTrouterMessageLoss - flow tags have not been processed by listeners");e.forEach(function(e){t.processedMessageLoss[e.tag+"-"+e.etag]=""}),this.sendProcessedDroppedIndicators(e)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},e.prototype.sendProcessedDroppedIndicators=function(e){return void 0!==this.firstConnection?void this.firstConnection.sendProcessedDroppedIndicators(e):void 0!==this.secondConnection?void this.secondConnection.sendProcessedDroppedIndicators(e):void 0},e}();t.TrouterManager=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.logger=e}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("[TrouterUrlPromise] returning previously resolved url: "+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("[TrouterUrlPromise] creating and returning promise"),this.pendingPromise=new Promise(function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n})):this.logger.debug("[TrouterUrlPromise] returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("[TrouterUrlPromise] got url: "+this.url);var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("[TrouterUrlPromise] aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("[TrouterUrlPromise] resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=i},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_10__},function(e,t){},function(module,exports,__webpack_require__){(function(global,module){!function(e,t){var n=e;n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,i){var r,o,a=n.util.parseUri(e);t&&t.location&&(a.protocol=a.protocol||t.location.protocol.slice(0,-1),a.host=a.host||(t.document?t.document.domain:t.location.hostname),a.port=a.port||t.location.port),r=n.util.uniqueUri(a);var s={host:a.host,secure:"https"==a.protocol,port:a.port||("https"==a.protocol?443:80),query:a.query||""};return n.util.merge(s,i),!s["force new connection"]&&n.sockets[r]||(o=new n.Socket(s)),!s["force new connection"]&&o&&(n.sockets[r]=o),(o=o||n.sockets[r]).of(a.path.length>1?a.path:"")}}(module.exports,void 0===global?window:global);var io=module.exports;!function(e,t){var n=e.util={},i=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=i.exec(e||""),n={},o=14;o--;)n[r[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,i=e.host,r=e.port;return"document"in t?(i=i||document.domain,r=r||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(i=i||"localhost",r||"https"!=n||(r=443)),(n||"http")+"://"+i+":"+(r||80)},n.query=function(e,t){var i=n.chunkQuery(e||""),r=[];for(var o in n.merge(i,n.chunkQuery(t||"")),i)i.hasOwnProperty(o)&&r.push(o+"="+i[o]);return r.length?"?"+r.join("&"):""},n.chunkQuery=function(e){for(var t,n={},i=e.split("&"),r=0,o=i.length;r<o;++r)(t=i[r].split("="))[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||o)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,i){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,i)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,i,r){var o,a=r||[],s=void 0===i?2:i;for(o in t)t.hasOwnProperty(o)&&n.indexOf(a,o)<0&&("object"==typeof e[o]&&s?n.merge(e[o],t[o],s-1,a):(e[o]=t[o],a.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var i=[],r=e.length>t.length?e:t,o=e.length>t.length?t:e,a=0,s=o.length;a<s;a++)~n.indexOf(r,o[a])&&i.push(o[a]);return i},n.indexOf=function(e,t,n){for(var i=e.length,n=n<0?n+i<0?0:n+i:n||0;n<i&&e[n]!==t;n++);return i<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,void 0===global?window:global),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){i.removeListener(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var i=this.$events[e];if(t.util.isArray(i)){for(var r=-1,o=0,a=i.length;o<a;o++)if(i[o]===n||i[o].listener&&i[o].listener===n){r=o;break}if(r<0)return this;i.splice(r,1),i.length||delete this.$events[e]}else(i===n||i.listener&&i.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var i=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,i);else{if(!t.util.isArray(n))return!1;for(var r=n.slice(),o=0,a=r.length;o<a;o++)r[o].apply(this,i)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,a,s=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)a[n]=str(n,c)||"null";return r=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&(i=rep[n],(r=str(i,c))&&a.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c))&&a.push(quote(i)+(gap?": ":":")+r);return r=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,r}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(i=walk(r,n))?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},i=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],a=t.JSON,s=t.util.indexOf;n.encodePacket=function(e){var t=s(i,e.type),n=e.id||"",c=e.endpoint||"",l=e.ack,u=null;switch(e.type){case"error":var d=e.reason?s(r,e.reason):"",p=e.advice?s(o,e.advice):"";""===d&&""===p||(u=d+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":var f={name:e.name};e.args&&e.args.length&&(f.args=e.args),u=a.stringify(f);break;case"json":u=a.stringify(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+a.stringify(e.args):"")}var h=[t,n+("data"==l?"+":""),c];return null!=u&&h.push(u),h.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,i=e.length;n<i;n++)t+="ï¿½"+e[n].length+"ï¿½"+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(c);if(!t)return{};var n=t[2]||"",e=t[5]||"",s={type:i[t[1]],endpoint:t[4]||""};switch(n&&(s.id=n,t[3]?s.ack="data":s.ack=!0),s.type){case"error":var t=e.split("+");s.reason=r[t[0]]||"",s.advice=o[t[1]]||"";break;case"message":s.data=e||"";break;case"event":try{var l=a.parse(e);s.name=l.name,s.args=l.args}catch(e){}s.args=s.args||[];break;case"json":try{s.data=a.parse(e)}catch(e){}break;case"connect":s.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(s.ackId=t[1],s.args=[],t[3]))try{s.args=t[3]?a.parse(t[3]):[]}catch(e){}}return s},n.decodePayload=function(e){if("ï¿½"==e.charAt(0)){for(var t=[],i=1,r="";i<e.length;i++)"ï¿½"==e.charAt(i)?(t.push(n.decodePacket(e.substr(i+1).substr(0,r))),i+=Number(r)+1,r=""):r+=e.charAt(i);return t}return[n.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var i=0,r=n.length;i<r;i++)this.onPacket(n[i])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var i=this;t.util.on(n,"unload",function(){i.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}e.Socket=i,t.util.mixin(i,t.EventEmitter),i.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},i.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},i.prototype.handshake=function(e){function n(t){t instanceof Error?i.onError(t.message):e.apply(null,t.split(":"))}var i=this,o=this.options,a=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var s=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=a+"&jsonp="+t.j.length,s.parentNode.insertBefore(c,s),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var l=t.util.request();l.open("GET",a,!0),l.withCredentials=!0,l.onreadystatechange=function(){4==l.readyState&&(l.onreadystatechange=r,200==l.status?n(l.responseText):!i.reconnecting&&i.onError(l.responseText))},l.send(null)}},i.prototype.getTransport=function(e){for(var n,i=e||this.transports,r=0;n=i[r];r++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},i.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(i,r,o,a){function s(){if(!n.connected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(s),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){s()},n.options["connect timeout"]))})}n.sessionid=i,n.closeTimeout=1e3*o+2e3,n.heartbeatTimeout=1e3*r+2e3,n.transports=a?t.util.intersect(a.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},i.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},i.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},i.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},i.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},i.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},i.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},i.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},i.prototype.onOpen=function(){this.open=!0},i.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},i.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},i.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},i.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},i.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=r}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=i?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,i=this.options["max reconnection attempts"],r=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new i(this,"json"),this.ackPackets=0,this.acks={}}function i(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],i={type:"event",name:e};return"function"==typeof n&&(i.id=++this.ackPackets,i.ack="data",this.acks[i.id]=n,t=t.slice(0,t.length-1)),i.args=t,this.packet(i)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){i.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var i=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var r=["message",e.data];"data"==e.ack?r.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,r);break;case"event":var r=[e.name].concat(e.args);"data"==e.ack&&r.push(n),this.$emit.apply(this,r);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},i.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},i.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){t.Transport.apply(this,arguments)}function r(){}e.websocket=i,t.util.inherit(i,t.Transport),i.prototype.name="websocket",i.prototype.open=function(e){var i,r=t.util.query(this.socket.options.query),o=this;return this.connectErrorCallback=e,i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+r),this.websocket.onopen=function(){o.onOpen(),o.socket.setBuffer(!1)},this.websocket.onmessage=function(e){o.onData(e.data)},this.websocket.onclose=function(){o.onClose(),o.socket.setBuffer(!0)},this.websocket.onerror=function(e){o.onError(e)},this},i.prototype.send=function(e){return this.websocket.send(e),this},i.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},i.prototype.close=function(){return this.websocket.close(),this},i.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},i.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},i.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},i.xdomainCheck=function(){return!0},i.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=r),this},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function r(){}e.XHR=i,t.util.inherit(i,t.Transport),i.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},i.prototype.payload=function(e){for(var n=[],i=0,r=e.length;i<r;i++)n.push(t.parser.encodePacket(e[i]));this.send(t.parser.encodePayload(n))},i.prototype.send=function(e){return this.post(e),this},i.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=r,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,t.posting=!1,200==this.status?(t.socket.setBuffer(!1),clearTimeout(t.sendXHR.ackTimeoutTimer)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout(function(){t.onClose()},t.socket.options.ackTimeoutMs)},i.prototype.close=function(){return this.onClose(),this},i.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),i=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+i,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},i.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},i.check=function(e,i){try{var r=t.util.request(i),o=n.XDomainRequest&&r instanceof XDomainRequest,a=e&&e.options&&e.options.secure?"https:":"http:",s=a!=n.location.protocol;if(r&&(!o||!s))return!0}catch(e){}return!1},i.xdomainCheck=function(){return i.check(null,!0)},i.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=r),this}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(){t.Transport.XHR.apply(this,arguments)}function r(){}e["xhr-polling"]=i,t.util.inherit(i,t.Transport.XHR),t.util.merge(i,t.Transport.XHR),i.prototype.name="xhr-polling",i.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},i.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=r,this.onerror=r,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},i.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(e){}this.xhr=null}},i.prototype.ready=function(e,n){var i=this;t.util.defer(function(){n.call(i)})},i.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r),this},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),exports.io=io}).call(exports,__webpack_require__(4),__webpack_require__(15)(module))},function(e,t,n){(function(t,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.0.5
 */
!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){return"function"==typeof e}function r(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<C;e+=2)(0,w[e])(w[e+1]),w[e]=void 0,w[e+1]=void 0;C=0}function a(e,t){var n=arguments,i=this,r=new this.constructor(c);void 0===r[L]&&S(r);var o=i._state;return o?function(){var e=n[o-1];b(function(){return y(o,r,e,i._result)})}():g(i,r,e,t),r}function s(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(c);return d(t,e),t}function c(){}function l(e){try{return e.then}catch(e){return U.error=e,U}}function u(t,n,i){n.constructor===t.constructor&&i===a&&n.constructor.resolve===s?function(e,t){t._state===x?f(e,t._result):t._state===F?h(e,t._result):g(t,void 0,function(t){return d(e,t)},function(t){return h(e,t)})}(t,n):i===U?h(t,U.error):void 0===i?f(t,n):e(i)?function(e,t,n){b(function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,function(n){i||(i=!0,t!==n?d(e,n):f(e,n))},function(t){i||(i=!0,h(e,t))},e._label);!i&&r&&(i=!0,h(e,r))},e)}(t,n,i):f(t,n)}function d(e,t){e===t?h(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?u(e,t,l(t)):f(e,t)}function p(e){e._onerror&&e._onerror(e._result),m(e)}function f(e,t){e._state===k&&(e._result=t,e._state=x,0!==e._subscribers.length&&b(m,e))}function h(e,t){e._state===k&&(e._state=F,e._result=t,b(p,e))}function g(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+x]=n,r[o+F]=i,0===o&&e._state&&b(m,e)}function m(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,a=0;a<t.length;a+=3)i=t[a],r=t[a+n],i?y(n,i,r,o):r(o);e._subscribers.length=0}}function v(){this.error=null}function y(t,n,i,r){var o=e(i),a=void 0,s=void 0,c=void 0,l=void 0;if(o){if((a=function(e,t){try{return e(t)}catch(e){return j.error=e,j}}(i,r))===j?(l=!0,s=a.error,a=null):c=!0,n===a)return void h(n,new TypeError("A promises callback cannot return that same promise."))}else a=r,c=!0;n._state!==k||(o&&c?d(n,a):l?h(n,s):t===x?f(n,a):t===F&&h(n,a))}function S(e){e[L]=H++,e._state=void 0,e._result=void 0,e._subscribers=[]}function _(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[L]||S(this.promise),T(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&f(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}function E(e){this[L]=H++,this._result=this._state=void 0,this._subscribers=[],c!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof E?function(e,t){try{t(function(t){d(e,t)},function(t){h(e,t)})}catch(t){h(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var T=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},C=0,I=void 0,A=void 0,b=function(e,t){w[C]=e,w[C+1]=t,2===(C+=2)&&(A?A(o):D())},R="undefined"!=typeof window?window:void 0,O=R||{},P=O.MutationObserver||O.WebKitMutationObserver,N="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),M="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,w=new Array(1e3),D=void 0;D=N?function(){return t.nextTick(o)}:P?function(){var e=0,t=new P(o),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():M?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===R?function(){try{var e=n(11);return void 0!==(I=e.runOnLoop||e.runOnContext)?function(){I(o)}:r()}catch(e){return r()}}():r();var L=Math.random().toString(36).substring(16),k=void 0,x=1,F=2,U=new v,j=new v,H=0;return _.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===k&&n<e;n++)this._eachEntry(t[n],n)},_.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===s){var r=l(e);if(r===a&&e._state!==k)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===E){var o=new n(c);u(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},_.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===k&&(this._remaining--,e===F?h(i,n):this._result[t]=n),0===this._remaining&&f(i,this._result)},_.prototype._willSettleAt=function(e,t){var n=this;g(e,void 0,function(e){return n._settledAt(x,t,e)},function(e){return n._settledAt(F,t,e)})},E.all=function(e){return new _(this,e).promise},E.race=function(e){var t=this;return new t(T(e)?function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},E.resolve=s,E.reject=function(e){var t=new this(c);return h(t,e),t},E._setScheduler=function(e){A=e},E._setAsap=function(e){b=e},E._asap=b,E.prototype={constructor:E,then:a,catch:function(e){return this.then(null,e)}},E.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=E},E.Promise=E,E})}).call(t,n(14),n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(){h&&p&&(h=!1,p.length?f=p.concat(f):g=-1,f.length&&a())}function a(){if(!h){var e=r(o);h=!0;for(var t=f.length;t;){for(p=f,f=[];++g<t;)p&&p[g].run();g=-1,t=f.length}p=null,h=!1,function(e){if(u===clearTimeout)return clearTimeout(e);if((u===i||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function c(){}var l,u,d=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{u="function"==typeof clearTimeout?clearTimeout:i}catch(e){u=i}}();var p,f=[],h=!1,g=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new s(e,t)),1!==f.length||h||r(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(2),a=n(0),s=function(e){this.id=e,this.status=200,this.headers={},this.body=""};t.ResponseData=s,function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(i=t.ClientEventName||(t.ClientEventName={}));var c=function(e,t,n,i,r){this.stepName=e,this.operation=t,this.delta=n,this.ts=i,this.error=r};t.TrackerStep=c;var l=function(){};t.Properties=l;var u=function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0},d=function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0},p=function(){function e(e,t,n,i,o,s,c){this.clientId=t,this.clientInfo=n,this.getServerState=i,this.endpointId=o,this.clientCorrelationID=s,this.environment=c,this.logger=new a.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==s?s:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new r.Timespan,this.eventLogSettings=new d,this.connectedInfo=new u}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(i.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];t.hasOwnProperty(r)&&void 0!==t[r]&&(e[r.replace(/-/g,"_")]={value:t[r]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var i=this.getServerState(),a={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:r.toJson(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:o.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:i.connectionId},connectedClientId:{value:i.connectedClientId},domId:{value:i.domId},url:{value:i.unsecureUrl},surl:{value:i.url},ttlInSecs:{value:i.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(a.properties,t),this.eventLogger.logEvent(a)}}catch(t){this.logger.warn("error in sending event "+e+": "+r.toJson(t))}},e.prototype.createStep=function(e,t,n){return new c(e,t,this.beginTimestamp.duration,Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var r=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(i.Progress,{reason:"flush"},r)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,r){void 0===n&&(n=!0),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(void 0===r&&(r="error"),!0===n&&this.addStep(e,r,t),this.sendTelemetry(i.Error,{},[this.createStep(e,r,t)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),r=this.totalStepCount,o=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(i.Connected,{stepCount:n.length,totalStepCount:r,connectionEstablishmentMs_Total:o},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=Date.now()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(i.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS,n.correlationVector=e.correlationVector;for(var o=e.headers,a=0,s=Object.keys(o);a<s.length;a++){var c=s[a];o.hasOwnProperty(c)&&(n[c]=o[c])}}}catch(e){n.hasError=!0,n.error=n.error+" error creating request context "+r.toJson(e)}this.sendTelemetry(i.Request,n,[])},e.prototype.trackResponse=function(e,t,n,o){var a={};void 0!==o&&(a.hasError=!0,a.error=o);try{if(a.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){a.requestID=e.id,a.httpMethod=e.method,a.shortUrl=e.shortUrl,a.correlationVector=e.correlationVector;for(var s=e.headers,c=0,l=Object.keys(s);c<l.length;c++){var u=l[c];s.hasOwnProperty(u)&&(a[u]=s[u])}}n&&(a.latencyMS=t,a.responseCode=n.status,a.responseLength=n.body.length)}catch(e){a.hasError=!0,a.error=a.error+" error creating response context "+r.toJson(e)}this.sendTelemetry(i.Response,a,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0));var t=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var n=0,r=Object.keys(i).map(function(e){return i[e]});n<r.length;n++){var o=r[n];e.hasOwnProperty(o)&&void 0!==e[o]&&(this.eventLogSettings[o]=e[o])}this.eventLogSettings.sendProgressTimeoutSecs!==t&&(this.eventLogSettings.sendProgressTimeoutSecs=t,this.resetProgressSendTimer())}},e}();t.ConnectionTracker=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.logger=e,this.maxBackoffInMs=t,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),i=1e3*Math.pow(2,e)*n;return i=Math.round(i),Math.min(t,i)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var i=this;void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var r=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off "+t+" for "+r+" milliseconds with ID "+this.backoffId),this.timerHandle=setTimeout(function(){i.logger.info("Back off for "+t+" with ID "+i.backoffId+" complete, invoking handler"),i.timerHandle=void 0,n()},r)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.backoffCount=0},e}();t.ExponentialBackoff=i},function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=n(13),a=n(3),s=n(16),c=n(2),l=n(17),u=n(1),d=n(5),p=n(0),f=n(19),h=n(12),g=function(){this.cv=c.CLIENT_VERSION,this.ua="",this.hr="",this.v=""},m=function(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3},v="MS-CV",y=function(){function e(e){this.cvCounter=0;var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:{},this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:"",this.replied=!1,this.timedout=!1,this.timeoutTimerId=0,this.receivedCv=this.headers[v],this.updateCvHeader()}return Object.defineProperty(e.prototype,"correlationVector",{get:function(){return this.receivedCv?this.receivedCv+"."+this.cvCounter:""},enumerable:!0,configurable:!0}),e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},e.prototype.updateCvHeader=function(){var e=this.correlationVector;e&&(this.headers[v]=e)},e}(),S=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){return e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),_=function(e){this.name=e,this.args={},this.timeoutTimerId=0},E=function(){function e(e,t,n,i,o){var a=this;this.options=t,this.manager=n,this.tokenProvider=i,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.c2cUrlBase="",this.pendingTimers={},this.UNKNOWN_TRANSPORT="unknown_transport",this.logger=new p.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff=new l.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.tokenBackoff=new l.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new g,this.clientInfo.cv=c.CLIENT_VERSION,this.clientInfo.ua="",this.options&&this.options.clientInfo&&(this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new s.ConnectionTracker(e,this.clientID,this.clientInfo,function(){return a.getServerState()},this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(t);var d=this.options.incallModeTimeoutMs>0;if(this.fsm=new f.TrouterFsm(e,this,d),t.registration){var h={registrarUrl:t.registration.registrarUrl,registrationId:t.registration.registrationId,requestTimeoutMs:t.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:t.timeoutOptions.maxBackoffMs};this.registrarClient=r.createRegistrarClient(e,this.tokenProvider,h)}this.userActivityState=o||u.UserActivityState.Unknown}return e.prototype.start=function(){var e=this;return this.logger.info("Starting"),this.manager.onGetConnectionCache().then(function(t){e.externalConnectParams=t}).catch(function(t){e.externalConnectParams=void 0}).then(function(){e.fsm.start()})},e.prototype.stop=function(e){this.logger.info("Stopping"),this.connectionTracker.close(),this.fsm.stop(e)},e.prototype.configure=function(e){var t=this.options.trouterUrl!==e.trouterUrl;this.options=e,this.applyConnectionTrackerOptions(e),t&&this.onTrouterReconnect()},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with "+e),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(s.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.getServerState=function(){return new d.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},e.prototype.getUserActivityState=function(){return this.userActivityState},e.prototype.getToken=function(e,t){var n=this;this.logger.info("Getting token "+(t?"with backoff":"without backoff"));var i=function(){n.connectionTracker.trackStart("token"),n.tokenProvider(!e).then(function(e){n.logger.debug("token is received"),n.connectionTracker.trackEnd("token"),n.fsm.onTokenReceived(e)}).catch(function(t){var i=a.toJson(t.stack);n.logger.error("Getting token failed, will retry after timeout. Error: "+i),n.connectionTracker.trackError("token",i),n.getToken(e,!0)})};t?this.tokenBackoff.backoff("getting token",i):(this.tokenBackoff.reset(),i())},e.prototype.startConnectionTimer=function(){var e=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for "+this.timeoutOptions.connectionTimeoutMs+" ms"),this.connectionTimeoutId=setTimeout(function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for "+this.timeoutOptions.pingTimeoutMs+" ms"),this.pingTimerId=setInterval(function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport "+this.transportTypeName)},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegisterTtl=function(){return this.options.registration&&this.options.registration.registrarTtlSec},e.prototype.startRegisterTimer=function(){var e=this;if(void 0===this.registrationTimerId){var t=this.getRegistrationTtl()-30;this.logger.debug("Starting registration timeout for "+t+" sec"),this.registrationTimerId=setTimeout(function(){e.logger.info("Registration timeout is fired"),e.registrationTimerId=void 0,e.fsm.onRegistrationTimeout()},1e3*t)}else this.logger.error("Another registration timer is set - don't create another one")},e.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.registrarClient.resendRegistration()},e.prototype.buildSocketIoUrlParams=function(){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");var e={};if(this.allocateResult.connectparams)for(var t=this.allocateResult.connectparams,n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];t.hasOwnProperty(r)&&void 0!==t[r]&&(e[r]=t[r])}return e.v="v4",e.tc=encodeURI(a.toJson(this.clientInfo)),e.timeout=this.timeoutOptions.pingTimeoutMs/1e3,e.auth="true",this.options.endpointId&&(e.epid=this.options.endpointId),this.userActivityState!==u.UserActivityState.Unknown&&(e.userActivity=encodeURI(a.toJson(this.createUserActivityObject(this.userActivityState)))),this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.startSocketIo=function(){var e=this;if(this.logger.info("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var t=this.options.ioOptions||new m;if(t["force new connection"]=!0,t.reconnect=!1,t.query=this.buildSocketIoUrlParams(),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+t.query),this.stopSocketIo(),this.socket=(this.options.io||h).connect(this.allocateResult.socketio,t),void 0===this.socket)throw new Error("Can't create Socket.io object");this.socket.on("connecting",function(t){e.onSocketConnecting(t)}),this.socket.on("connect",function(){e.onSocketConnect()}),this.socket.on("connect_failed",function(t){e.onSocketConnectFailed(t)}),this.socket.on("disconnect",function(){e.onSocketDisconnect()}),this.socket.on("reconnect",function(){e.onSocketReconnect()}),this.socket.on("reconnect_failed",function(t){e.onSocketReconnectFailed(t)}),this.socket.on("reconnecting",function(){e.onSocketReconnecting()}),this.socket.on("error",function(t){e.onSocketError(t)}),this.socket.on("message",function(t){e.onSocketMessage(t)}),this.socket.on("trouter.connected",function(t){e.onTrouterConnected(t)}),this.socket.on("trouter.reconnect",function(){e.onTrouterReconnect()}),this.socket.on("trouter.message_loss",function(t){e.onTrouterMessageLoss(t)})},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.info("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket. Error: "+a.toJson(e.stack))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching connected"),this.manager.onRegistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.info("dispatching downstream request");try{var n=new S(e,new s.ResponseData(e.id),function(e,n){return t.logger.info("sending response to downstream"),t.sendResponse(e,n)});this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message. Error : "+a.toJson(e.stack))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.dispatchTrouterMessageLost=function(e){this.logger.info("dispatching trouter lost message"),this.manager.onTrouterMessageLost(e)},e.prototype.sendProcessedDroppedIndicators=function(e){var t=this;try{this.logger.info("emitting processed flow tags to the server");var n=new _("trouter.processed_message_loss");n.args={droppedIndicators:e},this.sendDownstreamEvent(n,function(){t.logger.info("emitted processed flow tags to the server")})}catch(e){var i=a.toJson(e.stack);this.logger.error("unable to send processed message loss event. Error: "+i),this.connectionTracker.trackError("trouter.processed_message_loss",i,!1)}},e.prototype.resetAllocationConnectionParams=function(){this.allocateResult&&(this.logger.info("Resetting allocation connection parameters"),this.allocateResult.connectparams=void 0)},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n=this.options.trouterUrl,r=this.allocateResult&&this.allocateResult.connectparams;if(!r){var o=this.externalConnectParams;o&&o.se&&parseInt(o.se,10)<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: "+new Date(parseInt(o.se,10))),this.externalConnectParams=o=void 0),o&&o.reconnectUrl?(n=o.reconnectUrl,r=i({},o,{reconnectUrl:void 0})):r=o}n=this.appendCorrelationIds(n,!1),r&&(n+="&"+this.buildQuery(r),r.v||(n+="&v=v4"));var a=new Request(n,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"Content-Type":"text/plain"})});this.logger.info("sendAllocateRequest: POST "+n),this.connectionTracker.trackStart("allocation");var s=-1;this.fetchWithTimeout(a,this.timeoutOptions.fetchTimeoutMs).then(function(e){if(s=e.status,!e.ok)throw new Error(e.statusText);var n=e.headers.get("content-type");if(!n||"application/json"!==n&&"application/json;"!==n.substring(0,17))throw new Error("Content-type '"+n+"' is unexpected");return t.connectionTracker.trackEnd("allocation"),e.json()}).then(function(e){t.onAllocationResponse(e)}).catch(function(e){var n=e+", status code "+s;t.logger.error("Allocation request failed. Error: "+n),t.connectionTracker.trackError("allocation",n),t.externalConnectParams&&t.connectionAttempt>2&&(s>=400&&s<=599?(t.logger.warn(t.connectionAttempt+" connection attempts, server-side failure: erasing external connection parameters"),t.externalConnectParams=void 0):t.externalConnectParams.reconnectUrl&&(t.logger.warn(t.connectionAttempt+" connection attempts, erasing reconnect URL"),delete t.externalConnectParams.reconnectUrl)),t.fsm.onAllocationFailed(401===s)})},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info("emitting ping event"),this.socket.emit("ping",function(){e.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){e.logger.error("Ping response timeout is fired"),e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(e){var t=a.toJson(e.stack);this.logger.error("unable to send ping. Error: "+t),this.connectionTracker.trackError("ping",t,!1)}},e.prototype.setUserActivityState=function(e){var t=e!==this.userActivityState;this.userActivityState=e,this.fsm.onSetUserActivityState(e,t)},e.prototype.sendUserActivityState=function(e,t){this.userActivityState!==u.UserActivityState.Unknown&&("websocket"===this.transportTypeName&&t?e===d.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):"xhr-polling"===this.transportTypeName&&e===d.UserActivityEventReason.Modified&&this.fsm.forceReconnect())},e.prototype.sendRegisterRequest=function(){var e=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var t=new a.Timespan;this.connectionTracker.trackStart("registration"),this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:this.getRegistrationTtl()}]}).then(function(){e.logger.info("Register request successful"),e.connectionTracker.trackEnd("registration"),e.fsm.onRegistrationSucceed(),e.connectionTracker.sendTelemetry(s.ClientEventName.Registration,{duration:t.duration},[])}).catch(function(n){e.logger.error("Register request failed. Error: "+n),e.connectionTracker.trackError("registration",n.message),e.connectionTracker.sendTelemetry(s.ClientEventName.Registration,{duration:t.duration},[])})},e.prototype.sendUnregisterRequest=function(){var e=this;this.logger.info("sending unregister request");var t=new a.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then(function(){e.logger.info("Unregister request successful"),e.connectionTracker.trackEnd("unregistration"),e.fsm.onUnregistrationSucceed(),e.connectionTracker.sendTelemetry(s.ClientEventName.Unregistration,{duration:t.duration},[])}).catch(function(n){e.logger.error("Unregister request failed. Error: "+n),e.connectionTracker.trackError("unregistration",n.message),e.fsm.onUnregistrationFailed(!1),e.connectionTracker.sendTelemetry(s.ClientEventName.Unregistration,{duration:t.duration},[])})},e.prototype.fetchWithTimeout=function(e,t){return new o.Promise(function(n,i){fetch(e).then(n).catch(i),0!==t&&setTimeout(i,t,new Error("Fetch for '"+e.url+"' timed out"))})},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.resetRegisterBackoff=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},e.prototype.clearTimers=function(){this.logger.debug("Clearing all pending downstream events related timers");for(var e=0,t=Object.keys(this.pendingTimers);e<t.length;e++){var n=t[e];this.clearTimer(Number(n))}},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting("+e+")"),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(){this.logger.info("onSocketConnect")},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",e,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(){this.logger.error("onSocketDisconnect"),this.connectionTracker.trackDisconnected({serverClosed:!this.fsm.isActive()}),this.connectionTracker.clearConnectedInfo(),this.fsm.onSocketError(void 0),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '"+e+"'"),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '"+a.toJson(e)+"'"),this.connectionTracker.trackError("connectSocket",e),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketMessage=function(e){var t,n=this;this.logger.info("onSocketMessage");try{var i=(t=new y(e)).headers&&t.headers["X-Microsoft-Skype-Chain-ID"],r=i?" Chain-Id "+i:"";this.logger.info("Received request N "+t.id+r+" CV "+t.correlationVector+" to '"+t.url+"'"),t.startTS=Date.now(),t.url&&this.urlPath&&0===t.url.indexOf(this.urlPath)&&(t.shortUrl=t.url.substring(this.urlPath.length))}catch(e){var o=a.toJson(e.stack);return this.logger.error("unable to parse request. Error: "+o),this.connectionTracker.trackRequest(void 0,o),void this.connectionTracker.sendResponseError("unable to parse request, error: "+e)}t.timeoutTimerId=setTimeout(function(){if(!t.replied){n.logger.error("Request "+t.id+" timed out");var e=new s.ResponseData(t.id);e.status=504,e.headers={"Trouter-Responder":"ClientLib"},n.sendResponse(t,e),t.timedout=!0}},this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(t),this.fsm.onDownstreamRequest(t)}catch(e){this.logger.error("exception in socket.on message. Error: "+a.toJson(e.stack)),this.connectionTracker.sendResponseError(e.message,t,void 0)}},e.prototype.onTrouterConnected=function(e){if(this.allocateResult){this.logger.info("onTrouterConnected: "+this.allocateResult.url),this.socket&&this.socket.socket&&this.socket.socket.options&&this.socket.socket.options.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var t=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=a.calculateExpireTsInSec(e.ttl),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(t,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onTrouterConnected()}else this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set")},e.prototype.onTrouterReconnect=function(){this.logger.info("onTrouterReconnect"),this.fsm.onReconnectRequired()},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(e.droppedIndicators)},e.prototype.onAllocationResponse=function(e){this.logger.info("Received allocation response "+JSON.stringify(e)),this.allocateResult=e,this.externalConnectParams=void 0;var t=+e.ttl;if(this.connectionExpireTimestampInSecs=a.calculateExpireTsInSec(t),this.connectionId=this.allocateResult.id||"",this.connectedClientId=this.allocateResult.ccid,this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}"),this.c2cUrlBase=e.curlb||"",""===this.c2cUrlBase){var n=e.surl.indexOf("://");n>=0&&(n=e.surl.indexOf("/",n+3))>=5&&":3443"===e.surl.substr(n-5,5)&&(this.c2cUrlBase=e.surl.substr(0,n-5))}var r=i({reconnectUrl:e.socketio+"v4/a"},e.connectparams);this.manager.onSetConnectionCache(r),this.fsm.onAllocationSucceed()},e.prototype.onPingResponse=function(){this.logger.info("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];e.hasOwnProperty(r)&&void 0!==e[r]&&t.push(r+"="+e[r])}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.indexOf("ccid=")<0&&(n="ccid="+this.connectedClientId+"&"),this.domId&&(n+="dom="+this.domId+"&"),n.length>0&&(n=n.slice(0,-1));var i=t||-1!==e.indexOf("?")?"&":"?";return this.appendCorrelationIds(e+i+n,t)},e.prototype.appendCorrelationIds=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?""+e+n+"cor_id="+this.options.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionAttempt:e},e.prototype.getHealthUrl=function(e){return e.substring(0,e.lastIndexOf("/a"))+"/h"},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){if(e.timedout)return this.logger.error("Request "+e.id+" already timed out"),1;if(e.replied)return this.logger.error("Response for request "+e.id+" already sent"),2;clearTimeout(e.timeoutTimerId),e.timeoutTimerId=0,e.replied=!0,t.headers=t.headers||{};var n=e.correlationVector;this.logger.info("Sending response for request N "+e.id+" CV "+n+" with status "+t.status),n&&(t.headers[v]=n),e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var i=Date.now()-e.startTS;if(t.headers["trouter-client"]=a.toJson({cd:i}),this.logger.debug("response: "+a.toJson(t)),!this.socket)return this.connectionTracker.sendResponseError("no socket",e,t),4;try{return this.socket.send(a.toJson(t)),t.sentTS=Date.now(),e.incrementCorrelationVector(),this.connectionTracker.trackResponse(e,i,t),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(n){var r="unable to send data on response.end. Error: "+a.toJson(n.stack);return this.logger.error(r),this.connectionTracker.sendResponseError(r,e,t),4}},e.prototype.sendUserActivityStateMultiple=function(e){var t=this,n=new _("user.activity");n.args=this.createUserActivityObject(this.userActivityState),this.logger.debug("Sending user activity '"+u.UserActivityState[this.userActivityState]+"', remaining "+(e-1)),this.sendDownstreamEvent(n,function(){if(t.onDownstreamEventResponse(n),t.clearTimer(n.timeoutTimerId),e>1){var i=setTimeout(function(){t.clearTimer(i),t.sendUserActivityStateMultiple(e-1)},t.options.userActivitySecondResendDelayMs);t.registerTimer(i,"user.activity/resend")}}),n.timeoutTimerId=setTimeout(function(){t.logger.error("Activity state response timeout is fired"),t.fsm.onActivityStateResponseTimeout(),t.clearTimer(n.timeoutTimerId)},this.timeoutOptions.userActivityResponseTimeoutMs),this.registerTimer(n.timeoutTimerId,"user.activity/response")},e.prototype.sendDownstreamEvent=function(e,t){this.logger.info("Sending downstream event "+e.name),this.socket&&this.socket.emit(e.name,e.args,t)},e.prototype.onDownstreamEventResponse=function(e){this.logger.info("onDownstreamEventResponse("+e.name+")")},e.prototype.registerTimer=function(e,t){this.logger.debug("registering timer "+e+" -> "+t),this.pendingTimers[e]=t},e.prototype.clearTimer=function(e){var t=this.pendingTimers[e];this.logger.debug("clearing timer "+e+" -> "+t),delete this.pendingTimers[e],clearTimeout(e)},e.prototype.getRegistrationTtl=function(){var e=a.calculateTtlInSec(this.connectionExpireTimestampInSecs);return this.logger.debug("Current connectionID will expire in "+e+" seconds"),this.options.registration&&this.options.registration.registrarTtlSec&&e>0?Math.min(this.options.registration.registrarTtlSec,e):this.options.registration&&this.options.registration.registrarTtlSec?this.options.registration.registrarTtlSec:e>0?e:3600},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e.prototype.applyConnectionTrackerOptions=function(e){try{e.eventLogger&&"function"==typeof e.eventLogger.logEvent?(this.connectionTracker.mergeSettings(e.telemetrySettings),this.connectionTracker.enable(e.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.logger.warn("Trouter client event logging disabled. Error: "+a.toJson(e.stack)),this.connectionTracker.disable()}},e.prototype.createUserActivityObject=function(e){var t;switch(e){case u.UserActivityState.Active:t="active";break;case u.UserActivityState.Inactive:t="inactive";break;case u.UserActivityState.Unknown:t="unknown";break;default:t="undefined"}return{state:t}},e}();t.TrouterConnection=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(1),a=n(5),s=n(0);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.Connected=5]="Connected",e[e.UnregisteringRetrievingToken=6]="UnregisteringRetrievingToken",e[e.Unregistering=7]="Unregistering"}(i=t.State||(t.State={})),function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Registering=2]="Registering",e[e.Registered=3]="Registered",e[e.NotRegistered=4]="NotRegistered"}(r||(r={}));var c=function(){function e(e,t,n){this.worker=t,this.incallModeEnabled=n,this.state=i.Initial,this.connectionErrors=0,this.logger=new s.Logger("ConnectionFsm",e),this.connectedSubstate=r.Initial,this.userActivityState=o.UserActivityState.Unknown}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===i.Allocating||this.state===i.Connected||this.state===i.Handshaking||this.state===i.Connecting||this.state===i.RetrievingToken},e.prototype.start=function(){return this.state===i.Initial?(this.setState(i.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e){e&&(this.connectedSubstate=r.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.resetRegisterBackoff(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.state!==i.Connecting&&this.state!==i.Handshaking&&this.state!==i.Connected||this.worker.stopSocketIo(),this.isRegistered()?(this.setState(i.UnregisteringRetrievingToken),this.worker.stopRegisterTimer(),this.worker.getToken(!0,!1)):(this.setState(i.Initial),this.worker.dispatchDisconnected())},e.prototype.onTokenReceived=function(e){this.state===i.RetrievingToken?(this.setState(i.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(e)):this.state===i.Connected&&this.connectedSubstate===r.RetrievingToken?(this.connectedSubstate=r.Registering,this.worker.sendRegisterRequest()):this.state===i.UnregisteringRetrievingToken?(this.setState(i.Unregistering),this.worker.sendUnregisterRequest()):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e&&this.onPingInterval()},e.prototype.onAllocationSucceed=function(){return this.state===i.Allocating?(this.setState(i.Handshaking),this.connectedSubstate=r.Initial,this.worker.startSocketIo(),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e){this.state===i.Allocating?(this.setState(i.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!e,!0)):this.showIgnored("onAllocationFailed")},e.prototype.onConnectingTimeout=function(){this.state===i.Allocating||this.state===i.Connecting||this.state===i.Handshaking?(this.setState(i.RetrievingToken),this.resetAllocationIfNecessary(void 0),this.worker.stopSocketIo(),this.worker.getToken(!0,!1)):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===i.Handshaking?this.setState(i.Connecting):this.showIgnored("onConnecting")},e.prototype.onConnectingFailed=function(){this.state===i.Connecting?this.onConnectingTimeout():this.state===i.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.showIgnored("onConnectingFailed")},e.prototype.onSocketError=function(e){this.state===i.Handshaking||this.state===i.Connected?(this.worker.stopSocketIo(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopConnectionTimer(),this.state!==i.Connected&&this.worker.resetAllocationConnectionParams(),this.setState(i.RetrievingToken),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):this.showIgnored("onSocketError")},e.prototype.onTrouterConnected=function(){this.state===i.Connecting?(this.setState(i.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(a.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.connectionErrors=0,this.worker.shouldSkipRegistration()?(this.connectedSubstate=r.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(){this.worker.dispatchReconnectIsRequired()},e.prototype.onDownstreamRequest=function(e){this.state===i.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onTrouterMessageLost=function(e){this.state===i.Connected?this.worker.dispatchTrouterMessageLost(e):this.showIgnored("onTrouterMessageLost")},e.prototype.onPingInterval=function(){this.state===i.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===i.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(e){this.state===i.Connected&&this.connectedSubstate===r.Registering?(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!e,!0)):this.showIgnored("onRegistrationFailed")},e.prototype.onRegistrationSucceed=function(){this.state===i.Connected?(this.connectedSubstate===r.Registering&&(this.connectedSubstate=r.Registered,this.worker.dispatchRegistered()),this.worker.hasCustomRegisterTtl()&&this.worker.startRegisterTimer()):this.showIgnored("onRegistrationSucceed")},e.prototype.onRegistrationTimeout=function(){this.state===i.Connected&&this.connectedSubstate!==r.NotRegistered?(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored("onRegistrationTimeout")},e.prototype.onUnregistrationFailed=function(e){this.state===i.Unregistering?(this.setState(i.UnregisteringRetrievingToken),this.worker.getToken(!e,!e)):this.showIgnored("onUnregistrationFailed")},e.prototype.onUnregistrationSucceed=function(){this.state===i.Unregistering?(this.setState(i.Initial),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationSucceed")},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===i.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.onSetUserActivityState=function(e,t){t?(this.logger.info("Changing user activity state to '"+o.UserActivityState[e]+"'"),this.worker.sendUserActivityState(a.UserActivityEventReason.Modified,this.state===i.Connected)):this.logger.debug("Not changing the same user activity state '"+o.UserActivityState[e]+"'")},e.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},e.prototype.forceReconnect=function(){this.setState(i.RetrievingToken),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)},e.prototype.onMissedResponse=function(e){this.state===i.Connected?(this.setState(i.RetrievingToken),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):this.showIgnored(e)},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '"+e+"' in state '"+i[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+i[this.state]+"' to state '"+i[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+i[e]+"'")},e.prototype.resetAllocationIfNecessary=function(e){this.connectionErrors++,this.connectionErrors>=2||void 0!==e&&/^4\d\d /.test(e)?(this.logger.error("Connection error count is "+this.connectionErrors+" - will reset allocation"),this.connectionErrors=0):this.logger.info("Connection error count is "+this.connectionErrors+" - will NOT reset allocation")},e.prototype.isRegistered=function(){return this.connectedSubstate===r.Registered||this.connectedSubstate===r.Registering},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e}();t.TrouterFsm=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=function(){function e(e,t){this.worker=t,this.state=i.TrouterState.Unknown,this.logger=new r.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===i.TrouterState.Unknown?(this.setState(i.TrouterState.Disconnected),this.worker.startFirstConnection()):this.showIgnored("start")},e.prototype.stop=function(){this.state!==i.TrouterState.Unknown?(this.setState(i.TrouterState.Unknown),this.worker.stopFirstConnection(!1),this.worker.stopSecondConnection(!1)):this.showIgnored("stop")},e.prototype.getState=function(){return this.state},e.prototype.onConnected=function(e){this.state===i.TrouterState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(i.TrouterState.Switching):(this.setState(i.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected("+e+")")},e.prototype.onRegistered=function(e){this.state!==i.TrouterState.Disconnected||e?this.state!==i.TrouterState.Switching||e?this.showIgnored("onRegistered("+e+")"):(this.setState(i.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(i.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected())},e.prototype.onReconnecting=function(e){this.state===i.TrouterState.Connected&&e?(this.setState(i.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.state===i.TrouterState.Switching&&e?(this.setState(i.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored("onReconnecting("+e+")")},e.prototype.onReconnectionRequired=function(e){this.state===i.TrouterState.Connected&&e?(this.setState(i.TrouterState.Switching),this.worker.startSecondConnection()):this.state===i.TrouterState.Disconnected&&e?this.worker.startSecondConnection():this.showIgnored("onReconnectionRequired("+e+")")},e.prototype.onDisconnected=function(e){this.state===i.TrouterState.Unknown&&e?this.worker.dispatchStopped():this.showIgnored("onDisconnected("+e+")")},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '"+e+"' in state '"+i.TrouterState[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+i.TrouterState[this.state]+"' to state '"+i.TrouterState[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+i.TrouterState[e]+"'")},e}();t.TrouterManagerFsm=o},function(e,t,n){"use strict";function i(e,t){return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:function(e,t){if(!t)return e;var n=r({},e,{enabled:t.TelemetryEnabled});return void 0!==t.ClientTelemetryEventEnabled&&(n=r({},n,t.ClientTelemetryEventEnabled)),n}(e.telemetryConfig.settings,t),eventLogger:e.telemetryConfig.eventLogger,endpointId:e.trouterSettings.registrationId,trouterUrl:t&&t.TrouterConnectionUrl||e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:e.trouterSettings.registrationId||"",pnhAppId:e.trouterSettings.pnhAppId||"",platform:e.trouterSettings.platform||"",pnhTemplateKey:e.trouterSettings.pnhTemplate||"",platformUIVersion:e.trouterSettings.platformUIVersion||"",productContext:e.trouterSettings.pnhProductContext||void 0,context:e.trouterSettings.pnhContext||"",registrarTtlSec:(e.trouterSettings.maxRegistrationTimeInMs||0)/1e3}:void 0,timeoutOptions:r({connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.timeoutOptions),incallTimeoutOptions:r({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:e.trouterSettings.incallModeTimeoutMs||0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:e.trouterSettings.userActivitySecondResendDelayMs||1e4,connectionCache:e.connectionCache}}var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(a=(a=c.trys).length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),c=n(1);t.TrouterState=c.TrouterState,t.UserActivityState=c.UserActivityState;var l=n(0),u=n(6),d=n(7),p=n(8),f=n(9),h=function(){function e(e){this.logProvider=e,this.stateChangedListeners=[],this.logger=new l.Logger("Trouter",e),this.trouterUrlPromise=new f.TrouterUrlPromise(e),this.messageHandlers=new u.MessageHandlerRegistry(e),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version "+s.CLIENT_VERSION)}return e.prototype.start=function(e){if(this.logger.info("Start"),!e.trouterSettings.disableInternalSkypeTokenCache){var t=e.skypeTokenProvider;e.skypeTokenProvider=d.addCacheAsBackupTo(t)}this.trouterCfg=e;var n=i(e,this.ecsCfg);void 0===this.trouterServer&&(this.trouterServer=new p.TrouterManager(this.logProvider,n,e.skypeTokenProvider,this)),this.trouterServer.start()},e.prototype.stop=function(){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop()},e.prototype.setEcsConfig=function(e){return o(this,void 0,void 0,function(){var t=this;return a(this,function(n){return[2,new Promise(function(n,r){if(t.ecsCfg=e.TrouterJScriptClient,t.logger.info("Setting ECS configuration to "+JSON.stringify(t.ecsCfg)),void 0!==t.trouterServer&&void 0!==t.trouterCfg){var o=i(t.trouterCfg,t.ecsCfg);t.trouterServer.configure(o)}n()})]})})},e.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(e||!1)},e.prototype.resendRegistration=function(){return o(this,void 0,void 0,function(){return a(this,function(e){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]})})},e.prototype.registerListener=function(e,t){return""===t||"/"!==t[0]||t.indexOf("?")>=0||t.indexOf("#")>=0?(this.logger.error("Listener path '"+t+"' is not valid"),!1):this.listeners[t]?(this.logger.error("Another listener is already registered for path '"+t+"'"),!1):(this.listeners[t]=e,this.logger.debug("Listener for path '"+t+"' registered"),this.connectionInfo&&e.onTrouterConnected(this.connectionInfo.baseEndpointUrl+t,this.connectionInfo),!0)},e.prototype.unregisterListener=function(e){for(var t=[],n=0,i=Object.keys(this.listeners);n<i.length;n++){var r=i[n];this.listeners[r]===e&&t.push(r)}if(0===t.length)return!1;for(var o=0,a=t;o<a.length;o++){var r=a[o];delete this.listeners[r]}return this.logger.debug("Listener for path(s) '"+t.join("', '")+"' unregistered"),!0},e.prototype.onTrouterConnected=function(e,t){this.logger.debug("Trouter is now connected");for(var n=0,i=Object.keys(this.listeners);n<i.length;n++){var r=i[n];try{this.listeners[r].onTrouterConnected(t.baseEndpointUrl+r,t)}catch(e){this.logger.error("Listener '"+r+"' threw an exception from onTrouterConnected(): "+e)}}this.connectionInfo=t,this.trouterUrlPromise.resolveUrl(e),this.notifyStateChanged(c.TrouterState.Connected,{url:e,getRemainingTtlInSec:function(){return t.connectionTtlSec}})},e.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var e=0,t=Object.keys(this.listeners);e<t.length;e++){var n=t[e],i=this.listeners[n];if(i.onTrouterDisconnected)try{i.onTrouterDisconnected()}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterDisconnected(): "+e)}}this.notifyStateChanged(c.TrouterState.Disconnected)},e.prototype.onTrouterRequest=function(e,t){for(var n="",i=0,r=Object.keys(this.listeners);i<r.length;i++){var o=r[i];e.path.substring(0,o.length)===o&&o.length>n.length&&(n=o)}if(""===n)this.tryMessageHandlers(e,t)||(t.status=404,t.headers={"Trouter-Responder":"ClientLib"},t.send());else try{this.listeners[n].onTrouterRequest(e,t)}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterRequest(): "+e),t.status=500,t.headers={"Trouter-Responder":"ClientLib"},t.send()}},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss called with value "+e);for(var t=!0,n=0,i=Object.keys(this.listeners);n<i.length;n++){var r=i[n],o=this.listeners[r];if(o.onTrouterMessageLoss)try{void 0===(t=o.onTrouterMessageLoss(e)&&t)&&(this.logger.error("Listener '"+r+"' did not response with boolean value onTrouterMessageLoss()"),t=!1)}catch(e){this.logger.error("Listener '"+r+"' threw an exception from onTrouterMessageLoss(): "+e),t=!1}}return t},e.prototype.setUserActivityState=function(e){if(e!==c.UserActivityState.Active&&e!==c.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value "+e);if(this.logger.info("setUserActivityState called with value "+c.UserActivityState[e]),!this.trouterServer||this.state()===c.TrouterState.Unknown)throw new Error("setUserActivityState called too early");this.trouterServer.setUserActivityState(e)},e.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():c.TrouterState.Unknown},e.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){if(this.logger.info("onStateChanged called"),void 0===e)this.stateChangedListeners=this.stateChangedListeners.filter(function(e){return void 0===e.wrappedCallback});else{this.offStateChanged(e);var t=function(t,n){e(t,n?n.url:"")};t.wrappedCallback=e,this.stateChangedListeners.push(t)}},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter(function(t){return t.wrappedCallback!==e}),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to "+this.stateChangedListeners.length+" listeners"),this.stateChangedListeners.forEach(function(i){try{i(e,t)}catch(e){n.logger.error("Error in callback "+e)}})},e.prototype.tryMessageHandlers=function(e,t){if(!this.messageHandlers.active())return!1;var n,i=null;try{n=JSON.parse(e.body),i=n&&(n.evt||n.eventId)||null}catch(e){}var r={eventId:i,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+e.path,body:n,rawBody:e.body,headers:e.headers},o=this.messageHandlers.handleMessage(r);return!!o.isHandled&&(t.status=o.resultCode,o.responseHeaders&&(t.headers=o.responseHeaders),o.responseBody&&(t.body=o.responseBody),t.send(),!0)},e}();t.TrouterService=h,t.createTrouterService=function(e){return new h(e)},t.getTrouterServiceVersion=function(){return s.CLIENT_VERSION},t.replaceTrouterUrlBase=function(e,t){var n=e.indexOf("://");if(n>=0){var i=e.indexOf("/",n+3);if(i>=0)return t+e.substr(i)}return""}}])}(__webpack_require__(72))},function(e,t,n){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";var i=n(86);e.exports=function(e,t,n,r,o){var a=new Error(e);return i(a,t,n,r,o)}},function(e,t,n){"use strict";var i=n(0),r=n(87),o=n(85),a=n(84),s=n(83),c=n(43),l="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||n(82);e.exports=function(e){return new Promise(function(t,u){var d=e.data,p=e.headers;i.isFormData(d)&&delete p["Content-Type"];var f=new XMLHttpRequest,h="onreadystatechange",g=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in f||s(e.url)||(f=new window.XDomainRequest,h="onload",g=!0,f.onprogress=function(){},f.ontimeout=function(){}),e.auth){var m=e.auth.username||"",v=e.auth.password||"";p.Authorization="Basic "+l(m+":"+v)}if(f.open(e.method.toUpperCase(),o(e.url,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f[h]=function(){if(f&&(4===f.readyState||g)&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in f?a(f.getAllResponseHeaders()):null,i={data:e.responseType&&"text"!==e.responseType?f.response:f.responseText,status:1223===f.status?204:f.status,statusText:1223===f.status?"No Content":f.statusText,headers:n,config:e,request:f};r(t,u,i),f=null}},f.onerror=function(){u(c("Network Error",e,null,f)),f=null},f.ontimeout=function(){u(c("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",f)),f=null},i.isStandardBrowserEnv()){var y=n(81),S=(e.withCredentials||s(e.url))&&e.xsrfCookieName?y.read(e.xsrfCookieName):void 0;S&&(p[e.xsrfHeaderName]=S)}if("setRequestHeader"in f&&i.forEach(p,function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete p[t]:f.setRequestHeader(t,e)}),e.withCredentials&&(f.withCredentials=!0),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){f&&(f.abort(),u(e),f=null)}),void 0===d&&(d=null),f.send(d)})}},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},function(e,t,n){"use strict";
/*!
 *  Appenders.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(19),a=n(28),s=function(){function e(e){this._formatter=e||new u}return e.prototype.formatter=function(){return this._formatter},e.prototype.receiveAll=function(){return!1},e.prototype.levels=function(){return null},e}();function c(e){return(4294967296+e).toString(16).substr(-8)}function l(e,t){return(1e12+e).toString(10).substr(-t)}t.AbstractLogAppender=s,function(e){e[e.Timestamp=1]="Timestamp",e[e.Component=4]="Component",e[e.Level=8]="Level",e[e.FullDate=32]="FullDate",e[e.LogId=64]="LogId"}(r=t.SLF_Flags||(t.SLF_Flags={}));var u=function(){function e(e){void 0===e&&(e=4294967295),this._flags=e}return e.prototype.format=function(e,t,n,i){var s="";if(this._flags&r.FullDate)s+=new Date(e.timestamp).toISOString()+" ";else if(this._flags&r.Timestamp){var u=new Date(e.timestamp);s+=l(u.getHours(),2)+":"+l(u.getMinutes(),2)+":"+l(u.getSeconds(),2)+"."+l(u.getMilliseconds(),2)+" "}return this._flags&r.LogId&&(s+="[#"+c(t)+"-"+(e.component.safe()?"S":"u")+"] "),this._flags&r.Level&&(s+="["+a.LogFactory.levelToString(e.level)+"] "),this._flags&r.Component&&(s+="["+e.component.name()+"] "),n||""===n?s+o.vsprintf(n,i):s+c(t)+": "+i.join(" ")},e}();t.StandardLogFormatter=u;var d=console,p=console.log||function(){},f=console.info||p,h=console.warn||f,g=console.error||h,m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.log=function(e,t,n,i){i=i.slice(0);var r=e.level<=o.LogLevel.Debug3?p:e.level<=o.LogLevel.Debug1?f:e.level<=o.LogLevel.Warning?h:g;if(-1===t){var a=this.formatter().format(e,t,"",[]);"string"==typeof i[0]&&(a+=i.shift()),r.apply(d,[a].concat(i))}else{for(var s=void 0,c=[];s=n.match(/\s*%@\s*$/);)n=n.substr(0,n.length-s[0].length),c.unshift(i.pop());a=this.formatter().format(e,t,n,i);r.apply(d,[a].concat(c))}},t}(s);t.ConsoleAppender=m;var v=function(){function e(e){this._chained=e}return e.prototype.log=function(e,t,n,i){this._chained.log(e,t,n,i)},e.prototype.receiveAll=function(){return this._chained.receiveAll()},e.prototype.levels=function(){return this._chained.levels()},e}();t.ChainedLogAppender=v;var y=function(e){function t(t,n){var i=e.call(this,t)||this;return i._levels=n,i}return i(t,e),t.prototype.levels=function(){return this._levels},t}(v);t.wrapAppenderWithLogLevels=function(e,t){return new y(e,t)}},function(e,t,n){window,e.exports=function(e,t,n,i){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=132)}([function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);function o(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function a(e){return e?e.toString===Object.prototype.toString?JSON.stringify(e):e.toString():""}t.forOwn=o,t.forOwnRec=function e(t,n){for(var i in t)t.hasOwnProperty(i)&&("object"==typeof t[i]?e(t[i],n):n(t[i],i,t))},t.average=function(e){var t=0;return e.forEach(function(e){return t+=e}),t/=e.length},t.find=function(e,t){var n;return e.some(function(i,r){return!!t(i,r,e)&&(n=i,!0)}),n},t.findIndex=function(e,t){var n;return e.some(function(i,r){return!!t(i,r,e)&&(n=r,!0)}),n},t.remove=function(e,t){for(var n=!1,i=e.length;i-- >0;)t(e[i],i,e)&&(e.splice(i,1),n=!0);return n},t.compareArraysBy=function(e,t,n){var i=[];return e.forEach(function(e){t.some(function(t){return n(e,t)})||i.push(e)}),0==i.length&&e.length===t.length},t.values=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},t.assign=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},t.isEmpty=function(e){return!Object.keys(e).length},t.keys=function(e){return Object.keys(e)},t.shallowClone=function(e){var t={};return o(e,function(e,n){t[n]=e}),t},t.deepClone=function e(t){var n;if(!t||"object"!=typeof t)return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array){n=[];for(var i=0,r=t.length;i<r;i++)n[i]=e(t[i]);return n}if(t instanceof Object)return n={},o(t,function(t,i){n[i]=e(t)}),n;throw new Error("Unable to copy: "+t)},t.uniqueId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+e()+"4"+e().substring(1)+"b"+e().substring(1)+e()+e()+e()},t.deepEqual=function e(t,n){var i,r=typeof t;if(t===n)return!0;if(r!==typeof n||"object"!==r&&"function"!==r)return!1;if(null===t||null===n)return t===n;if(t instanceof Date&&n instanceof Date)return+t==+n;if(t instanceof Map&&n instanceof Map)return function(e,t){var n;if(e.size!==t.size)return!1;var i=!0;return e.forEach(function(e,r){((n=t.get(r))!==e||void 0===n&&!t.has(r))&&(i=!1)}),i}(t,n);for(i in t)if(!(i in n&&e(t[i],n[i])))return!1;for(i in n)if(!(i in t&&e(t[i],n[i])))return!1;return!0},t.weakCompareObject=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},t.getMaxSubstring=function(e,t){return t.reduce(function(t,n){var i=e.includes(n)?n.length:0;return t.length<i?n:t},"")},t.throwIfNotSupported=function(e,t){if(-1===t.indexOf(e))throw{detail:e+" mediaContent.contentType is not supported",type:r.default.MEDIA_ERROR.incompatibleOffer}},t.throwIfFeatureNotSupported=function(e,t){e.forEach(function(e){if(""!==e&&-1!==t.findIndex(function(t){return t===e}))throw{detail:"Required feature '"+e+"' is not acceptable.",type:r.default.MEDIA_ERROR.incompatibleOffer}})},t.stringifyObject=a,t.noop=Function.prototype,t.mapToString=function(e){var t={};return e.forEach(function(e,n){t[n.toString()]=e}),JSON.stringify(t)},t.getClosestValue=function(e,t,n,i){void 0===i&&(i=0);for(var r=1;r<e.length;r++)if(e[r-1]+i<t&&t<=e[r]+i)return n?e[r]:e[r-1];return e[0]},t.isInRange=function(e,t,n){return t<=e&&e<=n},t.getFrom=function(e){for(var t,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];try{for(var a=i(r),s=a.next();!s.done;s=a.next()){var c=s.value;if(c.hasOwnProperty(e))return c[e]}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},t.subtractFrom=function(e,t){return e.filter(function(e){return!t.some(function(t){return t===e})})},t.getLongestCommonContiguousSubstring=function(e,t){if(e===t)return e;for(var n=0,i=0,r="",o=0;o<e.length&&!(r.length>e.length-o);o++){var a=o;i-n>r.length&&(r=e.substring(n,i),o=i-1),n=o,i=o;for(var s=0;s<t.length;s++)a<e.length&&t[s]===e[a++]?i=a:(a=o,i-n>r.length&&(r=e.substring(n,i),o=i-1),n=o,i=o)}return r},t.levenshteinDistance=function(e,t){for(var n=new Array(e.length+1),i=0;i<e.length+1;i++){n[i]=new Array(t.length+1);for(var r=0;r<t.length+1;r++)n[i][r]=0}for(i=1;i<e.length+1;i++)n[i][0]=i;for(i=1;i<t.length+1;i++)n[0][i]=i;for(i=1;i<e.length+1;i++)for(r=1;r<t.length+1;r++){var o=1;e[i-1]===t[r-1]&&(o=0),n[i][r]=Math.min(n[i-1][r]+1,n[i][r-1]+1,n[i-1][r-1]+o)}return n[e.length][t.length]},t.getAvarageVolume=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return Math.round(t/e.length)},t.scrubDeviceLabelPii=function(e,t){if(""===e)return"";if(e.length<3)return e;var n=[],i=e.match(/\(([0-9a-fA-F]+:[0-9a-fA-F]+)\)/);i&&n.push(i[1]);var r=e.match(/\((\w+)\)/);r&&n.push(r[1]);try{for(var o=new RegExp("("+t.join("|")+")","gi"),s=o.exec(e);s;)n.push(s[1]),s=o.exec(e)}catch(e){n.push("Error: "+a(e))}return 0===n.length?"unknown":n.join(" ")}},function(e,t,n){"use strict";n.d(t,"b",function(){return S}),n.d(t,"a",function(){return _});var i=n(10),r=n(5),o=(i.f,null),a=!1,s=123456789,c=987654321;function l(e){e<0&&(e>>>=0),s=123456789+e&4294967295,c=987654321-e&4294967295,a=!0}function u(){l(4294967296*Math.random()^(new Date).getTime())}function d(e,t){return typeof e===t}function p(e){return d(e,i.f)||void 0===e}function f(e){return p(e)||null===e}function h(e,t){return e&&Object[i.e].hasOwnProperty.call(e,t)}function g(e){return d(e,i.d)}function m(e){return d(e,i.c)}function v(e,t,n,i){void 0===i&&(i=!1);var r=!1;if(!f(e))try{f(e.addEventListener)?f(e.attachEvent)||(e.attachEvent("on"+t,n),r=!0):(e.addEventListener(t,n,i),r=!0)}catch(e){}return r}function y(e,t,n,i){if(void 0===i&&(i=!1),!f(e))try{f(e.removeEventListener)?f(e.detachEvent)||e.detachEvent("on"+t,n):e.removeEventListener(t,n,i)}catch(e){}}function S(e,t){if(e&&g(e))for(var n in e)h(e,n)&&t.call(e,n,e[n])}var _=function(){function e(){}return e.isDate=function(e){return"[object Date]"===Object[i.e].toString.call(e)},e.isArray=function(e){return"[object Array]"===Object[i.e].toString.call(e)},e.isError=function(e){return"[object Error]"===Object[i.e].toString.call(e)},e.isString=function(e){return d(e,"string")},e.isNumber=function(e){return d(e,"number")},e.isBoolean=function(e){return d(e,"boolean")},e.disableCookies=function(){e._canUseCookies=!1},e.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(E,function(t){var n=0|e.randomValue(15);return("x"===t?n:3&n|8).toString(16)})},e.toISOString=function(t){if(e.isDate(t)){var n=function(e){var t=String(e);return 1===t.length&&(t="0"+t),t};return t.getUTCFullYear()+"-"+n(t.getUTCMonth()+1)+"-"+n(t.getUTCDate())+"T"+n(t.getUTCHours())+":"+n(t.getUTCMinutes())+":"+n(t.getUTCSeconds())+"."+String((t.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}},e.arrForEach=function(e,t,n){for(var i=e.length,r=0;r<i;r++)r in e&&t.call(n||e,e[r],r,e)},e.arrIndexOf=function(e,t,n){for(var i=e.length,r=n||0,o=Math.max(r>=0?r:i-Math.abs(r),0);o<i;o++)if(o in e&&e[o]===t)return o;return-1},e.arrMap=function(e,t,n){for(var i=e.length,r=n||e,o=new Array(i),a=0;a<i;a++)a in e&&(o[a]=t.call(r,e[a],e));return o},e.arrReduce=function(e,t,n){var i,r=e.length,o=0;if(arguments.length>=3)i=arguments[2];else{for(;o<r&&!(o in e);)o++;i=e[o++]}for(;o<r;)o in e&&(i=t(i,e[o],o,e)),o++;return i},e.strTrim=function(t){return e.isString(t)?t.replace(/^\s+|\s+$/g,""):t},e.objKeys=function(e){var t=!{toString:null}.propertyIsEnumerable("toString");if(!(m(e)||g(e)&&null!==e))throw new TypeError("objKeys called on non-object");var n=[];for(var i in e)h(e,i)&&n.push(i);if(t)for(var r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=r.length,a=0;a<o;a++)h(e,r[a])&&n.push(r[a]);return n},e.objDefineAccessors=function(e,t,n,i){var r=Object.defineProperty;if(r)try{var o={enumerable:!0,configurable:!0};return n&&(o.get=n),i&&(o.set=i),r(e,t,o),!0}catch(e){}return!1},e.addEventHandler=function(e,t){var n=!1,i=Object(r.k)();i&&(n=v(i,e,t),n=v(i.body,e,t)||n);var o=Object(r.c)();return o&&(n=T.Attach(o,e,t)||n),n},e.dateNow=function(){var e=Date;return e.now?e.now():(new e).getTime()},e.perfNow=function(){var t=Object(r.j)();return t&&t.now?t.now():e.dateNow()},e.newId=function(t){void 0===t&&(t=22);for(var n=e.random32()>>>0,i=0,r="";r.length<t;)i++,r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&n),n>>>=6,5===i&&(n=(e.random32()<<2&4294967295|3&n)>>>0,i=0);return r},e.isIE=function(){if(null===o){var e=((Object(r.i)()||{}).userAgent||"").toLowerCase();o=-1!==e.indexOf("msie")||-1!==e.indexOf("trident/")}return o},e.randomValue=function(t){return t>0?Math.floor(e.random32()/4294967295*(t+1))>>>0:0},e.random32=function(t){var n,i=Object(r.b)()||Object(r.h)();return i&&i.getRandomValues?n=4294967295&i.getRandomValues(new Uint32Array(1))[0]:e.isIE()?(a||u(),n=4294967295&e.mwcRandom32()):n=Math.floor(4294967296*Math.random()|0),t||(n>>>=0),n},e.mwcRandomSeed=function(e){e?l(e):u()},e.mwcRandom32=function(e){var t=((c=36969*(65535&c)+(c>>16)&4294967295)<<16)+(65535&(s=18e3*(65535&s)+(s>>16)&4294967295))>>>0&4294967295|0;return e||(t>>>=0),t},e.generateW3CId=function(){for(var t,n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],i="",r=0;r<4;r++)i+=n[15&(t=e.random32())]+n[t>>4&15]+n[t>>8&15]+n[t>>12&15]+n[t>>16&15]+n[t>>20&15]+n[t>>24&15]+n[t>>28&15];var o=n[8+(3&e.random32())|0];return i.substr(0,8)+i.substr(9,4)+"4"+i.substr(13,3)+o+i.substr(16,3)+i.substr(19,12)},e.isTypeof=d,e.isUndefined=p,e.isNullOrUndefined=f,e.hasOwnProperty=h,e.isFunction=m,e.isObject=g,e.objCreate=i.b,e}(),E=/[xy]/g,T=function(){function e(){}return e.Attach=v,e.AttachEvent=v,e.Detach=y,e.DetachEvent=y,e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={MEDIA_STATE:{send:"sendonly",receive:"recvonly",sendReceive:"sendrecv",inactive:"inactive"},MEDIA_DIRECTION:{SEND:"send",RECV:"recv"},MEDIA_DEVICE_KIND:{audioInput:"audioinput",audioOutput:"audiooutput",videoInput:"videoinput",compositeAudio:"compositeAudio"},MEDIA_DEVICE:{camera:"camera",microphone:"microphone",speaker:"speaker",compositeAudio:"compositeAudio",defaultId:"default",communicationsId:"communications",defaultDeviceLabel:"Default"},MEDIA_ERROR:{constraintNotSatisfiedError:"ConstraintNotSatisfiedError",iceConnectionError:"iceConnectionError",srtpError:"srtpError",permissionDeniedError:"permissionDeniedError",internalError:"internalError",sourceUnavailableError:"SourceUnavailableError",devicesNotFoundError:"DevicesNotFoundError",noDeviceSelected:"noDeviceSelected",noNetworkError:"noNetworkError",incompatibleOffer:"IncompatibleOffer",mediaStreamRequestError:"MediaStreamRequestError",extensionNotFoundError:"ExtensionNotFoundError",sharingCancelledError:"SharingCancelledError",permissionDeniedBySystemError:"PermissionsDeniedBySystem",chromeRuntimeNotDefinedError:"ChromeRuntimeNotDefinedError",mediaStreamRequestTimedOut:"MediaStreamRequestTimedout"},HISTOGRAM_BATCH:{seconds1to3:2,seconds3to5:4,seconds5to8:7,seconds8to15:14,seconds15to60:59,seconds60toMax:1e6},RENEGOTIATION_ERROR:{local:"local",glare:"glare",signaling:"signaling",media:"media",escalation:"escalation"},MSI:{unsubscribe:-1,subscribeAny:-2},MEDIA_LABEL:{audio:"main-audio",video:"main-video",sharing:"applicationsharing-video",data:"data"},MEDIA_TYPE:{audio:"audio",video:"video",sharing:"sharing",data:"x-data",dataChannel:"application"},MODALITY:{audio:"audio",video:"video",sharing:"sharing",data:"data"},ICE_TRANSPORT_POLICY:{all:"all",relay:"relay"},EXTENSION_TYPE:{dominantSpeakerHistory:"dominantSpeakerHistory",videoStreamControl:"videoStreamControl"},RENDERER_TYPE:{video:"video",sharing:"sharing"},CONTENT_TYPE:{SDP:"application/sdp"},ALLOWED_CONTENT_TYPES:{SDP_ONLY:["application/sdp"],SDP_NGC:["application/sdp","application/sdp-ngc-0.5","application/sdp-ngc-1.0"]},STREAMING_STATE:{created:"created",started:"started",active:"active",inactive:"inactive",stopped:"stopped",removed:"removed",failed:"failed"},TIME_INTERVAL:{SEC_1:1},DISPLAY_SOURCE_ID:"display",SYSTEM_AUDIO_SOURCE_ID:"system",MULTIPLE_RECV_STREAMS:"multipleVideoStreams",PROFILES:{udpTlsRtpSavpf:"UDP/TLS/RTP/SAVPF",rtpSavpf:"RTP/SAVPF",rtpSavp:"RTP/SAVP",udpDtlsSctp:"UDP/DTLS/SCTP"},REPORTING_PROFILE:{RT_PROFILE:"REAL_TIME",BE_PROFILE:"BEST_EFFORT",NRT_PROFILE:"NEAR_REAL_TIME"},PAYLOAD_TYPE:{DATA_CHANNEL:"webrtc-datachannel"},VIDEO_CAPABILITIES:{MAX_FS_PATH:"max-fs",MAX_MBPS_PATH:"max-mbps",MAX_FPS_PATH:"max-fps",MAX_BR_PATH:"max-br",SSRC_PATH:"ssrc",KEYFRAME_PATH:"KeyFrame",MAX_WIDTH:"max-width",MAX_HEIGHT:"max-height"}}},function(e,t,n){"use strict";n.r(t),n.d(t,"Version",function(){return c}),n.d(t,"FullVersionString",function(){return l}),n.d(t,"strUndefined",function(){return u}),n.d(t,"strObject",function(){return d}),n.d(t,"arrForEach",function(){return E}),n.d(t,"arrIndexOf",function(){return T}),n.d(t,"arrMap",function(){return C}),n.d(t,"arrReduce",function(){return I}),n.d(t,"objKeys",function(){return A}),n.d(t,"toISOString",function(){return b}),n.d(t,"isReactNative",function(){return R}),n.d(t,"isString",function(){return O}),n.d(t,"isNumber",function(){return P}),n.d(t,"isBoolean",function(){return N}),n.d(t,"isFunction",function(){return M}),n.d(t,"isArray",function(){return w}),n.d(t,"isObject",function(){return D}),n.d(t,"strTrim",function(){return L}),n.d(t,"isDocumentObjectAvailable",function(){return k}),n.d(t,"isWindowObjectAvailable",function(){return x}),n.d(t,"isValueAssigned",function(){return F}),n.d(t,"getTenantId",function(){return U}),n.d(t,"isBeaconsSupported",function(){return j}),n.d(t,"isUint8ArrayAvailable",function(){return H}),n.d(t,"isLatency",function(){return B}),n.d(t,"sanitizeProperty",function(){return G}),n.d(t,"getISOString",function(){return V}),n.d(t,"useXDomainRequest",function(){return W}),n.d(t,"getCommonSchemaMetaData",function(){return q}),n.d(t,"cookieAvailable",function(){return K}),n.d(t,"disallowsSameSiteNone",function(){return z}),n.d(t,"setCookie",function(){return J}),n.d(t,"deleteCookie",function(){return Y}),n.d(t,"getCookie",function(){return Q}),n.d(t,"createGuid",function(){return X}),n.d(t,"extend",function(){return $}),n.d(t,"getTime",function(){return Z}),n.d(t,"isValueKind",function(){return te}),n.d(t,"isArrayValid",function(){return ne}),n.d(t,"objDefineAccessors",function(){return ie}),n.d(t,"addPageUnloadEventListener",function(){return re}),n.d(t,"setProcessTelemetryTimings",function(){return oe}),n.d(t,"addEventHandler",function(){return ae}),n.d(t,"getCrypto",function(){return se}),n.d(t,"objForEachKey",function(){return ce}),n.d(t,"getFieldValueType",function(){return le}),n.d(t,"strEndsWith",function(){return ue});var i,r=n(10),o=n(13),a=n(1),s=n(5),c="3.0.1",l="1DS-Web-JS-"+c,u="undefined",d="object",p=((i={})[0]=o.c.Unspecified,i[2]=o.c.Double,i[1]=o.c.String,i[3]=o.c.Bool,i[4098]=o.c.Double,i[4097]=o.c.String,i[4099]=o.c.Bool,i),f=null,h=a.a.isUndefined,g=a.a.isNullOrUndefined;function m(e){return!h(e)}var v,y=a.a.hasOwnProperty,S=null,_=null,E=a.a.arrForEach,T=a.a.arrIndexOf,C=a.a.arrMap,I=a.a.arrReduce,A=a.a.objKeys,b=a.a.toISOString,R=s.n,O=a.a.isString,P=a.a.isNumber,N=a.a.isBoolean,M=a.a.isFunction,w=a.a.isArray,D=a.a.isObject,L=a.a.strTrim,k=Boolean(Object(s.c)()),x=Boolean(Object(s.k)());function F(e){return!(g(e)||""===e)}function U(e){if(e){var t=e.indexOf("-");if(t>-1)return e.substring(0,t)}return""}function j(){return null===S&&(S=Object(s.m)()&&Boolean(Object(s.i)().sendBeacon)),S}function H(){return null===_&&(_=m(Uint8Array)&&!function(){var e=Object(s.i)();if(m(e)&&e.userAgent){var t=e.userAgent.toLowerCase();if((t.indexOf("safari")>=0||t.indexOf("firefox")>=0)&&t.indexOf("chrome")<0)return!0}return!1}()&&!R()),_}function B(e){return!!(e&&P(e)&&e>=1&&e<=3)}function G(e,t,n){if(!O(e)||g(t)||""===t)return null;if(O(t)||P(t)||N(t)||w(t))t={value:t};else if("object"!=typeof t||t.hasOwnProperty("value")){if(g(t.value)||""===t.value||!O(t.value)&&!P(t.value)&&!N(t.value)&&!w(t.value))return null}else t={value:n?JSON.stringify(t):t};if(w(t.value)&&!ne(t.value))return null;if(!g(t.kind)){if(w(t.value)||!te(t.kind))return null;t.value=t.value.toString()}return t}function V(e){return e.getUTCFullYear()+"-"+ee(e.getUTCMonth()+1)+"-"+ee(e.getUTCDate())+"T"+ee(e.getUTCHours())+":"+ee(e.getUTCMinutes())+":"+ee(e.getUTCSeconds())+"."+function(e){return e<10?"00"+e:e<100?"0"+e:e.toString()}(e.getUTCMilliseconds())+"Z"}function W(){if(void 0!==typeof XMLHttpRequest){var e=Object(s.e)("XMLHttpRequest");if(e){var t=new e;return Boolean(h(t.withCredentials)&&void 0!==typeof XDomainRequest)}}}function q(e,t,n){var i=-1;if(!h(e))if(t>0&&(32===t?i=8192:t<=13&&(i=t<<5)),function(e){return!!(P(e)&&e>=0&&e<=9)}(n))-1===i&&(i=0),i|=n;else{var r=p[le(e)]||-1;-1!==i&&-1!==r?i|=r:r===o.c.Double&&(i=r)}return i}function K(){if(void 0===v){v=!1;try{var e=Object(s.c)(),t=Object(s.i)();e&&!h(e.cookie)&&t&&t.cookieEnabled&&(v=!0)}catch(e){}}return v}function z(e){return!!O(e)&&(-1!==e.indexOf("CPU iPhone OS 12")||-1!==e.indexOf("iPad; CPU OS 12")||-1!==e.indexOf("Macintosh; Intel Mac OS X 10_14")&&-1!==e.indexOf("Version/")&&-1!==e.indexOf("Safari")||!(-1===e.indexOf("Macintosh; Intel Mac OS X 10_14")||!ue(e,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))||-1!==e.indexOf("Chrome/5")||-1!==e.indexOf("Chrome/6")||-1!==e.indexOf("UnrealEngine")&&-1===e.indexOf("Chrome")||-1!==e.indexOf("UCBrowser/12")||-1!==e.indexOf("UCBrowser/11"))}function J(e,t,n){if(K()){var i="",r=Object(s.g)();r&&"https:"===r.protocol&&(i=";secure",null===f&&(f=z((Object(s.i)()||{}).userAgent)),f||(t+=";SameSite=None"));var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var a="; expires="+o.toUTCString();Object(s.c)().cookie=e+"="+t+a+"; path=/"+i}}function Y(e){J(e,"",-1)}function Q(e){if(K()){e+="=";for(var t=decodeURIComponent((Object(s.c)()||{}).cookie||"").split(";"),n=0;n<t.length;n++){for(var i=t[n],r=0;" "===i.charAt(r);)r++;if(0===(i=i.substring(r)).indexOf(e))return i.substring(e.length,i.length)}}return""}function X(e){void 0===e&&(e="D");var t=a.a.newGuid();return"B"===e?t="{"+t+"}":"P"===e?t="("+t+")":"N"===e&&(t=t.replace(/-/g,"")),t}function $(e,t,n,i,r){var o={},a=!1,s=0,c=arguments.length,l=Object.prototype,u=arguments;for("[object Boolean]"===l.toString.call(u[0])&&(a=u[0],s++);s<c;s++)e=u[s],ce(e,function(e,t){a&&t&&D(t)?o[e]=$(!0,o[e],t):o[e]=t});return o}var Z=a.a.perfNow;function ee(e){return e<10?"0"+e:e.toString()}function te(e){return!(!P(e)||!(e>=o.e.NotSet&&e<=o.e.Pii_IPV4AddressLegacy||e===o.e.CustomerContent_GenericContent))}function ne(e){return e.length>0}var ie=a.a.objDefineAccessors;function re(e){var t=ae("beforeunload",e);return t=ae("unload",e)||t,t=ae("pagehide",e)||t}function oe(e,t){var n=e;n.timings=n.timings||{},n.timings.processTelemetryStart=n.timings.processTelemetryStart||{},n.timings.processTelemetryStart[t]=Z()}var ae=a.a.addEventHandler,se=s.b,ce=a.b;function le(e){var t=0;if(null!=e){var n=typeof e;"string"===n?t=1:"number"===n?t=2:"boolean"===n?t=3:n===r.d&&(t=4,w(e)?(t=4096,e.length>0&&(t|=le(e[0]))):y(e,"value")&&(t=8192|le(e.value)))}return t}function ue(e,t){return void 0!==e&&void 0!==t&&-1!==e.indexOf(t,e.length-t.length)}},function(e,t,n){"use strict";
/*!
 * Microsoft Dynamic Proto Utility, 1.1.0
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */var i=Object.getPrototypeOf,r=0;function o(e,t){return e&&Object.prototype.hasOwnProperty.call(e,t)}function a(e){return"function"==typeof e}function s(e){return e&&(e===Object.prototype||e===Array.prototype)}function c(e){return s(e)||e===Function.prototype}function l(e){if(e){if(i)return i(e);var t=e.__proto__||e.prototype||e.constructor;if(t)return t}return null}function u(e,t,n){return"constructor"!==t&&a(e[t])&&(n||o(e,t))}function d(e){throw new TypeError("DynamicProto: "+e)}function p(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t)return!0;return!1}function f(e,t,n,i){var r=null;if(e&&o(n,"_dynClass")){var a=e._dynInstFuncs||{};if((r=(a[n._dynClass]||{})[t])||d("Missing ["+t+"] function"),!r._dynInstChk&&!1!==a._dynInstChk){for(var s=!o(e,t),u=l(e),f=[];s&&u&&!c(u)&&!p(f,u);){var h=u[t];if(h){s=h===i;break}f.push(u),u=l(u)}try{s&&(e[t]=r),r._dynInstChk=1}catch(e){a._dynInstChk=!1}}}return r}function h(e,t,n){var i=t[e];return i===n&&(i=l(t)[e]),a(i)||d("["+e+"] is not a function"),i}function g(e,t){return o(e,"prototype")?e.name||t||"_unknown_":((e||{}).constructor||{}).name||t||"_unknown_"}function m(e,t,n,a){o(e,"prototype")||d("theClass is an invalid class definition.");var v=e.prototype;(function(e,t){for(var n=l(t);n&&!c(n);){if(n===e)return!0;n=l(n)}return!1})(v,t)||d("["+g(e)+"] is not in class hierarchy of ["+g(t)+"]");var y=null;o(v,"_dynClass")?y=v._dynClass:(y="_dynCls$"+g(e,"_")+"$"+r,r++,v._dynClass=y);var S=m._dfOpts,_=!!S.useBaseInst;_&&a&&void 0!==a.useBaseInst&&(_=!!a.useBaseInst);var E=function(e){var t={};for(var n in e)!t[n]&&u(e,n,!1)&&(t[n]=e[n]);return t}(t);n(t,function(e,t,n,r){function o(e,t,n){var i=t[s];if(i._isDynProxy&&r){var o=e._dynInstFuncs||{};!1!==o._dynInstChk&&(i=(o[t._dynClass]||{})[n]||i)}return function(){return i.apply(e,arguments)}}var a={};for(var s in n)a[s]=o(t,n,s);for(var d=l(e),f=[];d&&!c(d)&&!p(f,d);){for(var s in d)!a[s]&&u(d,s,!i)&&(a[s]=o(t,d,s));f.push(d),d=l(d)}return a}(v,t,E,_));var T=!!i&&!!S.setInstFuncs;T&&a&&(T=!!a.setInstFuncs),function(e,t,n,i,r){function a(e,t){var n=function(){var i=f(this,t,e,n)||h(t,e,n);return i.apply(this,arguments)};return n._isDynProxy=1,n}if(!s(e)){var c=n._dynInstFuncs=n._dynInstFuncs||{},l=c[t]=c[t]||{};for(var d in!1!==c._dynInstChk&&(c._dynInstChk=!!r),n)u(n,d,!1)&&n[d]!==i[d]&&(l[d]=n[d],delete n[d],(!o(e,d)||e[d]&&!e[d]._isDynProxy)&&(e[d]=a(e,d)))}}(v,y,t,E,!1!==T)}m._dfOpts={setInstFuncs:!0,useBaseInst:!0},t.a=m},function(e,t,n){"use strict";n.d(t,"d",function(){return a}),n.d(t,"e",function(){return s}),n.d(t,"k",function(){return l}),n.d(t,"c",function(){return u}),n.d(t,"m",function(){return d}),n.d(t,"i",function(){return p}),n.d(t,"g",function(){return f}),n.d(t,"a",function(){return h}),n.d(t,"j",function(){return g}),n.d(t,"l",function(){return m}),n.d(t,"f",function(){return v}),n.d(t,"b",function(){return y}),n.d(t,"h",function(){return S}),n.d(t,"n",function(){return _});var i=n(10),r=i.f,o=i.d,a=(i.e,i.c,i.a);function s(e){var t=a();return t&&t[e]?t[e]:"window"===e&&c()?window:null}function c(){return Boolean(typeof window===o&&window)}function l(){return c()?window:s("window")}function u(){return Boolean(typeof document===o&&document)?document:s("document")}function d(){return Boolean(typeof navigator===o&&navigator)}function p(){return d()?navigator:s("navigator")}function f(){return typeof location===o&&location?location:s("location")}function h(){return typeof console!==r?console:s("console")}function g(){return s("performance")}function m(){return Boolean(typeof JSON===o&&JSON||null!==s("JSON"))}function v(){return m()?JSON||s("JSON"):null}function y(){return s("crypto")}function S(){return s("msCrypto")}function _(){var e=p();return!(!e||!e.product)&&"ReactNative"===e.product}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(15);t.default=i.default},function(e,t,n){"use strict";n(10);var i=n(3);n.d(t,"a",function(){return i})},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),r=n(0),o=n(2);function a(e){switch(e){case o.default.MEDIA_STATE.send:return o.default.MEDIA_STATE.receive;case o.default.MEDIA_STATE.receive:return o.default.MEDIA_STATE.send;default:return e}}function s(e,t){var n=l(e)&&l(t),i=u(e)&&u(t);return n&&i?o.default.MEDIA_STATE.sendReceive:n?o.default.MEDIA_STATE.send:i?o.default.MEDIA_STATE.receive:e===o.default.MEDIA_STATE.inactive&&t||e&&t===o.default.MEDIA_STATE.inactive?o.default.MEDIA_STATE.inactive:void 0}function c(e){return e===o.default.MEDIA_STATE.sendReceive?o.default.MEDIA_STATE.receive:void 0}function l(e){return e===o.default.MEDIA_STATE.send||e===o.default.MEDIA_STATE.sendReceive}function u(e){return e===o.default.MEDIA_STATE.receive||e===o.default.MEDIA_STATE.sendReceive}function d(e,t,n){var i=l(e)&&l(t)||!l(e)&&!l(n),r=!n||u(e)&&u(t)||!u(e)&&!u(n);return i&&r}function p(e){switch(e){case"audio":return"Audio";case"video":return"Video";case"sharing":return"ScreenShare";default:return null}}t.negotiateDirectionality=s,t.invertModalities=function(e){var t={},n=a(e.audio);n&&(t.audio=n);var i=a(e.video);i&&(t.video=i);var r=a(e.sharing);r&&(t.sharing=r);var o=a(e.data);return o&&(t.data=o),t},t.removeSendDirectionality=c,t.hasSendDirectionality=l,t.hasReceiveDirectionality=u,t.addReceiveDirectionality=function(e){return u(e)?e:e===o.default.MEDIA_STATE.send?o.default.MEDIA_STATE.sendReceive:o.default.MEDIA_STATE.receive},t.isOnHold=function(e){return!(e.audio!==o.default.MEDIA_STATE.inactive||e.video&&e.video!==o.default.MEDIA_STATE.inactive||e.sharing&&e.sharing!==o.default.MEDIA_STATE.inactive)},t.negotiateModalities=function(e,t){var n={},i=s(e.audio,t.audio);i&&(n.audio=i);var r=s(e.video,t.video);r&&(n.video=r);var o=s(e.sharing,t.sharing);o&&(n.sharing=o);var a=s(e.data,t.data);return a&&(n.data=a),n},t.areNegotiatedDirectionsAcceptable=function(e,t,n){return d(e.audio,t.audio,n.audio)&&d(e.video,t.video,n.video)&&d(e.sharing,t.sharing,n.sharing)&&d(e.data,t.data,n.data)},t.areNegotiatedDirectionsFulfilled=function(e,t){function n(e,t){var n=l(e)===l(t),i=u(e)===u(t)||u(e)&&!t;return n&&i}return n(e.audio,t.audio)&&n(e.video,t.video)&&n(e.sharing,t.sharing)&&n(e.data,t.data)},t.areSendDirectionsFulfilled=function(e,t){var n=function(e,t){return l(e)===l(t)};return n(e.audio,t.audio)&&n(e.video,t.video)&&n(e.sharing,t.sharing)&&n(e.data,t.data)},t.getSrtpInfo=function(e){var t={dtls:!1,sdes:!1};return t.dtls=!!e.fingerprint,e.media.forEach(function(e){t.dtls=t.dtls||!!e.fingerprint,t.sdes=t.sdes||!!e.crypto}),t},t.excludePassiveModalities=function(e,t,n){if(!t||r.isEmpty(t))return e;var i={};return r.forOwn(e,function(r,o){(function(e,t,n,i){if(!t[n])return!0;if(e){if(!(l(i)||e[n]&&e[n]===i))return!1}else if(t[n]===i)return!1;return!0})(n,t,o,r)&&(i[o]=e[o])}),i},t.parseCandidateString=function(e){var t=(e||"").split(" ");return{priority:t[3],ip:t[4],port:t[5],type:t[7]}},t.isSendModalityAdded=function(e,t){return!l(e)&&l(t)},t.getSendMediaModalities=function(e){var t;return(t={}).Audio=l(e.audio),t.Video=l(e.video),t.ScreenShare=l(e.sharing),t.Data=l(e.data),t},t.mergeSendModalities=function(e,t){var n=r.shallowClone(e);return r.forOwn(e,function(e,i){var r=p(i);l(e)&&!t[r]&&(n[i]=c(e))}),n},t.modalityToMediaType=p,t.mediaTypeToModality=function(e){switch(e){case"Audio":return"audio";case"Video":return"video";case"ScreenShare":return"sharing";default:return null}},t.sendStreamsToModalities=function(e){var t={};return r.keys(e).forEach(function(n){return t[n]=!!e[n]}),t},t.scrubDevices=function(e,t){var n=["kind","type","isSystemDefault"],o={};return e?(r.keys(e).map(function(a){-1===n.indexOf(a)?o[a]=i.scrubMriOrOmit(e[a]):o[a]="label"===a?r.scrubDeviceLabelPii(e[a],t):e[a]}),JSON.stringify(o)):e},t.scrubConstraints=function e(t){var n=["sourceId","deviceId"],o={};return t?(r.keys(t).map(function(r){t[r]&&"object"==typeof t[r]?o[r]=e(t[r]):t[r]&&-1!==n.indexOf(r)?o[r]=i.scrubMriOrOmit(t[r]):o[r]=t[r]}),o):t}},function(e,t,n){"use strict";(function(e){n.d(t,"c",function(){return i}),n.d(t,"d",function(){return r}),n.d(t,"f",function(){return o}),n.d(t,"e",function(){return a}),n.d(t,"a",function(){return s}),n.d(t,"b",function(){return c});var i="function",r="object",o="undefined",a="prototype";function s(){return typeof globalThis!==o&&globalThis?globalThis:typeof self!==o&&self?self:typeof window!==o&&window?window:typeof e!==o&&e?e:null}function c(e){var t=Object.create;if(t)return t(e);if(null==e)return{};var n=typeof e;if(n!==r&&n!==i)throw new TypeError("Object prototype may only be an Object:"+e);function o(){}return o[a]=e,new o}var l,u,d,p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},f=s()||{};u=function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object[a].hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},d=function(e,t){function n(){this.constructor=e}p(e,t),e[a]=null===t?c(t):(n[a]=t[a],new n)},(l=f).__assign||(l.__assign=Object.assign||u),l.__extends||(l.__extends=d),__assign||(__assign=f.__assign),__extends||(__extends=f.__extends)}).call(this,n(61))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateCauseId=function(){for(var e="abcdef0123456789".length,t="",n=0;n<8;n++)t+="abcdef0123456789".charAt(Math.floor(Math.random()*e));return t},t.validateCauseId=function(e){return new RegExp("^[a-f0-9]{8}$").test(e)&&8===e.length}},function(e,t,n){"use strict";var i;if(Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof window&&"undefined"!=typeof navigator&&(i=window,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.MediaStream=window.MediaStream||window.webkitMediaStream||window.mozMediaStream||window.msMediaStream,window.attachMediaStream=function(e,t){"srcObject"in e?e.srcObject=t:void 0!==e.src&&(e.src=window.URL.createObjectURL(t))},window.detachMediaStream=function(e){if("srcObject"in e)e.srcObject=null;else if(void 0!==e.src&&e.src){var t=e.src;e.src="",window.URL.revokeObjectURL(t)}},void 0!==navigator.webkitGetUserMedia&&"undefined"!=typeof webkitRTCPeerConnection?(window.RTCPeerConnection=webkitRTCPeerConnection,navigator.getUserMedia=function(e,t,n){var i=function(e){e&&e.deviceId&&e.deviceId.exact&&(e.mandatory||(e.mandatory={}),e.mandatory.sourceId=e.deviceId.exact,delete e.deviceId)};return e&&(i(e.audio),i(e.video)),navigator.webkitGetUserMedia(e,t,n)}):navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(e,t,n){return navigator.mediaDevices.getUserMedia(e).then(t).catch(n)}),"undefined"!=typeof RTCIceGatherer)){var r=function(){return Promise.resolve()};RTCRtpSender.prototype.getStats||(RTCRtpSender.prototype.getStats=r),RTCRtpSender.prototype.msGetStats||(RTCRtpSender.prototype.msGetStats=r),RTCRtpReceiver.prototype.getStats||(RTCRtpReceiver.prototype.getStats=r),RTCRtpReceiver.prototype.msGetStats||(RTCRtpReceiver.prototype.msGetStats=r),RTCIceTransport.prototype.getStats||(RTCIceTransport.prototype.getStats=r),RTCIceTransport.prototype.msGetStats||(RTCIceTransport.prototype.msGetStats=r),RTCRtpReceiver.prototype.getContributingSources||(RTCRtpReceiver.prototype.getContributingSources=function(){return[]}),RTCRtpReceiver.prototype.requestSendCSRC||(RTCRtpReceiver.prototype.requestSendCSRC=function(){})}t.default={window:i}},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return s}),n.d(t,"d",function(){return c}),n.d(t,"f",function(){return l});var i=n(24),r={NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,CustomerContent_GenericContent:32},o={Normal:1,CostDeferred:2,RealTime:3},a={Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9},s={Normal:1,Critical:2},c={NONE:0,ERROR:1,WARNING:2,INFORMATION:3},l=__assign(__assign({},i.b),{AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserInfo=function(){var e,t=[{name:"Edge",engine:"Edge",key:"Edge",masks:[new RegExp("Edge/(\\d+.\\d+)")]},{name:"EdgeAnaheim",engine:"Chromium",key:"Edg",masks:[new RegExp("Edg/(\\d+.\\d+)")]},{name:"Chromium",engine:"Chromium",key:"Chromium",masks:[new RegExp("Chromium/(\\d+.\\d+)")]},{name:"Opera",engine:"Chromium",key:"OPR",masks:[new RegExp("OPR/(\\d+.\\d+)")]},{name:"YandexBrowser",engine:"Chromium",key:"YaBrowser",masks:[new RegExp("YaBrowser/(\\d+.\\d+)")]},{name:"Electron",engine:"Chromium",key:"Electron",masks:[new RegExp("Electron/(\\d+.\\d+)")]},{name:"CiscoOS",engine:"Chromium",key:"Cisco",masks:[new RegExp("Chrome/(\\d+.\\d+)")]},{name:"Chrome",engine:"Chromium",key:"Chrome",masks:[new RegExp("Chrome/(\\d+.\\d+)")]},{name:"Firefox",engine:"Firefox",key:"Firefox",masks:[new RegExp("Firefox/(\\d+.\\d+)")]},{name:"Safari",engine:"Safari",key:"Safari",masks:[new RegExp("Version/(\\d+.\\d+).*?Safari/")]},{name:"MSIE",engine:"MSIE",key:"Trident",masks:[new RegExp("MSIE (\\d+.\\d+)"),new RegExp("rv:(\\d+.\\d+)")]}],n=navigator.userAgent;return t.some(function(t){return-1!==n.indexOf(t.key)&&(e={name:t.name,engine:t.engine,version:function(e,t){var n;return t.some(function(t){return!!(n=e.match(t))}),!n||n.length<2?"0.0":n[1]||"0.0"}(n,t.masks),formFactor:function(e){return/iPhone|iPad|iPod|Android|Mobi/i.test(e)?"Mobile":"Desktop"}(n)},!0)}),e||{name:"Unknown",engine:"Unknown",version:"0.0",formFactor:"Unknown"}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,n){var i,r=this;return i=this.on(e,this._fromEventCallback(function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];i.dispose(n),r._toEventCallback(t).apply(void 0,a(e))}))},t.prototype.raiseChanged=function(){this.raiseEvents(function(e){return e.changed&&e.changed()})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return t._raiseEventImpl.apply(t,a([String(e)],n))})}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents(function(n){var i;return n.on&&n.on.name===e&&(i=n.on).handler.apply(i,a(t))})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(143).EventSourceImpl);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(26);function r(e){return"string"==typeof e?i.pii.Mri(e):i.pii.Omit(e)}t.scrubMriOrOmit=r,t.scrubMriOrOmitList=function(e){return e.forEach(r)},t.mriOrId=function(e){return e&&i.pii.Mri(e)},t.getLoggableThreadId=function(e){var t=function(e){return e&&"99:"===e.substr(0,3)?i.pii.Omit(e):e}(e);return t&&t.substr(0,8)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","phrase","subCode","reason"];t.getPIISafeObject=function(e){try{return JSON.parse(JSON.stringify(e,i,4))}catch(e){return{error:"failed to parse object"}}},t.getPrintableObject=function(e,t){if(void 0===t&&(t=!1),void 0===e)return"void";if(e instanceof Error)return e.toString();if(e instanceof String||e instanceof Number||e instanceof Boolean)return e.toString();try{return e.stack&&(e.stack=function(e){try{return e.split("\n")[0]}catch(e){return"invalid stack"}}(e.stack)),(t?JSON.stringify(e):JSON.stringify(e,i,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(t){return"failed to get error information:"+(e&&"function"==typeof e.toString&&e.toString())+" "+(e&&e.response&&JSON.stringify(e.response))}},t.safeJsonStringify=function(e){try{return JSON.stringify(e,null,2)}catch(e){return"failed to stringify obj"}},t.truncate=function(e,t){try{return e.substring(0,length)}catch(t){return e}}},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Pending=0]="Pending",e[e.Rejected=1]="Rejected",e[e.Resolved=2]="Resolved"}(i=t.SettablePromiseState||(t.SettablePromiseState={}));var r=function(){function e(){var e=this;this.stateInt=i.Pending,this.promiseInt=new Promise(function(t,n){e.resolveInt=t,e.rejectInt=n})}return Object.defineProperty(e.prototype,"state",{get:function(){return this.stateInt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolve",{get:function(){var e=this;return function(t){e.stateInt=i.Resolved,e.resolveInt(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){var e=this;return function(t){e.stateInt=i.Rejected,e.rejectInt(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this.promiseInt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPending",{get:function(){return this.stateInt===i.Pending},enumerable:!0,configurable:!0}),e}();t.SettablePromise=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(9);t.Helper=r;var o=n(166);t.MediaAgent=o.default,t.Constants=i.default},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(1),r=n(34),o=n(23),a=n(24),s=i.a.isFunction,c=function(e,t){var n=this,i=null,r=s(e.processTelemetry),c=s(e.setNextPlugin);n._hasRun=!1,n.getPlugin=function(){return e},n.getNext=function(){return i},n.setNext=function(e){i=e},n.processTelemetry=function(s,l){l||(l=t);var u=e?e.identifier:"TelemetryPluginChain";Object(o.b)(l?l.core():null,function(){return u+":processTelemetry"},function(){if(e&&r){n._hasRun=!0;try{l.setNext(i),c&&e.setNextPlugin(i),i&&(i._hasRun=!1),e.processTelemetry(s,l)}catch(n){var t=i&&i._hasRun;i&&t||l.diagLog().throwInternal(a.a.CRITICAL,a.b.PluginException,"Plugin ["+e.identifier+"] failed during processTelemetry - "+n),i&&!t&&i.processTelemetry(s,l)}}else i&&(n._hasRun=!0,i.processTelemetry(s,l))},function(){return{item:s}},!s.sync)}},l=i.a.isNullOrUndefined;function u(e,t){var n=[];if(e&&e.length>0)for(var r=null,o=0;o<e.length;o++){var a=e[o];if(a&&i.a.isFunction(a.processTelemetry)){var s=new c(a,t);n.push(s),r&&r.setNext(s),r=s}}return n.length>0?n[0]:null}var d=function e(t,n,o,a){var s=this,c=null;null!==a&&(t&&i.a.isFunction(t.getPlugin)?c=function(e,t,n){var i=[],r=!n;if(e)for(;e;){var o=e.getPlugin();(r||o===n)&&(r=!0,i.push(o)),e=e.getNext()}return r||i.push(n),u(i,t)}(t,s,a||t.getPlugin()):a?c=function(e,t,n){var r=e,o=!1;return n&&e&&(r=[],i.a.arrForEach(e,function(e){(o||e===n)&&(o=!0,r.push(e))})),n&&!o&&(r||(r=[]),r.push(n)),u(r,t)}(t,s,a):i.a.isUndefined(a)&&(c=u(t,s))),s.core=function(){return o},s.diagLog=function(){var e=(o||{}).logger;return e||(e=new r.a(n||{})),e},s.getCfg=function(){return n},s.getExtCfg=function(e,t){var i;if(void 0===t&&(t={}),n){var r=n.extensionConfig;r&&e&&(i=r[e])}return i||t},s.getConfig=function(e,t,i){var r;void 0===i&&(i=!1);var o=s.getExtCfg(e,null);return o&&!l(o[t])?r=o[t]:n&&!l(n[t])&&(r=n[t]),l(r)?i:r},s.hasNext=function(){return null!=c},s.getNext=function(){return c},s.setNext=function(e){c=e},s.processNext=function(e){var t=c;t&&(c=t.getNext(),t.processTelemetry(e,s))},s.createNew=function(t,i){return void 0===t&&(t=null),new e(t||c,n,o,i)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),r=n(0),o=function(){function e(e){this.logger=e,this.queue=Promise.resolve()}return e.prototype.add=function(e){var t,n=this;t=e instanceof i.SettablePromise?function(){return e.promise}:e;var o=this.queue.then(t);return this.queue=o.catch(function(e){n.queue&&n.logger.safe.error("Error from promiseQueue! "+r.stringifyObject(e))}),o},e.prototype.dispose=function(){this.queue=null},e}();t.PromiseQueue=o},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0),this.width=e,this.height=t,this.minBitrate=n,this.maxBitrate=i,this.fs=Math.ceil(e/16)*Math.ceil(t/16)}return e.prototype.toString=function(){return this.height?this.height+"p":this.fs+"fs"},e}();t.ResolutionInfo=r;var o=function(){function e(e){this.resolutions=[new r(320,180,2e4,2e5),new r(426,240,16e4,35e4),new r(480,270,25e4,5e5),new r(640,360,4e5,1e6),new r(852,480,8e5,14e5),new r(960,540,12e5,18e5),new r(1280,720,15e5,2e6),new r(1920,1080,18e5,1e8)],e.config.resolutionTableOverride&&(this.resolutions=e.config.resolutionTableOverride.map(function(e){return new r(e.w,e.h,e.minBr,e.maxBr)}))}return Object.defineProperty(e.prototype,"initialResolution",{get:function(){return this.resolutions[this.resolutions.length-1]},enumerable:!0,configurable:!0}),e.prototype.getResolution=function(e){for(var t=this.resolutions.length-1;t>=0;t--)if(this.resolutions[t].fs<=e)return this.resolutions[t];return this.resolutions[0]},e.prototype.getMaxFS=function(e,t){var n,r,o=Math.max(e,t),a=Math.min(e,t);try{for(var s=i(this.resolutions),c=s.next();!c.done;c=s.next()){var l=c.value;if(l.width>=o&&l.height>=a)return l.fs}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return this.resolutions.slice(-1)[0].fs},e.prototype.getResolutionForBitrate=function(e){return{lowRes:this.resolutions.filter(function(t){return t.maxBitrate&&t.maxBitrate>=e}).shift(),highRes:this.resolutions.filter(function(t){return t.minBitrate&&t.minBitrate<=e}).pop()}},e.prototype.getBitrateForResolution=function(e,t){var n=this.getResolution(this.getMaxFS(e,t));return{minBitrate:n.minBitrate,maxBitrate:n.maxBitrate}},e.prototype.getResolutions=function(){return this.resolutions},e}();t.default=o},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return s});var i=n(4),r=n(1),o=function(){function e(t,n,i){var o,a=this,s=!1;a.start=r.a.dateNow(),a.name=t,a.isAsync=i,a.isChildEvt=function(){return!1},r.a.isFunction(n)&&(s=r.a.objDefineAccessors(a,"payload",function(){return!o&&r.a.isFunction(n)&&(o=n(),n=null),o})),a.getCtx=function(t){return t?t===e.ParentContextKey||t===e.ChildrenContextKey?a[t]:(a.ctx||{})[t]:null},a.setCtx=function(t,n){t&&(t===e.ParentContextKey?(a[t]||(a.isChildEvt=function(){return!0}),a[t]=n):t===e.ChildrenContextKey?a[t]=n:(a.ctx=a.ctx||{})[t]=n)},a.complete=function(){var t=0,i=a.getCtx(e.ChildrenContextKey);if(r.a.isArray(i))for(var o=0;o<i.length;o++){var c=i[o];c&&(t+=c.time)}a.time=r.a.dateNow()-a.start,a.exTime=a.time-t,a.complete=function(){},!s&&r.a.isFunction(n)&&(a.payload=n())}}return e.ParentContextKey="parent",e.ChildrenContextKey="childEvts",e}(),a=function(){function e(t){this.ctx={},Object(i.a)(e,this,function(e){e.create=function(e,t,n){return new o(e,t,n)},e.fire=function(e){e&&(e.complete(),t&&t.perfEvent(e))},e.setCtx=function(t,n){t&&((e.ctx=e.ctx||{})[t]=n)},e.getCtx=function(t){return(e.ctx||{})[t]}})}return e.prototype.create=function(e,t,n){return null},e.prototype.fire=function(e){},e.prototype.setCtx=function(e,t){},e.prototype.getCtx=function(e){},e}();function s(e,t,n,i,a){if(e){var s=e;if(s&&r.a.isFunction(s.getPerfMgr)&&(s=s.getPerfMgr()),s){var c=void 0,l=s.getCtx("CoreUtils.doPerf");try{if(c=s.create(t(),i,a)){if(l&&c.setCtx&&(c.setCtx(o.ParentContextKey,l),l.getCtx&&l.setCtx)){var u=l.getCtx(o.ChildrenContextKey);u||(u=[],l.setCtx(o.ChildrenContextKey,u)),u.push(c)}return s.setCtx("CoreUtils.doPerf",c),n(c)}}catch(e){c&&c.setCtx&&c.setCtx("exception",e)}finally{c&&s.fire(c),s.setCtx("CoreUtils.doPerf",l)}}}return n()}},function(e,t,n){"use strict";var i;n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r}),function(e){e[e.CRITICAL=1]="CRITICAL",e[e.WARNING=2]="WARNING"}(i||(i={}));var r={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103}},function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},a={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(i)},function(e,n){e.exports=t},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(14),c=n(6),l=n(12),u=function(e){function t(t){var n=e.call(this)||this;return n.configProvider=t,n.isAudioOutputSelectionSupportedValue=!1,n.configProvider.on("configUpdated",function(){return n.updateConfig()}),n.updateConfig(),n.hasRollbackSupported(),n}return r(t,e),Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return this.isAudioOutputSelectionSupportedValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBrowserRollbackSupported",{get:function(){return this.isBrowserRollbackSupportedValue},enumerable:!0,configurable:!0}),t.hasApplyConstraints=function(){return void 0!==MediaStreamTrack.prototype.applyConstraints},t.hasPermissionsApi=function(){return void 0!==navigator.permissions&&"Firefox"!==s.getBrowserInfo().name},t.prototype.hasRollbackSupported=function(){return o(this,void 0,void 0,function(){var e,t;return a(this,function(n){switch(n.label){case 0:e=l.default.window.RTCPeerConnection&&new l.default.window.RTCPeerConnection,n.label=1;case 1:return n.trys.push([1,6,7,8]),e?[4,e.createOffer()]:[3,5];case 2:return t=n.sent(),[4,e.setLocalDescription(t)];case 3:return n.sent(),[4,e.setLocalDescription({type:"rollback"})];case 4:n.sent(),this.isBrowserRollbackSupportedValue=!0,n.label=5;case 5:return[3,8];case 6:return n.sent(),this.isBrowserRollbackSupportedValue=!1,[3,8];case 7:return e&&e.close(),[7];case 8:return[2]}})})},t.hasH264CodecSupport=function(e){return o(this,void 0,void 0,function(){var t,n,i;return a(this,function(r){switch(r.label){case 0:if(t="v=0\no=- 596983 0 IN IP4 127.0.0.1\ns=session\nc=IN IP4 0.0.0.0\nt=0 0\na=msid-semantic: WMS *\nm=video 3480 RTP/SAVPF 107 99\na=rtpmap:107 H264/90000\na=rtpmap:99 rtx/90000\na=fmtp:107 max-fs=240;max-mbps=3600;max-br=208;max-fps=1500;profile-level-id=42C02A;packetization-mode=1\na=fmtp:99 apt=107\na=setup:actpass\na=mid:video\na=recvonly\na=rtcp-mux\na=ice-ufrag:CvYq\na=ice-pwd:axsjsa0GOz3kz6TuGvNgJZWO\na=fingerprint:sha-256 34:DF:5C:15:60:FF:28:3E:E8:96:4B:F8:85:61:E4:C0:57:D1:60:82:21:FD:BC:D2:90:41:06:FA:03:FD:12:A2\n",!(n=l.default.window.RTCPeerConnection&&new l.default.window.RTCPeerConnection))return[2,!1];r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,n.setRemoteDescription({sdp:t,type:"offer"})];case 2:return r.sent(),[2,!0];case 3:return i=r.sent(),e.error("H264 not supported",i),[2,!1];case 4:try{n.close()}catch(e){}return[7];case 5:return[2]}})})},t.hasMediaApi=function(){return navigator.getUserMedia&&("undefined"!=typeof RTCIceGatherer||"undefined"!=typeof RTCPeerConnection)},t.hasPcConnectionState=function(){return RTCPeerConnection.prototype.hasOwnProperty("connectionState")},t.hasCapabilitiesApi=function(){return l.default.window.RTCRtpReceiver&&l.default.window.RTCRtpReceiver.getCapabilities},t.isAudioOutputSelectionSupportedByBrowser=function(){return void 0!==l.default.window&&void 0!==l.default.window.HTMLAudioElement&&void 0!==l.default.window.HTMLAudioElement.prototype.setSinkId&&(!t.isEdge||t.isEdgeRS5)},t.prototype.updateConfig=function(){var e=t.isAudioOutputSelectionSupportedByBrowser()&&(!t.isEdgeRS5||this.configProvider.config.ortcAudioOutputSelectionEnabled);e!==this.isAudioOutputSelectionSupportedValue&&(this.isAudioOutputSelectionSupportedValue=e,this.event("isAudioOutputSelectionSupportedChanged").raise())},t.isEdge="Edge"===s.getBrowserInfo().name,t.isEdgeRS5=t.isEdge&&parseInt(s.getBrowserInfo().version.split(".")[0],10)>=18,t}(c.default);t.UserAgentConfig=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=n(0),o=n(2);function a(e,t,n){e.rtp&&e.rtp.some(function(i,r){var o=i.payload;if(t.name.toLowerCase()!==i.codec.toLowerCase()||t.rate!==i.rate||t.encoding!==i.encoding||t.payload&&t.payload!==i.payload)return!1;var a={rtp:i};e.fmtp=e.fmtp||[];var s=e.fmtp.some(function(e){return i.payload===e.payload&&(a.fmtp=e,!0)});e.rtcpFb=e.rtcpFb||[],a.rtcpFb=e.rtcpFb.filter(function(e){return e.payload===i.payload&&(a.rtcpFb=e,!0)});var c=a.rtcpFb.length>0;if(null===n(a))e.payloads=e.payloads.toString().split(" ").filter(function(e){return i.payload!==+e}).join(" "),e.fmtp=e.fmtp.filter(function(e){return i.payload!==e.payload}),e.rtp.splice(r,1);else{if(a.rtp.payload!==o){var l=a.rtp.payload;e.payloads=e.payloads.toString().split(" ").map(function(e){return+e===o?l:+e}).join(" "),a.fmtp&&(a.fmtp.payload=l),a.rtcpFb&&a.rtcpFb.forEach(function(e){return e.payload=l}),e.fmtp.filter(function(e){return e.config&&e.config.indexOf("apt="+o)>-1}).forEach(function(e){return e.config=e.config.replace("apt="+o,"apt="+l)})}!s&&a.fmtp&&e.fmtp.push(a.fmtp),!c&&a.rtcpFb&&a.rtcpFb.forEach(function(t){return e.rtcpFb.push(t)})}return!0})}function s(e,t,n){if(!i.isUndefined(e.rate)&&e.rate!==t.rate)return!1;if(!i.isUndefined(e.codec)&&e.codec!==t.codec)return!1;if(!i.isUndefined(e.encoding)){if(!i.isUndefined(t.encoding)&&e.encoding!==t.encoding)return!1;if(i.isUndefined(t.encoding)&&1!==e.encoding)return!1}return!!i.isUndefined(e.fmtpLine)||!(!n||!n.find(function(n){return n.payload===t.payload&&-1!==n.config.indexOf(e.fmtpLine)}))}function c(e,t){return t===e||"*"===t}function l(e){if(e.label){if(o.default.MEDIA_LABEL.audio===e.label)return o.default.MODALITY.audio;if(o.default.MEDIA_LABEL.video===e.label)return o.default.MODALITY.video;if(o.default.MEDIA_LABEL.sharing===e.label)return o.default.MODALITY.sharing;if(o.default.MEDIA_LABEL.data===e.label)return o.default.MODALITY.data}else{if(o.default.MEDIA_TYPE.audio===e.type)return o.default.MODALITY.audio;if(o.default.MEDIA_TYPE.video===e.type)return o.default.MODALITY.video;if(o.default.MEDIA_TYPE.data===e.type||o.default.MEDIA_TYPE.dataChannel===e.type)return o.default.MODALITY.data}return null}t.updatePayload=function(e,t,n){if(e.rtp){var i=e.rtp.filter(function(e){return e.payload===t})[0];i&&a(e,{name:i.codec,rate:i.rate,payload:i.payload},function(e){return e.rtp.payload=n,e})}},t.forCodec=a,t.removeCodec=function(e,t){var n=-1;if(e.rtp.forEach(function(e,i){t.codec.toLowerCase()===e.codec.toLowerCase()&&t.rate===e.rate&&t.encoding===e.encoding&&(n=i)}),n>=0&&e.rtp.length>1){var i=e.rtp[n].payload;e.rtp.splice(n,1),e.payloads=e.payloads.split(" ").filter(function(e){return i!==+e}).join(" "),e.fmtp=e.fmtp&&e.fmtp.filter(function(e){return i!==e.payload})}},t.filterCodecs=function(e,t,n){e.rtp&&e.rtp.length&&(e.rtp=e.rtp.filter(function(n){return t.some(function(t){return s(t,n,e.fmtp)})}),e.type===o.default.MEDIA_TYPE.video&&(e.rtp=e.rtp.filter(function(t){var n=e.fmtp&&e.fmtp.find(function(e){return e.payload===t.payload&&e.config.startsWith("apt=")});if(n){var i=+n.config.split(";")[0].split("=")[1];return e.rtp.some(function(e){return e.payload===i})}return!0})),n&&(e.rtp=i.flatten(t.map(function(t){return e.rtp.filter(function(n){return s(t,n,e.fmtp)})}))),e.payloads=e.rtp.map(function(e){return e.payload}).join(" "),e.fmtp=e.fmtp&&e.fmtp.filter(function(t){return e.rtp.some(function(e){return c(e.payload,t.payload)})}),e.rtcpFb=e.rtcpFb&&e.rtcpFb.filter(function(t){return e.rtp.some(function(e){return c(e.payload,t.payload)})}))},t.getModality=l,t.getLabelForModality=function(e){return o.default.MODALITY.audio===e?o.default.MEDIA_LABEL.audio:o.default.MODALITY.video===e?o.default.MEDIA_LABEL.video:o.default.MODALITY.sharing===e?o.default.MEDIA_LABEL.sharing:o.default.MODALITY.data===e?o.default.MEDIA_LABEL.data:null},t.getModalities=function(e){return e.media.reduce(function(e,t){if(0!==t.port){var n=l(t);if(!(n in e)){var i=t.direction?t.direction.toLowerCase():o.default.MEDIA_STATE.sendReceive;e[n]=i}}return e},{})},t.getTypeFromModality=function(e){switch(e){case o.default.MODALITY.audio:return o.default.MEDIA_TYPE.audio;case o.default.MODALITY.video:case o.default.MODALITY.sharing:return o.default.MEDIA_TYPE.video;case o.default.MODALITY.data:return o.default.MEDIA_TYPE.data;default:return null}},t.getBundle=function(e){var t;if(e.groups){var n=r.find(e.groups,function(e){return"BUNDLE"===e.type});if(n){var i=n.mids.toString().split(" ")[0];t=r.find(e.media,function(e){var t="number"==typeof e.mid?e.mid.toString():e.mid;return i===t})}}return t||null}},function(e,t,n){"use strict";var i=n(3),r=n(4),o=i.isFunction;function a(e,t,n){return function(i){e[t]=i,n()}}var s=function(){function e(t){var n=0,i=null,a=[];function s(){if(a.length>0){var e=a.slice();a=[],setTimeout(function(){for(var t=0,n=e.length;t<n;++t)try{e[t]()}catch(e){}},0)}}function c(e){0===n&&(i=e,n=1,s())}function l(e){0===n&&(i=e,n=2,s())}Object(r.a)(e,this,function(t){t.then=function(t,r){return new e(function(c,l){!function(t,r,c,l){a.push(function(){var a;try{(a=1===n?o(t)?t(i):i:o(r)?r(i):i)instanceof e?a.then(c,l):2!==n||o(r)?c(a):l(a)}catch(e){return void l(e)}}),0!==n&&s()}(t,r,c,l)})},t.catch=function(e){return t.then(null,e)}}),function(){if(!o(t))throw new TypeError("ESPromise: resolvedFunc argument is not a Function");try{t(c,l)}catch(e){l(e)}}()}return e.resolve=function(t){return t instanceof e?t:t&&o(t.then)?new e(function(e,n){try{t.then(e,n)}catch(e){n(e)}}):new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.all=function(t){if(t&&t.length)return new e(function(e,n){try{for(var i=[],r=0,s=0;s<t.length;s++){var c=t[s];c&&o(c.then)?(r++,c.then(a(i,s,function(){0==--r&&e(i)}),n)):i[s]=c}0===r&&setTimeout(function(){e(i)},0)}catch(e){n(e)}})},e.race=function(t){return new e(function(e,n){if(t&&t.length)try{for(var i=function(i){var r=t[i];r&&o(r.then)?r.then(e,n):setTimeout(function(){e(r)},0)},r=0;r<t.length;r++)i(r)}catch(e){n(e)}})},e.prototype.then=function(e,t){},e.prototype.catch=function(e){},e}();t.a=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e){var t=this;this.parameters={},e&&e.split(";").forEach(function(e){var n=e.split("=");t.parameters[n[0]]=n[1]})}return e.prototype.setIfMissing=function(e,t){this.contains(e)||(this.parameters[e]=t)},e.prototype.removeIfPresent=function(e){this.contains(e)&&delete this.parameters[e]},e.prototype.get=function(e){return this.parameters[e]},e.prototype.names=function(){return Object.keys(this.parameters)},e.prototype.contains=function(e){return this.parameters.hasOwnProperty(e)},e.prototype.toString=function(){var e="";return i.forOwn(this.parameters,function(t,n){e+=(e?";":"")+n,void 0!==t&&(e+="="+t)}),e},e}();t.FormatParameters=r,t.default={build:function(e){return new r(e)}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.asap=function(e){return new Promise(function(t){t(e())})};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);t.TimeoutError=o;var a=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){this.timeoutId=window.setTimeout(this.ontimeout,e)},e.prototype.stop=function(){clearTimeout(this.timeoutId)},e}();t.Timer=a,t.defer=function(){var e,t;return{promise:new Promise(function(n,i){e=n,t=i}),resolve:e,reject:t}},t.timedDefer=function(e,t){var n,i;void 0===t&&(t="deferred timed out after "+e+"ms");var r=new a(function(){return i(new o(t))}),s=new Promise(function(e,t){n=function(t){r.stop(),e(t)},i=function(e){r.stop(),t(e)}});return r.start(e),{promise:s,resolve:n,reject:i}},t.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTsCallingVersion=function(){return"2020.50.01.4"},t.getOvb=function(){return"587c7ff24ac5681c14314c05f8a3f250899b0377"}},function(e,t,n){var i=n(212),r=n(213);t.write=r,t.parse=i.parse,t.parseParams=i.parseParams,t.parseFmtpConfig=i.parseFmtpConfig,t.parsePayloads=i.parsePayloads,t.parseRemoteCandidates=i.parseRemoteCandidates,t.parseImageAttributes=i.parseImageAttributes,t.parseSimulcastStreamList=i.parseSimulcastStreamList},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return l});var i=n(24),r=n(1),o=n(5),a=n(4);function s(e){return e?'"'+e.replace(/\"/g,"")+'"':""}var c=function(){function e(e,t,n,i){void 0===n&&(n=!1),this.messageId=e,this.message=(n?"AI: ":"AI (Internal): ")+e;var r="";Object(o.l)()&&(r=Object(o.f)().stringify(i));var a=(t?" message:"+s(t):"")+(i?" props:"+s(r):"");this.message+=a}return e.dataType="MessageData",e}(),l=function(){function e(t){this.identifier="DiagnosticLogger",this.queue=[];var n=0,s={};Object(a.a)(e,this,function(e){var a=r.a.isNullOrUndefined,l=r.a.isUndefined,u=r.a.isFunction;function d(e,n){var i=t[e];return a(i)?n:i}a(t)&&(t={}),e.consoleLoggingLevel=function(){return d("loggingLevelConsole",0)},e.telemetryLoggingLevel=function(){return d("loggingLevelTelemetry",1)},e.maxInternalMessageLimit=function(){return d("maxMessageLimit",25)},e.enableDebugExceptions=function(){return d("enableDebugExceptions",!1)},e.throwInternal=function(t,n,r,o,a){void 0===a&&(a=!1);var u=new c(n,r,a,o);if(e.enableDebugExceptions())throw u;if(!l(u)&&u&&!l(u.message)){if(a){var d=+u.messageId;!s[d]&&e.consoleLoggingLevel()>=i.a.WARNING&&(e.warnToConsole(u.message),s[d]=!0)}else e.consoleLoggingLevel()>=i.a.WARNING&&e.warnToConsole(u.message);e.logInternalMessage(t,u)}},e.warnToConsole=function(e){var t=Object(o.a)();if(t){var n="log";t.warn&&(n="warn"),u(t[n])&&t[n](e)}},e.resetInternalMessageCount=function(){n=0,s={}},e.logInternalMessage=function(t,r){if(!(n>=e.maxInternalMessageLimit())){var o=!0,a="AITR_"+r.messageId;if(s[a]?o=!1:s[a]=!0,o&&(t<=e.telemetryLoggingLevel()&&(e.queue.push(r),n++),n===e.maxInternalMessageLimit())){var l="Internal events throttle limit per PageView reached for this app.",u=new c(i.b.MessageLimitPerPVExceeded,l,!1);e.queue.push(u),e.warnToConsole(l)}}}})}return e.prototype.enableDebugExceptions=function(){return!1},e.prototype.consoleLoggingLevel=function(){return 0},e.prototype.telemetryLoggingLevel=function(){return 1},e.prototype.maxInternalMessageLimit=function(){return 25},e.prototype.throwInternal=function(e,t,n,i,r){void 0===r&&(r=!1)},e.prototype.warnToConsole=function(e){},e.prototype.resetInternalMessageCount=function(){},e.prototype.logInternalMessage=function(e,t){},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INITIALIZE="Initialize",e.START_CALL="StartCall",e.START_TRANSFER_TARGET_CALL="StartTransferTargetCall",e.STOP_CALL="StopCall",e.STOP_CALL_WITH_BEACON="StopCallWithBeacon",e.JOIN_CALL="JoinCall",e.JOIN_PREHEATED_CALL="JoinPreheatedCall",e.SUBSCRIBE="Subscribe",e.START_CALL_TO_VOICE_MAIL="StartCallToVoiceMail",e.ACKNOWLEDGE="Acknowledge",e.ACCEPT="Accept",e.REJECT="Reject",e.START_VIDEO="StartVideo",e.STOP_VIDEO="StopVideo",e.LOCAL_HOLD="LocalHold",e.LOCAL_UNHOLD="LocalUnhold",e.HOLD="Hold",e.UNHOLD="Unhold",e.UPDATE_ENDPOINT_METADATA="UpdateEndpointMetadata",e.SEND_DTMF_TONE="SendDtmfTone",e.SET_AUDIO_USAGE="SetAudioUsage",e.DUMP_VIDEO_SOURCE_IMAGES="DumpVideoSourceImages",e.BLIND_TRANSFER="BlindTransfer",e.SAFE_TRANSFER="SafeTransfer",e.TRANSFER_TO_VOICEMAIL="TransferToVoicemail",e.CONSULTATIVE_TRANSFER="ConsultativeTransfer",e.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE="ConsultativeTransferWithPickupCode",e.START_SCREEN_SHARING="StartScreenSharing",e.STOP_SCREEN_SHARING="StopScreenSharing",e.START_DATA_CHANNEL="StartDataChannel",e.STOP_DATA_CHANNEL="StopDataChannel",e.SHARE_SYSTEM_SOUNDS="ShareSystemSounds",e.START_MULTICHANNEL_AUDIO_DEVICE="StartMultichannelAudioDevice",e.STOP_MULTICHANNEL_AUDIO_DEVICE="StopMultichannelAudioDevice",e.MUTE="Mute",e.UNMUTE="Unmute",e.MUTE_SPEAKER="MuteSpeaker",e.UNMUTE_SPEAKER="UnmuteSpeaker",e.MUTE_PARTICIPANTS="MuteParticipants",e.UPDATE_MEETING_ROLE="UpdateMeetingRole",e.START_AUDIO="StartAudio",e.STOP_AUDIO="StopAudio",e.ASSIMILATE="Assimilate",e.SET_MAX_VIDEO_CHANNELS="SetMaxVideoChannels",e.CREATE_CONTENT_SHARING_SESSION="CreateContentSharingSession",e.START_CALL_WITH_NUDGE="StartCallWithNudge",e.START_CALL_AND_UNPARK="StartCallAndUnpark",e.PARK_CALL="ParkCall",e.UNPARK_CALL="UnparkCall",e.NUDGE_PARTICIPANTS="NudgeParticipants",e.LWJ_FALLBACK="LwjFallback",e.ELECTRON_SHOW_CQF_INFO="ElectronShowCQFInfo",e.ELECTRON_IS_CQF_RENDERED="ElectronIsCQFRendered",e.ELECTRON_PROVIDE_CQF="ElectronProvideCQF",e.MERGE_CALL="MergeCall",e.ADD_GROUP_MODALITY="AddGroupModality",e.MERGE_WITH_PICKUP_CODE="MergeWithPickupCode",e.PUBLISH_STATE="PublishState",e.REMOVE_STATE="RemoveState",e.UPDATE_MEETING_SETTINGS="UpdateMeetingSettings",e.MERGE_PARTICIPANT="MergeParticipant",e.MERGE_PARTICIPANTS="MergeParticipants",e.ADMIT="Admit",e.SEARCH_PARTICIPANTS="SearchParticipants",e.GET_ALL_PARTICIPANTS="GetAllParticipants",e.SET_AUDIO_MIDCALL_CONFIG="SetAudioMidcallConfig",e.START_WITH_MEETING_DATA="StartWithMeetingData",e.JOIN_WITH_MEETING_DATA="JoinWithMeetingData",e.SUBSCRIBE_WITH_MEETING_DATA="SubscribeWithMeetingData",e.SET_AUDIO_MIDCALL_CONFIG_JSON="SetAudioMidcallConfigJon",e.GET_CALL_STATE="GetCallState"}(t.CALL_OPERATIONS||(t.CALL_OPERATIONS={})),function(e){e.CALL_START_OR_JOIN_INITIATED="_CallStartOrJoinInitiated",e.INCOMING_INITIALIZE="_IncomingInitialize",e.CALL_ENDED="_CallEnded",e.RECONNECT="_Reconnect",e.RENEGOTIATE="_Renegotiate",e.RENEGOTIATE_OUTGOING="_RenegotiateOutgoing",e.RENEGOTIATE_INCOMING="_RenegotiateIncoming",e.COMPLETE_NEGOTIATION_FAILED="_CompleteNegotiationFailed",e.UPDATE_LOCAL_MEDIA_STATUS="_UpdateLocalMediaStatus",e.START_PREVIEW_VIDEO="_StartPreviewVideo",e.START_LOCAL_VIDEO="_StartLocalVideo",e.SET_LOCAL_VIDEO="_SetLocalVideo",e.CALL_TRANSFER_IN_PROGRESS="_CallTransferInProgress",e.ON_TRANSFER_REQUESTED="_OnTransferRequested",e.ON_TRANSFER_REQUESTED_INVALID="_OnTransferRequestedInvalid",e.ON_INCOMING_CALL_REPLACEMENT="_onIncomingCallReplacement",e.GET_CALL_REPLACEMENT_DETAILS="_GetCallReplacementDetails",e.SET_CALL_STATE="_SetCallState",e.SET_TRANSFER_STATE="_SetTransferState",e.SET_PARK_STATE="_SetParkState",e.SET_MUTED="_SetMuted",e.SET_MUTED_SPEAKER="_SetMutedSpeaker",e.SET_SCREEN_SHARING="_SetScreenSharing",e.SET_CALL_ORIGIN="_SetCallOrigin",e.CONNECT_CALL="_ConnectCall",e.WAIT_FOR_ANSWER="_WaitForAnswer",e.MEDIA_ACKNOWLEDGMENT="_MediaAcknowledgment",e.SIGNALING_STATE_CHANGED="_SignalingStateChanged",e.CALL_TERMINATION_INFO="_CallTerminationInfo",e.MEDIA_WHITELISTING_ISSUE_DETECTED="_MediaWhiteListingIssueDetected",e.CALL_ESCALATED_TO_CONFERENCE="_CallEscalatedToConference",e.WEB_ON_OFFER="_WebOnOffer",e.WEB_ON_ANSWER="_WebOnAnswer",e.WEB_ON_RETARGET_SUCCESS="_WebRetargetSuccess",e.WEB_ON_RETARGET_FAILURE="_WebRetargetFailure",e.WEB_ON_ESCALATION_SUCCESS="_WebOnEscalationSuccess",e.WEB_ON_ESCALATION_FAILURE="_WebOnEscalationFailure",e.CALL_USES_MIXER="_CallUsesMixer",e.ESCALATION_IN_PROGRESS="_EscalationInProgress",e.ESCALATION_COMPLETED="_EscalationCompleted",e.ELECTRON_WAIT_FOR_HANDLE_PUSH="_ElectronWaitForHandlePush",e.ELECTRON_WAIT_FOR_RINGING="_ElectronWaitForRinging",e.ELECTRON_START_SCREEN_SHARING="_ElectronStartScreenSharing",e.ELECTRON_STOP_SCREEN_SHARING="_ElectronStopScreenSharing",e.ELECTRON_SLIMCORE_READY="_ElectronSlimcoreReady",e.ELECTRON_DATA_CHANNEL_CREATED="_ElectronDataChannelCreated",e.ELECTRON_ATTACH_SLIMCORE_CALL="_ElectronAttachSlimcoreCall",e.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED="_ElectronAttachSlimcoreCallFailed",e.ELECTRON_LEAVE_CALL="_ElectronLeaveCall",e.PROCESS_CALL_START_OPTIONS="_ProcessCallStartOptions"}(t.CALL_OPERATIONS_INTERNAL||(t.CALL_OPERATIONS_INTERNAL={})),function(e){e.CCWM="CCWM",e.ENCRYPTED="Encrypted",e.LWJ="LWJ",e.PREHEAT="Preheat",e.MULTIPLEVIDEOS="MultipleVideos",e.SPECIFIED="Specified",e.ALL="All",e.NONE="None"}(t.OPERATION_VARIANTS||(t.OPERATION_VARIANTS={})),function(e){e.AUDIO_QUALITY_CHANGED="AudioQualityChanged",e.SESSION_ERROR="SessionError",e.NEGOTIATION_REQUIRED="NegotiationRequired",e.OUTGOING_NEGOTIATION_FAILURE="OutgoingNegotiationFailure",e.INCOMING_NEGOTIATION_FAILURE="IncomingNegotiationFailure",e.NEGOTIATION_FATAL_ERROR="NegotiationFatalError",e.NEGOTIATION_COMPLETION="NegotiationCompletion",e.AUDIO_STATE_CHANGED="AudioStateChanged",e.INCOMPATIBLE_OFFER="IncompatibleOffer",e.NEW_OFFER_FAILED="NewOfferFailed"}(t.MEDIA_EVENT||(t.MEDIA_EVENT={})),function(e){e.ADD_PARTICIPANT="AddParticipant",e.REMOVE_PARTICIPANT="RemoveParticipant",e.ADMIT_PARTICIPANT="AdmitParticipant",e.CALL_ME_BACK="CallMeBack",e.ADD_PARTICIPANTS="AddParticipants",e.SEARCH_PARTICIPANTS="SearchParticipants",e.GET_ALL_PARTICIPANTS="GetALLParticipants"}(t.PARTICIPANT_OPERATIONS||(t.PARTICIPANT_OPERATIONS={})),function(e){e.SET_PARTICIPANT_STATE_INVALID="_SetParticipantStateInvalid",e.UPDATE_LOCAL_PARTICIPANT_STREAM="_UpdateLocalParticipantStream",e.PARTICIPANT_JOINED="_ParticipantJoined",e.SELF_PARTICIPANT_UPDATED="_SelfParticipantUpdated"}(t.PARTICIPANT_OPERATIONS_INTERNAL||(t.PARTICIPANT_OPERATIONS_INTERNAL={})),function(e){e.START_CONTENT_SHARING="StartContentSharing",e.STOP_CONTENT_SHARING="StopContentSharing",e.JOIN_CONTENT_SHARING="JoinContentSharing",e.TAKE_CONTENT_SHARING_CONTROL="TakeContentSharingControl",e.UPDATE_CONTENT_SHARING_SESSION_STATE="UpdateContentSharingSessionState",e.UPDATE_PARTICIPANT_STATE="UpdateParticipantState"}(t.CONTENT_SHARING_OPERATIONS||(t.CONTENT_SHARING_OPERATIONS={})),function(e){e.SET_CONTENT_SHARING_STATUS="_SetContentSharingStatus"}(t.CONTENT_SHARING_OPERATIONS_INTERNAL||(t.CONTENT_SHARING_OPERATIONS_INTERNAL={})),t.UNPARK_CODE={PARK:"*11",SHARED_LINE:"*12",SERVER_HOLD:"*13"},function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.CLIENT_ERROR=499]="CLIENT_ERROR",e[e.SIGNALING_ERROR=599]="SIGNALING_ERROR"}(t.TRANSACTION_END_CODE||(t.TRANSACTION_END_CODE={})),function(e){e[e.LOCAL_REJECT=0]="LOCAL_REJECT",e[e.TRANSACTION_NOT_ALLOWED=3548]="TRANSACTION_NOT_ALLOWED",e[e.INVALID_ARGUMENT=3549]="INVALID_ARGUMENT",e[e.CANNOT_PARSE_RESULT=3550]="CANNOT_PARSE_RESULT"}(t.TRANSACTION_END_SUBCODE||(t.TRANSACTION_END_SUBCODE={})),function(e){e.TRANSACTION_COMPLETE="TransactionComplete",e.TRANSACTION_ALLOWED="TransactionAllowed",e.TRANSACTION_DISALLOWED="TransactionDisallowed",e.UNKNOWN="Unknown",e.STACK_NOT_INTIALIZED="Stack not intialized yet"}(t.TRANSACTION_END_PHRASE||(t.TRANSACTION_END_PHRASE={})),t.EMPTY_COUNTS={totalParticipants:0,preheatedParticipants:0,lobbyParticipants:0,totalPresenters:0,requestingAttentionPresenters:0,totalAttendees:0,requestingAttentionAttendees:0,overflowAttendees:0}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.asap=function(e){return new Promise(function(t){t(e())})};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);t.TimeoutError=o;var a=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){void 0!==this.timeoutId&&this.stop(),this.timeoutId=setTimeout(this.ontimeout,e)},e.prototype.stop=function(){clearTimeout(this.timeoutId),this.timeoutId=void 0},e}();t.Timer=a,t.defer=function(){var e,t,n=!0;return{isPending:function(){return n},promise:new Promise(function(n,i){e=n,t=i}),resolve:function(t){n&&(e(t),n=!1)},reject:function(e){n&&(t(e),n=!1)}}},t.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},t.timeout=function(e,t,n,i){var r,o=new Promise(function(e,i){r=setTimeout(i.bind(null,new Error("Promise timed out "+(n?": "+n:"")+" after "+t+" ms")),t)}),a=Promise.race([e,o,i]),s=function(){r&&clearTimeout(r)};return a.then(s,s),a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(9);function a(e,t){return e.toLowerCase()===t.toLowerCase()}function s(e){return e.enabled?e.send&&e.recv?r.default.MEDIA_STATE.sendReceive:e.send?r.default.MEDIA_STATE.send:e.recv?r.default.MEDIA_STATE.receive:r.default.MEDIA_STATE.inactive:null}function c(e){if(e===r.default.MEDIA_LABEL.audio)return r.default.MEDIA_TYPE.audio;if(e===r.default.MEDIA_LABEL.video)return r.default.MEDIA_TYPE.video;if(e===r.default.MEDIA_LABEL.sharing)return r.default.MEDIA_TYPE.video;throw new Error("unsupported label: "+e)}function l(e,t){for(var n=0;n<e.length;n++)if(e[n].descr.label===t)return e[n].descr;return{enabled:!1,type:c(t),label:t,send:!1,recv:!1}}function u(e,t){return i.find(t,function(t){return t.preferredPayloadType===+e})}function d(e,t){return i.find(t,function(t){return a(t.name,e)})}function p(e,t){return u(e,t).name}function f(e,t){function n(e){return{send:/send:(\S+)/.exec(e)[1].split(","),recv:/recv:(\S+)/.exec(e)[1].split(",")}}var i={send:[],recv:[]},r=n(t);if(n(e).send.forEach(function(e){-1!==r.send.indexOf(e)&&i.send.push(e)}),n(e).recv.forEach(function(e){-1!==r.recv.indexOf(e)&&i.recv.push(e)}),i.send.length||i.recv.length){var o="app";return o=i.send.length?o+" send:"+i.send.join(","):o,o=i.recv.length?o+" recv:"+i.recv.join(","):o}return null}function h(e,t){var n=[];return e.forEach(function(e){t.forEach(function(t){if(e.type===t.type)if("x-message"===e.type){var i=f(e.parameter,t.parameter);i&&n.push({type:"x-message",parameter:i})}else e.parameter===t.parameter&&n.push(e)})}),n}function g(e,t,n,r){var o=[];return e&&t&&(e.filter(function(e){return!a(e.name,"rtx")}).forEach(function(e){for(var s=0;s<t.length;s++){var c=t[s];if(a(e.name,c.name)&&a(e.kind,c.kind)&&e.numChannels===c.numChannels&&e.clockRate===c.clockRate){var l=i.shallowClone(r?c:e);l.preferredPayloadType=n?e.preferredPayloadType:c.preferredPayloadType,l.rtcpFeedback=h(e.rtcpFeedback,c.rtcpFeedback),o.push(l);break}}}),e.filter(function(e){return a(e.name,"rtx")}).forEach(function(s){for(var c=0;c<t.length;c++){var l=t[c];if(a(s.name,l.name)&&a(s.kind,l.kind)&&s.numChannels===l.numChannels&&s.clockRate===l.clockRate&&a(p(s.parameters.apt,e),p(l.parameters.apt,t))){var f=i.shallowClone(r?l:s);f.preferredPayloadType=n?s.preferredPayloadType:l.preferredPayloadType,f.parameters.apt=d(u(s.parameters.apt,e).name,o).preferredPayloadType,o.push(f);break}}})),o}function m(e,t,n,i,r,o){return p=e.codecs,f=[],p.forEach(function(e){f.push(v(e.name,e.preferredPayloadType,e.clockRate,e.numChannels,e.rtcpFeedback,e.parameters,e.ptime,e.maxptime))}),a=f,u=e.headerExtensions,d=[],u.forEach(function(e){d.push(y(e.uri,e.preferredId,e.preferredEncrypt))}),s=d,c=function(e,t){var n=[];return n.push(E(e,0,0,t,1)),n}(t,o),l=S(n,"",i,r),{muxId:"",codecs:a,headerExtensions:s,encodings:c,rtcp:l,degradationPreference:"balanced"};var a,s,c,l,u,d,p,f}function v(e,t,n,i,r,o,a,s){return{name:e,payloadType:t,clockRate:n,numChannels:i,rtcpFeedback:r,parameters:o,ptime:a,maxptime:s}}function y(e,t,n){return{uri:e,id:t,encrypt:n}}function S(e,t,n,i){return{ssrc:e,cname:t,reducedSize:n,mux:i}}function _(e){return e.some(function(e){return a(e.name,"rtx")})}function E(e,t,n,i,r,o,a,s,c,l,u,d,p,f){return{ssrc:e.min,ssrcRange:e,codecPayloadType:t,fec:n,rtx:i?{ssrc:i}:0,priority:r||1,maxBitrate:o,minQuality:a||0,framerateBias:s||.5,resolutionScale:c||1,framerateScale:l||1,active:d||!0,encodingId:p,dependencyEncodingId:f}}t.default={groupsToSdp:function(e){return e.groups&&0!==e.groups.length?[{mids:e.groups.join(" "),type:"BUNDLE"}]:null},getStateFromDescr:s,getDescrFromState:function(e,t,n){var i=function(e,t){return t===r.default.MEDIA_LABEL.audio?e.audio:t===r.default.MEDIA_LABEL.video?e.video:t===r.default.MEDIA_LABEL.sharing?e.sharing:null}(e,t);return{enabled:!!i,mediaId:n,type:c(t),label:t,send:o.hasSendDirectionality(i),recv:o.hasReceiveDirectionality(i),needsTransport:!1}},getCodecIndexByPayload:function(e,t){return i.findIndex(t,function(t){return t.preferredPayloadType===e})},getTransportIndexById:function(e,t){return i.findIndex(e,function(e){return e.transportId===t})},findDescrFromMedia:l,getModalitiesFromMedia:function(e){var t={},n=l(e,r.default.MEDIA_LABEL.audio),i=l(e,r.default.MEDIA_LABEL.video),o=l(e,r.default.MEDIA_LABEL.sharing);return n.enabled&&(t.audio=s(n)),i.enabled&&(t.video=s(i)),o.enabled&&(t.sharing=s(o)),t},findMatchingSdesParams:function(e,t){for(var n=0;n<t.length;++n)for(var r=t[n],o=0;o<e.length;++o){var a=e[o];if(c=a,l=void 0,u=void 0,l=(s=r).keyParams[0],u=c.keyParams[0],s.cryptoSuite===c.cryptoSuite&&l.mkiLength===u.mkiLength&&l.mkiValue===u.mkiValue)return{localSdesParams:i.shallowClone(a),remoteSdesParams:i.shallowClone(r)}}var s,c,l,u;return null},matchXMessage:f,matchRtpCaps:function(e,t,n,i){var r=null;return e&&t&&(r={codecs:g(e.codecs,t.codecs,n,i),headerExtensions:function(e,t){var n=[];return e&&t&&e.forEach(function(e){for(var i=0;i<t.length;i++){var r=t[i];e.kind===r.kind&&e.uri===r.uri&&n.push(e)}}),n}(e.headerExtensions,t.headerExtensions),fecMechanisms:e.fecMechanisms.filter(function(e){return-1!==t.fecMechanisms.indexOf(e)})}),r},matchRtcpFeedback:h,getSendParams:m,getRecvParams:function(e,t,n,i,r,o){return m(e,t,n,i,r,o)},RTCRtpCodecParameters:v,RTCRtpHeaderExtensionParameters:y,RTCRtcpParameters:S,hasRtx:_,getRtxSsrc:function(e,t,n,i){return _(e.codecs)?i?t.rtxSsrc:n.rtxSsrc:0},RTCRtpEncodingParameters:E,getCodecByName:d}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.SourceNone=-1,e.SourceAny=-2,e}();t.MediaSourceIdentifiers=i},,function(e,t,n){"use strict";var i,r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.jsCallEndCodes={Cancel:487,Reject:603,NoNgcEndpoint:480,Forbidden:403,PreconditionFailed:412,Success:0,BadRequest:400,NotFound:404,NotAcceptable:406,Timeout:408,Conflict:409,MediaError:410,ConfParticipantCountLimitReached:413,CallAccepted:450,CallForwarded:451,CallForwardedToVoicemail:452,P2pRejectCall:453,P2pFallbackForScreensharing:460,P2pFallbackDueToGroupCall:461,CallLegEndedOnService:470,CallDoesNotExist:481,NotAcceptableHere:488,NetworkError:490,GlareError:491,SkypeTokenError:495,LocalHttpStackError:496,UnknownError:497,LocalError:498,InternalServerError:500,CallModalityFailure:580,ServiceUnavailable:503},t.jsCallEndSubCodes={Success:0,InsufficientCapabilities:5204,PolicyRestriction:5448,UserBlocked:10005,MaxLobbyParticipantLimitReached:5807,MaxParticipantLimitReached:5808,MaxParticipantLimitReached2:5817,SharingStolenError:10029,MediaDropDuringConnect:3100,MediaDropAfterConnect:3101,MediaAnswerProcessingError:3102,MediaFinalAnswerProcessingError:3103,MediaOfferTimeout:3104,MediaFinalAnswerTimeout:3105,MediaOfferNull:3106,MediaAudioDeviceError:3107,MediaRenegotiationError:3108,MediaPermissionError:3109,MediaUnknownError:3110,MediaOfferProcessingError:3111,MediaWhiteListingIssue:3112,MediaMuteMicrophoneError:3113,MediaMuteSpeakerError:3114,MediaUnmuteMicrophoneError:3115,MediaUnmuteSpeakerError:3115,AttachActionFailed:4103,AttachFailed:4105,PreheatedCallTimedout:4113,RemovedFromConversation:5e3,DeniedInLobby:5854,RemovedFromCall:5300,TimedOutInLobby:5855,AnonymousJoinDisabledByPolicy:5723,B2bJoinDisabledByPolicy:5724,NoLobbyForBroadcastJoin:5354,NotAllowedDueToInformationBarrier:5810,TeamParkPolicyDisabled:10193,BroadcastLimitReached:800100},t.responseCodeMap=((i={})[t.jsCallEndCodes.Success]=1,i[t.jsCallEndCodes.Cancel]=12,i[t.jsCallEndCodes.Reject]=10,i[t.jsCallEndCodes.NoNgcEndpoint]=2,i[t.jsCallEndCodes.Timeout]=6,i[t.jsCallEndCodes.CallAccepted]=30,i[t.jsCallEndCodes.NotFound]=24,i[t.jsCallEndCodes.CallDoesNotExist]=46,i[t.jsCallEndCodes.NotAcceptable]=5,i[t.jsCallEndCodes.BadRequest]=5,i[t.jsCallEndCodes.MediaError]=4,i[t.jsCallEndCodes.ConfParticipantCountLimitReached]=59,i[t.jsCallEndCodes.CallModalityFailure]=4,i[t.jsCallEndCodes.NetworkError]=3,i[t.jsCallEndCodes.LocalHttpStackError]=31,i[t.jsCallEndCodes.LocalError]=25,i[t.jsCallEndCodes.CallForwarded]=27,i[t.jsCallEndCodes.CallForwardedToVoicemail]=28,i[t.jsCallEndCodes.SkypeTokenError]=29,i[t.jsCallEndCodes.InternalServerError]=7,i[t.jsCallEndCodes.Conflict]=7,i[t.jsCallEndCodes.GlareError]=7,i[t.jsCallEndCodes.CallLegEndedOnService]=7,i[t.jsCallEndCodes.NotAcceptableHere]=26,i[t.jsCallEndCodes.UnknownError]=32,i[t.jsCallEndCodes.Forbidden]=8,i[t.jsCallEndCodes.PreconditionFailed]=65,i),t.pstnConsumerResponseCodeMap=((r={})[9401]=33,r[9422]=33,r[6102]=1,r[6423]=14,r[9402]=14,r[9432]=14,r[6519]=3,r[9403]=15,r[9410]=36,r[9411]=37,r[1e3]=2,r[9407]=17,r[13430]=18,r[6009]=19,r[10484]=19,r[10604]=19,r[10404]=19,r[10420]=19,r[10403]=20,r[17401]=20,r[10408]=9,r[10486]=11,r[10600]=11,r[10686]=11,r[10487]=21,r[10500]=3,r[10501]=3,r[10502]=3,r[10503]=3,r[10504]=3,r[10480]=22,r[10482]=22,r[10603]=10,r[13406]=23,r[13416]=23,r),t.pstnEnterpriseResponseCodeMap=((o={})[500]=39,o[403]=41,o[404]=42,o[480]=40,o),t.incomingCallEvents={INCOMING_SKYPE_NGC_CALL:107,INCOMING_SKYPE_NGC_GVC_CALL:109,INCOMING_PSTN_NGC_CALL:111,INCOMING_SCREENSHARE_WITH_CHAT:119},t.proxiedEvents={SHARED_LINE_CALL_RECORD:121},t.logUploadEvents={LOG_UPLOAD_EVENT:120},function(e){e[e.CallTerminationSubCodeSipGWMin=2e5]="CallTerminationSubCodeSipGWMin",e[e.CallTerminationSubCodeSipGWMax=299999]="CallTerminationSubCodeSipGWMax"}(t.PstnTerminationCode||(t.PstnTerminationCode={})),function(e){e[e.CallTerminationSubCodeSipGWMin=4e5]="CallTerminationSubCodeSipGWMin",e[e.CallTerminationSubCodeSipGWMax=499999]="CallTerminationSubCodeSipGWMax"}(t.EnterpisePstnTerminationCode||(t.EnterpisePstnTerminationCode={})),function(e){e[e.Unmuted=0]="Unmuted",e[e.ServerMuted=1]="ServerMuted",e[e.Muted=2]="Muted",e[e.AttemptingUnmute=3]="AttemptingUnmute"}(t.ParticipantMuteState||(t.ParticipantMuteState={})),function(e){e[e.Undefined=0]="Undefined",e[e.Hold=1]="Hold",e[e.Resume=2]="Resume"}(t.RenegotiationOfferType||(t.RenegotiationOfferType={})),t.jsCallEndPhrase={Unknown:"CallEndReasonUnknown",MediaError:"CallEndReasonMediaError",MediaOfferTimeout:"CallEndReasonMediaOfferTimeout",MediaFinalAnswerTimeout:"CallEndReasonMediaFinalAnswerTimeout",MediaAnswerError:"CallEndReasonMediaAnswerError",MediaFinalAnswerError:"CallEndReasonFinalAnswerError",MediaPermissionError:"CallEndReasonMediaPermissionError",MediaRenegotiationError:"CallEndReasonRenegotiationError",MediaDropDuringConnect:"CallEndReasonMediaDropDuringConnectError",MediaDropAfterConnect:"CallEndReasonMediaDropAfterConnectError",MediaOfferProcessingError:"CallEndReasonMediaOfferProcessingError",IncompatibleOffer:"CallEndReasonIncompatibleOffer",MediaWhiteListingIssue:"MediaWhitelistingIssue",AudioDeviceError:"CallEndReasonAudioDeviceError",AttachFailed:"CallEndReasonAttachFailed",BadNotificationPayload:"CallEndReasonBadNotificationPayload",RetargetNotSupported:"RetargetNotSupported",CallEndReasonLocalUserInitiated:"CallEndReasonLocalUserInitiated",EndedByRemoteEndpoint:"EndedByRemoteEndpoint"},function(e){e.MediaCreateOffer="MediaCreateOffer",e.SignalingStartNegotiation="SignalingStartNegotiation",e.SignalingRenegotiationAnswer="SignalingRenegotiationAnswer",e.MediaProcessAnswer="MediaProcessAnswer",e.MediaProcessOffer="MediaProcessOffer",e.MediaCreateAnswer="MediaCreateAnswer",e.SignalingAcceptRenegotiation="SignalingAcceptRenegotiation",e.SignalingMediaAcknowledgement="SignalingMediaAcknowledgement",e.CompleteNegotiation="CompleteNegotiation"}(t.RenegotiationPhase||(t.RenegotiationPhase={})),function(e){e.GetSignalingMediaTypes="GetSignalingMediaTypes",e.CallStart="CallStart",e.WaitForAnswer="WaitForAnswer",e.WaitForConnect="WaitForConnect",e.Accept="Accept"}(t.CallSetupSignalingPhase||(t.CallSetupSignalingPhase={})),function(e){e.InitializeMediaSession="InitializeMediaSession",e.UpdateMediaModalities="UpdateMediaModalities",e.CreateOffer="CreateOffer",e.CreateAnswer="CreateAnswer",e.ProcessAnswer="ProcessAnswer",e.GetSignalingMediaTypes="GetSignalingMediaTypes",e.MuteUnmute="MuteUnmute",e.MuteUnmuteSpeakers="MuteUnmuteSpeakers",e.StartVideoSafe="StartVideoSafe",e.CompleteNegotiation="CompleteNegotiation",e.MuteInput="MuteInput",e.MuteOutput="MuteOutput",e.UnmuteInput="UnmuteInput",e.UnmuteOutput="UnmuteOutput"}(t.CallSetupMediaPhase||(t.CallSetupMediaPhase={})),function(e){e.ProcessIncomingCallRequest="ProcessIncomingCallRequest",e.ResolvePotentialConflict="ResolvePotentialConflict",e.SendAttach="SendAttach",e.WaitForMediaOffer="WaitForMediaOffer",e.OnAcknowledgeSuccess="OnAcknowledgeSuccess"}(t.CallAckSignalingPhase||(t.CallAckSignalingPhase={})),function(e){e.InitializeMediaSession="InitializeMediaSession",e.ProcessOffer="ProcessOffer",e.ProcessOfferedModalities="ProcessOfferedModalities",e.TrySendingProvisionalAnswer="TrySendingProvisionalAnswer"}(t.CallAckMediaPhase||(t.CallAckMediaPhase={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){}},function(e,t,n){"use strict";var i,r,o,a,s,c,l=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var u,d,p,f,h=n(8),g=n(76),m=n(32);!function(e){e[e.CallStateChanged=0]="CallStateChanged",e[e.TrouterStateChanged=1]="TrouterStateChanged",e[e.MultiPartyModeSet=2]="MultiPartyModeSet",e[e.MediaRetargetSucceeded=3]="MediaRetargetSucceeded",e[e.MediaRetargetFailed=4]="MediaRetargetFailed"}(u=t.CallEvent||(t.CallEvent={})),function(e){e[e.StartModality=0]="StartModality",e[e.StopModality=1]="StopModality",e[e.StreamStateChanged=2]="StreamStateChanged",e[e.NegotiationStateChanged=3]="NegotiationStateChanged"}(d=t.MediaEvent||(t.MediaEvent={})),function(e){e[e.SelectSource=0]="SelectSource",e[e.AttachSource=1]="AttachSource",e[e.DetachSource=2]="DetachSource"}(p=t.MediaSenderEvent||(t.MediaSenderEvent={})),function(e){e[e.Available=0]="Available",e[e.Subscribe=1]="Subscribe",e[e.Subscribed=2]="Subscribed",e[e.Unsubscribe=3]="Unsubscribe",e[e.Unsubscribed=4]="Unsubscribed",e[e.RenderingStarted=5]="RenderingStarted",e[e.RenderingStopped=6]="RenderingStopped"}(f=t.MediaReceiverEvent||(t.MediaReceiverEvent={}));var v=function(e,t){this.value=e,this.piiKind=t},y=function(){function e(){}return e.agentEnvironmentId="agent_environment_id",e.correlationId="CorrelationId",e.participantId="participant_id",e.tenantId="TenantId",e.endpointId="endpoint_id",e.mediaLegId="media_leg_id",e.webMediaConfigIds="web_media_config_ids",e.tsCallingVersion="ts_calling_version",e}();t.Props=y;var S=function(){function e(){}return e.diagnostics="MediaDiagnostic",e.qoeStats="QoE",e.ortcReports="ortc_reports",e.ortcReportsInitial="ortc_reports_initial",e.webrtcSession="webrtc_session",e.webrtcSessionInitial="webrtc_session_initial",e.mediaSession="pluginless_modality_session",e.callSession="pluginless_call_session",e}();t.Events=S;var _=function(){function e(e){this.eventName=e,this.ended=!1,this.events=[]}return e.prototype.setLocalUserId=function(e){this.localUserId=e},e.prototype.start=function(){this.ended||(this.startTime=Date.now())},e.prototype.end=function(e){void 0===e&&(e=0),this.ended||(this.ended=!0,this.resultCode=e)},e.prototype.asStatsRecord=function(e){var t=this;if(void 0===e&&(e={}),h.isEmpty(this.events))return null;var n=h.uniqBy(this.events,function(e){return JSON.stringify(e)}).map(function(e){var n,i=((n={})[e.type]=e.timestamp-t.startTime,n);return h.isEmpty(e.data)||(i.data=e.data),i});return{name:this.eventName,record:h.assign({LocalUser:this.localUserId,ResultCode:String(this.resultCode),EventTimestampBag:JSON.stringify({eventStart:this.startTime,events:n})},e)}},e.prototype.add=function(e){!this.ended&&e.type&&(h.isUndefined(this.startTime)&&(this.startTime=Date.now()),h.isUndefined(e.timestamp)&&(e.timestamp=Date.now()),this.events.push(e))},e}(),E=function(e){function t(){return e.call(this,S.callSession)||this}return l(t,e),t.prototype.callStateChanged=function(n){e.prototype.add.call(this,{type:u[u.CallStateChanged],data:t.callStateToString[n]||n})},t.prototype.event=function(t){e.prototype.add.call(this,{type:u[t]})},t.callStateToString=((r={})[0]="None",r[1]="Notified",r[2]="Connecting",r[3]="Connected",r[4]="LocalHold",r[5]="RemoteHold",r[6]="Disconnecting",r[7]="Disconnected",r[8]="Observing",r[10]="Lobby",r),t}(_);t.CallStats=E;var T=function(e){function t(n,i){var r=e.call(this,S.mediaSession)||this;return r.mediaType=n,r.mediaDirection=i,r.streamDirection=t.mediaDirectionToStream[r.mediaDirection],r}return l(t,e),t.prototype.addEvent=function(t,n){e.prototype.add.call(this,{type:t,data:n})},t.prototype.lifecycle=function(e){this.addEvent(d[e])},t.prototype.streamStateChanged=function(e,n){void 0===n&&(n=this.streamDirection);var i=d[d.StreamStateChanged];this.addEvent(i,{state:t.streamStateToString[e],direction:t.streamDirectionToString[n]})},t.prototype.negotiationStateChanged=function(e,n,i){void 0===i&&(i=this.streamDirection);var r=d[d.NegotiationStateChanged];this.addEvent(r,{state:t.negotiationStateToString[e],reason:n})},t.prototype.asStatsRecord=function(n){return void 0===n&&(n={}),e.prototype.asStatsRecord.call(this,h.assign({MediaType:t.mediaTypeToString[this.mediaType],Role:t.mediaDirectionToRole[this.mediaDirection]},n))},t.negotiationStateToString={started:"NegotiationStarted",rejected:"NegotiationRejected",completed:"NegotiationCompleted"},t.streamStateToString={created:"StreamCreated",started:"StreamStarted",active:"StreamActive",inactive:"StreamInactive",stopped:"StreamStopped",removed:"StreamRemoved",failed:"StreamFailed",cancelled:"StreamCancelled"},t.streamDirectionToString={send:"Send",receive:"Receive"},t.mediaTypeToString=((o={})[0]="Audio",o[1]="Video",o[3]="ScreenShare",o[4]="Data",o),t.mediaDirectionToRole=((a={})[1]="Receiver",a[2]="Sender",a[4]="Bidirectional",a),t.mediaDirectionToStream=((s={})[1]="receive",s[2]="send",s),t}(_);t.MediaModalityStats=T;var C=function(e){function t(){return e.call(this,0,4)||this}return l(t,e),t.prototype.start=function(){e.prototype.start.call(this),e.prototype.lifecycle.call(this,d.StartModality)},t.prototype.stop=function(){e.prototype.lifecycle.call(this,d.StopModality)},t}(T);t.AudioStats=C;var I=function(e){function t(t){var n=e.call(this,t,2)||this;return n.mediaType=t,n}return l(t,e),t.prototype.start=function(){e.prototype.start.call(this),e.prototype.lifecycle.call(this,d.StartModality)},t.prototype.stop=function(){e.prototype.lifecycle.call(this,d.StopModality)},t.prototype.event=function(t){e.prototype.addEvent.call(this,p[t])},t}(T);t.MediaSenderStats=I;var A=function(e){function t(t,n){var i=e.call(this,t,1)||this;return i.mediaType=t,i.remoteParticipantId=n,i.rendererCounter=0,i}return l(t,e),t.prototype.newRendererId=function(){return this.rendererCounter+=1,String(this.rendererCounter)},t.prototype.event=function(t,n,i){e.prototype.addEvent.call(this,f[t],h.isUndefined(i)?{rendererId:n}:{rendererId:n,sourceId:i})},t.prototype.asStatsRecord=function(){return e.prototype.asStatsRecord.call(this,{TargetUser:this.remoteParticipantId})},t}(T);t.MediaReceiverStats=A;var b=function(){function e(){this.allStats=[],this.ended=!1}return e.prototype.setLocalUserId=function(e){this.localUserId=e},Object.defineProperty(e.prototype,"call",{get:function(){return this.callStats||this.startCall()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audio",{get:function(){return this.audioStats||this.newSession(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this.videoStats||this.newSession(1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenShare",{get:function(){return this.sharingStats||this.newSession(3)},enumerable:!0,configurable:!0}),e.prototype.renderer=function(e,t){var n=this.renderingStats[t];return n||(n=this.renderingStats[t]=this.receive(e,t)),n},e.prototype.startCall=function(){return this.callStats?this.callStats:(this.callStats=new E,this.callStats.start(),this.addStats(this.callStats))},e.prototype.endCall=function(e){void 0===e&&(e=0),this.ended=!0,this.call.end(e),this.allStats.forEach(function(e){return e.end()}),this.cleanUp()},e.prototype.cleanUp=function(){this.audioStats&&(this.audioStats.stop(),this.audioStats=null),this.videoStats&&(this.videoStats.stop(),this.videoStats=null),this.sharingStats&&(this.sharingStats.stop(),this.sharingStats=null)},e.prototype.newSession=function(e){var t;switch(e){case 0:t=this.audioStats=new C;break;case 1:t=this.videoStats=new I(e);break;case 3:t=this.sharingStats=new I(e)}return this.addStats(t)},e.prototype.receive=function(e,t){var n=new A(e,t);return n.start(),this.addStats(n)},e.prototype.buildStatsRecords=function(){return this.allStats.map(function(e){return e.asStatsRecord()}).filter(function(e){return!!e})},e.prototype.addStats=function(e){return this.ended||(this.allStats.push(e),e.setLocalUserId(this.localUserId)),e},e}();t.LocalStats=b;var R=function(){function e(){this.localStats=new b,this.tsCallingVersion=m.getTsCallingVersion()}return e.prototype.setCallId=function(e){this.callId=e},e.prototype.setTenantId=function(e){this.tenantId=e},e.prototype.setParticipantId=function(e){this.participantId=e},e.prototype.setEndpointId=function(e){this.endpointId=e},e.prototype.setMediaLegId=function(e){this.mediaLegId=e},e.prototype.setMediaStats=function(e){this.mediaStats=e},e.prototype.appendTerminationInfo=function(e,t){this.mediaStats&&this.mediaStats.data&&(this.mediaStats.data.TerminatedReason=""+e,this.mediaStats.data.TerminatedState=""+t)},e.prototype.setWebMediaConfigIds=function(e){this.webMediaConfigIds=Array.isArray(e)?e.join(","):e},e.prototype.buildFromMediaStats=function(){return this.mediaStats?"OrtcMediaStats"===this.mediaStats.type?[this.buildEvent(this.mediaStats.data,S.ortcReports)]:"WebRtcMediaStats"===this.mediaStats.type?[this.buildEvent(this.mediaStats.data,S.webrtcSession)]:[]:[]},e.prototype.buildMediaTelemetry=function(){if(this.mediaStats){var e=this.buildEvent(this.mediaStats.data,null).props,t={};return Object.keys(e).forEach(function(n){void 0===e[n].piiKind?t[n]=e[n]:t[n]=e[n].value}),t}},e.prototype.buildFromCallSetupStats=function(){return this.mediaStats?"OrtcMediaStats"===this.mediaStats.type?[this.buildEvent(this.mediaStats.data,S.ortcReportsInitial)]:"WebRtcMediaStats"===this.mediaStats.type?[this.buildEvent(this.mediaStats.data,S.webrtcSessionInitial)]:[]:[]},e.prototype.buildFromLocalStats=function(){var e=this;return this.localStats.buildStatsRecords().map(function(t){return e.buildEvent(t.record,t.name)})},e.prototype.buildEvent=function(t,n){var i={};return i[y.agentEnvironmentId]=e.agentEnvironmentId,i[y.correlationId]=this.callId||"",i[y.tenantId]=this.tenantId||"",i[y.participantId]=this.participantId||"",i[y.endpointId]=this.endpointId||"",i[y.mediaLegId]=this.mediaLegId||"",i[y.webMediaConfigIds]=this.webMediaConfigIds||"",i[y.tsCallingVersion]=this.tsCallingVersion||"",{eventName:n,props:this.buildProps(t,null,i)}},e.prototype.normalizeKey=function(e){return e.replace(/[^a-zA-Z0-9._]/g,"_")},e.prototype.createPiiValueFromMAStat=function(t,n){if(!(n in e.piiDict))throw new Error("unknown PII type");return new v(t,e.piiDict[n])},e.prototype.buildProps=function(e,t,n){var i=this;return h.keys(e).forEach(function(r){var o=i.normalizeKey(r),a=t?t+"_"+o:o,s=e[r];if(h.isString(s))n[a]=i.getPiiAwareValue(r,s);else if(h.isArray(s)){if(s.length>0){var c=s,l=c.map(function(e){return e.value}).toString();n[a]=i.createPiiValueFromMAStat(l,c[0].type)}}else if(h.isObject(s))if(s.__VALUE__){var u=s;h.isBoolean(u.value)&&(u.value=u.value?"true":"false"),n[a]=i.createPiiValueFromMAStat(u.value,u.type)}else i.buildProps(s,a,n)}),n},e.prototype.getPiiAwareValue=function(t,n){return e.piiProps.hasOwnProperty(t)?new v(n,e.piiProps[t]):n},e.prototype.build=function(){return h.flatten([this.buildFromMediaStats(),this.buildFromLocalStats()])},e.agentEnvironmentId=g.default(),e.piiProps={IPAddr:13,MACAddr:13,IPAddress:13,OpaqueData:0,LocalSite:13,RemoteSite:13,BaseAddress:13,LocalAddress:13,RemoteAddress:13,NetworkName:12,LocalUser:10,TargetUser:10},e.piiDict=((c={})[0]=0,c[13]=13,c[4]=4,c),e}();t.CallTelemetryBuilder=R},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.streamDirections={send:"sendonly",receive:"recvonly",sendReceive:"sendrecv"},t.ngcStreamTypes={audio:"audio",video:"video",sharing:"applicationsharing-video",audioteleconference:"audio-teleconferencing"}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(15),c=n(42);function l(e){switch(e){case 1:return"crop";case 0:return"stretch";case 2:default:return"fit"}}t.toMediaAgentScalingMode=l;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isRendering=!1,t.frameType=-1,t}return r(t,e),Object.defineProperty(t.prototype,"rendererType",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype.captureFrame=function(e,t){return o(this,void 0,void 0,function(){return a(this,function(e){throw new Error("Not implemented yet")})})},t.prototype.getStats=function(){return o(this,void 0,void 0,function(){return a(this,function(e){if(this.renderer.getStats)return[2,this.renderer.getStats()];throw new Error("Renderer does not support stats")})})},t.prototype.setScalingMode=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){return this.renderer.setScalingMode(l(e)),[2]})})},t.prototype.dumpVideoSourceImages=function(){return o(this,void 0,void 0,function(){return a(this,function(e){throw new Error("Not implemented")})})},t.prototype.cameraAutoControl=function(e){return o(this,void 0,void 0,function(){return a(this,function(e){throw new Error("Not implemented")})})},t.prototype.onVideoSizeChanged=function(e,t){this.streamSize={width:e,height:t},this.isRendering=e>0&&t>0,this.raiseChanged()},t}(s.default),d=function(e){function t(t,n){var i=e.call(this)||this;return i.renderer=n.createPreviewRenderer(t),i.renderer.on("onVideoSizeChanged",function(e,t){return i.onVideoSizeChanged(e,t)}),i}return r(t,e),t.prototype.startVideoAsync=function(){return this.renderer.startVideoAsync()},t.prototype.dispose=function(){this.renderer&&(this.renderer.dispose(),this.renderer=null)},t}(u);t.LocalVideoRenderer=d;var p=function(e){function t(t,n,i){var r=e.call(this)||this;return r.rendererStats=i,r.subscriptionActive=!1,r.rendererId=i.newRendererId(),r.renderer=n.createRemoteRenderer(t),r.renderer.on("onVideoSizeChanged",function(e,t){return r.onVideoSizeChanged(e,t)}),r.renderer.on("onVideoStateChanged",function(e){return r.onVideoStateChanged(e)}),r}return r(t,e),t.prototype.onVideoStateChanged=function(e){this.rendererStats.streamStateChanged(e.stream)},t.prototype.onVideoSizeChanged=function(t,n){var i=this.isRendering;e.prototype.onVideoSizeChanged.call(this,t,n),this.isRendering!==i&&this.rendererStats.event(this.isRendering?c.MediaReceiverEvent.RenderingStarted:c.MediaReceiverEvent.RenderingStopped,this.rendererId)},t.prototype.subscribeVideoAsync=function(e){var t=this;this.rendererStats.event(c.MediaReceiverEvent.Subscribe,this.rendererId,e.id);var n=this.renderer.subscribeVideoAsync(e.id,1===e.type);return this.subscriptionActive=!0,n.then(function(){t.rendererStats.event(c.MediaReceiverEvent.Subscribed,t.rendererId,e.id),t.watchStream(e)}),n},t.prototype.watchStream=function(e){var t=this;this.changeSub&&this.changeSub.dispose(),this.changeSub=e.changed(function(){e.isAvailable?t.subscriptionActive||t.subscribeVideoAsync(e):(t.subscriptionActive=!1,t.rendererStats.event(c.MediaReceiverEvent.Unsubscribe,t.rendererId),t.renderer.unsubscribeNow(),t.rendererStats.event(c.MediaReceiverEvent.Unsubscribed,t.rendererId))})},t.prototype.dispose=function(){this.renderer&&(this.subscriptionActive&&this.rendererStats.event(c.MediaReceiverEvent.Unsubscribe,this.rendererId),this.renderer.dispose(),this.subscriptionActive&&this.rendererStats.event(c.MediaReceiverEvent.Unsubscribed,this.rendererId),this.renderer=null),this.changeSub&&(this.changeSub.dispose(),this.changeSub=null)},t}(u);t.RemoteVideoRenderer=p;var f=function(e){function t(t,n,i){var r=e.call(this)||this;return r.imageRenderingSession=t,r.target=n,r.id=i,r}return r(t,e),t.prototype.start=function(e){var t=this;return this.renderer?Promise.reject("RemoteImageRenderer already started id: "+this.id):this.imageRenderingSession?(this.renderer=this.imageRenderingSession.imageRendererProvider.createRenderer({frameUris:e,frameContainer:this.target,callParams:this.imageRenderingSession.callParams,id:this.id}),this.eventSubscription=this.renderer.once("onRendererDisposed",function(){t.dispose()}),this.renderer.start().then(function(){t.isRendering=!0,t.raiseChanged()}).catch(function(e){return t.dispose(),Promise.reject(e)})):Promise.reject("imageRenderingSession not provided id: "+this.id)},t.prototype.dispose=function(){this.renderer&&(this.renderer.dispose(),this.renderer=void 0),this.eventSubscription&&(this.eventSubscription.dispose(),this.eventSubscription=void 0),this.isRendering=!1,this.raiseChanged()},t}(u);t.RemoteImageRenderer=f},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),a=n(15),s=n(18),c=n(43),l=function(e){function t(t,n,i){var r=e.call(this)||this;return r.mediaSession=t,r.isAvailable=!1,r.isStreaming=!1,r.mediaSessionInitPromise=new s.SettablePromise,t&&r.mediaSessionInitPromise.resolve(),r.id=i,r.logger=n.createChild("Stream["+r.id+"]"),r}return r(t,e),t.prototype.update=function(e,t){var n=void 0===e?{}:e,i=n.sourceId,r=void 0===i?null:i,a=n.direction,s=void 0===a?c.streamDirections.receive:a,l=n.participantId,u=void 0===l?null:l,d=n.endpointId,p=void 0===d?null:d;this.logger.info("["+t+"][update before]  sourceId="+r+", direction="+s+", participantId="+u+", endpointId="+o.truncate(p,8)),this.id=r,this.isAvailable=s===c.streamDirections.sendReceive||s===c.streamDirections.send,this.participantId=u,this.endpointId=p,this.logger.info("["+t+"][update after]  sourceId="+r+", direction="+s+", participantId="+u+", endpointId="+o.truncate(p,8)),this.raiseChanged()},t.prototype.setMediaSession=function(e,t){var n=e&&e.getAllowedModalities&&e.getAllowedModalities()||{};this.logger.info("["+t+"][setMediaSession] "+JSON.stringify(n)),this.mediaSession=e,e?this.mediaSessionInitPromise.resolve():this.mediaSessionInitPromise.reject(new Error("MediaSession is null"))},t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t}(a.default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.requestDispatcherImpl=n(162),this.policy=n(163)}return e.prototype.getRequestOptions=function(e,t,n,i,r){return{headers:t||{},retry:this.policy,reporting:{serviceName:"ngcCallController-"+(e||"")},payload:n||null,timeout:i||null,responseType:r}},e.prototype.getAsync=function(e,t){return this.requestDispatcherImpl.get(e,t)},e.prototype.postAsync=function(e,t){return this.requestDispatcherImpl.post(e,t)},e.prototype.putAsync=function(e,t){return this.requestDispatcherImpl.put(e,t)},e.prototype.removeAsync=function(e,t){return this.requestDispatcherImpl.remove(e,t)},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(164),c=n(47),l=n(27),u=function(){function e(){this.providers=[],this.initState={}}return e.getInstance=function(){return e.instance},e.prototype.init=function(e){return o(this,void 0,void 0,function(){var t,n=this;return a(this,function(i){switch(i.label){case 0:return[4,Promise.resolve()];case 1:return i.sent(),(t=this.config&&this.config.detectH264Support)?[4,l.UserAgentConfig.hasH264CodecSupport(this.config.logger)]:[3,3];case 2:t=!i.sent(),i.label=3;case 3:if(t)throw[new d("H264 is not supported","not_supported")];if(this.initState=this.providers.reduce(function(t,i){if(t.instance)return t;try{return{instance:i(e),errors:[]}}catch(e){return n.config&&n.config.logger.error("Error during mediaAgent initialization",e),t.errors.push(e),t}},{errors:[],instance:void 0}),!this.initState.instance)throw this.initState.errors;return[2]}})})},e.prototype.register=function(e){this.providers.push(e)},e.prototype.configure=function(e){if(this.config)throw new Error("media agent factory already configured");this.config=e},e.prototype.getAgent=function(){return this.mediaAgent||(this.mediaAgent=this.createAgent()),this.mediaAgent},e.prototype.reset=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return this.config=void 0,this.mediaAgent?[4,this.mediaAgent.dispose(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.mediaAgent=void 0,[2]}})})},e.prototype.createAgent=function(){var e=this;if(!this.config)throw new Error("factory must be configured before trying to obtain media agent");var t={logger:this.config.logger,safeLogger:this.config.safeLogger,settings:this.config.settings,tokenProvider:this.config.tokenProvider,relayConfigProvider:function(){return e.config.configProvider.getRelayConfig()},mediaConfigProvider:function(){return e.config.configProvider.getSkypeConfig()},relayManager:this.config.relayManager||this.buildRelayManager(),domOverrides:this.config.domOverrides};return t.relayManager.initialize(),this.build(this.config.deviceEvents,t)},e.prototype.build=function(e,t){if(this.initState.instance)return this.initState.instance.build(e,t);throw new Error("no media agent provider available on current platform")},e.prototype.buildRelayManager=function(){var e=this,t=this.config.httpRequestDispatcher||new c.default;return s.build({logger:this.config.logger,tokenProvider:this.config.tokenProvider,trapTokenCredentialsProvider:this.config.trapTokenCredentialsProvider,configProvider:function(){return e.config.configProvider.getRelayConfig()},request:{get:function(e,n){return t.getAsync(e,t.getRequestOptions("GET",n&&n.headers,null,n&&n.timeout))},isOnline:this.config.appStateProvider.isOnline}})},e.instance=new e,e}();t.default=u;var d=function(e){function t(t,n){void 0===n&&(n="failure");var i=e.call(this,t)||this;return i.reason=n,i}return r(t,e),t}(Error);t.MediaAgentError=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(12),s=n(14),c=function(e){function t(t){var n=e.call(this)||this;return n.window=a.default.window,n.lastNotifiedVideoWidth=0,n.lastNotifiedVideoHeight=0,n.isVideoAttached=!1,n.onVideoDataUpdated=function(){var e=n.video.videoWidth,t=n.video.videoHeight;(e<32||t<32)&&(e=t=0),n.lastNotifiedVideoWidth===e&&n.lastNotifiedVideoHeight===t||(n.lastNotifiedVideoWidth=e,n.lastNotifiedVideoHeight=t,n.event("onVideoSizeChanged").raise(e,t)),n.video&&n.video.paused&&n.video.play()},n.onVideoError=function(){n.event("onError").raise(n.video.error||"no video")},n.onVideoPaused=function(){"Edge"===s.getBrowserInfo().name&&(n.window.attachMediaStream(n.video,null),n.window.attachMediaStream(n.video,n.stream)),n.video.play()},n.onContextMenu=function(e){e.preventDefault()},n.container=t,n.video=t.ownerDocument.createElement("video"),n.video.style.width="100%",n.video.style.height="100%",n.video.setAttribute("playsinline","true"),n.initialize(),n}return r(t,e),t.prototype.getVideoElement=function(){return this.video},t.prototype.dispose=function(){this.isVideoAttached&&(this.container.removeChild(this.video),this.isVideoAttached=!1),this.detachEventListeners(),this.video=null,this.stream=null},t.prototype.reattachEventListeners=function(){this.detachEventListeners(),this.attachEventListeners()},t.prototype.attachMediaStream=function(e){this.stream!==e&&(this.stream&&this.window.detachMediaStream(this.video),e&&(this.video.hidden=0===e.getVideoTracks().length,this.window.attachMediaStream(this.video,e),this.isVideoAttached||(this.container.appendChild(this.video),this.isVideoAttached=!0)),this.stream=e)},t.prototype.setScalingMode=function(e){this.video.style.objectFit=function(e){switch(e){case"crop":return"cover";case"stretch":return"fill";case"fit":default:return"contain"}}(e)},t.prototype.getMediaStream=function(){return this.stream},t.prototype.initialize=function(){this.video.autoplay=!0,this.video.muted=!0,this.attachEventListeners()},t.prototype.attachEventListeners=function(){this.video.addEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.addEventListener("timeupdate",this.onVideoDataUpdated),this.video.addEventListener("error",this.onVideoError),this.video.addEventListener("pause",this.onVideoPaused),this.video.addEventListener("contextmenu",this.onContextMenu)},t.prototype.detachEventListeners=function(){this.video.removeEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.removeEventListener("timeupdate",this.onVideoDataUpdated),this.video.removeEventListener("error",this.onVideoError),this.video.removeEventListener("pause",this.onVideoPaused),this.video.removeEventListener("contextmenu",this.onContextMenu),this.attachMediaStream(null)},t}(o.default);t.VideoRendererBase=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e,t,n){void 0===n&&(n=!0),this.audio=e,this.video=t,this.withTimeout=n}return e.prototype.clone=function(){var t=i.deepClone(this.video);return new e(i.deepClone(this.audio),t,this.withTimeout)},e}();t.ConstraintsObject=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=[30,15,7.5,3.75,1.875];function o(e,t){if(e&&e.getSettings){var n=e.getSettings();if(n)return{width:n.width,height:n.height}}return t}function a(e){if(e&&e.getSettings){var t=e.getSettings();if(t)return i.getClosestValue(r,t.frameRate,!0)}return 0}t.getResolutionForStream=function(e,t){return e&&e.getVideoTracks()[0]?o(e.getVideoTracks()[0],t):t},t.getResolutionForTrack=o,t.getFrameRateForStream=function(e){return e&&e.getVideoTracks()[0]?a(e.getVideoTracks()[0]):0},t.getFrameRateForTrack=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=function(){function e(e,t,n,i){this.deviceId=e,this.label=t,this.kind=n,this.groupId=i,this.type=this.getType(this.kind),this.guid=this.type+":"+e,this.isSystemDefault=e===o.default.MEDIA_DEVICE.defaultId}return e.prototype.toDeviceDesc=function(){return{id:this.guid,browserId:this.deviceId,label:this.label,kind:this.type}},e.prototype.getType=function(e){switch(e){case o.default.MEDIA_DEVICE_KIND.audioInput:return o.default.MEDIA_DEVICE.microphone;case o.default.MEDIA_DEVICE_KIND.audioOutput:return o.default.MEDIA_DEVICE.speaker;case o.default.MEDIA_DEVICE_KIND.videoInput:return o.default.MEDIA_DEVICE.camera;case o.default.MEDIA_DEVICE_KIND.compositeAudio:return o.default.MEDIA_DEVICE.compositeAudio;default:throw new Error("Device kind to recognized: "+e)}},e}(),s=function(e){function t(t,n,i,r){return e.call(this,t,n,i,r)||this}return r(t,e),t.prototype.toDeviceDesc=function(){var t=e.prototype.toDeviceDesc.call(this);return t.isSystemDefault=this.isSystemDefault,t},t}(a),c=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.position="unknown",o}return r(t,e),t.prototype.toDeviceDesc=function(){var t=e.prototype.toDeviceDesc.call(this);return t.position=this.position,t},t}(a),l=function(e){function t(t,n,i,r,o,a){var s=e.call(this,null,i,r,"")||this;return s.micDevice=t,s.speakerDevice=n,s.formFactor=o,s.isPcInternalDevice=a,s.guid=null,s.isSystemDefault=!1,s}return r(t,e),Object.defineProperty(t.prototype,"micDeviceId",{get:function(){return this.micDevice.guid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speakerDeviceId",{get:function(){return this.speakerDevice.guid},enumerable:!0,configurable:!0}),t.prototype.toDeviceDesc=function(){var t=e.prototype.toDeviceDesc.call(this);return t.microphoneId=this.micDeviceId,t.speakerId=this.speakerDeviceId,t.formFactor=this.formFactor,t.isPcInternalDevice=this.isPcInternalDevice,t},t}(a);function u(e){switch(e.kind){case o.default.MEDIA_DEVICE_KIND.audioInput:case o.default.MEDIA_DEVICE_KIND.audioOutput:return new s(e.deviceId,e.label,e.kind,e.groupId);case o.default.MEDIA_DEVICE_KIND.videoInput:return new c(e.deviceId,e.label,e.kind,e.groupId);default:throw new Error("Device kind is not recognized: "+e.kind)}}t.createDevice=u,t.createCompositeAudioDevice=function(e,t,n){return new l(e,t,n,"compositeAudio",0,!1)},t.createDefaultDevice=function(e){var t={deviceId:o.default.MEDIA_DEVICE.defaultId,label:o.default.MEDIA_DEVICE.defaultDeviceLabel,kind:function(e){switch(e){case o.default.MEDIA_DEVICE.microphone:return o.default.MEDIA_DEVICE_KIND.audioInput;case o.default.MEDIA_DEVICE.speaker:return o.default.MEDIA_DEVICE_KIND.audioOutput;case o.default.MEDIA_DEVICE.camera:return o.default.MEDIA_DEVICE_KIND.videoInput;default:throw new Error("Device type to recognized: "+e)}}(e),groupId:"",toJSON:function(){return JSON.stringify(t)}};return u(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.onActiveSpeakersChanged=e,this.onDominantSpeakersChanged=t}return e.prototype.setStrategy=function(e){this.dshStrategy=e,this.dshStrategy&&this.dshStrategy.setOnDominantSpeakerChanged(this.onDominantSpeakerHistoryChanged.bind(this))},e.prototype.onContributingSourcesChanged=function(e){this.onActiveSpeakersChanged(e),this.dshStrategy&&this.dshStrategy.setSources(e)},e.prototype.onDominantSpeakerHistoryChanged=function(e){this.onDominantSpeakersChanged(e)},e.prototype.dispose=function(){this.dshStrategy&&(this.dshStrategy.dispose(),this.dshStrategy=null),this.onActiveSpeakersChanged=null,this.onDominantSpeakersChanged=null},e}();t.ActiveSpeakerManager=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(11),c=n(16),l=n(12),u=n(0),d=function(e){function t(t,n){var i=e.call(this)||this;return i.logger=t,i.configProvider=n,i.window=l.default.window,i.isMuted=!1,i.isPlayingAllowed=!1,i.onAudioError=function(e){var t=e&&e.target||i.audio;t&&t.error?i.logger.safe.error("error with rendering audio code: "+t.error.code+", message: "+t.error.message):i.logger.safe.error("error with audio rendering")},i}return r(t,e),Object.defineProperty(t.prototype,"muted",{get:function(){return this.isMuted},enumerable:!0,configurable:!0}),t.prototype.setMuted=function(e,t){return o(this,void 0,void 0,function(){return a(this,function(n){return this.isMuted=e,e?[2,this.stopStream(t)]:[2,this.startStream(t)]})})},Object.defineProperty(t.prototype,"canPlay",{get:function(){return this.stream&&this.isPlayingAllowed},enumerable:!0,configurable:!0}),t.prototype.getStream=function(){return this.stream},t.prototype.getDeviceId=function(){return this.deviceId},t.prototype.play=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){return this.stream=e,this.isPlayingAllowed=!0,this.isMuted?[2]:[2,this.startStream()]})})},t.prototype.stop=function(){this.stopStream(),this.isPlayingAllowed=!1},t.prototype.setOutputDevice=function(e,t){return void 0===t&&(t=s.generateCauseId()),o(this,void 0,void 0,function(){var n=this;return a(this,function(i){return this.audio?this.audio.setSinkId?e?(this.logger.safe.info("["+t+"] setting audio output device ID to "+c.scrubMriOrOmit(e)),this.deviceId=e,[2,Promise.resolve(this.audio.setSinkId(e)).catch(function(e){return n.logger.safe.warn("["+t+"] setSinkId operation was aborted with error "+u.stringifyObject(e))})]):[2]:(this.logger.safe.warn("["+t+"] setting output device is not supported"),[2]):(this.deviceId=e,[2])})})},t.prototype.dispose=function(){this.logger.safe.info("dispose"),this.audio&&(this.stop(),this.stream=null,this.audio.removeEventListener("error",this.onAudioError),this.window.document.body.removeChild(this.audio),this.event("onAudioElementRemoved").raise(this.audio),this.audio=null)},t.prototype.startStream=function(e){return void 0===e&&(e=s.generateCauseId()),o(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:if(!this.canPlay)return[2];n.label=1;case 1:return n.trys.push([1,5,,6]),[4,this.assureAudioElement(e)];case 2:return n.sent(),this.logger.safe.info("["+e+"] attaching stream to renderer: "+(this.stream&&this.stream.id)),[4,this.window.attachMediaStream(this.audio,this.stream)];case 3:return n.sent(),[4,this.audio.play()];case 4:return n.sent(),[3,6];case 5:return t=n.sent(),this.logger.safe.warn("["+e+"] play operation was aborted with error "+u.stringifyObject(t)),[3,6];case 6:return[2]}})})},t.prototype.assureAudioElement=function(e){return void 0===e&&(e=s.generateCauseId()),o(this,void 0,void 0,function(){return a(this,function(t){return this.audio?[2]:(this.logger.safe.info("["+e+"] creating audio element"),this.audio=this.window.document.createElement("audio"),this.audio.addEventListener("error",this.onAudioError),this.window.document.body.appendChild(this.audio),this.audio.autoplay=!0,this.event("onAudioElementAdded").raise(this.audio),[2,this.setOutputDevice(this.deviceId,e)])})})},t.prototype.stopStream=function(e){void 0===e&&(e=s.generateCauseId()),this.audio&&this.canPlay&&(this.logger.safe.info("["+e+"] detaching stream from renderer: "+(this.stream&&this.stream.id)),this.configProvider.config.audioRendererUsePauseOnDetach?this.audio.pause():this.window.detachMediaStream(this.audio))},t}(n(6).default);t.default=d},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.sequentialize=function(){return function(e,t,n){var i=n.value;return n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.serialQueue.add(i.bind.apply(i,r([this],e)))},n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.ssrc=Math.floor(4294967039*Math.random())+1}return e.prototype.nextAudioStreamSsrc=function(){return this.nextSsrc(0)},e.prototype.nextVideoStreamSsrc=function(){return this.nextSsrc(99)},e.prototype.nextSsrc=function(e){var t;do{t=this.ssrc,this.ssrc=(this.ssrc+e+1)%4294967040,0===this.ssrc&&(this.ssrc=1)}while(t+e>4294967040);return{min:t,max:t+e}},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(0),s=n(208),c=function(e){function t(t){var n=e.call(this)||this;return n.logger=t,n.extensions=[],n}return r(t,e),t.prototype.dispose=function(){this.extensions.map(function(e){return e.dispose()}),this.extensions=[],e.prototype.dispose.call(this)},t.prototype.addExtension=function(e,t){t.manager||(t.manager=this);var n=s.default.getExtension(e);n.initialize(t),this.extensions.push(n)},t.prototype.getExtension=function(e){return a.find(this.extensions,function(t){return t.getType()===e})},t.prototype.configureExtension=function(e,t){var n=this.getExtension(e);n&&n.configure(t)},t.prototype.processNotification=function(e,t){switch(e){case"ControlVideoStreaming":this.event("onMediaStreamControlMessage").raise(t);break;case"DominantSpeakerInfo":this.event("onDominantHistoryMessage").raise(t);break;default:this.logger.safe.error("Notification message handler not found for type: "+e)}},t}(o.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),r=n(30),o=function(){function e(e,t,n,i){this.logger=e,this.qualityManager=t,this.resolutionTable=n,this.configProvider=i,this.logger=this.logger.createChild("rembModifier")}return e.prototype.getControlItem=function(){return this.controlItem},e.prototype.setControlItem=function(e){this.controlItem=e},e.prototype.dispose=function(){this.controlItem=null},e.prototype.setVideoControlMessage=function(e){this.controlItem=this.messageToControlItem(e),this.logger.safe.info("BW limit requested to "+this.controlItem.bandwidth)},e.prototype.modifyDescriptor=function(e){if(!this.controlItem)return e;var t=i.parse(e.sdp);if(!t.media[1])return this.logger.unsafe.warn("video modality is disabled, skipping sdp modification, ",e),e;var n=this.getCurrentResolutionBitrate();this.logger.safe.info("Select the BW limit as min of requested "+this.controlItem.bandwidth+" and Current Resolution Max BR "+n);var r=this.getSessionBitrate(t),o=Math.min(n,this.controlItem.bandwidth,r);if(t.media[1].bandwidth)t.media[1].bandwidth[0].limit=o;else{var a={limit:o,type:"AS"};t.media[1].bandwidth=[a]}return e.sdp=i.write(t),e},e.prototype.messageToControlItem=function(e){var t=r.default.build(e.controlVideoStreaming.controlInfo[0].fmtParams);if(!t.contains("max-br"))return null;var n=Math.round(1.2*+t.get("max-br"));return{sourceId:e.controlVideoStreaming.controlInfo[0].sourceId,streamMsid:e.controlVideoStreaming.controlInfo[0].streamMsid,bandwidth:n}},e.prototype.getCurrentResolutionBitrate=function(){var e=this.qualityManager.getCurrentResolution(),t=this.resolutionTable.getResolution(e);return e&&t?Math.floor(this.resolutionTable.getBitrateForResolution(t.width,t.height).maxBitrate/1e3):Number.MAX_VALUE},e.prototype.getSessionBitrate=function(e){var t=Number.MAX_SAFE_INTEGER;return this.configProvider.mediaConfig.maxBandwidthInKbps&&(t=this.configProvider.mediaConfig.maxBandwidthInKbps),e.bandwidth&&(t=Math.min(e.bandwidth[0].limit,t)),t-(this.configProvider.config.audioBandwidthInKbps||0)},e}();t.BandwidthControlModifier=o;var a=function(){function e(e,t){this.targetLabel=e,this.logger=t}return e.prototype.modifyDescriptor=function(e){var t=this,n=i.parse(e.sdp),r=n.media,o=r.findIndex(function(e){return e.ssrcs&&e.ssrcs.some(function(e){return"label"===e.attribute&&e.value===t.targetLabel})});if(this.lastMedia)this.logger.safe.info("Enabling ssrc "+this.targetLabel+" back"),r[this.lastMediaIndex]=this.lastMedia,this.lastMedia=void 0;else{if(-1===o)return this.logger.safe.warn("Modality for stream "+this.targetLabel+" not found"),e;this.logger.safe.info("Disabling ssrc "+this.targetLabel);var a=r[o];r[o]=c(a.type,a.protocol),this.lastMediaIndex=o,this.lastMedia=a}return e.sdp=i.write(n),e},e}();t.ModalityToggler=a;var s=function(){function e(e,t){this.mediaManager=e,this.logger=t.createChild("MediaRollbackModifier")}return e.prototype.modifyDescriptor=function(e){var t=this,n=i.parse(e.sdp);return this.mediaManager.getMediaEntities().forEach(function(e,i){!e.isDisabled()&&n.media[i]&&0!==n.media[i].port||(t.logger.safe.info("Adding disabled media "+e.getType()+", position "+i),n.media[i]=c(e.getType(),"RTP/SAVP"))}),e.sdp=i.write(n),e},e}();function c(e,t){return{type:e,port:0,payloads:"36",protocol:t}}t.MediaRollbackModifier=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SSRC_UPDATED=0]="SSRC_UPDATED",e[e.CODEC_PARAMS_UPDATED=1]="CODEC_PARAMS_UPDATED"}(t.VideoCapabilitiesEventType||(t.VideoCapabilitiesEventType={})),function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(t.MediaChannelType||(t.MediaChannelType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),r=n(30),o=n(0),a=n(2),s=n(9),c=n(28),l=n(229),u=function(){function e(e,t){this.context=e,this.sessionType=t,this.msSdpT=new l.default(this.context)}return e.prototype.modify=function(e){this.msSdpT.toMsSdp(e,{type:this.sessionType})},e}();t.MsSdpLocalModifier=u;var d=function(){function e(e,t){this.context=e,this.sessionType=t,this.msSdpT=new l.default(this.context)}return e.prototype.modify=function(e){this.msSdpT.fromMsSdp(e,{type:this.sessionType})},e}();t.MsSdpRemoteModifier=d;var p=function(){function e(e,t){this.configProvider=e,this.isMultiparty=t}return e.prototype.modify=function(e){var t=this.isMultiparty?this.configProvider.config.preferSdesSrtpMultiparty:this.configProvider.config.preferSdesSrtp1on1,n=s.getSrtpInfo(e),i=o.find(e.media,function(e){return!!e.crypto});e.media.forEach(function(e){!t&&e.fingerprint&&e.crypto&&delete e.crypto,e.protocol=!n.dtls||n.sdes&&t?a.default.PROFILES.rtpSavpf:a.default.PROFILES.udpTlsRtpSavpf,0===e.port&&e.protocol===a.default.PROFILES.rtpSavpf&&i&&(e.crypto=i.crypto)})},e}();t.IncomingSrtpFixup=p;var f=function(){function e(e,t){this.mediaManager=e,this.isOffer=t}return e.prototype.modify=function(e){var t=this;e.media.forEach(function(e,n){var i=e.setup,r=t.mediaManager.getMediaEntities()[n],o=r.getExtension("setup");i&&r.isEnabled()&&("actpass"!==i?r.setExtension("setup",i):t.isOffer&&void 0!==o&&"actpass"!==o&&(e.setup=o))})},e}();t.DtlsRoleModifier=f;var h=function(){function e(e){this.mediaManager=e}return e.prototype.modify=function(e){var t=this;e.media.forEach(function(n,i){var r=t.mediaManager.getMediaEntities()[i];(0===n.port||r.isDisabled())&&(e.media[i]=j(n.type,void 0,n.protocol))})},e}();t.DisabledMediaFixup=h;var g=function(){function e(e){this.mediaManager=e}return e.prototype.modify=function(e){this.mediaManager.getMediaEntities().forEach(function(t,n){var i=e.media[n];i&&i.type===a.default.MEDIA_TYPE.dataChannel?i.type=a.default.MEDIA_TYPE.data:t.getModality()!==a.default.MODALITY.data||i&&i.type===a.default.MEDIA_TYPE.data||e.media.splice(n,0,j(a.default.MEDIA_TYPE.data,a.default.MEDIA_LABEL.data,a.default.PROFILES.rtpSavp))})},e}();t.OutgoingDataModalityFixup=g;var m=function(){function e(){}return e.prototype.modify=function(e){for(var t=e.media.length-1;t>=0;t--){var n=e.media[t];n.type===a.default.MEDIA_TYPE.data&&(n.payloads===a.default.PAYLOAD_TYPE.DATA_CHANNEL?(n.type=a.default.MEDIA_TYPE.dataChannel,n.protocol=a.default.PROFILES.udpDtlsSctp):e.media.splice(t,1))}},e}();t.IncomingDataModalityFixup=m;var v=function(){function e(e){this.modalities=e}return e.prototype.modify=function(e){var t=this;H(e).forEach(function(e){var n=c.getModality(e);t.modalities[n]===a.default.MEDIA_STATE.send&&(e.direction&&e.direction.toLowerCase()===a.default.MEDIA_STATE.receive||(e.direction=a.default.MEDIA_STATE.receive))})},e}();t.SendOnlyModalityFixup=v;var y=function(){function e(e,t){this.isMultiparty=e,this.cname=t}return e.prototype.modify=function(e){var t=this;this.isMultiparty&&H(e).forEach(function(e){var n=e.direction;n!==a.default.MEDIA_STATE.receive&&n!==a.default.MEDIA_STATE.inactive||(e.ssrcs&&e.ssrcs[0]?e.ssrcs=[{id:e.ssrcs[0].id,attribute:"cname",value:t.cname}]:e.type===a.default.MEDIA_TYPE.audio?e.ssrcs=[{id:4195875351,attribute:"cname",value:t.cname}]:e.type===a.default.MEDIA_TYPE.video&&(e.ssrcs=[{id:1,attribute:"cname",value:t.cname}]))})},e}();t.OutSdpReceiveSsrcFixup=y;var S=function(){function e(){}return e.prototype.modify=function(e){H(e).forEach(function(e){var t=e.direction;t!==a.default.MEDIA_STATE.receive&&t!==a.default.MEDIA_STATE.inactive||e.ssrcs&&1===e.ssrcs.length&&1===e.ssrcs[0].id&&delete e.ssrcs})},e}();t.InSdpReceiveSsrcFixup=S;var _=function(){function e(e){this.mediaManager=e}return e.prototype.modify=function(e){var t=this;e.media.forEach(function(e,n){var i=t.mediaManager.getMediaEntities()[n];e.label=c.getLabelForModality(i.getModality())})},e}();t.AddLabelsModifier=_;var E=function(){function e(){}return e.prototype.modify=function(e){e.media.forEach(function(e){delete e.label})},e}();t.RemoveLabelsModifier=E;var T=function(){function e(){}return e.prototype.modify=function(e){e.media.forEach(function(e){delete e.bandwidth})},e}();t.BandwidthModifier=T;var C=function(){function e(e){this.mediaManager=e}return e.prototype.modify=function(e){var t=this;e.media.forEach(function(e,n){var i=t.mediaManager.getMediaEntities()[n],r=i.getExtension("iceUfrag");i.setExtension("iceRestart",!!e.iceUfrag&&!!r&&r!==e.iceUfrag),i.setExtension("iceUfrag",e.iceUfrag)})},e}();t.IceRestartChecker=C;var I=function(){function e(){}return e.prototype.modify=function(e){var t=new Set(["urn:ietf:params:rtp-hdrext:csrc-audio-level","http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"]);H(e).forEach(function(e){e.ext&&(e.ext=e.ext.filter(function(e){return!t.has(e.uri)}))})},e}();t.ExtensionsFixup=I;var A=function(){function e(){}return e.prototype.modify=function(e){var t=o.find(e.media,function(e){return e.type===a.default.MEDIA_TYPE.audio});c.removeCodec(t,{codec:"CN",rate:16e3})},e}();t.ComfortNoiseFixup=A;var b=function(){function e(){}return e.prototype.modify=function(e){var t=o.find(e.media,function(e){return e.type===a.default.MEDIA_TYPE.audio});c.removeCodec(t,{codec:"g722",rate:8e3,encoding:2})},e}();t.G722Fixup=b;var R=function(){function e(){}return e.prototype.modify=function(e){var t=o.find(e.media,function(e){return e.type===a.default.MEDIA_TYPE.audio});if(t&&0===t.port){var n=o.find(e.media,function(e){return!!e.iceUfrag});n&&(t.port=9,t.direction="inactive",t.iceUfrag=n.iceUfrag,t.icePwd=n.icePwd,t.rtcpMux=!0,n.crypto&&(t.crypto=n.crypto),n.fingerprint&&(t.fingerprint=n.fingerprint,t.setup=n.setup),t.rtp=[{payload:0,codec:"PCMU",rate:8e3}],t.payloads="0")}},e}();t.NoAudioFixup=R;var O=function(){function e(e){this.otherPartyCodecs=e}return e.prototype.modify=function(e){var t=this,n=o.find(e.media,function(e){return e.type===a.default.MEDIA_TYPE.audio}),i=["cn","telephone-event"],r=n.rtp.filter(function(e){return-1!==t.otherPartyCodecs.indexOf(e.codec.toLowerCase())&&-1===i.indexOf(e.codec.toLowerCase())});if(0===r.length)throw new Error("there is no matching primary audio codec");n.rtp.filter(function(e){return e!==r[0]&&-1===i.indexOf(e.codec.toLowerCase())}).forEach(function(e){c.removeCodec(n,e)})},e}();t.AudioPrimaryCodecsModifier=O;var P=function(){function e(e){this.configProvider=e,this.TRANSPORT_CC_EXT_URI="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",this.TRANSPORT_CC="transport-cc"}return e.prototype.modify=function(e){var t=this;H(e,a.default.MEDIA_TYPE.video).forEach(function(e){t.configProvider.config.webrtcEnabledTransportCC?t.enableTransportCc(e):t.disableTransportCc(e)})},e.prototype.enableTransportCc=function(e){var t=this;e.rtcpFb||(e.rtcpFb=[]),e.rtcpFb.find(function(e){return e.type===t.TRANSPORT_CC})||e.rtcpFb.filter(function(e){return"goog-remb"===e.type}).forEach(function(n){return e.rtcpFb.push({payload:n.payload,type:t.TRANSPORT_CC})})},e.prototype.disableTransportCc=function(e){var t=this;e.ext&&(e.ext=e.ext.filter(function(e){return e.uri!==t.TRANSPORT_CC_EXT_URI})),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter(function(e){return e.type!==t.TRANSPORT_CC}))},e}();t.TransportCcModifier=P;var N=function(){function e(e){this.mediaManager=e}return e.prototype.modify=function(e){var t=this;e.media.forEach(function(e,n){if(0!==e.port&&e.type===a.default.MEDIA_TYPE.video){var i=t.mediaManager.getMediaEntities()[n];c.forCodec(e,{name:"h264",rate:9e4},function(e){var t=i.getVideoCapabilities();if(t){e.fmtp=e.fmtp||{payload:e.rtp.payload};var n=r.default.build(e.fmtp.config);n.setIfMissing("profile-level-id","42C02A"),n.setIfMissing("max-fs",t.getMaxFS().toString()),n.setIfMissing("max-mbps",t.getMaxMBPS().toString()),n.setIfMissing("max-fps",t.getMaxFPS().toString()),e.fmtp.config=n.toString()}})}})},e}();t.InjectH264ParamsModifier=N;var M=function(){function e(){}return e.prototype.modify=function(e){H(e,a.default.MEDIA_TYPE.video).forEach(function(e){c.forCodec(e,{name:"h264",rate:9e4},function(e){if(e.fmtp){var t=r.default.build(),n=r.default.build(e.fmtp.config);["level-asymmetry-allowed","packetization-mode","profile-level-id"].forEach(function(e){if(n.contains(e)){var i=n.get(e);"profile-level-id"===e&&(i="42C02A"),t.setIfMissing(e,i)}}),e.fmtp.config=t.toString()}})})},e}();t.RemoveH264ParamsModifier=M;var w=function(){function e(e){this.configProvider=e}return e.prototype.modify=function(e){this.configProvider.config.enableH264SpsPpsIdrKeyframe&&H(e,a.default.MEDIA_TYPE.video).forEach(function(e){c.forCodec(e,{name:"h264",rate:9e4},function(e){if(e.fmtp){var t=r.default.build(e.fmtp.config);t.setIfMissing("sps-pps-idr-in-keyframe","1"),e.fmtp.config=t.toString()}})})},e}();t.InjectH264SpsPpsIdrInKeyframe=w;var D=function(){function e(e){this.configProvider=e}return e.prototype.modify=function(e){this.configProvider.config.enableH264SpsPpsIdrKeyframe&&H(e,a.default.MEDIA_TYPE.video).forEach(function(e){c.forCodec(e,{name:"h264",rate:9e4},function(e){if(e.fmtp){var t=r.default.build(e.fmtp.config);t.removeIfPresent("sps-pps-idr-in-keyframe"),e.fmtp.config=t.toString()}})})},e}();t.RemoveH264SpsPpsIdrInKeyframe=D;var L=function(){function e(e){this.configProvider=e}return e.prototype.modify=function(e){var t=o.findIndex(e.groups||[],function(e){return"BUNDLE"===e.type}),n=e.groups?e.groups[t]:void 0;n&&(this.configProvider.mediaConfig.isTransportUnbundled?(n.mids=this.createBundleFromMedia(e.media.filter(function(e){return e.type===a.default.MEDIA_TYPE.video})),n.mids||delete e.groups[t]):n.mids=this.createBundleFromMedia(e.media))},e.prototype.createBundleFromMedia=function(e){return e.map(function(e){return e.mid}).filter(function(e){return e}).join(" ")},e}();t.BundleGroupModifier=L;var k=function(){function e(){}return e.prototype.modify=function(e){e.media.forEach(function(e){0===e.port&&e.bundleOnly&&(e.port=9,delete e.invalid)})},e}();t.BundleOnlyMediaFixup=k;var x=function(){function e(e,t){this.configProvider=e,this.mediaManager=t}return e.prototype.modify=function(e){var t=this;if(!(this.configProvider.mediaConfig.isTransportUnbundled||e.groups&&o.find(e.groups,function(e){return"BUNDLE"===e.type}))){var n=!1;e.media.forEach(function(e,i){var r=t.mediaManager.getMediaEntities()[i];!n&&r.isEnabled()?(e.mid=r.getMid(),n=!0):(r.disable(),e.port=0)}),n&&(e.groups||(e.groups=[]),e.groups.push({type:"BUNDLE"}))}},e}();t.NoBundleInAnswerFixup=x;var F=function(){function e(e,t){this.configProvider=e,this.logger=t}return e.prototype.modify=function(e){var t=this;e.media.forEach(function(e){var n=!!e.candidates;if(e.candidates&&(e.candidates=e.candidates.filter(function(e){var n=!0,r=!0,o=!0;return t.configProvider.config.iceCandidateType&&(n=!!e.type.match(new RegExp(t.configProvider.config.iceCandidateType,"i"))),t.configProvider.config.iceCandidateTransport&&(r=!!e.transport.match(new RegExp(t.configProvider.config.iceCandidateTransport,"i"))),t.configProvider.config.iceCandidateFilterMDns&&((o=!t.isMdns(e.ip))||t.logger.safe.info("Filtering out mDNS candidate "+i.scrubMriOrOmit(e.ip)+":"+i.scrubMriOrOmit(e.port))),n&&r&&o})),n&&e.connection&&t.configProvider.config.iceCandidateFilterMDns&&(e.candidates&&0!==e.candidates.length||(e.candidates=[B(e.port)]),t.isMdns(e.connection.ip)||!t.hasMatchingCandidate(e))){var r=t.getDefaultCandidate(e);e.connection.ip=r.ip,e.port=r.port}})},e.prototype.hasMatchingCandidate=function(e){var t=e.connection;return t&&!!e.candidates.find(this.createIpAndPortMatcher(t.ip,e.port))},e.prototype.getDefaultCandidate=function(e){return e.candidates.slice().sort(function(e,t){return e.type===t.type?0:"host"===e.type||"relay"===t.type?1:"relay"===e.type||"host"===t.type?-1:0})[0]},e.prototype.isMdns=function(e){return e.indexOf(".local")>-1||e.indexOf(".encrypted")>-1},e.prototype.createIpAndPortMatcher=function(e,t){return function(n){return n.ip===e&&n.port===t}},e}();t.CandidatesFixup=F;var U=function(){function e(){}return e.prototype.modify=function(e){var t=H(e)[0];t&&(t.candidates=[B()])},e}();function j(e,t,n){return{type:e,port:0,label:t,payloads:"36",protocol:n}}function H(e,t){return void 0===t&&(t=null),e.media.filter(function(e){return 0!==e.port&&(!t||e.type===t)})}function B(e){return void 0===e&&(e=1234),{component:1,ip:"10.10.10.10",foundation:1755259772,priority:2122197247,port:9!==e?e:1234,transport:"UDP",type:"host"}}t.NoCandidatesFixup=U},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(1),r=n(20),o=i.a.isFunction,a=function(){function e(){var e=this,t=!1,n=null,i=null;e.core=null,e.diagLog=function(t){return e._getTelCtx(t).diagLog()},e.isInitialized=function(){return t},e.setInitialized=function(e){t=e},e.setNextPlugin=function(e){i=e},e.processNext=function(e,t){t?t.processNext(e):i&&o(i.processTelemetry)&&i.processTelemetry(e,null)},e._getTelCtx=function(t){void 0===t&&(t=null);var o=t;if(!o){var a=n||new r.a(null,{},e.core);o=i&&i.getPlugin?a.createNew(null,i.getPlugin):a.createNew(null,i)}return o},e._baseTelInit=function(o,a,s,c){o&&(o.extensionConfig=o.extensionConfig||[]),!c&&a&&(c=a.getProcessTelContext().getNext());var l=i;i&&i.getPlugin&&(l=i.getPlugin()),e.core=a,n=new r.a(c,o,a,l),t=!0}}return e.prototype.initialize=function(e,t,n,i){this._baseTelInit(e,t,n,i)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(1),r=n(4),o=function(){function e(t){this.listeners=[];var n=i.a.arrForEach,o=!!(t||{}).perfEvtsSendAll;Object(r.a)(e,this,function(e){e.addNotificationListener=function(t){e.listeners.push(t)},e.removeNotificationListener=function(t){for(var n=i.a.arrIndexOf(e.listeners,t);n>-1;)e.listeners.splice(n,1),n=i.a.arrIndexOf(e.listeners,t)},e.eventsSent=function(t){n(e.listeners,function(e){e&&e.eventsSent&&setTimeout(function(){return e.eventsSent(t)},0)})},e.eventsDiscarded=function(t,i){n(e.listeners,function(e){e&&e.eventsDiscarded&&setTimeout(function(){return e.eventsDiscarded(t,i)},0)})},e.eventsSendRequest=function(t,i){n(e.listeners,function(e){if(e&&e.eventsSendRequest)if(i)setTimeout(function(){return e.eventsSendRequest(t,i)},0);else try{e.eventsSendRequest(t,i)}catch(e){}})},e.perfEvent=function(t){t&&(!o&&t.isChildEvt()||n(e.listeners,function(e){if(e&&e.perfEvent)if(t.isAsync)setTimeout(function(){return e.perfEvent(t)},0);else try{e.perfEvent(t)}catch(e){}}))}})}return e.prototype.addNotificationListener=function(e){},e.prototype.removeNotificationListener=function(e){},e.prototype.eventsSent=function(e){},e.prototype.eventsDiscarded=function(e,t){},e.prototype.eventsSendRequest=function(e,t){},e}()},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(8),l=n(133),u=n(31),d=n(11),p=n(71),f=n(17),h=n(142),g=n(15),m=n(16),v=n(144),y=n(40),S=n(72),_=new RegExp("/callAgent/","i"),E=function(){function e(e,t){this.signalingAgentProvider=e,this.callRegistry=t}return e.prototype.handleMessage=function(e){var t;return e.eventId?e.eventId in y.logUploadEvents?(this.callRegistry.logUploadNotification(e),"number"==typeof(t=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(e))?{isHandled:!0,resultCode:t}:{isHandled:!0,resultCode:t.resultCode,responseBody:t.responseBody,responseHeaders:t.responseHeaders}):{isHandled:!1}:e.url.search(_)>-1?"number"==typeof(t=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(e))?{isHandled:!0,resultCode:t}:{isHandled:!0,resultCode:t.resultCode,responseBody:t.responseBody,responseHeaders:t.responseHeaders}:{isHandled:!1}},e}(),T=function(){function e(e,t){this.callRegistry=e,this.recentInvitations=[],this.logger=t.createChild("IncomingCallMessageHandler")}return e.prototype.handleMessage=function(e){var t=this.handleIncomingCall(e);return t?{isHandled:t,resultCode:200}:{isHandled:t}},e.prototype.handleIncomingCall=function(e){var t,n=d.generateCauseId(),i=this.logger.createFnLogger("handleIncomingCall",n);if(this.isProxiableNotification(e))return this.callRegistry.proxyPushNotification(e),!0;if(!this.isIncomingCallMessage(e))return!1;try{if(e&&e.body&&e.body.gp&&!v.isStringBase64(e.body.gp))i.info("unencoded payload, skipping decoding."),t=e.body.gp;else{var r=I(e);t=JSON.parse(r)}t.body=e.body}catch(e){return i.logFailure("Error parsing notification payload: "+e),!1}var o=this.isCallTransferNotification(e)?this.buildTransferCallPayload(t):this.buildNGCCallPayload(t);if(!o)return!1;if(this.callRegistry.calls.some(function(e){return e.callId===o.convoCallId&&e.participantId===o.participantId}))return i.logFailure("Duplicate call filtered because it was in the call registry, callId = "+o.convoCallId+", participantId = "+o.participantId),!1;var a=this.isCallReplacementNotification(e);if(i.log("replacementCall="+a),!a&&this.recentInvitations.some(function(e){return e.convoCallId===o.convoCallId&&e.participantId===o.participantId}))return i.logFailure("Duplicate call filtered because it was in the recent calls list, callId = "+o.convoCallId+", participantId = "+o.participantId),!1;5===this.recentInvitations.length&&this.recentInvitations.shift(),this.recentInvitations.push({convoCallId:o.convoCallId,participantId:o.participantId});var s=c.find(this.callRegistry.calls,function(e){return e.callId===o.convoCallId&&8===e.state});return s||(s=this.callRegistry.createCall(o.conversationId,o.convoCallId,o.participantId,void 0,n)),s.init({threadId:o.conversationId,messageId:o.messageId,mediaPeerType:2}),this.callRegistry.testEndpointMetadata?s.acknowledge(o,this.callRegistry.testEndpointMetadata,n):s.acknowledge(o,void 0,n),!0},e.prototype.isIncomingCallMessage=function(e){return Object.keys(y.incomingCallEvents).some(function(t){return y.incomingCallEvents[t]===e.eventId})||this.isCallTransferNotification(e)},e.prototype.isCallTransferNotification=function(e){return e.callNotification&&("transfer"===e.callNotification.callType||"replaces"===e.callNotification.callType)},e.prototype.isCallReplacementNotification=function(e){return e.callNotification&&"replaces"===e.callNotification.callType},e.prototype.isProxiableNotification=function(e){return Object.keys(y.proxiedEvents).some(function(t){return y.proxiedEvents[t]===e.eventId})},e.prototype.buildTransferCallPayload=function(e){var t={body:e.body,callerId:e.callNotification.from.id,conversationId:null,convoCallId:e.debugContent.callId,isMultiParty:e.conversationInvitation&&e.conversationInvitation.isMultiParty,fromMixer:e.callNotification.fromMixer,ngcCall:!0,participantId:e.callNotification.to.participantId,transferorId:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.id,transferorType:e.callNotification.transferor&&e.callNotification.transferor.transferorType,transferorDisplayName:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.displayName,callType:e.callNotification.callType,consultativeCallId:e.callNotification.consultativeCallId,messageId:null,callQueueInfo:e.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0};return this.logger.info("Incoming transfer paylod",t),t},e.prototype.buildNGCCallPayload=function(e){if(!e.callNotification)return this.logger.error("Missing callNotification in parsed incoming NGC call payload"),null;var t={conversationId:e.groupChat&&e.groupChat.threadId,messageId:e.groupChat&&e.groupChat.messageId,callerId:e.callNotification.from.id,isMultiParty:e.conversationInvitation.isMultiParty,fromMixer:e.callNotification.fromMixer,convoCallId:e.debugContent.callId,participantId:e.debugContent.participantId,ngcCall:!0,body:e.body,transferorId:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.id,transferorType:e.callNotification.transferor&&e.callNotification.transferor.transferorType,transferorDisplayName:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.displayName,callType:e.callNotification.callType,callQueueInfo:e.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0};return this.logger.info("Incoming NGC payload",t),t},e}(),C=function(e){function t(t,n,i,r,o,a,s,c,l,d){void 0===a&&(a={}),void 0===s&&(s=null);var f=e.call(this)||this;return f.trouterService=t,f.signalingAgentProvider=n,f.mediaAgent=i,f.callingLogger=r,f.telemetryLoggers=o,f.callSettings=a,f.ecsProvider=s,f.imageRendererProvider=c,f.skypeIdentity=l,f.oneDsTelemetryLoggers=d,f.calls=[],f.isDisposing=!1,f._disposedPromise=u.defer(),f.testEndpointMetadata=null,f.addCallSubscriptionToMap=function(e,t){f.callSubscriptionsMap.set(e,(f.callSubscriptionsMap.get(e)||[]).concat(t))},f.clearCallSubscription=function(){f.callSubscriptionsMap.forEach(function(e){return e.forEach(function(e){return e.dispose()})}),f.callSubscriptionsMap.clear()},f.skypeIdentity&&(f.identity=f.skypeIdentity.id),f.callSubscriptionsMap=new Map,f.logger=new p.default(f.callingLogger).createChild("CallRegistry"),f}return r(t,e),t.prototype.init=function(e,t,n){return void 0===n&&(n=d.generateCauseId()),this.logger.createFnLogger("init",n).info("init"),this.login(e)},t.prototype.uninit=function(){return this.logout()},t.prototype.login=function(e,t){return void 0===t&&(t=d.generateCauseId()),this.logger.createFnLogger("login",t).info("login"),this.skypeIdentity=e,this.identity=this.skypeIdentity.id,this.initialize(t)},t.prototype.initialize=function(e,t){var n=this;void 0===e&&(e=d.generateCauseId());var i=this.logger.createFnLogger("initialize",e),r=t&&t.applicationType?t.applicationType:"null";i.info("initialize with applicationType: "+r),this.accountConfiguration=t,this.incomingCallMessageHandler=new T(this,this.logger),this.trouterService.registerMessageHandler(new E(this.signalingAgentProvider,this)),this.trouterService.registerMessageHandler(this.incomingCallMessageHandler),i.info("Call registry init, endpointMetadata",this.testEndpointMetadata);try{this.beforeUnloadListener=function(){n.stopCallsWithBeacon()},window.addEventListener("beforeunload",this.beforeUnloadListener)}catch(e){i.logFailure("Not adding beforeunload listener: "+e)}return Promise.resolve(void 0)},t.prototype.logout=function(e){void 0===e&&(e=d.generateCauseId());var t=this.logger.createFnLogger("logout",e);t.info("logout");try{this.trouterService.clearMessageHandlers(),window.removeEventListener("beforeunload",this.beforeUnloadListener)}catch(e){t.info("Not removing beforeunload listener: "+e)}return Promise.resolve(void 0)},t.prototype.dispose=function(t){return void 0===t&&(t=d.generateCauseId()),o(this,void 0,void 0,function(){var n,i,r,o,s=this;return a(this,function(a){return(n=this.logger.createFnLogger("dispose",t)).info("dispose"),this.isDisposing?(n.warn("call registry is already in disposing stage!"),[2,this._disposedPromise.promise]):(this.isDisposing=!0,i=function(){s.calls=[],s.event("disposed").raise(),e.prototype.dispose.call(s),s._disposedPromise.resolve()},r=this.calls.map(function(e){return e.stop()}),o=function(){return s.logout()},this.clearCallSubscription(),Promise.all(r).then(o,o).then(i,i),[2,this._disposedPromise.promise])})})},Object.defineProperty(t.prototype,"disposePromise",{get:function(){return this._disposedPromise.promise},enumerable:!0,configurable:!0}),t.prototype.createCallWithMeetingData=function(e,t,n,i){var r=this,o=this.logger.createFnLogger("createCallWithMeetingData",i);if(o.info("meetingData:"+f.safeJsonStringify(e)+", callId:"+t+", localParticipantId: "+m.scrubMriOrOmit(n)),!e)return o.info("meetingData cannot be null"),null;var a=this.mediaAgent&&this.mediaAgent.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers,s=this.getCallUsingMeetingData(e,t,n,void 0,void 0,i);if(s)return o.info("Call Registry has an entry for this call's meeting data"),s;if(s=this.getCall(t,n,i))return o.info("Call Registry has an entry for this callId, participantId"),s;s=new S.default(this.signalingAgentProvider.getSignalingAgent(),this.mediaAgent,new p.default(this.callingLogger),a,this.skypeIdentity,this.callSettings,void 0,t,n,this.ecsProvider,this.trouterService,this.imageRendererProvider,this.accountConfiguration,void 0,this.locationInfoContent,this.networkInfoContent,e,this.areaContent),this.calls.push(s),this.event("callAdded").raise(s),this.raiseChanged(),o.info("creating new call, "+s.callId+", "+f.safeJsonStringify(e)+", "+f.safeJsonStringify(s.meetingData));var c=s.on("replacementRequested",function(e){r.incomingCallMessageHandler.handleMessage(e)});return this.addCallSubscriptionToMap(s,c),s},t.prototype.createCall=function(e,t,n,i,r){var o=this;void 0===r&&(r=d.generateCauseId()),this.logger.createFnLogger("createCall",r).info("threadId:"+m.getLoggableThreadId(e)+", callId:"+t+", localParticipantId: "+m.scrubMriOrOmit(n)+", messageId:"+i);var a=this.mediaAgent&&this.mediaAgent.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers,s=null;if(s=this.getCallUsingThreadIdMessageId(e,t,i,r))return s;if(s=this.getCall(t,n,r))return s;s=new S.default(this.signalingAgentProvider.getSignalingAgent(),this.mediaAgent,new p.default(this.callingLogger),a,this.skypeIdentity,this.callSettings,e,t,n,this.ecsProvider,this.trouterService,this.imageRendererProvider,this.accountConfiguration,i,this.locationInfoContent,this.networkInfoContent,null,this.areaContent),this.calls.push(s),this.event("callAdded").raise(s),this.raiseChanged();var c=s.on("replacementRequested",function(e){o.incomingCallMessageHandler.handleMessage(e)});return this.addCallSubscriptionToMap(s,c),s},t.prototype.getCall=function(e,t,n){void 0===n&&(n=d.generateCauseId());var i=this.logger.createFnLogger("getCall[callId="+e+"][participantId="+m.scrubMriOrOmit(t)+"]",n);if(!e)return i.logFailure("callId is undefined"),null;var r=this.calls.find(function(t){return t.callId===e});return r&&i.info("Call Registry already has an entry for this call"),r},t.prototype.deleteCall=function(e){var t=this.calls.indexOf(e);return-1!==t&&(this.callSubscriptionsMap.get(e).forEach(function(e){return e.dispose()}),this.callSubscriptionsMap.delete(e),this.calls.splice(t,1),this.event("callRemoved").raise(e),this.raiseChanged(),!0)},t.prototype.setConfiguration=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){return this.accountConfiguration=e,[2]})})},t.prototype.updateDisplayName=function(e){return this.skypeIdentity.displayName=e,this.calls.forEach(function(t){return t.updateDisplayName(e)}),Promise.resolve()},t.prototype.fireIntent=function(e,t){return Promise.resolve()},t.prototype.getCallState=function(e,t){return Promise.reject("Not implemented")},t.prototype.getSetup=function(){},t.prototype.getEcsProvider=function(){return this.ecsProvider},t.prototype.updateSkypeToken=function(e){this.logger.debug("CallRegistry.updateSkypeToken() called but not supported in the current set up.")},t.prototype.updateToken=function(e,t,n,i,r){return Promise.reject("not implemented")},t.prototype.debugInformation=function(e){var t=e?"CallInformation\n * CallId="+e.callId:void 0;return Promise.resolve(t)},t.prototype.setLocationInfo=function(e,t,n){if(void 0===n&&(n=d.generateCauseId()),this.logger.info("setLocationInfo, "+n+", infoType:"+e+", contentJson "+(t?"is set":"is undefined")),t)try{JSON.parse(t)}catch(e){return Promise.reject("invalid contentJson: "+e)}return this.locationInfoType=e,1===this.locationInfoType&&(this.locationInfoContent=t,this.logger.info("locationInfoContent set to "+this.locationInfoContent)),2===this.locationInfoType&&(this.networkInfoContent=t,this.logger.info("networkInfoContent set to "+this.networkInfoContent)),3===this.locationInfoType&&(this.areaContent=t,this.logger.info("areaContent set to "+this.areaContent)),Promise.resolve()},t.prototype.proxyPushNotification=function(e){this.logger.info("Proxying push notification with event ID "+e.eventId);try{var t={eventId:e.eventId,payload:I(e)};this.event("proxiedPushNotification").raise(t)}catch(e){this.logger.error("Error proxying push notification: "+e)}},t.prototype.logUploadNotification=function(e){this.logger.info("Log upload notification with event ID "+e.eventId);try{var t={eventId:e.eventId,payload:I(e)};this.event("logUploadNotification").raise(t)}catch(e){this.logger.error("Error raising log upload notification: "+e)}},t.prototype.sendPush=function(e,t,n,i){var r={id:e},o=[];return t.forEach(function(e){o.push({id:e})}),this.signalingAgentProvider.getSignalingAgent().sendPushAsync(r,o,n,i)},t.prototype.getCallUsingThreadIdMessageId=function(e,t,n,i){this.logger.info("[getCallUsingThreadIdMessageId]["+i+"] threadID: "+m.getLoggableThreadId(e)+" callId: "+t+" messageId: "+n);var r=null;return e&&(r=c.find(this.calls,function(i){return i.threadId===e&&(t&&i.callId===t||n&&i.messageId===n)}))?(this.logger.logFailure("[getCallUsingThreadIdMessageId]["+i+"]Call Registry already has an entry for threadId: "+m.getLoggableThreadId(r.threadId)+", callId: "+r.callId+", messageId: "+r.messageId),r):r},t.prototype.getCallUsingMeetingData=function(e,t,n,i,r,o){var a,c;void 0===o&&(o=d.generateCauseId());var l,u=this.logger.createFnLogger("getCallUsingMeetingData",o);if(u.info("[callId="+t+"][participantId="+m.scrubMriOrOmit(n)+"] meetingData: "+f.safeJsonStringify(e)+" threadId: "+m.getLoggableThreadId(i)+" messageId: "+r),!t)return u.logFailure("callId is undefined"),null;try{for(var p=s(this.calls),g=p.next();!g.done;g=p.next()){var v=g.value;if(v.callId===t){l=v;break}if(h.compareMeetingData(v.meetingData,e,o,this.logger)){l=v;break}}}catch(e){a={error:e}}finally{try{g&&!g.done&&(c=p.return)&&c.call(p)}finally{if(a)throw a.error}}return l},t.prototype.stopCallsWithBeacon=function(){var e,t;try{for(var n=s(this.calls),i=n.next();!i.done;i=n.next())i.value.stopWithBeacon()}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t}(g.default);function I(e){if(e&&e.body){if(e.body.gp)return atob(e.body.gp);if(e.body.cp)return l.inflate(atob(e.body.cp),{to:"string"})}return"{}"}t.CallRegistry=C},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}},function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,r){var o=i,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";var i=n(25),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new i.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,r,o,a,s=e.length,c=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(c),a=0,o=0;a<c;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,i,r,o,s=t||e.length,l=new Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)l[i++]=r;else if((o=a[r])>4)l[i++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<s;)r=r<<6|63&e[n++],o--;o>1?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return c(l,i)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),a=function(){function e(e){var t=this;this._callingLogger=e,this._maybeLog=function(e){for(var n,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{(n=t._callingLogger)[e].apply(n,r(i))}catch(e){t._callingLogger.info("[failed to log]",o.getPrintableObject(e))}}}return e.prototype.getPrefix=function(e,t){var n="";return t&&(n+="["+t+"]"),e&&(n+="["+e+"]"),n},e.prototype.createChild=function(t,n){return new e(this._callingLogger.createChild(t,n))},e.prototype.createFnLogger=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return new e(this._callingLogger.createChild(this.getPrefix(t,n)+i.join(""),!1))},e.prototype.logSuccess=function(e){this._maybeLog("info","success="+e+"}")},e.prototype.logFailure=function(e){var t=o.getPrintableObject(e);this._maybeLog("info","failed="+t+"}")},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["log"],e))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["debug"],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["info"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["warn"],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["error"],e))},e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},d=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},p=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var f=n(8),h=n(73),g=n(31),m=n(35),v=n(74),y=n(11),S=n(145),_=n(75),E=n(76),T=n(146),C=n(15),I=n(77),A=n(78),b=n(150),R=n(151),O=n(16),P=n(152),N=n(42),M=n(79),w=n(40),D=n(80),L=n(81),k=n(153),x=n(82),F=n(83),U=n(157),j=n(158),H=n(41),B=n(17),G=n(159),V=n(43),W=n(160),q=n(161),K=[1,2,9,10,11,12,30,27,28];t.DEFAULT_ENDPOINT_ID="remote",t.DEFAULT_PARTICIPANT_ID="remote";var z,J,Y=function(e){function t(t,n){var i=e.call(this)||this;return i.isStreaming=t,i.mediaType=n,i}return r(t,e),t}(C.default);t.LocalMediaStream=Y,function(e){e.Specified="specified",e.All="all"}(z||(z={})),function(e){e[e.None=0]="None",e[e.Self=1]="Self",e[e.Other=2]="Other"}(J||(J={}));var Q=function(e){function n(t,n,i,r,o,a,s,c,l,u,p,y,S,_,E,T,C,I){var b=e.call(this,i)||this;b.signalingAgent=t,b.mediaAgent=n,b.logger=i,b.telemetryLoggers=r,b.currentUserSkypeIdentity=o,b.callSettings=a,b.threadId=s,b.ecsProvider=u,b.trouterService=p,b.accountConfiguration=S,b.participants=[],b.isServerMuted=!1,b.isSpeakerMuted=!1,b.isVideoOn=!1,b.isScreenSharingOn=!1,b.callStartedAt=null,b.callHeldAt=null,b.callType=-1,b.failureType=2,b.isEmergency=!1,b.contentSharingSessions=[],b.endpoints={endpointDetails:[]},b.isPreheatEnabled=!1,b.localMediaStreams=[],b.requestedHoldState=!1,b.mediaStateConfigurationHelper=new M.MediaStateConfigHelper({mediaStates:[M.getMediaState(0,4)]}),b.canToggleAudio=!0,b.canToggleVideo=!0,b.connectCallPromise=Promise.resolve(),b.canToggleScreenSharing=!0,b.callUsesMixer=!1,b.isEscalationInProgress=!1,b.retryOutgoingRenegotiation={retry:!1,causeId:""},b.isHoldInProgress=!1,b.isMuteOnHold=!1,b.callSetupFailed=!1,b.isSomeoneSharing=!1,b.isSomeoneStreamingVideo=!1,b.callGotConnected=!1,b.lwjFallbackInProgress=!1,b.mediaRelayWhiteListingIssue=!1,b.signalingSessionCallOptions=null,b.tsCallingTelemetryReported=!1,b.isCallSetupTelemetrySent=!1,b._isAudioStreamConnected=!1,b._wasAudioStreamConnected=!1,b._callInLobby=!1,b._callIsSetupComplete=!1,b._transferState=0,b._parkState=0,b._muteState=w.ParticipantMuteState.Unmuted,b._callCreationTime=(new Date).getTime(),b._commandUrlPresence=h.CommandUrlPresence.None,b._capabilities={canMuteOthers:!1,canUnmuteSelf:!1},b._spamRiskLevel=null,b._admitRejectionAsTransactionEnd=!1,b._disableIsMultipartyDependenceOnThreadId=!1,b._publishedStatesModified=J.None,b._participantPublishedStatesMap={},b._endpointPublishedStatesMap={},b.startVM=function(e,t,n,i,r){return b.signalingSession.startOutgoingCall(n,i,{voicemailResourcePath:t.callVoicemailStartOptions.voicemailResourcePath,voicemailItemId:t.callVoicemailStartOptions.voicemailItemId,callToVoicemail:!0},Date.now()-r,e)},b.getSignalingSessionCallOptions=function(e){var t={suppressDialout:!e.callStartOptions.ringOthers,isPreheatOnly:1==(1&e.callStartOptions.preheatFlags),onBehalfOf:b.onBehalfOfMri,muted:1==(1&e.callStartOptions.muteFlags),invitationType:e.invitationType,participantsToNudge:e.participantsToNudge,routingFlags:e.callStartOptions&&e.callStartOptions.routingFlags,parkContext:e.parkContext,pickupCode:e.pickupCode,isLwj:b.callSettings.useLwjForAllCalls,scenario:e.callStartOptions&&e.callStartOptions.scenario,callUsesMixer:b.callUsesMixer,clientEndpointCapabilities:e.callStartOptions.clientEndpointCapabilities,clientEndpointDebugContent:e.callStartOptions.clientEndpointDebugContent,isEmergency:b.isEmergency,meetingData:b.meetingData,meetingPreferences:e.meetingPreferences,alternateId:e.callStartOptions?e.callStartOptions.alternateId:null,meetingRegistrationId:e.callStartOptions?e.callStartOptions.meetingRegistrationId:""},n=e.callStartOptions&&e.callStartOptions.invitationDataJson;if(n)try{t.invitationData=JSON.parse(n)}catch(e){throw new Error("Invalid JSON in invitationData: "+n)}return t},b.startOutgoingCall=function(e,t,n,i,r){return b.signalingSession.startOutgoingCall(n,i,b.getSignalingSessionCallOptions(t),Date.now()-r,e)},b.joinGivenConversation=function(e,t,n,i,r,o){var a=1==(1&t.callStartOptions.muteFlags),s=1==(1&t.callStartOptions.preheatFlags),c=b.callSettings.useLwjForAllCalls;return b.logger.info("["+e+"][joinGivenConversation] muted="+a+", isLwj="+c+", isPreheatOnly="+s),b.signalingSession.joinGivenConversation(o,b.callId,n,i,Date.now()-r,{muted:a,isLwj:c,isPreheatOnly:s,clientEndpointCapabilities:t.callStartOptions.clientEndpointCapabilities,clientEndpointDebugContent:t.callStartOptions.clientEndpointDebugContent,isEmergency:b.isEmergency,meetingData:b.meetingData,meetingPreferences:t.meetingPreferences,meetingRegistrationId:t.callStartOptions?t.callStartOptions.meetingRegistrationId:""},e)},b.executeCallTransfer=function(e,t,n,i,r){b._setTransferState(1);var o=b._callOperationHandler.createPendingOperation(m.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,t);return i?b.signalingSession.transferCallAsync(e,"TransferTypeStandard",i,r,t):0===n?b.signalingSession.transferCallAsync(e,"TransferTypeStandard",void 0,r,t):2===n&&b.signalingSession.transferCallAsync(e,"TransferTypeVoicemail",void 0,r,t),o},b._getCallEndOperation=function(){return b._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.STOP_CALL)?b._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.STOP_CALL):b._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.REJECT)?b._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.REJECT):Promise.resolve()},b._onAcknowledgeError=function(e,t,n,i){n.logFailure(e);var r,o={code:2,success:!1,fatal:!0},a=7;throw R.isPhaseError(w.CallAckSignalingPhase.SendAttach,e)&&(r={code:w.jsCallEndCodes.InternalServerError,subCode:w.jsCallEndSubCodes.AttachFailed,phrase:w.jsCallEndPhrase.AttachFailed}),R.isPhaseError(w.CallAckSignalingPhase.ProcessIncomingCallRequest,e)&&(r={code:w.jsCallEndCodes.NotAcceptable,subCode:w.jsCallEndSubCodes.AttachActionFailed,phrase:w.jsCallEndPhrase.BadNotificationPayload},o={code:0,success:!1,fatal:!0}),R.isOneOfPhaseErrors(w.CallAckMediaPhase,e)&&(a=47),e&&e.error&&e.error.type===b.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer&&(r={code:w.jsCallEndCodes.MediaError,subCode:w.jsCallEndSubCodes.MediaOfferProcessingError,phrase:w.jsCallEndPhrase.IncompatibleOffer}),b.callTelemetry.updateOperationData(m.CALL_OPERATIONS.ACKNOWLEDGE,{phases:i,error:B.getPIISafeObject(e)},t),b._callOperationHandler.maybeRejectOperation(m.CALL_OPERATIONS.ACKNOWLEDGE,o,void 0,t),b.stopInternal({rejectReason:r,causeId:t,terminatedReason:a}),o},b._onAcknowledgeSuccess=function(e,t,n){return e.logSuccess("success"),b.callTelemetry.updateOperationData(m.CALL_OPERATIONS.ACKNOWLEDGE,{phases:t},n),{code:1,success:!0}},b._processOfferedModalities=function(e,t){b.handleOfferedModalities(e,t);var n=b.callUsesMixer?void 0:{modalityOverride:e};return b.updateMediaModalities(n,t)},b._handleOfferProcessingError=function(e,t,n){return n.logFailure("handleOfferProcessingError="+e),e&&e.error&&e.error.type===b.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer?(b.callTelemetry.recordEvent(m.MEDIA_EVENT.INCOMPATIBLE_OFFER,void 0,t),b.signalingSession.supportsNewOfferRequest()?(b.newOfferRequestDeferred=g.defer(),b.attachToCallAndGetOffer.promise.then(function(){return b.mediaSession.rejectNegotiationAsync(e,t)}).then(function(){return b.signalingSession.requestNewOffer(b.mediaSession.getAcceptedTypes(),t)}).then(function(){return b.newOfferRequestDeferred.promise}).then(function(e){return b.mediaSession.processOfferAsync(e,t)}).catch(function(e){return b.callTelemetry.recordEvent(m.MEDIA_EVENT.NEW_OFFER_FAILED,B.getPrintableObject(e),t),Promise.reject(e)})):Promise.reject(e)):Promise.reject(e)},b._trySendProvisionalMediaAnswer=function(e){return Promise.resolve(void 0).then(function(){return b.mediaSession.createAnswerAsync(!0,e)}).then(function(e){return e.blob?(b.mediaAcknowledgmentOperation=b._callOperationHandler.createPendingOperation(m.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT),b.signalingSession.setProvisionalAnswerAsync(e).then(function(){return b.mediaAcknowledgmentOperation})):Promise.resolve(void 0)})},b.checkForCallIdUpdate=function(e,t){if(b.callId!==e){b.logger.info("["+t+"][checkForCallIdUpdate] old="+b.callId+", new="+e),b.setCallId(e);try{b.event("callIdChanged").raise(b.callId)}catch(e){b.logger.error("Error raising call ID change: "+e)}b.raiseChanged()}},b.handleRemoteParticipantStateInOneToOneCall=function(e){if(!b.callUsesMixer&&3===b.state){var t=b.participants[0];t&&t.setState(3,void 0,e)}},b.handleRemoteParticipantJoinedInOneToOneCall=function(e,t){if(!b.callUsesMixer&&3===b.state){var n=b.participants.filter(function(t){return t.id===e.id})[0];n?n.setState(3,void 0,t):b.logger.logFailure("["+t+"][handleRemoteParticipantJoinedInOneToOneCall]unable to find particpant "+O.scrubMriOrOmit(e.id))}},b.handleRemoteParticipantStateInObservingCall=function(e,t,n){var i=t.isLobby;if(8===b.state){var r=i?7:3;e.setState(r,void 0,n)}},b.getTelemetryFromPhaseExecution=function(e){var t={phase:e.phase,phases:e.phases,code:e.error&&e.error.code,subCode:e.error&&e.error.subCode,message:e.error&&e.error.message,error:e.error};return(t.code||t.message)&&delete t.error,t},b._setTransferState=function(e){b.transferState!==e&&(b.logger.info("Transfer: state set: "+e),b._transferState=e,b.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.SET_TRANSFER_STATE,{state:e}),b.raiseChanged())},b._setParkState=function(e){b.parkState!==e&&(b.logger.info("Parking: state set: "+e),b._parkState=e,b.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.SET_PARK_STATE,{state:e}),b.raiseChanged())},b.prepareNegotiationResultForTelemtry=function(e){return{isComplete:e.isComplete,activeModalities:e.activeModalities,configuredModalities:e.configuredModalities,initiator:O.scrubMriOrOmit(e.initiator),attemptedModalities:e.attemptedModalities,offeredModalities:e.offeredModalities}},b.prepareTelemetryForOfferAnswer=function(e){return e&&e.mediaContent&&{isRenegotiation:!!e.renegotiation,isEscalation:!!e.mediaContent.isTwoPartyToMultiPartyEscalation,mediaTypes:e.mediaTypes,newOffer:e.mediaContent.newOffer}},b.updateLocalParticipantEndpoints=function(e){var t=[];f.each(e,function(e){var n=M.convertSignalingEndpointDetails(e);t.push(n)}),b.endpoints.endpointDetails=t;var n=f.find(t,function(e){return b.participantId===e.participantId}),i=n&&n.lwjSessionInformation;i!==b.lwjInfo&&(b.lwjInfo=i,b.event("lwjChanged").raise(i),b.logger.info("lwjChanged: "+JSON.stringify(b.lwjInfo)),i&&b.lwjFallbackInProgress&&(b.logger.info("LWJ fallback success"),b.callTelemetry.recordOperationSuccess(m.CALL_OPERATIONS.LWJ_FALLBACK),b.lwjFallbackInProgress=!1))},b.handleParticipantsMutedUpdated=function(e){var t,n;if(void 0!==e&&void 0!==e.muteUnmuteResponse){b.logger.info("handleParticipantsMutedUpdated: number of infos: "+e.muteUnmuteResponse.length);try{for(var i=d(Object.keys(e.muteUnmuteResponse)),r=i.next();!r.done;r=i.next()){var o=r.value,a=b.getParticipant(o);a&&a.handleServerMutedInfoUpdate(e.muteUnmuteResponse[o])}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}},b.handleSelfUnmuteUpdatedInfo=function(e,t){var n,i;if(void 0!==e&&void 0!==e.muteUnmuteResponse){b.logger.info("handleSelfUnmuteUpdatedInfo");var r=function(n){var i=e.muteUnmuteResponse[n];if(n===b.localSignalingParticipant.id){var r=f.find(i,function(e){return e.participantId===b.localSignalingParticipant.participantId});if(void 0===r)return"continue";var o=f.find(b.localSignalingParticipant.endpointDetails,function(e){return e.participantId===r.participantId});L.handleMuteUnmuteParticipantInfo(b.logger,o,r,!1)&&b.handleSelfServerMutedState(t)}};try{for(var o=d(Object.keys(e.muteUnmuteResponse)),a=o.next();!a.done;a=o.next())r(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}},b.state=0,b.terminatedReason=0,b.callStats=new N.CallTelemetryBuilder,b.callTelemetry=new v.CallTelemetry(b.logger,b._callCreationTime),b.collectMediaStatsDeferred=g.defer(),b.setCallId(c),b.setThreadId(s),b.setMessageId(_),b.setSkypeId(b.currentUserSkypeIdentity.id),b.setParticipantId(l),b.setCallOrigin(0),b.logger=b.logger.createChild(function(){var e=(b.endpointId||"").substr(0,8),t=(b.participantId||"").substr(0,8);return"Web["+b.callId+"]["+e+"]["+t+"]["+b.state+"]"}),b.initializeSignalingSession(l),b.initializeImageRenderingSession(y),b.signalingSession.setLocationInfo(E,T,I),b.streamManager=new F.PluginlessCallStreamManager(b.participantId,null,b.callStats.localStats,b.logger,b.imageRenderingSession),b.dataChannel=new G.PluginlessDataChannel(b.logger),b.dataChannel.on("remoteUserEventsReceived",function(e,t){return b.event("remoteUserEventsReceived").raise(e,t)});var P=b.ecsProvider.getEcsConfig("SkypeCalling","enableErrorConversion");return b.logger.info("ecsEnableErrorConversion is: "+P),b._admitRejectionAsTransactionEnd=b.ecsProvider.getEcsConfig("SkypeCalling","webAdmitRejectionAsTransactionEnd"),b._disableIsMultipartyDependenceOnThreadId=b.ecsProvider.getEcsConfig("SkypeCalling","disableIsMultipartyDependenceOnThreadId"),b.logger.info("disableIsMultipartyDependenceOnThreadId is: "+b._disableIsMultipartyDependenceOnThreadId),b._callOperationHandler=new A.default(b.logger,b.callTelemetry,P),b._participantOperationHandler=new A.default(b.logger,b.callTelemetry,P),b.meetingData=C,b.webRtcInternalsCollector=W.default.getInstance(b.logger.createChild("WebRtcInternals"),b.mediaAgent,b),b}return r(n,e),Object.defineProperty(n.prototype,"callId",{get:function(){return this._callId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endpointId",{get:function(){return this._endpointId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isHostless",{get:function(){return this.signalingSession.isHostLessCall},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"transferState",{get:function(){return this._transferState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parkState",{get:function(){return this._parkState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"publishedStates",{get:function(){return this._publishedStates},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"participantId",{get:function(){try{var e=this.signalingSession&&this.signalingSession.participantManager&&this.signalingSession.participantManager.localParticipant&&this.signalingSession.participantManager.localParticipant.participantId;this._participantId=e||this._participantId}catch(e){this.logger.error("Error updating participantId: "+e)}return this._participantId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"role",{get:function(){return this.localSignalingParticipant.role},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"meetingRole",{get:function(){return this.localSignalingParticipant.meetingRole},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMuted",{get:function(){return this._muteState===w.ParticipantMuteState.Muted||this._muteState===w.ParticipantMuteState.AttemptingUnmute},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tenantId",{get:function(){return this.localSignalingParticipant.tenantId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mediaLegId",{get:function(){return this._mediaLegId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isIncomingOneOnOneVideoCall",{get:function(){return this.isOneToOneCall()&&this.isSomeoneStreamingVideo},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mediaStreams",{get:function(){return this.streamManager.streams},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isAudioStreamConnected",{get:function(){return this._isAudioStreamConnected},set:function(e){this._isAudioStreamConnected!==e&&(this._isAudioStreamConnected=e,this._wasAudioStreamConnected=this._wasAudioStreamConnected||e,this.raiseChanged())},enumerable:!0,configurable:!0}),n.prototype.setMeetingRole=function(e){e!==this.localSignalingParticipant.meetingRole&&(this.logger.info("changing self role to ["+e+"]"),this.localSignalingParticipant.meetingRole=e,this.event("meetingRoleUpdated").raise(e))},Object.defineProperty(n.prototype,"spamRiskLevel",{get:function(){return this._spamRiskLevel},set:function(e){e&&(this._spamRiskLevel=e)},enumerable:!0,configurable:!0}),n.prototype.getScreenHandle=function(){if(!this.sharedScreenHandle){var e=this.mediaStateConfigurationHelper.isSending(0)&&this.mediaAgent.getConfigProvider().config.enableAudioSharing;this.sharedScreenHandle=this.mediaAgent.getDeviceManager().createDevicesHandle({audio:e,sharing:!0}),this.subscribeOnSharedScreenHandleEvents(this.sharedScreenHandle)}return this.sharedScreenHandle},n.prototype.setCallOrigin=function(e){this.logger.info("Set call origin to "+e),this._origin=e,this.callTelemetry.setCallOrigin(e),this.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.SET_CALL_ORIGIN,{origin:e})},n.prototype.setMediaLegId=function(e){this._mediaLegId=e,this.callStats.setMediaLegId(e)},n.prototype.setCallId=function(e){this.callTelemetry.setCallId(e),this.callStats.setCallId(e),this._callId=e},n.prototype.setEndpointId=function(e){this._endpointId=e,this.logger.info("[endpointId="+B.truncate(this._endpointId,8)+"]"),this.callTelemetry.setEndpointId(e),this.callStats.setEndpointId(e)},n.prototype.setFailureType=function(e){this.callTelemetry.setFailureType(e),this.failureType=e},n.prototype.setParticipantId=function(e){this._participantId=e,this.logger.info("[participantId="+this._participantId+"]"),this.callTelemetry.setParticipantId(this.participantId)},n.prototype.setCallerMri=function(e){this.callerMri=e,this.logger.info("[callerMri="+this.callerMri+"]")},n.prototype.setTransferorMri=function(e){var t=T.stripMriAliases(e);t!==this.transferorMri&&(this.transferorMri=t,this.logger.info("transferorMri: "+this.transferorMri),this.raiseChanged())},n.prototype.setThreadId=function(e,t){void 0===t&&(t=y.generateCauseId()),this.threadId!==e&&(this.logger.info("["+t+"][setThreadId] threadId="+O.getLoggableThreadId(e)),this.threadId=e,this.callTelemetry.setThreadId(e))},n.prototype.setMessageId=function(e,t){void 0===t&&(t=y.generateCauseId()),this.messageId!==e&&(this.logger.info("["+t+"][setMessageId] messageId="+O.scrubMriOrOmit(e)),this.messageId=e,this.callTelemetry.setMesageId(e))},n.prototype.setSkypeId=function(e,t){void 0===t&&(t=y.generateCauseId()),this.skypeId!==e&&(this.logger.info("["+t+"][setSkypeId]"),this.skypeId=e,this.callTelemetry.setSkypeId(e))},n.prototype.setCallType=function(e,t){var n=this.logger.createFnLogger("setCallType",t);n.info("current="+this.callType+", newValue: "+e),2===this.callType&&1===e&&n.logFailure("De-escalating to P2P should not happen!"),e!==this.callType&&(this.callType=e,this.callTelemetry.setCallType(e),2===e&&this.callStats.localStats.call.event(N.CallEvent.MultiPartyModeSet),this.raiseChanged())},n.prototype.setConversationType=function(e,t){this.logger.createFnLogger("setConversationType",t).info("current="+this.conversationType+", newValue="+e),e!==this.conversationType&&(this.conversationType=e,this.callTelemetry.setConversationType(e),this.raiseChanged())},n.prototype.setCallUsesMixer=function(e,t){this.callUsesMixer!==!!e&&(this.logger.info("["+t+"][setCallUsesMixer] new value="+e),this.callUsesMixer=e,this.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.CALL_USES_MIXER,{newValue:e},t))},n.prototype.setIsEscalationInProgress=function(e,t){this.logger.info("["+t+"][setIsEscalationInProgress] currentValue="+this.isEscalationInProgress+", newValue="+e),this.isEscalationInProgress=e,this.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.ESCALATION_IN_PROGRESS,void 0,t)},n.prototype.processCallStartOptions=function(e,t){var n=this.logger.createFnLogger(m.CALL_OPERATIONS_INTERNAL.PROCESS_CALL_START_OPTIONS,t);try{1&e.preheatFlags&&(this.isPreheatEnabled=!0)}catch(e){n.logFailure(e)}},n.prototype.updateDisplayName=function(e){this.logger.info("updating displayName"),this.localSignalingParticipant.displayName=e,this.signalingSession.participantManager.localParticipant.displayName=e},n.prototype.init=function(e){if(this.signalingSessionCallOptions={teamsMessageId:e.messageId,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration,meetingInfo:e.meetingInfo,emergencyContent:e.emergencyContent?JSON.parse(e.emergencyContent):void 0,broadcastContext:e.broadcastContext,endpointMetadata:e.endpointMetadata},this.setMessageId(e.messageId),this.onBehalfOfMri=e.onBehalfOf,e.threadId&&(this.setThreadId(e.threadId),this.signalingSession.setThreadId(e.threadId)),this.signalingSession.setCallOptions(this.signalingSessionCallOptions),e.transferContext){switch(this.logger.info("Transfer: Call.init, set transferContext",k.scrubITransferContext(e.transferContext)),this.signalingSession.setTransferContext(e.transferContext.context),e.transferContext.transferType){case 1:this.setCallOrigin(2);break;case 0:this.setCallOrigin(1);break;case 2:this.setCallOrigin(3);break;default:throw new Error("TransferType: "+e.transferContext.transferType+" doesn't have a switch option")}e.transferContext.context.callAcceptanceCallback?this._transferredCallAcceptanceCallback=e.transferContext.context.callAcceptanceCallback:this.logger.info("[failed]Transfer: Missing transferred call acceptance callback"),e.transferContext.transferorMri&&this.setTransferorMri(e.transferContext.transferorMri)}this.setIsEmergency(!!e.isEmergency),this.raiseChanged()},n.prototype.setDeviceManager=function(e){},n.prototype.startVideo=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(e){return[2,this.startStopVideo(!0,t)]})})},n.prototype.stopVideo=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(e){return[2,this.startStopVideo(!1,t)]})})},n.prototype.dumpVideoSourceImages=function(){return l(this,void 0,void 0,function(){return u(this,function(e){return[2,Promise.reject(60)]})})},n.prototype.hold=function(e,t,n){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var i;return u(this,function(r){return(i=this.logger.createFnLogger(m.CALL_OPERATIONS.HOLD,t)).info("["+m.CALL_OPERATIONS.HOLD+"]["+t+"] negotiationTag "+e+" hold options: "+B.safeJsonStringify(n)),this.isJoinedLightweight()?(i.logFailure("Can not put lightweight call on hold"),[2,Promise.reject(60)]):4===this.state?(i.logFailure("Trying to put a call on hold which is already held state, early resolving the promise"),[2,Promise.resolve(void 0)]):[2,n&&n.isLocal?this.localHold(t,n):this.holdWithRenegotiate(t,n)]})})},n.prototype.holdWithRenegotiate=function(e,t){return l(this,void 0,void 0,function(){return u(this,function(n){return 3===this.state||5===this.state||10===this.state?[2,this.setHold(!0,e,t)]:(this.logger.logFailure("["+m.CALL_OPERATIONS.HOLD+"]["+e+"] Trying to hold a call in an invalid state: "+this.state),[2,Promise.reject("Trying to hold a call in an invalid state: "+this.state)])})})},n.prototype.localHold=function(e,t){return l(this,void 0,void 0,function(){return u(this,function(n){return 3===this.state||5===this.state||10===this.state?[2,this.setHold(!0,e,t)]:(this.logger.logFailure("["+m.CALL_OPERATIONS.LOCAL_HOLD+"]["+e+"] Trying to hold a call in an invalid state: "+this.state),[2,Promise.reject("Trying to hold a call in an invalid state: "+this.state)])})})},n.prototype.unhold=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var e;return u(this,function(n){return e=this.logger.createFnLogger(m.CALL_OPERATIONS.UNHOLD,t),3===this.state?(e.logFailure("Trying to resume a call which is already in connected state, early resolving the promise"),[2,Promise.resolve(void 0)]):4===this.state?(e.info("current hold state "+this.requestedHoldState),[2,this.setHold(!1,t)]):(e.logFailure("Trying to resume a call in an invalid state: "+this.state),[2,Promise.reject("Trying to resume a call in an invalid state: "+this.state)])})})},n.prototype.canMerge=function(e,t){var n=e.isOneToOneCall(),i=3===this.state,r=4===e.state,o=n&&i&&r;return this.logger.info("["+t+"][canMerge] Call "+e.callId+" isOneToOne "+n+" isCallConnected "+i+" call.state "+this.state+" isMergeOnHold "+r+" mergeCall.state "+e.state+" CanMerge result: "+o),o},n.prototype.updateEndpointMetadata=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(n){return[2,this.signalingSession.updateEndpointMetadata(e,t)]})})},n.prototype.sendDtmfTone=function(e){return l(this,void 0,void 0,function(){var t;return u(this,function(n){return this.mediaSession?(t=this.toneToString(e))?(this.logger.info("["+I.causeId+"][sendDtmfTone]DtmfTone: <omitted>"),[2,Promise.resolve(this.mediaSession.sendDtmf(t))]):[2,Promise.reject(new Error("Unsupported DtmfTone"))]:[2,Promise.reject(new Error("no mediaSession"))]})})},n.prototype.setAudioUsageMode=function(e){return l(this,void 0,void 0,function(){return u(this,function(e){return[2,Promise.reject(60)]})})},n.prototype.setAudioMidcallConfig=function(e,t){return l(this,void 0,void 0,function(){return u(this,function(e){return[2,Promise.reject(60)]})})},n.prototype.setAudioMidcallConfigJson=function(e){return l(this,void 0,void 0,function(){return u(this,function(e){return[2,Promise.reject(60)]})})},n.prototype.setInitialTelemetry=function(e,t,n,i){var r,o=!1;switch(e){case m.CALL_OPERATIONS.SUBSCRIBE:case m.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA:this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.SUBSCRIBE),n||this.callTelemetry.setOperationVariant(e,m.OPERATION_VARIANTS.CCWM),this.signalingSession.setInitialTelemetry(e,{correlationId:this.callId,causeId:i,conversationServiceUrl:n});break;case m.CALL_OPERATIONS.ACKNOWLEDGE:0!==this.state&&8!==this.state&&this.callTelemetry.maybeRecordOperationSuccess(m.CALL_OPERATIONS.ACKNOWLEDGE,{code:4}),this.callTelemetry.setDirection(v.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLEE),this.signalingSession.setInitialTelemetry(e,{causeId:i});break;case m.CALL_OPERATIONS.JOIN_CALL:this.callTelemetry.setDirection(v.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.JOIN),this.callSettings.useLwjForAllCalls?this.callTelemetry.setOperationVariant(m.CALL_OPERATIONS.JOIN_CALL,m.OPERATION_VARIANTS.LWJ):1&t.callStartOptions.preheatFlags&&this.callTelemetry.setOperationVariant(m.CALL_OPERATIONS.JOIN_CALL,m.OPERATION_VARIANTS.PREHEAT),(r=this.telemetryDataFromCallStartOptions(t.callStartOptions))&&this.callTelemetry.updateOperationData(m.CALL_OPERATIONS.JOIN_CALL,r,i);var a={muted:1==(1&t.callStartOptions.muteFlags),isPreheatOnly:1==(1&t.callStartOptions.preheatFlags),isLwj:o=this.callSettings.useLwjForAllCalls};this.signalingSession.setInitialTelemetry(e,{correlationId:this.callId,causeId:i,conversationServiceUrl:n,joinCallOptions:a,offerGenerationTime:Date.now()-t.callStartTime});break;case m.CALL_OPERATIONS.START_CALL:this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLER),this.callSettings.useLwjForAllCalls||this.lwjFallbackInProgress?(o=!0,this.callTelemetry.setOperationVariant(m.CALL_OPERATIONS.START_CALL,m.OPERATION_VARIANTS.LWJ)):1&t.callStartOptions.preheatFlags&&this.callTelemetry.setOperationVariant(m.CALL_OPERATIONS.START_CALL,m.OPERATION_VARIANTS.PREHEAT),(r=this.telemetryDataFromCallStartOptions(t.callStartOptions))&&this.callTelemetry.updateOperationData(m.CALL_OPERATIONS.START_CALL,r,i);var s=t.callStartOptions;s.isLwj=o,this.signalingSession.setInitialTelemetry(e,{correlationId:this.callId,causeId:i,conversationServiceUrl:n,callStartOptions:s,offerGenerationTime:Date.now()-t.callStartTime});break;case m.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL:case m.CALL_OPERATIONS.START_CALL_WITH_NUDGE:case m.CALL_OPERATIONS.START_CALL_AND_UNPARK:this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLER),this.signalingSession.setInitialTelemetry(e,{correlationId:this.callId,causeId:i,conversationServiceUrl:n,startCallOptions:t.callStartOptions,offerGenerationTime:Date.now()-t.callStartTime})}},n.prototype.setHold=function(e,t,n){return l(this,void 0,void 0,function(){var i,r,o,a,s,c,l=this;return u(this,function(u){switch(u.label){case 0:if(i=this.logger.createFnLogger("setHold",t,"hold="+e),!this.canToggleAudio||this.callHoldResumeDeferred)return[2,Promise.reject(new Error("can not set hold as it is already in progress"))];this.callHoldResumeDeferred=g.defer(),this.isHoldInProgress=e,this.canToggleAudio=!1,this.canToggleVideo=!1,this.canToggleScreenSharing=!1,this.requestedHoldState=e,r=function(){l.canToggleAudio=!0,l.canToggleScreenSharing=!0,l.canToggleVideo=!0},i.info("start, holdOptions: "+JSON.stringify(n)),o=this.callHoldResumeDeferred.promise,u.label=1;case 1:return u.trys.push([1,6,,7]),e?this.isMuteOnHold=n&&n.isLocal&&5!==this.state:this.prepareModalitiesForResume(t),this.isMuteOnHold?[3,3]:[4,this.updateMediaModalities(void 0,t)];case 2:a=u.sent(),this.updateVideoState(a,t),this.updateScreenSharingState(a,t),u.label=3;case 3:return e&&(this.prepareModalitiesForHold(t),5===this.state&&(this.callHoldResumeDeferred.resolve(),this.isHoldInProgress=!1,this.callHoldResumeDeferred=null),this.setCallState(4,t)),this.isMuteOnHold?[4,this.setMuteOnHold(e,t)]:[3,5];case 4:u.sent(),u.label=5;case 5:return r(),[3,7];case 6:return s=u.sent(),c=e?m.CALL_OPERATIONS.HOLD:m.CALL_OPERATIONS.UNHOLD,this.callTelemetry.updateOperationData(c,{error:B.getPIISafeObject(s)},t),i.logFailure(s),r(),this.callHoldResumeDeferred.reject(new Error("Failed setting hold state to "+e)),this.callHoldResumeDeferred=null,[3,7];case 7:return[2,o]}})})},n.prototype.transferCall=function(e){return this.logger.warn("transferCall is deprecated, please use callBlindTransfer instead"),this.callBlindTransfer(e)},n.prototype.callBlindTransfer=function(e,t,n){return void 0===t&&(t=y.generateCauseId()),this.executeCallTransfer(e,t,0,void 0,n)},n.prototype.callSafeTransfer=function(e,t,n){return void 0===t&&(t=y.generateCauseId()),this.executeCallTransfer(e,t,0,void 0,n)},n.prototype.transferCallToVoicemail=function(e,t){return void 0===t&&(t=y.generateCauseId()),this.executeCallTransfer(e.transferTargetMri,t,2,void 0,void 0)},n.prototype.callConsultativeTransfer=function(e,t){void 0===t&&(t=y.generateCauseId());var n=e.getCallReplacementDetails(),i=e.participants[0],r=i&&i.acceptedBy||i&&i.id;return this.executeCallTransfer(r,t,0,n,void 0)},n.prototype.consultativeTransferWithPickupCode=function(e,t){return l(this,void 0,void 0,function(){var n,i,r,o,a;return u(this,function(s){return(n=this.logger.createFnLogger(m.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,t)).info("pickup code: "+e),!e||isNaN(Number(e))?(n.info("pickup code cannot be empty"),[2,Promise.reject(_.getRejectTransactionEnd(m.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]):(i=this._callOperationHandler.createPendingOperation(m.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,t),r="4:"+m.UNPARK_CODE.SERVER_HOLD,o={unparkContent:{pickupCode:Number(e)}},a={disableForwardingAndUnanswered:!1},this.signalingSession.transferCallAsync(r,"TransferTypeStandard",o,a,t),[2,i])})})},n.prototype.convertParkContext=function(e){switch(e){case 1:return"sharedLinePark";case 0:return"teamPark";case 3:return"serverHoldV2";default:return"serverHold"}},n.prototype.park=function(e,t){var n=this;void 0===t&&(t=y.generateCauseId());var i=this.convertParkContext(e);return this.logger.info("["+t+"] ["+m.CALL_OPERATIONS.PARK_CALL+"] start -  context "+e+" parkType "+i),this._pendingParkPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.PARK_CALL),"serverHoldV2"!==i&&this._setParkState(1),this.signalingSession.parkCallAsync(i,t).catch(function(e){n.logger.info("["+t+"] ["+m.CALL_OPERATIONS.PARK_CALL+"] error in parkCallAsync (synchronous error) : "+B.getPIISafeObject(e)+". Hold promise will be rejected by signaling callback"),n.callTelemetry.updateOperationData(m.CALL_OPERATIONS.PARK_CALL,{error:B.getPIISafeObject(e)},t)}),this._pendingParkPromise},n.prototype.unpark=function(e,t){return l(this,void 0,void 0,function(){var n,i=this;return u(this,function(r){return n=this.convertParkContext(e),this.logger.info("["+t+"] ["+m.CALL_OPERATIONS.UNPARK_CALL+"] start -  context "+e+" parkType "+n),this._pendingUnparkPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.UNPARK_CALL),this.signalingSession.unparkAsync(n,t).catch(function(e){i.logger.info("["+t+"] ["+m.CALL_OPERATIONS.UNPARK_CALL+"] error in unparkAsync (synchronous error) : "+B.getPIISafeObject(e)+". Unhold promise will be rejected by signaling callback"),i.callTelemetry.updateOperationData(m.CALL_OPERATIONS.UNPARK_CALL,{error:B.getPIISafeObject(e)},t)}),[2,this._pendingUnparkPromise]})})},n.prototype.getServerHoldLocation=function(){var e=this;return this._pendingParkPromise.then(function(){return e.logger.info("getServerHoldLocation "+e.serverHoldLocation),e.serverHoldLocation})},n.prototype.getJoinBlob=function(){return Promise.resolve(JSON.stringify({conversationUrl:this.signalingSession.getConversationUrl(),conversationId:this.callId}))},n.prototype.getCallReplacementDetails=function(){return this.signalingSession.getCallReplacementDetails(this.callId)},n.prototype.getTechnicalInformationJson=function(){return Promise.reject(60)},n.prototype.isOneToOneCall=function(){return 1===this.callType&&1===this.participants.length},n.prototype.setMuteOnHold=function(e,t){return l(this,void 0,void 0,function(){var i,r=this;return u(this,function(o){switch(o.label){case 0:return i=["Audio","Video","ScreenShare"].filter(function(e){return("Audio"!==e||!r.isMuted)&&r.mediaStateConfigurationHelper.isSending(n.convertMediaType(e))}),e?[4,Promise.all(i.map(function(e){return r.mediaSession.muteInputTypeAsync(e,t)}))]:[3,2];case 1:return o.sent(),[3,4];case 2:return[4,Promise.all(i.map(function(e){return r.mediaSession.unmuteInputTypeAsync(e,t)}))];case 3:o.sent(),this.setCallState(3,t),this.isMuteOnHold=!1,o.label=4;case 4:return this.callHoldResumeDeferred.resolve(),this.isHoldInProgress=!1,this.callHoldResumeDeferred=null,[2]}})})},n.prototype.prepareModalitiesForResume=function(e){return l(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return this.mediaStateConfigurationHelper.isSending(1)?[4,this.turnOnLocalVideoPreview(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype.prepareModalitiesForHold=function(e){return l(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this.turnOffLocalVideoPreview(e)];case 1:return t.sent(),[2]}})})},n.prototype.updateVideoState=function(e,t){this.setVideoOn(e.video===this.mediaAgent.constants.MEDIA_STATE.sendReceive||e.video===this.mediaAgent.constants.MEDIA_STATE.send,t)},n.prototype.updateScreenSharingState=function(e,t){this.setScreenSharingOn(e.sharing===this.mediaAgent.constants.MEDIA_STATE.send,t)},n.prototype.subscribeOnSharedScreenHandleEvents=function(e){var t=this;this.sharedHandleSubs=e.on("onStreamStateChanged",function(e,n){return t.onSharingStreamStateChanged(e)})},n.prototype.unsubscribeFromSharedScreenHandleEvents=function(){this.sharedHandleSubs.dispose(),this.sharedHandleSubs=null},n.prototype.onSharingStreamStateChanged=function(e){var t=y.generateCauseId();this.logger.info("["+t+"] Sharing stream state moved to "+e);var i={mediaType:3,mediaDirection:1,mediaStreamState:n.streamingStatetoMediaStreamState(e)};this.event("mediaStreamStateChanged").raise(i),this.callStats.localStats.screenShare.streamStateChanged(e),"stopped"===e&&(this.canToggleScreenSharing=!0,this.stopScreenSharing(),"screenSharingCall"!==this.conversationType||this.participants.some(function(e){return 3===e.state})||this.stop(!0,t))},n.prototype.startScreenSharing=function(e,t,n,i){return void 0===i&&(i=y.generateCauseId()),l(this,void 0,void 0,function(){var e,t,n=this;return u(this,function(r){return e=this.logger.createFnLogger(m.CALL_OPERATIONS.START_SCREEN_SHARING,i),this.isJoinedLightweight()?(e.logFailure("Can not start screen sharing in lightweight call"),[2,Promise.reject(60)]):this.canToggleScreenSharing?this.isScreenSharingOn?(e.logSuccess("Resolving early because screen sharing is already on"),[2,Promise.resolve()]):(this.screenSharingRenegotiationDeferred&&(e.logFailure("called before the renegotiation deferred for the previous one has been closed"),this.screenSharingRenegotiationDeferred.resolve()),this.screenSharingRenegotiationDeferred=g.defer(),this.callStats.localStats.newSession(3),this.callStats.localStats.screenShare.start(),this.mediaStateConfigurationHelper.isDisabled(3)&&e.info("sharing modality was skipped till now. Adding it now"),this.canToggleScreenSharing=!1,t=function(){n.canToggleScreenSharing=!0},this.callStats.localStats.screenShare.event(N.MediaSenderEvent.SelectSource),[2,this.getScreenHandle().acquire().then(function(){return e.logSuccess("sharing stream acquired"),n.mediaStateConfigurationHelper.enableModality(3),n.updateMediaModalities(void 0,i)}).then(function(){return e.logSuccess("updateMediaModalities done"),n.callStats.localStats.screenShare.negotiationStateChanged("started"),n.setScreenSharingOn(!0,i),t(),n.screenSharingRenegotiationDeferred.promise}).then(function(){n.callStats.localStats.screenShare.negotiationStateChanged("completed")}).catch(function(r){n.callTelemetry.updateOperationData(m.CALL_OPERATIONS.START_SCREEN_SHARING,{error:B.getPIISafeObject(r)},i),n.setScreenSharingOn(!1,i),n.mediaStateConfigurationHelper.removeModality(3),t(),n.disposeSharingScreenHandle();var o=r.error;throw o&&o.code===w.jsCallEndCodes.GlareError?(n.callStats.localStats.screenShare.negotiationStateChanged("rejected","glare"),e.logFailure("starting screen sharing failure with reason glare")):"ScreenSharingStopped"===r.reason?(n.callStats.localStats.screenShare.negotiationStateChanged("rejected","sharingStopped"),e.logFailure("expectedstarting screen sharing failure with reason stopped")):(n.callStats.localStats.screenShare.negotiationStateChanged("rejected","other"),e.logFailure(r)),r})]):[2,Promise.reject(new Error("cannot start screen sharing"))]})})},n.prototype.stopScreenSharing=function(e,t,n){return void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var e,t,i=this;return u(this,function(r){return e=this.logger.createFnLogger(m.CALL_OPERATIONS.STOP_SCREEN_SHARING,n),this.isJoinedLightweight()?(e.logFailure("Can not stop screen sharing in lightweight call"),[2,Promise.reject(60)]):this.canToggleScreenSharing?(this.screenSharingRenegotiationDeferred&&(this.screenSharingRenegotiationDeferred.reject({reason:"ScreenSharingStopped"}),this.screenSharingRenegotiationDeferred=null),this.mediaStateConfigurationHelper.removeModality(3),this.canToggleScreenSharing=!1,t=function(){i.canToggleScreenSharing=!0,i.callStats.localStats.screenShare.stop(),i.disposeSharingScreenHandle()},[2,this.updateMediaModalities(void 0,n).then(function(){return i.setScreenSharingOn(!1,n)}).then(t,function(r){throw e.logFailure(r),i.callTelemetry.updateOperationData(m.CALL_OPERATIONS.STOP_SCREEN_SHARING,{error:B.getPIISafeObject(r)},n),t(),r})]):(e.logFailure("cannot stop screen sharing"),[2,Promise.reject(new Error("cannot stop screen sharing"))])})})},n.prototype.startDataChannel=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return this.mediaStateConfigurationHelper.enableModality(4),[4,this.updateMediaModalities({},t)];case 1:return e.sent(),[2]}})})},n.prototype.stopDataChannel=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return this.mediaStateConfigurationHelper.removeModality(4),[4,this.updateMediaModalities({},t)];case 1:return e.sent(),[2]}})})},n.prototype.sendUserEvents=function(e,t){return l(this,void 0,void 0,function(){return u(this,function(n){return[2,this.dataChannel.sendUserEvents(e,t)]})})},n.prototype.shareSystemSound=function(e){return l(this,void 0,void 0,function(){return u(this,function(e){return[2,Promise.reject(60)]})})},n.prototype.mute=function(e){return void 0===e&&(e=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(t){return this.isMuted?[2,Promise.reject(_.getRejectTransactionEnd(m.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]:[2,this.muteUnmute(!0,e)]})})},n.prototype.unmute=function(e){return void 0===e&&(e=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(t){return[2,this.muteUnmute(!1,e)]})})},n.prototype.muteSpeaker=function(e){return void 0===e&&(e=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(t){return[2,this.muteUnmuteSpeaker(!0,e)]})})},n.prototype.unmuteSpeaker=function(e){return void 0===e&&(e=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(t){return[2,this.muteUnmuteSpeaker(!1,e)]})})},n.prototype.muteParticipants=function(e,t,i){return void 0===i&&(i=y.generateCauseId()),l(this,void 0,void 0,function(){var r,o,a,s=this;return u(this,function(c){return(r=this.logger.createFnLogger(m.CALL_OPERATIONS.MUTE_PARTICIPANTS,i,"muteScope="+e)).info("callParticipants count="+t.length),void 0===(o=n.convertMuteScope(e))?(r.logFailure("Unrecognized "+e),[2,Promise.reject(new Error("Unrecognized muteScope"))]):P.callStateIsAnyOf(this.state,[11,12])?(r.logFailure("Can not mute/unmute during preheat call"),[2,Promise.reject(60)]):(a=[],t.forEach(function(e){a.push(e.id)}),[2,this.signalingSession.muteAsync(o,a,i).then(function(e){return s.handleParticipantsMutedUpdated(e)}).catch(function(e){return s.callTelemetry.updateOperationData(m.CALL_OPERATIONS.MUTE_PARTICIPANTS,{error:B.getPIISafeObject(e)},i),r.logFailure(e),e&&e.endCode?Promise.reject(e.endCode):Promise.reject(e)})])})})},n.prototype.startAudio=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var e,n,i;return u(this,function(r){switch(r.label){case 0:if(e=this.logger.createFnLogger(m.CALL_OPERATIONS.START_AUDIO,t),3!==this.state)return e.logFailure("Cannot startAudio when call is not connected"),[2,Promise.reject(60)];if(this.isJoinedLightweight())return e.logFailure("Can not startAudio in lightweight call"),[2,Promise.reject(60)];if(this.mediaStateConfigurationHelper.enableModality(0),this.callUsesMixer&&this.mediaStateConfigurationHelper.removeModality(1),!this.mediaStateConfigurationHelper.isSending(1))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.turnOnLocalVideoPreview(t)];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),e.logFailure(n),[2,Promise.reject(25)];case 4:return[4,this.startStopAudio(!0,t)];case 5:return i=r.sent(),[4,this.signalingSession.recordTelemetryForStartAudio(i)];case 6:return r.sent(),[2,i]}})})},n.prototype.stopAudio=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var e,n;return u(this,function(i){switch(i.label){case 0:return e=this.logger.createFnLogger(m.CALL_OPERATIONS.STOP_AUDIO,t),3!==this.state?(e.logFailure("Cannot stopAudio when call is not connected"),[2,Promise.reject(60)]):this.isJoinedLightweight()?(e.logFailure("Can not stopAudio in lightweight call"),[2,Promise.reject(60)]):(this.mediaStateConfigurationHelper.removeModality(0),[4,this.startStopAudio(!1,t)]);case 1:return n=i.sent(),[4,this.turnOffLocalVideoPreview(t)];case 2:return i.sent(),[4,this.signalingSession.recordTelemetryForStopAudio(n)];case 3:return i.sent(),[2,n]}})})},n.prototype.assimilate=function(e,t,n,i){return void 0===i&&(i=y.generateCauseId()),Promise.reject(new Error("Not implemented"))},n.prototype.merge=function(e,t,n){return void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var i,r;return u(this,function(o){switch(o.label){case 0:return(i=this.logger.createFnLogger(m.CALL_OPERATIONS.MERGE_CALL,n)).error("merge callId "+e.callId+" callMergeOptions "+JSON.stringify(t)),(r=this.canMerge(e,n))?[4,this.mergeCallByAddParticipantWithReplaces(t,e.participants,e,1,m.CALL_OPERATIONS.MERGE_CALL,n)]:(i.info("Error. "+B.getPrintableObject(r)),[2,Promise.reject(_.getRejectTransactionEnd(m.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]);case 1:return[2,o.sent()[0]]}})})},n.prototype.mergeParticipants=function(e,t,n,i){return l(this,void 0,void 0,function(){var r,o,a,s,c,l,p,f;return u(this,function(u){if(a=[],!e)return[2,Promise.reject(_.getRejectTransactionEnd("Invalid callToMerge"))];if(0===t.length)return[2,Promise.reject(_.getRejectTransactionEnd("Invalid participantIds"))];try{for(s=d(t),c=s.next();!c.done;c=s.next()){if(l=c.value,!(p=b.findParticipantUsingParticipantLegId(e,l)))return[2,Promise.reject(_.getRejectTransactionEnd("participantId "+l+" is invalid!"))];f={id:p.id,participantId:l},a.push(f)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}return[2,this.mergeCallByAddParticipantWithReplaces(n,a,e,3,m.CALL_OPERATIONS.MERGE_PARTICIPANT,i)]})})},n.prototype.mergeWithPickupCode=function(e,t,n){return void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var i,r,o,a=this;return u(this,function(s){return(i=this.logger.createFnLogger(m.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,n)).info("mergeWithPickupCode: pickup code: "+e+", threadId: "+O.getLoggableThreadId(t.threadId)+" messageId: "+t.messageId),!e||isNaN(Number(e))?(i.info("mergeWithPickupCode: pickup code cannot be empty"),[2,Promise.reject(_.getRejectTransactionEnd("mergeWithPickupCode: pickup code cannot be empty"))]):(r={additionalData:t.additionalData,threadId:t.threadId,messageId:t.messageId,replacementType:2,pickupCode:Number(e)},o={id:"4:"+m.UNPARK_CODE.SERVER_HOLD},[2,Promise.resolve().then(function(){return Promise.all(a.signalingSession.addParticipantsAsync([o],r,n))}).then(function(t){return t.length>0&&a.signalingNotifications.onParticipantJoined(t[0],n),a.callTelemetry.recordOperationSuccess(m.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,null,e,n),Promise.resolve({code:m.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:m.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE})}).catch(function(e){i.logFailure("Participant was not added to call, error="+B.getPrintableObject(e));var t=a._handleParticipantOperationFailure(m.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,e,n,null).reason;return Promise.reject(e?e.endCode:t||0)})])})})},n.prototype.setMaxVideoChannels=function(e){return l(this,void 0,void 0,function(){return u(this,function(e){return[2,Promise.reject(60)]})})},n.prototype.stop=function(e,t,n,i){return void 0===e&&(e=!1),void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var r,a,s,c;return u(this,function(l){return r=this.logger.createFnLogger(m.CALL_OPERATIONS.STOP_AUDIO,t),6===this.state?(r.logFailure("Trying to stop a call which is already Disconnecting"),[2,Promise.reject(new Error("cannot stop call in Disconnecting state"))]):7===this.state?(r.logFailure("Trying to stop a call which is already Disconnected"),[2,Promise.reject(new Error("cannot stop call in Disconnected state"))]):this.disposedPromise?[2,Promise.reject("Call already ended")]:(a=0,1===this.state&&(a=10),s=i?{clientReasonSubCode:i.clientSubCode,clientReasonPhrase:i.clientPhrase}:{},c=o({terminatedReason:a,forEveryone:e,causeId:t},n,{rejectReason:s}),[2,this.stopInternal(c)])})})},n.prototype.publishState=function(e,t){var n=this.getPluginlessStateType(e.type),i=this.getPluginlessPublishLevel(e.level),r=e.participantIds&&e.participantIds.length>0?z.Specified:void 0;return this.callTelemetry.setOperationVariant(m.CALL_OPERATIONS.PUBLISH_STATE,r===z.Specified?""+n+m.OPERATION_VARIANTS.SPECIFIED:""+n+m.OPERATION_VARIANTS.NONE),this.signalingSession.publishStateAsync(n,i,t,e.content,r,e.participantIds)},n.prototype.publishStatesForEveryone=function(e,t){var n=this.getPluginlessStateType(e.type),i=this.getPluginlessPublishLevel(e.level),r=z.All;return this.callTelemetry.setOperationVariant(m.CALL_OPERATIONS.PUBLISH_STATE,""+n+m.OPERATION_VARIANTS.ALL),this.signalingSession.publishStateAsync(n,i,t,e.content,r)},n.prototype.removeState=function(e,t){return this.signalingSession.removeStateAsync(t,z.Specified,void 0,e.stateIds).then(function(e){return Promise.resolve()})},n.prototype.removeStatesForEveryone=function(e,t){var n=this.getPluginlessStateType(e.type);return this.signalingSession.removeStateAsync(t,z.All,n,void 0).then(function(e){return Promise.resolve()})},n.prototype.updateMeetingSettings=function(e,t){return this.signalingSession.updateMeetingSettingsAsync({allowRaiseHands:e.allowRaiseHands,attendeeRestrictions:e.attendeeRestrictions,lockMeeting:e.lockMeeting},t)},n.prototype.updateMeetingRoles=function(e,t,n){return void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(i){return 3===this.state&&this.signalingSession.hasOwnProperty("updateMeetingRolesAsync")?[2,this.signalingSession.updateMeetingRolesAsync(e,t,n)]:[2,Promise.reject({code:S.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:S.CONSTANTS.SUB_CODE.ACTION_NOT_ALLOWED,phrase:"ActionNotAllowed"})]})})},n.prototype.stopInternal=function(e){var t=this,n=this.logger.createFnLogger("stopInternal",e.causeId),i=e.terminatedReason||0,r=e.rejectReason&&(e.rejectReason.code||e.rejectReason.subCode)?e.rejectReason:this.getRejectionInfoFromTerminatedReason(i);if(e.rejectReason&&(r||(r={}),r.clientReasonSubCode=e.rejectReason.clientReasonSubCode,r.clientReasonPhrase=e.rejectReason.clientReasonPhrase),n.info("started, terminatedReason="+i+", rejectReason="+B.safeJsonStringify(r)),6===this.state)return n.logFailure("Trying to stop a call which is already Disconnecting"),this.disconnectingPromise;if(7===this.state)return n.logFailure("Trying to stop a call which is already Disconnected"),this.disconnectingPromise;this.setCallState(6,e.causeId,i);var o={causeId:e.causeId,forEveryone:e.forEveryone,scope:this.mapEndpointScope(e.scope)};return 1===e.scope&&(r.code=S.CONSTANTS.CODE.SUCCESS,r.subCode=S.CONSTANTS.SUB_CODE.ENDED_BY_REMOTE_ENDPOINT,r.phrase=w.jsCallEndPhrase.EndedByRemoteEndpoint),this.disconnectingPromise=Promise.all([this.cleanUpMedia(e.causeId,r).catch(function(e){throw n.logFailure("cleanUpMedia failed with reason="+B.getPrintableObject(e)),e}),this.signalingSession.endAsync(r,o).catch(function(e){throw n.logFailure("endAsync failed with reason="+B.getPrintableObject(e)),e})]).catch(function(i){throw n.logFailure(i),t.cleanUp(e.causeId,r),i}).then(function(){return t.cleanUp(e.causeId,r)}).catch(function(n){throw t.callTelemetry.updateOperationData(m.CALL_OPERATIONS.STOP_CALL,{error:B.getPIISafeObject(n)},e.causeId),t.setCallState(7,e.causeId,i),n}),this.disconnectingPromise},n.prototype.cleanUp=function(e,t){return l(this,void 0,void 0,function(){var n=this;return u(this,function(i){return this.logger.info("["+e+"][cleanup]start"),this.disposedPromise||(this.disposedPromise=this.cleanUpFinalize(e,t),this._getCallEndOperation().catch(H.noop).then(function(){var t={code:S.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:S.CONSTANTS.SUB_CODE.ABANDONED};n._callOperationHandler.rejectPendingOperations(61,e,t),n._participantOperationHandler.rejectPendingOperations(47,e,t)})),[2,this.disposedPromise]})})},n.prototype.cleanUpMedia=function(e,t){return l(this,void 0,void 0,function(){var n=this;return u(this,function(i){return this.mediaDisposedPromise||(this.mediaDisposedPromise=l(n,void 0,void 0,function(){var n,i;return u(this,function(r){switch(r.label){case 0:if(this.turnOffLocalVideoPreview(e),this.localVideoContainer=null,this.disposeContentSharingSessions(),this.disposeSharingScreenHandle(),n=this.mediaSession,this.reportMediaStats=!!n,!n)return[2];this.dataChannel.dispose(),this.mediaSession=null,this.streamManager.setMediaSession(null,e),i=n.terminate(e,t),this.isVideoOn=!1,this.setMediaStream(this.isVideoOn,!1,1),r.label=1;case 1:return r.trys.push([1,,3,5]),[4,i];case 2:return r.sent(),[3,5];case 3:return[4,this.collectCallStats(n)];case 4:return r.sent(),[7];case 5:return[2]}})})),[2,this.mediaDisposedPromise]})})},n.prototype.cleanUpFinalize=function(e,t){return l(this,void 0,void 0,function(){var n,i;return u(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.cleanUpMedia(e,t)];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),this.logger.info("["+e+"][cleanUpMedia] failure: "+B.getPrintableObject(n)),[3,3];case 3:return i=this.reportCallEndStats(this.reportMediaStats),this.mediaAgent&&this.mediaAgent.getConfig().waitReportStatsAtCallStop?[4,i]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}})})},n.prototype.shouldFallbackToLwj=function(e,t){t.info("Checking whether to fallback to LWJ");var n=this.signalingSession.getMeetingInfo();if(!n)return t.info("Not falling back to LWJ because call isn't a scheduled meeting (meetingInfo = "+JSON.stringify(n)+")"),!1;var i=this.callSettings.automaticLwjFallback&&this.callSettings.automaticLwjFallback.codeSubcodePairs;if(!i||!i.some(function(t){return t[0]===e[0]&&t[1]===e[1]}))return t.info("Not falling back to LWJ because [code, subcode] is "+JSON.stringify(e)+" but eligible reasons are "+JSON.stringify(i)),!1;var r=this.meetingDetails&&this.meetingDetails.capabilities&&this.meetingDetails.capabilities.allowDialinConferencing;return r?(t.info("Falling back to LWJ (terminatedReason "+e+", allowDialinConferencing "+r+")"),!0):(t.info("Not falling back to LWJ because allowDialinConferencing is "+r),!1)},n.prototype.createContentSharingSession=function(e,t,n,i,r){return void 0===r&&(r=y.generateCauseId()),l(this,void 0,void 0,function(){var r,o,a=this;return u(this,function(s){return"attendee"===this.meetingRole?(r={terminatedReason:8,terminatedReasonCode:403,terminatedReasonSubCode:0,errorMessage:"Failed due to insufficient permissions"},[2,Promise.reject(r)]):(o=new U.default(this.callTelemetry,this.logger,this.signalingSession,e,t,i,n),this.contentSharingSessions.push(o),o.changed(function(){return a.removeContentSessionIfEnded(o)}),this.event("contentSharingChanged").raise(),[2,Promise.resolve(o)])})})},n.prototype.stopWithBeacon=function(e){return void 0===e&&(e=y.generateCauseId()),6===this.state||7===this.state||this.signalingSession.endWithBeacon(e)},n.prototype.disposeContentSharingSessions=function(){var e=this;this.contentSharingSessions.forEach(function(t){t.dispose(),e.removeContentSessionIfEnded(t)}),this.event("contentSharingChanged").raise()},n.prototype.isPreheatedOnly=function(){return!!(12===this.state||2===this.state&&this._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.JOIN_PREHEATED_CALL)||9===this.state&&this._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.JOIN_PREHEATED_CALL))},n.prototype.removeContentSessionIfEnded=function(e){7!==e.contentSharingStatus&&8!==e.contentSharingStatus||(this.logger.info("stopping the content sharing session."),f.remove(this.contentSharingSessions,function(t){return t.contentSharingGuid===e.contentSharingGuid}).length&&this.event("contentSharingChanged").raise())},n.prototype.getRejectionInfoFromTerminatedReason=function(e){switch(e){case 53:return{code:w.jsCallEndCodes.MediaError,subCode:w.jsCallEndSubCodes.MediaWhiteListingIssue,phrase:w.jsCallEndPhrase.MediaWhiteListingIssue};case 4:return{code:w.jsCallEndCodes.MediaError,subCode:this._wasAudioStreamConnected?w.jsCallEndSubCodes.MediaDropAfterConnect:w.jsCallEndSubCodes.MediaDropDuringConnect,phrase:this._wasAudioStreamConnected?w.jsCallEndPhrase.MediaDropAfterConnect:w.jsCallEndPhrase.MediaDropDuringConnect};case 47:return{code:w.jsCallEndCodes.MediaError,subCode:w.jsCallEndSubCodes.MediaOfferProcessingError,phrase:w.jsCallEndPhrase.MediaOfferProcessingError};case 38:return{code:w.jsCallEndCodes.MediaError,subCode:w.jsCallEndSubCodes.MediaRenegotiationError,phrase:w.jsCallEndPhrase.RetargetNotSupported};case 10:return{code:w.jsCallEndCodes.Reject,subCode:w.jsCallEndSubCodes.Success,phrase:w.jsCallEndPhrase.CallEndReasonLocalUserInitiated};case 25:return{code:w.jsCallEndCodes.UnknownError,subCode:w.jsCallEndSubCodes.MediaUnknownError,phrase:w.jsCallEndPhrase.MediaError};case 58:return{code:w.jsCallEndCodes.MediaError,subCode:w.jsCallEndSubCodes.MediaPermissionError,phrase:w.jsCallEndPhrase.MediaPermissionError};case 7:return{code:w.jsCallEndCodes.UnknownError,subCode:w.jsCallEndSubCodes.Success,phrase:w.jsCallEndPhrase.Unknown};case 0:case 1:return{code:w.jsCallEndCodes.Success,subCode:w.jsCallEndSubCodes.Success,phrase:w.jsCallEndPhrase.CallEndReasonLocalUserInitiated}}return null},n.prototype.acknowledge=function(e,t,n){return void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var i,r,o,a,s,c,d=this;return u(this,function(p){switch(p.label){case 0:if(i=this.logger.createFnLogger(m.CALL_OPERATIONS.ACKNOWLEDGE,n),r=Date.now(),this.setInitialTelemetry(m.CALL_OPERATIONS.ACKNOWLEDGE,{callStartTime:r},"",n),0!==this.state&&8!==this.state)throw new Error("Trying to acknowledge a call that has already been acted on "+this.state);i.info("isMultiParty="+e.isMultiParty),i.info("fromMixer="+e.fromMixer),i.info("participantId="+e.participantId),i.info("callType="+e.callType),this.attachToCallAndGetOffer=g.defer(),this.setCallType(e.isMultiParty?2:1,n),this.setCallUsesMixer(!!e.fromMixer,n),this.setCallerMri(T.stripMriAliases(e.callerId)),this.setTransferorMri(e.transferorId),this.transferorType=e.transferorType,this.transferorDisplayName=e.transferorDisplayName,this.incomingCallType=e.callType,this.consultativeCallId=e.consultativeCallId,this.callQueueInfo=e.callQueueInfo,this.callStats.localStats.startCall(),o=R.default(i),p.label=1;case 1:return p.trys.push([1,3,,4]),o.executeSync(w.CallAckSignalingPhase.ProcessIncomingCallRequest,function(){return d.signalingSession.processIncomingCallRequest(e,t,n)}),this.setParticipantId(this.participantId),o.executeSync(w.CallAckSignalingPhase.ResolvePotentialConflict,function(){return d.signalingAgent.resolvePotentialCallConflict(d.signalingSession)})===this.signalingSession?[2,Promise.reject({code:7,success:!1})]:(a=function(){return l(d,void 0,void 0,function(){var e,t,r,a,s=this;return u(this,function(c){switch(c.label){case 0:return o.executeSync(w.CallAckMediaPhase.InitializeMediaSession,function(){return s.initializeMediaSession(n)}),e=this.signalingSession.getInitialMediaOfferFromIncomingCallPayload(),this.callStats.setParticipantId(this.participantId),this.onBehalfOfMri=this.signalingSession.onBehalfOf,[4,o.execute(w.CallAckSignalingPhase.WaitForMediaOffer,function(){return e?Promise.resolve(e):s.attachToCallAndGetOffer.promise})];case 1:t=c.sent(),c.label=2;case 2:return c.trys.push([2,4,,6]),[4,o.execute(w.CallAckMediaPhase.ProcessOffer,function(){return s.mediaSession.processOfferAsync(t,n)})];case 3:return r=c.sent(),[3,6];case 4:return a=c.sent(),[4,this._handleOfferProcessingError(a,n,i)];case 5:return r=c.sent(),[3,6];case 6:return[4,o.execute(w.CallAckMediaPhase.ProcessOfferedModalities,function(){return s._processOfferedModalities(r,n)})];case 7:return c.sent(),[4,o.execute(w.CallAckMediaPhase.TrySendingProvisionalAnswer,function(){return s._trySendProvisionalMediaAnswer(n)})];case 8:return c.sent(),[2]}})})},s=o.execute(w.CallAckSignalingPhase.SendAttach,function(){return d.signalingSession.sendAttachToCall(n)}).then(function(){return d.setCallState(1,n)}),[4,Promise.all([s,a()]).catch(function(e){return l(d,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,s];case 1:throw t.sent(),e}})})})]);case 2:return p.sent(),[2,o.executeSync(w.CallAckSignalingPhase.OnAcknowledgeSuccess,function(){return d._onAcknowledgeSuccess(i,o.getTelemetryData(),n)})];case 3:return c=p.sent(),[2,this._onAcknowledgeError(c,n,i,o.getTelemetryData())];case 4:return[2]}})})},n.prototype.accept=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var n,i,r,o,a,s,c,l,d=this;return u(this,function(u){switch(u.label){case 0:if((n=this.logger.createFnLogger(m.CALL_OPERATIONS.ACCEPT,t)).info("accept, answerMediaType: "+e.answerMediaType+",\n                            withVideo: "+e.withVideo+",\n                            muted: "+e.muted+",\n                            getSendMediaModalities: "+JSON.stringify(e.sendMediaModalities)+",\n                            clientEndpointCapabilities: "+e.clientEndpointCapabilities),1!==this.state)throw new Error("Only calls in Notified state can be accepted");i=this._callOperationHandler.createPendingOperation(m.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,t),this.callStats.localStats.audio.start(),r=R.default(n),this.mediaSession.createAudioElement(t),this.setMuted(e.muted?w.ParticipantMuteState.Muted:w.ParticipantMuteState.Unmuted,t),this.setCallState(2,t),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.ACCEPT),u.label=1;case 1:return u.trys.push([1,9,,10]),this.mediaStateConfigurationHelper.setCallAcceptOptions(e),this.mediaStateConfigurationHelper.isSending(1)?[4,r.execute(w.CallSetupMediaPhase.StartVideoSafe,function(){return d.startVideoSafe(t)})]:[3,3];case 2:u.sent(),u.label=3;case 3:return[4,r.execute(w.CallSetupMediaPhase.UpdateMediaModalities,function(){return d.updateMediaModalities(void 0,t)})];case 4:return o=u.sent(),a=r.executeSync(w.CallSetupSignalingPhase.GetSignalingMediaTypes,function(){return d.getSignalingMediaTypes(o)}),[4,r.execute(w.CallSetupMediaPhase.CreateAnswer,function(){return d.mediaSession.createAnswerAsync(!1,t)})];case 5:return s=u.sent(),[4,r.execute(w.CallSetupSignalingPhase.Accept,function(){return d.signalingSession.acceptAsync(s,a,e.clientEndpointCapabilities,t)})];case 6:return u.sent(),[4,r.execute(w.CallSetupSignalingPhase.WaitForConnect,function(){return i})];case 7:return u.sent(),this.handleRemoteParticipantStateInOneToOneCall(t),[4,r.execute(w.CallSetupMediaPhase.CompleteNegotiation,function(){return d.completeNegotiationAsync(t)})];case 8:return u.sent(),this.callTelemetry.updateOperationData(m.CALL_OPERATIONS.ACCEPT,{phases:r.getTelemetryData()},t),[3,10];case 9:throw c=u.sent(),l=c,this.callTelemetry.updateOperationData(m.CALL_OPERATIONS.ACCEPT,this.getTelemetryFromPhaseExecution(c),t),n.logFailure(c),R.isOneOfPhaseErrors(w.CallSetupSignalingPhase,c)&&(l=7),R.isOneOfPhaseErrors(w.CallSetupMediaPhase,c)&&(l=47),l;case 10:return[2]}})})},n.prototype.reject=function(e,t){return void 0===e&&(e=y.generateCauseId()),l(this,void 0,void 0,function(){var n;return u(this,function(i){return n=t?{clientReasonSubCode:t.clientSubCode,clientReasonPhrase:t.clientPhrase}:{},[2,1!==this.state?Promise.reject(60):this.stopInternal({terminatedReason:10,causeId:e,rejectReason:n})]})})},n.prototype.join=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var i;return u(this,function(r){return i=Date.now(),this.setInitialTelemetry(m.CALL_OPERATIONS.JOIN_CALL,{callStartOptions:t,callStartTime:i},e.conversationUrl,n),this.setCallerMri(T.stripMriAliases(e.groupCallInitiator)),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.JOIN_CALL),[2,this.joinOrStartCall({callStartOptions:M.getCallStartOptions(t),callStartTime:i},this.joinGivenConversation,n,e.conversationUrl)]})})},n.prototype.joinPreheatedCall=function(e,t){return l(this,void 0,void 0,function(){var n,i,r,o,a,s,c,l=this;return u(this,function(u){switch(u.label){case 0:n=this.logger.createFnLogger(m.CALL_OPERATIONS.JOIN_PREHEATED_CALL,t),i=this.isServerMuted||1==(1&e.muteFlags),r=2==(2&e.muteFlags),o=R.default(n),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.JOIN_PREHEATED_CALL),u.label=1;case 1:return u.trys.push([1,8,,9]),a={endpointProperties:{preheatProperties:0}},this.setCallState(2,t),i?[3,3]:[4,o.execute(w.CallSetupMediaPhase.UnmuteInput,function(){return l.mediaSession.unmuteInputAsync(t)})];case 2:return u.sent(),this.setMuted(w.ParticipantMuteState.Unmuted,t),[3,4];case 3:a.state={isMuted:!0},u.label=4;case 4:return r?[3,6]:[4,o.execute(w.CallSetupMediaPhase.UnmuteOutput,function(){return l.mediaSession.unmuteOutputAsync(t)})];case 5:u.sent(),this.setSpeakerMuted(!1,t),u.label=6;case 6:return[4,this.signalingSession.updateEndpointState(a,t)];case 7:return u.sent(),this._callInLobby?this.setCallState(10,t):this.setCallState(3,t),[3,9];case 8:return s=u.sent(),c=void 0,n.logFailure(" error: 7 "+B.getPrintableObject(s)),_.isTransactionEnd(s)?c=s:R.isPhaseError(w.CallSetupMediaPhase.UnmuteInput,s)?c={code:w.jsCallEndCodes.LocalError,subCode:w.jsCallEndSubCodes.MediaUnmuteMicrophoneError,phrase:B.getPrintableObject(s),causeId:t}:R.isPhaseError(w.CallSetupMediaPhase.UnmuteOutput,s)&&(c={code:w.jsCallEndCodes.LocalError,subCode:w.jsCallEndSubCodes.MediaUnmuteSpeakerError,phrase:B.getPrintableObject(s),causeId:t}),this.callTelemetry.updateOperationData(m.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{phases:o.getTelemetryData(),error:B.getPIISafeObject(s)},t),this.stopInternal({causeId:t,terminatedReason:7,rejectReason:c}),[2,Promise.reject(c)];case 9:return[2]}})})},n.prototype.start=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var n;return u(this,function(i){return n=Date.now(),this.setCallerMri(T.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(m.CALL_OPERATIONS.START_CALL,{callStartOptions:e,callStartTime:n},"",t),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.START_CALL),[2,this.joinOrStartCall({callStartOptions:M.getCallStartOptions(e),callStartTime:n},this.startOutgoingCall,t)]})})},n.prototype.startCallToVoicemail=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var n;return u(this,function(i){return n=Date.now(),this.setCallerMri(T.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(m.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{callVoicemailStartOptions:e,callStartTime:n},"",t),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL),[2,this.joinOrStartCall({callVoicemailStartOptions:e,callStartTime:n},this.startVM,t)]})})},n.prototype.joinCallWithoutCallModality=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var i,r=this;return u(this,function(o){return i=Date.now(),this.setCallerMri(e.groupCallInitiator),this.setCallType(2,n),this.setInitialTelemetry(m.CALL_OPERATIONS.SUBSCRIBE,{callStartOptions:M.getCallStartOptions(t),callStartTime:i},e.conversationUrl,n),0!==this.state?(this.logger.info("["+n+"][joinCallWithoutCallModality]Trying to subscribe to a call that has already been acted on"),[2,Promise.reject(60)]):(this.setCallState(8,n),this.signalingSession.subscribeToCall(e.conversationUrl,this.callId,t.clientEndpointCapabilities,{meetingRegistrationId:t.meetingRegistrationId},n).catch(function(e){return _.isTransactionEnd(e)?(r.logger.info("["+n+"][joinCallWithoutCallModality] "+B.getPrintableObject(e)),Promise.reject(e)):Promise.reject(M.convertReason(e))}),[2,this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.SUBSCRIBE,void 0,n)])})})},n.prototype.startWithMeetingData=function(e,t){var n=Date.now();return this.setCallerMri(T.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(m.CALL_OPERATIONS.START_WITH_MEETING_DATA,{callStartOptions:t,callStartTime:n},"",e),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.START_WITH_MEETING_DATA),this.joinOrStartCall({callStartOptions:M.getCallStartOptions(t),callStartTime:n},this.startOutgoingCall,e)},n.prototype.joinWithMeetingData=function(e,t,n){var i=Date.now();return this.setInitialTelemetry(m.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,{callStartOptions:n,callStartTime:i},t.conversationUrl,e),this.setCallerMri(T.stripMriAliases(t.groupCallInitiator)),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA),this.joinOrStartCall({callStartOptions:M.getCallStartOptions(n),callStartTime:i},this.joinGivenConversation,e,t.conversationUrl)},n.prototype.subscribeWithMeetingData=function(e,t,n){var i=this,r=Date.now();return this.setCallerMri(t.groupCallInitiator),this.setCallType(2,e),this.setInitialTelemetry(m.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,{callStartOptions:M.getCallStartOptions(n),callStartTime:r},t.conversationUrl,e),0!==this.state?(this.logger.info("["+e+"][subscribeWithMeetingData]Trying to subscribe to a call that has already been acted on"),Promise.reject(60)):(this.setCallState(8,e),this.signalingSession.subscribeToCall(t.conversationUrl,this.callId,n.clientEndpointCapabilities,{meetingPreferences:{shouldResurrect:n.shouldResurrect},meetingData:this.meetingData,meetingRegistrationId:n.meetingRegistrationId},e).catch(function(t){return _.isTransactionEnd(t)?(i.logger.info("["+e+"][subscribeWithMeetingData] "+B.getPrintableObject(t)),Promise.reject(t)):Promise.reject(M.convertReason(t))}),this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,void 0,e))},n.prototype.startCallWithNudge=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var i,r;return u(this,function(o){return this.setCallerMri(T.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.START_CALL_WITH_NUDGE),i=Date.now(),this.logger.info("["+n+"][startCallWithNudge]startCallWithNudge for participants: "+O.scrubMriOrOmitList(e)),this.participants.length?[2,Promise.reject(48)]:((r={}).callStartOptions=M.getCallStartOptions(t),r.invitationType=h.CA_CONSTANTS.INVITATION_TYPE.NUDGE,r.participantsToNudge=e,r.callStartTime=i,this.setInitialTelemetry(m.CALL_OPERATIONS.START_CALL_WITH_NUDGE,r,"",n),[2,this.joinOrStartCall(r,this.startOutgoingCall,n)])})})},n.prototype.startAndUnpark=function(e,t,n,i){return void 0===n&&(n={}),void 0===i&&(i=y.generateCauseId()),l(this,void 0,void 0,function(){var r,o,a;return u(this,function(s){return this.setCallerMri(T.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),r=this.logger.createFnLogger(m.CALL_OPERATIONS.START_CALL_AND_UNPARK,i),o=Date.now(),this.setInitialTelemetry(m.CALL_OPERATIONS.START_CALL_AND_UNPARK,{callStartTime:o},"",i),r.info("startAndUnpark for context: "+e+", pickupCode :"+t),this.connectCallPromise=this._callOperationHandler.waitForOperation(m.CALL_OPERATIONS.START_CALL_AND_UNPARK),(a={}).callStartOptions=M.getCallStartOptions(n),a.parkContext=0===e?m.UNPARK_CODE.PARK:1===e?m.UNPARK_CODE.SHARED_LINE:m.UNPARK_CODE.SERVER_HOLD,a.pickupCode=t,this.addParticipant("4:"+a.parkContext).catch(function(e){return r.logFailure("Failed to add participant to unparked call")}),[2,this.joinOrStartCall(a,this.startOutgoingCall,i)]})})},n.prototype.admitParticipant=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var n,i;return u(this,function(r){return n=T.generateAliasedMri(e),(i=this.getParticipant(n))&&7===i.state?[2,this.admitParticipantToCall(i,t)]:[2,Promise.reject(43)]})})},n.prototype.admit=function(e,t){return this.signalingSession.admitAsync(t)},n.prototype.callMeBack=function(e,t,n){return void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var i;return u(this,function(r){return i=T.generateAliasedMri(""+T.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,this.currentUserSkypeIdentity.sipUri),[2,this.addCallMeBackParticipant(e,t||i,n)]})})},n.prototype.addParticipant=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(i){switch(i.label){case 0:return[4,this.addParticipantsImpl([e],t,n,"addParticipant")];case 1:return[2,i.sent()[0]]}})})},n.prototype.addParticipants=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(i){return[2,this.addParticipantsImpl(e,t,n,"addParticipants")]})})},n.prototype.addParticipantsImpl=function(e,t,n,i){return void 0===t&&(t={}),void 0===n&&(n=y.generateCauseId()),l(this,void 0,void 0,function(){var r,o,a,s,c=this;return u(this,function(d){if(this.logger.info("["+n+"]["+i+"] start"),this.isEmergency&&0===this.state&&(0!==this.participants.length||1!==e.length))return[2,Promise.reject(new Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"))];if(t.participantInvitationData)try{JSON.stringify(t.participantInvitationData)}catch(e){throw this.logger.info("["+n+"]["+i+"] "+e),e}return r=[],o=[],e.forEach(function(e){var t=c.getOrCreateParticipant(e,n);0===t.state||4===t.state?(o.push(t),r.push(c._participantOperationHandler.createPendingOperation(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id,n))):3===t.state?r.push(Promise.resolve(t)):c._participantOperationHandler.hasPendingOperationWithOperationId(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id)&&r.push(c._participantOperationHandler.waitForOperation(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id))}),0===o.length||(a=!!t.disableUnmute,s=this.addParticipantsToCall(o,n,t.participantInvitationData,t.threadId,t.messageId,a,t.alternateId),f.zip(s,o).forEach(function(e){var t=p(e,2),i=t[0],r=t[1];return l(c,void 0,void 0,function(){var e;return u(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i];case 1:return t.sent(),this._participantOperationHandler.maybeResolveOperation(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,r,r.id,n),[3,3];case 2:return e=t.sent(),this._participantOperationHandler.maybeRejectOperation(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e,r.id,n),[3,3];case 3:return[2]}})})}),this.raiseChanged()),[2,Promise.resolve(r)]})})},n.prototype.nudgeParticipants=function(e,t,n,i){return void 0===n&&(n={}),void 0===i&&(i=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(e){return 2!==this.state&&3!==this.state?[2,Promise.reject(48)]:[2,this.signalingSession.nudgeParticipantsAsync({participantsIds:t,causeId:i,invitationData:n.participantInvitationData,newThreadId:n.threadId,newMessageId:n.messageId})]})})},n.prototype.mapEndpointScope=function(e){var t="none";switch(e){case 0:t="specified";break;case 1:case 1:t="all";break;default:t="none"}return t},n.prototype.removeParticipant=function(e,t,n,i){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){var r,o,a=this;return u(this,function(s){return(r=this.logger.createFnLogger("removeParticipant",t)).info("start"),o=this.mapEndpointScope(i),[2,this.signalingSession.removeParticipantAsync({id:e,endpointId:n},t,o).catch(function(n){r.logFailure("Participant was not removed from call, error="+n);var i=a._handleParticipantOperationFailure(m.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,n,t,e).reason;return Promise.reject(i||38)})]})})},n.prototype.searchParticipants=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(n){return[2,this.signalingSession.searchParticipantsAsync(e.searchQueryOptions,t)]})})},n.prototype.getAllParticipants=function(e,t){return void 0===t&&(t=y.generateCauseId()),l(this,void 0,void 0,function(){return u(this,function(n){return[2,this.signalingSession.getAllParticipantsAsync(e.scope,t)]})})},Object.defineProperty(n.prototype,"dominantSpeakerInfo",{get:function(){return this.internalDominantSpeakerInfo||{speakerList:this.participants.filter(function(e){return 3===e.state}).map(function(e){return e.id}),timestamp:null}},set:function(e){this.internalDominantSpeakerInfo=e},enumerable:!0,configurable:!0}),n.prototype.startVideoSafe=function(e){var t=this;return this.startVideo(e).catch(function(n){t.logger.info(n,"startVideoSafe",e)})},n.prototype.joinOrStartCall=function(e,t,n,i){return l(this,void 0,void 0,function(){var r,o,a,s,c,l;return u(this,function(u){switch(u.label){case 0:return r=this.logger.createFnLogger("joinOrStartCall",n),0!==this.state&&8!==this.state?(r.logFailure("Trying to start a call that has already been acted on"),[2,Promise.reject(60)]):this.signalingAgent.resolvePotentialCallConflict(this.signalingSession)===this.signalingSession?[2,Promise.reject(57)]:(this.callStats.localStats.startCall(),o=!this._disableIsMultipartyDependenceOnThreadId&&!!this.threadId,a=8===this.state||1!==this.participants.length||o,r.info("isMultiparty="+a+", reason: threadId set = "+!!this.threadId+", participants.length="+this.participants.length+", disableIsMultipartyDependenceOnThreadId = "+!!this._disableIsMultipartyDependenceOnThreadId),this.setCallType(a?2:1,n),this.setCallUsesMixer(a,n),1==(1&(s=e.callStartOptions||{}).preheatFlags)?(this.setMuted(w.ParticipantMuteState.Muted,n),this.setSpeakerMuted(!0,n),this.setCallState(11,n)):(c=!!s&&(s.muted||1==(1&s.muteFlags)),this.setMuted(c?w.ParticipantMuteState.Muted:w.ParticipantMuteState.Unmuted,n),this.setCallState(2,n)),(l=this._callOperationHandler.createPendingOperation(m.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,"",n)).catch(H.noop),this.callSettings.useLwjForAllCalls?[4,this.joinOrStartLwj(e,t,e.callStartTime,l,n,i)]:[3,2]);case 1:return u.sent(),[3,4];case 2:return[4,this.joinOrStartWithMedia(e,t,e.callStartTime,l,n,i)];case 3:u.sent(),u.label=4;case 4:return[2,l]}})})},n.prototype.joinOrStartLwj=function(e,t,n,i,r,o){return l(this,void 0,void 0,function(){var a;return u(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),t(r,e,null,null,n,o),[4,i];case 1:return s.sent(),[3,3];case 2:return a=s.sent(),this.catchJoinOrStartCallError(a,r,this.logger.createFnLogger("joinOrStartLwj",r)),[3,3];case 3:return[2]}})})},n.prototype.joinOrStartWithMedia=function(e,t,n,i,r,o){return l(this,void 0,void 0,function(){var a,s,c,l,d,p,f,h,g,v,y,S=this;return u(this,function(u){switch(u.label){case 0:a=this.logger.createFnLogger("joinOrStartWithMedia",r),this.callStats.localStats.audio.start(),s=e.callStartOptions,c=s&&1&s.preheatFlags,l=R.default(a),e.callStartOptions&&e.callStartOptions.sendMediaModalities&&(this.mediaStateConfigurationHelper=new M.MediaStateConfigHelper(e.callStartOptions.sendMediaModalities)),u.label=1;case 1:return u.trys.push([1,18,,19]),!s||c?[3,3]:this.mediaStateConfigurationHelper.isInactiveOrDisabled(0)&&this.mediaStateConfigurationHelper.isSending(3)?(this.setCallUsesMixer(!0,r),[4,this.getScreenHandle().acquire()]):[3,3];case 2:u.sent(),u.label=3;case 3:return this.callUsesMixer||this.mediaStateConfigurationHelper.disableModality(3),a.info("skipSharingModality="+!this.callUsesMixer),l.executeSync(w.CallSetupMediaPhase.InitializeMediaSession,function(){return S.initializeMediaSession(r)}),this.mediaSession.createAudioElement(r),this.callUsesMixer||o||this.isOneToOnePSTNCall()||e.callVoicemailStartOptions||(this.isSomeoneStreamingVideo=!0),(d=this._callOperationHandler.createPendingOperation(m.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,"",r)).catch(H.noop),p=!1,s?c?(p=!0,[4,l.execute(w.CallSetupMediaPhase.MuteInput,function(){return S.mediaSession.muteInputAsync(r)})]):[3,6]:[3,8];case 4:return u.sent(),[4,l.execute(w.CallSetupMediaPhase.MuteOutput,function(){return S.mediaSession.muteOutputAsync(r)})];case 5:return u.sent(),this.setMuted(w.ParticipantMuteState.Muted,r),this.setCallUsesMixer(!0,r),[3,8];case 6:return this.mediaStateConfigurationHelper.isSending(1)?[4,l.execute(w.CallSetupMediaPhase.StartVideoSafe,function(){return S.startVideoSafe(r)})]:[3,8];case 7:u.sent(),u.label=8;case 8:return[4,l.execute(w.CallSetupMediaPhase.UpdateMediaModalities,function(){return S.updateMediaModalities(void 0,r)})];case 9:return f=u.sent(),[4,l.execute(w.CallSetupMediaPhase.CreateOffer,function(){return S.mediaSession.createOfferAsync(r)})];case 10:return h=u.sent(),g=l.executeSync(w.CallSetupSignalingPhase.GetSignalingMediaTypes,function(){return S.getSignalingMediaTypes(S.calculateModalityDirections({},r))}),this.mediaStateConfigurationHelper.isSending(3)&&this.updateScreenSharingState(f,r),p?[3,13]:[4,l.execute(w.CallSetupMediaPhase.MuteUnmute,function(){return S.muteUnmute(S._muteState===w.ParticipantMuteState.Muted,r)})];case 11:return u.sent(),[4,l.execute(w.CallSetupMediaPhase.MuteUnmuteSpeakers,function(){return S.muteUnmuteSpeaker(S.isSpeakerMuted,r)})];case 12:u.sent(),u.label=13;case 13:return l.executeSync(w.CallSetupSignalingPhase.CallStart,function(){return t(r,e,h,g,n,o)}),[4,l.execute(w.CallSetupSignalingPhase.WaitForAnswer,function(){return d})];case 14:return v=u.sent(),[4,l.execute(w.CallSetupMediaPhase.ProcessAnswer,function(){return S.mediaSession.processAnswerAsync(v,r,!1)})];case 15:return u.sent(),[4,l.execute(w.CallSetupSignalingPhase.WaitForConnect,function(){return i})];case 16:return u.sent(),[4,l.execute(w.CallSetupMediaPhase.CompleteNegotiation,function(){return S.completeNegotiationAsync(r)})];case 17:return u.sent(),this.callTelemetry.updateOperationData(m.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,{phases:l.getTelemetryData()},r),[3,19];case 18:return y=u.sent(),this.catchJoinOrStartCallError(y,r,a,l.getTelemetryData()),[3,19];case 19:return[2]}})})},n.prototype.catchJoinOrStartCallError=function(e,t,n,i){var r,o=this,a=0;if(n.logFailure(B.getPrintableObject(e)),R.isPhaseError(w.CallSetupMediaPhase.MuteInput,e))a=7,r={code:w.jsCallEndCodes.LocalError,subCode:w.jsCallEndSubCodes.MediaMuteMicrophoneError,phrase:B.getPrintableObject(e),causeId:t};else if(R.isPhaseError(w.CallSetupMediaPhase.MuteOutput,e))a=7,r={code:w.jsCallEndCodes.LocalError,subCode:w.jsCallEndSubCodes.MediaMuteSpeakerError,phrase:B.getPrintableObject(e),causeId:t};else if(e&&(e.type===this.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer||e.type===this.mediaAgent.constants.MEDIA_ERROR.permissionDeniedError||R.isOneOfPhaseErrors(w.CallSetupMediaPhase,e))){if(a=47,this.lwjFallbackInProgress)return void n.info("Ignoring media setup error because LWJ fallback is in progress")}else R.isPhaseError(w.CallSetupSignalingPhase.WaitForAnswer,e)||R.isPhaseError(w.CallSetupSignalingPhase.WaitForConnect,e)?a=e.error:R.isOneOfPhaseErrors(w.CallSetupSignalingPhase,e)&&(a=7);throw this.callTelemetry.updateOperationData(m.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,this.getTelemetryFromPhaseExecution(e),t),this.callSetupFailed=!0,n.logFailure(e),Promise.all([this._callOperationHandler.maybeRejectOperation(m.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,a,"",t),this._callOperationHandler.maybeRejectOperation(m.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,a,"",t)]).then(function(){return o.stopInternal({causeId:t,terminatedReason:a,rejectReason:r})}).catch(H.noop),a},n.prototype.reconnectAsLwj=function(e,t){return l(this,void 0,void 0,function(){var n,i,r,o,a,s,c;return u(this,function(l){switch(l.label){case 0:if((n=this.logger.createFnLogger("reconnectAsLwj",t)).info("Attempting to reconnect as LWJ, terminatedReason = "+e),6===this.state||7===this.state)return n.info("Not reconnecting as LWJ because call state is "+this.state),[2];i=Date.now(),this._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS.START_CALL),this._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS.JOIN_CALL),this.callTelemetry.maybeRecordOperationSuccess(m.CALL_OPERATIONS.START_CALL),this.callTelemetry.maybeRecordOperationSuccess(m.CALL_OPERATIONS.JOIN_CALL),r=Date.now()-this._mediaSessionCreationTime,this.callTelemetry.updateOperationData(m.CALL_OPERATIONS.LWJ_FALLBACK,{timeToBeginFallback:r},t),this.event("lwjFallbackStarted").raise(),this.lwjFallbackInProgress=!0,o=this.getRejectionInfoFromTerminatedReason(e),this.cleanUpMedia(t,o),l.label=1;case 1:return l.trys.push([1,5,,6]),[4,this.signalingSession.endAsync(o,{preventAllCallbacks:!0,causeId:t})];case 2:return l.sent(),this.signalingSession=null,this.mediaRelayWhiteListingIssue=!1,this.initializeSignalingSession(this._participantId),this.signalingSession.setThreadId(this.threadId),this.signalingSession.setCallOptions(this.signalingSessionCallOptions),[4,this.signalingSession.ensureMessageChannelReady(t)];case 3:return l.sent(),a={suppressDialout:!0,onBehalfOf:this.onBehalfOfMri,isLwj:!0},s={},this.setInitialTelemetry(m.CALL_OPERATIONS.START_CALL,{callStartTime:i,callStartOptions:s},"",t),[4,this.signalingSession.startOutgoingCall(null,null,a,null,t)];case 4:return l.sent(),[3,6];case 5:return c=l.sent(),n.logFailure(c),this.stopInternal({causeId:t}),[3,6];case 6:return[2]}})})},n.prototype.addCallMeBackParticipant=function(e,t,n){var i=this,r=this._participantOperationHandler.waitForOperation(m.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e),a=this.logger.createFnLogger(m.PARTICIPANT_OPERATIONS.CALL_ME_BACK,n),s={id:e,assertedId:t};return this.signalingSession.callMeBackAsync(s).then(function(){a.logSuccess("successfully executed call me back, participantId = "+O.scrubMriOrOmit(e)),i._participantOperationHandler.resolveOperation(m.PARTICIPANT_OPERATIONS.CALL_ME_BACK,0,e)}).catch(function(r){a.logFailure("Call me back failed, participantId = "+O.scrubMriOrOmit(e)+", error = "+r),i._handleParticipantOperationFailure(m.PARTICIPANT_OPERATIONS.CALL_ME_BACK,r,n,t,!1);var s=i._processError(r),c={};s&&(c=o({},s)),c.failureReason=s.reason?s.reason:11,i._participantOperationHandler.rejectOperation(m.PARTICIPANT_OPERATIONS.CALL_ME_BACK,c,e)}),r},n.prototype.addParticipantsToCall=function(e,t,n,i,r,o,a){var s=this,c=this.logger.createFnLogger("addParticipantsToCall",t);e.forEach(function(e){e.setState(1,void 0,t)});var d=e.map(function(e){return{id:e.mri}});c.info("participantIds="+e.map(function(e){return O.scrubMriOrOmit(e.id)})+", disableUnmute="+o);var h={additionalData:n,threadId:i,messageId:r,disableUnmute:o,alternateId:a};try{var g=this.signalingSession.addParticipantsAsync(d,h,t);return f.zip(g,d).map(function(e){var n=p(e,2),i=n[0],r=n[1];return l(s,void 0,void 0,function(){var e,n,o,a;return u(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,i];case 1:return e=s.sent(),this.signalingNotifications.onParticipantJoined(e,t),this.callTelemetry.recordOperationSuccess(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,null,e.id,t),[3,3];case 2:throw n=s.sent(),o=this._handleParticipantOperationFailure(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n,t,r.id),a=o.reason,this._removeParticipant(r,t,a),a;case 3:return[2]}})})})}catch(e){return c.logFailure("Participants was not added to call, error="+e),f.range(d.length).map(function(){return Promise.reject(1)})}},n.prototype.mergeCallByAddParticipantWithReplaces=function(e,t,n,i,r,o){return l(this,void 0,void 0,function(){var a,s,c,l,d,p,f,h,g,v,y=this;return u(this,function(u){switch(u.label){case 0:return a=this.logger.createFnLogger("mergeCallByAddParticipantWithReplaces",o),s={additionalData:e.additionalData,threadId:e.threadId,messageId:e.messageId,callIdToReplace:n.callId,replacementType:i},[4,this.signalingSession.addParticipantsAsync(t,s,o)];case 1:c=u.sent(),l=[],t.forEach(function(e){l.push(y._callOperationHandler.createPendingOperation(r,e.id,o))}),d=0,u.label=2;case 2:if(!(d<c.length))return[3,7];u.label=3;case 3:return u.trys.push([3,5,,6]),[4,c[d]];case 4:return p=u.sent(),a.logSuccess(" [participantInfos id ="+O.scrubMriOrOmit(t[d].id)+"]"),this.signalingNotifications.onParticipantJoined(p,o),this.callTelemetry.recordOperationSuccess(r,null,null,o),v={code:m.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:m.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE},this._callOperationHandler.maybeResolveOperation(r,v,t[d].id,o),[3,6];case 5:return f=u.sent(),a.logFailure("Participant was not added to call, error="+B.safeJsonStringify(f)),h=this._handleParticipantOperationFailure(r,f,o,null),g=h.reason,this._removeParticipant(t[d],o,g),v=f?f.endCode:g||0,this._callOperationHandler.maybeRejectOperation(r,v,t[d].id,o),[3,6];case 6:return d++,[3,2];case 7:return[2,Promise.resolve(l)]}})})},n.prototype.admitParticipantToCall=function(e,t){var n=this,i=this.logger.createFnLogger("admitParticipantToCall",t),r={id:e.mri};return i.info("start"),this.signalingSession.admitParticipantAsync(r).then(function(){i.info("successfully admitted participant to call, participantId = "+O.scrubMriOrOmit(e.id))}).catch(function(r){i.logFailure("Participant was not admitted to call, error="+r);var o=n._handleParticipantOperationFailure(m.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,r,t,e.mri),a=o.reason;return n._admitRejectionAsTransactionEnd?Promise.reject(o):Promise.reject(a||38)})},n.prototype._processError=function(e){var t,i={reason:t};if(e&&e.endCode){var r=M.getTerminationCode(e.endCode.code,e.endCode.subCode);t=n.getParticipantReasonFromTerminatedReason(r),i.reason=t,i.code=e.endCode.code,i.subCode=e.endCode.subCode,i.resultCategories=e.endCode.resultCategories,i.phrase=e.endCode.phrase}else i.phrase=""+e;return this.logger.info("_processError error="+e+" telemetryData="+JSON.stringify(i)),i},n.prototype._handleParticipantOperationFailure=function(e,t,n,i,r){void 0===r&&(r=!0),this.callTelemetry.updateOperationData(e,{error:B.getPIISafeObject(t)},n,i);var o=this._processError(t);if(o.code){var a=this.getParticipant(i);a&&(a.callEndDiagnosticsInfo={callControllerCode:o.code,callControllerSubCode:o.subCode,resultCategories:o.resultCategories})}try{r&&this.callTelemetry.recordOperationFailure(e,o,i,n)}catch(e){this.logger.info("_handleParticipantOperationFailure errow during recordOperationFailure "+e)}return o},n.prototype.isOneToOnePSTNCall=function(){var e=this.signalingSession.isIncomingCall?this.callerMri:this.participants.length>0?this.participants[0].id:"";return this.isOneToOneCall()&&f.startsWith(e,T.PSTN_MRI_PREFIX)&&(!this.incomingCallType||!this.callUsesMixer)},n.prototype.updateMediaModalities=function(e,t){return void 0===e&&(e={}),l(this,void 0,void 0,function(){var n,i;return u(this,function(r){switch(r.label){case 0:return(i=this.logger.createFnLogger("updateMediaModalities",t)).info("callUsesMixer="+this.callUsesMixer+",isSomeoneSharing="+this.isSomeoneSharing+",isSomeoneStreamingVideo="+this.isSomeoneStreamingVideo),i.info("options="+B.safeJsonStringify(e)+",requestHoldState="+this.requestedHoldState+",requestedScreenSharingState="+this.mediaStateConfigurationHelper.isSending(3)),n=e.modalityOverride?e.modalityOverride:this.requestedHoldState&&!this.isMuteOnHold?this.getMediaModalitiesForHold(t):this.calculateModalityDirections(e&&e.offered,t),i.info("modalities="+B.safeJsonStringify(n)),[4,this.mediaSession.configureModalitiesAsync(n,t)];case 1:return r.sent(),[2,n]}})})},n.prototype.calculateModalityDirections=function(e,t){void 0===e&&(e={});var n=this.logger.createFnLogger("calculateModalityDirections",t);n.info("callUsesMixer="+this.callUsesMixer);var i={audio:this.calculateAudioDirection(e.audio,n),video:this.calculateVideoDirection(e.video,n),sharing:this.calculateSharingDirection(e.sharing,n),data:this.calculateDataDirection(e.data,n)};return n.info("done, modalities="+B.safeJsonStringify(i)),this.deleteExtraneousModalities(i,t),i},n.prototype.calculateAudioDirection=function(e,t){return t.info("calculateAudioDirection, offer="+e+", requestedAudioState="+this.mediaStateConfigurationHelper.isSending(0)),this.mediaStateConfigurationHelper.isInactiveOrDisabled(0)||"inactive"===e?"inactive":this.mediaSession.getAllowedModalities().audio.some(function(e){return e===V.streamDirections.send||e===V.streamDirections.sendReceive})?"sendrecv":"recvonly"},n.prototype.calculateVideoDirection=function(e,t){var n=this.mediaStateConfigurationHelper.isSending(1);if(t.info("calculateVideoDirection, offer="+e+", requestedVideoState="+n+", isSomeoneStreamingVideo="+this.isSomeoneStreamingVideo),this.mediaStateConfigurationHelper.isInactiveOrDisabled(0))return"inactive";var i=n,r=this.isSomeoneStreamingVideo||this.callUsesMixer;return e&&(i=i&&("sendrecv"===e||"sendonly"===e),r=r&&("sendrecv"===e||"recvonly"===e)),i?"sendrecv":r?"recvonly":"inactive"},n.prototype.calculateSharingDirection=function(e,t){return t.info("calculateSharingDirection, offer="+e+", requestedScreenSharingState="+this.mediaStateConfigurationHelper.isSending(3)+", isSomeoneSharing="+this.isSomeoneSharing),"inactive"===e?"inactive":this.mediaStateConfigurationHelper.isSending(3)?"sendonly":this.isSomeoneSharing||this.callUsesMixer?"recvonly":void 0},n.prototype.calculateDataDirection=function(e,t){var n=this.mediaStateConfigurationHelper.isSending(4);if(t.info("calculateDataDirection, offer="+e+", requestedDataState="+n),n)return"sendrecv"},n.prototype.getMediaModalitiesForHold=function(e){this.logger.info("["+e+"][getMediaModalitiesForHold]");var t={audio:"inactive",video:"inactive",sharing:"inactive"};return this.deleteExtraneousModalities(t,e),t},n.prototype.deleteExtraneousModalities=function(e,t){!j.hasSendDirectionality(e.video)&&this.mediaStateConfigurationHelper.isDisabled(1)&&(this.logger.info("["+t+"][deleteExtraneousModalities] skipping videoModality"),delete e.video),!j.hasSendDirectionality(e.sharing)&&this.mediaStateConfigurationHelper.isDisabled(3)&&(this.logger.info("["+t+"][deleteExtraneousModalities] skipping sharingModality"),delete e.sharing)},n.prototype.getSignalingMediaTypes=function(e){var t,n=[];return e.audio&&e.audio!==this.mediaAgent.constants.MEDIA_STATE.inactive&&n.push("Audio"),((t=e.video)===this.mediaAgent.constants.MEDIA_STATE.send||t===this.mediaAgent.constants.MEDIA_STATE.sendReceive)&&n.push("Video"),e.sharing===this.mediaAgent.constants.MEDIA_STATE.send?n.push("ScreenSharer"):e.sharing===this.mediaAgent.constants.MEDIA_STATE.receive&&n.push("ScreenViewer"),n},n.prototype.initializeSignalingSession=function(e){var t=this;if(this.signalingSession)this.logger.info("Session already exists!");else{var i=h.CA_CONSTANTS.CALL_STATUS;if(this.localSignalingParticipant={id:T.generateAliasedMri(""+T.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,this.currentUserSkypeIdentity.sipUri),displayName:this.currentUserSkypeIdentity.displayName,endpointDetails:[],languageId:null,participantId:e,endpointId:null},this.accountConfiguration&&(this.localSignalingParticipant.applicationType=this.accountConfiguration.applicationType,this.callTelemetry.setApplicationType(this.accountConfiguration.applicationType),this.localSignalingParticipant.ring=this.accountConfiguration.ring,this.callTelemetry.setRing(this.accountConfiguration.ring),this.localSignalingParticipant.region=this.accountConfiguration.region,this.callTelemetry.setRegion(this.accountConfiguration.region),this.localSignalingParticipant.partition=this.accountConfiguration.partition,this.callTelemetry.setPartition(this.accountConfiguration.partition),this.localSignalingParticipant.acsResourceId=this.accountConfiguration.acsResourceId,this.callTelemetry.setAcsResourceId(this.accountConfiguration.acsResourceId),this.accountConfiguration.serviceUrls)){var r=this.accountConfiguration.serviceUrls.calling_conversationServiceUrl,a=this.accountConfiguration.serviceUrls.calling_uploadLogRequestUrl;this.signalingAgent.updateUrls(r,a,this.accountConfiguration.enforceUrls)}this.callStats.localStats.setLocalUserId(this.localSignalingParticipant.id),this._callOperationHandler&&this._callOperationHandler.resetOperationChain(),this.signalingNotifications={onCallStatusChanged:function(e,n,r){void 0===r&&(r=y.generateCauseId());var a=t.logger.createFnLogger("onCallStatusChanged",r),s="[status="+e+"]";if(n&&(s+="[reason="+B.safeJsonStringify(n)+"]",void 0!==n.code&&(t.callEndDiagnosticsInfo={callControllerCode:n.code,callControllerSubCode:n.subCode,resultCategories:n.resultCategories},(n.overflowJoinInformation||n.registrationInformation)&&(t.callEndDiagnosticsInfo.additionalDiagnostics={overflowInformation:n.overflowJoinInformation,registrationInformation:n.registrationInformation}))),a.info(s),t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.SIGNALING_STATE_CHANGED,{status:e,reason:n},r),e===i.CONNECTING)t._transferredCallAcceptanceCallback&&(a.info("[Transfer] Invoke call acceptance callback for original call"),t._transferredCallAcceptanceCallback()),t._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,r);else if(e===i.RINGING)2===t.audioStreamState?(t.setCallState(9,r),t.participants.forEach(function(e){return e.setState(6,void 0,r)})):t.participants.forEach(function(e){return e.setState(2,void 0,r)}),t._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,r);else if(e===i.CONNECTED_FOR_ROSTER_ONLY)t._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,r),t._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,void 0,void 0,r);else if(e===i.CONNECTED){t._callIsSetupComplete=!0;var c=f.find(t.localSignalingParticipant.endpointDetails,function(e){return t._endpointId===e.endpointId});if(c&&c.isLobby&&(t._callInLobby=!0,t.updateCapabilities(r,!0)),3===t.state)return;11===t.state?t.setCallState(12,r):t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.JOIN_PREHEATED_CALL)?a.info("wait for joinPreheatedCall to resolved"):t._callInLobby?(a.info("[inLobby] Override Connected state from signaling agent"),t.setCallState(10,r)):(t.setCallState(3,r),t.handleRemoteParticipantStateInOneToOneCall(r)),t._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,r),t._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,r),t.reportTsCallingTelemetry(!0)}else if(e===i.LOCAL_TERMINATED||e===i.REMOTE_TERMINATED){var l=t.callSetupFailed?7:M.convertReason(n);if(8===t.state&&(t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.START_CALL)||t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.JOIN_CALL)||t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.START_WITH_MEETING_DATA)||t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA)))return t.signalingSession.resetState(),t._callOperationHandler.maybeRejectOperation(m.CALL_OPERATIONS.SUBSCRIBE,l,void 0,r),t._callOperationHandler.maybeRejectOperation(m.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,l,void 0,r),void a.info("Subscribe failed, there is pending start/join operation, ignore call end message");if(t.signalingSession.acceptedElsewhereBy&&(t.acceptedElsewhereBy={id:t.signalingSession.acceptedElsewhereBy.id,displayName:t.signalingSession.acceptedElsewhereBy.displayName}),1!==l&&(t.mediaRelayWhiteListingIssue&&(l=53),a.info("[terminated][reason="+B.safeJsonStringify(n)+"]")),t.lwjFallbackInProgress&&t.callTelemetry.recordOperationFailure(m.CALL_OPERATIONS.LWJ_FALLBACK,l),t._callOperationHandler.maybeRejectOperation(m.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,l,"",r),t._callOperationHandler.maybeRejectOperation(m.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,l,"",r),t.setCallState(7,r,l),t.participants.forEach(function(e){return e.setState(4,void 0,r)}),!t.disconnectingPromise){var u=o({},n,{remoteTerminated:e===i.REMOTE_TERMINATED});t.disconnectingPromise=t.cleanUp(r,u).catch(function(e){a.logFailure("Error when cleaning up the call, callId = "+t.callId+", error = "+e)})}}},onOffer:function(e,n){void 0===n&&(n=y.generateCauseId());var i=t.logger.createFnLogger("onOffer",n);i.info(""+B.safeJsonStringify(f.omit(e,"mediaContent","remoteParticipantId"))),t.setMediaLegId(e.mediaContent.mediaLegId),t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.WEB_ON_OFFER,t.prepareTelemetryForOfferAnswer(e),n),e.transferor&&e.transferor.details&&e.transferor.details.id&&t.setTransferorMri(e.transferor.details.id),e.transferor&&e.transferor.transferorType&&(t.transferorType=e.transferor.transferorType),e.transferor&&e.transferor.details&&e.transferor.details.displayName&&(t.transferorDisplayName=e.transferor.details.displayName),t.invitationData=e.invitationData,t.spamRiskLevel=e.riskLevel,e.mediaContent.isTwoPartyToMultiPartyEscalation&&t.setIsEscalationInProgress(!0,n),e.renegotiation?t.requestedHoldState&&t._pendingParkPromise?t.renegotiateIncoming(e.mediaContent,n):t._callOperationHandler.executeChained(function(){return t.renegotiateIncoming(e.mediaContent,n)},m.CALL_OPERATIONS_INTERNAL.RENEGOTIATE_INCOMING,n,n).catch(H.noop):(i.info("resolving attach / offer promise"),t.attachToCallAndGetOffer.resolve(e.mediaContent))},onNewOffer:function(e,n){void 0===n&&(n=y.generateCauseId());var i=t.logger.createFnLogger("onNewOffer",n);t.newOfferRequestDeferred?(i.info("onNewOffer"),t.newOfferRequestDeferred.resolve(e.mediaContent)):i.info("callback received but new offer was not requested")},onAnswer:function(e,n){void 0===n&&(n=y.generateCauseId());var i=t.logger.createFnLogger("onAnswer",n);i.info(""+B.safeJsonStringify(f.omit(e,"mediaContent","remoteParticipantId"))),t.setMediaLegId(e.mediaContent.mediaLegId),t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.WEB_ON_ANSWER,t.prepareTelemetryForOfferAnswer(e),n),e.renegotiation?(i.info("resolving previous renegotiation promise"),t.renegotiationAnswerDeferred.resolve(e.mediaContent)):(i.info("resolving final answer promise"),e.provisional?t.mediaSession.processAnswerAsync(e.mediaContent,n,!0,e.remoteEndpointId):(t._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,e.mediaContent,void 0,n),t.handleRemoteParticipantStateInOneToOneCall(n))),e.provisional||!e.mediaContent.fromMixer||t.callUsesMixer||t._callOperationHandler.executeChained(function(){return t.setCallUsesMixer(!0,n),t.mediaSession.reconnectAsync(n,!0)},m.CALL_OPERATIONS_INTERNAL.CALL_ESCALATED_TO_CONFERENCE,n,n)},onMediaAcknowledgementSuccess:function(e,n){void 0===n&&(n=y.generateCauseId()),t.logger.info("isRenegotiation: "+e,"onMediaAcknowledgementSuccess",n),t._callOperationHandler.resolveOperation(m.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,void 0,void 0,n)},onMediaAcknowledgementFailure:function(e,n,i){void 0===i&&(i=y.generateCauseId()),t.logger.createFnLogger("onMediaAcknowledgementFailure",i).logFailure(B.safeJsonStringify(n)),t._callOperationHandler.rejectOperation(m.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,n,i)},onMediaRenegotiationRejection:function(e,n){void 0===n&&(n=y.generateCauseId()),t.logger.createFnLogger("onMediaRenegotiationRejection",n).logFailure(B.safeJsonStringify(e)),t.renegotiationAnswerDeferred.reject(e)},onRosterHandlingComplete:function(){t.logger.info("[onRosterHandlingComplete] "+t._publishedStatesModified),t._publishedStatesModified!==J.None&&(t.processPublishedStates(),t._publishedStatesModified=J.None)},onSelfParticipantUpdated:function(e,n){void 0===n&&(n=y.generateCauseId()),t.logger.info("["+n+"][onSelfParticipantUpdated]"),t.updateLocalParticipant(e,n),t.raiseChanged()},onParticipantMriUpdated:function(e,n,i){void 0===i&&(i=y.generateCauseId()),t.logger.info("["+i+"][onParticipantMriUpdated]");var r=t.getParticipant(e);r&&(r.id=n,t.raiseChangedDeferred())},onParticipantUpdated:function(e,i){void 0===i&&(i=y.generateCauseId()),t.logger.info("["+i+"][onParticipantUpdated]: "+k.scrubSignalingParticipant(e));var r=t.getOrCreateParticipant(e.id,i);r.displayName=e.displayName;var o=n.getStreamsFromEndpoints(e.endpointDetails);t.callUsesMixer||o.length>0?(r.updateStreams(o,i),t.updateCallParticipantFromSignalingParticipant(r,e,i)):r.setState(3,void 0,i),r.processParticipantDetails(e),t.updatePublishedStates(e),t.updateMediaStatus(i),t.raiseChangedDeferred()},onParticipantRemoved:function(e,n){void 0===n&&(n=y.generateCauseId()),t.logger.info("["+n+"][onParticipantRemoved]"),t.callTelemetry.recordOperationSuccess(m.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,null,e.id,n),t._participantOperationHandler.maybeRejectOperation(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,1,e.id,n),t._removeParticipant(e,n),t.removePublishedStatesByParticipant(e.id),t.updateMediaStatus(n)},onParticipantJoined:function(e,i){void 0===i&&(i=y.generateCauseId()),t.logger.info("["+i+"][onParticipantJoined]");var r=t.getOrCreateParticipant(e.id,i);r.displayName=e.displayName,0===r.state&&r.setState(1,void 0,i);var o=e.endpointDetails&&[e.endpointDetails[0]],a=n.getStreamsFromEndpoints(o);t.callUsesMixer||a.length>0?(r.updateStreams(a,i),t.updateCallParticipantFromSignalingParticipant(r,e,i),t.updateMediaStatus(i)):(t.handleRemoteParticipantJoinedInOneToOneCall(e,i),t.handleRemoteParticipantStateInObservingCall(r,e,i),e.acceptedBy&&e.acceptedBy!==e.id&&(r.acceptedBy=e.acceptedBy)),t.callTelemetry.recordOperationSuccess(m.PARTICIPANT_OPERATIONS_INTERNAL.PARTICIPANT_JOINED,v.getEndpointInformationForTelemetry(e.endpointDetails),r.id,i),r.processParticipantDetails(e),t.updatePublishedStates(e),t.raiseChangedDeferred()},getRemoteParticipantCollection:function(){return t.participants.map(function(e){return e.toCafeParticipant()})},onReTargetCompletedSuccess:function(e){var n=t.logger.createFnLogger("onReTargetCompletedSuccess",e);n.info("started, isEscalationInProgress="+t.isEscalationInProgress),t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.WEB_ON_RETARGET_SUCCESS,void 0,e),t.callStats.localStats.call.event(N.CallEvent.MediaRetargetSucceeded);var i=t.isEscalationInProgress;t.mediaSession.completeEscalationAsync(e).then(function(){n.logSuccess("completeEscalationAsync"),t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.WEB_ON_ESCALATION_SUCCESS,void 0,e),t.handleCallEscalation(i,e)}).catch(function(i){n.logFailure("completeEscalationAsync, error="+B.getPrintableObject(i)),t.setIsEscalationInProgress(!1,e),t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.WEB_ON_ESCALATION_FAILURE,B.getPIISafeObject(i),e),t.stopInternal({causeId:e,terminatedReason:47})})},onReTargetCompletedFailure:function(e,n){t.logger.createFnLogger("onReTargetCompletedFailure",n).logFailure("reason="+B.getPrintableObject(e)+", isEscalationInProgress="+t.isEscalationInProgress),t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.WEB_ON_RETARGET_FAILURE,B.getPIISafeObject(e),n),t.isEscalationInProgress&&(t.setIsEscalationInProgress(!1,n),t.setCallUsesMixer(!1,n)),t.callStats.localStats.call.event(N.CallEvent.MediaRetargetFailed),t.mediaSession.rejectEscalationAsync(e,n)},onChatModalitySetupFailed:function(e){t.logger.debug("onChatModalitySetupFailed: "+e)},onConversationUpdated:function(e,n){t.logger.info("onConversationUpdated["+n+"]: "+B.safeJsonStringify(e)),t.setConversationType(e.conversationType,n),t.setMessageId(e.teamsMessageId,n),t.setThreadId(e.threadId,n),t.setCallType(e.isMultiParty?2:1,n),t._commandUrlPresence=e.commandUrlPresence,t.updateCapabilities(n),t.region=e.region,t.meetingData=e.meetingData,t.meetingInfo=e.meetingInfo,t.raiseChanged()},onMeetingDetailsUpdated:function(e){t.meetingDetails=e,t.raiseChanged()},onParticipantCountsUpdated:function(e){f.isEqual(e,t.participantCounts)||(t.participantCounts=o({},m.EMPTY_COUNTS,e),t.event("participantCountsUpdated").raise(t.participantCounts))},onBroadcastDetailsUpdated:function(e){e&&(t.broadcastMeeting&&t.broadcastMeeting.metadataChanged(JSON.stringify(e)),t.broadcastMetadata=e,t.raiseChanged())},onTransferRequested:function(e,n){var i=t.logger.createFnLogger("onTransferRequested",n);i.info("Transfer: onTransferRequested, target participant",k.scrubSignalingParticipant(e.target));var r="",o="",a=0;"voicemail"===e.target.endpointType&&(a=2);try{r=e.target.id,o=e.transferor.details.id,e&&e.parkType&&"none"!==e.parkType&&(a=1)}catch(e){return i.logFailure(e),t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.ON_TRANSFER_REQUESTED_INVALID),void t.signalingSession.signalTransferCompletedAsync({code:M.getCSAEndCode(7)})}var s=t.convertToTransferType(a,e.parkType),c={transferContext:{transferorMri:o,targetMri:r,transferType:a,context:{target:e.target,transferor:e.transferor,newCallModalities:e.newCallModalities,links:e.links,replacementDetails:e.replacementDetails,isConsultative:e.isConsultative,callAcceptanceCallback:function(){i.logSuccess("Transfer: callAcceptanceCallback called"),t.signalingSession.signalTransferAcceptedAsync(s)}}},onCompleted:function(e){i.logSuccess("Transfer: onCompleted called"),t.signalingSession.signalTransferCompletedAsync({code:M.getCSAEndCode(e)})}};t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.ON_TRANSFER_REQUESTED,{transferType:a}),t.event("transferRequested").raise(c)},onTransferAccepted:function(e){t.logger.info("Transfer: onTransferAccepted"),t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&t._setTransferState(2),t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.BLIND_TRANSFER)&&t._callOperationHandler.maybeResolveOperation(m.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,void 0,e),t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.PARK_CALL)&&t._setParkState(2)},onTransferCompleted:function(e,n){var i=t.logger.createFnLogger("onTransferCompleted",n);i.info("Transfer: onTransferCompleted");var r=e.transferCompletion,o=M.convertReason(r);if(r&&(i.info("Transfer: Call Transfer Code: "+r.code),0===r.code)){if(t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(t._callOperationHandler.resolveOperation(m.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,void 0,n),t._setTransferState(3)),t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE)){var a={code:m.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:m.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE};t._callOperationHandler.resolveOperation(m.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,a,void 0,n),t._setTransferState(3)}t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.PARK_CALL)&&(e.unparkContent&&e.unparkContent.CallParkAdditionalContext&&e.unparkContent.CallParkAdditionalContext.ConversationControllerLocation&&(t.serverHoldLocation=e.unparkContent.CallParkAdditionalContext.ConversationControllerLocation),e.unparkContent&&void 0!==e.unparkContent.pickupCode?(t._callOperationHandler.resolveOperation(m.CALL_OPERATIONS.PARK_CALL,e.unparkContent.pickupCode,void 0,n),i.logSuccess("pickupCode="+e.unparkContent.pickupCode),t._setParkState(3)):(t._callOperationHandler.rejectOperation(m.CALL_OPERATIONS.PARK_CALL,32,n),i.logFailure("terminatedReason="+o),t._setParkState(4)))}else{if(t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(t._callOperationHandler.rejectOperation(m.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,o,void 0,n),i.logFailure("terminatedReason="+o),t.transferDiagnosticsInfo={callControllerCode:r.code,callControllerSubCode:r.subCode,resultCategories:r.resultCategories},t._setTransferState(4)),t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE)){var s={code:r.code,subCode:r.subCode,resultCategories:r.resultCategories};t._callOperationHandler.rejectOperation(m.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,s,void 0,n)}t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.PARK_CALL)&&(t._callOperationHandler.rejectOperation(m.CALL_OPERATIONS.PARK_CALL,o,void 0,n),i.logFailure("terminatedReason="+o),t.transferDiagnosticsInfo={callControllerCode:r.code,callControllerSubCode:r.subCode,resultCategories:r.resultCategories},t._setParkState(4))}},onParkCompleted:function(e,n){t.logger.createFnLogger("onParkCompleted",n).info("transactionEnd "+B.getPrintableObject(e)),t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.PARK_CALL)&&(0===e.code?(t._callOperationHandler.resolveOperation(m.CALL_OPERATIONS.PARK_CALL,"",void 0,n),t._setParkState(3)):(t._callOperationHandler.rejectOperation(m.CALL_OPERATIONS.PARK_CALL,e,n),t._setParkState(4)))},onUnparkCompleted:function(e,n){t.logger.createFnLogger("onUnparkCompleted",n).info("transactionEnd "+B.getPrintableObject(e)),t._callOperationHandler.hasPendingOperation(m.CALL_OPERATIONS.UNPARK_CALL)&&(0===e.code?t._callOperationHandler.resolveOperation(m.CALL_OPERATIONS.UNPARK_CALL,e,void 0,n):t._callOperationHandler.rejectOperation(m.CALL_OPERATIONS.UNPARK_CALL,e,n))},onIncomingCallReplacement:function(e,n){var i=t.logger.createFnLogger("onIncomingCallReplacement",n);t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.ON_INCOMING_CALL_REPLACEMENT,{},n),e.callNotification.callType="replaces",e.callNotification.consultativeCallId=t.callId,i.info("consultativeCallId="+t.callId),e.body={gp:e,evt:w.incomingCallEvents.INCOMING_SKYPE_NGC_CALL,nsp:void 0},t.event("replacementRequested").raise(e)},onLwjUpdated:function(e,n){var i,r;t.logger.info("["+n+"][onLwjUpdated]"),t.lwjUris=e,t.streamManager.useLightweightStreams(t.lwjUris&&t.lwjUris.frameUris,n);try{for(var o=d(t.participants),a=o.next();!a.done;a=o.next())a.value.useLightweightStreams(t.lwjUris&&t.lwjUris.frameUris,n)}catch(e){i={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}},onContentSharingStopped:function(e){var n,i;t.logger.debug("ScreenSharing: onContentSharingStopped");try{for(var r=d(t.contentSharingSessions),o=r.next();!o.done;o=r.next()){var a=o.value;a.contentSharingGuid===e.correlationId&&(a.contentSharingStatus=7)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}},onContentSharingStarted:function(e){t.logger.debug("ScreenSharing: onContentSharingStarted");var n=new U.default(t.callTelemetry,t.logger.createChild("ContentSharingSession"),t.signalingSession,e.correlationId||E.default(),e.contentIdentifier,e.sessionState,e.subject,e.sessionId);n.contentSharingStatus=2,t.contentSharingSessions.push(n),n.changed(function(){return t.removeContentSessionIfEnded(n)}),t.event("contentSharingChanged").raise()},onContentSharingUpdated:function(e){t.logger.debug("ScreenSharing: onContentSharingUpdated");var n=f.find(t.contentSharingSessions,function(t){return t.contentSharingGuid===e.correlationId});n?(e.presenter&&(n.presenterId=e.presenter),e.subject&&n.subject!==e.subject&&(n.subject=e.subject),e.sessionState&&n.contentSharingState!==e.sessionState&&(n.contentSharingState=e.sessionState),3===n.contentSharingStatus&&t.localSignalingParticipant.id!==e.presenter?n.contentSharingStatus=5:5===n.contentSharingStatus&&t.localSignalingParticipant.id===e.presenter&&(n.contentSharingStatus=3)):t.logger.warn("onContentSharingUpdated: session not found")},onWebRtcMediaNotification:function(e,n){var i=t.mediaSession&&t.mediaSession.getExtensionsManager?t.mediaSession.getExtensionsManager():null;i&&i.processNotification(e,n)},onCorrelationIdUpdated:function(e,n){return t.checkForCallIdUpdate(e,n)},onUnmuteRequested:function(e){},onCallForwarded:function(e){e&&e.destinationType!==t.forwardingDestinationType&&(t.forwardingDestinationType=e.destinationType,t.raiseChanged())},onPSTNBalanceUpdate:function(e){},isOneToOnePstnCall:function(){return t.isOneToOnePSTNCall()}};var s=Object.create(this.localSignalingParticipant);this.signalingSession=this.signalingAgent.getNewSignalingSession(s,this.signalingNotifications,this.callId,this._callCreationTime),this.accountConfiguration&&this.accountConfiguration.deviceType&&this.signalingSession.setDeviceType(this.accountConfiguration.deviceType),this.setCallId(this.callId||this.signalingSession.correlationId),this.signalingSession.participantManager&&this.signalingSession.participantManager.localParticipant&&(this.setEndpointId(this.signalingSession.participantManager.localParticipant.endpointId),this.setParticipantId(this.signalingSession.participantManager.localParticipant.participantId),this.callStats.setParticipantId(this.participantId))}},n.prototype.convertToTransferType=function(e,t){var n="none";return 1===e&&t&&"none"!==t?"teamPark"===t?n="TransferTypeTeamPark":"sharedLinePark"===t?n="TransferTypeSharedLinePark":"serverHold"===t&&(n="TransferTypeServerHold"):0===e?n="TransferTypeStandard":2===e?n="TransferTypeVoicemail":this.logger.info("Irrelevant combination of transferTye: "+e+" and parkType: "+t),n},n.prototype.initializeImageRenderingSession=function(e){var t=this;e&&(this.imageRenderingSession={imageRendererProvider:e,callParams:{callId:this.callId,imageRenderingEventCallbacks:{onImageRenderingQualityChanged:function(e){t.event("callQualityChanged").raise(e)}}}})},n.prototype.raiseChangedDeferred=function(){var e=this;this.raiseChangedDefer||(this.raiseChangedDefer=f.defer(function(){delete e.raiseChangedDefer,e.raiseChanged()}))},n.getStreamsFromEndpoints=function(e){return e?(e.forEach(function(e){return f.forEach(e.mediaStreams,function(t){t.participantId=e.participantId,t.endpointId=e.endpointId})}),f.flatMap(e,function(e){return e&&e.mediaStreams||[]})):[]},n.prototype.initializeMediaSession=function(e){var t=this;if(!this.mediaSession){var i={onSessionErrorOccurred:function(e,n){void 0===n&&(n=y.generateCauseId()),t.logger.error("["+n+"][onSessionErrorOccurred]: "+B.safeJsonStringify(e));var i=[t.mediaAgent.constants.MEDIA_ERROR.iceConnectionError,t.mediaAgent.constants.MEDIA_ERROR.internalError];f.includes(i,e.type)&&t.event("mediaConnectionFailed").raise(),t.callTelemetry.recordEvent(m.MEDIA_EVENT.SESSION_ERROR,{type:e.type},n)},onNegotiationRequired:function(e){void 0===e&&(e=y.generateCauseId());var n=y.generateCauseId();3===t.state||4===t.state||5===t.state||10===t.state||t.isPreheatedOnly()?(t.logger.info("["+e+"][onNegotiationRequired] Negotiation started, state: "+t.state),t._callOperationHandler.executeChained(function(){return t.renegotiateOutgoing(e)},m.CALL_OPERATIONS_INTERNAL.RENEGOTIATE_OUTGOING,n,e)):t.logger.info("["+e+"][onNegotiationRequired] Negotiation not started, state: "+t.state),t.callTelemetry.recordEvent(m.MEDIA_EVENT.NEGOTIATION_REQUIRED,"",e)},onContributingSourcesChanged:function(e){t.participants.forEach(function(t){var n=e.indexOf(t.audio.id)>=0?1:0;t.updateVoiceLevel(n)})},onDominantSpeakerChanged:function(e,n){var i=y.generateCauseId(),r=[],o=[];e.forEach(function(e){var n=f.find(t.participants,function(t){return t.audio.id===e});n?(r.push(n.id),o.push(O.scrubMriOrOmit(n.id))):o.push(t.streamManager.audio.id===e?"<self>":"<unknown>")}),t.logger.info("["+i+"][onDominantSpeakerChanged], msidList = "+e+" => speakerList = "+o+", timestamp = "+n),t.dominantSpeakerInfo={speakerList:r,timestamp:n},t.raiseChanged()},onAudioStateChanged:function(e,i){var r=y.generateCauseId(),o=t.logger.createFnLogger("onAudioStateChanged",r);o.info(B.safeJsonStringify(e)),t.callStats.localStats.audio.streamStateChanged(e.stream,e.direction);var a=n.streamingStatetoMediaStreamState(e.stream);if(t.audioStreamState=a,a){t.callTelemetry.recordEvent(m.MEDIA_EVENT.AUDIO_STATE_CHANGED,{state:e,reason:i},r),2===a&&2===t.state&&(t.setCallState(9,r),t.participants.forEach(function(e){return e.setState(6,void 0,r)}));var s={mediaType:0,mediaDirection:n.streamingDirectionToMediaDirectionMapping(e.direction),mediaStreamState:a};if(t.event("mediaStreamStateChanged").raise(s),!t.isCallSetupTelemetrySent&&t.mediaAgent.getConfig().sendCallStartupTelemetry&&t.sendCallSetupTelemetry(),0===s.mediaDirection&&(t.isAudioStreamConnected=f.includes([2,1],s.mediaStreamState)),f.includes([3,4],s.mediaStreamState)&&(o.logFailure("audio stream state changed to "+e.stream+" with reason "+i),!i||["timeout","connection-dropped","connectivity-check-failure"].indexOf(i)>=0)){t.event("mediaConnectionFailed").raise();var c=t.mediaRelayWhiteListingIssue?53:4;t.mediaRelayWhiteListingIssue&&t.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.MEDIA_WHITELISTING_ISSUE_DETECTED);var l=t.getRejectionInfoFromTerminatedReason(c);t.shouldFallbackToLwj([l.code,l.subCode],o)?t.reconnectAsLwj(c,r):t.stopInternal({causeId:r,terminatedReason:c})}}},onQualityChanged:function(e){var i={type:n.convertQualityEventType(e.type),value:n.convertQualityLevel(e.value),isLocalSource:e.isLocalSource,mediaType:n.convertMediaType(e.mediaType)};32===i.type&&(t.mediaRelayWhiteListingIssue=!0,t.event("mediaConnectionWhitelistingWarning").raise()),5===i.type&&3===i.value&&t.trouterService.checkConnection(!0),t.callTelemetry.recordEvent(m.MEDIA_EVENT.AUDIO_QUALITY_CHANGED,i),t.event("callQualityChanged").raise(i)},onOptimalVideoReceiversCountChanged:function(e){t.logger.debug("onOptimalVideoReceiversCountChanged: "+e),t.optimalVideoCount!==e&&(t.optimalVideoCount=e,t.raiseChanged())},onDataChannelUpdated:function(e){var n=y.generateCauseId();t.logger.debug("["+n+"] onDataChannelUpdated"),t.dataChannel.registerSessionDataChannel(e,n)}};this._mediaSessionCreationTime=Date.now(),this.mediaSession=new D.default(this.mediaAgent.createSession(i,this.signalingSession.correlationId,{isConference:this.callUsesMixer}),this.signalingSession,this.mediaAgent.constants),this.streamManager.setMediaSession(this.mediaSession,e),this.participants.forEach(function(n){n.setMediaSession(t.mediaSession,e)})}},n.prototype.invertDirectionality=function(e){switch(e){case this.mediaAgent.constants.MEDIA_STATE.sendReceive:return V.streamDirections.sendReceive;case this.mediaAgent.constants.MEDIA_STATE.send:return V.streamDirections.receive;case this.mediaAgent.constants.MEDIA_STATE.receive:return V.streamDirections.send;default:return null}},n.prototype.completeNegotiationAsync=function(e){var n=this,i=this.logger.createFnLogger("completeNegotiationAsync",e),r=this.mediaSession.completeNegotiationAsync(e).then(function(r){i.info("activeModalities="+(r&&Object.keys(r.activeModalities)));var o=n.participants[0],a=o&&o.endpoints&&o.endpoints.endpointDetails.length&&o.endpoints.endpointDetails[0].mediaStreams&&o.endpoints.endpointDetails[0].mediaStreams.length;if(o&&!n.callUsesMixer&&!a){var s=function(e,i,r){return{participantId:t.DEFAULT_PARTICIPANT_ID,endpointId:t.DEFAULT_ENDPOINT_ID,type:e,direction:n.invertDirectionality(i),sourceId:r,serverMuted:!1}},c=[];c.push(s(V.ngcStreamTypes.audio,r.activeModalities.audio,F.AUDIO_STREAM_DEFAULT_ID)),r.activeModalities.video&&c.push(s(V.ngcStreamTypes.video,r.activeModalities.video,F.VIDEO_STREAM_DEFAULT_ID)),r.activeModalities.sharing&&c.push(s(V.ngcStreamTypes.sharing,r.activeModalities.sharing,F.SHARING_STREAM_DEFAULT_ID)),o.updateStreams(c,e)}return i.logSuccess(B.safeJsonStringify(r)),r});return r.catch(function(t){i.logFailure(t),n.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.COMPLETE_NEGOTIATION_FAILED,{e:t},e)}),r},n.prototype.renegotiateOutgoing=function(e){return l(this,void 0,void 0,function(){var t,n,i,r,o,a,s,c,l,d,p,f=this;return u(this,function(u){switch(u.label){case 0:this.renegotiationAnswerDeferred=g.defer(),(n=this.logger.createFnLogger("renegotiateOutgoing",e)).info("start"),i=R.default(n),u.label=1;case 1:u.trys.push([1,11,,12]),u.label=2;case 2:return u.trys.push([2,8,,10]),t=this.inLocalHold()?this.getMediaModalitiesForHold(e):this.calculateModalityDirections({},e),[4,i.execute(w.RenegotiationPhase.MediaCreateOffer,function(){return f.mediaSession.createOfferAsync(e)})];case 3:return r=u.sent(),o=this.getSignalingMediaTypes(t),[4,i.execute(w.RenegotiationPhase.SignalingStartNegotiation,function(){return f.signalingSession.startRenegotiationAsync(r,o,e)})];case 4:return u.sent(),[4,i.execute(w.RenegotiationPhase.SignalingRenegotiationAnswer,function(){return f.renegotiationAnswerDeferred.promise})];case 5:return a=u.sent(),[4,i.execute(w.RenegotiationPhase.MediaProcessAnswer,function(){return f.mediaSession.processAnswerAsync(a,e,!1)})];case 6:return u.sent(),[4,i.execute(w.RenegotiationPhase.CompleteNegotiation,function(){return f.completeNegotiationAsync(e)})];case 7:return s=u.sent(),this.onNegotiationCompletion(s,!0,t,e,i.getTelemetryData()),[3,10];case 8:if(c=u.sent(),n.logFailure(c),!c.phase)throw this.callTelemetry.recordEvent(m.MEDIA_EVENT.OUTGOING_NEGOTIATION_FAILURE,c,e),c;if(l="unknown",d=this.mediaAgent.constants.RENEGOTIATION_ERROR,l=d.local,c.phase===w.RenegotiationPhase.SignalingRenegotiationAnswer||c.phase===w.RenegotiationPhase.SignalingStartNegotiation?l=c.error.code===w.jsCallEndCodes.GlareError?d.glare:415===c.error.code?d.media:d.signaling:c.phase===w.RenegotiationPhase.MediaCreateOffer&&c.error.type===this.mediaAgent.constants.MEDIA_ERROR.noNetworkError&&(l=d.media),this.callTelemetry.recordEvent(m.MEDIA_EVENT.OUTGOING_NEGOTIATION_FAILURE,this.getTelemetryFromPhaseExecution(c),e),c.error.message&&c.error.message.includes("The requested call does not exist"))throw new Error("Call drop due to remote replying with call not found");return n.logFailure(l),[4,this.mediaSession.rejectNegotiationAsync(l,e)];case 9:return u.sent(),this.onNegotiationFailure(c,l,e,t),[3,10];case 10:return[3,12];case 11:return p=u.sent(),n.logFailure(p),this.callTelemetry.recordEvent(m.MEDIA_EVENT.NEGOTIATION_FATAL_ERROR,B.getPIISafeObject(p),e),this.stopInternal({causeId:e,terminatedReason:47}),[3,12];case 12:return[2]}})})},n.prototype.renegotiateIncoming=function(e,t){return l(this,void 0,void 0,function(){var n,i,r,o,a,s,c,l,d,p,f=this;return u(this,function(u){switch(u.label){case 0:if(this.mediaAcknowledgmentOperation=this._callOperationHandler.createPendingOperation(m.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,null,t),this.mediaAcknowledgmentOperation.catch(H.noop),(n=this.logger.createFnLogger("renegotiateIncoming",t)).info("start"),e.newOffer&&!this.mediaAgent.getCapabilities().retargeting)return n.logFailure("Retarget offer received, but pluginless has no support for retarget"),this.stopInternal({causeId:t,terminatedReason:38}),[2];i=R.default(n),u.label=1;case 1:return u.trys.push([1,12,,20]),[4,i.execute(w.RenegotiationPhase.MediaProcessOffer,function(){return f.mediaSession.processOfferAsync(e,t)})];case 2:return r=u.sent(),this.handleOfferedModalities(r,t),this.getRenegotiationOfferType(r)!==w.RenegotiationOfferType.Resume?[3,4]:[4,this.prepareModalitiesForResume(t)];case 3:u.sent(),u.label=4;case 4:return[4,this.updateMediaModalities({offered:r},t)];case 5:return o=u.sent(),this.getRenegotiationOfferType(r)!==w.RenegotiationOfferType.Hold?[3,7]:[4,this.prepareModalitiesForHold(t)];case 6:u.sent(),u.label=7;case 7:return this.updateVideoState(o,t),this.isRenegotiationHoldOrResume(o)&&this.updateScreenSharingState(o,t),[4,i.execute(w.RenegotiationPhase.MediaCreateAnswer,function(){return f.mediaSession.createAnswerAsync(!1,t)})];case 8:return a=u.sent(),s=this.getSignalingMediaTypes(o),[4,i.execute(w.RenegotiationPhase.SignalingAcceptRenegotiation,function(){return f.signalingSession.acceptRenegotiationAsync(a,s,t)})];case 9:return u.sent(),[4,i.execute(w.RenegotiationPhase.SignalingMediaAcknowledgement,function(){return f.mediaAcknowledgmentOperation})];case 10:return u.sent(),[4,i.execute(w.RenegotiationPhase.CompleteNegotiation,function(){return f.completeNegotiationAsync(t)})];case 11:return c=u.sent(),this.onNegotiationCompletion(c,!1,r,t,i.getTelemetryData()),[3,20];case 12:l=u.sent(),u.label=13;case 13:if(u.trys.push([13,18,,19]),!l.phase||l.phase===w.RenegotiationPhase.CompleteNegotiation)throw this.callTelemetry.recordEvent(m.MEDIA_EVENT.INCOMING_NEGOTIATION_FAILURE,l,t),l;return d=l,this.callTelemetry.recordEvent(m.MEDIA_EVENT.INCOMING_NEGOTIATION_FAILURE,this.getTelemetryFromPhaseExecution(l),t),d.phase!==w.RenegotiationPhase.SignalingAcceptRenegotiation&&d.phase!==w.RenegotiationPhase.SignalingMediaAcknowledgement?[3,15]:(n.logFailure("Error in renegotiateIncoming() -> rejecting media negotiation"),[4,this.mediaSession.rejectNegotiationAsync(this.mediaAgent.constants.RENEGOTIATION_ERROR.signaling,t)]);case 14:return u.sent(),[2];case 15:return[4,this.mediaSession.rejectNegotiationAsync(this.mediaAgent.constants.RENEGOTIATION_ERROR.local,t)];case 16:return u.sent(),[4,this.signalingSession.rejectRenegotiationAsync(void 0,t)];case 17:return u.sent(),[3,19];case 18:return p=u.sent(),n.logFailure(p),this.callTelemetry.recordEvent(m.MEDIA_EVENT.NEGOTIATION_FATAL_ERROR,B.getPIISafeObject(p),t),this.stopInternal({causeId:t,terminatedReason:47}),[3,19];case 19:return[3,20];case 20:return[2]}})})},n.prototype.handleCallEscalation=function(e,n){var i=this.logger.createFnLogger("handleCallEscalation",n);if(i.info("current callType="+this.callType+", escalationInProgress="+e+", isEscalationInProgress="+this.isEscalationInProgress),e){var r=this.participants[0];r&&r.audio.participantId===t.DEFAULT_PARTICIPANT_ID?r.updateStreams([{type:V.ngcStreamTypes.audio,direction:"inactive",sourceId:null,serverMuted:!1},{type:V.ngcStreamTypes.video,direction:"inactive",sourceId:null,serverMuted:!1},{type:V.ngcStreamTypes.sharing,direction:"inactive",sourceId:null,serverMuted:!1}],n):i.info("no 1-1 participant found, stream update ignored"),this.setCallType(2,n),this.setCallUsesMixer(!0,n),this.setIsEscalationInProgress(!1,n),this.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.ESCALATION_COMPLETED,void 0,n),this.raiseChanged()}},n.prototype.reportTsCallingTelemetry=function(e){return l(this,void 0,void 0,function(){var t;return u(this,function(n){switch(n.label){case 0:return this.tsCallingTelemetryReported?[2]:[4,this.connectCallPromise.catch(H.noop)];case 1:return n.sent(),t=e?"call_setup_session":"in_call_session",this.callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),this.reportTelemetryEvents([{eventName:t,props:this.callTelemetry.getEvent(e)}],"signaling","skypecosi_concore_web_ts_calling"),e?this.callTelemetry.switchToInCallTelemetry():this.tsCallingTelemetryReported=!0,[2]}})})},n.prototype.sendCallSetupTelemetry=function(){this.mediaSession&&(this.collectCallStats(this.mediaSession),this.reportCallSetupStats(),this.isCallSetupTelemetrySent=!0)},n.prototype.collectCallStats=function(e){var t=this,n=function(){return t.collectMediaStatsDeferred.resolve()};return e.getStatsAsync().then(function(e){return t.callStats.setMediaStats(e)}).then(n,n)},n.prototype.reportCallSetupStats=function(){var e=this;this.collectMediaStatsDeferred.promise.then(function(){e.reportTelemetryEvents(e.callStats.buildFromCallSetupStats(),"media","mdsc"),e.event("statsReported").raise(),e.collectMediaStatsDeferred=g.defer()})},n.prototype.reportCallEndStats=function(e){return l(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return this.callTelemetry.setTerminationState(this.state),this.callTelemetry.setTerminationReason(this.terminatedReason),this.callStats.localStats.endCall(this.terminatedReason),this.reportTelemetryEvents(this.callStats.buildFromLocalStats(),"signaling","skypecosi_concore_web"),this.reportTsCallingTelemetry(!this._callIsSetupComplete),e?[4,this.collectMediaStatsDeferred.promise]:[3,2];case 1:t.sent(),this.callStats.appendTerminationInfo(this.terminatedReason,this.state),this.reportTelemetryEvents(this.callStats.buildFromMediaStats(),"media","mdsc"),t.label=2;case 2:return this.event("statsReported").raise(),this.collectMediaStatsDeferred=g.defer(),[2]}})})},n.prototype.reportTelemetryEvents=function(e,t,n){var i=this.telemetryLoggers?this.telemetryLoggers[t]:null;i&&e.forEach(function(e){return i.sendEvent({eventName:(n?n+"_":"")+e.eventName,props:e.props})})},n.prototype.onLocalPreviewSizeChanged=function(e,t){this.logger.debug("onLocalPreviewSizeChanged: "+e+"x"+t)},n.prototype.onLocalPreviewStateChanged=function(e){this.logger.debug("onLocalPreviewStateChanged: "+e),this.callStats.localStats.video.streamStateChanged(e.stream)},n.prototype.configureVideoModalitiesAsync=function(e,t){return l(this,void 0,void 0,function(){return u(this,function(n){switch(n.label){case 0:return this.mediaSession?[4,this.updateMediaModalities(void 0,t)]:(this.logger.warn("Tried to configure modalities after call end"),[2,Promise.resolve()]);case 1:return n.sent(),e||this.turnOffLocalVideoPreview(t),this.setVideoOn(e,t),[2]}})})},n.prototype.turnOffLocalVideoPreview=function(e){return this.localVideoRenderer&&(this.localVideoRenderer.dispose(),this.localVideoRenderer=null),Promise.resolve(void 0)},n.prototype.turnOnLocalVideoPreview=function(e){var t=this;if(this.mediaAgent.getConfig().noDummyLocalPreview)return Promise.resolve();var n=this.logger.createFnLogger(m.CALL_OPERATIONS_INTERNAL.START_PREVIEW_VIDEO,e),i=this.mediaStateConfigurationHelper.isSending(1);if(!i||!this.localVideoContainer)return Promise.reject("could not start video preview: requestedVideoState="+i+", localVideoContainer="+this.localVideoContainer);this.turnOffLocalVideoPreview(e);var r=g.asap(function(){t.localVideoRenderer=t.mediaAgent.getDeviceManager().createPreviewRenderer(t.localVideoContainer),t.localVideoRenderer.on("onVideoSizeChanged",function(e,n){return t.onLocalPreviewSizeChanged(e,n)}),t.localVideoRenderer.on("onVideoStateChanged",function(e){return t.onLocalPreviewStateChanged(e)})}).then(function(){return t.localVideoRenderer.startVideoAsync()});return r.catch(function(e){return n.logFailure(e)}),r},n.prototype.startStopVideo=function(e,t){var n=this,i=this.logger.createFnLogger(e?"startVideo":"stopVideo",t);if(i.info("start"),this.isJoinedLightweight())return i.logFailure("Can not start/stop video in lightweight call]"),Promise.reject(60);if(!this.canToggleVideo)return e===this.mediaStateConfigurationHelper.isSending(1)?this.videoTogglePromise.then(function(){n.turnOnLocalVideoPreview(t)}):(i.logFailure("video switching is in progress "+e+"]"),Promise.reject({reason:1}));e?(this.callStats.localStats.newSession(1),this.callStats.localStats.video.start()):this.callStats.localStats.video.stop(),e&&this.mediaStateConfigurationHelper.isDisabled(1)&&i.info("Video modality was skipped till now. Adding it now."),e?this.mediaStateConfigurationHelper.enableModality(1):this.mediaStateConfigurationHelper.removeModality(1),this.canToggleVideo=!1;var r=function(){n.canToggleVideo=!0};return this.videoTogglePromise=Promise.resolve().then(function(){return!!e&&(n.localVideoContainer||(n.localVideoContainer=document.createElement("div")),n.turnOnLocalVideoPreview(t).then(function(){return!0}))}).then(function(e){return n.configureVideoModalitiesAsync(e,t)}).catch(function(e){return i.logFailure(e),n.mediaStateConfigurationHelper.removeModality(1),n.configureVideoModalitiesAsync(!1,t).then(function(){throw e})}).then(r,function(e){throw i.logFailure(e),r(),e}),this.videoTogglePromise},n.prototype.startStopAudio=function(e,t){return l(this,void 0,void 0,function(){var n,i,r;return u(this,function(o){switch(o.label){case 0:n=this.logger.createFnLogger(e?"startAudio":"stopAudio",t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.updateMediaModalities(void 0,t)];case 2:return i=o.sent(),this.updateVideoState(i,t),[3,4];case 3:return r=o.sent(),n.logFailure(r),[2,9];case 4:return[2,0]}})})},n.prototype.updateEndpointStateForMute=function(e,t){try{this.signalingSession.updateEndpointState({state:{isMuted:e}},t)}catch(e){this.logger.logFailure("updateEndpointStateForMute failure: "+e)}},n.prototype.handleServerMutedState=function(e){return l(this,void 0,void 0,function(){var t,n,i,r;return u(this,function(o){switch(o.label){case 0:if(t=this.logger.createFnLogger("handleServerMutedState, isServerMuted="+!!this.isServerMuted,e),this.isServerMuted)return[3,4];if(n=this._muteState===w.ParticipantMuteState.AttemptingUnmute,this._muteState!==w.ParticipantMuteState.ServerMuted&&!n)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),t.info("is unmuting, as we are no longer server muted"),[4,this.handleMuteUnmuteOnMediaSession(!1,e)];case 2:return o.sent(),this.setMuted(w.ParticipantMuteState.Unmuted,e),n&&this.updateEndpointStateForMute(!1,e),[3,4];case 3:throw i=o.sent(),t.logFailure(i),i;case 4:if(!this.isServerMuted||this._muteState!==w.ParticipantMuteState.Unmuted)return[3,8];t.info("is muting, as we are unmuted"),o.label=5;case 5:return o.trys.push([5,7,,8]),[4,this.handleMuteUnmuteOnMediaSession(!0,e)];case 6:return o.sent(),this.setMuted(w.ParticipantMuteState.ServerMuted,e),[3,8];case 7:throw r=o.sent(),t.logFailure(r),r;case 8:return[2]}})})},n.prototype.handleMuteUnmuteOnMediaSession=function(e,t){return l(this,void 0,void 0,function(){var n,i,r;return u(this,function(o){switch(o.label){case 0:return n=this.logger.createFnLogger("handleMuteUnmuteOnMediaSession, value="+!!e,t),this.mediaSession&&this.mediaSession.getAllowedModalities&&!this.isServerMuted?(i=this.isMuted||this.isServerMuted,r=this.mediaSession.getAllowedModalities().audio.some(function(e){return e===V.streamDirections.send||e===V.streamDirections.sendReceive}),i&&r||!i&&!r?(n.info("updating audio modalities: Muted "+i+" -> "+e+"; audioAllowed = "+r),[4,this.updateMediaModalities(void 0,t)]):[3,2]):[3,2];case 1:o.sent(),o.label=2;case 2:return e?(n.info("mediaSession.muteInputAsync"),[4,this.mediaSession.muteInputAsync(t)]):[3,4];case 3:return o.sent(),[3,6];case 4:return e?[3,6]:(n.info("mediaSession.unmuteInputAsync"),[4,this.mediaSession.unmuteInputAsync(t)]);case 5:o.sent(),o.label=6;case 6:return[2,Promise.resolve()]}})})},n.prototype.updateCapabilities=function(e,t){void 0===t&&(t=!1);var n=!1,i=!1;if(!P.callStateIsAnyOf(this.state,[11,12])){var r="attendee"===this.meetingRole;this.isJoinedLightweight()||(this.isServerMuted&&!this._callInLobby?this._commandUrlPresence&h.CommandUrlPresence.Unmute&&(n=!0):this.isMuted&&(n=!0)),i=!!(this._commandUrlPresence&h.CommandUrlPresence.Mute)&&!r}this._capabilities.canUnmuteSelf===n&&this._capabilities.canMuteOthers===i||(this._capabilities.canUnmuteSelf=n,this._capabilities.canMuteOthers=i,this.logger.info("["+e+"][updateCapabilities] Computed self capabilities: "+JSON.stringify(this._capabilities)),t&&this.raiseChanged())},n.prototype.muteUnmute=function(e,t){return l(this,void 0,void 0,function(){var n,i,r,o=this;return u(this,function(a){switch(a.label){case 0:if(n=this.logger.createFnLogger("muteUnmute, value="+!!e,t),this.isJoinedLightweight())return n.logFailure("Can not mute/unmute lightweight call"),[2,Promise.reject(_.getRejectTransactionEnd(m.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))];if(P.callStateIsAnyOf(this.state,[11,12]))return n.logFailure("Can not mute/unmute during preheat call"),[2,Promise.reject(_.getRejectTransactionEnd(m.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))];i=!e&&(!this.isServerMuted||this._callInLobby),a.label=1;case 1:return a.trys.push([1,4,,5]),e||i?[4,this.handleMuteUnmuteOnMediaSession(e,t)]:[3,3];case 2:a.sent(),a.label=3;case 3:return e?(this.setMuted(w.ParticipantMuteState.Muted,t),n.info("is updating endpintState for mute"),this.updateEndpointStateForMute(!0,t)):i?(n.info("is updating endpointState for unmute"),this.setMuted(w.ParticipantMuteState.Unmuted,t),this.updateEndpointStateForMute(!1,t)):(n.info("is unmuting on server"),this._muteState===w.ParticipantMuteState.Muted&&this.setMuted(w.ParticipantMuteState.AttemptingUnmute,t),this.signalingSession.unmuteAsync().then(function(e){o.handleSelfUnmuteUpdatedInfo(e,t)})),[3,5];case 4:throw r=a.sent(),n.logFailure(r),_.getRejectTransactionEnd(r);case 5:return[2]}})})},n.prototype.muteUnmuteSpeaker=function(e,t){return l(this,void 0,void 0,function(){var n;return u(this,function(i){switch(i.label){case 0:return n=this.logger.createFnLogger("muteUnmuteSpeaker, isSpeakerMuted="+!!this.isSpeakerMuted,t),this.isJoinedLightweight()?(n.logFailure("Can not mute/unmute speaker in lightweight call"),[2,Promise.reject(60)]):(this.setSpeakerMuted(e,t),this.mediaSession?e?[4,this.mediaSession.muteOutputAsync(t)]:[3,2]:[3,4]);case 1:return i.sent(),[3,4];case 2:return[4,this.mediaSession.unmuteOutputAsync(t)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},n.prototype.getParticipant=function(e){return this.participants.filter(function(t){return t.isSameParticipantsMri(e)})[0]},n.prototype.getOrCreateParticipant=function(e,t){var n=this,i=this.getParticipant(e);return i||((i=new x.PluginlessCallParticipant(e,this.mediaSession,this.logger,this.callStats.localStats,this.callTelemetry,this.imageRenderingSession,t)).changed(function(){return n.onParticipantChanged(i)}),this.lwjUris&&this.lwjUris.frameUris&&i.useLightweightStreams(this.lwjUris.frameUris,t),this.participants.push(i),this.event("participantAdded").raise(i),this.monitorCallStart(),i)},n.prototype.onParticipantChanged=function(e){this.event("participantUpdated").raise(e),this.raiseChangedDeferred()},n.prototype.setCallState=function(e,t,n){if(void 0===n&&(n=0),this.state!==e){var i=this.logger.createFnLogger("setCallState",t);if(i.info("currentState="+this.state+", newState="+e+", terminatedReason="+this.terminatedReason),P.validStateTransitions[this.state].indexOf(e)>=0||(i.logFailure("invalid state transition"),7===e)){if(this.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,{state:e,reason:n},t),this.state=e,this.callStats.localStats.call.callStateChanged(e),7===e&&(this.terminatedReason=n,!f.includes(K,n))){var r=44===this.terminatedReason,o=55===this.terminatedReason,a=56===this.terminatedReason;this.setFailureType(!this.callGotConnected||!this._wasAudioStreamConnected||r||o||a?0:1)}3===e&&(this.callGotConnected=!0,this.callHeldAt=null),this.callIsHeld()&&!this.callHeldAt&&(this.callHeldAt=new Date),i.logSuccess("changed to "+e+", terminatedReason: "+this.terminatedReason+", failureType="+this.failureType),this.monitorCallStart(),this.event("callStateChanged").raise(),this.updateCapabilities(t),this.raiseChanged()}}},n.prototype.setMediaStream=function(e,t,n){if(e){if(!f.find(this.localMediaStreams,function(e){return e.mediaType===n})){var i=new Y(t,n);this.logger.info("setMediaStream "+JSON.stringify(i)),this.localMediaStreams.push(i)}}else this.logger.info("setMediaStream removing "+n),f.remove(this.localMediaStreams,function(e){return e.mediaType===n})},n.prototype.setVideoOn=function(e,t){this.logger.info("["+t+"]videoOn="+e),this.isVideoOn=e,this.setMediaStream(this.isVideoOn,!0,1),this.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.SET_LOCAL_VIDEO,{value:e},t),this.raiseChanged()},n.prototype.setScreenSharingOn=function(e,t){this.logger.info("["+t+"]screenSharingOn="+e),this.isScreenSharingOn=e,this.setMediaStream(this.isScreenSharingOn,this.isScreenSharingOn,3),this.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.SET_SCREEN_SHARING,{screenSharingOn:e},t),this.event("userActivityChanged").raise(),this.raiseChanged()},n.prototype.disposeSharingScreenHandle=function(){this.sharedScreenHandle&&(this.unsubscribeFromSharedScreenHandleEvents(),this.sharedScreenHandle.dispose(),this.sharedScreenHandle=null)},n.prototype.setMuted=function(e,t){this._muteState!==e&&(this._muteState=e,this.callTelemetry.recordEvent(m.CALL_OPERATIONS_INTERNAL.SET_MUTED,{isMuted:e},t),this.logger.info("["+t+"]participantMuteState:"+e+", isMuted: "+this.isMuted),this.updateCapabilities(t),this.raiseChanged())},n.prototype.setSpeakerMuted=function(e,t){this.logger.info("["+t+"]speakerMute="+e+"]"),this.isSpeakerMuted=e,this.raiseChanged()},n.prototype.monitorCallStart=function(){3===this.state&&this.participants.length&&!this.callStartedAt&&(this.callStartedAt=new Date)},n.prototype._removeParticipant=function(e,t,n){void 0===n&&(n=0);var i=this.logger.createFnLogger("removeParticipant",t);i.info("mri="+k.scrubSignalingParticipant(e));var r=f.remove(this.participants,function(t){return t.isSameParticipantsMri(e.id)})[0];r?(r.setState(4,n,t),this.event("participantRemoved").raise(r)):i.logFailure("unable to remove participant "+O.scrubMriOrOmit(e.id)),this.raiseChanged()},n.prototype.setIsSomeoneSharing=function(e){this.isSomeoneSharing===e||this.screenSharingRenegotiationDeferred&&this.callUsesMixer||(this.isSomeoneSharing=e,this.isSomeoneSharing&&this.isScreenSharingOn&&(this.stopScreenSharing(),this.logger.info("sharingStolen: Cleaning up local screenshare because remote screenshare is running"),this.event("sharingStolen").raise()))},n.prototype.handleOfferedModalities=function(e,t){var n=this.mediaAgent.constants.MEDIA_STATE,i=this.logger.createFnLogger("handleOfferedModalities",t);e.hasOwnProperty("video")||this.mediaStateConfigurationHelper.isSending(1)?e.hasOwnProperty("video")&&!this.mediaStateConfigurationHelper.isSending(1)&&this.mediaStateConfigurationHelper.removeModality(1):this.mediaStateConfigurationHelper.disableModality(1),e.hasOwnProperty("sharing")||this.mediaStateConfigurationHelper.isSending(3)||this.mediaStateConfigurationHelper.disableModality(3);try{i.info("offeredModalities="+B.safeJsonStringify(e))}catch(e){i.logFailure(e)}e.sharing!==n.receive||this.mediaStateConfigurationHelper.isSending(3)||this.mediaStateConfigurationHelper.removeModality(3),this.setIsSomeoneSharing(e.sharing===n.receive),this.isSomeoneStreamingVideo=e.video===n.receive||e.video===n.sendReceive,e.data&&e.data===n.sendReceive?this.mediaStateConfigurationHelper.enableModality(4):this.mediaStateConfigurationHelper.removeModality(4)},n.prototype.getRenegotiationOfferType=function(e){if(e)if(5===this.state){if("sendrecv"===e.audio)return w.RenegotiationOfferType.Resume}else if(this.modalitiesAreHold(e))return w.RenegotiationOfferType.Hold;return w.RenegotiationOfferType.Undefined},n.prototype.isRenegotiationHoldOrResume=function(e){return this.getRenegotiationOfferType(e)===w.RenegotiationOfferType.Hold||this.getRenegotiationOfferType(e)===w.RenegotiationOfferType.Resume},n.prototype.onNegotiationCompletion=function(e,t,n,i,r){var a=this;void 0===n&&(n={});var s=this.logger.createFnLogger("onNegotiationCompletion",i);s.info("byLocal="+t+", result="+B.safeJsonStringify(e)),this.callTelemetry.recordEvent(m.MEDIA_EVENT.NEGOTIATION_COMPLETION,o({phaseTelemetryBag:r},this.prepareNegotiationResultForTelemtry(e)),i);var c=this.isOneToOneCall();if(c){var l=this.modalitiesAreHold(e.activeModalities)?5:3;this.participants[0].setState(l,void 0,i),s.info("isOneToOneCall: participant[0] state set to "+l)}var u,d=this.modalitiesAreHold(e.configuredModalities),p=this.modalitiesAreHold(e.activeModalities);this.requestedHoldState?(d&&p||s.info("Not expected modalities when processing local hold: "+d+" "+p),4!==this.state&&s.info("Not expected state when processing local hold: "+this.state+", switching back to LocalHold")):t||this.callHoldResumeDeferred?!d&&p?u=5:d||p||this._callInLobby||this.isPreheatedOnly()||(u=3):4===this.state||this._callInLobby||this.isPreheatedOnly()||(u=c&&5===this.participants[0].state?5:3),u&&this.setCallState(u,i),this.callHoldResumeDeferred&&(s.info("isHoldInProgress="+this.isHoldInProgress+", state="+this.state),this.isHoldInProgress?(this.callHoldResumeDeferred.resolve(),this.isHoldInProgress=!1,this.callHoldResumeDeferred=null):this.inLocalHold()||(3===u||5===u||10===u?this.callHoldResumeDeferred.resolve():this.callHoldResumeDeferred.reject(new Error("Call state changed to "+u+" instead of Connected, Lobby or RemoteHold")),this.callHoldResumeDeferred=null)),this.requestedHoldState||(this.setIsSomeoneSharing(f.some(this.participants,function(e){return f.some(e.streams[1],function(e){return e.isAvailable})})),this.isSomeoneStreamingVideo=f.some(this.participants,function(e){return f.some(e.streams[0],function(e){return e.isAvailable})}));var h=n&&n.sharing===this.mediaAgent.constants.MEDIA_STATE.send,g=e&&e.activeModalities&&e.activeModalities.sharing===this.mediaAgent.constants.MEDIA_STATE.send;if(this.screenSharingRenegotiationDeferred&&h&&g&&(this.screenSharingRenegotiationDeferred.resolve(),this.screenSharingRenegotiationDeferred=null),this.retryOutgoingRenegotiation.retry){var v=this.retryOutgoingRenegotiation.causeId;this._callOperationHandler.executeChained(function(){return a.updateMediaModalities(void 0,v)},m.CALL_OPERATIONS_INTERNAL.RENEGOTIATE,v,v),this.retryOutgoingRenegotiation.retry=!1}},n.prototype.updateMediaStatus=function(e){return l(this,void 0,void 0,function(){var t,n,i,r,o,a,s,c;return u(this,function(l){switch(l.label){case 0:i=!1,r=!1;try{for(o=d(this.participants),a=o.next();!a.done&&(s=a.value,i||(i=f.some(s.streams[1],function(e){return e.isAvailable})),r||(r=f.some(s.streams[0],function(e){return e.isAvailable})),!i||!r);a=o.next());}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return this.setIsSomeoneSharing(i),this.isSomeoneStreamingVideo=r,this.mediaSession?[4,this.updateMediaModalities(void 0,e)]:[3,2];case 1:c=l.sent(),this.callTelemetry.updateOperationData(m.CALL_OPERATIONS_INTERNAL.UPDATE_LOCAL_MEDIA_STATUS,c,e),l.label=2;case 2:return[2]}})})},n.prototype.onNegotiationFailure=function(e,t,n,i){var r=i&&i.sharing===this.mediaAgent.constants.MEDIA_STATE.send;if(t===this.mediaAgent.constants.RENEGOTIATION_ERROR.glare)return this.screenSharingRenegotiationDeferred&&r&&this.callStats.localStats.screenShare.negotiationStateChanged("rejected","glare"),void(this.retryOutgoingRenegotiation={retry:!0,causeId:n});this.callHoldResumeDeferred&&(this.callHoldResumeDeferred.reject(new Error("Error in renegotiateOutgoing() -> rejecting hold for callId = "+this.callId+", reason="+t)),this.callHoldResumeDeferred=null,this.isHoldInProgress=!1),this.screenSharingRenegotiationDeferred&&r&&(this.screenSharingRenegotiationDeferred.reject(e),this.screenSharingRenegotiationDeferred=null)},n.getParticipantReasonFromTerminatedReason=function(e){switch(e){case 1:return 0;case 9:return 2;case 10:return 3;case 2:return 4;case 24:return 8;case 3:return 9;case 4:return 10;case 14:return 12;case 0:return 11;case 15:return 13;case 16:return 14;case 17:return 15;case 18:return 16;case 19:return 17;case 20:return 18;case 11:return 19;case 21:return 20;case 22:return 21;case 23:return 22;case 33:return 25;case 36:return 26;case 37:return 27;case 41:return 30;case 39:return 28;case 42:return 31;case 40:return 29;case 43:return 32;case 44:return 33;case 45:return 34;case 46:return 35;case 47:return 36;case 48:return 37;case 49:return 38;case 50:return 39;case 51:return 40;case 52:return 41;case 54:return 42;case 55:return 44;case 56:return 45;case 12:return 23;case 59:return 46;case 73:return 59;case 61:return 47;case 60:return 48;case 62:return 49;case 63:return 50;case 64:return 5;case 65:return 51;case 8:return 52;default:return 11}},n.prototype.updateCallParticipantFromSignalingParticipant=function(e,t,n){if(t.isLobby)e.setState(7,void 0,n);else{var i=t.endpointDetails&&t.endpointDetails[0].mediaStreams,r=t.endpointDetails&&t.endpointDetails[0].lwjSessionInformation;if(i&&i.length>0){var o=i.every(function(e){return"inactive"===e.direction}),a=o?5:3;1!==this.state||o||this.callUsesMixer||(a=2),e.setState(a,void 0,n)}else r&&e.setState(3,void 0,n)}},n.prototype.handleSelfServerMutedState=function(e){var t=this,n=f.find(this.localSignalingParticipant.endpointDetails,function(e){return t._endpointId===e.endpointId}),i=n&&n.mediaStreams,r=i&&i.filter(function(e){return"audio"===e.type||"audio-teleconferencing"===e.type});if(r&&r.length>0){var o=r.some(function(e){return e.serverMuted});o!==this.isServerMuted&&(this.isServerMuted=o,this.callTelemetry.recordEvent(m.PARTICIPANT_OPERATIONS_INTERNAL.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted}),this.logger.info("updateLocalParticipant: server muted set to "+o),this.event("serverMutedChanged").raise(o),this.updateCapabilities(e,!0),this.handleServerMutedState(e))}},n.prototype.checkIfIncomingServerMutedIsUpdated=function(e){var t=this,n=f.find(this.localSignalingParticipant.endpointDetails,function(e){return e.participantId===t.localSignalingParticipant.participantId});if(void 0!==n){var i=f.find(e.endpointDetails,function(e){return t.localSignalingParticipant.participantId});L.handleServerMutedVersion(this.logger,n,i)}},n.prototype.convertWiredPublishedState=function(e){if(e){var t=this.getPluginlessStateTypeFromWire(e.stateType);return{content:e.content,stateType:t,typeRank:e.typeRank,stateId:e.stateId}}},n.prototype.updatePublishedStateModified=function(e,t){e!==this.currentUserSkypeIdentity.id||t&&t!==this.participantId?this._publishedStatesModified=this._publishedStatesModified|J.Other:this._publishedStatesModified=this._publishedStatesModified|J.Self},n.prototype.updatePublishedStates=function(e){var t=this;try{var n=[];f.forEach(e.publishedStates,function(e){n.push(t.convertWiredPublishedState(e))}),f.isEqual(this._participantPublishedStatesMap[e.id],n)||(0!==n.length||void 0!==this._participantPublishedStatesMap[e.id]&&null!==this._participantPublishedStatesMap[e.id])&&(this._participantPublishedStatesMap[e.id]=n,this.updatePublishedStateModified(e.id));var i=[];f.forEach(e.endpointDetails,function(r){i.push(r.participantId),n=[],f.forEach(r.publishedStates,function(i){var o=t.convertWiredPublishedState(i);t._endpointPublishedStatesMap[e.id]||(t._endpointPublishedStatesMap[e.id]={},t._endpointPublishedStatesMap[e.id][r.participantId]=[]),n.push(o)}),t._endpointPublishedStatesMap[e.id]&&!f.isEqual(t._endpointPublishedStatesMap[e.id][r.participantId],n)&&(0!==n.length||null!==t._endpointPublishedStatesMap[e.id][r.participantId]&&void 0!==t._endpointPublishedStatesMap[e.id][r.participantId])&&(t._endpointPublishedStatesMap[e.id][r.participantId]=n,t.updatePublishedStateModified(e.id,r.participantId))}),this._endpointPublishedStatesMap[e.id]&&Object.keys(this._endpointPublishedStatesMap[e.id]).forEach(function(n){i.some(function(e){return e===n})||(delete t._endpointPublishedStatesMap[e.id][n],t.updatePublishedStateModified(e.id,n))})}catch(e){this.logger.error("updatePublishedStates "+JSON.stringify(e))}this.logger.info("updatePublishedStates "+JSON.stringify(this._participantPublishedStatesMap)),this.logger.info("updatePublishedStates "+JSON.stringify(this._endpointPublishedStatesMap))},n.prototype.removePublishedStatesByParticipant=function(e){this._endpointPublishedStatesMap[e]&&delete this._endpointPublishedStatesMap[e],this._participantPublishedStatesMap[e]&&delete this._participantPublishedStatesMap[e],this.updatePublishedStateModified(e)},n.prototype.findOrCreateTypeState=function(e){var t=this._publishedStates.typeStates.findIndex(function(t){return t.type===e});if(-1===t){var n={participantStates:[],type:e};this._publishedStates.typeStates.push(n),t=this._publishedStates.typeStates.length-1}return t},n.prototype.processPublishedStates=function(){var e,t,n,i,r=this;this.logger.info("processPublishedStates "+JSON.stringify(this._participantPublishedStatesMap)),this.logger.info("processPublishedStates "+JSON.stringify(this._endpointPublishedStatesMap));try{this._publishedStates||(this._publishedStates={typeStates:[]}),this._publishedStates.typeStates=[];var o=function(e){var t=a._participantPublishedStatesMap[e];f.forEach(t,function(t){var n=r.findOrCreateTypeState(t.stateType),i={id:e,publishedState:{content:t.content,stateId:t.stateId,typeRank:t.typeRank}};r._publishedStates.typeStates[n].participantStates.push(i)})},a=this;try{for(var s=d(Object.keys(this._participantPublishedStatesMap)),c=s.next();!c.done;c=s.next())o(c.value)}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}var l=function(e){var t,n,i=function(t){u._endpointPublishedStatesMap[e][t].forEach(function(n){var i=r.findOrCreateTypeState(n.stateType),o={id:t,publishedState:{content:n.content,stateId:n.stateId,typeRank:n.typeRank}},a={id:e,endpoints:[o]},s=r._publishedStates.typeStates[i].participantStates.filter(function(t){return t.id===e});s&&s.length>0?(s[0].endpoints||(s[0].endpoints=[]),s[0].endpoints.push(o)):r._publishedStates.typeStates[i].participantStates.push(a)})};try{for(var o=d(Object.keys(u._endpointPublishedStatesMap[e])),a=o.next();!a.done;a=o.next())i(a.value)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},u=this;try{for(var p=d(Object.keys(this._endpointPublishedStatesMap)),h=p.next();!h.done;h=p.next())l(h.value)}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}this.event("publishedStatesChanged").raise(this._publishedStates),this.raiseChanged()}catch(e){this.logger.error("processPublishedStates "+e+"}")}},n.prototype.updateLocalParticipant=function(e,t){var i=this.logger.createFnLogger("updateLocalParticipant",t);this.checkIfIncomingServerMutedIsUpdated(e),this.localSignalingParticipant.endpointDetails=e.endpointDetails,this.localSignalingParticipant.role=e.role,this.setMeetingRole(e.meetingRole),this.localSignalingParticipant.tenantId=e.tenantId,this.localSignalingParticipant.isLobby=e.isLobby,this.callTelemetry.setTenantId(e.tenantId),this.callStats.setTenantId(e.tenantId);var r=this.localSignalingParticipant.isLobby;e.endpointDetails&&this.updateLocalParticipantEndpoints(e.endpointDetails),this.updatePublishedStates(e),this.handleSelfServerMutedState(t),this._callInLobby=r,i.info("callInLobby = "+r+", callSetupComplete = "+this._callIsSetupComplete+", callIsHeld = "+this.callIsHeld()),!this._callIsSetupComplete||this.callIsHeld()||P.callStateIsAnyOf(this.state,[11,12])||(r?this.setCallState(10,t):this.setCallState(3,t));var o=n.getStreamsFromEndpoints(e.endpointDetails);this.callTelemetry.recordEvent(m.PARTICIPANT_OPERATIONS_INTERNAL.UPDATE_LOCAL_PARTICIPANT_STREAM,q.getStreamInformation(o),t),this.streamManager.updateStreams(o,t),this.updateCapabilities(t,!0)},n.prototype.modalitiesAreHold=function(e){return!(e.audio&&"inactive"!==e.audio||e.video&&"inactive"!==e.video||e.sharing&&"inactive"!==e.sharing)},n.prototype.toneToString=function(e){switch(e){case 0:return"0";case 1:return"1";case 2:return"2";case 3:return"3";case 4:return"4";case 5:return"5";case 6:return"6";case 7:return"7";case 8:return"8";case 9:return"9";case 10:return"*";case 11:return"#";default:return null}},n.streamingStatetoMediaStreamState=function(e){switch(e){case"started":return 0;case"active":return 2;case"inactive":return 1;case"stopped":return 3;case"failed":default:return 4}},n.streamingDirectionToMediaDirectionMapping=function(e){switch(e){case"send":return 1;case"receive":return 0;default:return}},n.convertMuteScope=function(e){switch(e){case 0:return"EveryoneElse";case 1:return"SpecifiedParticipants";default:return}},n.prototype.callIsHeld=function(){return 4===this.state||5===this.state},n.prototype.inLocalHold=function(){return this.isHoldInProgress||4===this.state},n.prototype.isJoinedLightweight=function(){var e=this,t=f.find(this.endpoints.endpointDetails,function(t){return e.participantId===t.participantId}),n=t&&t.lwjSessionInformation;return!!this.lwjUris||!!n},n.prototype.telemetryDataFromCallStartOptions=function(e){var t={};return e.muteFlags&&(t.muteMicrophone=!!(1&e.muteFlags),t.muteSpeaker=!!(2&e.muteFlags)),Object.keys(t).length?t:void 0},n.prototype.reconnect=function(){var e=y.generateCauseId();return this.mediaSession.reconnectAsync(e)},n.prototype.provideCallQualityFeedback=function(e,t,n,i){return l(this,void 0,void 0,function(){return u(this,function(e){return[2]})})},n.prototype.showCQFInfo=function(e,t){return l(this,void 0,void 0,function(){return u(this,function(e){throw new Error("Not implemented")})})},n.prototype.isCqfRendered=function(e){return l(this,void 0,void 0,function(){return u(this,function(e){return[2]})})},n.prototype.provideCallQualityFeedbackEx=function(e,t,n,i,r,o){return l(this,void 0,void 0,function(){return u(this,function(e){return[2]})})},n.prototype.testTriggerMediaRelayWhiteListingIssue=function(){this.logger.info("Simulating media relay whitelisting issue for test purposes");var e=this.mediaSession.mediaSession.callback;e.onQualityChanged({type:"NetworkRelaysNotReachable",value:"Bad",isLocalSource:!0,mediaType:"Audio"}),e.onAudioStateChanged({direction:"send",stream:"failed",content:"audio"})},n.prototype.getMediaTelemetry=function(){return l(this,void 0,void 0,function(){var e,t;return u(this,function(n){switch(n.label){case 0:return this.mediaSession?(t=(e=this.callStats).setMediaStats,[4,this.mediaSession.getStatsAsync()]):[3,2];case 1:t.apply(e,[n.sent()]),n.label=2;case 2:return[2,this.callStats.buildMediaTelemetry()]}})})},n.prototype.getMediaLogs=function(){return this.webRtcInternalsCollector.collect()},n.prototype.testSetCallState=function(e){this.logger.info("Overwriting call state for test purposes: "+this.state+" -> "+e+" "),this.state=e},n.prototype.testSetCallType=function(e){this.logger.info("Overwriting call state for test purposes: "+this.callType+" -> "+e+" "),this.callType=e},n.prototype.addGroupModality=function(e,t){void 0===t&&(t=y.generateCauseId());var n,i=this.logger.createFnLogger(m.CALL_OPERATIONS.ADD_GROUP_MODALITY,t);if(!e.threadId)return Promise.reject(_.getRejectTransactionEnd("No threadId was provided."));if(6===this.state||7===this.state)return i.info("Not adding modality because CallState is "+this.state+" threadId = "+O.getLoggableThreadId(e.threadId)+" messageId = "+e.messageId),Promise.reject(_.getRejectTransactionEnd(m.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED));if(e.additionalData)try{n=JSON.stringify(e.additionalData)}catch(t){i.logFailure("additionalData: "+e.additionalData+" is not valid Json, error: "+t);var r={code:w.jsCallEndCodes.BadRequest,subCode:0,phrase:"additionalData is not valid Json, error: "+t};return Promise.reject(r)}i.info("threadId = "+O.getLoggableThreadId(e.threadId)+" messageId = "+e.messageId+" additionalData = "+O.scrubMriOrOmit(n));var o={threadId:e.threadId,messageId:e.messageId,additionalData:n};return this.signalingSession.addGroupModalityAsync(o,t).catch(function(e){return i.logFailure(B.getPrintableObject(e)),Promise.reject(e)})},n.convertQualityEventType=function(e){switch(e){case"NetworkSendQuality":return 1;case"NetworkRecvQuality":return 2;case"NetworkDelay":return 3;case"NetworkBandwidthLow":return 4;case"NetworkReconnect":return 5;case"NetworkPacketLoss":return 6;case"NetworkJitter":return 7;case"NetworkRateMatching":return 8;case"DeviceCaptureNotFunctioning":return 9;case"DeviceRenderNotFunctioning":return 10;case"DeviceRenderGlitches":return 11;case"DeviceLowSNR":return 12;case"DeviceLowSpeechLevel":return 13;case"DeviceClipping":return 14;case"DeviceEcho":return 15;case"DeviceNearEndToEchoRatio":return 16;case"DeviceHalfDuplexAec":return 17;case"DeviceMultipleEndpoints":return 18;case"DeviceHowling":return 19;case"DeviceRenderZeroVolume":return 20;case"DeviceRenderMute":return 21;case"NetworkSendCatastrophic":return 22;case"NetworkRecvCatastrophic":return 23;case"CpuInsufficient":return 24;case"DeviceCaptureMute":return 25;case"DeviceCaptureNotMuteButSilent":return 26;case"DeviceSpeakWhileMuted":return 27;case"VideoVbssRendered":return 28;case"NetworkEthernetInterfaceUsed":return 29;case"NetworkWlanInterfaceUsed":return 30;case"NetworkWwanInterfaceUsed":return 31;case"NetworkRelaysNotReachable":return 32;case"VideoCapturerDeviceStartFailed":return 33;case"VideoCapturerDeviceStartTimedOut":return 34;case"VideoCapturerDeviceStartFailureLackSystemRes":return 35;case"VideoCapturerDeviceStartFailureMFResConflict":return 36;case"NoNetwork":return 37;case"NetworkNotWorking":return 38;case"DeviceCaptureNotFunctioningDeviceInUse":return 39;case"DeviceRenderNotFunctioningDeviceInUse":return 40;case"VideoCaptureDeviceFreeze":return 45;case"ZeroCaptureDevicesEnumerated":return 43;case"ZeroRenderDevicesEnumerated":return 44;case"VideoCapturePermissionDenied":return 47;case"ScreenshareRecordingDisabled":return 55;default:return}},n.convertQualityLevel=function(e){switch(e){case"Unknown":return 0;case"Good":return 1;case"Poor":return 2;case"Bad":return 3;default:return}},n.convertMediaType=function(e){switch(e){case"Audio":return 0;case"Video":return 1;case"PanoramicVideo":return 2;case"ScreenShare":return 3;case"Data":return 4;default:return}},n.prototype.getPluginlessPublishLevel=function(e){switch(e){case"user":return"user";case"endpoint":return"endpoint";default:throw"Invalid level type."}},n.prototype.getPluginlessStateType=function(e){switch(e){case"raiseHands":return"raiseHands";case"ufd":return"ufd";case"attendeeModalitiesUnrestricted":return"attendeeModalitiesUnrestricted";case"attendeeAudioRestricted":return"attendeeAudioRestricted";case"attendeeVideoRestricted":return"attendeeVideoRestricted";case"spotlight":return"spotlight";case"weatherPerson":return"weatherPerson";case"sharingLayoutType":return"sharingLayoutType";default:throw"Invalid state type when converting PublishStateType to PublishType."}},n.prototype.getPluginlessStateTypeFromWire=function(e){switch(e){case"raiseHands":return"raiseHands";case"ufd":return"ufd";case"attendeeModalitiesUnrestricted":return"attendeeModalitiesUnrestricted";case"attendeeAudioRestricted":return"attendeeAudioRestricted";case"attendeeVideoRestricted":return"attendeeVideoRestricted";case"spotlight":return"spotlight";case"weatherPerson":return"weatherPerson";case"sharingLayoutType":return"sharingLayoutType";default:throw"Invalid state type when converting PublishType to PublishStateType."}},n.prototype.setIsEmergency=function(e){this.logger.info("Set isEmergency:"+e),this.isEmergency=e,this.callTelemetry.setIsEmergency(e)},a([I.callOperation(m.CALL_OPERATIONS.INITIALIZE,{type:I.OPERATION_TYPE.SYNC,convertError:!0}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],n.prototype,"init",null),a([I.callOperation(m.CALL_OPERATIONS.START_VIDEO),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"startVideo",null),a([I.callOperation(m.CALL_OPERATIONS.STOP_VIDEO),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"stopVideo",null),a([I.callOperation(m.CALL_OPERATIONS.DUMP_VIDEO_SOURCE_IMAGES),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],n.prototype,"dumpVideoSourceImages",null),a([c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],n.prototype,"hold",null),a([I.callOperation(m.CALL_OPERATIONS.HOLD),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"holdWithRenegotiate",null),a([I.callOperation(m.CALL_OPERATIONS.LOCAL_HOLD),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"localHold",null),a([I.callOperation(m.CALL_OPERATIONS.UNHOLD,{waitFor:[m.CALL_OPERATIONS.HOLD,m.CALL_OPERATIONS.LOCAL_HOLD]}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"unhold",null),a([I.callOperation(m.CALL_OPERATIONS.UPDATE_ENDPOINT_METADATA),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"updateEndpointMetadata",null),a([I.callOperation(m.CALL_OPERATIONS.SEND_DTMF_TONE),s("design:type",Function),s("design:paramtypes",[Number]),s("design:returntype",Promise)],n.prototype,"sendDtmfTone",null),a([I.callOperation(m.CALL_OPERATIONS.SET_AUDIO_USAGE),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],n.prototype,"setAudioUsageMode",null),a([I.callOperation(m.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG),s("design:type",Function),s("design:paramtypes",[String,Number]),s("design:returntype",Promise)],n.prototype,"setAudioMidcallConfig",null),a([I.callOperation(m.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG_JSON),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],n.prototype,"setAudioMidcallConfigJson",null),a([I.callOperation(m.CALL_OPERATIONS.BLIND_TRANSFER,{singular:!0,type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],n.prototype,"callBlindTransfer",null),a([I.callOperation(m.CALL_OPERATIONS.SAFE_TRANSFER,{singular:!0,type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],n.prototype,"callSafeTransfer",null),a([I.callOperation(m.CALL_OPERATIONS.TRANSFER_TO_VOICEMAIL,{singular:!0,type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"transferCallToVoicemail",null),a([I.callOperation(m.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{singular:!0,type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"callConsultativeTransfer",null),a([I.callOperation(m.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,{singular:!0,type:I.OPERATION_TYPE.CHAINED}),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],n.prototype,"consultativeTransferWithPickupCode",null),a([I.callOperation(m.CALL_OPERATIONS.PARK_CALL,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Number,Object]),s("design:returntype",Promise)],n.prototype,"park",null),a([I.callOperation(m.CALL_OPERATIONS.UNPARK_CALL,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Number,String]),s("design:returntype",Promise)],n.prototype,"unpark",null),a([I.callOperation(m.CALL_OPERATIONS_INTERNAL.GET_CALL_REPLACEMENT_DETAILS,{type:I.OPERATION_TYPE.SYNC}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Object)],n.prototype,"getCallReplacementDetails",null),a([I.callOperation(m.CALL_OPERATIONS.START_SCREEN_SHARING),c(3,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,String,Object]),s("design:returntype",Promise)],n.prototype,"startScreenSharing",null),a([I.callOperation(m.CALL_OPERATIONS.STOP_SCREEN_SHARING),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Boolean,String,Object]),s("design:returntype",Promise)],n.prototype,"stopScreenSharing",null),a([I.callOperation(m.CALL_OPERATIONS.START_DATA_CHANNEL,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"startDataChannel",null),a([I.callOperation(m.CALL_OPERATIONS.STOP_DATA_CHANNEL,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"stopDataChannel",null),a([I.callOperation(m.CALL_OPERATIONS.SHARE_SYSTEM_SOUNDS),s("design:type",Function),s("design:paramtypes",[Boolean]),s("design:returntype",Promise)],n.prototype,"shareSystemSound",null),a([I.callOperation(m.CALL_OPERATIONS.MUTE,{waitFor:m.CALL_OPERATIONS.JOIN_PREHEATED_CALL}),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],n.prototype,"mute",null),a([I.callOperation(m.CALL_OPERATIONS.UNMUTE,{waitFor:m.CALL_OPERATIONS.JOIN_PREHEATED_CALL}),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],n.prototype,"unmute",null),a([I.callOperation(m.CALL_OPERATIONS.MUTE_SPEAKER),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],n.prototype,"muteSpeaker",null),a([I.callOperation(m.CALL_OPERATIONS.UNMUTE_SPEAKER),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],n.prototype,"unmuteSpeaker",null),a([I.callOperation(m.CALL_OPERATIONS.MUTE_PARTICIPANTS),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Number,Array,Object]),s("design:returntype",Promise)],n.prototype,"muteParticipants",null),a([I.callOperation(m.CALL_OPERATIONS.START_AUDIO,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"startAudio",null),a([I.callOperation(m.CALL_OPERATIONS.STOP_AUDIO,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"stopAudio",null),a([I.callOperation(m.CALL_OPERATIONS.ASSIMILATE),c(3,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],n.prototype,"assimilate",null),a([c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],n.prototype,"merge",null),a([I.callOperation(m.CALL_OPERATIONS.MERGE_PARTICIPANTS),c(1,I.operationId),c(3,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Array,Object,String]),s("design:returntype",Promise)],n.prototype,"mergeParticipants",null),a([I.callOperation(m.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE),c(0,I.operationId),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],n.prototype,"mergeWithPickupCode",null),a([I.callOperation(m.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS),s("design:type",Function),s("design:paramtypes",[Number]),s("design:returntype",Promise)],n.prototype,"setMaxVideoChannels",null),a([I.callOperation(m.CALL_OPERATIONS.STOP_CALL),c(1,I.causeId),c(3,I.reason),s("design:type",Function),s("design:paramtypes",[Boolean,Object,Object,Object]),s("design:returntype",Promise)],n.prototype,"stop",null),a([I.callOperation(m.CALL_OPERATIONS.PUBLISH_STATE),c(1,I.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],n.prototype,"publishState",null),a([I.callOperation(m.CALL_OPERATIONS.PUBLISH_STATE),c(1,I.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],n.prototype,"publishStatesForEveryone",null),a([I.callOperation(m.CALL_OPERATIONS.REMOVE_STATE),c(1,I.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],n.prototype,"removeState",null),a([I.callOperation(m.CALL_OPERATIONS.REMOVE_STATE),c(1,I.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],n.prototype,"removeStatesForEveryone",null),a([I.callOperation(m.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS),c(1,I.operationId),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],n.prototype,"updateMeetingSettings",null),a([I.callOperation(m.CALL_OPERATIONS.UPDATE_MEETING_ROLE),s("design:type",Function),s("design:paramtypes",[Array,String,String]),s("design:returntype",Promise)],n.prototype,"updateMeetingRoles",null),a([I.callOperation(m.CALL_OPERATIONS.CREATE_CONTENT_SHARING_SESSION),c(4,I.causeId),s("design:type",Function),s("design:paramtypes",[String,String,String,String,Object]),s("design:returntype",Promise)],n.prototype,"createContentSharingSession",null),a([I.callOperation(m.CALL_OPERATIONS.STOP_CALL_WITH_BEACON,{type:I.OPERATION_TYPE.SYNC}),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Boolean)],n.prototype,"stopWithBeacon",null),a([I.callOperation(m.CALL_OPERATIONS.ACKNOWLEDGE,{type:I.OPERATION_TYPE.CHAINED,convertError:!0}),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,String,Object]),s("design:returntype",Promise)],n.prototype,"acknowledge",null),a([I.callOperation(m.CALL_OPERATIONS.ACCEPT,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"accept",null),a([I.callOperation(m.CALL_OPERATIONS.REJECT),c(0,I.causeId),c(1,I.reason),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"reject",null),a([I.callOperation(m.CALL_OPERATIONS.JOIN_CALL,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.callStartOptions),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],n.prototype,"join",null),a([I.callOperation(m.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{waitFor:m.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED}),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],n.prototype,"joinPreheatedCall",null),a([I.callOperation(m.CALL_OPERATIONS.START_CALL,{type:I.OPERATION_TYPE.CHAINED}),c(0,I.callStartOptions),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"start",null),a([I.callOperation(m.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"startCallToVoicemail",null),a([I.callOperation(m.CALL_OPERATIONS.SUBSCRIBE,{type:I.OPERATION_TYPE.CHAINED}),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],n.prototype,"joinCallWithoutCallModality",null),a([I.callOperation(m.CALL_OPERATIONS.START_WITH_MEETING_DATA,{type:I.OPERATION_TYPE.CHAINED}),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"startWithMeetingData",null),a([I.callOperation(m.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,{type:I.OPERATION_TYPE.CHAINED}),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],n.prototype,"joinWithMeetingData",null),a([I.callOperation(m.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,{type:I.OPERATION_TYPE.CHAINED}),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],n.prototype,"subscribeWithMeetingData",null),a([I.callOperation(m.CALL_OPERATIONS.START_CALL_WITH_NUDGE,{type:I.OPERATION_TYPE.CHAINED}),c(1,I.callStartOptions),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Array,Object,Object]),s("design:returntype",Promise)],n.prototype,"startCallWithNudge",null),a([I.callOperation(m.CALL_OPERATIONS.START_CALL_AND_UNPARK,{type:I.OPERATION_TYPE.CHAINED}),c(2,I.callStartOptions),c(3,I.causeId),s("design:type",Function),s("design:paramtypes",[Number,String,Object,Object]),s("design:returntype",Promise)],n.prototype,"startAndUnpark",null),a([I.participantOperation(m.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT),c(0,I.operationId),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],n.prototype,"admitParticipant",null),a([I.callOperation(m.CALL_OPERATIONS.ADMIT),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],n.prototype,"admit",null),a([I.participantOperation(m.PARTICIPANT_OPERATIONS.CALL_ME_BACK),c(0,I.operationId),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[String,String,Object]),s("design:returntype",Promise)],n.prototype,"callMeBack",null),a([c(0,I.operationId),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],n.prototype,"addParticipant",null),a([I.participantOperation(m.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS),c(0,I.operationId),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Array,Object,Object]),s("design:returntype",Promise)],n.prototype,"addParticipants",null),a([c(0,I.operationId),c(2,I.causeId),s("design:type",Function),s("design:paramtypes",[Array,Object,Object,String]),s("design:returntype",Promise)],n.prototype,"addParticipantsImpl",null),a([I.participantOperation(m.CALL_OPERATIONS.NUDGE_PARTICIPANTS),c(0,I.operationId),c(3,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Array,Object,Object]),s("design:returntype",Promise)],n.prototype,"nudgeParticipants",null),a([I.participantOperation(m.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT),c(0,I.operationId),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,String,Number]),s("design:returntype",Promise)],n.prototype,"removeParticipant",null),a([I.callOperation(m.CALL_OPERATIONS.SEARCH_PARTICIPANTS),c(1,I.operationId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"searchParticipants",null),a([I.callOperation(m.CALL_OPERATIONS.GET_ALL_PARTICIPANTS),c(1,I.operationId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"getAllParticipants",null),a([I.callOperation(m.CALL_OPERATIONS.LWJ_FALLBACK),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Number,String]),s("design:returntype",Promise)],n.prototype,"reconnectAsLwj",null),a([c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],n.prototype,"turnOffLocalVideoPreview",null),a([I.callOperation(m.CALL_OPERATIONS_INTERNAL.START_PREVIEW_VIDEO),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],n.prototype,"turnOnLocalVideoPreview",null),a([I.callOperation(m.CALL_OPERATIONS_INTERNAL.UPDATE_LOCAL_MEDIA_STATUS,{type:I.OPERATION_TYPE.CHAINED}),c(0,I.causeId),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],n.prototype,"updateMediaStatus",null),a([I.callOperation(m.CALL_OPERATIONS_INTERNAL.RECONNECT),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],n.prototype,"reconnect",null),a([I.callOperation(m.CALL_OPERATIONS.ADD_GROUP_MODALITY),c(1,I.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],n.prototype,"addGroupModality",null),n}(C.default);t.default=Q},function(e,t,n){var i;window,e.exports=(i=n(8),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=37)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),r=n(39),o=n(3),a=n(1),s=n(12);function c(){return l().substr(0,8)}function l(){for(var e="",t=0,n=0;n<36;){var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[n];switch(t=n%8==0?4294967295*Math.random()|0:t>>4,i){case"x":e+="0123456789abcdef"[15&t];break;case"y":e+="0123456789abcdef"[3&t|8];break;case"4":case"-":e+=i}n++}return e}function u(e,t){if(!e||e instanceof String&&""===e||e instanceof Array&&0===e.length)throw new Error("AssertNotNullOrEmpty failed. "+(void 0!==t?": "+t:""))}function d(e,t){if(!e)throw new Error("AssertNotNull failed. "+(void 0!==t?": "+t:""))}function p(e,t){var n=t.toString().toLowerCase();return e.map(function(e){return e.toString().toLowerCase()}).indexOf(n)>-1}t.is1to1Mri=function(e){return!!e.match(/^8:/)},t.stripMri=function(e){return e.replace(/^\d+:/,"")},t.causeId=c,t.newMessageId=function(e){return e&&/^[a-z0-9]{8}$/.test(e)?e+l().substr(8):l()},t.newGuid=l,t.assert=function(e,t){if(!e)throw new Error("Assert failed"+(void 0!==t?":"+t:""))},t.assertNotNullOrEmpty=u,t.assertNotNull=d,t.assertNotNullArrayContent=function(e,t){if(0===e.length)throw new Error("assertNotNullArrayContent failed. "+(void 0!==t?": "+t:""));e.forEach(function(e){if(!e)throw new Error("assertNotNullArrayContent failed. "+(void 0!==t?"contains null value: "+t:""))})},t.assertCallEndReason=function(e){if(u(e,"callEndReason cannot be null or empty"),void 0===e.code||void 0===e.subCode||void 0===e.phrase||e.code<0||e.subCode<0||" "===e.phrase)throw new Error("callEndReason must specify code, subCode and phrase. Invalid reason : "+o.getPrintableObject(e))},t.getMediaTypes=function(e){d(e,"MediaTypes passed cannot be null");for(var t=[],n=a.default.MEDIA_TYPES,i=0,r=Object.keys(n);i<r.length;i++){var o=r[i];p(e,n[o])&&t.push(n[o])}return t},t.stringContains=function(e,t){return e.indexOf(t)>-1},t.stringEndsWith=function(e,t){return e.length>=t.length&&e.indexOf(t,e.length-t.length)>-1},t.arrayContains=p,t.tryAddNewKeyToHashTable=function(e,t,n){return!e.hasOwnProperty(t)&&(e[t]=n,!0)},t.tryRemoveKeyFromHashTable=function(e,t){return!!e.hasOwnProperty(t)&&(delete e[t],!0)},t.getHashTableCount=function(e){return Object.keys(e).length},t.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},t.tryParse=function(e){var t=null;try{return"object"==typeof(t=JSON.parse(e))?t:null}catch(e){return null}},t.getErrorForXHRFailure=function(e){if(!e)return{telemetryEndSubCode:a.default.CALL_END_CODE.UNKNOWN_ERROR,error:a.default.CALL_END_UNKNOWN_ERROR};var t;if("object"==typeof e.response)t=e.response;else try{t=JSON.parse(e.response)}catch(e){}if(!isNaN(e.status)&&e.status===a.default.CALL_END_CODE.NOT_FOUND)return{telemetryEndSubCode:a.default.CALL_END_CODE.NOT_FOUND,error:a.default.RESOURCE_NOT_FOUND_ERROR};if(e.skypeTokenError)return{telemetryEndSubCode:a.default.CALL_END_CODE.SKYPE_TOKEN_ERROR,error:a.default.CALL_END_SKYPE_TOKEN_ERROR};if(t&&(t.operationFailure||t.broadcastOperationFailure)){var n=t.operationFailure||t.broadcastOperationFailure;return{telemetryEndSubCode:n.code,error:n}}return t&&t.code?{telemetryEndSubCode:t.code,error:t}:isNaN(e.status)?{telemetryEndSubCode:a.default.CALL_END_CODE.NETWORK_ERROR,error:a.default.CALL_END_NETWORK_ERROR}:{telemetryEndSubCode:e.status,error:{code:e.status,subCode:isNaN(e.response)?0:e.response,phrase:e.statusText,resultCategories:[a.RESULT_CATEGORIES.UnexpectedClientError]}}},t.isDuplicateMessage=function(e,t){if(e&&t){var n=e[a.default.HEADERS.ORIGINAL_MESSAGE_ID]||null,i=e[a.default.HEADERS.MESSAGE_ID]||null;if(i&&p(t,i)||n&&p(t,n))return!0;t.length>9&&t.shift(),t.push(n||i)}return!1},t.extractCauseIdFromMessage=function(e){try{return e.headers[a.default.HEADERS.ORIGINAL_MESSAGE_ID].replace("-","").substr(0,8)}catch(e){return c()}},t.cacheMessageResult=function(e,t,n){if(e&&t){var i=e[a.default.HEADERS.ORIGINAL_MESSAGE_ID]||e[a.default.HEADERS.MESSAGE_ID]||null;i&&(t[i]=n)}},t.getMessageResultFromCache=function(e,t){return e&&t[e[a.default.HEADERS.ORIGINAL_MESSAGE_ID]||e[a.default.HEADERS.MESSAGE_ID]||null]||null},t.isEncodedMessage=function(e){return e&&e.hasOwnProperty(a.default.HEADERS.CONTENT_ENCODING)},t.isMessageEncodingSupported=function(e){return e&&a.default.KNOWN_PAYLOAD_ENCODINGS.hasOwnProperty(e[a.default.HEADERS.CONTENT_ENCODING].toUpperCase())},t.parseRawHttpMessage=function(e){for(var t=e.split(/\r?\n\r?\n/),n=t[0].split(/\r?\n/),r=t[1].split(/\r?\n/),o=n.shift().split(" "),a=o[0],s=o[1]||"",c={},l=0,u=n;l<u.length;l++){var d=u[l];try{var p=d.split(":").map(function(e){return i.trim(e)}),f=p[0],h=p[1];c[f]=h}catch(e){throw new Error("Malformed header: "+(d+e))}}return{url:s,headers:c,method:a,body:r.join("")}},t.decodeMessage=function(e){var t=atob(e);return r.inflate(t,{to:"string"})},t.defer=function(){var e,t,n=!0;return{isPending:function(){return n},promise:new Promise(function(n,i){e=n,t=i}),resolve:function(t){n&&(e(t),n=!1)},reject:function(e){n&&(t(e),n=!1)}}},t.isTrouterAndNavigatorConnected=function(e){var t=!1;try{if(t=e&&e.state()===s.TrouterState.Connected,navigator.onLine&&t)return 3;if(!navigator.onLine&&t)return 2;if(navigator.onLine&&!t)return 1}catch(e){}return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESULT_CATEGORIES={Success:"Success",ExpectedError:"ExpectedError",UnexpectedClientError:"UnexpectedClientError",UnexpectedServerError:"UnexpectedServerError"};var i={INCOMING_MESSAGE_ORIGIN:{TROUTER:"Trouter",BROKER:"Broker"},INVITATION_TYPE:{NUDGE:"nudge"},KNOWN_PAYLOAD_ENCODINGS:{GZIP:!0},WEBRTC_NOTIFICATION_TYPE:{CONTROL_VIDEO_STREAMING:"ControlVideoStreaming",DOMINANT_SPEAKER_INFO:"DominantSpeakerInfo",CSRC_INFO:"CsrcInfo"},PARTICIPANT_AUDIO_STATE:{CONNECTING:"Connecting",RINGING:"Ringing",CONNECTED:"Connected",OTHER:"Other"},HEADERS:{MESSAGE_ID:"X-Microsoft-Skype-Message-ID",ORIGINAL_MESSAGE_ID:"X-Microsoft-Skype-Original-Message-ID",CONTENT_ENCODING:"X-Microsoft-Skype-Content-Encoding",CORRELATION_ID:"X-Microsoft-Skype-Chain-ID",CONTENT_SHARING_CORRELATION_ID:"X-Microsoft-Skype-ContentSharing-Chain-ID",CLIENT_USER_AGENT:"X-Microsoft-Skype-Client",SKYPE_TOKEN:"X-Skypetoken",CACHE_SKYPE_TOKEN:"X-CacheSkypeToken",BROKER_USE_BATCHING_HEADER_NAME:"X-UseBatching",PARTICIPANT_ID:"X-Microsoft-Skype-Participant-ID",CONTENT_TYPE:"Content-Type",RING:"MS-Teams-Ring",REGION:"MS-Teams-Region",PARTITION:"MS-Teams-Partition"},KNOWN_BOTS:{VOICEMAIL_BOT_ID:"28:14524421-25b4-403a-a0f7-e62d4379cabc"},HTTP_STACK_ERROR:{NONE:0,CANNOT_CONNECT:7,REQUEST_TIMEOUT:10,ATTEMPT_TIMEOUT:30,REQUEST_ABORTED:16,ATTEMPT_ABORTED:31,ABORTED_OTHER_ATTEMPT_SUCCESSFUL:32},HTTP_STATUS_CODES:{UNKNOWN:0,OK:200,CREATED:201,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,FORBIDDEN:403,PRECONDITION_FAILED:412,UNPROCESSABLE_ENTITY:422,NETWORK_ERROR:490,SKYPE_TOKEN_ERROR:495,OFFLINE:496,TIMEOUT:498,ABORTED:498,OTHER:499,INTERNAL_SERVER_ERROR:500,CONFLICT:409,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504},CALL_END_SKYPE_TOKEN_ERROR:{code:495,subCode:4507,phrase:"CallEndReasonSkypeTokenFetchError",resultCategories:[t.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_LOCAL_HTTP_STACK_ERROR:{code:496,subCode:4520,phrase:"LocalHTTPStackError",resultCategories:[t.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_UNKNOWN_ERROR:{code:497,subCode:4502,phrase:"CallEndReasonUnknownError",resultCategories:[t.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_NETWORK_ERROR:{code:490,subCode:4502,phrase:"CallEndReasonNetworkError",resultCategories:[t.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_LOCAL_DECLINE:{code:486,subCode:4508,phrase:"LocalDecline",resultCategories:[t.RESULT_CATEGORIES.Success]},RESOURCE_NOT_FOUND_ERROR:{code:404,subCode:404,phrase:"ResourceNotFound",resultCategories:[t.RESULT_CATEGORIES.ExpectedError]},CALL_STATUS:{IDLE:"Idle",RINGING:"Ringing",CONNECTING:"Connecting",CONNECTED:"Connected",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly",LOCAL_TERMINATED:"LocalTerminated",REMOTE_TERMINATED:"RemoteTerminated"},MEDIA_TYPES:{AUDIO:"Audio",VIDEO:"Video",SCREEN_SHARER:"ScreenSharer",SCREEN_VIEWER:"ScreenViewer"},MUTE_SCOPE:{MYSELF:"Myself",EVERYONE_ELSE:"EveryoneElse",SPECIFIED_PARTICIPANTS:"SpecifiedParticipants"},URL_BASE:{CALLAGENT:"callAgent"},LINKS:{HANGUP:"hangup",MEDIA_REJECTION:"mediaRejection",MEDIA_ANSWER:"mediaAnswer",MEDIA_RENEGOTIATION:"mediaRenegotiation",ACCEPT:"accept",ATTACH:"attach",REJECT:"reject",REDIRECT:"redirect",REPLACE:"replace",TRANSFER:"transfer",NEW_OFFER:"newOffer",TRANSFER_ACCEPTANCE:"transferAcceptance",TRANSFER_COMPLETION:"transferCompletion",CONVERSATION_CONTROLLER:"conversationController",ADD_PARTICIPANT:"addParticipant",ADD_PARTICIPANTS_AND_MODALITY:"addParticipantsAndModality",LEAVE:"leave",NOTIFICATION_LINKS:"notificationLinks",REMOVE_PARTICIPANT:"removeParticipant",KEEPALIVE:"keepAlive",ADD_MODALITY:"AddModality",REMOVE_MODALITY:"RemoveModality",CONTENT_SHARING_CONTROLLER:"contentSharingController",CONTENT_SHARING_TAKE_CONTROL:"contentSharingTakeControl",CONTENT_SHARING_UPDATE_SESSION_STATE:"contentSharingUpdateSessionState",CONTENT_SHARING_UPDATE_PARTICIPANT_STATE:"contentSharingUpdateParticipantState",CONTENT_SHARING_NOTIFICATION_LINKS:"contentSharingNotificationLinks",CONTENT_SHARING_LEAVE:"contentSharingLeave",MUTE:"mute",UNMUTE:"unmute",ADMIT:"admit",ADMIT_ALL:"admitAll",CONTROL_VIDEO_STREAMING:"controlVideoStreaming",APPLY_CHANNEL_PARAMETERS:"applyChannelParameters",UPDATE_ENDPOINT_STATE:"updateEndpointState",UPDATE_ENDPOINT_METADATA:"updateEndpointMetadata",LMC_NOTIFICATION_LINKS:"lmcNotificationLinks",UPDATE_PARTICIPANT_ROLE:"updateParticipantRole",PUBLISH_STATE:"publishState",REMOVE_STATE:"removeState",UPDATE_MEETING_SETTINGS:"updateMeetingSettings",SEARCH_PARTICIPANTS:"searchParticipants",GET_ALL_PARTICIPANTS:"getAllParticipants",PARK:"park",UNPARK:"unpark"},CONTENT_TYPE:{JSON:"application/json",SDP:"application/sdp"},TROUTER_EVENT_TYPE:{SKYPE_SKYPE_CALL:107,LYNC_SKYPE_CALL:105},MISC:{CONVERSATION:"conversation",LOBBY_CALL_CONTROLLER:"lobby",LOBBY_PARTICIPANT_STATE:"lobby"},SIGNALING_FSM_STATE:{IDLE:"Idle",INCOMING:"Incoming",WAITING_CALL_ACCEPTANCE_ACK:"WaitingCallAcceptanceAck",OUTGOING:"Outgoing",CONNECTED:"Connected",OUTGOING_FOR_ROSTER_ONLY:"OutgoingForRosterOnly",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly"},MEDIA_RENEGOTIATION_FSM_STATE:{IDLE:"Idle",CALL_CONNECTED:"Connected",INCOMING_RENEGOTIATION:"IncomingRenegotiation",OUTGOING_RENEGOTIATION:"OutgoingRenegotiation",RENEGOTIATION_GLARE:"RenegotiationGlare"},CONTENT_SHARING_FSM_STATE:{IDLE:"Idle",CONTENT_SHARING_START_INITIATED:"ContentSharingStartInitiated",CONTENT_SHARING_JOIN_INITIATED:"ContentSharingJoinInitiated",CONTENT_SHARING_LEAVE_INITIATED:"ContentSharingLeaveInitiated",CONTENT_SHARING_DELETE_INITIATED:"ContentSharingDeleteInitiated",CONTENT_SHARING_CONNECTED:"ContentSharingConnected"},TIMEOUT_OPERATIONS:{ADD_PARTICIPANT:"AddParticipant",NUDGE_PARTICIPANT:"NudgeParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",ADMIT_PARTICIPANT:"AdmitParticipant",ADMIT:"Admit",CALL_ME_BACK:"CallMeBack",INCOMING_CALL_ESTABLISHMENT:"IncomingCallEstablishment",OUTGOING_CALL_ESTABLISHMENT:"OutgoingCallEstablishment",MEDIA_ANSWER:"MediaAnswer",MEDIA_ANSWER_ACKNOWLEDGEMENT:"MediaAnswerAcknowledgement",ADD_MODALITY:"AddModality",UNMUTE:"Unmute",UPDATE_MEETING_ROLE:"UpdateMeetingRole",MAX_PREAHEATED_TIMEOUT:"MaxPreheateadTimeout",PARK_COMPLETION:"ParkCompletion",UNPARK_COMPLETION:"UnparkCompletion"},TIMEOUT_VALUES_IN_SECONDS:{ADD_PARTICIPANT_TIMEOUT:130,REMOVE_PARTICIPANT_TIMEOUT:60,INCOMING_CALL_ESTABLISHMENT_TIMEOUT:75,OUTGOING_CALL_ESTABLISHMENT_TIMEOUT:90,MEDIA_ANSWER_TIMEOUT:35,MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT:15,ADD_MODALITY_TIMEOUT:65,UNMUTE_TIMEOUT:35,ADMIT_PARTICIPANT_TIMEOUT:30,ADMIT_TIMEOUT:60,UPDATE_MEETING_ROLE_TIMEOUT:15,NUDGE_PARTICIPANT_TIMEOUT:60,CALL_ME_BACK_TIMEOUT:120,MAX_PREAHEATED_TIMEOUT:60,PARK_COMPLETION_TIMEOUT:45,UNPARK_COMPLETION_TIMEOUT:45},CALL_END_CODE:{REJECT:603,SUCCESS:0,CANCEL:487,TIMEOUT:408,SERVICE_UNAVAILABLE:500,BAD_REQUEST:406,NO_NGC_ENDPOINT:480,P2P_FALLBACK_FOR_SCREENSHARING:460,CONFLICT:409,MEDIA_ERROR:410,CONF_PARTICIPANT_COUNT_LIMIT_REACHED:413,CALL_DOES_NOT_EXIST:481,CALL_ACCEPTED:450,CALL_FORWARDED:451,CALL_FORWARDED_TO_VOICEMAIL:452,P2P_REJECT_CALL:453,P2P_FALLBACK_DUE_TO_GROUPCALL:461,CALL_LEG_ENDED_ON_SERVICE:470,NOT_ACCEPTABLE_HERE:488,NETWORK_ERROR:490,UNKNOWN_ERROR:497,LOCAL_ERROR:498,CALL_MODALITY_FAILURE:580,ATC_CONTROLLER_FAILURE:581,GLARE_ERROR:491,NOT_FOUND:404,SKYPE_TOKEN_ERROR:495,LOCAL_HTTP_STACK_ERROR:496,HTTP_OTHER_ERROR:499,DECODING_FAILED:407,NOT_AUTHORIZED:403,BAD_SERVICE_RESPONSE:400},CALL_END_SUB_CODE:{SUCCESS:0,MEDIA_DROP_DURING_CONNECT:3100,MEDIA_DROP_AFTER_CONNECT:3101,MEDIA_ANSWER_PROCESSING_ERROR:3102,MEDIA_FINAL_ANSWER_PROCESSING_ERROR:3103,MEDIA_OFFER_TIMEOUT:3104,MEDIA_FINAL_ANSWER_TIMEOUT:3105,MEDIA_OFFER_NULL:3106,MEDIA_AUDIO_DEVICE_ERROR:3107,MEDIA_RENEGOTIATION_ERROR:3108,MEDIA_PERMISSION_ERROR:3109,MEDIA_UNKNOWN_ERROR:3110,MEDIA_OFFER_PROCESSING_ERROR:3111,MEDIA_WHITELISTING_ISSUE:3112,MEDIA_MUTE_MICROPHONE_ERROR:3114,MEDIA_MUTE_SPEAKER_ERROR:3115,MEDIA_UNMUTE_MICROPHONE_ERROR:3116,MEDIA_UNMUTE_SPEAKER_ERROR:3117,MEDIA_GLARE_ERROR:3118,CALL_NOT_ATTEMPTED:4500,CONV_URL_NOT_SET:4501,FAILED_TO_REACH_SERVICE:4502,PLACE_CALL_FAILED:4503,ATTACH_CALL_FAILED:4504,BAD_NOTIFICATION_PAYLOAD:4505,CALL_ESTABLISHMENT_TIMEOUT:4506,SKYPE_TOKEN_ERROR:4507,CONVERSATION_RESOLUTION_CONFLICT:5704,CALL_PARTICIPANT_REMOVAL_TIMEOUT:4507,UNMUTE_REQUEST_TIMEOUT:4509,UNMUTE_REQUEST_REJECTED:4510,CONFLICT_IN_NG:4090,CONFLICT_WITH_P2P:4091,CONVERSATION_END_RECEIVED_FROM_SERVICE:4100,TRANSFER_COMPLETE_TIMEOUT:4101,ATTACH_TO_NON_EXISTENT_CALL:4102,ATTACH_ACTION_FAILED:4103,ATTACH_FAILED:4105,CONVERSATION_ESTABLISHMENT_FAILED:4106,BEFORE_CONNECT:4107,AFTER_CONNECT:4108,AFTER_ACCEPT:4109,TROUTER_CONNECTION_DROPPED:4111,DUE_TO_CALL_ASSIMILATION:4112,PREHEATED_CALL_TIMEDOUT:4113,UNPARK_COMPLETION_TIMEOUT:4114,PARK_COMPLETION_TIMEOUT:4115,LOCAL_HTTP_STACK_ERROR:4520,BEACON:4521,CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:5014,UNABLE_TO_GENERATE_MEETUP_ID:5015,UPDATE_MEETING_ROLE_REJECTED:5651,UPDATE_MEETING_ROLE_TIMEOUT:5652,PUBLISH_STATE_LINK_MISSING:5653,PUBLISH_STATE_INVALID_CONTENT:5654,PUBLISH_STATE_INVALID_SERVICE_RESPONSE:5655,REMOVE_STATE_LINK_MISSING:5656,REMOVE_STATE_MISSING_ARGUMENTS:5657,UPDATE_MEETING_SETTINGS_LINK_MISSING:5658,UPDATE_MEETING_SETTINGS_MISSING_ARGUMENTS:5659,ADMIT_ALL_LINK_MISSING:5660,ADMIT_TIMEOUT:5661,CALL_ACCEPTANCE_INVALID_SERVICE_RESPONSE:5670,ROSTER_HANDLING_INVALID_SERVICE_RESPONSE:5671,SEARCH_PARTICIPANTS_LINK_MISSING:5672,SEARCH_PARTICIPANTS_INVALID_SERVICE_RESPONSE:5673,GET_ALL_PARTICIPANTS_LINK_MISSING:5674,GET_ALL_PARTICIPANTS_INVALID_SCOPE:5675,GET_ALL_PARTICIPANTS_INVALID_SERVICE_RESPONSE:5676,PARK_UNPARK_TYPE_MISSING:5680,PARK_UNPARK_V2_DISABLED:5682,CALL_ENDED_BY_PLATFORM_AGENT:7e3},CALL_END_PHRASE:{UNKNOWN:"CallEndReasonUnknown",MEDIA_ERROR:"CallEndReasonMediaError",MEDIA_OFFER_TIMEOUT:"CallEndReasonMediaOfferTimeout",MEDIA_FINAL_ANSWER_TIMEOUT:"CallEndReasonMediaFinalAnswerTimeout",MEDIA_ANSWER_ERROR:"CallEndReasonMediaAnswerError",MEDIA_FINAL_ANSWER_ERROR:"CallEndReasonFinalAnswerError",MEDIA_PERMISSION_ERROR:"CallEndReasonMediaPermissionError",MEDIA_RENEGOTIATION_ERROR:"CallEndReasonRenegotiationError",MEDIA_DROP_DURING_CONNECT:"CallEndReasonMediaDropDuringConnectError",MEDIA_DROP_AFTER_CONNECT:"CallEndReasonMediaDropAfterConnectError",MEDIA_OFFER_PROCESSING_ERROR:"CallEndReasonMediaOfferProcessingError",MEDIA_WHITELISTING_ISSUE:"MediaWhitelistingIssue",AUDIO_ERROR:"CallEndReasonAudioDeviceError",BAD_NOTIFICATION_PAYLOAD:"BadCallNotificationPayload",NETWORK_ERROR:"CallEndReasonNetworkError",LOCAL_USER_INITIATED:"CallEndReasonLocalUserInitiated",REMOTE_USER_INITIATED:"CallEndReasonRemoteUserInitiated",ESTABLISHMENT_TIMEOUT:"CallEndReasonEstablishmentTimeout",PARTICIPANT_REMOVAL_TIMEOUT:"CallParticipantRemovalTimeout",LOCAL_ERROR:"CallEndReasonLocalError",CALL_UPDATE_ERROR:"CallEndReasonCallUpdateError",P2P_FORK_CONNECTED:"CallEndReasonP2pForkConnected",P2P_FORK_FORWARDED:"CallEndReasonP2pForkForwarded",P2P_FORK_FORWARDED_TO_VOICEMAIL:"CallEndReasonP2pForkForwardedToVoiceMail",P2P_FALLBACK_FOR_SCREENSHARING:"CallEndReasonP2pFallbackForScreensharing",P2P_FALLBACK_FOR_GROUPCALL:"CallEndReasonP2pFallbackForGroupCall",P2P_FALLBACK_FOR_CALL_ASSIMILATION:"CallEndReasonP2pFallbackForCallAssimilation",P2P_FALLBACK_FOR_TRANSLATION:"CallEndReasonP2pFallbackForCallTranslation",P2P_FORK_REJECTED:"CallEndReasonP2pForkRejected",TROUTER_CONNECTION_DROPPED:"CallEndReasonTrouterConnectionDropped",REMOVED_FROM_CALL:"CallEndReasonRemovedFromCall",TRANSFER_COMPLETION_TIMEOUT:"CallEndReasonTransferCompletionTimeout",CALL_DOES_NOT_EXIST:"CallEndReasonCallDoesNotExist",ATTACH_ACTION_FAILED:"CallEndReasonAttachActionFailed",ATTACH_FAILED:"CallEndReasonAttachFailed",CONVERSATION_ESTABLISHMENT_FAILED:"CallEndReasonConversationEstablishmentFailed",CONV_END_FROM_SERVICE:"CallEndReasonConversationEndReceivedFromService",CONV_END_FROM_SERVICE_WITH_ERROR:"CallEndReasonConversationEndReceivedFromServiceWithError",SERVICE_ERROR:"CallEndReasonServiceError",CONFLICT:"CallEndReasonConflict",CALL_ALREADY_IN_P2P:"CallEndReasonCallAlreadyExistsInP2p",CONV_END_NO_MODALITY:"ConversationEndNoModalityConnected",CONV_END_FOR_ALL_INITIATED:"ConversationEndForAllInitiated",RENEGOTIATION_IN_PROGRESS:"NegotiationIsInProgress",ADD_PARTICIPANT_URL_MISSING:"AddParticipantUrlMissing",ADMIT_PARTICIPANT_URL_MISSING:"AdmitParticipantUrlMissing",ADMIT_ALL_URL_MISSING:"AdmitAllUrlMissing",ADMIT_TIMEOUT:"AdmitTimeout",UNABLE_TO_GENERATE_MEETUP_ID:"Unable to generate GroupChat meetup id.",ENDED_BY_PMA:"Call ended by media agent.",OWNERSHIP_RESOLUTION_CONFLICT:"Conversation cannot be created due to a failure to resolve ownership.",CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:"This conversation has ended since we were unable to determine a potential host for the group call.",UNMUTE_REQUEST_TIMEOUT:"UnmuteRequestTimeout",UNMUTE_REQUEST_REJECTED:"UnmuteRequestRejected",UPDATE_MEETING_ROLE_TIMEOUT:"UpdateMeetingRoleTimeout",UPDATE_MEETING_ROLE_REJECTED:"Update meeting role operation failed due to insufficient privileges.",PARK_REQUEST_FAILED:"Park Request Failed",PARK_COMPLETION_TIMEOUT:"ParkCompletionTimeout",PARK_COMPLETION_FAILED:"ParkCompletionFailed",UNPARK_REQUEST_FAILED:"UnparkFailed",UNPARK_COMPLETION_TIMEOUT:"UnparkCompletionTimeout",UNPARK_COMPLETION_FAILED:"UnparkCompletionFailed",BAD_SERVICE_RESPONSE:"BadServiceResponse"},TRANSACTION_END_CODE:{SUCCESS:0},URL_DEFAULTS:{UPLOAD_LOG_URL:"https://api.cc.skype.com/cc/v1/uploadlog/"}};t.REQUEST_DISPATCHER_RESPONSE={REQUEST_TIMEOUT:{status:i.HTTP_STATUS_CODES.TIMEOUT,statusText:"Request timed out",readyState:0,response:i.HTTP_STACK_ERROR.REQUEST_TIMEOUT},ATTEMPT_TIMEOUT:{status:i.HTTP_STATUS_CODES.TIMEOUT,statusText:"Attempt timed out",readyState:0,response:i.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT},REQUEST_ABORTED:{status:i.HTTP_STATUS_CODES.ABORTED,statusText:"Request Aborted",readyState:0,response:i.HTTP_STACK_ERROR.REQUEST_ABORTED},ATTEMPT_ABORTED:{status:i.HTTP_STATUS_CODES.ABORTED,statusText:"Attempt Aborted",readyState:0,response:i.HTTP_STACK_ERROR.ATTEMPT_ABORTED}},t.URL_PATH={MEDIA_ACKNOWLEDGEMENT:"/call/mediaAcknowledgement/",MEDIA_REJECTION:"/call/rejection/",ACKNOWLEDGEMENT:"/call/acknowledgement/",MEDIA_RENEGOTIATION:"/call/mediaRenegotiation/",REPLACE:"/call/replacement/",PROGRESS:"/call/progress/",MEDIA_ANSWER:"/call/mediaAnswer/",NEW_MEDIA_OFFER:"/call/newMediaOffer/",REDIRECTION:"/call/redirection/",BALANCE_UPDATE:"/call/balanceUpdate/",ACCEPT:"/call/acceptance/",CONTROL_VIDEO_STREAMING:"/call/controlVideoStreaming/",DOMINANT_SPEAKER_INFO:"/call/dominantSpeakerInfo/",CSRC_INFO:"/call/csrcInfo/",END:"/call/end/",RETARGET_COMPLETION:"/call/retargetCompletion/",TRANSFER:"/call/transfer/",TRANSFER_ACCEPTANCE:"/call/transferAcceptance/",TRANSFER_COMPLETION:"/call/transferCompletion/",PARK_COMPLETION:"/call/holdCompletion/",UNPARK_COMPLETION:"/call/resumeCompletion/",CONV_END:"/conversation/end/",CONV_UPDATE:"/conversation/update/",CONV_ROSTER_UPDATE:"/conversation/rosterUpdate/",CONV_ADD_PARTICIPANT_SUCCESS:"/conversation/addParticipantSuccess/",CONV_ADD_PARTICIPANT_FAILURE:"/conversation/addParticipantFailure/",CONV_NUDGE_PARTICIPANT_SUCCESS:"/conversation/nudgeParticipantSuccess/",CONV_NUDGE_PARTICIPANT_FAILURE:"/conversation/nudgeParticipantFailure/",CONV_ADMIT_PARTICIPANT_SUCCESS:"/conversation/admitParticipantSuccess/",CONV_ADMIT_PARTICIPANT_FAILURE:"/conversation/admitParticipantFailure/",CONV_ADMIT_ALL_STATUS:"/conversation/admitAllStatus/",CONV_REMOVE_PARTICIPANT_SUCCESS:"/conversation/removeParticipantSuccess/",CONV_REMOVE_PARTICIPANT_FAILURE:"/conversation/removeParticipantFailure/",CONV_ADD_MODALITY_SUCCESS:"/conversation/addModalitySuccess/",CONV_ADD_MODALITY_FAILURE:"/conversation/addModalityFailure/",CONV_CONTENT_SHARING_UPDATE:"/conversation/contentSharingUpdate/",CONV_CONTENT_SHARING_END:"/conversation/contentSharingEnd/",CONV_BROADCAST_UPDATE:"/conversation/broadcastUpdate/",CONV_CONFIRM_UNMUTE:"/conversation/confirmUnmute/",CONV_UNMUTE_SUCCESS:"/conversation/unmuteSuccess/",CONV_UNMUTE_FAILURE:"/conversation/unmuteFailure/",LWJ_END:"/lwj/end/",LWJ_ACCEPTANCE:"/lwj/acceptance/"},t.PAYLOAD_PROPERTY={CALL_NOTIFICATION:"callNotification",MEDIA_ANSWER:"mediaAnswer",MEDIA_ACKNOWLEDGEMENT:"mediaAcknowledgement",CALL_ACCEPTANCE:"callAcceptance",CALL_END:"callEnd",CALL_PROGRESS:"callProgress",CALL_ACCEPTANCE_ACKNOWLEDGEMENT:"callAcceptanceAcknowledgement",MEDIA_NEGOTIATION:"mediaNegotiation",MEDIA_NEGOTIATION_FAILURE:"mediaNegotiationFailure",BALANCE_UPDATE:"balanceUpdate",RETARGET_COMPLETED:"retargetCompleted",CALL_TRANSFER:"callTransfer",TRANSFER_COMPLETION:"transferCompletion",TRANSFER_ACCEPTANCE:"transferAcceptance",PARK_COMPLETION:"holdCompletion",UNPARK_COMPLETION:"resumeCompletion"},t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0);t.get=function(e,t,n){return void 0===n&&(n=r.causeId()),r.assertNotNullOrEmpty(t,"trailingPath cannot be null"),r.assertNotNull(e,"signalingSession cannot be null"),r.assertNotNull(e.baseMessagingChannelUrl,"messaging channel url is not set"),""+e.baseMessagingChannelUrl+i.default.URL_BASE.CALLAGENT+"/"+e.sessionId+"/"+n+t},t.getIdFromUrl=function(e){var t=e.match(new RegExp("/"+r.escapeRegExp(i.default.URL_BASE.CALLAGENT)+"/+([^/]+)","i"));return t?t[1]:null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","phrase","subCode","reason"];t.getPIISafeObject=function(e){try{return JSON.parse(JSON.stringify(e,i,4))}catch(e){return{error:"failed to parse object"}}},t.getPrintableObject=function(e,t){if(void 0===t&&(t=!1),void 0===e)return"void";if(e instanceof Error)return e.toString();if(e instanceof String||e instanceof Number||e instanceof Boolean)return e.toString();try{return e.stack&&(e.stack=function(e){try{return e.split("\n")[0]}catch(e){return"invalid stack"}}(e.stack)),(t?JSON.stringify(e):JSON.stringify(e,i,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(t){return"failed to get error information:"+(e&&"function"==typeof e.toString&&e.toString())+" "+(e&&e.response&&JSON.stringify(e.response))}},t.safeJsonStringify=function(e){try{return JSON.stringify(e,null,2)}catch(e){return"failed to stringify obj"}},t.truncate=function(e,t){try{return e.substring(0,length)}catch(t){return e}}},function(e,t,n){"use strict";var i=n(20),r=Object.prototype.toString;function o(e){return"[object Array]"===r.call(e)}function a(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function c(e){return"[object Function]"===r.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:a,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function n(n,i){"object"==typeof t[i]&&"object"==typeof n?t[i]=e(t[i],n):t[i]=n}for(var i=0,r=arguments.length;i<r;i++)l(arguments[i],n);return t},deepMerge:function e(){var t={};function n(n,i){"object"==typeof t[i]&&"object"==typeof n?t[i]=e(t[i],n):t[i]="object"==typeof n?e({},n):n}for(var i=0,r=arguments.length;i<r;i++)l(arguments[i],n);return t},extend:function(e,t,n){return l(t,function(t,r){e[r]=n&&"function"==typeof t?i(t,n):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EVENTS={HANDLE_MEDIA_ACKNOWLEDGEMENT:"HandleMediaAcknowledgement",HANDLE_MEDIA_NEGOTIATION_FAILURE:"HandleMediaNegotiationFailure",HANDLE_MEDIA_ANSWER:"HandleMediaAnswer",HANDLE_MEDIA_ANSWER_FAILED:"HandleMediaAnswerFailed",HANDLE_MEDIA_OFFER:"HandleMediaOffer",REJECT_RENEGOTIATION:"RejectRenegotiation",HANDLE_RETARGET_COMPLETED:"HandleRetargetCompleted",HANDLE_MEDIA_ANSWER_TIMEOUT:"HandleMediaAnswerTimeout",HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT:"HandleMediaAcknowledgementTimeout",ACCEPT_RENEGOTIATION:"AcceptRenegotiation",START_RENEGOTIATION:"StartRenegotiation",MEDIA_FSM_STATE_CHANGED:"MediaFsmStateChanged",ADD_MODALITY_TIMEOUT:"AddModalityTimeout",ADD_PARTICIPANT:"AddParticipant",ADD_PARTICIPANT_TIMEOUT:"AddParticipantTimeout",ADD_PARTICIPANT_WITH_REPLACES:"AddParticipantWithReplaces",ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT:"AddParticipantWithReplacesTimeout",ADD_PARTICIPANTS_AND_MODALITY:"AddParticipantsAndModality",ADMIT_PARTICIPANT:"AdmitParticipant",ADMIT_PARTICIPANT_TIMEOUT:"AdmitParticipantTimeout",ADMIT:"Admit",ADMIT_TIMEOUT:"AdmitTimeout",ADMIT_FAILURE:"AdmitFailure",ADMIT_SUCCESS:"AdmitSuccess",CALL_ME_BACK:"CallMeBack",CALL_ME_BACK_TIMEOUT:"CallMeBackTimeout",REMOVE_PARTICIPANT:"RemoveParticipant",REMOVE_PARTICIPANT_OTHERS:"RemoveParticipantOthers",REMOVE_PARTICIPANT_SPECIFIED:"RemoveParticipantSpecified",REMOVE_PARTICIPANT_TIMEOUT:"RemoveParticipantTimeout",HANDLE_ADD_PARTICIPANT_SUCCESS:"HandleAddParticipantSuccess",HANDLE_ADD_PARTICIPANT_FAILURE:"HandleAddParticipantFailure",HANDLE_ADMIT_PARTICIPANT_SUCCESS:"HandleAdmitParticipantSuccess",HANDLE_ADMIT_PARTICIPANT_FAILURE:"HandleAdmitParticipantFailure",HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE:"HandleAddParticipantModalityFailure",HANDLE_REMOVE_PARTICIPANT_SUCCESS:"HandleRemoveParticipantSuccess",HANDLE_REMOVE_PARTICIPANT_FAILURE:"HandleRemoveParticipantFailure",HANDLE_ROSTER_UPDATE:"HandleRosterUpdate",HANDLE_ROSTER_UPDATE_FAIL:"HandleRosterUpdateFail",HANDLE_CONVERSATION_UPDATE:"HandleConversationUpdate",SET_SUBJECT:"SetSubject",SET_DEVICETYPE:"SetDeviceType",GET_MEETING_INFO:"GetMeetingInfo",GET_EMERGENCY_CONTENT:"GetEmergencyContent",SET_MULTIPARTY:"SetMultiparty",SET_THREADID:"SetThreadId",SET_CALLOPTIONS:"SetCallOptions",SET_TRANSFER_CONTEXT:"SetTransferContext",START_CALL:"StartCall",JOIN_CALL:"JoinCall",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",HANDLE_INCOMING_CALL:"HandleIncomingCall",END_CALL:"EndCall",END_WITH_BEACON:"EndWithBeacon",CONFLICTED_CALL:"ConflictedCall",SET_PROVISIONAL_ANSWER:"SetProvisionalAnswer",SET_PROVISIONAL_ANSWER_FAILED:"SetProvisionalAnswerFailed",ACCEPT_CALL:"AcceptCall",ACCEPT_CALL_FAILED:"AcceptCallFailed",HANDLE_CALL_ACCEPTANCE_ACK:"HandleCallAcceptanceAck",HANDLE_CALL_ACCEPTANCE:"HandleCallAcceptance",HANDLE_CALL_ACCEPTANCE_SYNC:"HandleCallAcceptanceSync",HANDLE_CALL_ACCEPTANCE_FAILED:"HandleCallAcceptanceFailed",HANDLE_CALL_ESTABLISHMENT_TIMEOUT:"HandleCallEstablishmentTimeout",HANDLE_CALL_END:"HandleCallEnd",HANDLE_CALL_PROGRESS:"HandleCallProgress",HANDLE_LWJ_ACCEPTANCE:"HandleLwjAcceptance",HANDLE_LWJ_END:"HandleLwjEnd",TROUTER_URL_CHANGED:"TrouterUrlChanged",TROUTER_STATE_CHANGED:"TrouterStateChanged",TROUTER_URL_CHANGED_TO_INVALID:"TrouterUrlChangedToInvalid",TROUTER_URL_UPDATE_FAILED:"TrouterUrlUpdateFailed",ADD_CONTENT_SHARING_MODALITY:"AddContentSharingModality",ACCEPTED_BEFORE_RINGING:"AcceptedBeforeRinging",LEAVE_CONTENT_SHARING:"LeaveContentSharing",DELETE_CONTENT_SHARING:"DeleteContentSharing",TAKE_CONTROL_CONTENT_SHARING:"TakeControlContentSharing",UPDATE_SESSION_STATE_CONTENT_SHARING:"UpdateSessionStateContentSharing",JOIN_CONTENT_SHARING:"JoinContentSharing",UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:"UpdateParticipantStateContentSharing",HANDLE_CONTENT_SHARING_UPDATE:"HandleContentSharingUpdate",HANDLE_CONTENT_SHARING_END:"HandleContentSharingEnd",CONTENT_SHARING_START_FROM_ROSTER:"ContentSharingStartFromRoster",CONTENT_SHARING_END_FROM_ROSTER:"ContentSharingEndFromRoster",HANDLE_ADD_MODALITY_SUCCESS:"HandleAddModalitySuccess",HANDLE_ADD_MODALITY_FAILURE:"HandleAddModalityFailure",UPDATE_BROADCAST_DETAILS:"UpdateBroadcastDetails",MUTE:"Mute",NUDGE_PARTICIPANT_TIMEOUT:"NudgeParticipantTimeout",UNMUTE:"Unmute",UNMUTE_TIMEOUT:"UnmuteTimeout",HANDLE_UNMUTE_CONFIRM:"HandleUnmuteConfirm",HANDLE_UNMUTE_SUCCESS:"HandleUnmuteSuccess",HANDLE_UNMUTE_FAILURE:"HandleUnmuteFailure",APPROVE_UNMUTE:"ApproveUnmute",REJECT_UNMUTE:"RejectUnmute",HANDLE_CONTROL_VIDEO_STREAMING:"HandleControlVideoStreaming",HANDLE_DOMINANT_SPEAKER_INFO:"HandleDominantSpeakerInfo",HANDLE_CSRC_INFO:"HandleCsrcInfo",SEND_WEBRTC_MEDIA_NOTIFICATION:"SendWebRtcMediaNotification",HANDLE_BALANCE_UPDATE:"HandleBalanceUpdate",TRANSFER_CALL:"TransferCall",PARK_CALL:"ParkCall",TRANSFER_COMPLETION_FAILED:"TransferCompletionFailed",TRANSFER_REQUEST_RECEIVED:"TransferRequestReceived",HANDLE_PARK_REQUESTED:"HandleParkRequested",HANDLE_SERVER_HOLD:"HandleServerHold",DUPLICATE_MESSAGE_IGNORED:"DuplicateMessageIgnored",CORRELATION_ID_UPDATED:"CorrelationIdUpdated",UNKNOWN_MESSAGE_TYPE:"UnkownMessageType",FAILED_TO_HANDLE_MESSAGE:"FailedToHandleMessage",CONNECTIVITY_CHANGED:"ConnectivityChanged",TROUTER_DECODE_PAYLOAD_FAILURE:"TrouterDecodePayloadFailure",UPDATE_ENDPOINT_STATE:"UpdateEndpointState",UPDATE_ENDPOINT_STATE_SUCCESS:"UpdateEndpointStateSuccess",UPDATE_ENDPOINT_STATE_FAILURE:"UpdateEndpointStateFailure",BROKER_DECODE_PAYLOAD_FAILURE:"BrokerDecodePayloadFailure",BROKER_SUBSCRIPTION_TIMEOUT:"BrokerSubscriptionTimeout",BROKER_SUBSCRIPTION_SUCCESSFUL:"BrokerSubscriptionSuccessful",BROKER_SUBSCRIPTION_FAILED:"BrokerSubscriptionFailed",FAILED_TO_HANDLE_TROUTER_MESSAGE:"FailedToHandleTrouterMessage",FAILED_TO_HANDLE_BROKER_MESSAGE:"FailedToHandleBrokerMessage",BROKER_DISABLED_SUBSCRIBE_URL_PRESENT:"BrokerDisabledSubscribeUrlPresent",CONNECTED:"Connected",IN_LOBBY:"InLobby",MESSAGE_MISSING_BODY:"MessageMissingBody",BROADCAST_STATE_CHANGED:"BroadcastStateChanged",HANDLE_CALL_NOTIFICATION:"HandleCallNotification",HANDLE_INCOMING_CALL_REPLACEMENT:"HandleIncomingCallReplacement",HANDLE_PSTN_BALANCE_UPDATE:"HandlePstnBalanceUpdate",IGNORE_OLD_ROSTER:"IgnoreOldRoster",HANDLE_MEDIA_ACK:"HandleMediaAck",HANDLE_MEDIA_PROVISIONAL_ACK:"HandleMediaProvisionalAck",UPDATE_CALL_STATUS:"UpdateCallStatus",SEND_ATTACH:"SendAttach",REQUEST_NEW_OFFER:"RequestNewOffer",HANDLE_NEW_OFFER:"HandleNewOffer",UPDATE_CONVERSATION_LINKS:"UpdateConversationLinks",UPDATE_CONVERSATION_LINKS_SUCCESS:"UpdateConversationLinksSuccess",UPDATE_CONVERSATION_LINKS_FAILED:"UpdateConversationLinksFailed",UPDATE_LWJ_LINKS:"UpdateLwjLinks",UPDATE_LWJ_LINKS_SUCCESS:"UpdateLwjLinksSuccess",UPDATE_LWJ_LINKS_FAILED:"UpdateLwjLinksFailed",PROCESS_INITIAL_OFFER:"ProcessInitialOffer",SEND_PROGRESS:"SendProgress",SEND_PROGRESS_FAILED:"SendProgressFailed",PROCESS_CALL_ACCEPTANCE:"ProcessCallAcceptance",PROCESS_LWJ_ACCEPTANCE:"ProcessLwjAcceptance",ACCEPTANCE_USER_IN_LOBBY:"AcceptanceUserInLobby",REJECT_INCOMING_CALL:"RejectIncomingCall",SEND_KEEP_ALIVE:"SendKeepAlive",SEND_KEEP_ALIVE_FAILED:"SendKeepAliveFailed",START_AUDIO:"StartAudio",STOP_AUDIO:"StopAudio",UPDATE_MEETING_ROLE:"UpdateMeetingRole",UPDATE_MEETING_ROLE_TIMEOUT:"UpdateMeetingRoleTimeout",PREHEAT_ENABLING:"EnablingPreheat",PREHEAT_DISABLING:"DisablingPreheat",PREHEAT_DISABLED:"PreheatDisabled",TRANSFER_REQUEST_SENT:"TransferRequestSent",TRANSFER_REQUEST_FAILED:"TransferRequestFailed",SEND_ACCEPT_TRANSFER:"SendAcceptTransfer",SEND_ACCEPT_TRANSFER_FAIL:"SendAcceptTransferFail",WAITING_FOR_TRANSFER_COMPLETION:"WaitingForTransferCompletion",WAITING_FOR_TRANSFER_COMPLETION_FAIL:"WaitingForTransferCompletionFail",WAITING_FOR_TRANSFER_ACCEPTANCE_FAIL:"WaitingForTransferAcceptanceFail",WAITING_FOR_TRANSFER_ACCEPTANCE:"WaitingForTransferAcceptance",TRANSFER_COMPLETED:"TransferCompleted",SEND_COMPLETE_TRANSFER:"SendCompleteTransfer",SEND_COMPLETE_TRANSFER_FAILED:"SendCompleteTransferFailed",PICKUP_CODE_SET:"PickupCodeSet",ADD_PARTICIPANT_WITH_PICKUP_CODE:"AddParticipantWithPickupCode",ADD_PARTICIPANT_WITH_PICKUP_CODE_TIMEOUT:"AddParticipantWithPickupCodeTimeout",PUBLISH_STATE:"PublishState",PUBLISH_STATE_FAILURE:"PublishStateFailure",REMOVE_STATE:"RemoveState",REMOVE_STATE_FAILURE:"RemoveStateFailure",UPDATE_MEETING_SETTINGS:"UpdateMeetingSettings",UPDATE_MEETING_SETTINGS_FAILURE:"UpdateMeetingSettingsFailure",UPDATE_ENDPOINT_METADATA_SUCCESS:"UpdateEndpointMetadataSuccess",UPDATE_ENDPOINT_METADATA_FAILURE:"UpdateEndpointMetadataFailure",SEARCH_PARTICIPANTS:"SearchParticipants",GET_ALL_PARTICIPANTS:"GetAllParticipants",SEARCH_PARTICIPANTS_FAILURE:"SearchParticipantsFailure",GET_ALL_PARTICIPANTS_FAILURE:"GetAllParticipantsFailure",PARK_REQUEST:"SendParkRequest",PARK_REQUEST_FAILED:"ParkRequestFailed",WAITING_FOR_PARK_COMPLETION:"WaitingForParkCompletion",WAITING_FOR_PARK_COMPLETION_TIMEOUT:"WaitingForParkCompletionTimeout",PARK_COMPLETED:"ParkCompleted",PARK_FAILED:"ParkFailed",SEND_UNPARK_REQUEST:"SendUnparkRequest",UNPARK_REQUEST_FAILED:"UnparkRequestFailed",WAITING_FOR_UNPARK_COMPLETION:"WaitingForUnparkCompletion",WAITING_FOR_UNPARK_COMPLETION_TIMEOUT:"WaitingForUnparkCompletionTimeout",UNPARK_COMPLETED:"UnparkCompleted",UNPARK_FAILED:"UnparkFailed"},t.NETWORK_REQUESTS={SEND_MEDIA_ANSWER:"SendMediaAnswer",START_RENEGOTIATION:"StartRenegotiation",SEND_MEDIA_ACKNOWLEDGEMENT:"SendMediaAcknowledgement",SEND_MEDIA_REJECTION:"SendMediaRejection",ADD_PARTICIPANT:"AddParticipant",ADD_PARTICIPANT_WITH_REPLACES:"AddParticipantWithReplaces",NUDGE_PARTICIPANT:"NudgeParticipant",REMOVE_PARTICIPANT_NONE:"RemoveParticipant",REMOVE_PARTICIPANT_OTHERS:"RemoveParticipantOthers",REMOVE_PARTICIPANT_SPECIFIED:"RemoveParticipantSpecified",ADMIT_PARTICIPANT:"AdmitParticipant",ADMIT:"Admit",BROKER_SUBSCRIBE:"BrokerSubscribe",CALL_ME_BACK:"CallMeBack",SEND_ACCEPTANCE:"SendAcceptance",SEND_ACCEPTANCE_ACKNOWLEDGEMENT:"SendAcceptanceAcknowledgement",END_CALL:"EndCall",CANCEL_CALL:"CancelCall",REJECT_CALL:"RejectCall",JOIN_CONVERSATION:"JoinConversation",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",LEAVE_CONVERSATION:"LeaveConversation",DELETE_CONVERSATION:"DeleteConversation",START_CALL:"StartCall",PLACE_NUDGE_CALL:"PlaceNudgeCall",UPDATE_CONVERSATION_LINKS:"UpdateConversationLinks",UPDATE_LWJ_LINKS:"UpdateLwjLinks",SEND_CALL_ATTACH:"SendCallAttach",SEND_CALL_PROGRESS:"SendCallProgress",SEND_KEEP_ALIVE:"SendKeepAlive",ADD_CONTENT_SHARING_MODALITY:"AddContentSharingModality",DELETE_CONTENT_SHARING:"DeleteContentSharing",TAKE_CONTROL_CONTENT_SHARING:"TakeControlContentSharing",UPDATE_SESSION_STATE_CONTENT_SHARING:"UpdateSessionStateContentSharing",JOIN_CONTENT_SHARING:"JoinContentSharing",UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:"UpdateParticipantStateContentSharing",UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS:"UpdateContentSharingNotificationLinks",MUTE_ALL:"MuteAll",MUTE_ALL_SYNC:"MuteAllSync",MUTE_SPECIFIED:"MuteSpecified",MUTE_SPECIFIED_SYNC:"MuteSpecifiedSync",MUTE_MYSELF:"MuteMyself",UNMUTE:"Unmute",UNMUTE_SYNC:"UnmuteMyselfSync",SEND_CONTROL_VIDEO_STREAMING:"SendControlVideoStreaming",SEND_APPLY_CHANNEL_PARAMETERS:"SendApplyChannelParameters",APPROVE_UNMUTE:"ApproveUnmute",REJECT_UNMUTE:"RejectUnmute",SEND_TRANSFER_REQUEST:"SendTransferRequest",SEND_PARK_REQUEST:"SendParkRequest",SEND_SHARED_LINE_PARK_REQUEST:"SharedLinePark",SEND_SERVER_HOLD_REQUEST:"ServerHoldRequest",PARK_REQUEST:"ParkRequest",SEND_UNPARK_REQUEST:"UnparkRequest",TRANSFER_ACCEPTANCE:"TransferAcceptance",TRANSFER_COMPLETION:"TransferCompletion",TRANSFER_COMPLETION_FAILED:"TransferCompletionFailed",UPDATE_ENDPOINT_STATE:"UpdateEndpointState",DISABLE_PREHEAT:"DisablePreheat",REQUEST_NEW_OFFER:"RequestNewOffer",UPDATE_ENDPOINT_METADATA:"UpdateEndpointMetadata",UPDATE_MEETING_ROLE_ATTENDEE:"UpdateMeetingRoleToAttendee",UPDATE_MEETING_ROLE_PRESENTER:"UpdateMeetingRoleToPresenter",UPDATE_MEETING_ROLE_ORGANIZER:"UpdateMeetingRoleToOrganizer",ADD_PARTICIPANT_WITH_PICKUP_CODE:"AddParticipantWithPickupCode",PUBLISH_STATE:"PublishState",REMOVE_STATE:"RemoveState",UPDATE_MEETING_SETTINGS:"UpdateMeetingSettings",ADD_PARTICIPANTS_AND_MODALITY:"AddParticipantsAndModality",SEARCH_PARTICIPANTS:"SearchParticipants",GET_ALL_PARTICIPANTS:"GetAllParticipants"},t.default={EVENT_SOURCE:{TROUTER:"Trouter",BROKER:"Broker",UDP:"UDP",LOCAL:"Local"},SOURCE:{NGC_SOURCE:"SkypeConcore"},EVENT_TYPE:{CONVERSATION_CALL_MODALITY:"skypecosi_concore_web_csa_conversation_callmodality",CONVERSATION_CONTENT_SHARING:"skypecosi_concore_web_csa_conversation_contentsharing",CONVERSATION_HTTP_REQUEST:"skypecosi_concore_web_csa_conversation_httprequest"},EXTENSIONS:{DATA_VERSION:"DataVersion",DIRECTION:"Direction",CONTENT_SHARING_DIRECTION:"ContentSharingDirection",CONNECTED_DURATION_IN_MS:"ConnectedDurationInMsecs",PREHEATED_CALL_SETUP_DURATION_IN_S:"PreheatedCallSetupDurationInSeconds",CALL_CANCELATION_DURATION_IN_S:"CallCancelationDurationInSeconds",IS_PREHEATED:"IsPreheated",TIME_TO_RING_IN_MS:"TimeToRingInMsecs",CALL_TERMINATING_END:"CallTerminatingEnd",NETWORK_REQUESTS_PENDING:"NetworkRequestsPending",NETWORK_REQUESTS_COMPLETED:"NetworkRequestsCompleted",LOCAL_OPERATIONS_PERFORMED:"LocalOperationsPerformed",TROUTER_WAIT_OPERATIONS:"TrouterWaitOperations",CALL_START_TIME:"CallStartTime",CALL_END_TIME:"CallEndTime",IS_GROUP_CALL:"IsGroupCall",IS_HOSTLESS_CALL:"IsHostLessCall",IS_CAST_CALL:"IsCastCall",IS_MEETUP_CALL:"IsMeetupCall",IS_ON_BEHALF_OF_CALL:"IsOnBehalfOfCall",IS_SDP_IN_CALL_NOTIFICATION:"SdpInCallNotification",CALL_END_CODE:"Code",CALL_END_SUB_CODE:"SubCode",CALL_END_RESULT_CATEGORIES:"ResultCategories",CALL_END_CAUSE_ID:"CauseId",CONTENT_SHARING_END_CODE:"ContentSharingEndReasonServiceCode",CONTENT_SHARING_END_SUB_CODE:"ContentSharingEndReasonServiceSubCode",CONVERSATION_SERVICE_URL:"ConversationServiceUrl",CONTENT_SHARING_SERVICE_URL:"ContentSharingServiceUrl",MEETING_INFO:"MeetingInfo",RESULT_VALUE:"ResultValue",RESULT_DETAIL:"ResultDetail",RESULT_CAUSE_ID:"ResultCauseId",RESULT_CODE:"ResultCode",LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS:"LocalOfferAnswerGenerationTimestamps",SELF_PARTICIPANT_ROLE:"SelfParticipantRole",SCENARIO:"Scenario",CALLER_TYPE:"Caller_Type",CALLEE_TYPE:"Callee_Type",CALL_TYPE:"Call_Type",TEST_CONTEXT_ID:"Test_Context_Id",OUTGOING_MODALITIES:"Outgoing_Modalities",INCOMING_MODALITIES:"Incoming_Modalities",OFFERED_MODALITIES:"CallOfferredModalities",ANSWERED_MODALITIES:"CallAnsweredModalities",VBSS_OPERATIONS:"VBSS_Operations",CHANGING_CORRELATION_ID_NEW_ID:"ChangingCorrelationId_NewId",CHANGING_CORRELATION_ID_OLD_ID:"ChangingCorrelationId_OldId",MESSAGING_CHANNEL:"MessagingChannel",EVENT_TIMESTAMP_BAG:"EventTimestampBag",NETWORK_REQUESTS_BAG:"NetworkRequestBag",CLIENT_INFORMATION:"ClientInformation",ECS_ETAG:"EcsEtag",APPLICATION_TYPE:"ApplicationType",RING:"Ring",TENANT_ID:"TenantId",ACS_RESOURCE_ID:"AcsResourceId",REGION:"Region",PARTITION:"Partition",CALL_END_CLIENT_SUB_CODE:"CallEventCallEndClientSubCode",CALL_END_CLIENT_PHRASE:"CallEventCallEndClientPhrase"},MESSAGING_CHANNEL:{TROUTER:"Trouter",BROKER:"Broker"},SIGNALING_CONFIG:"JsCsaConfig",SIGNALING_CONFIG_FLAGS:{BROKER_OUTGOING_ENABLED:"BrokerOutgoingEnabled",BROKER_INCOMING_ENABLED:"BrokerIncomingEnabled",BROKER_REQUEST_BATCHING_ENABLED:"BrokerRequestBatchingEnabled",BROKER_EXCLUSIVELY_ENABLED:"BrokerExclusivelyEnabled",SUPPORTS_COMPRESSED_PAYLOAD:"SupportsCompressedPayload",SYNC_TROUTER_RESPONSE:"SyncTrouterResponse",SERVER_MUTE_UNMUTE:"serverMuteUnmute",HANDLE_OFFER_FROM_NOTIFICATION:"handleMediaOfferFromPushNotification",HANDLE_NEW_OFFER_REQUEST:"handleNewOfferRequest",SEND_PROGRESS_FROM_CC:"sendProgressFromCC",HANDLE_UNMUTE_MUTE_FROM_RESPONSE:"handleUnmuteMuteFromResponse",INTERNAL_HTTP_DISPATCHER:"internalHttpDispatcher",ENABLE_TOKEN_CACHE:"enableTokenCache",ENABLE_TOKEN_PREFETCH:"enableTokenPrefetch",REQUEST_HEDGING:"requestHedging",PROCESS_SELF_DATA_FROM_SUBSCRIBE_RESPONSE:"processSelfDataFromSubscribeResponse"},CONTEXT_ID:{CORRELATION_ID:"CorrelationId",SHARED_CORRELATION_ID:"SharedCorrelationId",SIGNALING_SESSION_ID:"SignalingSessionId",THREAD_ID:"ThreadId",TEAMS_MESSAGEID:"TeamsMessageId",TEAMS_MEETINGINFO:"TeamsMeetingInfo",ENDPOINT_ID:"EndpointId",PARTICIPANT_ID:"ParticipantId",DATA_VERSION:"DataVersion",CONTENT_SHARING_ID:"ContentSharingSessionId",CONTENT_SHARING_CORRELATION_ID:"ContentSharingCorrelationId"},CALL_TERMINATING_END:{LOCAL:"Local",REMOTE:"Remote"},RESULT_VALUE:{SUCCESS:"Success",FAILURE:"Failure"},DIRECTION:{INCOMING:"Incoming",OUTGOING:"Outgoing"},ROLE:{CALLER:"caller",CALLEE:"callee",JOIN:"join",JOIN_FOR_ROSTER_ONLY:"joinForRosterOnly",PREHEAT:"preheat"},VBSS_OPERATION:{START:"Start",STOP:"Stop",REJECTED:"Rejected",REMOTE_START:"RemoteStart",TIMEOUT:"Timeout",CALL_END:"CallEnd"},LOCAL_OFFER_ANSWER_OPERATIONS:{INITIAL_OFFER_GENERATION_STARTED:"InitialOfferGenerationStarted",INITIAL_OFFER_GENERATION_ENDED:"InitialOfferGenerationEnded",FINAL_ANSWER_PROCESSING_STARTED:"FinalAnswerProcessingStarted",FINAL_ANSWER_PROCESSING_ENDED:"FinalAnswerProcessingEnded",PROVISIONAL_ANSWER_PROCESSING_STARTED:"ProvisonalAnswerProcessingStarted",PROVISIONAL_ANSWER_PROCESSING_ENDED:"ProvisonalAnswerProcessingEnded",NEGOTIATION_COMPLETED:"NegotiationCompleted",INITIAL_OFFER_PROCESSING_STARTED:"InitialOfferProcessingStarted",INITIAL_OFFER_PROCESSING_ENDED:"InitialOfferProcessingEnded",FINAL_ANSWER_GENERATION_STARTED:"FinalAnswerGenerationStarted",FINAL_ANSWER_GENERATION_ENDED:"FinalAnswerGenerationEnded",PROVISIONAL_ANSWER_GENERATION_STARTED:"ProvisionalAnswerGenerationStarted",PROVISIONAL_ANSWER_GENERATION_ENDED:"ProvisionalAnswerGenerationEnded",RENEGOTIATION_OFFER_GENERATION_STARTED:"RenegotiationOfferGenerationStarted",RENEGOTIATION_OFFER_GENERATION_ENDED:"RenegotiationOfferGenerationEnded",RENEGOTIATION_ANSWER_PROCESSING_STARTED:"RenegotiationAnswerProcessingStarted",RENEGOTIATION_ANSWER_PROCESSING_ENDED:"RenegotiationAnswerProcessingEnded",RENEGOTIATION_OFFER_PROCESSING_STARTED:"RenegotiationOfferProcessingStarted",RENEGOTIATION_OFFER_PROCESSING_ENDED:"RenegotiationOfferProcessingEnded",RENEGOTIATION_ANSWER_GENERATION_STARTED:"RenegotiationAnswerGenerationStarted",RENEGOTIATION_ANSWER_GENERATION_ENDED:"RenegotiationAnswerGenerationEnded"},TROUTER_WAIT_OPERATION:{STARTED:"Started",ENDED:"Ended",FAILED:"Failed"}}},function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},a={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(i)},function(e,t){e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this;this.msElapsed=0,this.isPaused=!1,this.startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e.startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e.startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e.startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}};t.Stopwatch=i,t.build=function(){return new i}},function(e,t,n){"use strict";
/*!
 *  AufLog.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function i(e,t){var n=0;return e.replace(/%[dixs%]/g,function(e){var i=0;if("%"!==e[i++])return"";var r=e[i++];return"%"===r?"%":"s"===r||"d"===r||"i"===r?t[n++]:"x"===r?t[n++].toString(16):e})}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=10]="Trace",e[e.Debug6=16]="Debug6",e[e.Debug5=18]="Debug5",e[e.Debug4=20]="Debug4",e[e.Debug3=30]="Debug3",e[e.Debug2=40]="Debug2",e[e.Debug1=50]="Debug1",e[e.Warning=60]="Warning",e[e.Error=70]="Error",e[e.Fatal=80]="Fatal",e[e.MetaData=90]="MetaData"}(t.LogLevel||(t.LogLevel={})),function(e){e[e.UseDefault=0]="UseDefault",e[e.Compress=1]="Compress",e[e.Disabled=2]="Disabled"}(t.LogFileCompression||(t.LogFileCompression={})),function(e){e[e.Raw=0]="Raw",e[e.Base64=1]="Base64"}(t.LogFileEncoding||(t.LogFileEncoding={})),function(e){e[e.Unencrypted=0]="Unencrypted",e[e.Encrypted=1]="Encrypted"}(t.LogFileEncryption||(t.LogFileEncryption={})),function(e){e[e.PEM=0]="PEM",e[e.DER=1]="DER",e[e.BER=2]="BER"}(t.CertStoreFormat||(t.CertStoreFormat={})),function(e){e[e.InsertFront=8]="InsertFront"}(t.AppenderFlags||(t.AppenderFlags={})),t.vsprintf=i,t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return i(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),r=n(0),o=function(){function e(e){this.id=e.id,this.displayName=e.displayName||" ",this.languageId=e.languageId||null,this.endpointDetails=e.endpointDetails||[],this.acceptedBy=e.acceptedBy,this.role=e.role,this.tenantId=e.tenantId,this.isLobby=e.isLobby,this.meetingRole=e.meetingRole,this.participantId=e.participantId,this.publishedStates=e.publishedStates}return e.isInLobby=function(e,t){for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r.endpointId===t&&r.isLobby)return!0}return!1},e.isServerMuted=function(e,t){for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r.endpointId===t&&r.mediaStreams){for(var o=0,a=r.mediaStreams;o<a.length;o++){var s=a[o];if("audio"===s.type)return void 0!==s.serverMuted&&s.serverMuted}break}}return!1},e.isParticipantServerMuted=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];if(i.mediaStreams)for(var r=0,o=i.mediaStreams;r<o.length;r++){var a=o[r];if("audio"===a.type&&!0===a.serverMuted)return!0}}return!1},e.fromWireParticipant=function(t){return r.assertNotNull(t,"invalid wireParticipant"),r.assertNotNullOrEmpty(t.id,"participant must have valid Id"),new e({id:t.id,displayName:t.displayName,languageId:t.languageId,acceptedBy:t.acceptedBy})},e.getPluginlessStateTypeFromWire=function(e){switch(e){case"raiseHands":return"raiseHands";case"ufd":return"ufd";case"attendeeModalitiesUnrestricted":return"attendeeModalitiesUnrestricted";case"attendeeAudioRestricted":return"attendeeAudioRestricted";case"attendeeVideoRestricted":return"attendeeVideoRestricted";case"spotlight":return"spotlight";default:throw"Invalid state type when converting PublishType to PublishStateType."}},e.findOrCreateTypeState=function(e,t){var n=t.typeStates.findIndex(function(t){return t.type===e});if(-1===n){var i={participantStates:[],type:e};t.typeStates.push(i),n=t.typeStates.length-1}return n},e.processPublishedStates=function(e,t){var n=this,r={typeStates:[]};r.typeStates=[];var o=e;return i.forEach(o,function(e){var i=n.findOrCreateTypeState(n.getPluginlessStateTypeFromWire(e.stateType),r),o={id:t,publishedState:{content:e.content,stateId:e.stateId,typeRank:e.typeRank}};r.typeStates[i].participantStates.push(o)}),r},e.fromRosterEndpoints=function(e){var t=!1,n=!1,i=!1;return{endpointDetails:Object.keys(e).map(function(r){var o,a,s=[],c=!1,l=0;if(e[r].call&&(t=!0,s=e[r].call.mediaStreams||null,l=e[r].call.serverMuteVersion||0,a=e[r].call.appliedInteractivityLevel||"unknown"),e[r].lwj&&(n=!0,o=e[r].lwj.lwjSessionInformation||null),e[r].lobby&&(c=!0,i=!0,s=e[r].lobby.mediaStreams||null,o=e[r].lobby.lwjSessionInformation||null),!e[r].capabilities&&e[r].endpointCapabilities){var u=e[r].endpointCapabilities;e[r].capabilities={implicitCallback:16&u?"enabled":"disabled",cloudAudioVideoConference:1&u?"enabled":"disabled",cloudScreenSharing:2&u?"enabled":"disabled",hostlessConference:4&u?"enabled":"disabled",autoJoinOnConflict:32&u?"enabled":"disabled",serverMuteUnmute:64&u?"enabled":"disabled",supportsCompressedServicePayload:128&u?"enabled":"disabled",cloudMerge:8&u?"enabled":"disabled"}}return{endpointId:r,participantId:e[r].participantId||null,clientVersion:e[r].clientVersion||null,endpointMetadata:e[r].endpointMetadata||null,originalId:e[r].originalId||null,contentSharing:e[r].contentSharing||null,capabilities:e[r].capabilities||null,endpointType:e[r].endpointType||"default",deviceType:e[r].deviceType||void 0,clientEndpointCapabilities:e[r].clientEndpointCapabilities||void 0,mediaStreams:s,serverMuteVersion:l,lwjSessionInformation:o,isLobby:c,endpointState:e[r].endpointState||null,publishedStates:e[r].publishedStates||null,callLinks:e[r].callLinks||null,appliedInteractivityLevel:a||"unknown"}}),participantHasCallModality:t,participantHasLightWeightMeetingModality:n,participantIsInLobby:i}},e.fromRoster=function(t){r.assertNotNull(t,"invalid rosterParticipant "+JSON.stringify(t)),r.assertNotNullOrEmpty(t.details.id,"participant must have valid Id");var n=t.endpoints,i=this.fromRosterEndpoints(n),o=i.endpointDetails,a=i.participantHasCallModality,s=i.participantHasLightWeightMeetingModality,c=i.participantIsInLobby;return a||s||c?((a||s)&&(c=!1),new e({id:t.details.id,displayName:t.details.displayName,languageId:t.details.languageId,role:t.role||"",tenantId:t.details.tenantId||"",endpointDetails:o||[],acceptedBy:t.acceptedBy||"",isLobby:c,meetingRole:t.meetingRole,participantId:t.details.participantId,publishedStates:t.publishedStates||null})):null},e.fromRosterSearchResults=function(e){r.assertNotNull(e,"invalid rosterParticipant "+JSON.stringify(e)),r.assertNotNullOrEmpty(e.details.id,"participant must have valid Id");var t=e.endpoints,n=this.fromRosterEndpoints(t),i=n.endpointDetails,o=n.participantHasCallModality,a=n.participantHasLightWeightMeetingModality,s=n.participantIsInLobby,c=0;o||a?c=3:s&&(c=10);var l=t[0]?t[0].participantId:"";return{id:e.details.id,state:c,tenantId:e.details.tenantId||"",displayName:e.details.displayName,role:e.role||"",meetingRole:e.meetingRole,isServerMuted:this.isParticipantServerMuted(i),publishedStates:this.processPublishedStates(e.publishedStates,l),endpoints:i||[]}},e}();t.default=o},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Desktop=1]="Desktop",e[e.Mobile=2]="Mobile",e[e.Tablet=8]="Tablet"}(t.DeviceType||(t.DeviceType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={})),function(e){e[e.None=0]="None",e[e.Mute=1]="Mute",e[e.Unmute=2]="Unmute"}(t.CommandUrlPresence||(t.CommandUrlPresence={}))},function(e,t,n){"use strict";
/*!
 *  LogFactory.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(9);function s(e){if(null===e)return-1;for(var t=0,n=e.length-1;n>=0;n--)t=37*t+e.charCodeAt(n)|0;var i="__auf_literal:";for(n=i.length-1;n>=0;n--)t=37*t+i.charCodeAt(n)|0;return t}!function(e){e[e.Unsafe=0]="Unsafe",e[e.Safe=1]="Safe",e[e.Inherited_Unsafe=2]="Inherited_Unsafe",e[e.Inherited_Safe=3]="Inherited_Safe",e[e.Blacklisted_Unsafe=4]="Blacklisted_Unsafe"}(o||(o={}));var c,l=function(){function e(e,t){this._level=a.LogLevel.Debug4,this._threshold=255,this._safe=o.Inherited_Unsafe,this._name=e,t&&(this._level=t.level(),this._safe=t.safe()?o.Inherited_Safe:o.Inherited_Unsafe,this._extendedInfo=t.extendedInfo())}return e.prototype.name=function(){return this._name},e.prototype.safe=function(){return this._safe===o.Safe||this._safe===o.Inherited_Safe},e.prototype.safety=function(){return this._safe},e.prototype.setSafety=function(e){this._safe=e},e.prototype.description=function(){return this._desc},e.prototype.setDescription=function(e){this._desc=e},e.prototype.level=function(){return this._level},e.prototype.setLevel=function(e){c.setLevel(this,e)},e.prototype._setLevel=function(e){this._level=e},e.prototype._setThreshold=function(e){this._threshold=e},e.prototype.isEnabled=function(e){return this._threshold<=e},e.prototype.setExtendedInfo=function(e){this._extendedInfo=e},e.prototype.extendedInfo=function(){return this._extendedInfo},e.prototype.trace=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Trace,s(e),e].concat(t))},e.prototype.debug6=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug6,s(e),e].concat(t))},e.prototype.debug5=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug5,s(e),e].concat(t))},e.prototype.debug4=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug4,s(e),e].concat(t))},e.prototype.debug3=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug3,s(e),e].concat(t))},e.prototype.debug2=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug2,s(e),e].concat(t))},e.prototype.debug1=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug1,s(e),e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Warning,s(e),e].concat(t))},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Error,s(e),e].concat(t))},e.prototype.fatal=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Fatal,s(e),e].concat(t))},e.prototype.meta=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.MetaData,s(e),e].concat(t))},e}(),u=function(){function e(){}return e.instance=function(){return c},e.levelToString=function(e){return e<=a.LogLevel.Trace?"TRACE":e<=a.LogLevel.Debug6?"DEBUG6":e<=a.LogLevel.Debug5?"DEBUG5":e<=a.LogLevel.Debug4?"DEBUG4":e<=a.LogLevel.Debug3?"DEBUG3":e<=a.LogLevel.Debug2?"DEBUG2":e<=a.LogLevel.Debug1?"DEBUG1":e<=a.LogLevel.Warning?"WARN":e<=a.LogLevel.Error?"ERROR":e<=a.LogLevel.Fatal?"FATAL":(a.LogLevel.MetaData,"META")},e.levelFromString=function(e){return this._levelFromString[e]||parseInt(e,10)},e}();function d(e,t){for(var n=t.name();n.length>0;){if(e[n])return e[n];var i=n.lastIndexOf(".");n=i<0?"":n.substr(0,i)}return e[""]?e[""]:a.LogLevel.Debug4}function p(e,t){var n=255;return t.forEach(function(t){var i=255;t.appender.levels()?i=Math.min(i,d(t.appender.levels(),e)):t.appender.receiveAll()||(i=Math.min(i,e.level())),n=Math.min(n,i)}),n}u._levelFromString={TRACE:a.LogLevel.Trace,DEBUG6:a.LogLevel.Debug6,DEBUG5:a.LogLevel.Debug5,DEBUG4:a.LogLevel.Debug4,DEBUG3:a.LogLevel.Debug3,DEBUG2:a.LogLevel.Debug2,DEBUG1:a.LogLevel.Debug1,WARN:a.LogLevel.Warning,ERROR:a.LogLevel.Error,FATAL:a.LogLevel.Fatal,META:a.LogLevel.MetaData},t.LogFactory=u;var f=function(e){function t(){var t=e.call(this)||this;return t._nextId=0,t._appenders=[],t._components={},t._componentBlacklist=[],t._components[""]=new l("",null),t}return r(t,e),t.prototype.toHex=function(e){return(4294967296+e).toString(16).substr(-8)},t.prototype.addAppender=function(e,t){void 0===t&&(t=0);var n=this._nextId++;return t&a.AppenderFlags.InsertFront?this._appenders.unshift({appender:e,handle:n}):this._appenders.push({appender:e,handle:n}),this.recalcComponentThresholds(),n},t.prototype.removeAppender=function(e){for(var t=0;t<this._appenders.length;t++)if(this._appenders[t].handle===e){this._appenders.splice(t,1);break}this.recalcComponentThresholds()},t.prototype.log=function(e,t,n,i){for(var r=[],o=4;o<arguments.length;o++)r[o-4]=arguments[o];try{if(e.isEnabled(t)){var a={timestamp:(new Date).getTime(),component:e,level:t};this._appenders.forEach(function(o){(function(e,t,n){return!!e.appender.receiveAll()||(e.appender.levels()?n>=d(e.appender.levels(),t):n>=t.level())})(o,e,t)&&o.appender.log(a,n,i,r)})}}catch(e){}},t.prototype.parent=function(e){for(;;){var t=e.lastIndexOf(".");if(e=t>=0?e.substr(0,t):"",this._components[e])return this._components[e]}},t.prototype.children=function(e){var t=[];for(var n in this._components)this.parent(n).name()===e&&t.push(this._components[n]);return t},t.prototype.component=function(e){if(this._components[e])return this._components[e];var t=new l(e,this.parent(e));this._components[e]=t;var n=p(t,this._appenders);return t._setThreshold(n),t},t.prototype.rootComponent=function(){return this.component("")},t.prototype.setSafetyRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){e.safety()!==o.Inherited_Safe&&e.safety()!==o.Inherited_Unsafe||(e.setSafety(t),n.setSafetyRecursive(e.name(),t))})},t.prototype.declareComponentSafe=function(e,t){var n=this.component(e);-1!==this._componentBlacklist.indexOf(n.name())?n.setSafety(o.Blacklisted_Unsafe):n.setSafety(t?o.Safe:o.Unsafe),this.setSafetyRecursive(e,t?o.Inherited_Safe:o.Inherited_Unsafe)},t.prototype.declareComponentDescription=function(e,t){this.component(e).setDescription(t)},t.prototype.setExtendedInfoRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){void 0===e.extendedInfo()&&(e.setExtendedInfo(t),n.setExtendedInfoRecursive(e.name(),t))})},t.prototype.declareComponentExtendedInfo=function(e,t){var n=this.component(e);n.setExtendedInfo(t),this.setExtendedInfoRecursive(n.name(),t)},t.prototype.recalcComponentThresholds=function(){for(var e in this._components){var t=this._components[e],n=p(t,this._appenders);t._setThreshold(n)}},t.prototype.setLevel=function(e,t){if(""===e.name())for(var n in this._components){(o=this._components[n])._setLevel(t);var i=p(o,this._appenders);o._setThreshold(i)}else{var r=e.name()+".";for(var n in e._setLevel(t),i=p(e,this._appenders),e._setThreshold(i),this._components){var o;if((o=this._components[n]).name().substr(0,r.length)===r){o._setLevel(t);var a=p(o,this._appenders);o._setThreshold(a)}}}},t.prototype.setComponentBlacklist=function(e){for(var t in this._componentBlacklist=e,this._components){var n=this._components[t];-1!==this._componentBlacklist.indexOf(n.name())&&n.setSafety(o.Blacklisted_Unsafe)}},t}(u);c=new f},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}},function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,r){var o=i,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";var i=n(6),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new i.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,r,o,a,s=e.length,c=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(c),a=0,o=0;a<c;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,i,r,o,s=t||e.length,l=new Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)l[i++]=r;else if((o=a[r])>4)l[i++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<s;)r=r<<6|63&e[n++],o--;o>1?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return c(l,i)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(49);function r(e,t){return null==e?t:e}t.default=function(e){e.cloudScreenSharingFlag="disabled"===e.cloudScreenSharingFlag?e.cloudScreenSharingFlag:"enabled",e.isWebRtcEnabled="undefined"==typeof RTCIceGatherer,e.shouldServiceSendNGCUpgradeMessages=r(e.shouldServiceSendNGCUpgradeMessages,!0),e.isGVCOutgoingEnabled=r(e.isGVCOutgoingEnabled,!0),e.handleRosterFromCreateAndJoin=r(e.handleRosterFromCreateAndJoin,!0),e.supportsCompressedServicePayload=r(e.supportsCompressedServicePayload,!0),e.supportsSynchronousTrouterResponse=r(e.supportsSynchronousTrouterResponse,!0),e.supportsHostlessGroupCalls=r(e.supportsHostlessGroupCalls,!0),e.doHostlessCalling=r(e.doHostlessCalling,!1),e.brokerExclusively=r(e.brokerExclusively,!1),e.brokerEnabledOutgoing=r(e.brokerEnabledOutgoing,!0),e.brokerEnabledIncoming=r(e.brokerEnabledIncoming,!0),e.brokerRequestBatching=r(e.brokerRequestBatching,!0),e.handleMediaOfferFromPushNotification=r(e.handleMediaOfferFromPushNotification,!0),e.handleNewOfferRequest=r(e.handleNewOfferRequest,!1),e.autoJoinOnConflict=r(e.autoJoinOnConflict,!0),e.endConflictedCall=r(e.endConflictedCall,!1),e.autoResolveConflictedCall=r(e.autoResolveConflictedCall,!1),e.shouldServiceSendCallEventMessages=r(e.shouldServiceSendCallEventMessages,!1),e.handleUnmuteMuteFromResponse=r(e.handleUnmuteMuteFromResponse,!1),e.forceTrouterReconnectOnNetworkOnline=r(e.forceTrouterReconnectOnNetworkOnline,!0),e.attemptHttpRequestWithCachedSkypetoken=r(e.attemptHttpRequestWithCachedSkypetoken,!0),e.useInternalHttpDispatcher=r(e.useInternalHttpDispatcher,!1),e.enableTokenCache=r(e.enableTokenCache,!1),e.enableTokenPrefetch=r(e.enableTokenPrefetch,!1),e.hedgeDelayMs=r(e.hedgeDelayMs,3e3),e.hedgeMaxParallelAttempts=r(e.hedgeMaxParallelAttempts,3),e.useInternalHttpDispatcher&&(e.httpRequestDispatcher=new i.default(e.logger)),e.overrideDisplayName=r(e.overrideDisplayName,!1),e.enableDeltaRosterWeb=r(e.enableDeltaRosterWeb,!1),e.processSelfDataFromSubscribeResponse=r(e.processSelfDataFromSubscribeResponse,!0),e.enableMusicOnHoldV2=r(e.enableMusicOnHoldV2,!1),e.enablePstnMasking=r(e.enablePstnMasking,!0)}},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},function(e,t,n){"use strict";var i=n(4);function r(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(i.isURLSearchParams(t))o=t.toString();else{var a=[];i.forEach(t,function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),a.push(r(t)+"="+r(e))}))}),o=a.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";(function(t){var i=n(4),r=n(56),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s,c={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(s=n(25)),s),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],function(e){c.headers[e]={}}),i.forEach(["post","put","patch"],function(e){c.headers[e]=i.merge(o)}),e.exports=c}).call(this,n(24))},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],u=!1,d=-1;function p(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&f())}function f(){if(!u){var e=s(p);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new h(e,t)),1!==l.length||u||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";var i=n(4),r=n(57),o=n(21),a=n(59),s=n(62),c=n(63),l=n(26);e.exports=function(e){return new Promise(function(t,u){var d=e.data,p=e.headers;i.isFormData(d)&&delete p["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var h=e.auth.username||"",g=e.auth.password||"";p.Authorization="Basic "+btoa(h+":"+g)}var m=a(e.baseURL,e.url);if(f.open(e.method.toUpperCase(),o(m,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f.onreadystatechange=function(){if(f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in f?s(f.getAllResponseHeaders()):null,i={data:e.responseType&&"text"!==e.responseType?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f};r(t,u,i),f=null}},f.onabort=function(){f&&(u(l("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){u(l("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),u(l(t,e,"ECONNABORTED",f)),f=null},i.isStandardBrowserEnv()){var v=n(65),y=(e.withCredentials||c(m))&&e.xsrfCookieName?v.read(e.xsrfCookieName):void 0;y&&(p[e.xsrfHeaderName]=y)}if("setRequestHeader"in f&&i.forEach(p,function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete p[t]:f.setRequestHeader(t,e)}),i.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){f&&(f.abort(),u(e),f=null)}),void 0===d&&(d=null),f.send(d)})}},function(e,t,n){"use strict";var i=n(58);e.exports=function(e,t,n,r,o){var a=new Error(e);return i(a,t,n,r,o)}},function(e,t,n){"use strict";var i=n(4);e.exports=function(e,t){t=t||{};var n={},r=["url","method","params","data"],o=["headers","auth","proxy"],a=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];i.forEach(r,function(e){void 0!==t[e]&&(n[e]=t[e])}),i.forEach(o,function(r){i.isObject(t[r])?n[r]=i.deepMerge(e[r],t[r]):void 0!==t[r]?n[r]=t[r]:i.isObject(e[r])?n[r]=i.deepMerge(e[r]):void 0!==e[r]&&(n[r]=e[r])}),i.forEach(a,function(i){void 0!==t[i]?n[i]=t[i]:void 0!==e[i]&&(n[i]=e[i])});var s=r.concat(o).concat(a),c=Object.keys(t).filter(function(e){return-1===s.indexOf(e)});return i.forEach(c,function(i){void 0!==t[i]?n[i]=t[i]:void 0!==e[i]&&(n[i]=e[i])}),n}},function(e,t,n){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStringBase64=function(e){if(!e)return!1;try{return atob(e),!0}catch(e){return!1}},t.isPromiseLike=function(e){return!!e&&"function"==typeof e.then}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.piiScrubber=this.getPiiScrubber(e)}return e.prototype.scrubParticipantsList=function(e){var t=this,n=[];return Array.isArray(e)&&e.forEach(function(e){return n.push(t.scrubMriOrOmit(e))}),n},e.prototype.scrubMriOrOmit=function(e){return"string"==typeof e?this.piiScrubber.mri(e):this.piiScrubber.omit(e)},e.prototype.getPiiScrubber=function(e){return e&&"function"==typeof e.omit&&"function"==typeof e.mri?e:{omit:function(){return"<pii:omit/>"},mri:function(){return"<pii:mri/>"}}},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.asap=function(e){return new Promise(function(t){t(e())})};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);t.TimeoutError=o;var a=function(){function e(){}return e.build=function(e,t){return new s(e,t)},e}();t.TimerFactory=a;var s=function(){function e(e,t){this.ontimeout=e,this.name=t}return e.prototype.start=function(e){var t=this;if(this.timeoutId)throw new Error("Timer "+this.name+" already started");return this.timeoutId=window.setTimeout(function(){return t.ontimeout()},e),this},e.prototype.stop=function(){if(!this.timeoutId)throw new Error("Timer "+this.name+" is not defined");clearTimeout(this.timeoutId),this.timeoutId=null},e}();t.Timer=s,t.defer=function(){var e,t;return{promise:new Promise(function(n,i){e=n,t=i}),resolve:e,reject:t}},t.timedDefer=function(e,t){var n,i;void 0===t&&(t="deferred timed out after "+e+"ms");var r={promise:new Promise(function(e,t){n=function(t){a.stop(),e(t)},i=function(e){a.stop(),t(e)}}),resolve:n,reject:i},a=new s(function(){return r.reject(new o(t))},"timedDefer");return a.start(e),r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n,a){o.assertNotNull(e,"signalingSession cannot be null");var s=n.threadId?{threadId:n.threadId,messageId:n.messageId||null}:null,c=[],l={};t&&t.length>0?(c=t.map(function(e){return{id:e.id,assertedId:e.assertedId,displayName:e.displayName,participantId:e.participantId}}),l={addParticipantSuccess:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}):l={addModalitySuccess:r.get(e,i.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:r.get(e,i.URL_PATH.CONV_ADD_MODALITY_FAILURE)};var u={payload:{disableUnmute:n&&n.disableUnmute,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:c},participantInvitationData:n.additionalData,replacementDetails:a,groupChat:s,links:l}};return n&&n.alternateId&&(u.payload.participants.from.alternateId=n.alternateId),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(110);function r(e){return"string"==typeof e?i.pii.Mri(e):i.pii.Omit(e)}t.scrubMriOrOmit=r,t.scrubMriOrOmitList=function(e){return e.forEach(r)},t.mriOrId=function(e){return e&&i.pii.Mri(e)},t.getLoggableThreadId=function(e){var t=function(e){return e&&"99:"===e.substr(0,3)?i.pii.Omit(e):e}(e);return t&&t.substr(0,8)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";
/*!
 *  Appenders.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(9),s=n(13),c=function(){function e(e){this._formatter=e||new d}return e.prototype.formatter=function(){return this._formatter},e.prototype.receiveAll=function(){return!1},e.prototype.levels=function(){return null},e}();function l(e){return(4294967296+e).toString(16).substr(-8)}function u(e,t){return(1e12+e).toString(10).substr(-t)}t.AbstractLogAppender=c,function(e){e[e.Timestamp=1]="Timestamp",e[e.Component=4]="Component",e[e.Level=8]="Level",e[e.FullDate=32]="FullDate",e[e.LogId=64]="LogId"}(o=t.SLF_Flags||(t.SLF_Flags={}));var d=function(){function e(e){void 0===e&&(e=4294967295),this._flags=e}return e.prototype.format=function(e,t,n,i){var r="";if(this._flags&o.FullDate)r+=new Date(e.timestamp).toISOString()+" ";else if(this._flags&o.Timestamp){var c=new Date(e.timestamp);r+=u(c.getHours(),2)+":"+u(c.getMinutes(),2)+":"+u(c.getSeconds(),2)+"."+u(c.getMilliseconds(),2)+" "}return this._flags&o.LogId&&(r+="[#"+l(t)+"-"+(e.component.safe()?"S":"u")+"] "),this._flags&o.Level&&(r+="["+s.LogFactory.levelToString(e.level)+"] "),this._flags&o.Component&&(r+="["+e.component.name()+"] "),n||""===n?r+a.vsprintf(n,i):r+l(t)+": "+i.join(" ")},e}();t.StandardLogFormatter=d;var p=console,f=console.log||function(){},h=console.info||f,g=console.warn||h,m=console.error||g,v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.log=function(e,t,n,i){i=i.slice(0);var r=e.level<=a.LogLevel.Debug3?f:e.level<=a.LogLevel.Debug1?h:e.level<=a.LogLevel.Warning?g:m;if(-1===t){var o=this.formatter().format(e,t,"",[]);"string"==typeof i[0]&&(o+=i.shift()),r.apply(p,[o].concat(i))}else{for(var s=void 0,c=[];s=n.match(/\s*%@\s*$/);)n=n.substr(0,n.length-s[0].length),c.unshift(i.pop());o=this.formatter().format(e,t,n,i),r.apply(p,[o].concat(c))}},t}(c);t.ConsoleAppender=v;var y=function(){function e(e){this._chained=e}return e.prototype.log=function(e,t,n,i){this._chained.log(e,t,n,i)},e.prototype.receiveAll=function(){return this._chained.receiveAll()},e.prototype.levels=function(){return this._chained.levels()},e}();t.ChainedLogAppender=y;var S=function(e){function t(t,n){var i=e.call(this,t)||this;return i._levels=n,i}return r(t,e),t.prototype.levels=function(){return this._levels},t}(y);t.wrapAppenderWithLogLevels=function(e,t){return new S(e,t)}},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\S*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{name:"signalingFbXMessage",reg:/^x-signaling-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){return"x-signaling-fb:"+("*"===e.payload?"%s":"%d")+" x-message %s"}},{push:"xMediaSettings",reg:/^x-mediasettings:([\S| ]*)/,names:["settings"],format:"x-mediasettings:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,n){e.exports=n(38)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),r=n(12);t.CommandUrlPresence=r.CommandUrlPresence,t.DeviceType=r.DeviceType,t.TrouterState=r.TrouterState;var o=n(1);t.CA_CONSTANTS=o.default;var a=n(5);t.TM_CONSTANTS=a.default;var s=n(48);t.IncomingNotificationMessageHandler=s.default;var c=n(19);t.setDefaultsForSignalingConfig=c.default;var l=n(69);t.SignalingAgent=l.default;var u=n(151);t.HttpRequestDispatcher=u.default;var d=n(152);t.SkypeConCoreTelemetryManager=d.default,t.createParticipant=function(e){return new i.default(e)}},function(e,t,n){"use strict";var i={};(0,n(6).assign)(i,n(40),n(43),n(18)),e.exports=i},function(e,t,n){"use strict";var i=n(41),r=n(6),o=n(16),a=n(11),s=n(17),c=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(a[n]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var u;if(u="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=i.deflateSetDictionary(this.strm,u)))throw new Error(a[n]);this._dict_set=!0}}function u(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}l.prototype.push=function(e,t){var n,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=o.string2buf(e):"[object ArrayBuffer]"===c.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new r.Buf8(l),s.next_out=0,s.avail_out=l),1!==(n=i.deflate(s,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(s.output,s.next_out))):this.onData(r.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),s.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=l,t.deflate=u,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,u(e,t)}},function(e,t,n){"use strict";var i,r=n(6),o=n(42),a=n(14),s=n(15),c=n(11);function l(e,t){return e.msg=c[t],t}function u(e){return(e<<1)-(e>4?9:0)}function d(e){for(var t=e.length;--t>=0;)e[t]=0}function p(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function f(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,p(e.strm)}function h(e,t){e.pending_buf[e.pending++]=t}function g(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function m(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,l=e.window,u=e.w_mask,d=e.prev,p=e.strstart+258,f=l[o+a-1],h=l[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+a]===h&&l[n+a-1]===f&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<p);if(i=258-(p-o),o=p-258,i>a){if(e.match_start=t,a=i,i>=s)break;f=l[o+a-1],h=l[o+a]}}}while((t=d[t&u])>c&&0!=--r);return a<=e.lookahead?a:e.lookahead}function v(e){var t,n,i,o,c,l,u,d,p,f,h=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=h+(h-262)){r.arraySet(e.window,e.window,h,h,0),e.match_start-=h,e.strstart-=h,e.block_start-=h,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=h?i-h:0}while(--n);t=n=h;do{i=e.prev[--t],e.prev[t]=i>=h?i-h:0}while(--n);o+=h}if(0===e.strm.avail_in)break;if(l=e.strm,u=e.window,d=e.strstart+e.lookahead,p=o,f=void 0,(f=l.avail_in)>p&&(f=p),n=0===f?0:(l.avail_in-=f,r.arraySet(u,l.input,l.next_in,f,d),1===l.state.wrap?l.adler=a(l.adler,u,f,d):2===l.state.wrap&&(l.adler=s(l.adler,u,f,d)),l.next_in+=f,l.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function y(e,t){for(var n,i;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=m(e,n)),e.match_length>=3)if(i=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function S(e,t){for(var n,i,r;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=m(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=o._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function _(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function E(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):l(e,-2)}function T(e){var t,n=E(e);return 0===n&&((t=e.state).window_size=2*t.w_size,d(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function C(e,t,n,i,o,a){if(!e)return-2;var s=1;if(-1===t&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),o<1||o>9||8!==n||i<8||i>15||t<0||t>9||a<0||a>4)return l(e,-2);8===i&&(i=9);var c=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),d(this.dyn_ltree),d(this.dyn_dtree),d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),d(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=c,c.strm=e,c.wrap=s,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new r.Buf8(2*c.w_size),c.head=new r.Buf16(c.hash_size),c.prev=new r.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new r.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=a,c.method=n,T(e)}i=[new _(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(v(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,f(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)}),new _(4,4,8,4,y),new _(4,5,16,8,y),new _(4,6,32,32,y),new _(4,4,16,16,S),new _(8,16,32,32,S),new _(8,16,128,128,S),new _(8,32,128,256,S),new _(32,128,258,1024,S),new _(32,258,258,4096,S)],t.deflateInit=function(e,t){return C(e,t,8,15,8,0)},t.deflateInit2=C,t.deflateReset=T,t.deflateResetKeep=E,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,r,a,c;if(!e||!e.state||t>5||t<0)return e?l(e,-2):-2;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&4!==t)return l(e,0===e.avail_out?-5:-2);if(r.strm=e,n=r.last_flush,r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,h(r,31),h(r,139),h(r,8),r.gzhead?(h(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),h(r,255&r.gzhead.time),h(r,r.gzhead.time>>8&255),h(r,r.gzhead.time>>16&255),h(r,r.gzhead.time>>24&255),h(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),h(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(h(r,255&r.gzhead.extra.length),h(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=s(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(h(r,0),h(r,0),h(r,0),h(r,0),h(r,0),h(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),h(r,3),r.status=113);else{var m=8+(r.w_bits-8<<4)<<8;m|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(m|=32),m+=31-m%31,r.status=113,g(r,m),0!==r.strstart&&(g(r,e.adler>>>16),g(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),p(e),a=r.pending,r.pending!==r.pending_buf_size));)h(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),p(e),a=r.pending,r.pending===r.pending_buf_size)){c=1;break}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,h(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===c&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),p(e),a=r.pending,r.pending===r.pending_buf_size)){c=1;break}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,h(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===c&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&p(e),r.pending+2<=r.pending_buf_size&&(h(r,255&e.adler),h(r,e.adler>>8&255),e.adler=0,r.status=113)):r.status=113),0!==r.pending){if(p(e),0===e.avail_out)return r.last_flush=-1,0}else if(0===e.avail_in&&u(t)<=u(n)&&4!==t)return l(e,-5);if(666===r.status&&0!==e.avail_in)return l(e,-5);if(0!==e.avail_in||0!==r.lookahead||0!==t&&666!==r.status){var y=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(v(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var n,i,r,a,s=e.window;;){if(e.lookahead<=258){if(v(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=s[r=e.strstart-1])===s[++r]&&i===s[++r]&&i===s[++r]){a=e.strstart+258;do{}while(i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&r<a);e.match_length=258-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(r,t):i[r.level].func(r,t);if(3!==y&&4!==y||(r.status=666),1===y||3===y)return 0===e.avail_out&&(r.last_flush=-1),0;if(2===y&&(1===t?o._tr_align(r):5!==t&&(o._tr_stored_block(r,0,0,!1),3===t&&(d(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),p(e),0===e.avail_out))return r.last_flush=-1,0}return 4!==t?0:r.wrap<=0?1:(2===r.wrap?(h(r,255&e.adler),h(r,e.adler>>8&255),h(r,e.adler>>16&255),h(r,e.adler>>24&255),h(r,255&e.total_in),h(r,e.total_in>>8&255),h(r,e.total_in>>16&255),h(r,e.total_in>>24&255)):(g(r,e.adler>>>16),g(r,65535&e.adler)),p(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?l(e,-2):(e.state=null,113===t?l(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,i,o,s,c,l,u,p,f=t.length;if(!e||!e.state)return-2;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return-2;for(1===s&&(e.adler=a(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(d(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new r.Buf8(n.w_size),r.arraySet(p,t,f-n.w_size,n.w_size,0),t=p,f=n.w_size),c=e.avail_in,l=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,v(n);n.lookahead>=3;){i=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--o);n.strstart=i,n.lookahead=2,v(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,n.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var i=n(6);function r(e){for(var t=e.length;--t>=0;)e[t]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=new Array(576);r(l);var u=new Array(60);r(u);var d=new Array(512);r(d);var p=new Array(256);r(p);var f=new Array(29);r(f);var h,g,m,v=new Array(30);function y(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function S(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function _(e){return e<256?d[e]:d[256+(e>>>7)]}function E(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function T(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,E(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function C(e,t,n){T(e,n[2*t],n[2*t+1])}function I(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function A(e,t,n){var i,r,o=new Array(16),a=0;for(i=1;i<=15;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=I(o[s]++,s))}}function b(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function R(e){e.bi_valid>8?E(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function O(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function P(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&O(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!O(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function N(e,t,n){var i,r,s,c,l=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],r=e.pending_buf[e.l_buf+l],l++,0===i?C(e,r,t):(C(e,(s=p[r])+256+1,t),0!==(c=o[s])&&T(e,r-=f[s],c),C(e,s=_(--i),n),0!==(c=a[s])&&T(e,i-=v[s],c))}while(l<e.last_lit);C(e,256,t)}function M(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==o[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)P(e,o,n);r=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,P(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,c=t.dyn_tree,l=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,h=t.stat_desc.max_length,g=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=c[2*c[2*(i=e.heap[n])+1]+1]+1)>h&&(o=h,g++),c[2*i+1]=o,i>l||(e.bl_count[o]++,a=0,i>=f&&(a=p[i-f]),s=c[2*i],e.opt_len+=s*(o+a),d&&(e.static_len+=s*(u[2*i+1]+a)));if(0!==g){do{for(o=h-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[h]--,g-=2}while(g>0);for(o=h;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>l||(c[2*r+1]!==o&&(e.opt_len+=(o-c[2*r+1])*c[2*r],c[2*r+1]=o),i--)}}(e,t),A(o,l,e.bl_count)}function w(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<c&&r===a||(s<l?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=r,0===a?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4))}function D(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<c&&r===a)){if(s<l)do{C(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(C(e,r,e.bl_tree),s--),C(e,16,e.bl_tree),T(e,s-3,2)):s<=10?(C(e,17,e.bl_tree),T(e,s-3,3)):(C(e,18,e.bl_tree),T(e,s-11,7));s=0,o=r,0===a?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4)}}r(v);var L=!1;function k(e,t,n,r){T(e,0+(r?1:0),3),function(e,t,n,r){R(e),E(e,n),E(e,~n),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){L||(function(){var e,t,n,i,r,c=new Array(16);for(n=0,i=0;i<28;i++)for(f[i]=n,e=0;e<1<<o[i];e++)p[n++]=i;for(p[n-1]=i,r=0,i=0;i<16;i++)for(v[i]=r,e=0;e<1<<a[i];e++)d[r++]=i;for(r>>=7;i<30;i++)for(v[i]=r<<7,e=0;e<1<<a[i]-7;e++)d[256+r++]=i;for(t=0;t<=15;t++)c[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,c[8]++;for(;e<=255;)l[2*e+1]=9,e++,c[9]++;for(;e<=279;)l[2*e+1]=7,e++,c[7]++;for(;e<=287;)l[2*e+1]=8,e++,c[8]++;for(A(l,287,c),e=0;e<30;e++)u[2*e+1]=5,u[2*e]=I(e,5);h=new y(l,o,257,286,15),g=new y(u,a,0,30,15),m=new y(new Array(0),s,0,19,7)}(),L=!0),e.l_desc=new S(e.dyn_ltree,h),e.d_desc=new S(e.dyn_dtree,g),e.bl_desc=new S(e.bl_tree,m),e.bi_buf=0,e.bi_valid=0,b(e)},t._tr_stored_block=k,t._tr_flush_block=function(e,t,n,i){var r,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),M(e,e.l_desc),M(e,e.d_desc),a=function(e){var t;for(w(e,e.dyn_ltree,e.l_desc.max_code),w(e,e.dyn_dtree,e.d_desc.max_code),M(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?k(e,t,n,i):4===e.strategy||o===r?(T(e,2+(i?1:0),3),N(e,l,u)):(T(e,4+(i?1:0),3),function(e,t,n,i){var r;for(T(e,t-257,5),T(e,n-1,5),T(e,i-4,4),r=0;r<i;r++)T(e,e.bl_tree[2*c[r]+1],3);D(e,e.dyn_ltree,t-1),D(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),N(e,e.dyn_ltree,e.dyn_dtree)),b(e),i&&R(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(p[n]+256+1)]++,e.dyn_dtree[2*_(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){T(e,2,3),C(e,256,l),function(e){16===e.bi_valid?(E(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var i=n(44),r=n(6),o=n(16),a=n(18),s=n(11),c=n(17),l=n(47),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new l,i.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=i.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(s[n])}function p(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}d.prototype.push=function(e,t){var n,s,c,l,d,p=this.strm,f=this.options.chunkSize,h=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?p.input=o.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(f),p.next_out=0,p.avail_out=f),(n=i.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&h&&(n=i.inflateSetDictionary(this.strm,h)),n===a.Z_BUF_ERROR&&!0===g&&(n=a.Z_OK,g=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&n!==a.Z_STREAM_END&&(0!==p.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(p.output,p.next_out),l=p.next_out-c,d=o.buf2string(p.output,c),p.next_out=l,p.avail_out=f-l,l&&r.arraySet(p.output,p.output,c,l,0),this.onData(d)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(g=!0)}while((p.avail_in>0||0===p.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),p.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=p,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},t.ungzip=p},function(e,t,n){"use strict";var i=n(6),r=n(14),o=n(15),a=n(45),s=n(46);function c(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):-2}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,u(e)):-2}function p(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,d(e))):-2}function f(e,t){var n,i;return e?(i=new l,e.state=i,i.window=null,0!==(n=p(e,t))&&(e.state=null),n):-2}var h,g,m=!0;function v(e){if(m){var t;for(h=new i.Buf32(512),g=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,h,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,g,0,e.work,{bits:5}),m=!1}e.lencode=h,e.lenbits=9,e.distcode=g,e.distbits=5}function y(e,t,n,r){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),r>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>r&&(o=r),i.arraySet(a.window,t,n-r,o,a.wnext),(r-=o)?(i.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=d,t.inflateReset2=p,t.inflateResetKeep=u,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var n,l,u,d,p,f,h,g,m,S,_,E,T,C,I,A,b,R,O,P,N,M,w,D,L=0,k=new i.Buf8(4),x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),p=e.next_out,u=e.output,h=e.avail_out,d=e.next_in,l=e.input,f=e.avail_in,g=n.hold,m=n.bits,S=f,_=h,M=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(2&n.wrap&&35615===g){n.check=0,k[0]=255&g,k[1]=g>>>8&255,n.check=o(n.check,k,2,0),g=0,m=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&g)){e.msg="unknown compression method",n.mode=30;break}if(m-=4,N=8+(15&(g>>>=4)),0===n.wbits)n.wbits=N;else if(N>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<N,e.adler=n.check=1,n.mode=512&g?10:12,g=0,m=0;break;case 2:for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(n.flags=g,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=g>>8&1),512&n.flags&&(k[0]=255&g,k[1]=g>>>8&255,n.check=o(n.check,k,2,0)),g=0,m=0,n.mode=3;case 3:for(;m<32;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.head&&(n.head.time=g),512&n.flags&&(k[0]=255&g,k[1]=g>>>8&255,k[2]=g>>>16&255,k[3]=g>>>24&255,n.check=o(n.check,k,4,0)),g=0,m=0,n.mode=4;case 4:for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&n.flags&&(k[0]=255&g,k[1]=g>>>8&255,n.check=o(n.check,k,2,0)),g=0,m=0,n.mode=5;case 5:if(1024&n.flags){for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.length=g,n.head&&(n.head.extra_len=g),512&n.flags&&(k[0]=255&g,k[1]=g>>>8&255,n.check=o(n.check,k,2,0)),g=0,m=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((E=n.length)>f&&(E=f),E&&(n.head&&(N=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,l,d,E,N)),512&n.flags&&(n.check=o(n.check,l,E,d)),f-=E,d+=E,n.length-=E),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break e;E=0;do{N=l[d+E++],n.head&&N&&n.length<65536&&(n.head.name+=String.fromCharCode(N))}while(N&&E<f);if(512&n.flags&&(n.check=o(n.check,l,E,d)),f-=E,d+=E,N)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break e;E=0;do{N=l[d+E++],n.head&&N&&n.length<65536&&(n.head.comment+=String.fromCharCode(N))}while(N&&E<f);if(512&n.flags&&(n.check=o(n.check,l,E,d)),f-=E,d+=E,N)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}g=0,m=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;m<32;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}e.adler=n.check=c(g),g=0,m=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=p,e.avail_out=h,e.next_in=d,e.avail_in=f,n.hold=g,n.bits=m,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){g>>>=7&m,m-=7&m,n.mode=27;break}for(;m<3;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}switch(n.last=1&g,m-=1,3&(g>>>=1)){case 0:n.mode=14;break;case 1:if(v(n),n.mode=20,6===t){g>>>=2,m-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}g>>>=2,m-=2;break;case 14:for(g>>>=7&m,m-=7&m;m<32;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&g,g=0,m=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(E=n.length){if(E>f&&(E=f),E>h&&(E=h),0===E)break e;i.arraySet(u,l,d,E,p),f-=E,d+=E,h-=E,p+=E,n.length-=E;break}n.mode=12;break;case 17:for(;m<14;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(n.nlen=257+(31&g),g>>>=5,m-=5,n.ndist=1+(31&g),g>>>=5,m-=5,n.ncode=4+(15&g),g>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;m<3;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.lens[x[n.have++]]=7&g,g>>>=3,m-=3}for(;n.have<19;)n.lens[x[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,w={bits:n.lenbits},M=s(0,n.lens,0,19,n.lencode,0,n.work,w),n.lenbits=w.bits,M){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;A=(L=n.lencode[g&(1<<n.lenbits)-1])>>>16&255,b=65535&L,!((I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(b<16)g>>>=I,m-=I,n.lens[n.have++]=b;else{if(16===b){for(D=I+2;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(g>>>=I,m-=I,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}N=n.lens[n.have-1],E=3+(3&g),g>>>=2,m-=2}else if(17===b){for(D=I+3;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}m-=I,N=0,E=3+(7&(g>>>=I)),g>>>=3,m-=3}else{for(D=I+7;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}m-=I,N=0,E=11+(127&(g>>>=I)),g>>>=7,m-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;E--;)n.lens[n.have++]=N}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,w={bits:n.lenbits},M=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,w),n.lenbits=w.bits,M){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,w={bits:n.distbits},M=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,w),n.distbits=w.bits,M){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(f>=6&&h>=258){e.next_out=p,e.avail_out=h,e.next_in=d,e.avail_in=f,n.hold=g,n.bits=m,a(e,_),p=e.next_out,u=e.output,h=e.avail_out,d=e.next_in,l=e.input,f=e.avail_in,g=n.hold,m=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;A=(L=n.lencode[g&(1<<n.lenbits)-1])>>>16&255,b=65535&L,!((I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(A&&0==(240&A)){for(R=I,O=A,P=b;A=(L=n.lencode[P+((g&(1<<R+O)-1)>>R)])>>>16&255,b=65535&L,!(R+(I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}g>>>=R,m-=R,n.back+=R}if(g>>>=I,m-=I,n.back+=I,n.length=b,0===A){n.mode=26;break}if(32&A){n.back=-1,n.mode=12;break}if(64&A){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&A,n.mode=22;case 22:if(n.extra){for(D=n.extra;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;A=(L=n.distcode[g&(1<<n.distbits)-1])>>>16&255,b=65535&L,!((I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(0==(240&A)){for(R=I,O=A,P=b;A=(L=n.distcode[P+((g&(1<<R+O)-1)>>R)])>>>16&255,b=65535&L,!(R+(I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}g>>>=R,m-=R,n.back+=R}if(g>>>=I,m-=I,n.back+=I,64&A){e.msg="invalid distance code",n.mode=30;break}n.offset=b,n.extra=15&A,n.mode=24;case 24:if(n.extra){for(D=n.extra;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===h)break e;if(E=_-h,n.offset>E){if((E=n.offset-E)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}E>n.wnext?(E-=n.wnext,T=n.wsize-E):T=n.wnext-E,E>n.length&&(E=n.length),C=n.window}else C=u,T=p-n.offset,E=n.length;E>h&&(E=h),h-=E,n.length-=E;do{u[p++]=C[T++]}while(--E);0===n.length&&(n.mode=21);break;case 26:if(0===h)break e;u[p++]=n.length,h--,n.mode=21;break;case 27:if(n.wrap){for(;m<32;){if(0===f)break e;f--,g|=l[d++]<<m,m+=8}if(_-=h,e.total_out+=_,n.total+=_,_&&(e.adler=n.check=n.flags?o(n.check,u,_,p-_):r(n.check,u,_,p-_)),_=h,(n.flags?g:c(g))!==n.check){e.msg="incorrect data check",n.mode=30;break}g=0,m=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;m<32;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}g=0,m=0}n.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=p,e.avail_out=h,e.next_in=d,e.avail_in=f,n.hold=g,n.bits=m,(n.wsize||_!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&y(e,e.output,e.next_out,_-e.avail_out)?(n.mode=31,-4):(S-=e.avail_in,_-=e.avail_out,e.total_in+=S,e.total_out+=_,n.total+=_,n.wrap&&_&&(e.adler=n.check=n.flags?o(n.check,u,_,e.next_out-_):r(n.check,u,_,e.next_out-_)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===S&&0===_||4===t)&&0===M&&(M=-5),M)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&r(1,t,i,0)!==n.check?-3:y(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,i,r,o,a,s,c,l,u,d,p,f,h,g,m,v,y,S,_,E,T,C,I,A,b;n=e.state,i=e.next_in,A=e.input,r=i+(e.avail_in-5),o=e.next_out,b=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,d=n.wnext,p=n.window,f=n.hold,h=n.bits,g=n.lencode,m=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{h<15&&(f+=A[i++]<<h,h+=8,f+=A[i++]<<h,h+=8),S=g[f&v];t:for(;;){if(f>>>=_=S>>>24,h-=_,0==(_=S>>>16&255))b[o++]=65535&S;else{if(!(16&_)){if(0==(64&_)){S=g[(65535&S)+(f&(1<<_)-1)];continue t}if(32&_){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}E=65535&S,(_&=15)&&(h<_&&(f+=A[i++]<<h,h+=8),E+=f&(1<<_)-1,f>>>=_,h-=_),h<15&&(f+=A[i++]<<h,h+=8,f+=A[i++]<<h,h+=8),S=m[f&y];n:for(;;){if(f>>>=_=S>>>24,h-=_,!(16&(_=S>>>16&255))){if(0==(64&_)){S=m[(65535&S)+(f&(1<<_)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(T=65535&S,h<(_&=15)&&(f+=A[i++]<<h,(h+=8)<_&&(f+=A[i++]<<h,h+=8)),(T+=f&(1<<_)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=_,h-=_,T>(_=o-a)){if((_=T-_)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,I=p,0===d){if(C+=l-_,_<E){E-=_;do{b[o++]=p[C++]}while(--_);C=o-T,I=b}}else if(d<_){if(C+=l+d-_,(_-=d)<E){E-=_;do{b[o++]=p[C++]}while(--_);if(C=0,d<E){E-=_=d;do{b[o++]=p[C++]}while(--_);C=o-T,I=b}}}else if(C+=d-_,_<E){E-=_;do{b[o++]=p[C++]}while(--_);C=o-T,I=b}for(;E>2;)b[o++]=I[C++],b[o++]=I[C++],b[o++]=I[C++],E-=3;E&&(b[o++]=I[C++],E>1&&(b[o++]=I[C++]))}else{C=o-T;do{b[o++]=b[C++],b[o++]=b[C++],b[o++]=b[C++],E-=3}while(E>2);E&&(b[o++]=b[C++],E>1&&(b[o++]=b[C++]))}break}}break}}while(i<r&&o<s);i-=E=h>>3,f&=(1<<(h-=E<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=f,n.bits=h}},function(e,t,n){"use strict";var i=n(6),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,u,d,p){var f,h,g,m,v,y,S,_,E,T=p.bits,C=0,I=0,A=0,b=0,R=0,O=0,P=0,N=0,M=0,w=0,D=null,L=0,k=new i.Buf16(16),x=new i.Buf16(16),F=null,U=0;for(C=0;C<=15;C++)k[C]=0;for(I=0;I<c;I++)k[t[n+I]]++;for(R=T,b=15;b>=1&&0===k[b];b--);if(R>b&&(R=b),0===b)return l[u++]=20971520,l[u++]=20971520,p.bits=1,0;for(A=1;A<b&&0===k[A];A++);for(R<A&&(R=A),N=1,C=1;C<=15;C++)if(N<<=1,(N-=k[C])<0)return-1;if(N>0&&(0===e||1!==b))return-1;for(x[1]=0,C=1;C<15;C++)x[C+1]=x[C]+k[C];for(I=0;I<c;I++)0!==t[n+I]&&(d[x[t[n+I]]++]=I);if(0===e?(D=F=d,y=19):1===e?(D=r,L-=257,F=o,U-=257,y=256):(D=a,F=s,y=-1),w=0,I=0,C=A,v=u,O=R,P=0,g=-1,m=(M=1<<R)-1,1===e&&M>852||2===e&&M>592)return 1;for(;;){S=C-P,d[I]<y?(_=0,E=d[I]):d[I]>y?(_=F[U+d[I]],E=D[L+d[I]]):(_=96,E=0),f=1<<C-P,A=h=1<<O;do{l[v+(w>>P)+(h-=f)]=S<<24|_<<16|E|0}while(0!==h);for(f=1<<C-1;w&f;)f>>=1;if(0!==f?(w&=f-1,w+=f):w=0,I++,0==--k[C]){if(C===b)break;C=t[n+d[I]]}if(C>R&&(w&m)!==g){for(0===P&&(P=R),v+=A,N=1<<(O=C-P);O+P<b&&!((N-=k[O+P])<=0);)O++,N<<=1;if(M+=1<<O,1===e&&M>852||2===e&&M>592)return 1;l[g=w&m]=R<<24|O<<16|v-u|0}}return 0!==w&&(l[v+w]=C-P<<24|64<<16|0),p.bits=R,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function e(e){var t=this;this.handleMessage=function(e){if(!t.isMessageForExistingCall(e))return{isHandled:!1};if(e.url.search(new RegExp("/"+i.default.URL_BASE.CALLAGENT+"/","i"))>-1){var n=t.signalingAgent.handleIncomingNotification(e);return"number"==typeof n?{isHandled:!0,resultCode:n}:{isHandled:!0,resultCode:n.resultCode,responseBody:n.responseBody,responseHeaders:n.responseHeaders}}return{isHandled:!1}},this.signalingAgent=e}return e.prototype.isMessageForExistingCall=function(e){return!e.eventId},e}();t.default=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(50),a=n(68),s=n(3),c=n(29),l=function(){function e(e){this.logger=e.createChild("RequestDispatcher")}return e.prototype.getRequestOptions=function(e,t,n,i){return{headers:t||{},timeout:i,payload:n||null}},e.prototype.getAsync=function(e,t){return this.sendRequest(e,t,"GET")},e.prototype.postAsync=function(e,t){return this.sendRequest(e,t,"POST")},e.prototype.putAsync=function(e,t){return this.sendRequest(e,t,"PUT")},e.prototype.removeAsync=function(e,t){return this.sendRequest(e,t,"DELETE")},e.prototype.sendRequest=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,function(){var i,l,u,d,p,f;return r(this,function(r){switch(r.label){case 0:(i=this.logger.createChild("["+(t.causeId||a.generateCauseId())+"][Request]")).info("sending, "+n+"-"+e),l=Date.now(),t.headers=t.headers||{},t.headers["content-type"]||(t.headers["content-type"]=t.contentType||"application/json"),r.label=1;case 1:return r.trys.push([1,3,,4]),d=o.default.request({url:e,method:n,headers:t.headers||{},timeout:"number"==typeof t.timeout?t.timeout:45e3,data:t.payload||"",responseType:t.responseType||t.dataType||"json",withCredentials:(h=t.withCredentials,void 0!==h&&h),cancelToken:new o.default.CancelToken(function(e){u=e})}),c.isPromiseLike(t.timeout)&&t.timeout.then(function(){i.info("Aborting pending request"),u()},function(){i.info("Timeout promise rejected, ignoring")}),[4,d];case 2:return p=r.sent(),i.info("success, status="+p.status),[2,{response:p.data,request:p.request,duration:Date.now()-l}];case 3:if(f=r.sent(),i.info("failed"),o.default.isCancel(f))throw i.info("response="+s.safeJsonStringify(f.response)),{aborted:!0};throw f.response?i.info("response="+s.safeJsonStringify(f.response)):f.request?i.info("no response, request="+s.safeJsonStringify(f.request)):i.info("request not made, error="+s.safeJsonStringify(f)),f||new Error("Request failed");case 4:return[2]}var h})})},e}();t.default=l},function(e,t,n){e.exports=n(51)},function(e,t,n){"use strict";var i=n(4),r=n(20),o=n(52),a=n(27);function s(e){var t=new o(e),n=r(o.prototype.request,t);return i.extend(n,o.prototype,t),i.extend(n,t),n}var c=s(n(23));c.Axios=o,c.create=function(e){return s(a(c.defaults,e))},c.Cancel=n(28),c.CancelToken=n(66),c.isCancel=n(22),c.all=function(e){return Promise.all(e)},c.spread=n(67),e.exports=c,e.exports.default=c},function(e,t,n){"use strict";var i=n(4),r=n(21),o=n(53),a=n(54),s=n(27);function c(e){this.defaults=e,this.interceptors={request:new o,response:new o}}c.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},c.prototype.getUri=function(e){return e=s(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],function(e){c.prototype[e]=function(t,n){return this.request(i.merge(n||{},{method:e,url:t}))}}),i.forEach(["post","put","patch"],function(e){c.prototype[e]=function(t,n,r){return this.request(i.merge(r||{},{method:e,url:t,data:n}))}}),e.exports=c},function(e,t,n){"use strict";var i=n(4);function r(){this.handlers=[]}r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=r},function(e,t,n){"use strict";var i=n(4),r=n(55),o=n(22),a=n(23);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=r(e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function(t){return s(e),t.data=r(t.data,t.headers,e.transformResponse),t},function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=r(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,n){"use strict";var i=n(4);e.exports=function(e,t,n){return i.forEach(n,function(n){e=n(e,t)}),e}},function(e,t,n){"use strict";var i=n(4);e.exports=function(e,t){i.forEach(e,function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])})}},function(e,t,n){"use strict";var i=n(26);e.exports=function(e,t,n){var r=n.config.validateStatus;!r||r(n.status)?e(n):t(i("Request failed with status code "+n.status,n.config,null,n.request,n))}},function(e,t,n){"use strict";e.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var i=n(60),r=n(61);e.exports=function(e,t){return e&&!i(t)?r(e,t):t}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var i=n(4),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(i.forEach(e.split("\n"),function(e){if(o=e.indexOf(":"),t=i.trim(e.substr(0,o)).toLowerCase(),n=i.trim(e.substr(o+1)),t){if(a[t]&&r.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}}),a):a}},function(e,t,n){"use strict";var i=n(4),r=n(64);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function o(e){var i=e;if(r(e))throw new Error("URL contains XSS injection attempt");return t&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=o(window.location.href),function(t){var n=i.isString(t)?o(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";e.exports=function(e){return/(\b)(on\w+)=|javascript|(<\s*)(\/*)script/gi.test(e)}},function(e,t,n){"use strict";var i=n(4);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,n,r,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),i.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),i.isString(r)&&s.push("path="+r),i.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var i=n(28);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new i(e),t(n.reason))})}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r(function(t){e=t}),cancel:e}},e.exports=r},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateCauseId=function(){for(var e="abcdef0123456789".length,t="",n=0;n<8;n++)t+="abcdef0123456789".charAt(Math.floor(Math.random()*e));return t},t.validateCauseId=function(e){return new RegExp("^[a-f0-9]{8}$").test(e)&&8===e.length}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(70),o=n(3),a=n(71),s=n(72),c=n(19),l=n(30),u=n(73),d=n(5),p=n(1),f=n(2),h=n(0),g=function(){function e(e){var t=this;this.endpointId=h.newGuid(),this.signalingSessions={},this.getNewSignalingSession=function(e,n,i,r){var o=h.causeId();h.assertNotNull(e,"selfParticipant should be a non null value"),h.assertNotNull(n,"signalingSessionCallback should be a non null value");var a=i||h.newGuid();h.assertNotNullOrEmpty(a,"signalingSession id generated cannot be null or empty"),t.checkConfigChange(o);var s=u.build(e,n,t.signalingAgentConfig,a,t,r),c=s.sessionId;return t.signalingSessions[c]=s,t.logger.info("["+o+"]Created new signalingSession with correlation ID "+a+" and session ID "+c),s},this.resolvePotentialCallConflict=function(e){var n,i=h.causeId();if(t.logger.info("["+i+"][resolvePotentialCallConflict]"),!e.multiParty)return Object.keys(t.signalingSessions).forEach(function(i){t.isSessionInConflictingState(t.signalingSessions[i],!e.isIncomingCall)&&(n=e.isIncomingCall?t.compareAndGetConflictingSession(e,t.signalingSessions[i]):t.compareAndGetConflictingSession(t.signalingSessions[i],e))}),n?(t.logger.info("Call conflict done, conflicting session callId=",n.correlationId,"urlIdentifier=",n.urlIdentifier),n.telemetryHelper.recordEvent(d.EVENTS.CONFLICTED_CALL),t.signalingAgentConfig.endConflictedCall?(t.endConflictedSession(n,i),n):void 0):void 0},this.handleIncomingNotification=function(e){if(h.assertNotNull(e,"request should be a non null value"),t.logger.info("handleIncomingNotification to : "+e.url),!e.body&&!e.rawBody)return t.logger.error("request has no body"),t.buildNotificationResponse(p.default.HTTP_STATUS_CODES.BAD_REQUEST);var n=p.default.HTTP_STATUS_CODES.OK,i=f.getIdFromUrl(e.url);if(i){var r=t.signalingSessions.hasOwnProperty(i);if(t.logger.info("Is session found:"+r),r){var a=t.signalingSessions[i];if(h.isEncodedMessage(e.headers))try{if(!h.isMessageEncodingSupported(e.headers))throw new Error("Unsupported encoding");var s=h.decodeMessage(e.rawBody),c=JSON.parse(s);e.body=c}catch(e){return a.telemetryHelper.recordEvent(d.EVENTS.TROUTER_DECODE_PAYLOAD_FAILURE),t.buildNotificationResponse(p.default.HTTP_STATUS_CODES.BAD_REQUEST)}if(a.canHandleIncomingMsgSync(e))return a.handleIncomingMsgSync(e);window.setTimeout(function(){if(t.signalingSessions.hasOwnProperty(i)){var n=t.signalingSessions[i];n.handleIncomingMsgAsync(e).catch(function(e){n&&n.telemetryHelper&&n.telemetryHelper.recordEvent(d.EVENTS.FAILED_TO_HANDLE_TROUTER_MESSAGE),t.logger.error("handling IncomingMsg failed with error: "+e)})}},0)}else t.logger.info("Incoming message for session ID "+i+", but session was not found!"),n=p.default.HTTP_STATUS_CODES.NOT_FOUND}else t.logger.error("Could not retrieve session ID from Url path. Path = "+e.url),n=p.default.HTTP_STATUS_CODES.BAD_REQUEST;var l=t.buildNotificationResponse(n);return t.logger.info("Result code:"+o.getPrintableObject(l)),l},this.onCallCompleted=function(e,n){t.signalingSessions.hasOwnProperty(e)?(delete t.signalingSessions[e],t.logger.info("["+n+"][onCallCompleted] Session ID "+e+" found. Deleted from signalingSession table")):t.logger.info("["+n+"][onCallCompleted] Session ID "+e+" not found. Could not delete from signalingSession table")},this.applyAuthTokenCacheConfig=function(e){t.signalingAgentConfig.enableTokenCache?(t.authTokenManager.setTokenCaching(!0,e),t.signalingAgentConfig.enableTokenPrefetch&&t.authTokenManager.getToken(e).then(function(){t.logger.info("["+e+"] token prefetch success")}).catch(function(n){t.logger.info("["+e+"] token prefetch failure, error="+o.getPrintableObject(n))})):t.authTokenManager.setTokenCaching(!1,e)},this.endConflictedSession=function(e,n){t.logger.info("Call conflict, ending signalingSession with callId=",e.correlationId,"urlIdentifier=",e.urlIdentifier),e.endAsync({code:p.default.CALL_END_CODE.CONFLICT,subCode:p.default.CALL_END_SUB_CODE.CONFLICT_IN_NG,phrase:p.default.CALL_END_PHRASE.CONFLICT},{forEveryone:!1,causeId:n})},this.compareAndGetConflictingSession=function(e,t){if(h.is1to1Mri(e.incomingCallCallerId)&&h.is1to1Mri(t.participantManager.localParticipant.id)){var n=h.stripMri(e.incomingCallCallerId),i=h.stripMri(t.participantManager.getParticipantsToInitiateCallWith().length&&t.participantManager.getParticipantsToInitiateCallWith()[0].id),r=h.stripMri(t.participantManager.localParticipant.id);if(i===n)return r>n?e:t}},this.isSessionInConflictingState=function(e,n){if(!e)return t.logger.info("Call conflict, ignore, session already disposed"),!1;var i=[p.default.CALL_STATUS.IDLE,p.default.CALL_STATUS.CONNECTING,p.default.CALL_STATUS.RINGING];return!e.multiParty&&i.indexOf(e.getCallStatus())>-1&&(n&&e.isIncomingCall||!n&&!e.isIncomingCall)},this.buildNotificationResponse=function(e,n){return t.signalingAgentConfig.supportsSynchronousTrouterResponse?{resultCode:e,responseBody:n}:e},c.default(e),this.signalingAgentConfig=e,this.logger=e.logger.createChild("SignalingAgent"),h.assertNotNull(e,"signalingAgentConfig should be a non null value"),this.logger.info(e.isWebRtcEnabled?"webRTC enabled":"ORTC enabled"),this.authTokenManager=s.authTokenManagerFactory.build(this.logger,e.skypeToken),this.applyAuthTokenCacheConfig(h.causeId())}return e.prototype.updateSignalingAgentConfig=function(e){var t=h.causeId(),n=JSON.stringify(e,function(e,t){return e?String(t):t});this.logger.info("["+t+"] updateSignalingAgentConfig, SignalingAgentConfig: "+n),this.logger.info("["+t+"] ecsEtag="+e.ecsEtag),c.default(e),this.updatedSignalingAgentConfig=e},e.prototype.updateUrls=function(e,t,n){this.logger.info("updateUrls: conversationServiceUrl: "+e+", uploadLogRequestUrl: "+t+", enforceUrls: "+n),this.updatedSignalingAgentConfig=this.updatedSignalingAgentConfig||this.signalingAgentConfig,n||!this.updatedSignalingAgentConfig.isConversationServiceUrlFromEcs?this.updatedSignalingAgentConfig.conversationServiceUrl=e||this.updatedSignalingAgentConfig.conversationServiceUrl:this.updatedSignalingAgentConfig.conversationServiceUrl=this.updatedSignalingAgentConfig.conversationServiceUrl||e,n||!this.updatedSignalingAgentConfig.isUploadLogRequestUrlFromEcs?this.updatedSignalingAgentConfig.uploadLogRequestUrl=t||this.updatedSignalingAgentConfig.uploadLogRequestUrl:this.updatedSignalingAgentConfig.uploadLogRequestUrl=this.updatedSignalingAgentConfig.uploadLogRequestUrl||t},e.prototype.sendPushAsync=function(e,t,n,o,s){var c=this;void 0===s&&(s=h.causeId());var u=new l.default(this.signalingAgentConfig.piiScrubber),d="sendPush[local participant mri = "+u.scrubMriOrOmit(e)+"][recipientList = "+u.scrubMriOrOmit(t)+"][headers = "+n+")][causeId = "+s+"]";if(!e||!e.id)return this.logger.info(d+" Empty localParticipantId"),Promise.reject("invalid localParticipantId");if(!t||0===t.length||t.every(function(e){return e&&""===e.id}))return this.logger.info(d+" Empty recipientList"),Promise.reject("invalid recipientList");if(!n)return this.logger.info(d+" Empty headers"),Promise.reject("invalid headers");if(!o||null===h.tryParse(o))return this.logger.info(d+" Invalid body."),Promise.reject("invalid body");var f=i({},h.tryParse(o),{To:Array.from(t,function(e){return e.id}),From:e.id});n.hasOwnProperty(p.default.HEADERS.CORRELATION_ID)||(n[p.default.HEADERS.CORRELATION_ID]=r.default()),n.hasOwnProperty(p.default.HEADERS.MESSAGE_ID)||(n[p.default.HEADERS.MESSAGE_ID]=r.default()),n.hasOwnProperty(p.default.HEADERS.PARTICIPANT_ID)||(n[p.default.HEADERS.PARTICIPANT_ID]=r.default()),n.hasOwnProperty(p.default.HEADERS.CONTENT_TYPE)||(n[p.default.HEADERS.CONTENT_TYPE]="application/json"),n.hasOwnProperty(p.default.HEADERS.CLIENT_USER_AGENT)&&(n[p.default.HEADERS.CLIENT_USER_AGENT]+="/TsCallingVersion="+a.getTsCallingVersion()+"/Ovb="+a.getOvb());var g=this.signalingAgentConfig.httpRequestDispatcher.getRequestOptions("POST",n,JSON.stringify(f),3e4);return new Promise(function(e,t){c.signalingAgentConfig.httpRequestDispatcher.postAsync(c.signalingAgentConfig.uploadLogRequestUrl||p.default.URL_DEFAULTS.UPLOAD_LOG_URL,g).then(function(t){e()}).catch(function(e){t(e)})})},e.prototype.getSignalingSession=function(e){for(var t=0,n=Object.keys(this.signalingSessions);t<n.length;t++){var i=n[t],r=this.signalingSessions[i];if(r.correlationId===e)return r}return null},e.prototype.checkConfigChange=function(e){this.updatedSignalingAgentConfig&&this.updatedSignalingAgentConfig!==this.signalingAgentConfig&&(this.signalingAgentConfig=this.updatedSignalingAgentConfig,this.updatedSignalingAgentConfig=null,this.applyAuthTokenCacheConfig(e))},e}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTsCallingVersion=function(){return"2020.50.01.4"},t.getOvb=function(){return"587c7ff24ac5681c14314c05f8a3f250899b0377"}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=function(){function e(e,t){this.tokenProvider=t,this.tokenCachingEnabled=!1,this.cachedToken="",this.lastToken="",this.logger=e.createChild("TokenManager")}return e.prototype.setTokenCaching=function(e,t){this.tokenCachingEnabled!==e&&(this.logger.info("setTokenCaching="+e),this.tokenCachingEnabled=e)},e.prototype.getToken=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,function(){var n,i;return r(this,function(r){switch(r.label){case 0:if(t&&this.invalidateCachedToken(e),this.cachedToken&&this.tokenCachingEnabled)return this.logger.info("["+e+"][getToken] returning cached token this.cachedToken "+this.cachedToken),[2,Promise.resolve(this.cachedToken)];r.label=1;case 1:return r.trys.push([1,3,,4]),this.logger.info("["+e+"][getToken] fetching new token"),[4,this.tokenProvider()];case 2:return(n=r.sent())?(this.tokenCachingEnabled&&(this.cachedToken=n),this.lastToken=n,this.logger.info("["+e+"][getToken] fetching new token, success token "+n),[2,n]):(this.logger.info("["+e+"][getToken] received empty token"),[2,Promise.reject("Received empty token")]);case 3:throw i=r.sent(),this.logger.info("["+e+"][getToken] failed to fetch token="+o.getPrintableObject(i)),this.cachedToken="",i;case 4:return[2]}})})},e.prototype.invalidateCachedToken=function(e){this.cachedToken&&(this.logger.info("["+e+"][invalidateCachedToken]"),this.cachedToken="")},e.prototype.getLastToken=function(e){return this.logger.info("["+e+"][getLastToken]"),this.lastToken},e}();t.AuthTokenManager=a,t.authTokenManagerFactory={build:function(e,t){return new a(e,t)}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(74),a=n(3),s=n(75),c=n(29),l=n(76),u=n(77),d=n(78),p=n(79),f=n(88),h=n(92),g=n(10),m=n(96),v=n(30),y=n(32),S=n(116),_=n(117),E=n(118),T=n(119),C=n(120),I=n(121),A=n(122),b=n(123),R=n(124),O=n(125),P=n(126),N=n(127),M=n(128),w=n(129),D=n(130),L=n(131),k=n(132),x=n(133),F=n(134),U=n(135),j=n(136),H=n(137),B=n(138),G=n(139),V=n(140),W=n(141),q=n(142),K=n(143),z=n(144),J=n(5),Y=n(145),Q=n(1),X=n(12),$=n(8),Z=n(0),ee=n(150),te=function(){function e(e,t,n,g,S,E){var C=this;this.disposed=!1,this.convSubject=null,this.threadId=null,this.incomingCallCallerId=null,this.incomingCallPayload=null,this.multiParty=!0,this.isIncomingCall=!1,this.isHostLessCall=!1,this.isCastCall=!1,this.numberOfOriginalInvitees=0,this.teamsMessageId=null,this.enableGroupCallMeetupGeneration=!1,this.meetingInfo=null,this.meetingDetails=null,this.emergencyContent=null,this.transferContext=null,this.callType="default",this.transferor=null,this.onBehalfOf=null,this.endpointMetadata={},this.sessionId=Z.newGuid(),this.remoteCaller=null,this.acceptedElsewhereBy=null,this.disposing=!1,this.links={},this.provisionalMediaAnswersSeenSoFar=[],this.incomingTrouterMessagesSeenSoFar=[],this.incomingBrokerMessagesSeenSoFar=[],this.currentCallStatus=null,this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,this.convJoined=!1,this.keepAliveTimer=null,this.keepAliveInterval=null,this.keepAliveCount=1,this.remoteUser=null,this.mediaTypesToUse=null,this.lastUsedOutgoingMediaContent=null,this.lastUsedJoinCallOptions=null,this.originalRoleBeforePreheat="",this.endpointStateSequenceNumber=0,this.publishStateSequenceNumber=0,this.linkUpdateRequested={conversationLinks:!1,keepAliveLinks:!1},this.incomingMessageSyncResponseCache={},this.joinedLightWeight=!1,this.isPreheatOnly=!1,this.callStartTime=(new Date).getTime(),this.callUsesMixer=!1,this.disablePreheatDefer=Z.defer(),this.participantReplacementDetails={},this.updateEndpointState=function(e,t){void 0===t&&(t=Z.causeId()),C.logger.info("["+t+"][updateEndpointState="+a.getPrintableObject(e.state)+"]");var n=C.links[Q.default.LINKS.UPDATE_ENDPOINT_STATE],r=C.getEndpointState(),o=i({},r,e,{endpointStateSequenceNumber:++C.endpointStateSequenceNumber});C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_ENDPOINT_STATE,{newEndpointState:o,causeId:t});var s=function(e){return e&&e.endpointProperties&&0===e.endpointProperties.preheatProperties};return s(o)&&C.isPreheatOnly&&(C.telemetryHelper.recordEvent(J.EVENTS.PREHEAT_DISABLING,{causeId:t}),C.telemetryHelper.startPreheatedCallSetupDurationWatch(),C.telemetryHelper.startCallCancelationDurationWatch()),C.fsmState!==Q.default.SIGNALING_FSM_STATE.CONNECTED?(C.logger.info("["+t+"][updateEndpointState will be queued as we don't have a link yet]"),C.requestedEndpointStateWhileConnecting=e,s(o)?C.disablePreheatDefer.promise:Promise.resolve()):C.shouldUpdateEndpointState(r,o)||C.http.hasPendingRequest(J.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE)?n?(C.latestEndpointState=o,C.http.sendPostRequest({url:n,requestName:J.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE,payload:V.getPayload(C,o),causeId:t}).then(function(){C.disposed||(C.requestedEndpointStateWhileConnecting=null,s(o)&&C.handlePreheatDisabled(t))}).catch(function(e){var n=Z.getErrorForXHRFailure(e);return C.logger.info("["+t+"][updateEndpointState] error: "+a.getPrintableObject(n)),Promise.reject(n.error)})):(C.logger.info("["+t+"][updateEndpointState operation cannot be performed now, the link is not yet available]"),Promise.reject("No link")):(C.logger.info("["+t+"][updateEndpointState will ignore current update as there is nothing new to send]"),Promise.reject("Ignored"))},this.setParticipantCallLinks=function(e){e&&e.endpointDetails&&(C.participantReplacementDetails[e.id]={},e.endpointDetails.forEach(function(t){t&&t.callLinks&&(C.participantReplacementDetails[e.id][t.participantId]=t.callLinks)}))},this.clearParticipantCallLinks=function(e){C.participantReplacementDetails&&C.participantReplacementDetails.hasOwnProperty(e)&&delete C.participantReplacementDetails[e]},this.getParticipantReplacementDetails=function(e,t,n){return void 0===n&&(n=Z.causeId()),C.logger.info("getParticipantReplacementDetails["+n+"] participantMri "+a.getPIISafeObject(e)+" participantLegId "+t),C.participantReplacementDetails&&C.participantReplacementDetails.hasOwnProperty(e)&&C.participantReplacementDetails[e].hasOwnProperty(t)?{replaces:C.participantReplacementDetails[e][t].replacement}:(C.logger.info("getParticipantReplacementDetails["+n+"] unable to find replacement details for participantLegId "+t),{})},this.getParticipantReplacementDetailsForCall=function(e,t,n,i){void 0===i&&(i=Z.causeId()),C.logger.info("getParticipantReplacementDetailsForCall["+i+"] callId "+e+" participantMri "+a.getPIISafeObject(t)+" participantLegId "+n);var r=C.signalingAgent.getSignalingSession(e);return r?r.getParticipantReplacementDetails(t,n,i):{}},this.handlePreheatDisabled=function(e){C.isPreheatOnly=!1,C.telemetryHelper.setSelfParticipantRole(C.originalRoleBeforePreheat),C.telemetryHelper.recordEvent(J.EVENTS.PREHEAT_DISABLED,{causeId:e}),C.telemetryHelper.resetCallCancelationDurationWatch(),C.telemetryHelper.stopPreheatedCallSetupDurationWatch(),C.telemetryHelper.startCallConnectedWatch(),C.stopCallPreheatTimer(),C.disablePreheatDefer.isPending()&&C.disablePreheatDefer.resolve()},this.shouldUpdateEndpointState=function(e,t){if(!t)return!1;var n=t.state&&!0===t.state.isMuted?1:0,i=t.endpointProperties&&1===t.endpointProperties.preheatProperties?1:0,r=e&&e.state&&1==!!e.state.isMuted?1:0,o=e&&e.endpointProperties&&1===e.endpointProperties.preheatProperties?1:0;return!!(n^r||i^o)},this.setInitialTelemetry=function(e,t){switch(e){case o.CALL_OPERATIONS.SUBSCRIBE:C.telemetryHelper.recordEvent(J.EVENTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,{causeId:t.causeId,correlationId:t.correlationId}),C.telemetryHelper.setDirection(J.default.DIRECTION.INCOMING),C.telemetryHelper.setSelfParticipantRole(J.default.ROLE.JOIN_FOR_ROSTER_ONLY),C.telemetryHelper.setConversationServiceUrl(t.conversationServiceUrl||C.signalingAgentConfig.conversationServiceUrl),C.telemetryHelper.setCallerType(C.participantManager.localParticipant.id);break;case o.CALL_OPERATIONS.ACKNOWLEDGE:C.telemetryHelper.recordEvent(J.EVENTS.HANDLE_INCOMING_CALL,{causeId:t.causeId}),C.telemetryHelper.setDirection(J.default.DIRECTION.INCOMING),C.telemetryHelper.setSelfParticipantRole(J.default.ROLE.CALLEE),C.telemetryHelper.setCalleeType(C.participantManager.localParticipant.id);break;case o.CALL_OPERATIONS.JOIN_CALL:var n=C.gatherTelemetryForStartOrJoin(t.joinCallOptions,t.causeId,t.offerGenerationTime);C.telemetryHelper.recordEvent(J.EVENTS.JOIN_CALL,n),C.telemetryHelper.setDirection(J.default.DIRECTION.INCOMING),C.telemetryHelper.setSelfParticipantRole(J.default.ROLE.JOIN);break;case o.CALL_OPERATIONS.START_CALL:case o.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL:case o.CALL_OPERATIONS.START_CALL_WITH_NUDGE:case o.CALL_OPERATIONS.START_CALL_AND_UNPARK:var i=C.gatherTelemetryForStartOrJoin(t.callStartOptions,t.causeId,t.offerGenerationTime);C.telemetryHelper.recordEvent(J.EVENTS.START_CALL,i),C.telemetryHelper.setDirection(J.default.DIRECTION.OUTGOING),C.telemetryHelper.setSelfParticipantRole(J.default.ROLE.CALLER),C.telemetryHelper.startCallInitializationWatch(t.offerGenerationTime),C.telemetryHelper.setMeetingInfo(C.getMeetingInfo())}},this.getParticipantIdForOfferAnswer=function(e){Z.assertNotNull(e,"mediaContent should be a non null value"),C.logger.info("getParticipantIdForOfferAnswer");var t=null;return!C.remoteUser||C.threadId||e.newOffer||e.escalationOccurring||(t=C.remoteUser.id),t},this.getMeetingInfo=function(){return C.telemetryHelper.recordEvent(J.EVENTS.GET_MEETING_INFO),C.meetingInfo},this.getEmergencyContent=function(){return C.telemetryHelper.recordEvent(J.EVENTS.GET_EMERGENCY_CONTENT),C.emergencyContent},this.getEndpointId=function(){return C.signalingAgent.endpointId},this.getConversationUrl=function(){return C.links[Q.default.LINKS.CONVERSATION_CONTROLLER]},this.setSubject=function(e){C.disposed||(C.telemetryHelper.recordEvent(J.EVENTS.SET_SUBJECT),Z.assertNotNull(e,"subject should be a non null value"),C.convSubject=e)},this.setDeviceType=function(e){C.disposed||(C.telemetryHelper.recordEvent(J.EVENTS.SET_DEVICETYPE),e&&(C.deviceType=e,C.logger.info("setDeviceType",C.deviceType)))},this.setOfferAnswerGenerationTimestamps=function(e){C.disposed||C.telemetryHelper.setOfferAnswerGenerationTimestamps(e)},this.setTimeToRingDuration=function(){C.disposed||C.telemetryHelper.setTimeToRingDuration()},this.setThreadId=function(e){C.telemetryHelper.recordEvent(J.EVENTS.SET_THREADID),Z.assertNotNull(e,"threadId should be a non null value"),C.threadId!==e&&(Z.assert(!C.threadId,"conversation threadId has already been set. It cannot be overwritten"),C.threadId=e)},this.setCallOptions=function(e){if(Z.assertNotNull(e,"callOptions should be a non null value"),C.logger.info("setCallOptions",a.getPrintableObject(e)),C.telemetryHelper.recordEvent(J.EVENTS.SET_CALLOPTIONS),e){C.teamsMessageId=e.teamsMessageId||null,C.meetingInfo=e.meetingInfo||null,C.emergencyContent=e.emergencyContent||null,C.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration||!1,C.broadcastSession.setContext(e.broadcastContext);try{C.endpointMetadata=JSON.parse(e.endpointMetadata)}catch(e){C.logger.warn("Unable to parse endpoint metadata")}}},this.setTransferContext=function(e){Z.assertNotNull(e,"transferContext should not be null"),C.logger.info("Transfer: setTransferContext",e),C.telemetryHelper.recordEvent(J.EVENTS.SET_TRANSFER_CONTEXT),C.transferContext=e},this.muteAsync=function(e,t,n){return void 0===n&&(n=Z.causeId()),C.logger.info("["+n+"][muteAsync][scope="+e+"]"),C.telemetryHelper.recordEvent(J.EVENTS.MUTE,{causeId:n}),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"["+n+"]mute operation for all or specified only allowed in a connected call"),C.participantManager.muteAsync(C.links[Q.default.LINKS.MUTE],e,t,n)},this.unmuteAsync=function(e){return void 0===e&&(e=Z.causeId()),C.logger.info("["+e+"][unmuteAsync]"),C.telemetryHelper.recordEvent(J.EVENTS.UNMUTE,{causeId:e}),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"unmute operation only allowed in a connected call"),C.participantManager.unmuteAsync(C.links[Q.default.LINKS.UNMUTE],e)},this.recordTelemetryForStartAudio=function(e,t){return C.telemetryHelper.recordEvent(J.EVENTS.START_AUDIO,{mediaNegotiationStatus:e,causeId:t}),Promise.resolve(null)},this.recordTelemetryForStopAudio=function(e,t){return C.telemetryHelper.recordEvent(J.EVENTS.STOP_AUDIO,{mediaNegotiationStatus:e,causeId:t}),Promise.resolve(null)},this.rejectUnmuteRequestAsync=function(e,t,n){return void 0===t&&(t=Z.causeId()),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"rejectUnmute operation only allowed in a connected call"),Z.assertNotNullOrEmpty(e,"requestor must be specified"),C.logger.info("["+t+"][rejectUnmuteRequestAsync][rejectionReason="+n+"]"),C.telemetryHelper.recordEvent(J.EVENTS.REJECT_UNMUTE,{causeId:t,rejectionReason:n}),C.participantManager.rejectUnmuteRequestAsync(e,t,n)},this.approveUnmuteRequestAsync=function(e,t){return void 0===t&&(t=Z.causeId()),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"approveUnmute operation only allowed in a connected call"),Z.assertNotNullOrEmpty(e,"requestor must be specified"),C.logger.info("["+t+"][approveUnmuteRequestAsync]"),C.telemetryHelper.recordEvent(J.EVENTS.APPROVE_UNMUTE,{causeId:t}),C.participantManager.approveUnmuteRequestAsync(e,t)},this.sendWebRtcMediaNotificationAsync=function(e,t,n){return void 0===n&&(n=Z.causeId()),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"webRtc media notification can only be sent in a connected call"),C.telemetryHelper.recordEvent(J.EVENTS.SEND_WEBRTC_MEDIA_NOTIFICATION,{causeId:n}),0===e?C.webRtcSignalingManager.sendWebRtcMediaNotificationAsync({operation:J.NETWORK_REQUESTS.SEND_APPLY_CHANNEL_PARAMETERS,requestUrl:C.links[Q.default.LINKS.APPLY_CHANNEL_PARAMETERS],requestBody:t,stackRetry:!1},n):C.webRtcSignalingManager.sendWebRtcMediaNotificationAsync({operation:J.NETWORK_REQUESTS.SEND_CONTROL_VIDEO_STREAMING,requestUrl:C.links[Q.default.LINKS.CONTROL_VIDEO_STREAMING],requestBody:t},n)},this.addParticipantsAsync=function(e,t,n){void 0===n&&(n=Z.causeId()),Z.assertNotNullOrEmpty(e,"remoteParticipants should be a non null value"),Z.assert(C.isCallOngoing()||C.isCallInProgress(),"remoteParticipants can only be added before starting an outgoing call or to an ongoing call"),C.logger.info("["+n+"][addParticipantsAsync][addParticipantOptions="+a.getPrintableObject(t)+"]\n            [remoteParticipantId="+e.map(function(e){return C.piiUtils.scrubMriOrOmit(e.id)})+"]");var i=J.EVENTS.ADD_PARTICIPANT;switch(t.replacementType){case 2:i=J.EVENTS.ADD_PARTICIPANT_WITH_PICKUP_CODE;break;case 1:case 3:i=J.EVENTS.ADD_PARTICIPANT_WITH_REPLACES;break;default:i=J.EVENTS.ADD_PARTICIPANT}C.telemetryHelper.recordEvent(i,{causeId:n}),t.threadId=C.threadId||t.threadId;var r=t.threadId?C.links[Q.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]:C.links[Q.default.LINKS.ADD_PARTICIPANT],o=C.participantManager.addParticipantsAsync(e,r,C.isCallConnectedOrConnectedForRoster(),t,n);return C.currentCallStatus||C.setMultiParty(1!==C.participantManager.getParticipantsToInitiateCallWith().length,n),o},this.addGroupModalityAsync=function(e,t){Z.assert(C.isCallOngoing(),"GroupModality can only be added before starting an outgoing call or to an ongoing call"),C.logger.info("["+t+"][addGroupModalityAsync][addGroupModalityOptions="+a.getPrintableObject(e)+"]");var n=J.EVENTS.ADD_PARTICIPANTS_AND_MODALITY;C.telemetryHelper.recordEvent(n,{causeId:t});var i=y.getPayload(C,null,e);return C.http.sendPostRequest({url:C.links[Q.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY],payload:i,requestName:J.NETWORK_REQUESTS.ADD_PARTICIPANTS_AND_MODALITY,causeId:t}).then(function(){return r.noop()}).catch(function(e){var n=Z.getErrorForXHRFailure(e);throw C.logger.info("["+t+"][sendNetworkRequestForAddingParticipant] failed:"+a.getPrintableObject(n)),n.error})},this.nudgeParticipantsAsync=function(e){if(Z.assertNotNull(e.participantsIds,"ParticipantsIds should be a non null value"),Z.assert(C.isCallOngoing(),"Participants can only be nudged before starting an outgoing call or to an ongoing call"),C.logger.info("["+e.causeId+"][nudgeParticipantsAsync][participantsIds="+C.piiUtils.scrubParticipantsList(e.participantsIds)+"][invitationData="+e.invitationData+"]"),void 0===e.participantsIds||e.participantsIds.length<1)return Promise.reject("List of participants to nudge is empty");C.telemetryHelper.recordEvent(J.EVENTS.ADD_PARTICIPANT,{withNudge:Q.default.INVITATION_TYPE.NUDGE,causeId:e.causeId});var t=C.threadId||e.newThreadId,n=C.teamsMessageId||e.newMessageId,i=t?C.links[Q.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]:C.links[Q.default.LINKS.ADD_PARTICIPANT];return C.participantManager.nudgeParticipantsAsync(e.participantsIds,i,C.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING||C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,e.causeId,e.invitationData,t,n)},this.callMeBackAsync=function(e,t){return void 0===t&&(t=Z.causeId()),Z.assertNotNull(e,"remoteParticipant should be a non null value"),C.logger.info("["+t+"][callMeBackAsync][remoteParticipantId="+C.piiUtils.scrubMriOrOmit(e.id)+"]"),C.telemetryHelper.recordEvent(J.EVENTS.CALL_ME_BACK,{causeId:t}),Z.assertNotNullOrEmpty(C.threadId,"threadId must be set before using call me back"),C.participantManager.callMeBackAsync(e,C.links[Q.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY],t)},this.removeParticipantAsync=function(e,t,n){switch(void 0===t&&(t=Z.causeId()),void 0===n&&(n="none"),Z.assertNotNull(e,"remoteParticipant should be a non null value"),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"participants can only be removed from an ongoing call"),C.logger.info("["+t+"][removeParticipantAsync][remoteParticipantId="+C.piiUtils.scrubMriOrOmit(e.id)+"] [removeEndpointScope] "+n),n){case"all":C.telemetryHelper.recordEvent(J.EVENTS.REMOVE_PARTICIPANT_OTHERS,{causeId:t});break;case"specified":C.telemetryHelper.recordEvent(J.EVENTS.REMOVE_PARTICIPANT_SPECIFIED,{causeId:t});break;default:C.telemetryHelper.recordEvent(J.EVENTS.REMOVE_PARTICIPANT,{causeId:t})}return"none"!==n&&e.endpointId?C.participantManager.removeParticipantEndpointAsync(e,C.links[Q.default.LINKS.REMOVE_PARTICIPANT],n,t):C.participantManager.removeParticipantAsync(e,C.links[Q.default.LINKS.REMOVE_PARTICIPANT],t)},this.admitParticipantAsync=function(e,t){return void 0===t&&(t=Z.causeId()),Z.assertNotNull(e,"remoteParticipant should be a non null value"),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"remoteParticipants can only be admitted to an ongoing call"),Z.assertNotNullOrEmpty(C.threadId,"threadId must be set before admitting more participants to connected call"),C.logger.info("["+t+"][admitParticipantAsync][remoteParticipantId="+C.piiUtils.scrubMriOrOmit(e.id)+"]"),C.telemetryHelper.recordEvent(J.EVENTS.ADMIT_PARTICIPANT,{causeId:t}),C.participantManager.admitParticipantAsync(e,C.links[Q.default.LINKS.ADMIT],t)},this.admitAsync=function(e){if(C.logger.info("["+e+"][admitAsync]"),C.telemetryHelper.recordEvent(J.EVENTS.ADMIT,{causeId:e}),!C.links[Q.default.LINKS.ADMIT_ALL]){var t={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.ADMIT_ALL_LINK_MISSING,phrase:Q.default.CALL_END_PHRASE.ADMIT_ALL_URL_MISSING};return C.telemetryHelper.recordEvent(J.EVENTS.ADMIT_FAILURE,{causeId:e,transactionEnd:t}),C.logger.warn("admitAsync error "+JSON.stringify(t)),Promise.reject(t)}var n=Z.defer();return C.callOperationHandler.setPendingOperation(0,e,{promise:n,causeId:e},e),C.sendNetworkRequestForAdmit(e),n.promise},this.updateMeetingRolesAsync=function(e,t,n){return void 0===n&&(n=Z.causeId()),Z.assertNotNull(e,"participants array should be a non null value"),Z.assertNotNull(t,"meetingRole should be a non null value"),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"remote participant roles can only be updated in an ongoing call"),C.logger.info("["+n+"][updateMeetingRolesAsync][participants="+C.piiUtils.scrubMriOrOmit(e)+"]"),C.participantManager.updateMeetingRolesAsync(e,t,C.links[Q.default.LINKS.UPDATE_PARTICIPANT_ROLE],n)},this.startContentSharingAsync=function(e,t,n,i,r){return void 0===r&&(r=Z.causeId()),Z.assertNotNull(e,"contentIdentifier should be a non null value"),Z.assert(C.isCallOngoing(),"contentSharing can only be added before starting an outgoing call or to an ongoing call"),C.logger.info("["+r+"][startContentSharingAsync]"),C.telemetryHelper.recordEvent(J.EVENTS.ADD_CONTENT_SHARING_MODALITY,{causeId:r}),C.contentSharingManager.startContentSharingAsync(e,t,n,C.links[Q.default.LINKS.ADD_MODALITY],C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,r,i)},this.deleteContentSharingAsync=function(e,t){return void 0===t&&(t=Z.causeId()),C.logger.info("["+t+"][deleteContentSharingAsync][correlationId="+e+"]"),C.telemetryHelper.recordEvent(J.EVENTS.DELETE_CONTENT_SHARING,{causeId:t,correlationId:e}),C.contentSharingManager.deleteContentSharingAsync(e,t)},this.joinContentSharingAsync=function(e,t){return void 0===t&&(t=Z.causeId()),C.logger.info("["+t+"][joinContentSharingAsync][correlationId="+e+"]"),C.telemetryHelper.recordEvent(J.EVENTS.JOIN_CONTENT_SHARING,{causeId:t,correlationId:e}),C.contentSharingManager.joinContentSharingAsync(e,t)},this.updateContentSharingSessionStateAsync=function(e,t,n){return void 0===n&&(n=Z.causeId()),Z.assertNotNull(t,"sessionState should be a non null value"),C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_SESSION_STATE_CONTENT_SHARING,{causeId:n,correlationId:e,sessionState:t}),C.logger.info("["+n+"][updateContentSharingSessionStateAsync][correlationId="+e+"][sessionState="+t+"]"),C.contentSharingManager.updateContentSharingSessionStateAsync(e,t,n)},this.takeContentSharingControlAsync=function(e,t){return void 0===t&&(t=Z.causeId()),C.telemetryHelper.recordEvent(J.EVENTS.TAKE_CONTROL_CONTENT_SHARING,{causeId:t,correlationId:e}),C.logger.info("["+t+"][takeContentSharingControlAsync][correlationId="+e+"]"),C.contentSharingManager.takeContentSharingControlAsync(e,t)},this.updateContentSharingParticipantStateAsync=function(e,t){return void 0===t&&(t=Z.causeId()),C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING,{causeId:t}),C.logger.info("["+t+"][updateContentSharingParticipantStateAsync][correlationId="+e+"]"),C.contentSharingManager.updateContentSharingParticipantStateAsync(e,t)},this.configureEndpointStateForStartOrJoin=function(e){var t={endpointStateSequenceNumber:C.endpointStateSequenceNumber},n=!1;if(e&&(!0===e.muted&&(n=!0,Object.assign(t,{state:{isMuted:e.muted}})),!0===e.isPreheatOnly&&(n=!0,Object.assign(t,{endpointProperties:{preheatProperties:1}}))),n)return t},this.gatherTelemetryForStartOrJoin=function(e,t,n){var i={causeId:t};return e&&(e.invitationType===Q.default.INVITATION_TYPE.NUDGE&&(i.withNudge=e.invitationType===Q.default.INVITATION_TYPE.NUDGE),e.parkContext&&(i.unpark=!0,i.context=e.parkContext),e.isLwj&&(i.isLwj=!0),e.isPreheatOnly&&(i.isPreheatOnly=!0)),i},this.startOutgoingCall=function(e,t,n,i,r){if(void 0===r&&(r=Z.causeId()),n&&n.isLwj?C.joinedLightWeight=!0:(Z.assertNotNull(e,"mediaContent should be a non null value"),Z.assertNotNull(e.blob,"outgoingSdp should be a non null value")),Z.assert(C.isCallInProgress(),"a call is already in progress"),C.logger.info("["+r+"][startOutgoingCall][start] applicationType="+C.participantManager.localParticipant.applicationType),C.disposed)C.logger.warn("["+r+"][startOutgoingCall][failed][reason=Session disposed]");else{C.lastUsedJoinCallOptions={muted:n?n.muted:null,scenario:n?n.scenario:null,isPreheatOnly:n?n.isPreheatOnly:null,clientEndpointCapabilities:n?n.clientEndpointCapabilities:null,clientEndpointDebugContent:n?n.clientEndpointDebugContent:null},C.originalRoleBeforePreheat=J.default.ROLE.CALLER,n&&n.scenario&&C.telemetryHelper.setScenario(n.scenario),C.logger.info("["+r+"][startOutgoingCall]options="+a.getPrintableObject(C.gatherTelemetryForStartOrJoin(n,r,i))),C.isBrokerEnabledForOutgoingCall()&&C.setupBrokerChannel(),C.callUsesMixer=!(!n||!n.callUsesMixer),C.fsmState=Q.default.SIGNALING_FSM_STATE.OUTGOING,C.meetingData=n&&n.meetingData,C.meetingPreferences=n&&n.meetingPreferences;var o={newCall:!0,suppressDialout:n&&n.suppressDialout||!1,conversationServiceUrl:C.signalingAgentConfig.conversationServiceUrl,onBehalfOf:n?n.onBehalfOf:null,enableLightWeightMeeting:n?n.isLwj:null,callToVoicemail:!!n&&n.callToVoicemail,voicemailResourcePath:n?n.voicemailResourcePath:null,voicemailItemId:n?n.voicemailItemId:null,endpointState:C.configureEndpointStateForStartOrJoin(n),invitationType:n&&n.invitationType?n.invitationType:null,participantsToNudge:n&&Array.isArray(n.participantsToNudge)?n.participantsToNudge:null,routingFlags:n?n.routingFlags:null,parkContext:n?n.parkContext:null,pickupCode:n?n.pickupCode:null,scenario:n?n.scenario:null,isPreheatOnly:!!n&&n.isPreheatOnly,applicationType:C.participantManager.localParticipant.applicationType,clientEndpointCapabilities:n?n.clientEndpointCapabilities:0,clientEndpointDebugContent:n?n.clientEndpointDebugContent:null,invitationData:n?n.invitationData:null,conversationType:n?C.getConversationType(n.isEmergency,n.castCall):null,meetingData:C.meetingData,meetingPreferences:C.meetingPreferences,alternateId:n?n.alternateId:null,meetingRegistrationId:n.meetingRegistrationId};C.isCastCall=n&&n.castCall,C.onBehalfOf=o.onBehalfOf,C.startOrJoinCall(o,J.NETWORK_REQUESTS.START_CALL,r,e,t)}},this.joinGivenConversation=function(e,t,n,i,r,o,s){if(void 0===o&&(o={}),void 0===s&&(s=Z.causeId()),Z.assertNotNull(t,"correlationId should be a non null value"),Z.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),o.isLwj?C.joinedLightWeight=!0:(Z.assertNotNull(n,"mediaContent should be a non null value"),Z.assertNotNull(n.blob,"outgoingSdp should be a non null value")),Z.assert(C.isCallInProgress(),"a call is already in progress"),C.logger.info("["+s+"][joinGivenConversation][start][correlationId="+t+"] applicationType="+C.participantManager.localParticipant.applicationType),C.disposed)C.logger.warn("["+s+"][joinGivenConversation][failed][reason=Session disposed]");else{var c=C.gatherTelemetryForStartOrJoin(o,s,r);C.lastUsedJoinCallOptions=o,C.originalRoleBeforePreheat=J.default.ROLE.JOIN,C.telemetryHelper.startCallInitializationWatch(r),o&&o.scenario&&C.telemetryHelper.setScenario(o.scenario),C.logger.info("["+s+"][joinGivenConversation]options="+a.getPrintableObject(c)),C.isBrokerEnabledForIncomingCall()&&C.setupBrokerChannel(),C.fsmState=Q.default.SIGNALING_FSM_STATE.OUTGOING,C.updateCorrelationId(t,s),C.meetingData=o&&o.meetingData,C.meetingPreferences=o&&o.meetingPreferences;var l={newCall:!1,suppressDialout:!0,conversationServiceUrl:e,enableLightWeightMeeting:o.isLwj,endpointState:C.configureEndpointStateForStartOrJoin(o),scenario:o?o.scenario:null,isPreheatOnly:!!o&&o.isPreheatOnly,applicationType:C.participantManager.localParticipant.applicationType,clientEndpointCapabilities:o?o.clientEndpointCapabilities:0,clientEndpointDebugContent:o?o.clientEndpointDebugContent:null,conversationType:o?C.getConversationType(o.isEmergency,!1):null,meetingPreferences:C.meetingPreferences,meetingData:C.meetingData,meetingRegistrationId:o.meetingRegistrationId};C.isCastCall=!1,C.startOrJoinCall(l,J.NETWORK_REQUESTS.JOIN_CONVERSATION,s,n,i)}},this.subscribeToCall=function(e,t,n,r,o){void 0===n&&(n=0),void 0===o&&(o=Z.causeId()),Z.assertNotNull(t,"correlationId should be a non null value"),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.IDLE,"a call is already in progress");var s=e;return s||(s=C.signalingAgentConfig.conversationServiceUrl,C.logger.info("conversationServiceUrl passed is empty. so it is set to "+s)),Z.assertNotNullOrEmpty(s,"conversationUrl should be a non null value"),C.logger.info("["+o+"][subscribeToCall][start][correlationId="+t+"] applicationType="+C.participantManager.localParticipant.applicationType),C.disposed?(C.logger.warn("["+o+"][subscribeToCall][failed][reason=Session disposed]"),Promise.reject(Q.default.CALL_END_CODE.CALL_DOES_NOT_EXIST)):(C.isBrokerEnabledForIncomingCall()&&C.setupBrokerChannel(),C.fsmState=Q.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY,C.updateCorrelationId(t,o),C.http.sendPostRequest({url:s,requestName:J.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,operationType:"CallSetup",payload:O.getPayload(C,null,null,i({subscribe:!0,clientEndpointCapabilities:n},r,{applicationType:C.participantManager.localParticipant.applicationType})),causeId:o}).then(function(e){C.disposed||(C.fsmState=Q.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,C.processConversationServiceResponseHeaders(e,o),C.processConversationServiceResponse(e.response,o),C.onCallStatusChanged(Q.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY,o),e.response.roster&&("Delta"===e.response.roster.type&&"MultiPartyEndpoint"===e.response.roster.type||(e.response.roster.type=C.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint"),C.internalHandleRosterUpdate(e.response.roster,!0,o)))}).catch(function(e){if(e.stack&&!C.isFatalException(e))return Promise.resolve();var t=Z.getErrorForXHRFailure(e);return C.logger.info("["+o+"][subscribeToCall] error: "+a.getPrintableObject(e)+" xhrError: "+a.getPrintableObject(t)),C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):(C.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,C.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultValue:J.default.RESULT_VALUE.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultCategories:t&&t.error&&t.error.resultCategories,resultDetail:C.getTerminatingCallResultDetail("subscribe",t.error),causeId:o}),C.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,o,t.error),Promise.reject(t.error))}))},this.getCallReplacementDetailsForCall=function(e,t){void 0===t&&(t=Z.causeId()),C.logger.info("["+t+"] getCallReplacementDetailsForCall callId "+e);var n=C.signalingAgent.getSignalingSession(e);return n?n.getCallReplacementDetails(t):{replaces:""}},this.getCallReplacementDetails=function(e){return void 0===e&&(e=Z.causeId()),C.logger.info("["+e+"] getCallReplacementDetails"),{replaces:C.links[Q.default.LINKS.REPLACE]}},this.transferCallAsync=function(e,t,n,r,o){void 0===o&&(o=Z.causeId()),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet");var s=!1;C.logger.info("["+o+"][transferCallAsync][transferTargetMri="+C.piiUtils.scrubMriOrOmit(e)+"][replacementDetails="+a.getPrintableObject(n)+"] disableForwardingAndUnanswered="+(r&&r.disableForwardingAndUnanswered)),C.telemetryHelper.recordEvent(J.EVENTS.TRANSFER_CALL,{causeId:o}),C.timeoutManager.startTimer(Q.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,function(){return C.handleCallTransferTimeout(o,s)},Q.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT),C.http.sendPostRequest({url:C.links[Q.default.LINKS.TRANSFER],requestName:J.NETWORK_REQUESTS.SEND_TRANSFER_REQUEST,payload:j.getPayload(e,C,n,t,r),causeId:o}).then(function(){C.telemetryHelper.recordEvent(J.EVENTS.WAITING_FOR_TRANSFER_ACCEPTANCE,{causeId:o}),s=!0}).catch(function(e){var t=Z.getErrorForXHRFailure(e);return C.logger.info("["+o+"][transferCallAsync] error: "+a.getPrintableObject(t)),C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):(C.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:Q.default.CALL_END_CODE.NETWORK_ERROR,reason:a.getPrintableObject(e)}},o),C.telemetryHelper.recordEvent(J.EVENTS.TRANSFER_REQUEST_FAILED,i({causeId:o},t.error)),Promise.reject(t.error))}),C.telemetryHelper.recordEvent(J.EVENTS.TRANSFER_REQUEST_SENT,{causeId:o,transferType:t})},this.isParkByTransfer=function(e,t){var n=["serverHold","sharedLinePark","teamPark"].indexOf(e)>-1;return C.logger.info("["+t+"][isParkByTransfer][context="+e+"] result = "+n),n},this.parkCallAsync=function(e,t){if(void 0===t&&(t=Z.causeId()),e&&"none"===e)throw{code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark context is missing or none"};if(Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet"),C.logger.info("["+t+"][parkCallAsync][context="+e+"]"),C.telemetryHelper.recordEvent(J.EVENTS.PARK_CALL,{causeId:t,context:e}),C.isParkByTransfer(e,t))return C.parkByTransfer(e,t);if(C.signalingAgentConfig.enableMusicOnHoldV2)return C.park(e,t);var n={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.PARK_UNPARK_V2_DISABLED,phrase:"Park context request was "+e+" but park/unpark v2 was disabled."};return Promise.reject(n)},this.unparkAsync=function(e,t){if(void 0===t&&(t=Z.causeId()),e&&"none"===e)throw{code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark context is missing or none"};if(!C.links[Q.default.LINKS.UNPARK])throw{code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark link not available"};return C.logger.info("["+t+"][unparkAsync][context="+e+"]"),C.timeoutManager.startTimer(Q.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION,function(){return C.handleUnparkError({code:Q.default.CALL_END_CODE.TIMEOUT,subCode:Q.default.CALL_END_SUB_CODE.UNPARK_COMPLETION_TIMEOUT,phrase:Q.default.CALL_END_PHRASE.UNPARK_COMPLETION_TIMEOUT},J.EVENTS.WAITING_FOR_UNPARK_COMPLETION_TIMEOUT,t,e)},Q.default.TIMEOUT_VALUES_IN_SECONDS.UNPARK_COMPLETION_TIMEOUT),C.http.sendPostRequest({url:C.links[Q.default.LINKS.UNPARK],requestName:J.NETWORK_REQUESTS.SEND_UNPARK_REQUEST,payload:B.getPayload(C),causeId:t}).then(function(e){return C.logger.info("["+t+"][unparkAsync] response: "+a.getPrintableObject(e)),C.telemetryHelper.recordEvent(J.EVENTS.WAITING_FOR_UNPARK_COMPLETION,{causeId:t}),Promise.resolve()}).catch(function(n){var i=Z.getErrorForXHRFailure(n);return C.logger.info("["+t+"][unparkAsync] error: "+a.getPrintableObject(i)),C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):(C.handleUnparkError(i.error,J.EVENTS.UNPARK_REQUEST_FAILED,t,e),Promise.reject(i.error))})},this.getCallStatus=function(){return C.currentCallStatus},this.processIncomingCallRequest=function(e,t,n){if(void 0===n&&(n=Z.causeId()),Z.assertNotNull(e,"request should be a non null value"),Z.assertNotNullOrEmpty(e.body,"request should have a valid body"),Z.assertNotNullOrEmpty(e.body.gp||e.body.cp,"request body should have payload"),Z.assert(C.isCallInProgress(),"a call is already in progress"),C.callUsesMixer=e.fromMixer,C.logger.info("["+n+"][processIncomingCallRequest][start]"),C.disposed)C.logger.warn("processIncomingCallRequest canceled");else{C.telemetryHelper.startCallInitializationWatch(),C.isIncomingCall=!0,C.isBrokerEnabledForIncomingCall()&&C.setupBrokerChannel(),C.fsmState=Q.default.SIGNALING_FSM_STATE.INCOMING,C.participantManager.initializeForIncomingCall();var i={};try{t&&(i=JSON.parse(t))}catch(e){C.logger.warn("Unable to parse endpoint metadata")}C.endpointMetadata=i;try{var r=void 0;if(e&&e.body&&e.body.gp&&!c.isStringBase64(e.body.gp))C.logger.info("["+n+"][processIncomingCallRequest] unencoded payload, skipping decoding."),r=e.body.gp;else{var o=e.body.gp?atob(e.body.gp):Z.decodeMessage(e.body.cp);r=JSON.parse(o)}if(!r.callNotification)throw C.logger.info("["+n+"][processIncomingCallRequest][failed][reason=CallNotification missing]"),new Error("CallNotification is missing");C.processIncomingCallPayload(r,n),C.incomingCallPayload=r}catch(e){C.endIncomingCallBecauseOfInvalidPayload(n)}}},this.sendAttachToCall=function(e){return void 0===e&&(e=Z.causeId()),C.logger.info("["+e+"][sendAttachToCall]"),C.incomingCallPayload?(C.onCallStatusChanged(Q.default.CALL_STATUS.IDLE,e),C.sendAttachToCallInternal(e)):(C.endIncomingCallBecauseOfInvalidPayload(e),Promise.reject(Q.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD))},this.supportsNewOfferRequest=function(){return C.signalingAgentConfig.handleNewOfferRequest},this.requestNewOffer=function(e,t){return void 0===t&&(t=Z.causeId()),C.telemetryHelper.recordEvent(J.EVENTS.REQUEST_NEW_OFFER,{compatibleContentTypes:e,causeId:t}),C.signalingAgentConfig.handleNewOfferRequest?(Z.assertNotNullOrEmpty(C.links[Q.default.LINKS.NEW_OFFER],"newOffer link should be a non null value"),C.http.sendPostRequest({url:C.links[Q.default.LINKS.NEW_OFFER],requestName:J.NETWORK_REQUESTS.REQUEST_NEW_OFFER,payload:N.getPayload(C,e,C.links[Q.default.LINKS.NEW_OFFER]),causeId:t}).then(function(e){return C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):Promise.resolve(e)}).catch(function(e){var n=Z.getErrorForXHRFailure(e);return C.logger.info("[requestNewOffer]["+t+"] error "+a.getPrintableObject(n)),C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):(C.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,C.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultValue:J.default.RESULT_VALUE.FAILURE,endCode:n.telemetryEndSubCode,endSubCode:n.error.subCode,resultCategories:n&&n.error&&n.error.resultCategories,resultDetail:C.getTerminatingCallResultDetail("requestNewOffer",n.error),causeId:t}),C.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,t,n.error),C.dispose(n.error,t),Promise.reject(n.error))})):Promise.reject("Disabled")},this.endAsync=function(e,t){void 0===t&&(t={}),t.causeId=t.causeId||Z.causeId();var n=t.causeId;if(C.logger.info("["+n+"][endAsync][rejectionData="+(e&&a.getPrintableObject(e))+"][endCallForAll="+t.forEveryone+"]"),C.disposed)return C.logger.warn("["+n+"][endAsync] canceled but session already disposed"),Promise.resolve(null);if(C.disposing=!0,C.telemetryHelper.recordEvent(J.EVENTS.END_CALL,e?{code:e.code,subCode:e.subCode,causeId:n,callEndClientSubCode:e.clientReasonSubCode,callEndClientPhrase:e.clientReasonPhrase}:{causeId:n}),t.preventAllCallbacks)for(var i=0,o=Object.keys(C.signalingSessionCallback);i<o.length;i++){var s=o[i];C.signalingSessionCallback[s]=r.noop}if(C.telemetryHelper.stopCallCancelationDurationWatch(),C.fsmState===Q.default.SIGNALING_FSM_STATE.INCOMING)return C.rejectIncomingCall(e,n);if(C.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING||C.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY)return C.cancelOutgoingCall(e,n);if(C.fsmState===Q.default.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK)return C.rejectIncomingCall(e,n);if((C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED||C.mediaRenegotiationManager.isIncomingRenegotiationInProgress()||C.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())&&t.forEveryone)return C.deleteConversation(e,n);if(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED||C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||C.mediaRenegotiationManager.isIncomingRenegotiationInProgress()||C.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())return C.terminateEstablishedCall(e,t);C.logger.info("["+n+"][endAsync] there is no call to cancel or end or reject in current state");var c=e&&(e.code||e.subCode)?e:{code:Q.default.CALL_END_CODE.NOT_FOUND,subCode:Q.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:Q.default.CALL_END_PHRASE.CALL_DOES_NOT_EXIST,resultCategories:[Q.RESULT_CATEGORIES.ExpectedError]};return e&&C.setClientRejectReason(c,e),C.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultDetail:C.getTerminatingCallResultDetail("endAsync",c),endCode:c.code,endSubCode:c.subCode,resultCategories:c.resultCategories,causeId:n,clientReasonSubCode:c.clientReasonSubCode,clientReasonPhrase:c.clientReasonPhrase}),C.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,n,c),C.dispose(c,n),Promise.resolve(null)},this.handleIncomingMsgAsync=function(e,t){var n,r;void 0===t&&(t=Q.default.INCOMING_MESSAGE_ORIGIN.TROUTER),Z.assertNotNull(e,"incoming message should be a non null value");var o=e.headers?e.headers[Q.default.HEADERS.ORIGINAL_MESSAGE_ID]:"unknown",s=Z.defer(),c=e.body,l=e.url,u=i({},e,{origin:t}),d=Z.extractCauseIdFromMessage(u);if(C.logger.info("["+d+"][handleIncomingMsgAsync][url="+l+"][messageId="+o+"]"),!c)return C.logger.info("["+d+"][handleIncomingMsgAsync][failed][reason=received message with no body]"),C.telemetryHelper.recordEvent(J.EVENTS.MESSAGE_MISSING_BODY,{origin:t,messageId:o,causeId:d}),s.reject(new Error("received message with no body")),s.promise;if(C.disposed)return C.logger.info("["+d+"][handleIncomingMsgAsync][failed][reason=call is disposed]"),s.reject(C.getCallNotFoundTransactionEnd()),s.promise;if(C.isDuplicatedIncomingMessage(u))return C.logger.info("["+d+"][handleIncomingMsgAsync][failed][reason=duplicate]"),C.telemetryHelper.recordEvent(J.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:t,messageId:o,causeId:d}),s.resolve(new Error("Message was already handled")),s.promise;C.checkCorrelationIdChange(e,d);var p=((n={})[Q.PAYLOAD_PROPERTY.CALL_NOTIFICATION]=function(e){return C.handleCallNotification(e)},n[Q.PAYLOAD_PROPERTY.MEDIA_ANSWER]=function(e){return C.handleMediaAnswer(e)},n[Q.PAYLOAD_PROPERTY.MEDIA_ACKNOWLEDGEMENT]=function(e){return C.handleMediaAcknowledgement(e)},n[Q.PAYLOAD_PROPERTY.CALL_ACCEPTANCE]=function(e){return C.handleCallAcceptance(e)},n[Q.PAYLOAD_PROPERTY.CALL_END]=function(e){return C.handleCallEnd(e)},n[Q.PAYLOAD_PROPERTY.CALL_PROGRESS]=function(e){return C.handleCallProgress(e)},n[Q.PAYLOAD_PROPERTY.CALL_ACCEPTANCE_ACKNOWLEDGEMENT]=function(e){return C.handleCallAcceptanceAck(e)},n[Q.PAYLOAD_PROPERTY.MEDIA_NEGOTIATION]=function(e){return C.mediaRenegotiationManager.handleMediaNegotiationOffer(e)},n[Q.PAYLOAD_PROPERTY.MEDIA_NEGOTIATION_FAILURE]=function(e){return C.mediaRenegotiationManager.handleMediaNegotiationFailure(e)},n[Q.PAYLOAD_PROPERTY.BALANCE_UPDATE]=function(e){return C.handlePSTNBalanceUpdate(e)},n[Q.PAYLOAD_PROPERTY.RETARGET_COMPLETED]=function(e){return C.mediaRenegotiationManager.handleRetargetCompleted(e)},n[Q.PAYLOAD_PROPERTY.CALL_TRANSFER]=function(e){return C.handleTransferRequested(e)},n[Q.PAYLOAD_PROPERTY.TRANSFER_COMPLETION]=function(e){return C.handleTransferCompletion(e)},n[Q.PAYLOAD_PROPERTY.TRANSFER_ACCEPTANCE]=function(e){return C.handleTransferAcceptance(e)},n[Q.PAYLOAD_PROPERTY.PARK_COMPLETION]=function(e){return C.handleParkCompletion(e)},n[Q.PAYLOAD_PROPERTY.UNPARK_COMPLETION]=function(e){return C.handleUnparkCompletion(e)},n),f=((r={})[Q.URL_PATH.CONTROL_VIDEO_STREAMING]=function(e){return C.webRtcSignalingManager.handleControlVideoStreaming(e)},r[Q.URL_PATH.DOMINANT_SPEAKER_INFO]=function(e){return C.webRtcSignalingManager.handleDominantSpeakerInfo(e)},r[Q.URL_PATH.CSRC_INFO]=function(e){return C.webRtcSignalingManager.handleCsrcInfo(e)},r[Q.URL_PATH.CONV_ROSTER_UPDATE]=function(e){return C.handleRosterUpdate(e,!1)},r[Q.URL_PATH.NEW_MEDIA_OFFER]=function(e){return C.handleNewMediaOffer(e)},r[Q.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS]=function(e){return C.participantManager.handleAddParticipantSuccess(e)},r[Q.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE]=function(e){return C.participantManager.handleAddParticipantFailure(e)},r[Q.URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS]=function(e){return C.participantManager.handleAdmitParticipantSuccess(e)},r[Q.URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE]=function(e){return C.participantManager.handleAdmitParticipantFailure(e)},r[Q.URL_PATH.CONV_ADMIT_ALL_STATUS]=function(e){return C.handleAdmitAllStatus(e)},r[Q.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS]=function(e){return C.participantManager.handleRemoveParticipantSuccess(e)},r[Q.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE]=function(e){return C.participantManager.handleRemoveParticipantFailure(e)},r[Q.URL_PATH.CONV_CONFIRM_UNMUTE]=function(e){return C.participantManager.handleUnmuteConfirmRequest(e)},r[Q.URL_PATH.CONV_UPDATE]=function(e){return C.handleConversationUpdate(e)},r[Q.URL_PATH.CONV_ADD_MODALITY_SUCCESS]=function(e){return C.handleAddModalitySuccess(e)},r[Q.URL_PATH.CONV_ADD_MODALITY_FAILURE]=function(e){return C.handleAddModalityFailure(e)},r[Q.URL_PATH.CONV_BROADCAST_UPDATE]=function(e){return C.broadcastSession.handleBroadcastStateChanged(e)},r[Q.URL_PATH.CONV_CONTENT_SHARING_UPDATE]=function(e){return C.contentSharingManager.handleContentSharingUpdate(e)},r[Q.URL_PATH.CONV_CONTENT_SHARING_END]=function(e){return C.contentSharingManager.handleContentSharingEnd(e)},r[Q.URL_PATH.CONV_END]=function(e){return C.handleCallEnd(e)},r[Q.URL_PATH.LWJ_ACCEPTANCE]=function(e){return C.handleLwjAcceptance(e)},r[Q.URL_PATH.LWJ_END]=function(e){return C.handleCallEnd(e)},r);try{var h=Object.keys(p).filter(function(e){return c.hasOwnProperty(e)})[0],g=Object.keys(f).filter(function(e){return u.url&&Z.stringEndsWith(u.url,e)})[0];h?p[h](u):g?f[g](u):(C.telemetryHelper.recordEvent(J.EVENTS.UNKNOWN_MESSAGE_TYPE,{messageId:o}),C.logger.info("["+d+"][handleIncomingMsgAsync][failed][reason=received unknown message]")),s.resolve(!0)}catch(e){C.telemetryHelper.recordEvent(J.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:o,error:a.getPrintableObject(e)}),C.logger.info("["+d+"][handleIncomingMsgAsync][failed][reason="+e.message+"]"),s.reject(new Error(e.message))}return s.promise},this.canHandleIncomingMsgSync=function(e){if(C.signalingAgentConfig.supportsSynchronousTrouterResponse){var t=e.body;return Boolean(t.callAcceptance)}return!1},this.handleIncomingMsgSync=function(e){var t,n=e.headers?e.headers[Q.default.HEADERS.ORIGINAL_MESSAGE_ID]:"unknown",r=e.body,o=e.url,s=Q.default.INCOMING_MESSAGE_ORIGIN.TROUTER,c=i({},e,{origin:s}),l=Z.extractCauseIdFromMessage(c);C.logger.info("["+l+"][handleIncomingMsgSync][url="+o+"][messageId="+n+"]");var u=Q.default.HTTP_STATUS_CODES.OK,d="",p={};if(Z.isDuplicateMessage(c.headers,C.incomingTrouterMessagesSeenSoFar)){C.logger.info("["+l+"][handleIncomingMsgSync][failed][reason=duplicate]");var f=Z.getMessageResultFromCache(c.headers,C.incomingMessageSyncResponseCache);if(f)return C.logger.info("["+l+"][handleIncomingMsgSync][cachedResponse]"),f;C.telemetryHelper.recordEvent(J.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:s,messageId:n,causeId:l}),C.logger.info("["+l+"][handleIncomingMsgSync][failed][reason=cachedResponseNotFound]"),u=Q.default.HTTP_STATUS_CODES.BAD_REQUEST}else if(r){if(r.callAcceptance)try{var h=C.handleCallAcceptanceSync(c);d=a.safeJsonStringify(h)}catch(e){C.telemetryHelper.recordEvent(J.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:n,origin:s,causeId:l,error:a.getPrintableObject(e)}),C.logger.info("["+l+"][handleIncomingMsgSync][failed][reason="+(e&&e.message)+"]"),u=Q.default.HTTP_STATUS_CODES.BAD_REQUEST}}else C.logger.info("["+l+"][handleIncomingMsgSync][failed][reason=received message with no body]"),C.telemetryHelper.recordEvent(J.EVENTS.MESSAGE_MISSING_BODY,{origin:s,messageId:n,causeId:l}),u=Q.default.HTTP_STATUS_CODES.BAD_REQUEST;return c.headers&&(c.headers[Q.default.HEADERS.CORRELATION_ID]&&(p[Q.default.HEADERS.CORRELATION_ID]=c.headers[Q.default.HEADERS.CORRELATION_ID]),c.headers[Q.default.HEADERS.MESSAGE_ID]&&(p[Q.default.HEADERS.MESSAGE_ID]=c.headers[Q.default.HEADERS.MESSAGE_ID])),t={resultCode:u,responseBody:d,responseHeaders:p},Z.cacheMessageResult(c.headers,C.incomingMessageSyncResponseCache,t),C.logger.info("["+l+"][handleIncomingMsgSync][success][resultCode="+u+"]"),t},this.acceptRenegotiationAsync=function(e,t,n){return void 0===n&&(n=Z.causeId()),Z.assertNotNull(e.blob,"finalSdp should be a non null value"),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),C.logger.info("["+n+"][acceptRenegotiationAsync][mediaTypes="+t+"]"),C.mediaRenegotiationManager.acceptRenegotiationAsync(e,t,n)},this.setProvisionalAnswerAsync=function(e,t){void 0===t&&(t=Z.causeId()),Z.assertNotNull(e.blob,"sdp should be a non null value"),C.telemetryHelper.recordEvent(J.EVENTS.SET_PROVISIONAL_ANSWER,{causeId:t});var n=Z.defer();return C.fsmState!==Q.default.SIGNALING_FSM_STATE.INCOMING?(C.logger.info("[setProvisionalAnswerAsync]["+t+"] there is no incoming call to set provisional answer on."),n.reject(new Error("there is no incoming call to set provisional answer on.")),n.promise):(C.http.sendPostRequest({url:C.links[Q.default.LINKS.MEDIA_ANSWER],requestName:J.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,payload:z.getPayload(C,e),causeId:t}).then(function(e){C.disposed||C.onCallStatusChanged(Q.default.CALL_STATUS.CONNECTING,t),n.resolve(null),C.disposed||(C.telemetryHelper.recordEvent(J.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT,{causeId:t}),C.telemetryHelper.setTimeToRingDuration(),C.onCallStatusChanged(Q.default.CALL_STATUS.RINGING,t),C.signalingSessionCallback.onMediaAcknowledgementSuccess(!1,t))}).catch(function(e){var i=Z.getErrorForXHRFailure(e);C.logger.info("[setProvisionalAnswerAsync]["+t+"] error: "+a.getPrintableObject(i)),C.disposed?n.reject(C.getCallNotFoundTransactionEnd()):(C.telemetryHelper.recordEvent(J.EVENTS.SET_PROVISIONAL_ANSWER_FAILED,{causeId:t}),n.reject(i.error))}),n.promise)},this.startRenegotiationAsync=function(e,t,n){return void 0===n&&(n=Z.causeId()),Z.assertNotNull(e,"mediaContent should be a non null value"),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),C.logger.info("["+n+"][startRenegotiationAsync]"),C.mediaRenegotiationManager.startRenegotiationAsync(e,C.links[Q.default.LINKS.MEDIA_RENEGOTIATION],t,n)},this.acceptAsync=function(e,t,n,i){void 0===i&&(i=Z.causeId()),Z.assertNotNull(e,"mediaContent should be a non null value"),Z.assertNotNull(e.blob,"outgoingSdp should be a non null value"),C.logger.info("["+i+"][acceptAsync][mediaTypes="+t+"]"),C.telemetryHelper.recordEvent(J.EVENTS.ACCEPT_CALL,{causeId:i}),C.telemetryHelper.setAnsweredModalities(e.blob);var r=Z.defer();return C.fsmState!==Q.default.SIGNALING_FSM_STATE.INCOMING?(C.logger.warn("acceptAsync, there is no incoming call to accept"),r.reject(new Error("there is no incoming call to accept")),r.promise):(C.fsmState=Q.default.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK,C.http.sendPostRequest({url:C.links[Q.default.LINKS.ACCEPT],requestName:J.NETWORK_REQUESTS.SEND_ACCEPTANCE,payload:T.getPayload(C,e,t,n),causeId:i}).then(function(e){C.disposed||(C.currentCallStatus===Q.default.CALL_STATUS.IDLE&&(C.telemetryHelper.setTimeToRingDuration(),C.telemetryHelper.recordEvent(J.EVENTS.ACCEPTED_BEFORE_RINGING,{causeId:i}),C.onCallStatusChanged(Q.default.CALL_STATUS.CONNECTING,i)),e.response.callAcceptanceAcknowledgement&&(C.logger.info("acceptAsync, handling inlined callAcceptanceAcknowledgement"),C.internalHandleCallAcceptanceAck(e.response,i))),r.resolve(null)}).catch(function(e){var t=Z.getErrorForXHRFailure(e);if(C.logger.info("[acceptAsync]["+i+"] error: "+a.getPrintableObject(t)),C.disposed)r.reject(C.getCallNotFoundTransactionEnd());else{var n=Z.getErrorForXHRFailure(e);C.fsmState=Q.default.SIGNALING_FSM_STATE.INCOMING,C.telemetryHelper.recordEvent(J.EVENTS.ACCEPT_CALL_FAILED,{causeId:i,xhrError:n}),r.reject(n.error)}}),r.promise)},this.rejectRenegotiationAsync=function(e,t){return void 0===t&&(t=Z.causeId()),Z.assert(C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),C.logger.info("["+t+"][rejectRenegotiationAsync][rejectionData="+e+"]"),C.mediaRenegotiationManager.rejectRenegotiationAsync(e,t)},this.saveMediaControllerLinksIfAny=function(e){e.links&&(C.links[Q.default.LINKS.CONTROL_VIDEO_STREAMING]=e.links.controlVideoStreaming||C.links[Q.default.LINKS.CONTROL_VIDEO_STREAMING],C.links[Q.default.LINKS.APPLY_CHANNEL_PARAMETERS]=e.links.applyChannelParameters||C.links[Q.default.LINKS.APPLY_CHANNEL_PARAMETERS])},this.getInitialMediaOfferFromIncomingCallPayload=function(e){if(void 0===e&&(e=Z.causeId()),!C.signalingAgentConfig.handleMediaOfferFromPushNotification)return null;var t=C.incomingCallPayload&&C.incomingCallPayload.callNotification&&C.incomingCallPayload.callNotification.mediaContent?C.incomingCallPayload.callNotification.mediaContent:null;return C.telemetryHelper.setIsSdpInCallNotification(!!t),t},this.updateCorrelationId=function(e,t){if(void 0===t&&(t=Z.causeId()),C.logger.info("["+t+"][updateCorrelationId][old="+C.correlationId+"][new="+e+"]"),C.correlationId!==e&&!C.disposed){var n=C.correlationId;C.correlationId=e,C.telemetryHelper&&C.telemetryHelper.recordEvent&&C.telemetryHelper.recordEvent(J.EVENTS.CORRELATION_ID_UPDATED,{newId:C.correlationId,oldId:n,causeId:t}),C.signalingSessionCallback&&C.signalingSessionCallback.onCorrelationIdUpdated&&C.signalingSessionCallback.onCorrelationIdUpdated(C.correlationId,t)}},this.endIncomingCallBecauseOfInvalidPayload=function(e){C.logger.info("["+e+"][endIncomingCallBecauseOfInvalidPayload]"),C.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,C.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultValue:J.default.RESULT_VALUE.FAILURE,endCode:Q.default.CALL_END_CODE.BAD_REQUEST,endSubCode:Q.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,resultDetail:"endIncomingCall",resultCategories:[Q.RESULT_CATEGORIES.UnexpectedServerError],causeId:e});var t={code:Q.default.CALL_END_CODE.BAD_REQUEST,subCode:Q.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,phrase:Q.default.CALL_END_PHRASE.BAD_NOTIFICATION_PAYLOAD,resultCategories:[Q.RESULT_CATEGORIES.UnexpectedServerError]};C.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,e,t),C.dispose(t,e)},this.isDuplicatedIncomingMessage=function(e){return e.origin===Q.default.INCOMING_MESSAGE_ORIGIN.BROKER&&Z.isDuplicateMessage(e.headers,C.incomingBrokerMessagesSeenSoFar)||e.origin===Q.default.INCOMING_MESSAGE_ORIGIN.TROUTER&&Z.isDuplicateMessage(e.headers,C.incomingTrouterMessagesSeenSoFar)},this.getEndpointState=function(){return C.currentCallStatus===Q.default.CALL_STATUS.CONNECTED?i({},C.latestEndpointState):i({},C.requestedEndpointStateWhileConnecting)},this.setMultiParty=function(e,t){var n=!!e;C.multiParty!==n&&(C.telemetryHelper.recordEvent(J.EVENTS.SET_MULTIPARTY,{isMultiparty:n,causeId:t}),C.multiParty=n)},this.setupTrouterChannel=function(){C.logger.info("Broker config: outgoing="+(C.signalingAgentConfig.brokerEnabledOutgoing?"enabled":"disabled")+"incoming="+(C.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled")+"batching="+(C.signalingAgentConfig.brokerRequestBatching?"enabled":"disabled")+"exclusive="+(C.signalingAgentConfig.brokerExclusively?"enabled":"disabled"));var e=function(e){e&&"string"==typeof e&&e.trim()&&(C.baseMessagingChannelUrl=C.previousTrouterUrl=C.currentTrouterUrl=e.trim(),C.telemetryHelper.addTrouterChannel())};C.brokerExclusiveEnabled()||(C.signalingAgentConfig.trouterServiceProvider?(C.signalingAgentConfig.trouterServiceProvider.state()===X.TrouterState.Connected&&C.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync().then(e),C.signalingAgentConfig.trouterServiceProvider.onStateChanged(C.onTrouterStateChanged)):(e(C.signalingAgentConfig.trouterUrlGetter.trouterUrl()),C.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed(C.onTrouterUrlChanged)))},this.isTrouterDisconnected=function(){try{return C.signalingAgentConfig.trouterServiceProvider.state()===X.TrouterState.Disconnected}catch(e){return!1}},this.forceTrouterConnectionCheck=function(){try{return C.signalingAgentConfig.trouterServiceProvider.checkConnection(!1)}catch(e){return}},this.navigatorOnlineCallback=function(){C.disposed||(C.reportConnectivityStatus(),C.isTrouterDisconnected()&&C.signalingAgentConfig.forceTrouterReconnectOnNetworkOnline&&C.forceTrouterConnectionCheck())},this.navigatorOfflineCallback=function(){C.reportConnectivityStatus()},this.reportConnectivityStatus=function(){if(!C.disposed){var e=Z.isTrouterAndNavigatorConnected(C.signalingAgentConfig.trouterServiceProvider);C.logger.info("[Connectivity] status="+e),C.telemetryHelper.recordEvent(J.EVENTS.CONNECTIVITY_CHANGED,{status:e})}},this.onTrouterStateChanged=function(e,t){var n=Z.causeId();C.logger.info("["+n+"][onTrouterStateChanged][state="+e+"]"),C.disposed?C.logger.info("onTrouterStateChanged ignored"):(C.reportConnectivityStatus(),e===X.TrouterState.Connected&&(C.telemetryHelper.addTrouterChannel(),C.updateLinksToTrouter(J.EVENTS.TROUTER_STATE_CHANGED,n)))},this.setupConnectionCheck=function(){try{navigator&&navigator.onLine&&window&&window.addEventListener&&(window.addEventListener("online",C.navigatorOnlineCallback),window.addEventListener("offline",C.navigatorOfflineCallback))}catch(e){return}},this.tearDownConnectionCheck=function(){try{navigator&&navigator.onLine&&window&&window.removeEventListener&&(window.removeEventListener("online",C.navigatorOnlineCallback),window.removeEventListener("offline",C.navigatorOfflineCallback))}catch(e){return}},this.getTrouterUrlAsync=function(){return C.signalingAgentConfig.trouterServiceProvider?C.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync():C.signalingAgentConfig.trouterUrlGetter.getTrouterUrlAsync()},this.brokerExclusiveEnabled=function(){return C.signalingAgentConfig.brokerEnabledOutgoing&&C.signalingAgentConfig.brokerEnabledIncoming&&C.signalingAgentConfig.brokerExclusively},this.isBrokerEnabledForOutgoingCall=function(){return C.signalingAgentConfig.brokerEnabledOutgoing},this.isBrokerEnabledForIncomingCall=function(){return C.signalingAgentConfig.brokerEnabledIncoming},this.isHandleUnmuteMuteFromResponseEnabled=function(){return C.signalingAgentConfig.handleUnmuteMuteFromResponse},this.isProcessSelfDataFromSubscribeResponseEnabled=function(){return C.signalingAgentConfig.processSelfDataFromSubscribeResponse},this.setupBrokerChannel=function(){C.brokerService||(C.logger.info("setupBrokerChannel, Enable broker"),C.brokerService=new u.default(C),C.brokerService.onBrokerMessage(function(e){C.logger.info("setupBrokerChannel, message from broker",e),C.handleIncomingMsgAsync(e,Q.default.INCOMING_MESSAGE_ORIGIN.BROKER).catch(function(e){C.telemetryHelper.recordEvent(J.EVENTS.FAILED_TO_HANDLE_BROKER_MESSAGE),C.logger.info("setupBrokerChannel, Failed to handle message from broker",e)})}),C.baseMessagingChannelUrl||(C.telemetryHelper.addBrokerChannel(),C.baseMessagingChannelUrl=C.brokerService.baseUrl))},this.onTrouterUrlChanged=function(){var e=Z.causeId();C.logger.info("["+e+"][onTrouterUrlChanged]"),C.disposed?C.logger.info("onTrouterUrlChanged ignored"):C.getTrouterUrlAsync().then(function(t){C.telemetryHelper.recordEvent(J.EVENTS.TROUTER_URL_CHANGED,{url:t}),C.telemetryHelper.addTrouterChannel(),C.updateLinksToTrouter(J.EVENTS.TROUTER_URL_CHANGED,e)}).catch(function(e){C.logger.info("Failed to update links to trouter: "+e)})},this.updateLinksToTrouter=function(e,t){C.logger.info("["+t+"][updateLinksToTrouter][tag="+e+"]"),C.ensureLatestTrouterUrl(e).then(function(){C.previousTrouterUrl!==C.currentTrouterUrl?(C.previousTrouterUrl=C.currentTrouterUrl,C.updateConversationLinks(),C.updateLwjLinks(t),C.updateKeepAliveUrl(),C.contentSharingManager.updateContentSharingNotificationLinksAsync(t),C.broadcastSession.updateBroadcastCallbackUrl(t)):C.logger.info("["+t+"][updateLinksToTrouter]skip updating links, url did not change")}).catch(function(e){C.disposed||C.telemetryHelper.recordEvent(J.EVENTS.TROUTER_URL_UPDATE_FAILED,{causeId:t}),C.logger.info("["+t+"][updateLinksToTrouter][failed][reason="+a.getPrintableObject(e)+"]")})},this.updateLinks=function(e,t){C.ensureLatestTrouterUrl(J.EVENTS.TROUTER_URL_CHANGED).then(function(){return e(t)}).catch(function(e){C.disposed||C.telemetryHelper.recordEvent(J.EVENTS.TROUTER_URL_UPDATE_FAILED,{causeId:t}),C.logger.warn("Failed to update links")})},this.startCallPreheatTimer=function(e){C.timeoutManager.startTimer(Q.default.TIMEOUT_OPERATIONS.MAX_PREAHEATED_TIMEOUT,function(){C.handleCallEstablishmentTimeout(e,Q.default.CALL_END_SUB_CODE.PREHEATED_CALL_TIMEDOUT,"Preheat timed out!")},Q.default.TIMEOUT_VALUES_IN_SECONDS.MAX_PREAHEATED_TIMEOUT)},this.stopCallPreheatTimer=function(){C.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.MAX_PREAHEATED_TIMEOUT)},this.handleRosterFromCreateAndJoin=function(e,t){C.signalingAgentConfig.handleRosterFromCreateAndJoin&&e.response&&e.response.roster&&("Delta"===e.response.roster.type&&"MultiPartyEndpoint"===e.response.roster.type||(e.response.roster.type=C.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint"),C.internalHandleRosterUpdate(e.response.roster,!0,t))},this.updateKeepAliveUrl=function(){C.logger.info("updateKeepAliveUrl"),C.links.hasOwnProperty(Q.default.LINKS.KEEPALIVE)?(C.linkUpdateRequested.keepAliveLinks=!1,C.logger.info("updateKeepAliveUrl, sending request"),C.sendToKeepAliveUrl(D.getPayload(C))):C.linkUpdateRequested.keepAliveLinks=!0},this.updateConversationLinks=function(e){void 0===e&&(e=Z.causeId()),C.logger.info("["+e+"][updateConversationLinks]"),C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_CONVERSATION_LINKS,{causeId:e}),C.links.hasOwnProperty(Q.default.LINKS.NOTIFICATION_LINKS)?(C.linkUpdateRequested.conversationLinks=!1,C.http.sendPostRequest({url:C.links[Q.default.LINKS.NOTIFICATION_LINKS],payload:K.getPayload(C),withoutTrouter:!0,requestName:J.NETWORK_REQUESTS.UPDATE_CONVERSATION_LINKS,causeId:e}).then(function(t){C.disposed||(C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_CONVERSATION_LINKS_SUCCESS,{causeId:e}),C.processConversationServiceResponse(t.response,e))}).catch(function(t){var n=Z.getErrorForXHRFailure(t);C.logger.info("["+e+"][updateConversationLinks] error : "+a.getPrintableObject(n)),C.disposed||C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_CONVERSATION_LINKS_FAILED,i({causeId:e},n.error))})):C.linkUpdateRequested.conversationLinks=!0},this.updateLwjLinks=function(e){C.logger.info("["+e+"][updateLwjLinks]"),C.links.hasOwnProperty(Q.default.LINKS.LMC_NOTIFICATION_LINKS)&&(C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_LWJ_LINKS,{causeId:e}),C.logger.info("["+e+"][updateLwjLinks][start]"),C.http.sendPostRequest({url:C.links[Q.default.LINKS.LMC_NOTIFICATION_LINKS],payload:W.getPayload(C),withoutTrouter:!0,requestName:J.NETWORK_REQUESTS.UPDATE_LWJ_LINKS,causeId:e}).then(function(t){C.disposed||C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_LWJ_LINKS_SUCCESS,{causeId:e})}).catch(function(t){var n=Z.getErrorForXHRFailure(t);C.logger.info("["+e+"][updateLwjLinks] error : "+a.getPrintableObject(n)),C.disposed||C.telemetryHelper.recordEvent(J.EVENTS.UPDATE_LWJ_LINKS_FAILED,i({causeId:e},n.error))}))},this.sendAttachToCallInternal=function(e){var t;void 0===e&&(e=Z.causeId()),C.telemetryHelper.recordEvent(J.EVENTS.SEND_ATTACH,{causeId:e}),C.logger.info("["+e+"][sendAttachToCallInternal]");var n=C.signalingAgentConfig.sendProgressFromCC?((t={})[Q.default.HEADERS.CACHE_SKYPE_TOKEN]="1",t):null;return C.http.sendPostRequest({url:C.incomingCallPayload.callNotification.links.attach,customHeaders:n,requestName:J.NETWORK_REQUESTS.SEND_CALL_ATTACH,payload:_.getPayload(C,C.incomingCallPayload.conversationInvitation.conversationController,!C.getInitialMediaOfferFromIncomingCallPayload()),causeId:e}).then(function(t){if(!C.disposed){C.processAttachResponse(C.incomingCallPayload,t,e);var n=t.response.additionalActionResponses;n&&n.length>0&&(C.processConversationServiceResponse(n[0].output,e),n[0].output.roster&&(C.logger.info("["+e+"][sendAttachToCallInternal] handling roster update from join response"),"Delta"===n[0].output.roster.type&&"MultiPartyEndpoint"===n[0].output.roster.type||(n[0].output.roster.type=C.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint"),C.internalHandleRosterUpdate(n[0].output.roster,!0,e))),C.onCallStatusChanged(Q.default.CALL_STATUS.RINGING,e),C.telemetryHelper.setTimeToRingDuration(),C.handleBrokerSubscription(t.response.callInvitation)}}).catch(function(t){var n=Z.getErrorForXHRFailure(t);C.logger.info("["+e+"][sendAttachToCallInternal] error: "+a.getPrintableObject(t)+" xhrError: "+a.getPrintableObject(n)),C.disposed||(C.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,C.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultValue:J.default.RESULT_VALUE.FAILURE,endCode:n.telemetryEndSubCode,endSubCode:n.error.subCode,resultCategories:n&&n.error&&n.error.resultCategories,resultDetail:C.getTerminatingCallResultDetail("attach",n.error),causeId:e}),C.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,e,n.error),C.dispose(n.error,e))})},this._processCallAcceptance=function(e,t){if(C.logger.info("["+t+"][_processCallAcceptance]"),C.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING){C.processCallAcceptance(e.body,t),C.telemetryHelper.setTimeToRingDuration();try{C.multiParty||C.callUsesMixer||C.participantManager.handleRosterUpdate(C.getFakeRoster(e.body),!0,t)}catch(e){var n={code:Q.default.CALL_END_CODE.BAD_SERVICE_RESPONSE,subCode:Q.default.CALL_END_SUB_CODE.CALL_ACCEPTANCE_INVALID_SERVICE_RESPONSE,phrase:e&&e.toString()};throw C.logger.info("["+t+"][_processCallAcceptance] "+a.safeJsonStringify(n)),C.telemetryHelper.recordEvent(J.EVENTS.HANDLE_ROSTER_UPDATE_FAIL,n),n}}},this.restartKeepAliveInterval=function(e,t){void 0===e&&(e=!1),C.disposed||(e&&C.telemetryHelper.recordEvent(J.EVENTS.SEND_KEEP_ALIVE_FAILED,t),C.keepAliveTimer=window.setInterval(C.sendKeepAlive.bind(C),C.keepAliveInterval))},this.isCallOngoing=function(){return C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED||C.fsmState===Q.default.SIGNALING_FSM_STATE.IDLE},this.isCallInProgress=function(){return C.fsmState===Q.default.SIGNALING_FSM_STATE.IDLE||C.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY||C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY},this.isCallConnectedOrConnectedForRoster=function(){return C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED||C.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY},E&&(this.callStartTime=E),this.signalingSessionCallback=t,this.signalingAgentConfig=n,this.signalingAgent=S,this.urlIdentifier=g,this.piiUtils=new v.default(n.piiScrubber),this.isHostLessCall=n.doHostlessCalling||!1,this.logger=n.logger.createChild(function(){return"CSA["+C.correlationId+"]["+C.fsmState+"]"},this.correlationId,!0),this.updateCorrelationId(g),this.logger.info("[endpointId="+a.truncate(this.signalingAgent.endpointId,8)+"]"),this.logger.info("[participantId="+e.participantId+"]"),this.callOperationHandler=new d.default(this.logger.createChild(function(){return"[CallOperationHandler]["+e.participantId+"]"})),this.http=new f.HttpStack(this,this.callStartTime),this.telemetryHelper=new Y.default(this,e,this.callStartTime),this.mediaRenegotiationManager=new h.default(this,t,this.telemetryHelper),this.participantManager=new m.default(this,t,e),this.timeoutManager=new s.default(this.logger),this.contentSharingManager=new p.default(this,t),this.broadcastSession=new l.default(this,t),this.webRtcSignalingManager=new ee.default(this,t),this.pstnContent={emergencyCallCountry:n.emergencyCallCountry||"",platformName:n.clientInformation,publicApiCall:!1},this.setupTrouterChannel(),this.setupConnectionCheck()}return e.prototype.updateEndpointMetadata=function(e,t){var n=this;void 0===t&&(t=Z.causeId());var r={};try{r=JSON.parse(e)}catch(e){return Promise.reject("Invalid metadata")}return this.http.sendPutRequest({url:this.links[Q.default.LINKS.UPDATE_ENDPOINT_METADATA],requestName:J.NETWORK_REQUESTS.UPDATE_ENDPOINT_METADATA,payload:G.getPayload(this,r),causeId:t}).then(function(){n.telemetryHelper.recordEvent(J.EVENTS.UPDATE_ENDPOINT_METADATA_SUCCESS,{causeId:t})}).catch(function(e){var r=Z.getErrorForXHRFailure(e);return n.logger.info("["+t+"][updateEndpointMetadata] error: "+a.getPrintableObject(r)),n.telemetryHelper.recordEvent(J.EVENTS.UPDATE_ENDPOINT_METADATA_FAILURE,i({},r.error)),Promise.reject(r.error)})},e.prototype.isOneToOnePSTNCall=function(){return this.signalingSessionCallback.isOneToOnePstnCall()},e.prototype.getLocationContent=function(){return this.isOneToOnePSTNCall()?Z.tryParse(this.locationInfoContent):null},e.prototype.getNetworkContent=function(){return this.isOneToOnePSTNCall()?Z.tryParse(this.networkInfoContent):null},e.prototype.getAreaContent=function(){return this.isOneToOnePSTNCall()?Z.tryParse(this.areaContent):null},e.prototype.setLocationInfo=function(e,t,n){this.locationInfoContent=e,this.networkInfoContent=t,this.areaContent=n},e.prototype.getEndpointCapabilities=function(e){var t;return this.signalingAgentConfig.enableDeltaRosterWeb?(t=0,this.signalingAgentConfig.brokerEnabledIncoming&&(t|=16),this.signalingAgentConfig.isGVCJoiningEnabled&&(t|=1),"disabled"!==this.signalingAgentConfig.cloudScreenSharingFlag&&(t|=2),this.signalingAgentConfig.supportsHostlessGroupCalls&&(t|=4),e||(t|=64),this.signalingAgentConfig.autoJoinOnConflict&&(t|=32),this.signalingAgentConfig.supportsCompressedServicePayload&&(t|=128),this.signalingAgentConfig.enablePstnMasking&&(t|=1024)):t={implicitCallback:this.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled",cloudAudioVideoConference:this.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:this.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:this.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e?"disabled":"enabled",autoJoinOnConflict:this.signalingAgentConfig.autoJoinOnConflict?"enabled":"disabled",supportsCompressedServicePayload:this.signalingAgentConfig.supportsCompressedServicePayload?"enabled":"disabled",enablePstnMasking:this.signalingAgentConfig.enablePstnMasking?"enabled":"disabled"},t},e.prototype.handleAdmitAllStatus=function(e){var t=e.body&&e.body.transactionResponse,n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handleAdmitAllStatus]["+a.getPrintableObject(t)+"]");var i=t&&t.operationId;if(i&&this.callOperationHandler.hasPendingOperation(0,i,n)){this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.ADMIT,i);var r=t&&t.result&&t.result.code,o=t&&t.result&&t.result.subCode,s=t&&t.result&&t.result.resultCategories,c=t&&t.additionalDetail;if(0===r||r>=200&&r<300){var l={code:r,subCode:o,resultCategories:s,result:a.safeJsonStringify(c)};this.telemetryHelper.recordEvent(J.EVENTS.ADMIT_SUCCESS,{causeId:i,transactionEnd:l}),this.callOperationHandler.resolvePendingOperation(0,i,l,n)}else l={code:r||Q.default.CALL_END_CODE.BAD_REQUEST,subCode:o||0,resultCategories:s,result:t,phrase:Q.default.CALL_END_PHRASE.BAD_SERVICE_RESPONSE},this.telemetryHelper.recordEvent(J.EVENTS.ADMIT_FAILURE,{causeId:i,transactionEnd:l}),this.callOperationHandler.rejectPendingOperation(0,i,"AdmitAllStatus response contains failure",l,n)}else this.logger.warn("["+n+"][handleAdmitAllStatus] invalid admitAllStatus response or no pending operation. operationId="+i)},e.prototype.sendNetworkRequestForAdmit=function(e){var t=this;this.http.sendPostRequest({url:this.links[Q.default.LINKS.ADMIT_ALL],requestName:J.NETWORK_REQUESTS.ADMIT,payload:S.getPayload(this,e),causeId:e,onceTrouterReady:function(){t.timeoutManager.startTimer(Q.default.TIMEOUT_OPERATIONS.ADMIT,function(){t.telemetryHelper.recordEvent(J.EVENTS.ADMIT_TIMEOUT,{causeId:e}),t.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.ADMIT,e),t.callOperationHandler.rejectPendingOperation(0,e,"timed out waiting for admit operation",{code:Q.default.CALL_END_CODE.TIMEOUT,subCode:Q.default.CALL_END_SUB_CODE.ADMIT_TIMEOUT,phrase:Q.default.CALL_END_PHRASE.ADMIT_TIMEOUT},e)},Q.default.TIMEOUT_VALUES_IN_SECONDS.ADMIT_TIMEOUT,e)}}).catch(function(n){var r=Z.getErrorForXHRFailure(n);t.telemetryHelper.recordEvent(J.EVENTS.ADMIT_FAILURE,i({causeId:e},r.error)),t.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.ADMIT,e),t.callOperationHandler.rejectPendingOperation(0,e,n,r.error,e)})},e.prototype.getConversationType=function(e,t){return e?"emergencyGroupCall":t?"cast":null},e.prototype.convertParkType=function(e){return"teamPark"===e?"TransferTypeTeamPark":"sharedLinePark"===e?"TransferTypeSharedLinePark":"serverHold"===e?"TransferTypeServerHold":(this.logger.info("convertParkType, parkType: "+e+" is unknown"),"none")},e.prototype.parkByTransfer=function(e,t){var n=this;this.timeoutManager.startTimer(Q.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,function(){return n.handleCallTransferTimeout(t)},Q.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT);var r=this.getNetworkRequestName(e);return this.http.sendPostRequest({url:this.links[Q.default.LINKS.TRANSFER],requestName:r,payload:M.getPayload(e,this),causeId:t}).catch(function(e){var r=Z.getErrorForXHRFailure(e);return n.logger.info("["+t+"][parkByTransfer] error: "+a.getPrintableObject(r)),n.disposed?Promise.reject(n.getCallNotFoundTransactionEnd()):(n.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:Q.default.CALL_END_CODE.NETWORK_ERROR,reason:a.getPrintableObject(e)}},t),n.telemetryHelper.recordEvent(J.EVENTS.TRANSFER_REQUEST_FAILED,i({causeId:t},r.error)),Promise.reject(r.error))}),this.telemetryHelper.recordEvent(J.EVENTS.TRANSFER_REQUEST_SENT,{causeId:t,transferType:this.convertParkType(e)}),Promise.resolve()},e.prototype.park=function(e,t){var n=this;return this.logger.info("["+t+"][park] context "+e),this.timeoutManager.startTimer(Q.default.TIMEOUT_OPERATIONS.PARK_COMPLETION,function(){return n.handleParkError({code:Q.default.CALL_END_CODE.TIMEOUT,subCode:Q.default.CALL_END_SUB_CODE.PARK_COMPLETION_TIMEOUT,phrase:Q.default.CALL_END_PHRASE.PARK_COMPLETION_TIMEOUT},J.EVENTS.WAITING_FOR_PARK_COMPLETION_TIMEOUT,t,e)},Q.default.TIMEOUT_VALUES_IN_SECONDS.PARK_COMPLETION_TIMEOUT),this.http.sendPostRequest({url:this.links[Q.default.LINKS.PARK],requestName:J.NETWORK_REQUESTS.PARK_REQUEST,payload:w.getPayload(this),causeId:t}).then(function(e){n.logger.info("["+t+"][park] response: "+a.getPrintableObject(e)),n.telemetryHelper.recordEvent(J.EVENTS.WAITING_FOR_PARK_COMPLETION,{causeId:t}),Z.assertNotNull(e.response.holdResponse.links,"server response does not include park links"),n.links[Q.default.LINKS.UNPARK]=e.response.holdResponse.links.resume}).catch(function(i){var r=Z.getErrorForXHRFailure(i);return n.logger.info("["+t+"][park] error: "+a.getPrintableObject(r)),n.disposed?Promise.reject(n.getCallNotFoundTransactionEnd()):(n.handleParkError(r.error,J.EVENTS.PARK_REQUEST_FAILED,t,e),Promise.reject(r.error))}),Promise.resolve()},e.prototype.handleParkError=function(e,t,n,r){this.disposed?this.logger.info("handleParkError ignored"):(this.logger.info("["+n+"] handleParkError reject reason: "+a.getPrintableObject(e)),this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.PARK_COMPLETION),this.signalingSessionCallback.onParkCompleted&&(this.telemetryHelper.recordEvent(t,i({},e,{parkContext:r,causeId:n})),this.signalingSessionCallback.onParkCompleted(e,n)),this.links[Q.default.LINKS.UNPARK]=void 0)},e.prototype.handleParkCompletion=function(e){var t=e.body,n=Z.extractCauseIdFromMessage(e);if(this.disposed)this.logger.info("["+n+"]handleParkCompletion ignored");else{this.logger.info("["+n+"][handleParkCompletion] body "+a.getPrintableObject(t));var r=t.holdCompletion;r.code===Q.default.TRANSACTION_END_CODE.SUCCESS?(this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.PARK_COMPLETION),this.telemetryHelper.recordEvent(J.EVENTS.PARK_COMPLETED,i({},r,{causeId:n})),this.signalingSessionCallback.onParkCompleted(r,n)):this.handleParkError(r,J.EVENTS.PARK_FAILED,n)}},e.prototype.handleUnparkError=function(e,t,n,r){this.disposed?this.logger.info("handleUnparkError ignored"):(this.logger.info("["+n+"] handleUnparkError reject reason: "+e),this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION),this.signalingSessionCallback.onUnparkCompleted&&(this.telemetryHelper.recordEvent(t,i({},e,{parkContext:r,causeId:n})),this.signalingSessionCallback.onUnparkCompleted(e,n)),this.links[Q.default.LINKS.UNPARK]=void 0)},e.prototype.handleUnparkCompletion=function(e){var t=e.body,n=Z.extractCauseIdFromMessage(e);if(this.disposed)this.logger.info("["+n+"]handleUnparkCompletion ignored");else{this.logger.info("["+n+"][handleUnparkCompletion] body "+a.getPrintableObject(t));var r=t.resumeCompletion;r.code===Q.default.TRANSACTION_END_CODE.SUCCESS?(this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION),this.telemetryHelper.recordEvent(J.EVENTS.UNPARK_COMPLETED,i({},r,{causeId:n})),this.signalingSessionCallback.onUnparkCompleted(r,n),this.links[Q.default.LINKS.UNPARK]=void 0):this.handleUnparkError(r,J.EVENTS.UNPARK_FAILED,n)}},e.prototype.getNetworkRequestName=function(e){return{none:null,teamPark:J.NETWORK_REQUESTS.SEND_PARK_REQUEST,sharedLinePark:J.NETWORK_REQUESTS.SEND_SHARED_LINE_PARK_REQUEST,serverHold:J.NETWORK_REQUESTS.SEND_SERVER_HOLD_REQUEST}[e]},e.prototype.publishStateAsync=function(e,t,n,i,r,o){var s=this;this.logger.info("["+n+"][publishStateAsync][publishType="+e+" publishLevel="+t+"]"),this.telemetryHelper.recordEvent(J.EVENTS.PUBLISH_STATE,{causeId:n,publishType:e,publishLevel:t});var c=this.links[Q.default.LINKS.PUBLISH_STATE];if(!c){var l={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.PUBLISH_STATE_LINK_MISSING,phrase:"publish state link is missing"};return this.logger.warn(l),Promise.reject(l)}var u={};try{u=JSON.parse(i)}catch(e){return l={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_CONTENT,phrase:"publish state content is invalid"},this.logger.warn(l),Promise.reject(l)}return this.http.sendPostRequest({url:c,requestName:J.NETWORK_REQUESTS.PUBLISH_STATE,payload:L.getPayload(this,e,t,u,++this.publishStateSequenceNumber,r,o),causeId:n,requestId:n}).then(function(e){if(e&&e.response&&e.response.publishStateResponse)return s.parsePublishStateResult(e,n);var t="Invalid CS response which does not contains publishStateResponse. Respone: "+(e&&e.response?JSON.stringify(e.response):"no response");throw s.logger.warn(t),{response:{code:Q.default.CALL_END_CODE.DECODING_FAILED,subCode:Q.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_SERVICE_RESPONSE,phrase:t}}}).catch(function(e){var t=Z.getErrorForXHRFailure(e);s.logger.info("["+n+"][publishStateAsync] error: "+a.getPrintableObject(t));var i=t.error;return s.telemetryHelper.recordEvent(J.EVENTS.PUBLISH_STATE_FAILURE,{causeId:n,transactionEnd:i}),Promise.reject(i)})},e.prototype.parsePublishStateResult=function(e,t){var n={};if(e&&e.response&&e.response.publishStateResponse){if(e.response.publishStateResponse.stateId)return e.response.publishStateResponse.stateId;if(e.response.publishStateResponse.results)return e.response.publishStateResponse.results.forEach(function(e){n[e.participantId]={code:e.result.code,phrase:e.result.phrase,subCode:e.result.subCode}}),JSON.stringify(n);if(e.response.publishStateResponse.result)return n={code:e.response.publishStateResponse.result.code,phrase:e.response.publishStateResponse.result.phrase,subCode:e.response.publishStateResponse.result.subCode,additionalDetail:e.response.publishStateResponse.additionalDetail},JSON.stringify(n)}var i="Invalid CS response which does not contains publishStateResponse. Respone: "+(e&&e.response?JSON.stringify(e.response):"no response");throw this.logger.warn(i),{response:{code:Q.default.CALL_END_CODE.DECODING_FAILED,subCode:Q.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_SERVICE_RESPONSE,phrase:i}}},e.prototype.removeStateAsync=function(e,t,n,i){var r=this;if(this.logger.info("["+e+"][removeStateAsync][scope="+t+" publishType="+n+" stateIds="+i+"]"),this.telemetryHelper.recordEvent(J.EVENTS.REMOVE_STATE,{causeId:e,scope:t,publishType:n,stateIds:i}),!n&&!i){var o={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.REMOVE_STATE_MISSING_ARGUMENTS,phrase:"remove state operation miss arguments"};return this.logger.warn(o),Promise.reject(o)}var s=this.links[Q.default.LINKS.REMOVE_STATE];return s?this.http.sendPostRequest({url:s,requestName:J.NETWORK_REQUESTS.REMOVE_STATE,payload:x.getPayload(this,++this.publishStateSequenceNumber,t,i,n),causeId:e,requestId:e}).then(function(t){return r.parseRemoveStateResult(t,e)}).catch(function(t){var n=Z.getErrorForXHRFailure(t);r.logger.info("["+e+"][removeStateAsync] error: "+a.getPrintableObject(n));var i=n.error;return r.telemetryHelper.recordEvent(J.EVENTS.REMOVE_STATE_FAILURE,{causeId:e,transactionEnd:i}),Promise.reject(i)}):(o={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.REMOVE_STATE_LINK_MISSING,phrase:"remove state link is missing"},this.logger.warn(o),Promise.reject(o))},e.prototype.parseRemoveStateResult=function(e,t){var n={};return e&&e.response&&e.response.removeStateResponse&&(e.response.removeStateResponse.results?e.response.removeStateResponse.results.forEach(function(e){n[e.stateId]={code:e.result.code,phrase:e.result.phrase,subCode:e.result.subCode}}):e.response.removeStateResponse.result&&(n={code:e.response.removeStateResponse.result.code,phrase:e.response.removeStateResponse.result.phrase,subCode:e.response.removeStateResponse.result.subCode,additionalDetail:e.response.removeStateResponse.additionalDetail})),JSON.stringify(n)},e.prototype.updateMeetingSettingsAsync=function(e,t){var n=this;this.logger.info("["+t+"][updateMeetingSettingsAsync][meetingSettings="+e+"]"),this.telemetryHelper.recordEvent(J.EVENTS.UPDATE_MEETING_SETTINGS,{causeId:t,meetingSettings:e});var i=this.links[Q.default.LINKS.UPDATE_MEETING_SETTINGS];if(!i){var o={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.UPDATE_MEETING_SETTINGS_LINK_MISSING,phrase:"update meeting settings link is missing"};return this.logger.warn(o),Promise.reject(o)}return Object.keys(e).length?this.http.sendPutRequest({url:i,requestName:J.NETWORK_REQUESTS.UPDATE_MEETING_SETTINGS,payload:q.getPayload(this,++this.publishStateSequenceNumber,e),causeId:t,requestId:t}).then(function(){return r.noop()}).catch(function(e){var i=Z.getErrorForXHRFailure(e);n.logger.info("["+t+"][updateMeetingSettingsAsync] error: "+a.getPrintableObject(i));var r=i.error;throw n.telemetryHelper.recordEvent(J.EVENTS.UPDATE_MEETING_SETTINGS_FAILURE,{causeId:t,transactionEnd:r}),r}):(o={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.UPDATE_MEETING_SETTINGS_MISSING_ARGUMENTS,phrase:"update meeting settings missing arguments"},this.logger.warn(o),Promise.reject(o))},e.prototype.searchParticipantsAsync=function(e,t){var n=this;this.logger.info("["+t+"][searchParticipantsAsync][queryOptions="+e+"]"),this.telemetryHelper.recordEvent(J.EVENTS.SEARCH_PARTICIPANTS,{causeId:t,queryOptions:e});var i=this.links[Q.default.LINKS.SEARCH_PARTICIPANTS];if(!i){var r={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.SEARCH_PARTICIPANTS_LINK_MISSING,phrase:"search participants link is missing"};return this.logger.warn(r),Promise.reject(r)}return this.http.sendPostRequest({url:i,requestName:J.NETWORK_REQUESTS.SEARCH_PARTICIPANTS,payload:F.getPayload(this,e),causeId:t,requestId:t}).then(function(e){if(e&&e.response&&e.response.participants)return n.parseSearchParticipantsResult(e,t);var i="Invalid CS response which does not contain proper search results. Respone: "+(e&&e.response?JSON.stringify(e.response):"no response");throw n.logger.warn(i),{response:{code:Q.default.CALL_END_CODE.DECODING_FAILED,subCode:Q.default.CALL_END_SUB_CODE.SEARCH_PARTICIPANTS_INVALID_SERVICE_RESPONSE,phrase:i}}}).catch(function(e){var i=Z.getErrorForXHRFailure(e);n.logger.info("["+t+"][searchParticipantsAsync] error: "+a.getPrintableObject(i));var r=i.error;return n.telemetryHelper.recordEvent(J.EVENTS.SEARCH_PARTICIPANTS_FAILURE,{causeId:t,transactionEnd:r}),Promise.reject(r)})},e.prototype.parseSearchParticipantsResult=function(e,t){var n=[];if(e&&e.response){var i=e.response.participants;if(i)for(var r=0,o=Object.keys(i);r<o.length;r++){var a=o[r];n.push(g.default.fromRosterSearchResults(e.response.participants[a]))}}return{participants:n}},e.prototype.getAllParticipantsAsync=function(e,t){var n=this;this.logger.info("["+t+"][getAllParticipantsAsync][scope="+e+"]"),this.telemetryHelper.recordEvent(J.EVENTS.GET_ALL_PARTICIPANTS,{causeId:t,scope:e});var i=this.links[Q.default.LINKS.GET_ALL_PARTICIPANTS];if(!i){var r={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_LINK_MISSING,phrase:"get all participants link is missing"};return this.logger.warn(r),Promise.reject(r)}return"lobby"!==e?(r={code:Q.default.CALL_END_CODE.REJECT,subCode:Q.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_INVALID_SCOPE,phrase:"get all participants scope is invalid"},this.logger.warn(r),Promise.reject(r)):this.http.sendPostRequest({url:i,requestName:J.NETWORK_REQUESTS.GET_ALL_PARTICIPANTS,payload:R.getPayload(this,e),causeId:t,requestId:t}).then(function(e){if(e&&e.response)return{participants:e.response.particiapnts};var t="Invalid CS response which does not contain results.";throw n.logger.warn(t),{response:{code:Q.default.CALL_END_CODE.DECODING_FAILED,subCode:Q.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_INVALID_SERVICE_RESPONSE,phrase:t}}}).catch(function(e){var i=Z.getErrorForXHRFailure(e);n.logger.info("["+t+"][getAllParticipantsAsync] error: "+a.getPrintableObject(i));var r=i.error;return n.telemetryHelper.recordEvent(J.EVENTS.GET_ALL_PARTICIPANTS_FAILURE,{causeId:t,transactionEnd:r}),Promise.reject(r)})},e.prototype.setClientRejectReason=function(e,t){e.clientReasonSubCode=t.clientReasonSubCode,e.clientReasonPhrase=t.clientReasonPhrase},e.prototype.resetState=function(){this.currentCallStatus=null,this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE},e.prototype.saveUpdatedCallLinksIfAny=function(e){e.links&&(this.logger.info("saveUpdatedCallLinksIfAny, updated call links found, update to new links "+a.getPrintableObject(e)),this.links[Q.default.LINKS.MEDIA_RENEGOTIATION]=e.links.mediaRenegotiation||this.links[Q.default.LINKS.MEDIA_RENEGOTIATION],this.links[Q.default.LINKS.TRANSFER]=e.links.transfer||this.links[Q.default.LINKS.TRANSFER],this.links[Q.default.LINKS.REPLACE]=e.links.replacement||this.links[Q.default.LINKS.REPLACE],this.links[Q.default.LINKS.HANGUP]=e.links.callLeg||this.links[Q.default.LINKS.HANGUP],this.links[Q.default.LINKS.KEEPALIVE]=e.links.callLeg||this.links[Q.default.LINKS.KEEPALIVE],this.links[Q.default.LINKS.PARK]=e.links.hold||this.links[Q.default.LINKS.PARK])},e.prototype.ensureMessageChannelReady=function(e){return this.disposed?(this.logger.info("ensureMessageChannelReady: error: call already disposed"),Promise.reject(this.getCallNotFoundTransactionEnd())):this.brokerService?(this.telemetryHelper.addTrouterWaitOperation(J.default.TROUTER_WAIT_OPERATION.STARTED+":"+e),this.telemetryHelper.addTrouterWaitOperation(J.default.TROUTER_WAIT_OPERATION.ENDED+":"+e),Promise.resolve()):this.ensureLatestTrouterUrl(e)},e.prototype.ensureLatestTrouterUrl=function(e){var t=this;return this.telemetryHelper.addTrouterWaitOperation(J.default.TROUTER_WAIT_OPERATION.STARTED+":"+e),this.getTrouterUrlAsync().then(function(n){return!n||"string"==typeof n&&!n.trim()?(t.telemetryHelper.recordEvent(J.EVENTS.TROUTER_URL_CHANGED_TO_INVALID),t.telemetryHelper.addTrouterWaitOperation(J.default.TROUTER_WAIT_OPERATION.ENDED+":"+e),Promise.reject(new Error("Invalid trouter url"))):t.disposed?(t.logger.info("ensureLatestTrouterUrl, trouterUrlGetter returned too late. Object is already disposed"),Promise.reject(t.getCallNotFoundTransactionEnd())):(t.telemetryHelper.addTrouterWaitOperation(J.default.TROUTER_WAIT_OPERATION.ENDED+":"+e),t.baseMessagingChannelUrl=t.currentTrouterUrl=n,Promise.resolve())}).catch(function(n){return t.disposed||t.telemetryHelper.addTrouterWaitOperation(J.default.TROUTER_WAIT_OPERATION.FAILED+":"+e),t.logger.info("ensureLatestTrouterUrl, failed because:"+n),Promise.reject(n)})},e.prototype.signalTransferAcceptedAsync=function(e,t){var n=this;return void 0===t&&(t=Z.causeId()),this.logger.info("[signalTransferAcceptedAsync]["+t+"] transferType "+e),this.disposed?(this.logger.info("[signalTransferAcceptedAsync]["+t+"] Call already ended, skip acceptance request"),Promise.reject({code:Q.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):(this.telemetryHelper.recordEvent(J.EVENTS.SEND_ACCEPT_TRANSFER,{causeId:t,transferType:e}),this.http.sendPostRequest({url:this.links[Q.default.LINKS.TRANSFER_ACCEPTANCE],requestName:J.NETWORK_REQUESTS.TRANSFER_ACCEPTANCE,payload:U.getPayload(),causeId:t}).catch(function(e){var i=Z.getErrorForXHRFailure(e);return n.logger.info("[signalTransferAcceptedAsync]["+t+"] error: "+a.getPrintableObject(i)),n.telemetryHelper.recordEvent(J.EVENTS.SEND_ACCEPT_TRANSFER_FAIL,{causeId:t}),Promise.reject(i.error)}))},e.prototype.signalTransferCompletedAsync=function(e,t){var n=this;return void 0===t&&(t=Z.causeId()),this.logger.info("[signalTransferCompletedAsync]["+t+"] rejectReason "+e),this.disposed?(this.logger.info("[signalTransferCompletedAsync]["+t+"]  Call already ended by transferor, skip completion request"),Promise.reject({code:Q.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):(0!==e.code?this.telemetryHelper.recordEvent(J.EVENTS.TRANSFER_COMPLETION_FAILED,{code:e.code,subcode:e.subCode,causeId:t}):this.telemetryHelper.recordEvent(J.EVENTS.TRANSFER_COMPLETED,{causeId:t}),this.telemetryHelper.recordEvent(J.EVENTS.SEND_COMPLETE_TRANSFER,{causeId:t}),this.http.sendPostRequest({url:this.links[Q.default.LINKS.TRANSFER_COMPLETION],requestName:J.NETWORK_REQUESTS.TRANSFER_COMPLETION,payload:H.getPayload(e),causeId:t}).catch(function(e){n.telemetryHelper.recordEvent(J.EVENTS.SEND_COMPLETE_TRANSFER_FAILED,{causeId:t});var i=Z.getErrorForXHRFailure(e);return n.logger.info("[signalTransferCompletedAsync]["+t+"] error: "+a.getPrintableObject(i)),Promise.reject(i.error)}))},e.prototype.endWithBeacon=function(e){if(navigator&&navigator.sendBeacon&&!this.disposed){var t={code:Q.default.CALL_END_CODE.SUCCESS,subCode:Q.default.CALL_END_SUB_CODE.BEACON,phrase:Q.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};this.telemetryHelper.recordEvent(J.EVENTS.END_WITH_BEACON,{causeId:e});var n=JSON.stringify(P.getPayload(this,t).payload),i=-1===this.links[Q.default.LINKS.LEAVE].indexOf("?")?"?":"&",r="skypeToken="+this.signalingAgent.authTokenManager.getLastToken(e);return navigator.sendBeacon(""+this.links[Q.default.LINKS.LEAVE]+i+r,n)}return!1},e.prototype.setFsmState=function(e){this.fsmState=e},e.prototype.processConversationServiceResponseHeaders=function(e,t){this.logger.info("["+t+"][processConversationServiceResponseHeaders]");try{var n=e.request.getResponseHeader(Q.default.HEADERS.CORRELATION_ID);this.updateCorrelationId(n,t)}catch(e){this.logger.info("["+t+"][processConversationServiceResponseHeaders] failed, reason="+a.getPrintableObject(e))}},e.prototype.processConversationServiceResponse=function(e,t){this.logger.info("["+t+"][processConversationServiceResponse]"),this.convJoined=!0,this.links[Q.default.LINKS.CONVERSATION_CONTROLLER]=e.conversationController,this.links[Q.default.LINKS.ADD_PARTICIPANT]=e.links.addParticipant,this.links[Q.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]=e.links.addParticipantAndModality,this.links[Q.default.LINKS.LEAVE]=e.links.leave,this.links[Q.default.LINKS.NOTIFICATION_LINKS]=e.links.notificationLinks,this.links[Q.default.LINKS.REMOVE_PARTICIPANT]=e.links.removeParticipant,this.links[Q.default.LINKS.ADD_MODALITY]=e.links.addModality,this.links[Q.default.LINKS.REMOVE_MODALITY]=e.links.removeModality,this.links[Q.default.LINKS.MUTE]=e.links.mute||null,this.links[Q.default.LINKS.UNMUTE]=e.links.unmute||null,this.links[Q.default.LINKS.ADMIT]=e.links.admit||null,this.links[Q.default.LINKS.ADMIT_ALL]=e.links.admitAll||null,this.links[Q.default.LINKS.UPDATE_ENDPOINT_STATE]=e.links.updateEndpointState||null,this.links[Q.default.LINKS.UPDATE_ENDPOINT_METADATA]=e.links.updateEndpointMetadata||null,this.links[Q.default.LINKS.UPDATE_PARTICIPANT_ROLE]=e.links.updateParticipantRole||null,this.links[Q.default.LINKS.PUBLISH_STATE]=e.links.publishState||null,this.links[Q.default.LINKS.REMOVE_STATE]=e.links.removeState||null,this.links[Q.default.LINKS.UPDATE_MEETING_SETTINGS]=e.links.updateMeetingSettings||null,this.links[Q.default.LINKS.SEARCH_PARTICIPANTS]=e.links.searchParticipants||null,this.links[Q.default.LINKS.GET_ALL_PARTICIPANTS]=e.links.getAllParticipants||null,this.convSubject=e.subject,e.state&&(this.setMultiParty(e.state.isMultiParty,t),this.isHostLessCall=e.state.isHostless||!1,this.conversationType=e.state.conversationType,this.isCastCall=!!e.state.conversationType&&"cast"===e.state.conversationType),e.activeModalities&&e.activeModalities.groupChat&&this.updateGroupChatIds(e.activeModalities.groupChat,t),this.handleMeetingDetailsChanged(e,t),this.handleBrokerSubscription(e),this.linkUpdateRequested.conversationLinks&&(this.logger.info("["+t+"][processConversationServiceResponse] Updating CS links as requested"),this.updateLinks(this.updateConversationLinks,t)),this.isProcessSelfDataFromSubscribeResponseEnabled()&&e.subscriptionDetails&&e.subscriptionDetails.selfParticipant&&this.participantManager.updateLocalParticipantFromSubscribe(e.subscriptionDetails.selfParticipant,t),e.meetingData&&(this.meetingData=e.meetingData),e.meetingInfo&&(this.meetingInfo=e.meetingInfo),e.region&&(this.region=e.region),this.signalingSessionCallback.onConversationUpdated({conversationType:this.conversationType,threadId:this.threadId,teamsMessageId:this.teamsMessageId,isMultiParty:this.multiParty,commandUrlPresence:this.getCommandUrlPresence(),meetingData:this.meetingData,region:this.region,meetingInfo:this.meetingInfo},t)},e.prototype.handlePendingEndpointState=function(e){var t=this;this.requestedEndpointStateWhileConnecting&&(this.logger.info("["+e+"][handlePendingEndpointState]sending pending endpoint state now that we are connected."),this.updateEndpointState(this.requestedEndpointStateWhileConnecting,e).catch(function(e){t.isPreheatOnly&&(t.logger.info("handlePendingEndpointState failed"),t.disablePreheatDefer.reject(e))}))},e.prototype.handleMeetingDetailsChanged=function(e,t){this.logger.info("["+t+"][handleMeetingDetailsChanged]"),e.meetingDetails&&!r.isEqual(e.meetingDetails,this.meetingDetails)&&this.signalingSessionCallback.onMeetingDetailsUpdated&&(this.meetingDetails=e.meetingDetails,this.signalingSessionCallback.onMeetingDetailsUpdated(this.meetingDetails,t))},e.prototype.handleBrokerSubscription=function(e){e.links.subscribe&&(this.brokerService?this.brokerService.subscribeToBroker(e.links.subscribe):this.telemetryHelper.recordEvent(J.EVENTS.BROKER_DISABLED_SUBSCRIBE_URL_PRESENT))},e.prototype.cancelOutgoingCall=function(e,t){var n=this,i=Z.defer();this.logger.info("["+t+"][cancelOutgoingCall][rejectionData="+(e&&a.getPrintableObject(e))+"]");var r=e&&(e.code||e.subCode)?e:{code:Q.default.CALL_END_CODE.CANCEL,subCode:Q.default.CALL_END_SUB_CODE.SUCCESS,phrase:Q.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};if(e&&this.setClientRejectReason(r,e),this.links.hasOwnProperty(Q.default.LINKS.LEAVE)){this.logger.info("["+t+"][cancelOutgoingCall] cancelling outgoing call"),this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE;var o={cancelationDuration:this.telemetryHelper.getCallCancelationDuration()};this.http.sendPostRequest({url:this.links[Q.default.LINKS.LEAVE],requestName:J.NETWORK_REQUESTS.CANCEL_CALL,payload:I.getPayload(this,r,o),causeId:t}).then(function(e){n.disposed||(n.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultDetail:"Cancel",endCode:r.code,endSubCode:r.subCode,causeId:t,clientReasonSubCode:r.clientReasonSubCode,clientReasonPhrase:r.clientReasonPhrase,resultCategories:[Q.RESULT_CATEGORIES.Success]}),r.resultCategories=[Q.RESULT_CATEGORIES.ExpectedError],n.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,t,r),n.dispose(r,t)),i.resolve(null)}).catch(function(e){var o=Z.getErrorForXHRFailure(e);if(n.logger.info("[cancelOutgoingCall]["+t+"] error: "+a.getPrintableObject(e)+" xhrError: "+a.getPrintableObject(o)),!n.disposed){var s={terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,endCode:r.code,endSubCode:r.subCode,resultDetail:n.getTerminatingCallResultDetail("cancel",o.error),causeId:t,clientReasonSubCode:r.clientReasonSubCode,clientReasonPhrase:r.clientReasonPhrase,resultCategories:o&&o.error&&o.error.resultCategories};n.telemetryHelper.setTerminatingData(s),r.resultCategories=s.resultCategories,n.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,t,r),n.dispose(r,t)}i.resolve(null)})}else{this.logger.info("["+t+"][cancelOutgoingCall] Conversation Service Leave Url is not yet set. Cannot leave conversation. Disposing anyways."),r.subCode=Q.default.CALL_END_SUB_CODE.CONV_URL_NOT_SET;var s={terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultDetail:this.getTerminatingCallResultDetail("cancel",r),endCode:r.code,endSubCode:r.subCode,causeId:t,clientReasonSubCode:r.clientReasonSubCode,clientReasonPhrase:r.clientReasonPhrase,resultCategories:[Q.RESULT_CATEGORIES.Success]};this.telemetryHelper.setTerminatingData(s),r.resultCategories=s.resultCategories,this.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,t,r),this.dispose(r,t),i.resolve(null)}return i.promise},e.prototype.terminateEstablishedCall=function(e,t){var n=this,i=t.causeId||Z.causeId();this.logger.info("["+i+"][terminateEstablishedCall]");var r=Z.defer();this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE;var o=this.convJoined?J.NETWORK_REQUESTS.LEAVE_CONVERSATION:J.NETWORK_REQUESTS.END_CALL,s=$.build(),c=e&&(e.code||e.subCode)?e:{code:Q.default.CALL_END_CODE.SUCCESS,subCode:Q.default.CALL_END_SUB_CODE.SUCCESS,phrase:Q.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};return e&&this.setClientRejectReason(c,e),this.leaveConversation(c,t).then(function(){if(n.logger.info("["+i+"][terminateEstablishedCall]success"),!n.disposed){var t={terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,endCode:c.code,endSubCode:c.subCode,resultDetail:c.phrase,causeId:i,clientReasonSubCode:c.clientReasonSubCode,clientReasonPhrase:c.clientReasonPhrase,resultCategories:c.resultCategories||[Q.RESULT_CATEGORIES.Success]};n.telemetryHelper.setTerminatingData(t),e.resultCategories=t.resultCategories,n.telemetryHelper.addNetworkOperationCompleted(o,!0,s.duration()),n.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,i,c),n.dispose(c,i)}r.resolve(null)}).catch(function(e){var t=Z.getErrorForXHRFailure(e);if(n.logger.info("["+i+"][terminateEstablishedCall][failed] error: "+a.getPrintableObject(e)+" xhrError: "+a.getPrintableObject(t)+"]"),!n.disposed){var l={terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,endCode:c.code,endSubCode:c.subCode,resultDetail:n.getTerminatingCallResultDetail("terminate",t.error),causeId:i,clientReasonSubCode:c.clientReasonSubCode,clientReasonPhrase:c.clientReasonPhrase,resultCategories:t&&t.error&&t.error.resultCategories};n.telemetryHelper.setTerminatingData(l),n.telemetryHelper.addNetworkOperationCompleted(o,!1,s.duration()),c.resultCategories=l.resultCategories,n.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,i,c),n.dispose(c,i)}r.resolve(null)}),r.promise},e.prototype.deleteConversation=function(e,t){var n=this;this.logger.info("["+t+"][deleteConversation]");var i=Z.defer();this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE;var r=J.NETWORK_REQUESTS.DELETE_CONVERSATION,o=$.build(),s=e&&(e.code||e.subCode)?e:{code:Q.default.CALL_END_CODE.SUCCESS,subCode:Q.default.CALL_END_SUB_CODE.SUCCESS,phrase:Q.default.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED,causeId:t};return e&&this.setClientRejectReason(s,e),this.deleteConversationController(s,t).then(function(){if(n.logger.info("["+t+"][deleteConversation]success"),!n.disposed){var e={terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:s.phrase,causeId:t,clientReasonSubCode:s.clientReasonSubCode,clientReasonPhrase:s.clientReasonPhrase,resultCategories:s.resultCategories||[Q.RESULT_CATEGORIES.Success]};n.telemetryHelper.setTerminatingData(e),n.telemetryHelper.addNetworkOperationCompleted(r,!0,o.duration()),s.resultCategories=e.resultCategories,n.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,t,s),n.dispose(s,t)}i.resolve(null)}).catch(function(e){var c=Z.getErrorForXHRFailure(e);if(n.logger.info("["+t+"][deleteConversation][failed] error: "+a.getPrintableObject(e)+" xhrError: "+a.getPrintableObject(c)),!n.disposed){var l={terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:n.getTerminatingCallResultDetail("delete",c.error),causeId:t,clientReasonSubCode:s.clientReasonSubCode,clientReasonPhrase:s.clientReasonPhrase,resultCategories:c&&c.error&&c.error.resultCategories};n.telemetryHelper.setTerminatingData(l),n.telemetryHelper.addNetworkOperationCompleted(r,!1,o.duration()),s.resultCategories=l.resultCategories,n.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,t,s),n.dispose(s,t)}i.resolve(null)}),i.promise},e.prototype.leaveConversation=function(e,t){var n=t.causeId||Z.causeId();if(this.convJoined){this.logger.info("["+n+"][leaveConversation]");var i={cancelationDuration:this.telemetryHelper.getCallCancelationDuration()};return this.http.sendPostRequest({url:this.links[Q.default.LINKS.LEAVE],requestName:J.NETWORK_REQUESTS.LEAVE_CONVERSATION,payload:P.getPayload(this,e,i,t.scope),withoutTrouter:!0,causeId:n})}return this.logger.info("["+n+"][leaveConversation] ignore, not joined to conversation"),Promise.resolve(void 0)},e.prototype.deleteConversationController=function(e,t){return this.convJoined?(this.logger.info("["+t+"][deleteConversationController]"),this.http.sendDeleteRequest({url:this.links[Q.default.LINKS.CONVERSATION_CONTROLLER],requestName:J.NETWORK_REQUESTS.DELETE_CONVERSATION,payload:b.getPayload(this,e),withoutTrouter:!0,causeId:t})):(this.logger.info("["+t+"][deleteConversationController]ignored, not joined to conversation"),Promise.resolve(void 0))},e.prototype.rejectIncomingCall=function(e,t){var n=this;this.telemetryHelper.recordEvent(J.EVENTS.REJECT_INCOMING_CALL,t),this.logger.info("["+t+"][rejectIncomingCall]");var i=Z.defer();this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE;var r=e&&(e.code||e.subCode)?e:{code:Q.default.CALL_END_CODE.LOCAL_ERROR,subCode:Q.default.CALL_END_SUB_CODE.SUCCESS,phrase:Q.default.CALL_END_PHRASE.LOCAL_ERROR};return e&&this.setClientRejectReason(r,e),this.http.sendDeleteRequest({url:this.links[Q.default.LINKS.REJECT],requestName:J.NETWORK_REQUESTS.REJECT_CALL,payload:k.getPayload(this,r),causeId:t}).then(function(o){if(!n.disposed){var a={terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,endCode:r.code,endSubCode:r.subCode,resultDetail:n.getTerminatingCallResultDetail("reject",e),causeId:t,clientReasonSubCode:r.clientReasonSubCode,clientReasonPhrase:r.clientReasonPhrase,resultCategories:e.resultCategories||[Q.RESULT_CATEGORIES.Success]};n.telemetryHelper.setTerminatingData(a),r.resultCategories=a.resultCategories,n.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,t,r),n.dispose(r,t)}i.resolve(null)}).catch(function(e){var o=Z.getErrorForXHRFailure(e);if(n.logger.info("[rejectIncomingCall]["+t+"] error: "+a.getPrintableObject(e)+" xhrError: "+a.getPrintableObject(o)),!n.disposed){var s={terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,endCode:r.code,endSubCode:r.subCode,resultDetail:n.getTerminatingCallResultDetail("reject",o.error),causeId:t,clientReasonSubCode:r.clientReasonSubCode,clientReasonPhrase:r.clientReasonPhrase,resultCategories:o&&o.error&&o.error.resultCategories};n.telemetryHelper.setTerminatingData(s),r.resultCategories=s.resultCategories,n.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,t,r),n.dispose(r,t)}i.resolve(null)}),i.promise},e.prototype.onCallStatusChanged=function(e,t,n){var i="["+t+"][onCallStatusChanged]";if(this.logger.info(""+i+this.currentCallStatus+"=>"+e+"]"),this.disposed)this.logger.info(i+"Call is already disposed!!");else if(n&&this.logger.info(i+"[statusCode="+a.getPrintableObject(n)+"]"),this.isValidStateTransitions(e)){this.currentCallStatus=e;var r={callStatus:e,statusCode:n,causeId:t};this.isPreheatOnly&&(r.isPreheatOnly=!0),this.telemetryHelper.recordEvent(J.EVENTS.UPDATE_CALL_STATUS,r),this.signalingSessionCallback.onCallStatusChanged(e,n,t),this.currentCallStatus===Q.default.CALL_STATUS.CONNECTED&&(this.handlePendingEndpointState(t),this.telemetryHelper.resetCallCancelationDurationWatch(),this.isPreheatOnly&&this.startCallPreheatTimer(t))}},e.prototype.isValidStateTransitions=function(e){if(this.currentCallStatus===Q.default.CALL_STATUS.LOCAL_TERMINATED&&e===Q.default.CALL_STATUS.CONNECTING)return!0;var t=function(e){switch(e){case Q.default.CALL_STATUS.IDLE:case Q.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY:return 0;case Q.default.CALL_STATUS.CONNECTING:return 1;case Q.default.CALL_STATUS.RINGING:return 2;case Q.default.CALL_STATUS.CONNECTED:return 3;case Q.default.CALL_STATUS.LOCAL_TERMINATED:case Q.default.CALL_STATUS.REMOTE_TERMINATED:return 4;default:return-1}};return t(e)>t(this.currentCallStatus)},e.prototype.handlePSTNBalanceUpdate=function(e){var t=e.body.balanceUpdate,n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handlePSTNBalanceUpdate]"),this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,e),t.updateBalance?this.signalingSessionCallback.onPSTNBalanceUpdate(t):this.logger.info(J.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,"this was a pstn keepAlive message - ignore")},e.prototype.handleCallAcceptanceAck=function(e){var t=e.body,n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handleCallAcceptanceAck]"),this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_CALL_ACCEPTANCE_ACK,e),this.internalHandleCallAcceptanceAck(t,n)},e.prototype.internalHandleCallAcceptanceAck=function(e,t){this.logger.info("["+t+"][internalHandleCallAcceptanceAck] "+a.getPrintableObject(e)),this.fsmState!==Q.default.SIGNALING_FSM_STATE.CONNECTED&&(this.links[Q.default.LINKS.MEDIA_RENEGOTIATION]=e.callAcceptanceAcknowledgement.links.mediaRenegotiation,this.links[Q.default.LINKS.TRANSFER]=e.callAcceptanceAcknowledgement.links.transfer,this.links[Q.default.LINKS.REPLACE]=e.callAcceptanceAcknowledgement.links.replacement,this.links[Q.default.LINKS.HANGUP]=e.callAcceptanceAcknowledgement.links.callLeg,this.links[Q.default.LINKS.KEEPALIVE]=e.callAcceptanceAcknowledgement.links.callLeg,this.links[Q.default.LINKS.PARK]=e.callAcceptanceAcknowledgement.links.hold,this.saveMediaControllerLinksIfAny(e.callAcceptanceAcknowledgement),this.scheduleKeepAlives(e.callAcceptanceAcknowledgement.callKeepAliveInterval),this.fsmState=Q.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(t),this.onCallStatusChanged(Q.default.CALL_STATUS.CONNECTED,t),this.linkUpdateRequested.keepAliveLinks&&(this.logger.info("["+t+"][internalHandleCallAcceptanceAck] updating CC links as requested"),this.updateLinks(this.updateKeepAliveUrl,t)))},e.prototype.isFatalException=function(e){var t=!0;try{JSON.parse(e.message).code===Q.default.CALL_END_CODE.CONFLICT&&(t=!1,this.logger.info("isFatalException: received non-fatal 409 error"))}catch(e){this.logger.error("isFatalException: failed to parse error")}return t},e.prototype.startOrJoinCall=function(e,t,n,i,r){var o=this;if(this.logger.info("["+n+"]startOrJoinCall["+t+"]"),this.disposed)this.logger.info("["+n+"]["+t+"] session already disposed, ignore");else{this.setMultiParty(1!==this.participantManager.getParticipantsToInitiateCallWith().length,n),this.telemetryHelper.setConversationServiceUrl(e.conversationServiceUrl),e.enableLightWeightMeeting||this.telemetryHelper.setOfferedModalities(i.blob),e.isPreheatOnly?(this.isPreheatOnly=!0,this.telemetryHelper.recordEvent(J.EVENTS.PREHEAT_ENABLING,{causeId:n}),this.telemetryHelper.setSelfParticipantRole(J.default.ROLE.PREHEAT),this.telemetryHelper.setIsPreheated()):this.telemetryHelper.startCallCancelationDurationWatch(),this.mediaTypesToUse=r,this.lastUsedOutgoingMediaContent=i,this.telemetryHelper.setCallerType(this.participantManager.localParticipant.id),this.logger.info("["+n+"]["+t+"]target endpointType = "+(this.transferContext&&this.transferContext.target?this.transferContext.target.endpointType:"default"));var s=e.newCall?A.getPayload(this,i,r,e):O.getPayload(this,i,r,e);this.logger.info("options.conversationServiceUrl "+e.conversationServiceUrl),this.http.sendPostRequest({url:e.conversationServiceUrl,requestName:t,operationType:"CallSetup",payload:s,causeId:n}).then(function(t){o.disposed||(e.endpointState&&(o.latestEndpointState=e.endpointState),o.processConversationServiceResponseHeaders(t,n),o.processConversationServiceResponse(t.response,n),o.onCallStatusChanged(Q.default.CALL_STATUS.CONNECTING,n),o.handleRosterFromCreateAndJoin(t,n))}).catch(function(e){if(!e.stack||o.isFatalException(e)){var i=Z.getErrorForXHRFailure(e);o.logger.info("[startOrJoinCall]["+n+"]["+t+"] error: "+a.getPrintableObject(e)+" xhrError: "+a.getPrintableObject(i)),o.disposed||(o.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,o.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultValue:J.default.RESULT_VALUE.FAILURE,endCode:i.telemetryEndSubCode,endSubCode:i.error.subCode,resultCategories:i&&i.error&&i.error.resultCategories,resultDetail:o.getTerminatingCallResultDetail(t,i.error),causeId:n}),o.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,n,i.error),o.dispose(i.error,n))}})}},e.prototype.processIncomingCallPayload=function(e,t){this.remoteUser=g.default.fromWireParticipant(e.callNotification.from),this.participantManager.setLocalParticipantId(e.callNotification.to.participantId,t),e?(e.conversationInvitation&&(this.links[Q.default.LINKS.CONVERSATION_CONTROLLER]=e.conversationInvitation.conversationController,this.setMultiParty(e.conversationInvitation.isMultiParty,t),this.isHostLessCall=!!e.conversationInvitation.isHostless),e.callNotification&&(this.links[Q.default.LINKS.ATTACH]=e.callNotification.links&&e.callNotification.links.attach,this.onBehalfOf=e.callNotification.onBehalfOf&&e.callNotification.onBehalfOf.id,this.callType=e.callNotification.callType,this.incomingCallCallerId=e.callNotification.from&&e.callNotification.from.id,this.callUsesMixer=!(!e.callNotification.mediaContent||!e.callNotification.mediaContent.fromMixer)),e.debugContent&&this.updateCorrelationId(e.debugContent.callId,t),e.callNotification.transferor&&(this.transferor=e.callNotification.transferor.details?e.callNotification.transferor.details.id:null),e.groupChat&&this.updateGroupChatIds(e.groupChat,t),e.meetingData&&(this.meetingData=e.meetingData),e.meetingInfo&&(this.meetingInfo=e.meetingInfo)):this.logger.info("["+t+"][processIncomingCallPayload] empty incoming payload content")},e.prototype.processAttachResponse=function(e,t,n){this.telemetryHelper.recordEvent(J.EVENTS.PROCESS_INITIAL_OFFER,{causeId:n}),this.links[Q.default.LINKS.MEDIA_ANSWER]=t.response.callInvitation.links.mediaAnswer,this.links[Q.default.LINKS.ACCEPT]=t.response.callInvitation.links.acceptance,this.links[Q.default.LINKS.REJECT]=t.response.callInvitation.links.callLeg,this.links[Q.default.LINKS.REDIRECT]=t.response.callInvitation.links.redirection,this.links[Q.default.LINKS.NEW_OFFER]=t.response.callInvitation.links.newOffer,this.signalingAgentConfig.sendProgressFromCC||this.sendProgress(t),this.remoteCaller=t.response.participants.from;var i=this.getInitialMediaOfferFromIncomingCallPayload()||t.response.callInvitation.mediaContent;this.telemetryHelper.setCallerType(this.getParticipantIdForOfferAnswer(i));var r=Z.getMediaTypes(t.response.callInvitation.callModalities);this.telemetryHelper.addIncomingModalities(r),this.telemetryHelper.setOfferedModalities(i.blob,!0),this.callUsesMixer=i.fromMixer,this.signalingSessionCallback.onOffer({subject:e.conversationInvitation.subject,remoteParticipantId:this.getParticipantIdForOfferAnswer(i),remoteEndpointId:t.response.participants.from.endpointId,transferor:t.response.callInvitation.transferor,mediaTypes:r,mediaContent:i,renegotiation:!1,invitationData:t.response.callInvitation.invitationData,riskLevel:t.response.callInvitation.spamProperties&&t.response.callInvitation.spamProperties.riskLevel},n)},e.prototype.sendProgress=function(e,t){var n=this;void 0===t&&(t=Z.causeId()),this.logger.info("["+t+"][sendProgress]"),this.telemetryHelper.recordEvent(J.EVENTS.SEND_PROGRESS,{causeId:t}),this.http.sendPostRequest({url:e.response.callInvitation.links.progress,requestName:J.NETWORK_REQUESTS.SEND_CALL_PROGRESS,payload:C.getPayload(this),causeId:t}).catch(function(e){var r=Z.getErrorForXHRFailure(e);n.logger.info("["+t+"][sendProgress] error: "+a.getPrintableObject(r)),n.disposed||n.telemetryHelper.recordEvent(J.EVENTS.SEND_PROGRESS_FAILED,i({causeId:t},r.error))})},e.prototype.handleCallNotification=function(e){var t=Z.extractCauseIdFromMessage(e);if(this.logger.info("["+t+"][handleCallNotification]"),this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_CALL_NOTIFICATION,e),!Z.stringEndsWith(e.url,Q.URL_PATH.REPLACE))throw new Error("["+t+"][handleCallNotification]IncomingCallNotification should not be received in handleIncomingMsg");this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_INCOMING_CALL_REPLACEMENT,e),this.logger.info("["+t+"][handleCallNotification]replacementCallNotification"),this.signalingSessionCallback&&this.signalingSessionCallback.onIncomingCallReplacement(e.body,t)},e.prototype.handleMediaAnswer=function(e){this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_MEDIA_ANSWER,e);var t=e.body,n=Z.extractCauseIdFromMessage(e);if(this.logger.info("["+n+"][handleMediaAnswer]"),this.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())this.mediaRenegotiationManager.handleMediaAnswer(t,n);else if(this.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED);else if(this.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING){if(Z.isDuplicateMessage(e.headers,this.provisionalMediaAnswersSeenSoFar))return void this.logger.info("["+n+"][handleMediaAnswer] ignoring provisional answer retried by service");t.mediaAnswer.sender&&(this.remoteUser=t.mediaAnswer.sender),this.resetCallEstablishmentTimeout(n),t.mediaAnswer.noRingBack||(this.telemetryHelper.setTimeToRingDuration(),this.onCallStatusChanged(Q.default.CALL_STATUS.RINGING,n));var i=t.mediaAnswer.mediaContent;this.signalingSessionCallback.onAnswer({provisional:!0,renegotiation:!1,remoteEndpointId:t.mediaAnswer.sender?t.mediaAnswer.sender.endpointId:Z.newGuid(),remoteParticipantId:this.getParticipantIdForOfferAnswer(i),mediaContent:i},n)}},e.prototype.handleCallAcceptance=function(e){var t=this;this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_CALL_ACCEPTANCE,e);var n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handleCallAcceptance]"),this._processCallAcceptance(e,n),this.http.sendPostRequest({url:e.body.callAcceptance.links.acknowledgement,requestName:J.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT,payload:E.getPayload(this),causeId:n}).catch(function(e){var r=Z.getErrorForXHRFailure(e);t.logger.info("["+n+"][handleCallAcceptance] error: "+a.getPrintableObject(r)),t.disposed||t.telemetryHelper.recordEvent(J.EVENTS.HANDLE_CALL_ACCEPTANCE_FAILED,i({causeId:n},r.error))})},e.prototype.handleCallAcceptanceSync=function(e){this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_CALL_ACCEPTANCE_SYNC,e);var t=Z.extractCauseIdFromMessage(e);return this.logger.info("["+t+"][handleCallAcceptanceSync]"),this._processCallAcceptance(e,t),E.getPayload(this).payload},e.prototype.getFakeRoster=function(e){var t,n,i,r=this.participantManager.getParticipantsToInitiateCallWith(),o={id:i=1===r.length?r[0].id:e.callAcceptance.acceptedBy.id,displayName:e.callAcceptance.acceptedBy.id===i?e.callAcceptance.acceptedBy.displayName:"",endpointId:e.callAcceptance.acceptedBy.endpointId,participantId:e.callAcceptance.acceptedBy.participantId,languageId:e.callAcceptance.acceptedBy.languageId},a=e.callAcceptance.acceptedBy.endpointId;return{type:"MultiPartyEndpoint",participants:(t={},t[i]={acceptedBy:e.callAcceptance.acceptedBy.id,details:o,endpoints:(n={},n[a]={call:{},contentSharing:{},capabilities:e.callAcceptance.capabilities},n)},t)}},e.prototype.processCallAcceptance=function(e,t){this.logger.info("["+t+"][processCallAcceptance] "+a.getPrintableObject(e)),this.telemetryHelper.recordEvent(J.EVENTS.PROCESS_CALL_ACCEPTANCE,{causeId:t}),this.fsmState=Q.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(t);var n=!1;e.callAcceptance.controllerName===Q.default.MISC.LOBBY_CALL_CONTROLLER&&(this.logger.info("["+t+"][processCallAcceptance] Controller name is lobby so putting user in lobby"),this.participantManager.localParticipant.isLobby=!0,this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId}),n=!0,this.telemetryHelper.recordEvent(J.EVENTS.ACCEPTANCE_USER_IN_LOBBY,{causeId:t}));var i=this.mediaTypesToUse,r=Z.newGuid();e.callAcceptance.acceptedBy&&(this.remoteUser=g.default.fromWireParticipant(e.callAcceptance.acceptedBy),r=e.callAcceptance.acceptedBy.endpointId),e.callAcceptance.acceptedCallModalities&&e.callAcceptance.acceptedCallModalities.length>0&&(i=e.callAcceptance.acceptedCallModalities);var o=e.callAcceptance.mediaContent;this.callUsesMixer=o.fromMixer;var s=Z.getMediaTypes(i);this.telemetryHelper.addIncomingModalities(s),this.telemetryHelper.setAnsweredModalities(o.blob,!0),this.links[Q.default.LINKS.MEDIA_RENEGOTIATION]=e.callAcceptance.links.mediaRenegotiation,this.links[Q.default.LINKS.TRANSFER]=e.callAcceptance.links.transfer,this.links[Q.default.LINKS.REPLACE]=e.callAcceptance.links.replacement,this.links[Q.default.LINKS.HANGUP]=e.callAcceptance.links.callLeg,this.links[Q.default.LINKS.KEEPALIVE]=e.callAcceptance.links.callLeg,this.links[Q.default.LINKS.PARK]=e.callAcceptance.links.hold,this.saveMediaControllerLinksIfAny(e.callAcceptance),this.scheduleKeepAlives(e.callAcceptance.callKeepAliveInterval);var c=this.getParticipantIdForOfferAnswer(o);this.signalingSessionCallback.onAnswer({provisional:!1,renegotiation:!1,remoteEndpointId:r,remoteParticipantId:c,callAcceptedByNGCVoicemail:c===Q.default.KNOWN_BOTS.VOICEMAIL_BOT_ID,mediaTypes:s,mediaContent:o},t),this.onCallStatusChanged(Q.default.CALL_STATUS.CONNECTED,t),n&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant,t),this.linkUpdateRequested.keepAliveLinks&&(this.logger.info("["+t+"][processCallAcceptance] Updating CC links as requested"),this.updateLinks(this.updateKeepAliveUrl,t))},e.prototype.handleLwjAcceptance=function(e){var t=Z.extractCauseIdFromMessage(e);if(this.logger.info("["+t+"][handleLwjAcceptance]"),this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_LWJ_ACCEPTANCE,e),this.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING){this.telemetryHelper.recordEvent(J.EVENTS.PROCESS_LWJ_ACCEPTANCE,{causeId:t}),this.fsmState=Q.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch();var n=!1;e.body.participantState===Q.default.MISC.LOBBY_PARTICIPANT_STATE&&(this.logger.info("LWJ acceptance indicates user is in lobby"),this.participantManager.localParticipant.isLobby=!0,this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId}),n=!0,this.telemetryHelper.recordEvent(J.EVENTS.ACCEPTANCE_USER_IN_LOBBY)),this.links[Q.default.LINKS.LMC_NOTIFICATION_LINKS]=e.body.links.notificationLinks,this.links[Q.default.LINKS.KEEPALIVE]=e.body.links.keepalive,this.scheduleKeepAlives(e.body.lwj.refreshInterval),this.signalingSessionCallback.onLwjUpdated(e.body.lwj,t),this.onCallStatusChanged(Q.default.CALL_STATUS.CONNECTED,t),this.telemetryHelper.setTimeToRingDuration(),n&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant,t)}},e.prototype.updateGroupChatIds=function(e,t){var n=this.threadId,i=this.teamsMessageId;this.threadId=e.threadId,this.teamsMessageId=e.messageId||null,this.threadId===n&&this.teamsMessageId===i||this.signalingSessionCallback.onConversationUpdated({conversationType:this.conversationType,threadId:this.threadId,teamsMessageId:this.teamsMessageId,isMultiParty:this.multiParty,commandUrlPresence:this.getCommandUrlPresence(),meetingData:this.meetingData,region:this.region,meetingInfo:this.meetingInfo},t)},e.prototype.handleCallEnd=function(e){var t=e.body.callEnd||e.body,n=Z.extractCauseIdFromMessage(e);if(this.logger.info("["+n+"][handleCallEnd][content="+a.getPrintableObject(t)+"]"),this.telemetryHelper.recordEvent(J.EVENTS.HANDLE_CALL_END,{origin:e.origin,code:t?t.code:"unknown",subCode:t?t.subCode:"unknown",resultCategories:t?t.resultCategories:[],causeId:n}),this.fsmState!==Q.default.SIGNALING_FSM_STATE.IDLE)if(t.code===Q.default.CALL_END_CODE.CONFLICT&&this.multiParty&&t.conversationUrl&&t.conversationUrl.Location)this.handleConversationResolutionConflict(t,n);else{this.disposing=!0,t.callControllerTransactionEnd&&(this.logger.info("handleCallEnd: using CC end details specified in CS end"),t=t.callControllerTransactionEnd),t.broadcastOperationFailure&&(this.logger.info("handleCallEnd: using broadcastOperationFailure end details specified in CS end"),t=t.broadcastOperationFailure);var i=t.code===Q.default.CALL_END_CODE.SUCCESS||t.code===Q.default.CALL_END_CODE.CANCEL||t.code===Q.default.CALL_END_CODE.REJECT;this.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.REMOTE,resultDetail:t.phrase,resultValue:i?J.default.RESULT_VALUE.SUCCESS:J.default.RESULT_VALUE.FAILURE,endCode:t.code,endSubCode:t.subCode,resultCategories:t?t.resultCategories:[],causeId:n});var r={code:t.code,subCode:t.subCode,phrase:t.phrase,resultCategories:t.resultCategories};this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,t.acceptedElsewhereBy&&(this.acceptedElsewhereBy={id:t.acceptedElsewhereBy.id,displayName:t.acceptedElsewhereBy.displayName}),this.onCallStatusChanged(Q.default.CALL_STATUS.REMOTE_TERMINATED,n,r),this.dispose(r,n)}else this.logger.info("["+n+"][handleCallEnd] not handling incoming callEnd since fsmstate = SIGNALING_FSM_STATE.IDLE")},e.prototype.handleConversationResolutionConflict=function(e,t){this.logger.info("["+t+"][handleConversationResolutionConflict]");var n=i({},e,{phrase:e.phrase||"Conflict Resolution Error"});if(this.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY||this.fsmState===Q.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY)this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,this.http.cancelRequestIfPending(J.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,t,void 0,n),this.subscribeToCall(e.conversationUrl.Location,e.correlationId,this.lastUsedJoinCallOptions?this.lastUsedJoinCallOptions.clientEndpointCapabilities:0,{meetingData:this.meetingData,meetingPreferences:this.meetingPreferences},t);else{this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT);var r={meetingData:this.meetingData,meetingPreferences:this.meetingPreferences};if(this.joinedLightWeight&&(r.isLwj=!0),this.lastUsedJoinCallOptions){var a=this.lastUsedJoinCallOptions.scenario;r.muted=this.lastUsedJoinCallOptions.muted,r.scenario="409Redirect"+(a||""),r.isPreheatOnly=this.lastUsedJoinCallOptions.isPreheatOnly,r.clientEndpointCapabilities=this.lastUsedJoinCallOptions.clientEndpointCapabilities,r.clientEndpointDebugContent=this.lastUsedJoinCallOptions.clientEndpointDebugContent}else r.scenario="409RedirectJoin";this.setInitialTelemetry(o.CALL_OPERATIONS.JOIN_CALL,{correlationId:e.correlationId,causeId:t,conversationServiceUrl:e.conversationUrl.Location,joinCallOptions:r,offerGenerationTime:void 0}),this.http.cancelRequestIfPending(J.NETWORK_REQUESTS.JOIN_CONVERSATION,t,void 0,n),this.http.cancelRequestIfPending(J.NETWORK_REQUESTS.START_CALL,t,void 0,n),this.joinGivenConversation(e.conversationUrl.Location,e.correlationId,this.lastUsedOutgoingMediaContent,this.mediaTypesToUse,void 0,r,t)}},e.prototype.handleCallProgress=function(e){this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_CALL_PROGRESS,e);var t=Z.extractCauseIdFromMessage(e);this.logger.info("["+t+"][handleCallProgress]");var n=e.body.callProgress;this.fsmState===Q.default.SIGNALING_FSM_STATE.OUTGOING&&(this.telemetryHelper.setTimeToRingDuration(),this.resetCallEstablishmentTimeout(t),this.onCallStatusChanged(Q.default.CALL_STATUS.RINGING,t),"forwarded"===n.status&&this.signalingSessionCallback.onCallForwarded({destinationType:n.forwardingDestinationType||"user"},t))},e.prototype.resetCallEstablishmentTimeout=function(e){var t=this;this.logger.info("resetCallEstablishmentTimeout"),this.timeoutManager.stopTimer(Q.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.timeoutManager.startTimer(Q.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,function(){return t.handleCallEstablishmentTimeout(e)},Q.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT)},e.prototype.handleMediaAcknowledgement=function(e){this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_MEDIA_ACK,e);var t=e.body,n=Z.extractCauseIdFromMessage(e);this.currentCallStatus!==Q.default.CALL_STATUS.CONNECTED?this.telemetryHelper.recordEvent(J.EVENTS.HANDLE_MEDIA_PROVISIONAL_ACK,{causeId:n}):this.mediaRenegotiationManager.handleMediaAcknowledgment(t,n)},e.prototype.handleConversationUpdate=function(e){var t=e.body,n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handleConversationUpdate]content="+a.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_CONVERSATION_UPDATE,e),this.processConversationServiceResponse(t,n),this.broadcastSession.handleBroadcastDetailsChanged(t,n)},e.prototype.handleAddModalityFailure=function(e){var t=e.body,n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handleAddModalityFailure]"),this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_ADD_MODALITY_FAILURE,e),t.modalityFailure.contentSharing?this.contentSharingManager.handleAddModalityFailure(t,n):t.modalityFailure.groupChat&&this.signalingSessionCallback.onChatModalitySetupFailed({code:t.modalityFailure.groupChat.code,subCode:t.modalityFailure.groupChat.subCode,phrase:t.modalityFailure.groupChat.phrase,resultCategories:t.modalityFailure.groupChat.resultCategories},n)},e.prototype.handleAddModalitySuccess=function(e){var t=e.body,n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handleAddModalitySuccess]"),this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,e),t.modalitySuccess.contentSharing?this.contentSharingManager.handleAddModalitySuccess(t,n):t.modalitySuccess.groupChat&&this.logger.info("["+n+"][handleAddModalitySuccess] group modality "+a.getPrintableObject(t.modalitySuccess.groupChat))},e.prototype.handleTransferRequested=function(e){var t=e.body.callTransfer,n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handleTransferRequested]"),t.parkType?(this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_PARK_REQUESTED,e,{type:t.parkType}),this.telemetryHelper.addSharedCorrelationId(t.sharedCorrelationId)):"voicemail"===t.target.endpointType?(this.logger.info("["+n+"][handleTransferRequested] target endpointType = "+t.target.endpointType),this.telemetryHelper.recordIncomingEvent(J.EVENTS.TRANSFER_REQUEST_RECEIVED,e)):this.telemetryHelper.recordIncomingEvent(J.EVENTS.TRANSFER_REQUEST_RECEIVED,e),this.links[Q.default.LINKS.TRANSFER_ACCEPTANCE]=t.links.transferAcceptance,this.links[Q.default.LINKS.TRANSFER_COMPLETION]=t.links.transferCompletion,this.signalingSessionCallback.onTransferRequested?this.signalingSessionCallback.onTransferRequested(t,n):this.logger.info("["+n+"][handleTransferRequested] failed, no callback defined")},e.prototype.handleTransferAcceptance=function(e){var t=Z.extractCauseIdFromMessage(e);this.logger.info("["+t+"][handleTransferAcceptance]"),this.telemetryHelper.recordIncomingEvent(J.EVENTS.WAITING_FOR_TRANSFER_COMPLETION,e),this.signalingSessionCallback.onTransferAccepted?this.signalingSessionCallback.onTransferAccepted(t):this.logger.info("["+t+"][handleTransferAcceptance]failed, no callback defined")},e.prototype.handleTransferCompletion=function(e){var t=e.body,n=Z.extractCauseIdFromMessage(e);this.logger.info("["+n+"][handleTransferCompletion]"),t.sharedCorrelationId&&this.telemetryHelper.addSharedCorrelationId(t.sharedCorrelationId),t.unparkContent&&void 0!==t.unparkContent.pickupCode&&(t.unparkContent.pickupCode=t.unparkContent.pickupCode.toString(),this.telemetryHelper.recordIncomingEvent(J.EVENTS.PICKUP_CODE_SET,e)),this.signalingSessionCallback.onTransferCompleted?(e.body.transferCompletion&&(0===e.body.transferCompletion.code?this.telemetryHelper.recordIncomingEvent(J.EVENTS.TRANSFER_COMPLETED,e):(this.logger.info("["+n+"][handleTransferCompletion]-1-code: "+t.transferCompletion.code+", message: "+a.getPrintableObject(e)),this.telemetryHelper.recordIncomingEvent(J.EVENTS.TRANSFER_COMPLETION_FAILED,e,{code:t.transferCompletion.code,subcode:t.transferCompletion.subCode,resultCategories:t.transferCompletion.resultCategories}))),this.signalingSessionCallback.onTransferCompleted(t,n)):(e.body.transferCompletion&&(e.body.transferCompletion.code===Q.default.CALL_END_CODE.NETWORK_ERROR?this.telemetryHelper.recordIncomingEvent(J.EVENTS.WAITING_FOR_TRANSFER_COMPLETION_FAIL,e):this.telemetryHelper.recordIncomingEvent(J.EVENTS.TRANSFER_COMPLETION_FAILED,e,{code:t.transferCompletion.code,subcode:t.transferCompletion.subCode,resultCategories:t.transferCompletion.resultCategories})),this.logger.info("["+n+"][handleTransferCompletion]failed, no callback defined"))},e.prototype.handleRosterUpdate=function(e,t){var n=e.body,i=Z.extractCauseIdFromMessage(e);this.disposing||this.disposed?this.logger.info("["+i+"][handleRosterUpdate]failed=ignore call ending or ended"):this.internalHandleRosterUpdate(n,t,i)},e.prototype.handleNewMediaOffer=function(e){var t=Z.extractCauseIdFromMessage(e);this.telemetryHelper.recordIncomingEvent(J.EVENTS.HANDLE_NEW_OFFER,e);var n=e.body.mediaOfferReady.mediaContent;this.callUsesMixer=n.fromMixer,this.signalingSessionCallback.onNewOffer({mediaContent:n,renegotiation:!1},t)},e.prototype.internalHandleRosterUpdate=function(e,t,n){this.logger.info("["+n+"][internalHandleRosterUpdate]");try{this.participantManager.handleRosterUpdate(e,t,n),this.contentSharingManager.handleIncomingContentSharingFromRoster(e,t,n)}catch(e){var i={code:Q.default.CALL_END_CODE.BAD_SERVICE_RESPONSE,subCode:Q.default.CALL_END_SUB_CODE.ROSTER_HANDLING_INVALID_SERVICE_RESPONSE,phrase:e&&e.toString()};throw this.logger.info("["+n+"][internalHandleRosterUpdate] "+a.safeJsonStringify(i)),this.telemetryHelper.recordEvent(J.EVENTS.HANDLE_ROSTER_UPDATE_FAIL,i),i}},e.prototype.scheduleKeepAlives=function(e){var t=.9*e*1e3;this.logger.info("scheduleKeepAlives: every "+t+" milliseconds"),this.keepAliveInterval=t,this.keepAliveTimer=window.setInterval(this.sendKeepAlive.bind(this),this.keepAliveInterval)},e.prototype.sendKeepAlive=function(){this.logger.info("sendKeepAlive"),this.disposed?this.logger.info("sendKeepAlive ignored"):(this.logger.info("sendKeepAlive keepAlive count = "+this.keepAliveCount++),this.sendToKeepAliveUrl(null))},e.prototype.sendToKeepAliveUrl=function(e,t){var n=this;void 0===t&&(t=Z.causeId()),this.logger.info("["+t+"][sendToKeepAliveUrl] payload: "+a.getPrintableObject(e)),window.clearInterval(this.keepAliveTimer),this.disposed||(this.telemetryHelper.recordEvent(J.EVENTS.SEND_KEEP_ALIVE),this.http.sendPostRequest({url:this.links[Q.default.LINKS.KEEPALIVE],payload:e,requestName:J.NETWORK_REQUESTS.SEND_KEEP_ALIVE,withoutTrouter:!0,causeId:t}).then(function(){return n.restartKeepAliveInterval()}).catch(function(e){var i=Z.getErrorForXHRFailure(e);n.logger.info("["+t+"][sendToKeepAliveUrl] error: "+a.getPrintableObject(i)),n.restartKeepAliveInterval(!0,i.error)}))},e.prototype.handleCallEstablishmentTimeout=function(e,t,n){this.telemetryHelper.recordEvent(J.EVENTS.HANDLE_CALL_ESTABLISHMENT_TIMEOUT),this.telemetryHelper.setTerminatingData({terminatingEnd:J.default.CALL_TERMINATING_END.LOCAL,resultValue:J.default.RESULT_VALUE.FAILURE,resultDetail:t||Q.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,endCode:Q.default.CALL_END_CODE.TIMEOUT,endSubCode:t||Q.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,causeId:e,resultCategories:[Q.RESULT_CATEGORIES.UnexpectedClientError]});var i={code:Q.default.CALL_END_CODE.TIMEOUT,subCode:t||Q.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:n||Q.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT,resultCategories:[Q.RESULT_CATEGORIES.UnexpectedClientError]};this.fsmState=Q.default.SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(Q.default.CALL_STATUS.LOCAL_TERMINATED,e,i),this.dispose(i,e)},e.prototype.handleCallTransferTimeout=function(e,t){if(this.disposed)this.logger.info("Transfer: handleCallTransferTimeout ignored");else{var n={code:Q.default.CALL_END_CODE.TIMEOUT,phrase:Q.default.CALL_END_PHRASE.TRANSFER_COMPLETION_TIMEOUT};this.signalingSessionCallback.onTransferCompleted&&(!1===t?this.telemetryHelper.recordEvent(J.EVENTS.TRANSFER_COMPLETION_FAILED,{code:Q.default.CALL_END_CODE.TIMEOUT,subcode:Q.default.CALL_END_SUB_CODE.TRANSFER_COMPLETE_TIMEOUT,causeId:e}):!0===t&&this.telemetryHelper.recordEvent(J.EVENTS.WAITING_FOR_TRANSFER_ACCEPTANCE_FAIL,{causeId:e}),this.signalingSessionCallback.onTransferCompleted({transferCompletion:n},e))}},e.prototype.checkCorrelationIdChange=function(e,t){if(e&&e.headers&&e.headers[Q.default.HEADERS.CORRELATION_ID]&&e.headers[Q.default.HEADERS.CORRELATION_ID].length){var n=[Q.URL_PATH.CONV_CONTENT_SHARING_UPDATE,Q.URL_PATH.CONV_CONTENT_SHARING_END].some(function(t){return e.url&&Z.stringEndsWith(e.url,t)}),i=e.headers[Q.default.HEADERS.CORRELATION_ID];this.correlationId===i||n||(this.logger.info("["+t+"]checkCorrelationIdChange:"+this.correlationId+" => "+i),this.telemetryHelper.addChangingCorrelationId(this.correlationId,i),this.updateCorrelationId(i,t))}},e.prototype.getCommandUrlPresence=function(){var e=X.CommandUrlPresence.None;return this.links[Q.default.LINKS.MUTE]&&(e|=X.CommandUrlPresence.Mute),this.links[Q.default.LINKS.UNMUTE]&&(e|=X.CommandUrlPresence.Unmute),e},e.prototype.getCallNotFoundTransactionEnd=function(){return{code:Q.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,subCode:0,phrase:Q.default.CALL_END_PHRASE.CALL_DOES_NOT_EXIST}},e.prototype.getTerminatingCallResultDetail=function(e,t){var n=i({source:e},t);return a.getPrintableObject(n)},e.prototype.dispose=function(e,t){var n=this;this.disposed||(this.logger.info("["+t+"][dispose] end reason "+a.getPrintableObject(e)),this.disposed=!0,this.disposing=!1,this.tearDownConnectionCheck(),this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.brokerService&&this.brokerService.dispose(),this.http.cancelAllRequests(t).then(function(){n.signalingAgent.onCallCompleted(n.sessionId,t),n.signalingAgentConfig.trouterUrlGetter&&n.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed.off(n.onTrouterUrlChanged),n.signalingAgentConfig.trouterServiceProvider&&n.signalingAgentConfig.trouterServiceProvider.offStateChanged(n.onTrouterStateChanged),n.timeoutManager.dispose(),n.timeoutManager=null,n.participantManager.dispose(e,t),n.callOperationHandler.dispose("call ended",e,t),n.participantManager=null,n.mediaRenegotiationManager.dispose(),n.mediaRenegotiationManager=null,n.contentSharingManager.dispose(e,t),n.contentSharingManager=null,n.telemetryHelper.dispose(),n.telemetryHelper=null,n.webRtcSignalingManager.dispose(),n.webRtcSignalingManager=null}))},e}();t.SignalingSession=te,t.build=function(e,t,n,i,r,o){return new te(e,t,n,i,r,o)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INITIALIZE="Initialize",e.START_CALL="StartCall",e.START_TRANSFER_TARGET_CALL="StartTransferTargetCall",e.STOP_CALL="StopCall",e.STOP_CALL_WITH_BEACON="StopCallWithBeacon",e.JOIN_CALL="JoinCall",e.JOIN_PREHEATED_CALL="JoinPreheatedCall",e.SUBSCRIBE="Subscribe",e.START_CALL_TO_VOICE_MAIL="StartCallToVoiceMail",e.ACKNOWLEDGE="Acknowledge",e.ACCEPT="Accept",e.REJECT="Reject",e.START_VIDEO="StartVideo",e.STOP_VIDEO="StopVideo",e.LOCAL_HOLD="LocalHold",e.LOCAL_UNHOLD="LocalUnhold",e.HOLD="Hold",e.UNHOLD="Unhold",e.UPDATE_ENDPOINT_METADATA="UpdateEndpointMetadata",e.SEND_DTMF_TONE="SendDtmfTone",e.SET_AUDIO_USAGE="SetAudioUsage",e.DUMP_VIDEO_SOURCE_IMAGES="DumpVideoSourceImages",e.BLIND_TRANSFER="BlindTransfer",e.SAFE_TRANSFER="SafeTransfer",e.TRANSFER_TO_VOICEMAIL="TransferToVoicemail",e.CONSULTATIVE_TRANSFER="ConsultativeTransfer",e.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE="ConsultativeTransferWithPickupCode",e.START_SCREEN_SHARING="StartScreenSharing",e.STOP_SCREEN_SHARING="StopScreenSharing",e.START_DATA_CHANNEL="StartDataChannel",e.STOP_DATA_CHANNEL="StopDataChannel",e.SHARE_SYSTEM_SOUNDS="ShareSystemSounds",e.START_MULTICHANNEL_AUDIO_DEVICE="StartMultichannelAudioDevice",e.STOP_MULTICHANNEL_AUDIO_DEVICE="StopMultichannelAudioDevice",e.MUTE="Mute",e.UNMUTE="Unmute",e.MUTE_SPEAKER="MuteSpeaker",e.UNMUTE_SPEAKER="UnmuteSpeaker",e.MUTE_PARTICIPANTS="MuteParticipants",e.UPDATE_MEETING_ROLE="UpdateMeetingRole",e.START_AUDIO="StartAudio",e.STOP_AUDIO="StopAudio",e.ASSIMILATE="Assimilate",e.SET_MAX_VIDEO_CHANNELS="SetMaxVideoChannels",e.CREATE_CONTENT_SHARING_SESSION="CreateContentSharingSession",e.START_CALL_WITH_NUDGE="StartCallWithNudge",e.START_CALL_AND_UNPARK="StartCallAndUnpark",e.PARK_CALL="ParkCall",e.UNPARK_CALL="UnparkCall",e.NUDGE_PARTICIPANTS="NudgeParticipants",e.LWJ_FALLBACK="LwjFallback",e.ELECTRON_SHOW_CQF_INFO="ElectronShowCQFInfo",e.ELECTRON_IS_CQF_RENDERED="ElectronIsCQFRendered",e.ELECTRON_PROVIDE_CQF="ElectronProvideCQF",e.MERGE_CALL="MergeCall",e.ADD_GROUP_MODALITY="AddGroupModality",e.MERGE_WITH_PICKUP_CODE="MergeWithPickupCode",e.PUBLISH_STATE="PublishState",e.REMOVE_STATE="RemoveState",e.UPDATE_MEETING_SETTINGS="UpdateMeetingSettings",e.MERGE_PARTICIPANT="MergeParticipant",e.MERGE_PARTICIPANTS="MergeParticipants",e.ADMIT="Admit",e.SEARCH_PARTICIPANTS="SearchParticipants",e.GET_ALL_PARTICIPANTS="GetAllParticipants",e.SET_AUDIO_MIDCALL_CONFIG="SetAudioMidcallConfig",e.START_WITH_MEETING_DATA="StartWithMeetingData",e.JOIN_WITH_MEETING_DATA="JoinWithMeetingData",e.SUBSCRIBE_WITH_MEETING_DATA="SubscribeWithMeetingData",e.SET_AUDIO_MIDCALL_CONFIG_JSON="SetAudioMidcallConfigJon",e.GET_CALL_STATE="GetCallState"}(t.CALL_OPERATIONS||(t.CALL_OPERATIONS={})),function(e){e.CALL_START_OR_JOIN_INITIATED="_CallStartOrJoinInitiated",e.INCOMING_INITIALIZE="_IncomingInitialize",e.CALL_ENDED="_CallEnded",e.RECONNECT="_Reconnect",e.RENEGOTIATE="_Renegotiate",e.RENEGOTIATE_OUTGOING="_RenegotiateOutgoing",e.RENEGOTIATE_INCOMING="_RenegotiateIncoming",e.COMPLETE_NEGOTIATION_FAILED="_CompleteNegotiationFailed",e.UPDATE_LOCAL_MEDIA_STATUS="_UpdateLocalMediaStatus",e.START_PREVIEW_VIDEO="_StartPreviewVideo",e.START_LOCAL_VIDEO="_StartLocalVideo",e.SET_LOCAL_VIDEO="_SetLocalVideo",e.CALL_TRANSFER_IN_PROGRESS="_CallTransferInProgress",e.ON_TRANSFER_REQUESTED="_OnTransferRequested",e.ON_TRANSFER_REQUESTED_INVALID="_OnTransferRequestedInvalid",e.ON_INCOMING_CALL_REPLACEMENT="_onIncomingCallReplacement",e.GET_CALL_REPLACEMENT_DETAILS="_GetCallReplacementDetails",e.SET_CALL_STATE="_SetCallState",e.SET_TRANSFER_STATE="_SetTransferState",e.SET_PARK_STATE="_SetParkState",e.SET_MUTED="_SetMuted",e.SET_MUTED_SPEAKER="_SetMutedSpeaker",e.SET_SCREEN_SHARING="_SetScreenSharing",e.SET_CALL_ORIGIN="_SetCallOrigin",e.CONNECT_CALL="_ConnectCall",e.WAIT_FOR_ANSWER="_WaitForAnswer",e.MEDIA_ACKNOWLEDGMENT="_MediaAcknowledgment",e.SIGNALING_STATE_CHANGED="_SignalingStateChanged",e.CALL_TERMINATION_INFO="_CallTerminationInfo",e.MEDIA_WHITELISTING_ISSUE_DETECTED="_MediaWhiteListingIssueDetected",e.CALL_ESCALATED_TO_CONFERENCE="_CallEscalatedToConference",e.WEB_ON_OFFER="_WebOnOffer",e.WEB_ON_ANSWER="_WebOnAnswer",e.WEB_ON_RETARGET_SUCCESS="_WebRetargetSuccess",e.WEB_ON_RETARGET_FAILURE="_WebRetargetFailure",e.WEB_ON_ESCALATION_SUCCESS="_WebOnEscalationSuccess",e.WEB_ON_ESCALATION_FAILURE="_WebOnEscalationFailure",e.CALL_USES_MIXER="_CallUsesMixer",e.ESCALATION_IN_PROGRESS="_EscalationInProgress",e.ESCALATION_COMPLETED="_EscalationCompleted",e.ELECTRON_WAIT_FOR_HANDLE_PUSH="_ElectronWaitForHandlePush",e.ELECTRON_WAIT_FOR_RINGING="_ElectronWaitForRinging",e.ELECTRON_START_SCREEN_SHARING="_ElectronStartScreenSharing",e.ELECTRON_STOP_SCREEN_SHARING="_ElectronStopScreenSharing",e.ELECTRON_SLIMCORE_READY="_ElectronSlimcoreReady",e.ELECTRON_DATA_CHANNEL_CREATED="_ElectronDataChannelCreated",e.ELECTRON_ATTACH_SLIMCORE_CALL="_ElectronAttachSlimcoreCall",e.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED="_ElectronAttachSlimcoreCallFailed",e.ELECTRON_LEAVE_CALL="_ElectronLeaveCall",e.PROCESS_CALL_START_OPTIONS="_ProcessCallStartOptions"}(t.CALL_OPERATIONS_INTERNAL||(t.CALL_OPERATIONS_INTERNAL={})),function(e){e.CCWM="CCWM",e.ENCRYPTED="Encrypted",e.LWJ="LWJ",e.PREHEAT="Preheat",e.MULTIPLEVIDEOS="MultipleVideos",e.SPECIFIED="Specified",e.ALL="All",e.NONE="None"}(t.OPERATION_VARIANTS||(t.OPERATION_VARIANTS={})),function(e){e.AUDIO_QUALITY_CHANGED="AudioQualityChanged",e.SESSION_ERROR="SessionError",e.NEGOTIATION_REQUIRED="NegotiationRequired",e.OUTGOING_NEGOTIATION_FAILURE="OutgoingNegotiationFailure",e.INCOMING_NEGOTIATION_FAILURE="IncomingNegotiationFailure",e.NEGOTIATION_FATAL_ERROR="NegotiationFatalError",e.NEGOTIATION_COMPLETION="NegotiationCompletion",e.AUDIO_STATE_CHANGED="AudioStateChanged",e.INCOMPATIBLE_OFFER="IncompatibleOffer",e.NEW_OFFER_FAILED="NewOfferFailed"}(t.MEDIA_EVENT||(t.MEDIA_EVENT={})),function(e){e.ADD_PARTICIPANT="AddParticipant",e.REMOVE_PARTICIPANT="RemoveParticipant",e.ADMIT_PARTICIPANT="AdmitParticipant",e.CALL_ME_BACK="CallMeBack",e.ADD_PARTICIPANTS="AddParticipants",e.SEARCH_PARTICIPANTS="SearchParticipants",e.GET_ALL_PARTICIPANTS="GetALLParticipants"}(t.PARTICIPANT_OPERATIONS||(t.PARTICIPANT_OPERATIONS={})),function(e){e.SET_PARTICIPANT_STATE_INVALID="_SetParticipantStateInvalid",e.UPDATE_LOCAL_PARTICIPANT_STREAM="_UpdateLocalParticipantStream",e.PARTICIPANT_JOINED="_ParticipantJoined",e.SELF_PARTICIPANT_UPDATED="_SelfParticipantUpdated"}(t.PARTICIPANT_OPERATIONS_INTERNAL||(t.PARTICIPANT_OPERATIONS_INTERNAL={})),function(e){e.START_CONTENT_SHARING="StartContentSharing",e.STOP_CONTENT_SHARING="StopContentSharing",e.JOIN_CONTENT_SHARING="JoinContentSharing",e.TAKE_CONTENT_SHARING_CONTROL="TakeContentSharingControl",e.UPDATE_CONTENT_SHARING_SESSION_STATE="UpdateContentSharingSessionState",e.UPDATE_PARTICIPANT_STATE="UpdateParticipantState"}(t.CONTENT_SHARING_OPERATIONS||(t.CONTENT_SHARING_OPERATIONS={})),function(e){e.SET_CONTENT_SHARING_STATUS="_SetContentSharingStatus"}(t.CONTENT_SHARING_OPERATIONS_INTERNAL||(t.CONTENT_SHARING_OPERATIONS_INTERNAL={})),t.UNPARK_CODE={PARK:"*11",SHARED_LINE:"*12",SERVER_HOLD:"*13"},function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.CLIENT_ERROR=499]="CLIENT_ERROR",e[e.SIGNALING_ERROR=599]="SIGNALING_ERROR"}(t.TRANSACTION_END_CODE||(t.TRANSACTION_END_CODE={})),function(e){e[e.LOCAL_REJECT=0]="LOCAL_REJECT",e[e.TRANSACTION_NOT_ALLOWED=3548]="TRANSACTION_NOT_ALLOWED",e[e.INVALID_ARGUMENT=3549]="INVALID_ARGUMENT",e[e.CANNOT_PARSE_RESULT=3550]="CANNOT_PARSE_RESULT"}(t.TRANSACTION_END_SUBCODE||(t.TRANSACTION_END_SUBCODE={})),function(e){e.TRANSACTION_COMPLETE="TransactionComplete",e.TRANSACTION_ALLOWED="TransactionAllowed",e.TRANSACTION_DISALLOWED="TransactionDisallowed",e.UNKNOWN="Unknown",e.STACK_NOT_INTIALIZED="Stack not intialized yet"}(t.TRANSACTION_END_PHRASE||(t.TRANSACTION_END_PHRASE={})),t.EMPTY_COUNTS={totalParticipants:0,preheatedParticipants:0,lobbyParticipants:0,totalPresenters:0,requestingAttentionPresenters:0,totalAttendees:0,requestingAttentionAttendees:0,overflowAttendees:0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=this;this.timers={},this.startTimer=function(e,n,i,r){t.logger.info("startTimer called for :  "+e);var o=window.setTimeout(n,1e3*i),a=r?""+e+r:e;t.timers[a]=o},this.stopTimer=function(e,n){t.logger.info("stopTimer called for : "+e);var i=n?""+e+n:e;t.timers.hasOwnProperty(i)&&(clearTimeout(t.timers[i]),delete t.timers[i])},this.dispose=function(){t.logger.info("timeoutManager :: dispose"),Object.keys(t.timers).forEach(function(e){t.stopTimer(e)})},this.logger=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(1),o=n(2),a=n(0),s=function(){function e(e,t){var n=this;this.broadcastContext=null,this.broadcastControllerUrl="",this.broadcastCallbackUrl="",this.broadcastState=null,this.setContext=function(e){void 0===e&&(e=null),n.logger.info("BroadcastSession :: set broadcast context",e),n.broadcastContext=e},this.getContext=function(){return n.logger.info("BroadcastSession :: get broadcast context",n.broadcastContext||null),n.broadcastContext||null},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"[Broadcast]"})}return e.prototype.handleBroadcastStateChanged=function(e){var t=e.body;this.broadcastState=t;var n=a.extractCauseIdFromMessage(e);this.signalingSession.telemetryHelper.recordIncomingEvent(i.EVENTS.BROADCAST_STATE_CHANGED,e),this.logger.info("["+n+"] broadcast state changed="+this.broadcastState),this.updateBroadcastMetadata(n)},e.prototype.updateBroadcastCallbackUrl=function(e){var t=o.get(this.signalingSession,r.URL_PATH.CONV_BROADCAST_UPDATE);this.broadcastCallbackUrl!==t&&(this.broadcastCallbackUrl=t,this.logger.info("["+e+"] broadcast callback url changed="+this.broadcastCallbackUrl),this.updateBroadcastMetadata(e))},e.prototype.handleBroadcastDetailsChanged=function(e,t){e.activeModalities&&e.activeModalities.broadcast&&e.activeModalities.broadcast.controller!==this.broadcastControllerUrl&&(this.broadcastControllerUrl=e.activeModalities.broadcast.controller,this.logger.info("["+t+"] broadcast controller changed="+this.broadcastControllerUrl),this.updateBroadcastMetadata(t)),!this.broadcastControllerUrl||e.activeModalities&&e.activeModalities.broadcast||(this.broadcastControllerUrl="",this.logger.info("["+t+"] broadcast controller changed="+this.broadcastControllerUrl),this.updateBroadcastMetadata(t))},e.prototype.updateBroadcastMetadata=function(e){var t={broadcastControllerUrl:this.broadcastControllerUrl,broadcastStateCallbackUrl:this.broadcastCallbackUrl,broadcastState:this.broadcastState};this.logger.info("["+e+"] update broadcast metadata="+t),this.signalingSessionCallback.onBroadcastDetailsUpdated&&this.signalingSessionCallback.onBroadcastDetailsUpdated(t,e)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(5),a=n(31),s=n(1),c=n(0);!function(e){e.RETRY="RETRY",e.TIMEOUT="TIMEOUT"}(i=t.TIMERS||(t.TIMERS={}));var l=function(){function e(e){var t=this;this._signalingSession=e,this.baseUrl="http://broker.invalid/",this._currentSubscriptionTimeoutInSec=30,this._subscribers=[],this._disposed=!1,this._reportedResultCount=0,this._subscriptionRetryBackoffInSec=5,this._notifySubscribers=function(e){t._logger.info("_notifySubscribers"),Promise.resolve().then(function(){e.split(",").forEach(function(e){var n=c.decodeMessage(e),i=c.parseRawHttpMessage(n),r=i.body;c.isEncodedMessage(i.headers)&&c.isMessageEncodingSupported(i.headers)&&(r=c.decodeMessage(r));var o={url:i.url,body:JSON.parse(r),headers:i.headers};t._logger.info("message length=",r.length,"n. of subscribers",t._subscribers.length),t._subscribers.forEach(function(e){return e(o)})})}).catch(function(e){t._logger.error("_notifySubscribers, failed to decode message",e),t._signalingSession.telemetryHelper.recordEvent(o.EVENTS.BROKER_DECODE_PAYLOAD_FAILURE)})},this._subscribeToBroker=function(e,n){if(t._disposed)t._logger.warn("_subscribeToBroker, disposed, ignore subscription");else{var i=c.causeId();t._logger.info("_subscribeToBroker, url: ",e,",timeout in sec",n),t._currentSubscriptionUrl=e,t._currentSubscriptionTimeoutInSec=n,t._clearAllPendingTimeouts(),t._setSubscriptionTimeout(n),t._signalingSession.http.sendGetRequest({url:t._currentSubscriptionUrl,requestName:o.NETWORK_REQUESTS.BROKER_SUBSCRIBE,customHeaders:t._getBrokerRequestHeaders(i),payload:null,skipHttpTelemetry:!t._reportSubscriptionInTelemetry(),causeId:c.causeId()}).then(t._handleSubscriptionSuccess).catch(t._handleSubscriptionFailure)}},this._clearAllPendingTimeouts=function(){t._cancelRequestTimer&&(t._cancelRequestTimer.stop(),t._cancelRequestTimer=null),t._retryRequestTimer&&(t._retryRequestTimer.stop(),t._retryRequestTimer=null)},this._abortPendingRequest=function(){t._signalingSession.http.cancelRequestIfPending(o.NETWORK_REQUESTS.BROKER_SUBSCRIBE,c.causeId())},this._setSubscriptionTimeout=function(e){t._cancelRequestTimer=a.TimerFactory.build(function(){t._disposed||(t._signalingSession.http.hasPendingRequest(o.NETWORK_REQUESTS.BROKER_SUBSCRIBE)?(t._logger.warn("timeout subscription"),t._signalingSession.telemetryHelper.recordEvent(o.EVENTS.BROKER_SUBSCRIPTION_TIMEOUT),t._signalingSession.http.cancelRequestIfPending(o.NETWORK_REQUESTS.BROKER_SUBSCRIBE,c.causeId())):t._logger.error("Unable to resolve timeout deferred, it is not defined!"))},i.TIMEOUT).start(1e3*e)},this._handleSubscriptionSuccess=function(e){if(t._disposed)t._logger.warn("_handleSubscriptionSuccess, disposed, ignore subscription success");else if(t._reportSubscriptionInTelemetry(e)&&t._signalingSession.telemetryHelper.recordEvent(o.EVENTS.BROKER_SUBSCRIPTION_SUCCESSFUL),e&&e.response){var n=e.response;t._logger.info("_handleSubscriptionSuccess, response",n),n.message&&t._notifySubscribers(n.message);var i=n.nextSubscribeUrl||t._currentSubscriptionUrl,r=n.expirationTimeInSec||t._currentSubscriptionTimeoutInSec;t._subscribeToBroker(i,r)}else t._logger.info("_handleSubscriptionSuccess, empty response")},this._handleSubscriptionFailure=function(e){if(t._disposed)t._logger.warn("_handleSubscriptionFailure, disposed, ignore subscription");else if(e.status>=400&&e.status<500&&401!==e.status)t._logger.warn("_handleSubscriptionFailure, received status "+e.status+", stop subscribing");else{var n=r.getPrintableObject(e);t._logger.error("_handleSubscriptionFailure failed",n),t._reportSubscriptionInTelemetry()&&t._signalingSession.telemetryHelper.recordEvent(o.EVENTS.BROKER_SUBSCRIPTION_FAILED),t._retryRequestTimer=a.TimerFactory.build(function(){t._subscribeToBroker(t._currentSubscriptionUrl,t._currentSubscriptionTimeoutInSec)},i.RETRY).start(1e3*t._subscriptionRetryBackoffInSec)}},this._reportSubscriptionInTelemetry=function(e){return t._reportedResultCount++,t._reportedResultCount<=1},this._getBrokerRequestHeaders=function(e){var n={};return n[s.default.HEADERS.CONTENT_TYPE]=s.default.CONTENT_TYPE.JSON,t._signalingSession.signalingAgentConfig.brokerRequestBatching&&(n[s.default.HEADERS.BROKER_USE_BATCHING_HEADER_NAME]="1"),n},this._logger=this._signalingSession.logger.createChild("Broker"),this._signalingSession.signalingAgentConfig.brokerRetryBackoffInSec&&(this._subscriptionRetryBackoffInSec=this._signalingSession.signalingAgentConfig.brokerRetryBackoffInSec)}return e.prototype.subscribeToBroker=function(e){this._abortPendingRequest(),this._clearAllPendingTimeouts(),this._subscribeToBroker(e,this._currentSubscriptionTimeoutInSec)},e.prototype.onBrokerMessage=function(e){this._logger.info("onBrokerMessage callback added"),this._subscribers.push(e)},e.prototype.dispose=function(){this._disposed=!0,this._logger.info("dispose"),this._subscribers=[],this._clearAllPendingTimeouts(),this._abortPendingRequest()},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function e(e){this.requests={},this.logger=e}return e.prototype.clear=function(e,t){var n=this,r=t||{code:i.default.CALL_END_CODE.SUCCESS,subCode:i.default.CALL_END_SUB_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.requests).forEach(function(t){try{var i=parseInt(t,10);Object.keys(n.requests[i]).forEach(function(t){n.rejectOperation(i,t,e,r)})}catch(e){n.logger.warn("CallOperations: clear error = "+e)}})},e.prototype.hasOperation=function(e,t){return this.requests.hasOwnProperty(e.valueOf())&&this.requests[e.valueOf()].hasOwnProperty(t)},e.prototype.getAllOperations=function(){return this.requests},e.prototype.getOperation=function(e,t){return this.hasOperation(e,t)?this.requests[e.valueOf()][t]:null},e.prototype.setOperation=function(e,t,n){return!this.hasOperation(e,t)&&(this.hasOwnProperty(e.valueOf())||(this.requests[e.valueOf()]={}),this.requests[e.valueOf()][t]=n,!0)},e.prototype.rejectOperation=function(e,t,n,i){if(this.hasOperation(e,t)){var r=e.valueOf(),o=this.requests[r][t].promise;delete this.requests[r][t],o.reject(i)}},e.prototype.resolveOperation=function(e,t,n,i){if(this.hasOperation(e,t)){var r=e.valueOf(),o=this.requests[r][t].promise;delete this.requests[r][t],o.resolve(n)}},e}(),o=function(){function e(e){this.logger=e,this.localRequests=new r(e)}return e.prototype.dispose=function(e,t,n){this.logger.info("["+n+"][dispose]"),this.rejectAllPendingOperations(e,t)},e.prototype.hasPendingOperation=function(e,t,n){return this.logger.info("["+n+"][hasPendingOperation] "+e+" "+t+"}"),this.localRequests.hasOperation(e,t)},e.prototype.rejectPendingOperation=function(e,t,n,i,r){this.logger.info("["+r+"][rejectPendingOperation] "+e+" "+t+" reason: "+n+" endCode: "+i),this.localRequests.rejectOperation(e,t,n,i)},e.prototype.resolvePendingOperation=function(e,t,n,i){this.logger.info("["+i+"][resolvePendingOperation]: "+t),this.localRequests.resolveOperation(e,t,n,i)},e.prototype.setPendingOperation=function(e,t,n,i){return this.logger.info("["+i+"][setPendingOperation] "+e+" value: "+n),this.localRequests.setOperation(e,t,n)},e.prototype.rejectAllPendingOperations=function(e,t){this.logger.info("rejectLocalQueuedOperations"),this.localRequests.clear(e,t)},e}();t.default=o},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(80),a=n(1),s=n(0),c=function(){function e(e,t){var n=this;this.contentSharingToStartCallWith=null,this.contentSharingSessions={},this.DEFAULT_STOP_REASON={code:a.default.CALL_END_CODE.SUCCESS,subCode:a.default.CALL_END_SUB_CODE.SUCCESS,phrase:a.default.CALL_END_PHRASE.REMOTE_USER_INITIATED},this.DEFAULT_STOP_ID="8:unknown",this.deleteContentSharingAsync=function(e,t){n.logger.info("["+t+"][deleteContentSharingAsync]");var i=s.defer(),r=n.contentSharingSessions[e];if(n.pendingSessionToStart&&n.pendingSessionToStart.correlationId===e&&(r=n.pendingSessionToStart),r){var o=function(){n.contentSharingSessions[e]&&delete n.contentSharingSessions[e]};r.delete(i,t).then(o,o)}else n.rejectBecauseOfMissingSession(e,i);return i.promise},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"[ContentSharingManager]"}),this.lastProcessedSequenceNumber=-1,this.lastProcessedSequenceNumberForParticipant={}}return e.prototype.startContentSharingAsync=function(e,t,n,i,r,c,l){var u=this;if(this.logger.info("startContentSharingAsync called for: "+e),this.pendingSessionToStart){var d="There is already a ContentSharing session start pending";return this.logger.error(d),Promise.reject(new Error(d))}var p={contentIdentifier:e,subject:n||null,sessionState:t||null,sequenceNumber:1},f=s.defer(),h=new o.ContentSharingSession(this.signalingSession,l||s.newGuid());return this.pendingSessionToStart=h,r?(this.logger.info("Call connected, send content sharing request out immediately"),h.start(i,p,f,c)):(this.logger.info("Content sharing is to be started when startOutgoingCall is called"),h.addSessionPromise=f,h.fsmState=a.default.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED,this.contentSharingToStartCallWith=p),f.promise.then(function(){u.contentSharingSessions.hasOwnProperty(h.correlationId)||(u.contentSharingSessions[h.correlationId]=h),u.pendingSessionToStart=null}).catch(function(){u.pendingSessionToStart=null}),f.promise},e.prototype.joinContentSharingAsync=function(e,t){this.logger.info("["+t+"][joinContentSharingAsync]");var n=s.defer(),i=this.contentSharingSessions[e];return i?i.join(n,t):this.rejectBecauseOfMissingSession(e,n),n.promise},e.prototype.updateContentSharingSessionStateAsync=function(e,t,n){this.logger.info("["+n+"][updateContentSharingSessionStateAsync][sessionState="+JSON.stringify(t)+"]");var i=s.defer(),r=this.contentSharingSessions[e];return r?r.updateSessionState(t,i,n):this.rejectBecauseOfMissingSession(e,i),i.promise},e.prototype.takeContentSharingControlAsync=function(e,t){this.logger.info("["+t+"][takeContentSharingControlAsync]");var n=s.defer(),i=this.contentSharingSessions[e];return i?i.takeControl(n,t):this.rejectBecauseOfMissingSession(e,n),n.promise},e.prototype.updateContentSharingParticipantStateAsync=function(e,t){this.logger.info("["+t+"][updateContentSharingParticipantStateAsync]");var n=s.defer(),i=this.contentSharingSessions[e];return i?i.updateParticipantState(n,t):this.rejectBecauseOfMissingSession(e,n),n.promise},e.prototype.updateContentSharingNotificationLinksAsync=function(e){this.logger.info("["+e+"][updateContentSharingNotificationLinksAsync]");for(var t=0,n=Object.keys(this.contentSharingSessions);t<n.length;t++){var i=n[t];if(this.contentSharingSessions.hasOwnProperty(i)){var r=this.contentSharingSessions[i];r&&r.updateNotificationLinks(e)}}},e.prototype.getContentSharingInfoToStartSharing=function(){if(this.contentSharingToStartCallWith){var e=this.pendingSessionToStart,t=a.default.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED;e&&e.fsmState===t||(this.contentSharingToStartCallWith=null,this.pendingSessionToStart=null)}return this.contentSharingToStartCallWith},e.prototype.dispose=function(e,t){this.logger.info("["+t+"][dispose]");for(var n=0,i=Object.keys(this.contentSharingSessions);n<i.length;n++){var r=i[n];if(this.contentSharingSessions.hasOwnProperty(r)){var o=this.contentSharingSessions[r];o&&o.dispose(e,t)}}},e.prototype.handleContentSharingUpdate=function(e){var t=e.body,n=s.extractCauseIdFromMessage(e),i=this.contentSharingSessions[t.contentSharingCorrelationId];i?i.handleUpdate(t,n)&&this.signalingSessionCallback.onContentSharingUpdated({sessionId:t.sessionId,correlationId:t.contentSharingCorrelationId,contentIdentifier:t.identifier,presenter:t.presenter.id,subject:t.subject||null,sessionState:t.sessionState||null},n):this.logger.info("["+n+"][handleContentSharingUpdate][failed][reason=no session with correlation ID "+t.correlationId+"]")},e.prototype.handleAddModalitySuccess=function(e,t){this.logger.info("["+t+"][handleAddModalitySuccess]");var n=this.pendingSessionToStart;n?n.handleAddModalitySuccess(e,t):this.logger.info("["+t+"][handleAddModalitySuccess]Ignoring handleAddModalitySuccess because not waiting for one")},e.prototype.handleAddModalityFailure=function(e,t){this.logger.info("["+t+"][handleAddModalityFailure]");var n=this.pendingSessionToStart;n?n.handleAddModalityFailure(e,t):this.logger.info("["+t+"][handleAddModalityFailure]Ignoring handleAddModalityFailure because not waiting for one")},e.prototype.handleIncomingContentSharingFromRoster=function(e,t,n){if(this.logger.info("["+n+"] handleIncomingContentSharingFromRoster: isFullRoster "+t+" content "+r.getPrintableObject(e)),("MultiPartyEndpoint"===e.type||t)&&this.lastProcessedSequenceNumber>e.sequenceNumber)this.logger.info("["+n+"] handleIncomingContentSharingFromRoster invalid roster current sequenceNumber "+e.sequenceNumber+" lastProcessedSequenceNumber "+this.lastProcessedSequenceNumber);else{var i=this.parseSessionsFromRoster(e),o=i.sessionsWithPresenters,a=i.sessionsWithoutPresenters;this.startSessionsFromRoster(o,n),this.stopSessionsFromRoster(a,n),this.lastProcessedSequenceNumber=e.sequenceNumber}},e.prototype.handleContentSharingEnd=function(e){var t=e.body,n=s.extractCauseIdFromMessage(e);this.logger.info("handleContentSharingEnd : ",r.getPrintableObject(t));var o=this.contentSharingSessions[t.contentSharingCorrelationId];if(o){if(o.handleStop(t,n)){var a=i({},t.contentSharingTransactionEnd);this.raiseContentSharingStopped(t.contentSharingCorrelationId,n,t.presenter.id,a)}}else this.logger.info("Ignoring contentSharingEnd since there is no corresponding sharing ongoing")},e.prototype.parseSessionsFromRoster=function(e){for(var t=function(e){return e.contentSharing&&e.contentSharing.sessionInformation&&"presenter"===e.contentSharing.sessionInformation.role},n=function(e){return e.hasOwnProperty("contentSharing")&&e.contentSharing.hasOwnProperty("sessionInformation")&&e.contentSharing.sessionInformation.hasOwnProperty("role")},i={},r={},o=0,a=Object.keys(e.participants);o<a.length;o++){var s=a[o],c=e.participants[s];if(!("Delta"===e.type&&this.lastProcessedSequenceNumberForParticipant.hasOwnProperty(s)&&c.version<=this.lastProcessedSequenceNumberForParticipant[s])){c.version||(c.version=-1),this.lastProcessedSequenceNumberForParticipant[s]=c.version;var l=void 0,u=void 0,d=!1,p=this.signalingSession.participantManager.localParticipant.participantId;if(c.endpoints){for(var f=!1,h=0,g=Object.keys(c.endpoints);h<g.length;h++){var m=g[h],v=c.endpoints[m];if(n(v)&&(f=!0,t(v)&&(l=c.details.id,u=v.contentSharing.sessionInformation,d=v.participantId===p)))break}if(l)i[u.contentSharingCorrelationId]={presenterId:l,sessionInfo:u,selfEndpointIsPresenter:d};else if(!f)for(var y=0,S=Object.keys(this.contentSharingSessions);y<S.length;y++){var _=S[y];if(c.details.id===this.contentSharingSessions[_].presenterMri){r[_]=this.contentSharingSessions[_];break}}}}}return{sessionsWithPresenters:i,sessionsWithoutPresenters:r}},e.prototype.stopSessionsFromRoster=function(e,t){this.logger.info("["+t+"][stopSessionsFromRoster]");for(var n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];this.logger.info("["+t+"][stopSessionsFromRoster] stopping session with correlationId "+r),this.stopSession(e[r],t)}},e.prototype.stopSession=function(e,t){this.logger.info("["+t+"][stopSession] Stopping session "+e.sessionId),e.handleStopFromRoster(this.DEFAULT_STOP_REASON,t),this.raiseContentSharingStopped(e.correlationId,t)},e.prototype.startSessionsFromRoster=function(e,t){this.logger.info("["+t+"][startSessionsFromRoster]");for(var n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];this.logger.info("["+t+"][startSessionsFromRoster]");var o=this.contentSharingSessions[r],a=e[r];if(this.pendingSessionToStart&&this.pendingSessionToStart.correlationId===r?this.pendingSessionToStart.confirmInRoster():o&&o.confirmInRoster(),o)o&&(this.contentSharingSessions[r].presenterMri=a.presenterId,this.logger.info("["+t+"][startSessionsFromRoster]Session "+r+" is already present locally"));else{if(a.selfEndpointIsPresenter){this.logger.info("["+t+"][startSessionsFromRoster]This endpoint is presenting, dont fire callback");continue}this.logger.info("["+t+"][startSessionsFromRoster]New sharing session found. Raising ContentSharingStarted"),this.raiseContentSharingStarted(a.presenterId,a.sessionInfo,t).handleStartFromRoster(a.presenterId,t)}}},e.prototype.raiseContentSharingStopped=function(e,t,n,i){this.logger.info("["+t+"][raiseContentSharingStopped]"),this.signalingSessionCallback.onContentSharingStopped({sessionId:this.contentSharingSessions[e].sessionId,correlationId:e,endedBy:n||this.DEFAULT_STOP_ID,reason:i||this.DEFAULT_STOP_REASON},t),delete this.contentSharingSessions[e]},e.prototype.raiseContentSharingStarted=function(e,t,n){var i;this.logger.info("["+n+"][raiseContentSharingStarted]");var r=new o.ContentSharingSession(this.signalingSession,t.contentSharingCorrelationId,t.contentSharingSessionId,((i={})[a.default.LINKS.CONTENT_SHARING_CONTROLLER]=t.contentSharingController,i));r.presenterMri=e,this.contentSharingSessions[r.correlationId]=r;var s={sessionId:t.contentSharingSessionId,correlationId:t.contentSharingCorrelationId,contentIdentifier:t.identifier,presenter:e,subject:t.subject||null,sessionState:t.sessionState||null};return this.signalingSessionCallback.onContentSharingStarted(s,n),r},e.prototype.rejectBecauseOfMissingSession=function(e,t){var n="There is no ContentSharing session with the correlation ID "+e;this.logger.error(n),t&&t.reject(new Error(n))},e}();t.default=c},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(81),a=n(82),s=n(83),c=n(84),l=n(85),u=n(86),d=n(87),p=n(5),f=n(1),h=n(8),g=n(0),m=function(){function e(e,t,n,i){var r=this;this.signalingSession=e,this.correlationId=t,this.sessionId=null,this.fsmState=f.default.CONTENT_SHARING_FSM_STATE.IDLE,this.addSessionPromise=null,this.removeSessionPromise=null,this.confirmInRosterPromise=null,this.links={},this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.disposed=!1,this.isPresenter=!1,this.FSM_STATES=f.default.CONTENT_SHARING_FSM_STATE,this.logger=e.logger.createChild(function(){return"["+r.fsmState+"][cs="+r.sessionId+"][cc="+r.correlationId+"]"}),n&&(this.sessionId=n),i&&(this.links=i)}return e.prototype.start=function(e,t,n,i){var a,s=this;if(this.logger.info("["+i+"][start]"),g.assertNotNullOrEmpty(e,"Correct addModality url is not provided"),!this.checkState("start",this.FSM_STATES.IDLE,this.addSessionPromise))return Promise.reject(null);this.addSessionPromise=n,this.confirmInRosterPromise=g.defer(),this.fsmState=this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.addTelemetryOperation(p.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY,{causeId:i});var c=((a={})[f.default.HEADERS.CONTENT_SHARING_CORRELATION_ID]=this.correlationId,a);return this.signalingSession.http.sendPostRequest({url:e,payload:o.getPayload(this.signalingSession,t),requestName:p.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY,customHeaders:c,onceTrouterReady:function(){return s.startContentSharingTimer(i)},causeId:i}).then(function(){s.disposed||(s.presenterMri=s.signalingSession.participantManager.localParticipant.id,s.isPresenter=!0)}).catch(function(e){var t=g.getErrorForXHRFailure(e);return s.logger.info("["+i+"][start] error: "+r.getPrintableObject(t)),s.disposed||(s.signalingSession.timeoutManager.stopTimer(f.default.TIMEOUT_OPERATIONS.ADD_MODALITY),s.rejectPendingPromise(r.getPrintableObject(e),t.error)),Promise.reject(null)})},e.prototype.delete=function(e,t){var n=this;this.logger.info("["+t+"][delete]");var i=!1;if(this.fsmState===this.FSM_STATES.IDLE)return this.logger.info("["+t+"][delete] skipped because state is already "+this.fsmState),e.resolve(),Promise.resolve();if(this.fsmState===this.FSM_STATES.CONTENT_SHARING_START_INITIATED)i=!0,this.rejectPendingPromise("Session delete called before start was finished");else if(!this.checkState("delete",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e))return Promise.reject(null);i||g.assertNotNullOrEmpty(this.links[f.default.LINKS.CONTENT_SHARING_CONTROLLER],"Correct controller url is not set"),this.removeSessionPromise=e,this.fsmState=this.FSM_STATES.CONTENT_SHARING_DELETE_INITIATED;var o=h.build(),a=this.addTelemetryOperation(p.NETWORK_REQUESTS.DELETE_CONTENT_SHARING,{causeId:t});return(i?Promise.resolve(void 0):this.signalingSession.http.sendDeleteRequest({url:this.links[f.default.LINKS.CONTENT_SHARING_CONTROLLER],requestName:p.NETWORK_REQUESTS.DELETE_CONTENT_SHARING,payload:s.getPayload(this.signalingSession,{code:f.default.CALL_END_CODE.SUCCESS,subCode:f.default.CALL_END_SUB_CODE.SUCCESS,phrase:f.default.CALL_END_PHRASE.LOCAL_USER_INITIATED}),causeId:t})).then(function(){if(!n.disposed){var e={success:!0,duration:o.duration()};i&&(e.skipReason="Session delete called before start was finished"),n.updateTelemetryOperation(a,e),n.fsmState=n.FSM_STATES.IDLE,n.resolvePendingPromise()}}).catch(function(e){var i=g.getErrorForXHRFailure(e);if(n.logger.info("["+t+"][delete] error: "+r.getPrintableObject(i)),!n.disposed){var s={success:!1,duration:o.duration()};n.updateTelemetryOperation(a,s),n.fsmState=n.FSM_STATES.IDLE,n.resolvePendingPromise()}return Promise.reject(null)})},e.prototype.join=function(e,t){var n=this;if(this.logger.info("["+t+"][join]"),g.assertNotNullOrEmpty(this.links[f.default.LINKS.CONTENT_SHARING_CONTROLLER],"Correct joinContentSharing url is not provided"),this.checkState("join",this.FSM_STATES.IDLE,e)){this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.addSessionPromise=e,this.fsmState=this.FSM_STATES.CONTENT_SHARING_JOIN_INITIATED;var i=h.build(),o=this.addTelemetryOperation(p.NETWORK_REQUESTS.JOIN_CONTENT_SHARING,{causeId:t});this.signalingSession.http.sendPostRequest({url:this.links[f.default.LINKS.CONTENT_SHARING_CONTROLLER],payload:a.getPayload(this.signalingSession),requestName:p.NETWORK_REQUESTS.JOIN_CONTENT_SHARING,causeId:t}).then(function(e){if(!n.disposed){var t={success:!0,duration:i.duration()};n.updateTelemetryOperation(o,t),n.processStartOrJoinSuccess(e.response),n.resolvePendingPromise(e.response)}}).catch(function(e){var a=g.getErrorForXHRFailure(e);if(n.logger.info("["+t+"][join] error: "+r.getPrintableObject(a)),!n.disposed){var s={success:!1,duration:i.duration()};n.updateTelemetryOperation(o,s);var c=a.error;n.rejectPendingPromise(r.getPrintableObject(e),c)}})}},e.prototype.takeControl=function(e,t){var n=this;if(this.logger.info("["+t+"][takeControl]"),g.assertNotNullOrEmpty(this.links[f.default.LINKS.CONTENT_SHARING_TAKE_CONTROL],"correct contentSharingTakeControl url is not provided"),this.checkState("takeControl",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e)){var i=h.build(),o=this.addTelemetryOperation(p.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING,{causeId:t});this.signalingSession.http.sendPostRequest({url:this.links[f.default.LINKS.CONTENT_SHARING_TAKE_CONTROL],payload:c.getPayload(this.signalingSession),requestName:p.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING,withoutTrouter:!0,causeId:t}).then(function(t){if(!n.disposed){var r={success:!0,duration:i.duration()};n.updateTelemetryOperation(o,r);var a={contentIdentifier:t.response.identifier,presenter:t.response.presenter.id,subject:t.response.subject||null,sessionState:t.response.sessionState||null};e.resolve(a)}}).catch(function(a){var s=g.getErrorForXHRFailure(a);if(n.logger.info("["+t+"][takeControl] error: "+r.getPrintableObject(s)),!n.disposed){var c={success:!1,duration:i.duration()};n.updateTelemetryOperation(o,c);var l=new Error(r.getPrintableObject(a));l.endCode=s.error,e.reject(l)}})}},e.prototype.updateSessionState=function(e,t,n){var i=this;if(this.logger.info("["+n+"][updateSessionState]"),g.assertNotNullOrEmpty(this.links[f.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],"Correct sendUpdateSessionState url is not provided"),this.checkState("updateSessionState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,t)){var o=h.build(),a=this.addTelemetryOperation(p.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING,{causeId:n});this.signalingSession.http.sendPostRequest({url:this.links[f.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],payload:d.getPayload(this.signalingSession,e,this.nextClientSequenceNumberToUse++),requestName:p.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING,causeId:n}).then(function(){if(!i.disposed){var e={success:!0,duration:o.duration()};i.updateTelemetryOperation(a,e),t.resolve()}}).catch(function(e){var s=g.getErrorForXHRFailure(e);if(i.logger.info("["+n+"][updateSessionState] error: "+r.getPrintableObject(s)),!i.disposed){var c={success:!1,duration:o.duration()};i.updateTelemetryOperation(a,c);var l=new Error(r.getPrintableObject(e));l.endCode=s.error,t.reject(l)}})}},e.prototype.updateParticipantState=function(e,t){var n=this;if(this.logger.info("["+t+"][updateParticipantState]"),g.assertNotNullOrEmpty(this.links[f.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],"correct confirmContentSharingView url is not provided"),this.checkState("updateParticipantState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e)){var i=h.build(),o=this.addTelemetryOperation(p.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING,{causeId:t});this.signalingSession.http.sendPostRequest({url:this.links[f.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],payload:u.getPayload(this.signalingSession),requestName:p.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING,withoutTrouter:!0,causeId:t}).then(function(){if(!n.disposed){var t={success:!0,duration:i.duration()};n.updateTelemetryOperation(o,t),e.resolve()}}).catch(function(a){var s=g.getErrorForXHRFailure(a);if(n.logger.info("["+t+"][updateParticipantState] error: "+r.getPrintableObject(s)),!n.disposed){var c={success:!1,duration:i.duration()};n.updateTelemetryOperation(o,c);var l=new Error(r.getPrintableObject(a));l.endCode=s.error,e.reject(l)}})}},e.prototype.updateNotificationLinks=function(e){var t=this;if(this.logger.info("["+e+"][updateNotificationLinks]"),g.assertNotNullOrEmpty(this.links[f.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],"correct notificationLinks url is not provided"),this.checkState("updateState",this.FSM_STATES.CONTENT_SHARING_CONNECTED)){var n=h.build(),i=this.addTelemetryOperation(p.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS,{causeId:e});this.signalingSession.http.sendPostRequest({url:this.links[f.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],payload:l.getPayload(this.signalingSession),requestName:p.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS,withoutTrouter:!0,causeId:e}).then(function(){if(!t.disposed){var e={success:!0,duration:n.duration()};t.updateTelemetryOperation(i,e)}}).catch(function(o){var a=g.getErrorForXHRFailure(o);if(t.logger.info("["+e+"][updateNotificationLinks] error: "+r.getPrintableObject(a)),!t.disposed){var s={success:!1,duration:n.duration()};t.updateTelemetryOperation(i,s)}})}},e.prototype.confirmInRoster=function(){this.confirmInRosterPromise&&this.confirmInRosterPromise.isPending&&(this.logger.info("Confirmed in roster"),this.confirmInRosterPromise.resolve())},e.prototype.handleAddModalitySuccess=function(e,t){var n=this;return this.logger.info("["+t+"][handleAddModalitySuccess]"),this.checkState("handleAddModalitySuccess",this.FSM_STATES.CONTENT_SHARING_START_INITIATED)?e.modalitySuccess&&e.modalitySuccess.contentSharing?(this.addTelemetryOperation(p.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,{causeId:t}),this.processStartOrJoinSuccess(e.modalitySuccess.contentSharing),this.confirmInRosterPromise.promise.then(function(){delete n.confirmInRosterPromise,n.signalingSession.timeoutManager.stopTimer(f.default.TIMEOUT_OPERATIONS.ADD_MODALITY),n.resolvePendingPromise(e.modalitySuccess.contentSharing)}),!0):(this.addTelemetryOperation(p.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,{causeId:t,skipReason:"no content sharing blob"}),this.logger.info("["+t+"][handleAddModalitySuccess] ignored because modalitySuccess was missing or did not contain content sharing blob"),!1):(this.logger.info("["+t+"][handleAddModalitySuccess] ignored because session is not waiting to start"),!1)},e.prototype.handleAddModalityFailure=function(e,t){if(this.logger.info("["+t+"][handleAddModalityFailure]"),!this.checkState("handleAddModalityFailure",[this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.FSM_STATES.CONTENT_SHARING_CONNECTED]))return!1;if(!e.modalityFailure||!e.modalityFailure.contentSharing)return this.addTelemetryOperation(p.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{causeId:t,skipReason:"no content sharing blob"}),!1;var n=e.modalityFailure.contentSharing;this.addTelemetryOperation(p.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{reason:n,causeId:t});var r=i({},n);return this.sendTelemetryData(r),this.rejectPendingPromise(r.phrase,r),this.signalingSession.timeoutManager.stopTimer(f.default.TIMEOUT_OPERATIONS.ADD_MODALITY),!0},e.prototype.handleStartFromRoster=function(e,t){this.logger.info("["+t+"][handleStartFromRoster]"),this.addTelemetryOperation(p.EVENTS.CONTENT_SHARING_START_FROM_ROSTER,{causeId:t})},e.prototype.handleStopFromRoster=function(e,t){this.logger.info("["+t+"][handleStopFromRoster]"),this.addTelemetryOperation(p.EVENTS.CONTENT_SHARING_END_FROM_ROSTER,{causeId:t}),this.sendTelemetryData(e)},e.prototype.handleStop=function(e,t){if(this.logger.info("["+t+"][handleStop]"),this.isSelfInitiatedAction(e))return this.logger.info("["+t+"][handleStop]handleStop skipped because session was ended by self"),!1;var n=i({},e.contentSharingTransactionEnd);return this.addTelemetryOperation(p.EVENTS.HANDLE_CONTENT_SHARING_END,{causeId:t}),this.sendTelemetryData(n),!0},e.prototype.handleUpdate=function(e,t){return this.logger.info("["+t+"][handleUpdate]"),e.sequenceNumber<=this.lastUpdateSequenceNumber?(this.logger.info("handleUpdate skipped because of old sequence number: last received "+this.lastUpdateSequenceNumber+", update contained "+e.sequenceNumber),this.addTelemetryOperation(p.EVENTS.HANDLE_CONTENT_SHARING_UPDATE,{causeId:t,skipReason:"old sequence number"}),!1):(this.lastUpdateSequenceNumber=e.sequenceNumber,this.isPresenter=e.presenter.id===this.signalingSession.participantManager.localParticipant.id,this.addTelemetryOperation(p.EVENTS.HANDLE_CONTENT_SHARING_UPDATE,{causeId:t}),!0)},e.prototype.dispose=function(e,t){this.logger.info("["+t+"][dispose]"),this.disposed=!0,this.rejectPendingPromise("call ended",e||{code:f.default.CALL_END_CODE.SUCCESS,subCode:f.default.CALL_END_SUB_CODE.SUCCESS,phrase:f.default.CALL_END_PHRASE.LOCAL_USER_INITIATED}),this.addTelemetryOperation(p.EVENTS.HANDLE_CALL_END,{causeId:t}),this.sendTelemetryData(e)},e.prototype.rejectPendingPromise=function(e,t){this.logger.info("rejectPendingPromise");var n=new Error(e);t&&(n.endCode=t),this.removeSessionPromise&&(this.removeSessionPromise.reject(n),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.reject(n),this.addSessionPromise=null)},e.prototype.resolvePendingPromise=function(e){this.logger.info("resolvePendingPromise");var t=null;e&&(t={sessionId:e.sessionId,correlationId:e.contentSharingCorrelationId,contentIdentifier:e.identifier,presenter:e.presenter.id,subject:e.subject||null,sessionState:e.sessionState||null}),this.removeSessionPromise&&(this.removeSessionPromise.resolve(t),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.resolve(t),this.addSessionPromise=null)},e.prototype.processStartOrJoinSuccess=function(e){this.logger.info("processStartOrJoinSuccess"),this.sessionId=e.sessionId,this.fsmState=this.FSM_STATES.CONTENT_SHARING_CONNECTED,this.lastUpdateSequenceNumber=-1,this.links[f.default.LINKS.CONTENT_SHARING_CONTROLLER]=e.links.contentSharingController,this.links[f.default.LINKS.CONTENT_SHARING_TAKE_CONTROL]=e.links.takeControl,this.links[f.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE]=e.links.updateSessionState,this.links[f.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE]=e.links.sync,this.links[f.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS]=e.links.notificationLinks,this.links[f.default.LINKS.CONTENT_SHARING_LEAVE]=e.links.leave},e.prototype.checkState=function(e,t,n){if("string"==typeof t?this.fsmState===t:t.indexOf(this.fsmState)>-1)return!0;var i=e+" requires state "+t+", but state is "+this.fsmState;return this.logger.error(i),n&&n.reject(i),!1},e.prototype.isSelfInitiatedAction=function(e){return e.presenter.participantId===this.signalingSession.participantManager.localParticipant.participantId},e.prototype.startContentSharingTimer=function(e){var t=this;this.logger.info("startContentSharingTimer"),this.signalingSession.timeoutManager.startTimer(f.default.TIMEOUT_OPERATIONS.ADD_MODALITY,function(){t.addTelemetryOperation(p.EVENTS.ADD_MODALITY_TIMEOUT,{causeId:e}),t.signalingSession.timeoutManager.stopTimer(f.default.TIMEOUT_OPERATIONS.ADD_MODALITY),t.rejectPendingPromise("timed out waiting for ContentSharing to start",{code:f.default.CALL_END_CODE.TIMEOUT,subCode:f.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:f.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},f.default.TIMEOUT_VALUES_IN_SECONDS.ADD_MODALITY_TIMEOUT)},e.prototype.addTelemetryOperation=function(e,t){return this.signalingSession.telemetryHelper.addContentSharingOperation(this.correlationId,e,t)},e.prototype.updateTelemetryOperation=function(e,t){this.signalingSession.telemetryHelper.updateContentSharingOperation(this.correlationId,e,t)},e.prototype.sendTelemetryData=function(e){this.signalingSession.telemetryHelper.sendContentSharingTelemetryData(this.correlationId,this.signalingSession.sessionId,this.isPresenter,e,this.links[f.default.LINKS.CONTENT_SHARING_CONTROLLER],this.sessionId)},e}();t.ContentSharingSession=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t){return o.assertNotNull(e,"signalingSession cannot be null"),o.assertNotNull(t,"content cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[]},contentSharing:{identifier:t.contentIdentifier,subject:t.subject,sessionState:t.sessionState,sequenceNumber:t.sequenceNumber,links:{sessionUpdate:r.get(e,i.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,i.URL_PATH.CONV_CONTENT_SHARING_END)}},links:{addModalitySuccess:r.get(e,i.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:r.get(e,i.URL_PATH.CONV_ADD_MODALITY_FAILURE)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e){return o.assertNotNull(e,"signalingSession cannot be null"),{payload:{contentSharing:{links:{sessionUpdate:r.get(e,i.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,i.URL_PATH.CONV_CONTENT_SHARING_END)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{contentSharingTransactionEnd:t,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e){return o.assertNotNull(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},links:{sessionUpdate:r.get(e,i.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,i.URL_PATH.CONV_CONTENT_SHARING_END)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t,n){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"sessionState cannot be null"),i.assertNotNull(n,"sequenceNumber cannot be null"),{payload:{sessionUpdateSequenceNumber:n,sessionState:t,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";var i,r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),c=n(89),l=n(1),u=n(90),d=n(91),p=n(8),f=n(0),h=((i={})[1]="POST",i[0]="GET",i[2]="PUT",i[3]="DELETE",i),g=function(){function e(e,t){var n=this;this.signalingSession=e,this.callStartTime=t,this.pendingRequests={},this.sendGetRequest=function(e){return n.sendRequest(0,e)},this.sendPostRequest=function(e){return n.sendRequest(1,e)},this.sendPutRequest=function(e){return n.sendRequest(2,e)},this.sendDeleteRequest=function(e){return n.sendRequest(3,e)},this.cancelRequestIfPending=function(e,t,i,r){n.logger.info("["+t+"][cancelRequestIfPending]"),n.pendingRequests[e]?i?n.hasPendingRequest(e,i)&&n.cancelRequest(e,i,t,r):Object.keys(n.pendingRequests[e]).forEach(function(i){return n.cancelRequest(e,i,t,r)}):n.logger.info("["+t+"][cancelRequestIfPending]no pending request with name="+e)},this.cancelAllRequests=function(e){n.logger.info("["+e+"][cancelAllRequests]");var t=[];return Object.keys(n.pendingRequests).forEach(function(i){Object.keys(n.pendingRequests[i]).forEach(function(r){t.push(n.cancelRequest(i,r,e))})}),Promise.all(t).catch(function(){})},this.hasPendingRequest=function(e,t){return!!n.pendingRequests[e]&&Boolean(t?n.pendingRequests[e][t]:n.pendingRequests[e])},this.cancelRequest=function(e,t,i,r){try{return n.pendingRequests[e][t].dispatcher&&n.pendingRequests[e][t].dispatcher.cancelRequest(),n.pendingRequests[e][t].aborted=!0,n.pendingRequests[e][t].errorDetails=r,n.logger.info("["+i+"][cancelRequest]Request="+e+" aborted "+(r?"with errorDetails "+JSON.stringify(r):"")),n.pendingRequests[e][t].requestPromise.catch(function(){})}catch(r){return n.logger.warn("["+i+"][cancelRequest]Unable to cancel request="+e+", requestId="+t),Promise.resolve()}},this.buildRequestTelemetry=function(e,t,i,r){return{name:h[e]+"-"+t.requestName,url:t.url,eventStart:i-n.callStartTime,trouterReady:-1,requestReady:-1,status:-1,attempts:[],rtt:-1,uid:t.requestId,causeId:t.causeId,requestDispatcherConfig:r,enableRequestHedging:n.shouldEnableRequestHedging(r)}},this.addPendingRequest=function(e){return n.pendingRequests[e.requestName]||(n.pendingRequests[e.requestName]={}),n.pendingRequests[e.requestName][e.requestId]={dispatcher:null,requestPromise:null,aborted:!1},n.pendingRequests[e.requestName][e.requestId]},this.sendRequest=function(e,t){if(!t.url){n.logger.error(t.requestName,"Link does not exist");var i={code:l.default.CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,subCode:l.default.CALL_END_SUB_CODE.LOCAL_HTTP_STACK_ERROR,phrase:"Link does not exist for requestName: "+t.requestName+"."};return Promise.reject(i)}t.requestId||(t.requestId=f.newGuid()),t.causeId||(t.causeId=f.causeId());var c=n.logger.createChild("["+t.causeId+"]["+t.requestName+"]");c.info("[scheduled]");var h,g=n.getInternalHttpDispatcherConfig(t.requestName,t.operationType);t.skipHttpTelemetry||(t.skipHttpTelemetry=!1);var m=p.build(),v=(new Date).getTime(),y=[],S=n.buildRequestTelemetry(e,t,v,g),_=function(){n.signalingSession.disposed?n.logger.info("Unable to record telemetry, session disposed"):n.signalingSession.telemetryHelper.updateNetworkRequest(S)};_();var E=function(e,i){if(e&&e.request){c.info("[finished][status="+e.request.status+"][statusText="+e.request.statusText+"][retryCount="+e.attempt+"]");var r={status:e.request.status,start:e.attemptStartTimestamp-v,end:e.attemptResponseTimestamp-v,online:f.isTrouterAndNavigatorConnected(n.signalingSession.signalingAgentConfig.trouterServiceProvider)};e.abandoned&&(r.abandoned=!0),e.request.statusText&&(r.statusText=e.request.statusText),(i||-1===S.status)&&(S.status=e.request.status),S.attempts.push(r),_()}else n.logger.warn(t.requestName,"missing request details, unable to record for telemetry!")};if(n.hasPendingRequest(t.requestName,t.requestId))return n.logger.warn(t.requestName,t.requestId,"is already pending request!!"),n.pendingRequests[t.requestName][t.requestId].requestPromise;h=n.addPendingRequest(t);var T=function(e,i,r,o){if(e&&t.skipHttpTelemetry)return n.logger.info("Skipping telemetry"),void n.signalingSession.telemetryHelper.deleteNetworkRequest(S);c.info("[steps="+y+"]"),n.pendingRequests[t.requestName][t.requestId].aborted&&(S.aborted=!0),n.hasPendingRequest(t.requestName,t.requestId)?(delete n.pendingRequests[i][r],Object.keys(n.pendingRequests[i]).length||delete n.pendingRequests[i]):n.logger.warn("Unable to clean up!"),n.signalingSession.disposed||(o&&(S.error=o),S.rtt=m.duration(),n.signalingSession.telemetryHelper.addNetworkOperationCompleted(t.requestName,e,m.duration()),_())},C=function(e){return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(n.signalingSession.disposed){var o="["+t.causeId+"]["+t.requestName+"][failed][reason=Session disposed]";throw c.info("[failed][reason=Session disposed]"),new Error(o)}if(n.hasPendingRequest(t.requestName,t.requestId)&&n.pendingRequests[t.requestName][t.requestId].aborted){var a=void 0,s="["+t.causeId+"]["+t.requestName+"][failed][reason=request already aborted]",l=n.pendingRequests[t.requestName][t.requestId].errorDetails;throw l?(a=l).phrase=s:a=s,c.info(""+s),new Error(JSON.stringify(a))}return e.apply(void 0,i)}},I=C(function(){return y.push("[waitForTrouter]"),t.withoutTrouter?Promise.resolve():n.signalingSession.ensureMessageChannelReady(t.requestName)}),A=C(function(){return y.push("[trouterReady]"),S.trouterReady=m.duration(),t.onceTrouterReady&&t.onceTrouterReady(),_(),Promise.resolve()}),b=C(function(){return y.push("[buildRequest]"),u.get({signalingSession:n.signalingSession,operation:t.requestName,data:t.payload,customHeaders:t.customHeaders,causeId:t.causeId})}),R=C(function(e){y.push("[failedToBuildRequestOptions]");var t={request:{status:l.default.HTTP_STATUS_CODES.OTHER,statusText:"Local error"},attempt:1,success:!1,attemptResponseTimestamp:(new Date).getTime(),attemptStartTimestamp:(new Date).getTime()};return e&&e.skypeTokenError&&(t.request={status:l.default.HTTP_STATUS_CODES.SKYPE_TOKEN_ERROR,statusText:"Failed to fetch skypetoken"}),E(t,!1),Promise.reject(e)}),O=C(function(e){return y.push("[requestBuilt]"),S.requestReady=m.duration(),e.usedCachedSkypetoken&&(S.usedCachedSkypetoken=e.usedCachedSkypetoken),_(),Promise.resolve(e)}),P=function(){return y.push("[authRequired]"),u.get({signalingSession:n.signalingSession,operation:t.requestName,data:t.payload,customHeaders:t.customHeaders,causeId:t.causeId,forceFetchToken:!0})},N=C(function(i){y.push("[sendRequest]");var o=r({},g,{enableRequestHedging:n.shouldEnableRequestHedging(g),hedgeDelayMs:n.signalingSession.signalingAgentConfig.hedgeDelayMs,hedgeMaxParallelAttempts:n.signalingSession.signalingAgentConfig.hedgeMaxParallelAttempts,retryIntervalsMs:t.disableRetry||!g.retryIntervalsMs?[]:g.retryIntervalsMs}),a=d.build({logger:n.logger,causeId:t.causeId,dispatcher:n.signalingSession.signalingAgentConfig.httpRequestDispatcher,url:t.url,request:i,requestType:e,authRequiredCallback:P,attemptFailureCallback:function(e){return E(e,!1)},settings:o});return h.dispatcher=a,_(),a.sendRequest()}),M=C(function(e){return o(n,void 0,void 0,function(){return a(this,function(n){return E(e,!0),c.info("[success]"),T(!0,t.requestName,t.requestId),[2,e]})})}),w=Promise.resolve().then(I).then(A).then(b).catch(R).then(O).then(N).then(M).catch(function(e){var n=s.getPrintableObject(e);return T(!1,t.requestName,t.requestId,n),!e||e.readyState||e.status?c.info("[failed][reason="+n+"]"):c.info("[failed][offline][reason="+n+"]"),Promise.reject(e)});return h.requestPromise=w,w},this.logger=this.signalingSession.logger.createChild("[HTTP]")}return e.prototype.getInternalHttpDispatcherConfig=function(e,t){void 0===t&&(t="Other");var n=r({},c.defaultRequestTypeHttpDispatcherConfigMap.Default,c.defaultOperationTypeHttpDispatcherConfigMap[t],c.defaultRequestTypeHttpDispatcherConfigMap[e]);return this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.operationTypeHttpDispatcherConfigMap&&(n=r({},n,this.signalingSession.signalingAgentConfig.operationTypeHttpDispatcherConfigMap[t])),this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap&&(n=r({},n,this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap.Default,this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap[e])),this.logger.info("getInternalHttpDispatcherConfig requesnt type: "+e+" config: "+s.safeJsonStringify(n)),n},e.prototype.shouldEnableRequestHedging=function(e){return!!(this.signalingSession.getMeetingInfo()&&e.requestHedgingCapability.indexOf("enabledForMeetings")>-1)||!this.signalingSession.multiParty&&e.requestHedgingCapability.indexOf("enabledForP2PCalls")>-1||!!(this.signalingSession.multiParty&&e.requestHedgingCapability.indexOf("enabledForGroupCalls")>-1)||e.requestHedgingCapability.indexOf("enabled")>-1},e}();t.HttpStack=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultRequestTypeHttpDispatcherConfigMap={Default:{retryIntervalsMs:[200,1e3,5e3],maxRequestAttempts:4,perRequestTimeoutMs:45e3,perAttemptTimeoutMs:15e3},BrokerSubscribe:{retryIntervalsMs:[100,200,500]}},t.defaultOperationTypeHttpDispatcherConfigMap={CallSetup:{requestHedgingCapability:["disabled"]},Other:{requestHedgingCapability:["disabled"]}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(0);t.get=function(e){var t=e.signalingSession,n=e.operation,a=e.causeId,s=e.data,c=e.customHeaders,l=void 0===c?{}:c,u=e.forceFetchToken;if(t.disposed)return Promise.reject("Session already disposed");var d=function(e){var t="string"==typeof e?new Error(e):e;throw t.skypeTokenError=!0,t},p=!1;return t.signalingAgent.authTokenManager.getToken(a,u).catch(function(e){return!u&&function(e){var t=o.isTrouterAndNavigatorConnected(e.signalingAgentConfig.trouterServiceProvider);return 3===t||1===t}(t)&&t.signalingAgentConfig.attemptHttpRequestWithCachedSkypetoken&&t.signalingAgent.authTokenManager.getLastToken(a)?(p=!0,Promise.resolve(t.signalingAgent.authTokenManager.getLastToken(a))):d(e)}).then(function(e){if(t.disposed)throw new Error("skypeToken Getter returned too late. Object is already disposed");var c={};c[r.default.HEADERS.CORRELATION_ID]=t.correlationId,c[r.default.HEADERS.MESSAGE_ID]=o.newMessageId(a),c[r.default.HEADERS.CLIENT_USER_AGENT]=t.signalingAgentConfig.clientInformation,c[r.default.HEADERS.SKYPE_TOKEN]=e;var u=t.participantManager.localParticipant;u&&(u.ring&&(c[r.default.HEADERS.RING]=u.ring),u.region&&(c[r.default.HEADERS.REGION]=u.region),u.partition&&(c[r.default.HEADERS.PARTITION]=u.partition));var d=s&&s.payload?JSON.stringify(s.payload):null,f={headers:i({},c,l),payload:d,usedCachedSkypetoken:p,reporting:{serviceName:n?"HttpRequestDispatcherFactory-"+n:"HttpRequestDispatcherFactory"}};return t.telemetryHelper.addNetworkOperationStarted(n),f}).catch(d)}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(3),s=n(1),c=n(31),l=n(0);!function(e){e.HEDGE="HEDGE",e.ATTEMPT_TIMEOUT="ATTEMPT_TIMEOUT",e.RETRY="RETRY",e.REQUEST_TIMEOUT="REQUEST_TIMEOUT"}(o=t.TIMERS||(t.TIMERS={})),t.build=function(e){return new u(e.causeId,e.logger,e.dispatcher,e.requestType,e.url,e.request,e.attemptFailureCallback,e.authRequiredCallback,e.settings)};var u=function(){function e(e,t,n,i,r,l,u,d,p){var f=this;this.causeId=e,this.logger=t,this.dispatcher=n,this.requestType=i,this.url=r,this.request=l,this.onRequestFailed=u,this.authRequiredCallback=d,this.settings=p,this.requestsSent=0,this.otherAttemptSuccessful=!1,this.pendingAttempts=[],this.hedgeDelayMs=3e3,this.hedgeMaxParallelAttempts=3,this.stopStandardRetryTimer=function(){f.standardRetryTimer&&(f.standardRetryTimer.stop(),f.standardRetryTimer=null)},this.stopHedgeTimer=function(){f.hedgeTimer&&(f.hedgeTimer.stop(),f.hedgeTimer=null)},this.stopAttemptTimeoutTimer=function(e){try{e.timeoutTimer.stop()}catch(e){f.logger.info("attempt time stopped")}},this.stopRequestTimer=function(){try{f.requestTimer&&f.requestTimer.stop()}catch(e){f.logger.info("stopRequestTimer error "+e)}f.logger.info("Request timer stopped"),f.requestTimer=null},this.canScheduleNextAttempt=function(){return f.stackError===s.default.HTTP_STACK_ERROR.REQUEST_ABORTED||f.otherAttemptSuccessful||f.requestsSent>=f.settings.maxRequestAttempts?(f.logger.info("canScheduleNextAttempt stack error "+f.stackError+" otherAttemptSuccessful "+f.otherAttemptSuccessful+" exceeded max attempt "+(f.requestsSent>=f.settings.maxRequestAttempts)),!1):f.settings.enableRequestHedging?((e=f.pendingAttempts.length<f.hedgeMaxParallelAttempts)||f.logger.info("canScheduleNextAttempt enableRequestHedging attempts sent: "+f.pendingAttempts.length+" max attempts: "+f.hedgeMaxParallelAttempts),e):((e=f.requestsSent<f.settings.retryIntervalsMs.length)||f.logger.info("canScheduleNextAttempt attempts sent: "+f.requestsSent+" max attempts: "+f.settings.retryIntervalsMs.length),e);var e},this.scheduleNextRequest=function(e){f.settings.enableRequestHedging?(f.logger.info("scheduleNextRequest with hedging"),f.hedgeTimer=c.TimerFactory.build(function(){f.attempt(),f.canScheduleNextAttempt()&&f.scheduleNextRequest(!1)},o.HEDGE).start(f.getNextDelay(e))):(f.logger.info("scheduleNextRequest with retry"),f.standardRetryTimer=c.TimerFactory.build(function(){return f.attempt()},o.RETRY).start(f.getNextDelay(e)))},this.standardizeFailedRequest=function(e,t){var n,i=f.logger.createChild("[standardizeFailedRequest]");try{if(f.stackError===s.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT)i.info("request timed out"),n=s.REQUEST_DISPATCHER_RESPONSE.REQUEST_TIMEOUT;else if(f.stackError===s.default.HTTP_STACK_ERROR.REQUEST_ABORTED)i.info("request aborted"),n=s.REQUEST_DISPATCHER_RESPONSE.REQUEST_ABORTED;else if(t&&t.status===s.default.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT)i.info("request attempt timed out"),n=s.REQUEST_DISPATCHER_RESPONSE.ATTEMPT_TIMEOUT;else if(t&&[s.default.HTTP_STACK_ERROR.ATTEMPT_ABORTED,s.default.HTTP_STACK_ERROR.ABORTED_OTHER_ATTEMPT_SUCCESSFUL].indexOf(t.status)>-1)i.info("request attempt aborted"),n=s.REQUEST_DISPATCHER_RESPONSE.ATTEMPT_ABORTED;else if(e){if(i.info("request "+a.safeJsonStringify(e)),"function"==typeof XMLHttpRequest&&e instanceof XMLHttpRequest)n=e;else if("function"==typeof XMLHttpRequest&&e&&e.request instanceof XMLHttpRequest){var r=e;n={response:r.request.response,status:r.request.status,statusText:r.request.statusText,readyState:r.request.readyState}}else e.status||e.statusCode||e.response?n={response:e.response,status:[void 0,null,""].indexOf(e.status)>-1?e.statusCode:e.status,statusText:e.statusText,readyState:e.readyState}:(i.info("Local http stack error"),n={response:s.default.CALL_END_SUB_CODE.LOCAL_HTTP_STACK_ERROR,status:s.default.CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,statusText:"LocalHTTPStackError",readyState:e.readyState||0});f.isBrowserOffline()&&0===n.status&&4===n.readyState&&(i.info("offline"),n={response:s.default.HTTP_STACK_ERROR.CANNOT_CONNECT,status:s.default.HTTP_STATUS_CODES.OFFLINE,statusText:"offline",readyState:n.readyState}),e.response&&e.response.message&&(e.response.message.operationFailure||e.response.message.broadcastOperationFailure)?n={response:e.response.message}:!e.response&&e.body&&e.body.operationFailure&&(n={response:e.body})}else i.info("no response"),n={response:s.default.HTTP_STACK_ERROR.NONE,status:s.default.HTTP_STATUS_CODES.OTHER,statusText:"Empty Response",readyState:0}}catch(e){i.info("Failed to handle error "+e),n={response:"",status:s.default.HTTP_STATUS_CODES.OTHER,statusText:"FailedToHandleError",readyState:0}}return n},this.hasPendingAttempts=function(){return f.pendingAttempts.some(function(e){return e.pending})},this.getRequestFromStatus=function(e){return e&&e.request&&e.request.status||0},this.isBrowserOffline=function(){return navigator&&!1===navigator.onLine},this.logger=t.createChild("["+this.causeId+"][Dispatcher]"),this.logger.info("created request, url="+r),!isNaN(this.settings.hedgeDelayMs)&&this.settings.hedgeDelayMs>=500&&this.settings.hedgeDelayMs<=1e4&&(this.hedgeDelayMs=this.settings.hedgeDelayMs),!isNaN(this.settings.hedgeMaxParallelAttempts)&&this.settings.hedgeMaxParallelAttempts>=0&&this.settings.hedgeMaxParallelAttempts<=4&&(this.hedgeMaxParallelAttempts=this.settings.hedgeMaxParallelAttempts),(isNaN(this.settings.perAttemptTimeoutMs)||this.settings.perAttemptTimeoutMs<=0)&&(this.settings.perAttemptTimeoutMs=15e3),(isNaN(this.settings.perRequestTimeoutMs)||this.settings.perRequestTimeoutMs<=0)&&(this.settings.perRequestTimeoutMs=45e3),(isNaN(this.settings.maxRequestAttempts)||this.settings.maxRequestAttempts<=0)&&(this.settings.maxRequestAttempts=4)}return e.prototype.sendRequest=function(){var e=this;return this.stackError=s.default.HTTP_STACK_ERROR.NONE,this.logger.info("send api called"),this.requestTimer=c.TimerFactory.build(function(){e.stackError=s.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT,e.cancelAllAttempts(s.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT)},o.REQUEST_TIMEOUT).start(this.settings.perRequestTimeoutMs),new Promise(function(t,n){e.resolve=t,e.reject=n,e.scheduleNextRequest(!0)})},e.prototype.cancelRequest=function(){this.logger.info("cancelRequest"),this.stackError=s.default.HTTP_STACK_ERROR.REQUEST_ABORTED,this.cancelAllAttempts(s.default.HTTP_STACK_ERROR.ATTEMPT_ABORTED)},e.prototype.cancelOtherAttempts=function(e){this.pendingAttempts.splice(e-1,1),this.cancelAllAttempts(s.default.HTTP_STACK_ERROR.ABORTED_OTHER_ATTEMPT_SUCCESSFUL)},e.prototype.cancelAllAttempts=function(e){this.stopHedgeTimer(),this.stopStandardRetryTimer(),this.pendingAttempts.forEach(function(t){t.status=e,t.cancelDeferred.resolve(),t.timeoutTimer.stop()}),this.stopRequestTimer()},e.prototype.getRequestMethod=function(e){switch(e){case 0:return this.dispatcher.getAsync.bind(this.dispatcher);case 1:return this.dispatcher.postAsync.bind(this.dispatcher);case 2:return this.dispatcher.putAsync.bind(this.dispatcher);case 3:return this.dispatcher.removeAsync.bind(this.dispatcher);default:return null}},e.prototype.queueAttempt=function(e){return i(this,void 0,void 0,function(){var t,n;return r(this,function(i){switch(i.label){case 0:if(t=e&&this.isNotRetryable(e),this.logger.info("queueAttempt"),t||!this.canScheduleNextAttempt())return this.logger.info("unable to retry isNotRetryable "+t+" "+JSON.stringify(e)),this.stopHedgeTimer(),this.stopRequestTimer(),this.hasPendingAttempts()||this.reject(e),[2];if(!this.isAuthFailedStatus(e))return[3,4];this.logger.info("auth failed"),this.stopHedgeTimer(),this.stopStandardRetryTimer(),this.stopRequestTimer(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.authRequiredCallback()];case 2:return n=i.sent(),this.request=n,[3,4];case 3:return i.sent(),this.reject(e),[2];case 4:return this.hedgeTimer?(this.logger.info("scheduleNextRequest ignored as there's already active hedge timer"),[2]):(this.scheduleNextRequest(!1),[2])}})})},e.prototype.attempt=function(){var e=this;if(this.logger.info("attempt to send request"),this.stackError!==s.default.HTTP_STACK_ERROR.REQUEST_ABORTED&&!this.otherAttemptSuccessful){var t=(new Date).getTime();this.requestsSent++;var n=this.requestsSent,i=l.defer();this.request.timeout=i.promise;var r={cancelDeferred:i,status:s.default.HTTP_STACK_ERROR.NONE,timeoutTimer:null,pending:!0},u=c.TimerFactory.build(function(){r.status=s.default.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT,r.cancelDeferred.resolve()},o.ATTEMPT_TIMEOUT).start(this.settings.perAttemptTimeoutMs);r.timeoutTimer=u,this.pendingAttempts.push(r),this.getRequestMethod(this.requestType)(this.url,this.request).then(function(i){if(e.logger.info("attempt successful, request response="+a.safeJsonStringify(i)+" status="+e.getRequestFromStatus(i)),e.otherAttemptSuccessful)throw"Other attempt succesful";if(e.stackError===s.default.HTTP_STACK_ERROR.REQUEST_ABORTED)throw"Session disposed";if(!i)throw"Invalid response";r.pending=!1,e.otherAttemptSuccessful=!0,e.stopRequestTimer(),e.stopHedgeTimer(),e.stopAttemptTimeoutTimer(r),e.cancelOtherAttempts(n),e.resolve({success:!0,request:i.request,response:i.response,attempt:e.requestsSent,attemptStartTimestamp:t,attemptResponseTimestamp:(new Date).getTime()})}).catch(function(n){r.pending=!1,e.stopAttemptTimeoutTimer(r);var i=e.standardizeFailedRequest(n,r);e.logger.info("attempt failed, request: "+a.safeJsonStringify(n)+" status="+i.status),e.onRequestFailed({abandoned:e.otherAttemptSuccessful,success:!1,request:i,attempt:e.requestsSent,attemptStartTimestamp:t,attemptResponseTimestamp:(new Date).getTime()}),e.queueAttempt(i)})}},e.prototype.getNextDelay=function(e){var t;if(e)t=0;else if(this.settings.enableRequestHedging)t=this.hedgeDelayMs;else{if(!(this.requestsSent<=this.settings.retryIntervalsMs.length))throw"Unable to get next delay";t=this.settings.retryIntervalsMs[this.requestsSent-1]}return this.logger.info("next delay= "+t+" ms"),t},e.prototype.isRequestWithStatus=function(e,t){return!!e&&t.indexOf(e.status)>-1},e.prototype.isNotRetryable=function(e){return!this.isRequestWithStatus(e,[s.default.HTTP_STATUS_CODES.UNKNOWN,s.default.HTTP_STATUS_CODES.UNAUTHORIZED,s.default.HTTP_STATUS_CODES.NETWORK_ERROR,s.default.HTTP_STATUS_CODES.OFFLINE,s.default.HTTP_STATUS_CODES.TIMEOUT,s.default.HTTP_STATUS_CODES.INTERNAL_SERVER_ERROR,s.default.HTTP_STATUS_CODES.BAD_GATEWAY,s.default.HTTP_STATUS_CODES.SERVICE_UNAVAILABLE,s.default.HTTP_STATUS_CODES.GATEWAY_TIMEOUT])},e.prototype.isAuthFailedStatus=function(e){return this.isRequestWithStatus(e,[s.default.HTTP_STATUS_CODES.UNAUTHORIZED])},e}();t.RequestDispatcher=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(93),o=n(94),a=n(95),s=n(5),c=n(1),l=n(0),u=function(){function e(e,t,n){var o=this;this.telemetryHelper=n,this.vbssInitiated=!1,this.disposed=!1,this.fsmState=c.default.MEDIA_RENEGOTIATION_FSM_STATE.IDLE,this.fsmStateCauseId="",this.links={},this.renegotiationOffersSeenSoFar=[],this.isOutgoingRenegotiationInProgress=function(){return o.fsmState===c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION||o.fsmState===c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.isIncomingRenegotiationInProgress=function(){return o.fsmState===c.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION||o.fsmState===c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.acceptRenegotiationAsync=function(e,t,n){o.logger.info("["+n+"][acceptRenegotiationAsync][mediaTypes="+t+"]"),o.signalingSession.telemetryHelper.recordEvent(s.EVENTS.ACCEPT_RENEGOTIATION,{mediaTypes:t,causeId:n}),l.assertNotNullOrEmpty(o.links[c.default.LINKS.MEDIA_ANSWER],"MediaAnswer link not set");var r=l.defer();switch(o.fsmState){case c.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,n);break;case c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,n);break;default:return o.logger.info("["+n+"][acceptRenegotiationAsync]there is no incoming media renegotiation offer to accept"),r.reject(new Error("there is no incoming media renegotiation offer to accept")),r.promise}return o.signalingSession.http.sendPostRequest({url:o.links[c.default.LINKS.MEDIA_ANSWER],payload:a.getPayload(o.signalingSession,e,t),requestName:s.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,onceTrouterReady:function(){o.signalingSession.timeoutManager.startTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT,o.handleMediaAnswerAcknowledgmentTimeout.bind(o,n),c.default.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT)},causeId:n}).then(function(e){r.resolve(e.response)}).catch(function(e){var t=l.getErrorForXHRFailure(e);o.logger.info("["+n+"][acceptRenegotiationAsync] error: "+i.getPrintableObject(t)),o.disposed||o.signalingSession.timeoutManager.stopTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),r.reject(new Error("acceptRenegotiationAsync failed because : "+i.getPrintableObject(e)))}),r.promise},this.startRenegotiationAsync=function(e,t,n,a){o.logger.info("["+a+"][startRenegotiationAsync][mediaTypes="+n+"]"),o.signalingSession.telemetryHelper.recordEvent(s.EVENTS.START_RENEGOTIATION,{causeId:a,mediaTypes:n}),l.assertNotNullOrEmpty(t,"MediaRenegotiation link not set");var u=l.defer();switch(o.fsmState){case c.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,a);break;case c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:case c.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:case c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return o.logger.info("["+a+"][startRenegotiationAsync][failed] can only be performed with no current outstanding renegotiations, previous negotiation causeId="+o.fsmStateCauseId),o.signalingSessionCallback.onMediaRenegotiationRejection(o.getGlareError(),a),Promise.resolve(null);default:return o.logger.info("["+a+"][startRenegotiationAsync][failed] can only be performed on an established call"),u.reject(new Error("media renegotiation can only be performed on an established call")),u.promise}var d=n&&l.arrayContains(n,c.default.MEDIA_TYPES.SCREEN_SHARER);return d?(o.vbssInitiated=!0,o.signalingSession.telemetryHelper.addVbssOperations(s.default.VBSS_OPERATION.START)):!d&&o.vbssInitiated&&(o.vbssInitiated=!1,o.signalingSession.telemetryHelper.addVbssOperations(s.default.VBSS_OPERATION.STOP)),o.signalingSession.http.sendPostRequest({url:t,payload:r.getPayload(o.signalingSession,e,n),requestName:s.NETWORK_REQUESTS.START_RENEGOTIATION,onceTrouterReady:function(){o.signalingSession.timeoutManager.startTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER,o.handleMediaAnswerTimeout.bind(o),c.default.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_TIMEOUT)},causeId:a}).then(function(e){u.resolve(e.response)}).catch(function(e){var t=l.getErrorForXHRFailure(e);if(o.logger.info("["+a+"][startRenegotiationAsync] error: "+i.getPrintableObject(t)),!o.disposed){switch(o.fsmState){case c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,a);break;case c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,a)}o.signalingSession.timeoutManager.stopTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER)}u.reject(new Error("startRenegotiationAsync failed because : "+i.getPrintableObject(e)))}),u.promise},this.handleMediaAcknowledgment=function(e,t){o.signalingSession.telemetryHelper.recordEvent(s.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT,{causeId:t}),o.signalingSession.timeoutManager.stopTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),o.signalingSession.saveMediaControllerLinksIfAny(e),o.signalingSession.saveUpdatedCallLinksIfAny(e),o.signalingSessionCallback.onMediaAcknowledgementSuccess(!0,t)},this.onCallConnected=function(e){o.logger.info("onCallConnected"),o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,e)},this.handleMediaNegotiationFailure=function(e){var t=l.extractCauseIdFromMessage(e);o.signalingSession.telemetryHelper.recordIncomingEvent(s.EVENTS.HANDLE_MEDIA_NEGOTIATION_FAILURE,e),o.handleMediaNegotiationFailureInternal(e.body.mediaNegotiationFailure,e.origin,t)},this.handleMediaAnswer=function(e,t){switch(o.logger.info("["+t+"][handleMediaAnswer]"),o.signalingSession.telemetryHelper.recordEvent(s.EVENTS.HANDLE_MEDIA_ANSWER,{causeId:t}),o.fsmState){case c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,t);break;case c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,t);break;default:return}o.signalingSession.timeoutManager.stopTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER);var n=[];e.mediaAnswer.callModalities&&e.mediaAnswer.callModalities.length>0&&(n=l.getMediaTypes(e.mediaAnswer.callModalities),o.signalingSession.telemetryHelper.addIncomingModalities(n));var r={provisional:!1,renegotiation:!0,mediaTypes:n,remoteParticipantId:o.signalingSession.getParticipantIdForOfferAnswer(e.mediaAnswer.mediaContent),mediaContent:e.mediaAnswer.mediaContent};o.signalingSession.http.sendPostRequest({url:e.mediaAnswer.links.mediaAcknowledgement,payload:null,requestName:s.NETWORK_REQUESTS.SEND_MEDIA_ACKNOWLEDGEMENT,causeId:t}).catch(function(e){var n=l.getErrorForXHRFailure(e);o.logger.info("["+t+"][handleMediaAnswer] error: "+i.getPrintableObject(n)),o.signalingSession.disposed||o.signalingSession.telemetryHelper.recordEvent(s.EVENTS.HANDLE_MEDIA_ANSWER_FAILED,{causeId:t})}),o.signalingSessionCallback.onAnswer(r,t)},this.handleMediaNegotiationOffer=function(e){var t=e.body,n=e.headers,i=l.extractCauseIdFromMessage(e);o.logger.info("["+i+"][handleMediaNegotiationOffer]"),o.signalingSession.telemetryHelper.recordIncomingEvent(s.EVENTS.HANDLE_MEDIA_OFFER,e);var r=l.isDuplicateMessage(n,o.renegotiationOffersSeenSoFar);switch(o.fsmState){case c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,i),o.raiseMediaRenegotiationOffer(t,i);break;case c.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,i),o.raiseMediaRenegotiationOffer(t,i);break;default:o.logger.error("["+i+"][handleMediaNegotiationOffer] Cannot handle the incoming mediaRenegotiation offer in present callstate. Either call not connected or renegotiation in progress. isDuplicateOffer="+r),r||o.rejectMediaRenegotiation(t.mediaNegotiation.links.rejection,o.getGlareError(),i)}},this.rejectRenegotiationAsync=function(e,t){o.logger.info("["+t+"][rejectRenegotiationAsync]"),o.signalingSession.telemetryHelper.recordEvent(s.EVENTS.REJECT_RENEGOTIATION,{rejectionData:e,causeId:t}),l.assertNotNullOrEmpty(o.links[c.default.LINKS.MEDIA_REJECTION],"MediaRejection link not set");var n=e||{code:c.default.CALL_END_CODE.NOT_ACCEPTABLE_HERE,subCode:c.default.CALL_END_SUB_CODE.MEDIA_ANSWER_PROCESSING_ERROR,phrase:c.default.CALL_END_PHRASE.MEDIA_ANSWER_ERROR};switch(o.fsmState){case c.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:return o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,t),o.rejectMediaRenegotiation(o.links[c.default.LINKS.MEDIA_REJECTION],n,t);case c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,t),o.rejectMediaRenegotiation(o.links[c.default.LINKS.MEDIA_REJECTION],n,t);default:return o.logger.error("["+t+"][rejectRenegotiationAsync][failed] There is no incoming media renegotiation offer to reject"),Promise.resolve(null)}},this.handleRetargetCompleted=function(e){var t=e.body.retargetCompleted,n=l.extractCauseIdFromMessage(e);o.logger.info("["+n+"][handleRetargetCompleted][details="+i.getPrintableObject(t)+"]"),o.signalingSession.telemetryHelper.recordIncomingEvent(s.EVENTS.HANDLE_RETARGET_COMPLETED,e,i.getPIISafeObject(t)),0===t.code?o.signalingSessionCallback.onReTargetCompletedSuccess(n):o.signalingSessionCallback.onReTargetCompletedFailure(t,n)},this.dispose=function(){o.logger.info("mediaRenegotiationManager :: dispose"),o.disposed=!0},this.getGlareError=function(){return{code:c.default.CALL_END_CODE.GLARE_ERROR,subCode:c.default.CALL_END_SUB_CODE.MEDIA_GLARE_ERROR,phrase:c.default.CALL_END_PHRASE.RENEGOTIATION_IN_PROGRESS,previousNegotiationCauseId:o.fsmStateCauseId}},this.handleMediaNegotiationFailureInternal=function(e,t,n){switch(o.logger.info("["+n+"][handleMediaNegotiationFailureInternal][failureData="+i.getPIISafeObject(e)+"]"),o.signalingSession.timeoutManager.stopTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER),o.fsmState){case c.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,n);break;case c.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:o.setFsmState(c.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,n);break;default:return}o.vbssInitiated&&(o.vbssInitiated=!1,o.signalingSession.telemetryHelper.addVbssOperations(s.default.VBSS_OPERATION.REJECTED)),o.signalingSession.telemetryHelper.addIncomingModalities(["Rejected"]),o.signalingSessionCallback.onMediaRenegotiationRejection({code:e.code,subCode:e.subCode,phrase:e.phrase},n)},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"[RenegotiationManager]["+o.fsmState+"][stateCauseId="+o.fsmStateCauseId+"]"})}return e.prototype.setFsmState=function(e,t){this.fsmState=e,this.fsmStateCauseId=t,this.logger.info("[setFsmState]state="+e),this.telemetryHelper.recordEvent(s.EVENTS.MEDIA_FSM_STATE_CHANGED,{state:e,causeId:t})},e.prototype.raiseMediaRenegotiationOffer=function(e,t){this.logger.info("["+t+"][raiseMediaRenegotiationOffer]"),this.links[c.default.LINKS.MEDIA_ANSWER]=e.mediaNegotiation.links.mediaAnswer,this.links[c.default.LINKS.MEDIA_REJECTION]=e.mediaNegotiation.links.rejection;var n=[];e.mediaNegotiation.callModalities&&e.mediaNegotiation.callModalities.length>0&&(n=l.getMediaTypes(e.mediaNegotiation.callModalities),this.signalingSession.telemetryHelper.addIncomingModalities(n),l.arrayContains(n,c.default.MEDIA_TYPES.SCREEN_SHARER)&&this.signalingSession.telemetryHelper.addVbssOperations(s.default.VBSS_OPERATION.REMOTE_START));var i={mediaTypes:n,remoteParticipantId:this.signalingSession.getParticipantIdForOfferAnswer(e.mediaNegotiation.mediaContent),mediaContent:e.mediaNegotiation.mediaContent,renegotiation:!0};this.signalingSessionCallback.onOffer(i,t)},e.prototype.rejectMediaRenegotiation=function(e,t,n){var r=this;this.logger.info("["+n+"][rejectMediaRenegotiation][rejectionData="+i.getPIISafeObject(t)+"]");var a=l.defer();return this.signalingSession.http.sendPostRequest({url:e,payload:o.getPayload(this.signalingSession,t),requestName:s.NETWORK_REQUESTS.SEND_MEDIA_REJECTION,causeId:n}).then(function(e){a.resolve(e.response)}).catch(function(e){var t=l.getErrorForXHRFailure(e);r.logger.info("["+n+"][rejectMediaRenegotiation] error: "+i.getPrintableObject(t)),a.reject(new Error("rejectMediaRenegotiation failed because : "+i.getPrintableObject(e)))}),a.promise},e.prototype.handleMediaAnswerTimeout=function(e){this.logger.info("["+e+"][handleMediaAnswerTimeout]"),this.vbssInitiated&&(this.vbssInitiated=!1,this.signalingSession.telemetryHelper.addVbssOperations(s.default.VBSS_OPERATION.TIMEOUT)),this.signalingSession.telemetryHelper.addIncomingModalities(["Timeout"]),this.signalingSession.telemetryHelper.recordEvent(s.EVENTS.HANDLE_MEDIA_ANSWER_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER),this.handleMediaNegotiationFailureInternal({code:c.default.CALL_END_CODE.TIMEOUT,subCode:c.default.CALL_END_SUB_CODE.MEDIA_FINAL_ANSWER_TIMEOUT,phrase:c.default.CALL_END_PHRASE.MEDIA_FINAL_ANSWER_TIMEOUT},s.default.EVENT_SOURCE.LOCAL,e)},e.prototype.handleMediaAnswerAcknowledgmentTimeout=function(e){this.logger.info("["+e+"][handleMediaAnswerAcknowledgmentTimeout]"),this.signalingSession.telemetryHelper.recordEvent(s.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(c.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),this.signalingSessionCallback.onMediaAcknowledgementFailure(!0,{reason:"timed out waiting for Media Answer Acknowledgement"},e)},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n){o.assertNotNull(e,"signalingSession cannot be null");var a=[];n&&(a=o.getMediaTypes(n),e.telemetryHelper.addOutgoingModalities(a));var s=o.causeId();return{payload:{mediaNegotiation:{callModalities:a,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAnswer:r.get(e,i.URL_PATH.MEDIA_ANSWER,s),rejection:r.get(e,i.URL_PATH.MEDIA_REJECTION,s)},mediaContent:t}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{mediaNegotiationFailure:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},code:t.code,subCode:t.subCode,phrase:t.phrase},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n){o.assertNotNull(e,"signalingSession cannot be null");var a=[];return n&&(a=o.getMediaTypes(n),e.telemetryHelper.addOutgoingModalities(a)),{payload:{mediaAnswer:{callModalities:a,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAcknowledgement:r.get(e,i.URL_PATH.MEDIA_ACKNOWLEDGEMENT)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId}}}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(3),a=n(97),s=n(32),c=n(98),l=n(99),u=n(100),d=n(101),p=n(102),f=n(103),h=n(104),g=n(105),m=n(106),v=n(107),y=n(108),S=n(109),_=n(5),E=n(1),T=n(0),C=function(){function e(e,t,n){var r=this;this.connectedRemoteParticipantIds={},this.disposed=!1,this.unmuteApprovalLinks={},this.setLocalParticipantId=function(e,t){e&&(r.logger.info("["+t+"][setLocalParticipantId][participantId="+e+"]"),r.localParticipant.participantId=e)},this.admitParticipantAsync=function(e,t,n){var i="["+n+"][admitParticipantAsync]";r.logger.info(""+i+r.piiUtils.scrubMriOrOmit(e.id));var o=T.defer();return r.connectedRemoteParticipantIds.hasOwnProperty(e.id)?r.participantOperationHandler.hasPendingOperation(1,e.id,n)?(r.logger.info(i+"there is an existing pending request to admit the participant "+r.piiUtils.scrubMriOrOmit(e.id)),o.reject(new Error("there is an existing pending request to admit the participant"))):(r.participantOperationHandler.setPendingOperation(1,e.id,{participant:e,promise:o,causeId:n},n),r.sendNetworkRequestForAdmittingParticipant(e,t,n)):(r.logger.info(i+"unable to admit a participant that is not found in roster "+r.piiUtils.scrubMriOrOmit(e.id)),o.reject(new Error("the given participant is not found in roster"))),o.promise},this.addParticipantsAsync=function(e,t,n,i,o){var a="["+o+"][addParticipantsAsync]",s=e.map(function(e){return r.piiUtils.scrubMriOrOmit(e.id)});r.logger.info(a+" remoteParticipantsIds: "+s);var c=[],l=[];if(e.forEach(function(e){var t=T.defer();r.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(r.logger.info(a+"the given participant is already connected to the call "+r.piiUtils.scrubMriOrOmit(e.id)),t.reject(new Error("the given participant is already connected to the call"))):r.participantOperationHandler.hasPendingOperation(0,e.id,o)?(r.logger.info(a+"there is an existing pending request to add the participant "+r.piiUtils.scrubMriOrOmit(e.id)),t.reject(new Error("there is an existing pending request to add the participant"))):(e.participantId||(e.participantId=T.newGuid(),r.logger.info("participantId created "+e.participantId)),r.participantOperationHandler.setPendingOperation(0,e.id,{participant:e,promise:t,causeId:o},o),c.push(e)),l.push(t.promise)}),n)if(3===i.replacementType)for(var u=0,d=c;u<d.length;u++){var p=d[u];r.sendNetworkRequestForAddingParticipant([p],t,i,o)}else r.sendNetworkRequestForAddingParticipant(c,t,i,o);return l},this.nudgeParticipantsAsync=function(e,t,n,i,o,a,s){return r.logger.info("["+i+"][nudgeParticipantAsync] "+r.piiUtils.scrubParticipantsList(e)),n?r.sendNetworkRequestForNudgingParticipants(e,t,i,o,a,s):Promise.reject("["+i+"][nudgeParticipantAsync] Call not started")},this.updateMeetingRolesAsync=function(e,t,n,a){void 0===a&&(a=T.causeId());var s=T.defer();if(!e||e.length<1){var c="["+a+"][updateMeetingRolesAsync] participantsInfo cannot be empty or null";(u=new Error(c)).endCode={code:E.default.CALL_END_CODE.REJECT,subCode:E.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:c},r.logger.info(c),s.reject(u)}else if(t)if(n){var l;"attendee"===t?l=_.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_ATTENDEE:"presenter"===t?l=_.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_PRESENTER:"organizer"===t?l=_.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_ORGANIZER:s.reject(new Error("["+a+"] Invalid meetingRole value("+t+")")),r.logger.info("["+a+"][updateMeetingRolesAsync][meetingRole="+t+"]"),r.signalingSession.ensureMessageChannelReady(l).then(function(){r.sendNetworkRequestForUpdatingMeetingRoles(e,t,n,l,a,s)}).catch(function(e){var t=o.getPrintableObject(e);r.logger.info("["+a+"][updateMeetingRolesAsync][failed][reason="+t+"]");var n=T.getErrorForXHRFailure(e),c=i({},n.error);s.reject(c)})}else c="["+a+"][updateMeetingRolesAsync] updateMeetingRoleUrl cannot be empty or null",(u=new Error(c)).endCode={code:E.default.CALL_END_CODE.REJECT,subCode:E.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:c},r.logger.info(c),s.reject(u);else{var u;c="["+a+"][updateMeetingRolesAsync] meetingRole cannot be empty or null",(u=new Error(c)).endCode={code:E.default.CALL_END_CODE.REJECT,subCode:E.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:c},r.logger.info(c),s.reject(u)}return s.promise},this.callMeBackAsync=function(e,t,n){r.logger.info("["+n+"][callMeBackAsync] "+r.piiUtils.scrubMriOrOmit(e.id));var i=T.defer();return r.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(r.logger.info("the given participant is already connected to the call : "+e.id),i.reject(new Error("the given participant is already connected to the call"))):r.participantOperationHandler.hasPendingOperation(2,e.id,n)?(r.logger.info("there is an existing pending request to call back the participant : "+e.id),i.reject(new Error("there is an existing pending request to call back the participant"))):(r.participantOperationHandler.setPendingOperation(2,e.id,{participant:e,promise:i},n),r.sendNetworkRequestForCallMeBack(e,t,n)),i.promise},this.isRosterStale=function(e,t){return r.rosterManager.isRosterStale(e,t)},this.removeParticipantAsync=function(e,t,n){r.logger.info("["+n+"][removeParticipantAsync] "+r.piiUtils.scrubMriOrOmit(e.id)),T.assertNotNullOrEmpty(t,"correct removeParticipantUrl is not provided");var i=T.defer();return r.participantOperationHandler.hasPendingOperation(3,e.id,n)?(r.logger.info("there is an existing pending request to remove the participant "+r.piiUtils.scrubMriOrOmit(e.id)),i.reject(new Error("there is an existing pending request to remove the participant"))):(r.participantOperationHandler.setPendingOperation(3,e.id,{participant:e,promise:i},n),r.signalingSession.http.sendPostRequest({url:t,payload:m.getPayload(r.signalingSession,e),requestName:_.NETWORK_REQUESTS.REMOVE_PARTICIPANT_NONE,onceTrouterReady:function(){r.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,function(){r.signalingSession.telemetryHelper.recordEvent(_.EVENTS.REMOVE_PARTICIPANT_TIMEOUT),r.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.id),r.participantOperationHandler.rejectPendingOperation(3,e.id,"timed out waiting for participant to not show up in roster",{code:E.default.CALL_END_CODE.TIMEOUT,subCode:E.default.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:E.default.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT},n)},E.default.TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT,e.id)},causeId:n}).catch(function(t){var i=T.getErrorForXHRFailure(t);r.logger.info("["+n+"][removeParticipantAsync][failed][reason="+o.getPrintableObject(i)+"]"),r.disposed||(r.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.id),r.participantOperationHandler.rejectPendingOperation(3,e.id,t,i.error,n))})),i.promise},this.removeParticipantEndpointAsync=function(e,t,n,i){r.logger.info("["+i+"][removeParticipantEndpointAsync] "+o.truncate(e.endpointId,8)+" [endPointScope] "+n),T.assertNotNullOrEmpty(t,"correct removeParticipantUrl is not provided");var a=T.defer(),s="";switch(n){case"all":s=_.NETWORK_REQUESTS.REMOVE_PARTICIPANT_OTHERS;break;case"specified":s=_.NETWORK_REQUESTS.REMOVE_PARTICIPANT_SPECIFIED;break;default:return Promise.reject("invalid scope "+n+" removeParticipantEndpointAsync")}return r.participantOperationHandler.setPendingOperation(4,e.endpointId,{participant:e,promise:a,scope:n},i),r.signalingSession.http.sendPostRequest({url:t,payload:g.getPayload(r.signalingSession,e,n),requestName:s,onceTrouterReady:function(){r.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,function(){r.signalingSession.telemetryHelper.recordEvent(_.EVENTS.REMOVE_PARTICIPANT_TIMEOUT),r.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.endpointId),r.participantOperationHandler.rejectPendingOperation(4,e.endpointId,"timed out waiting for participant endpoint sync response from service",{code:E.default.CALL_END_CODE.TIMEOUT,subCode:E.default.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:E.default.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT},i)},E.default.TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT,e.endpointId)},causeId:i}).then(function(e){if(e.response&&e.response.code)if(-1!==[E.default.HTTP_STATUS_CODES.OK,E.default.HTTP_STATUS_CODES.CREATED].indexOf(e.response.code))r.logger.info("["+i+"][removeParticipantEndpointAsync][endPointScope] "+n+" [passed][reason="+o.getPrintableObject(e.response)+"]"),a.resolve(e.response);else{var t=new Error("invalid service response for removeParticipantEndpoint");t.endCode={code:e.response.code,subCode:e.response.subcode,phrase:e.response.reason},r.logger.info("["+i+"][removeParticipantEndpointAsync][endPointScope] "+n+" [failed][reason="+o.getPrintableObject(e.response)+"]"),a.reject(t)}a.resolve()}).catch(function(t){var a=T.getErrorForXHRFailure(t);r.logger.info("["+i+"][removeParticipantEndpointAsync][endPointScope] "+n+" [failed][reason="+o.getPrintableObject(a)+"]"),r.disposed||(r.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.endpointId),r.participantOperationHandler.rejectPendingOperation(4,e.endpointId,o.getPrintableObject(t),a.error,i))}),a.promise},this.getParticipantsToInitiateCallWith=function(){r.logger.info("getParticipantsToInitiateCallWith");for(var e=[],t=r.participantOperationHandler.getAllPendingOperations(0,T.causeId()),n=0,i=Object.keys(t);n<i.length;n++){var o=i[n];t.hasOwnProperty(o)&&t[o]&&e.push(t[o].participant)}return e},this.initializeForIncomingCall=function(e){r.logger.info("initializeForIncomingCall"),r.participantOperationHandler.dispose("incoming calls cannot add/remove participants until call is connected",null,T.causeId())},this.handleAddParticipantSuccess=function(e){var t=e.body,n=T.extractCauseIdFromMessage(e);r.logger.info("["+n+"][handleAddParticipantSuccess("+(t.participantInfos?"new format":"old format")+")]"+o.getPrintableObject(t)+"]"),r.signalingSession.telemetryHelper.recordIncomingEvent(_.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS,e),r.internalHandleCallMeBackSuccess(t,n)||r.signalingSession.telemetryHelper.recordEvent(_.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS)},this.handleAddParticipantFailure=function(e){var t=e.body,n=T.extractCauseIdFromMessage(e);r.logger.info("["+n+"][handleAddParticipantFailure("+(t.participantInfos?"new format":"old format")+")]["+o.getPrintableObject(t)+"]"),t.modalityFailure?(r.logger.info("["+n+"][handleAddParticipantFailure][modalityFailure="+o.getPrintableObject(t)+"]"),r.signalingSession.telemetryHelper.recordIncomingEvent(_.EVENTS.HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE,e)):r.internalHandleAddParticipantFailure(e,n)},this.handleAdmitParticipantSuccess=function(e){var t=e.body,n=T.extractCauseIdFromMessage(e);r.logger.info("["+n+"][handleAdmitParticipantSuccess]["+o.getPrintableObject(t)+"]"),r.signalingSession.telemetryHelper.recordIncomingEvent(_.EVENTS.HANDLE_ADMIT_PARTICIPANT_SUCCESS,e),t.participants&&r.internalHandleAdmitParticipantSuccess(e,n)},this.handleAdmitParticipantFailure=function(e){var t=e.body,n=T.extractCauseIdFromMessage(e);r.logger.info("["+n+"][handleAdmitParticipantFailure]["+o.getPrintableObject(t)+"]"),t.participants&&r.internalHandleAdmitParticipantFailure(e,n)},this.handleRemoveParticipantFailure=function(e){var t=e.body,n=T.extractCauseIdFromMessage(e);r.logger.info("["+n+"][handleRemoveParticipantFailure]["+o.getPrintableObject(t)+"]"),r.signalingSession.telemetryHelper.recordIncomingEvent(_.EVENTS.HANDLE_REMOVE_PARTICIPANT_FAILURE,e);for(var i=0,a=Object.keys(t.participants);i<a.length;i++){var s=a[i];t.participants.hasOwnProperty(s)&&r.internalHandleRemoveParticipantFailure(s,t.participants[s],n)}},this.handleRemoveParticipantSuccess=function(e){var t=e.body,n=T.extractCauseIdFromMessage(e);r.logger.info("["+n+"][handleRemoveParticipantSuccess]["+o.getPrintableObject(t)+"]"),r.signalingSession.telemetryHelper.recordIncomingEvent(_.EVENTS.HANDLE_REMOVE_PARTICIPANT_SUCCESS,e)},this.handleUnmuteConfirmRequest=function(e){var t=e.body,n=T.extractCauseIdFromMessage(e);r.logger.info("["+n+"][handleUnmuteConfirmRequest]["+o.getPrintableObject(t)+"]"),r.signalingSession.telemetryHelper.recordIncomingEvent(_.EVENTS.HANDLE_UNMUTE_CONFIRM,e),r.unmuteApprovalLinks[t.from.id]={approve:t.links.approveUnmute,reject:t.links.rejectUnmute},r.signalingSessionCallback.onUnmuteRequested(t.from.id,n)},this.approveUnmuteRequestAsync=function(e,t){r.logger.info("["+t+"][approveUnmuteRequestAsync]");var n=T.defer();return r.unmuteApprovalLinks.hasOwnProperty(e)?(r.signalingSession.ensureMessageChannelReady(_.NETWORK_REQUESTS.APPROVE_UNMUTE).then(function(){r.muteUnmute(_.NETWORK_REQUESTS.APPROVE_UNMUTE,u.getPayload(r.signalingSession),n,r.unmuteApprovalLinks[e].approve,t)}).catch(function(e){var i=o.getPrintableObject(e);r.logger.info("["+t+"][approveUnmuteRequestAsync][failed][reason="+i+"]"),n.reject(new Error(e))}),n.promise):(n.reject(new Error("no unmute links found for given participant")),n.promise)},this.rejectUnmuteRequestAsync=function(e,t,n){r.logger.info("["+t+"][rejectUnmuteRequestAsync]");var i=T.defer();if(!r.unmuteApprovalLinks.hasOwnProperty(e))return i.reject(new Error("no unmute links found for given participant")),i.promise;var a=n||{code:E.default.CALL_END_CODE.REJECT,subCode:E.default.CALL_END_SUB_CODE.UNMUTE_REQUEST_REJECTED,phrase:E.default.CALL_END_PHRASE.UNMUTE_REQUEST_REJECTED};return r.signalingSession.ensureMessageChannelReady(_.NETWORK_REQUESTS.REJECT_UNMUTE).then(function(){r.muteUnmute(_.NETWORK_REQUESTS.REJECT_UNMUTE,h.getPayload(r.signalingSession,a),i,r.unmuteApprovalLinks[e].reject,t)}).catch(function(e){var n=o.getPrintableObject(e);r.logger.info("["+t+"][rejectUnmuteRequestAsync][failed][reason="+n+"]"),i.reject(new Error(e))}),i.promise},this.handleRosterUpdate=function(e,t,n){var i=r.getCurrentParticipantsInCallModality(!1);r.rosterManager.handleRosterUpdate(e,i,t,n)},this.updateLocalParticipantFromSubscribe=function(e,t){r.localParticipant.fromRoster||r.rosterManager.updateLocalParticipantFromSubscribe(e,t)},this.muteAsync=function(e,t,n,i){r.logger.info("["+i+"][muteAsync][muteScope="+t+"]");var a="specified",s=[],c=_.NETWORK_REQUESTS.MUTE_SPECIFIED;switch(t){case E.default.MUTE_SCOPE.MYSELF:c=_.NETWORK_REQUESTS.MUTE_MYSELF,s.push({id:r.localParticipant.id});break;case E.default.MUTE_SCOPE.EVERYONE_ELSE:c=r.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?_.NETWORK_REQUESTS.MUTE_ALL_SYNC:_.NETWORK_REQUESTS.MUTE_ALL,a="all",n.forEach(function(e){s.push({id:e})});break;case E.default.MUTE_SCOPE.SPECIFIED_PARTICIPANTS:T.assertNotNullOrEmpty(n,"["+i+"]array of participantIds must be specified for SPECIFIED_PARTICIPANTS mute scope"),c=r.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?_.NETWORK_REQUESTS.MUTE_SPECIFIED_SYNC:_.NETWORK_REQUESTS.MUTE_SPECIFIED,n.forEach(function(e){s.push({id:e})});break;default:T.assert(!1,"["+i+"]muteScope is a required param. please pass in a valid value.")}var l=T.defer();if(t===E.default.MUTE_SCOPE.SPECIFIED_PARTICIPANTS){var u=r.areParticipantsConnectedToCall(n);if(!u.result)return l.reject(new Error("["+i+"]specified participant is not connected to call yet. Id = "+u.participant)),l.promise}return r.signalingSession.ensureMessageChannelReady(c).then(function(){return r.muteUnmute(c,d.getPayload(r.signalingSession,a,s),l,e,i)}).catch(function(e){var t=o.getPrintableObject(e),n=T.getErrorForXHRFailure(e);r.logger.info("["+i+"][muteAsync][failed][reason="+t+"]"),l.reject(n)}),l.promise},this.unmuteAsync=function(e,t){r.logger.info("["+t+"][unmuteAsync]");var n=T.defer();return r.signalingSession.ensureMessageChannelReady(_.NETWORK_REQUESTS.UNMUTE).then(function(){r.muteUnmute(r.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?_.NETWORK_REQUESTS.UNMUTE_SYNC:_.NETWORK_REQUESTS.UNMUTE,v.getPayload(r.signalingSession),n,e,t,!0)}).catch(function(e){var i=o.getPrintableObject(e);r.logger.info("["+t+"][unmuteAsync][failed][reason="+i+"]"),n.reject(new Error(e))}),n.promise},this.dispose=function(e,t){r.logger.info("["+t+"][dispose]"),r.disposed=!0,r.participantOperationHandler.dispose("call ended",e,t),r.signalingSession.telemetryHelper.setParticipantId(r.localParticipant.participantId)},this.internalHandleCallMeBackSuccess=function(e,t){var n=!1;if(e&&e.participantInfos)for(var i=0,o=e.participantInfos;i<o.length;i++){var a=o[i].id;r.internalHandleCallMeBackSuccessHelper(a,t)&&(n=!0)}else if(e&&e.participants)for(var s=0,c=e.participants;s<c.length;s++)a=c[s],r.internalHandleCallMeBackSuccessHelper(a,t)&&(n=!0);return n},this.signalingSession=e,this.signalingSessionCallback=t,this.localParticipant=n,this.localParticipant.endpointId||(this.localParticipant.endpointId=this.signalingSession.getEndpointId());var s=o.truncate(this.localParticipant.endpointId,8);this.logger=e.logger.createChild(function(){return"[PM]["+s+"]"}),this.piiUtils=e.piiUtils,this.participantOperationHandler=new a.default(e.logger.createChild(function(){return"[ParticipantOperationHandler]["+s+"]"})),this.rosterManager=new S.default(this,e.logger.createChild(function(){return"[RosterManager]["+s+"]"})),this.localParticipant.participantId||(this.localParticipant.participantId=T.newGuid()),"string"==typeof e.signalingAgentConfig.languageCode?this.localParticipant.languageId=e.signalingAgentConfig.languageCode:"function"==typeof e.signalingAgentConfig.languageCode&&(this.localParticipant.languageId=e.signalingAgentConfig.languageCode()),e.telemetryHelper.setEndPointId(this.localParticipant.endpointId)}return e.prototype.areParticipantsConnectedToCall=function(e){this.logger.info("areParticipantsConnectedToCall : "+o.getPrintableObject(e));for(var t=this.getCurrentParticipantsInCallModality(!0),n=0,i=e;n<i.length;n++){var r=i[n];if(!t.hasOwnProperty(r))return this.logger.info("areParticipantsConnectedToCall : returning false for :"+r),{result:!1,participant:r}}return this.logger.info("areParticipantsConnectedToCall : returning true"),{result:!0}},e.prototype.processUnmuteInfo=function(e){var t=this;if(void 0!==e&&void 0!==e.muteUnmuteResponse){var n=e.muteUnmuteResponse[this.localParticipant.id];if(void 0!==n){var i=r.find(n,function(e){return e.participantId===t.localParticipant.participantId});void 0!==i&&("success"===i.reason?this.signalingSession.telemetryHelper.recordEvent(_.EVENTS.HANDLE_UNMUTE_SUCCESS,i.serverMuteVersion):this.signalingSession.telemetryHelper.recordEvent(_.EVENTS.HANDLE_UNMUTE_FAILURE,i.serverMuteVersion))}}},e.prototype.muteUnmute=function(e,t,n,i,r,a){var s=this;this.logger.info("[muteUnmute]["+r+"][operation="+e+"]"),i?(a&&this.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.UNMUTE,function(){s.signalingSession.telemetryHelper.recordEvent(_.EVENTS.UNMUTE_TIMEOUT),s.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.UNMUTE);var e=new Error("timed out waiting for response to request");e.endCode={code:E.default.CALL_END_CODE.TIMEOUT,subCode:E.default.CALL_END_SUB_CODE.UNMUTE_REQUEST_TIMEOUT,phrase:E.default.CALL_END_PHRASE.UNMUTE_REQUEST_TIMEOUT},n.reject(e)},E.default.TIMEOUT_VALUES_IN_SECONDS.UNMUTE_TIMEOUT),this.signalingSession.http.sendPostRequest({url:i,payload:t,requestName:e,withoutTrouter:!0,causeId:r}).then(function(t){s.disposed||(e===_.NETWORK_REQUESTS.UNMUTE&&t.response&&s.processUnmuteInfo(t.response),s.signalingSession.isHandleUnmuteMuteFromResponseEnabled()&&(e===_.NETWORK_REQUESTS.UNMUTE_SYNC&&t.response&&n.resolve(t.response),e!==_.NETWORK_REQUESTS.MUTE_ALL_SYNC&&e!==_.NETWORK_REQUESTS.MUTE_SPECIFIED_SYNC||!t.response||n.resolve(t.response)),n.resolve())}).catch(function(e){var t=T.getErrorForXHRFailure(e);s.logger.info("["+r+"][muteUnmute][failed][reason="+o.getPrintableObject(t)+"]"),s.disposed||(a&&s.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.UNMUTE),n.reject(t.error))})):n.reject(new Error("["+r+"][muteUnmute] cannot be performed now, the link is not yet available"))},e.prototype.sendNetworkRequestForUpdatingMeetingRoles=function(e,t,n,i,r,a){var s,c=this;if(!n){var l="["+r+"][sendNetworkRequestForUpdatingMeetingRoles] failed because correct updateMeetingRoleUrl is not provided";(s=new Error(l)).endCode={code:E.default.CALL_END_CODE.REJECT,subCode:E.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:l},this.logger.info(l),a.reject()}e||(l="["+r+"][sendNetworkRequestForUpdatingMeetingRoles] failed because participants list is empty or null",(s=new Error(l)).endCode={code:E.default.CALL_END_CODE.REJECT,subCode:E.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:l},this.logger.info(l),a.reject(s)),this.signalingSession.http.sendPostRequest({url:n,payload:y.getPayload(this.signalingSession,e,"specified",t),requestName:i,onceTrouterReady:function(){c.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE,function(){c.signalingSession.telemetryHelper.recordEvent(_.EVENTS.UPDATE_MEETING_ROLE,{causeId:r}),c.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE);var e=new Error("["+r+"] Timed out waiting for response to request");e.endCode={code:E.default.CALL_END_CODE.TIMEOUT,subCode:E.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_TIMEOUT,phrase:E.default.CALL_END_PHRASE.UPDATE_MEETING_ROLE_TIMEOUT},a.reject(e)},E.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_MEETING_ROLE_TIMEOUT)},causeId:r}).then(function(e){a.resolve(e.response)}).catch(function(e){var t=o.getPrintableObject(e);c.logger.info("["+r+"][sendNetworkRequestForUpdatingMeetingRoles] failed: "+t);var n=new Error("["+r+"][CS response] Forbidden request"),i=T.getErrorForXHRFailure(e);n.code=i.error.code,n.subCode=i.error.subCode,n.phrase=i.error.phrase,c.disposed||(c.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE),a.reject(n))})},e.prototype.sendNetworkRequestForNudgingParticipants=function(e,t,n,i,r,a){var s=this;if(t){var c=r?p.getPayload(this.signalingSession,e,r,a,i):f.getPayload(this.signalingSession,e,i);return this.signalingSession.http.sendPostRequest({url:t,payload:c,requestName:_.NETWORK_REQUESTS.NUDGE_PARTICIPANT,onceTrouterReady:function(){s.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,function(){s.signalingSession.telemetryHelper.recordEvent(_.EVENTS.NUDGE_PARTICIPANT_TIMEOUT),s.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,e?e.join():"")},E.default.TIMEOUT_VALUES_IN_SECONDS.NUDGE_PARTICIPANT_TIMEOUT,e?e.join():"")},causeId:n}).then(function(){}).catch(function(t){var i=T.getErrorForXHRFailure(t);return s.logger.info("["+n+"][sendNetworkRequestForNudgingParticipant][failed][reason="+o.getPrintableObject(i)+"]"),s.disposed||s.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,e?e.join():""),Promise.reject(i.error)})}return this.logger.info("["+n+"][sendNetworkRequestForNudgingParticipant] failed because correct nudgeParticipantUrl is not provided"),Promise.reject("Missing nudgeParticipant url")},e.prototype.sendNetworkRequestForAddingParticipant=function(e,t,n,i){var r=this;if(void 0===i&&(i=T.causeId()),t){var a=_.NETWORK_REQUESTS.ADD_PARTICIPANT,l=_.EVENTS.ADD_PARTICIPANT_TIMEOUT,u={};switch(n.replacementType){case 2:a=_.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_PICKUP_CODE,l=_.EVENTS.ADD_PARTICIPANT_WITH_PICKUP_CODE_TIMEOUT,u.unparkContent={pickupCode:n.pickupCode};break;case 1:a=_.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_REPLACES,l=_.EVENTS.ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT,u=this.signalingSession.getCallReplacementDetailsForCall(n.callIdToReplace,i);break;case 3:a=_.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_REPLACES,l=_.EVENTS.ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT,u=this.signalingSession.getParticipantReplacementDetailsForCall(n.callIdToReplace,e[0].id,e[0].participantId,i);break;default:a=_.NETWORK_REQUESTS.ADD_PARTICIPANT,l=_.EVENTS.ADD_PARTICIPANT_TIMEOUT,u=null}var d=n.threadId?s.getPayload(this.signalingSession,e,n,u):c.getPayload(this.signalingSession,e,n,u);this.signalingSession.http.sendPostRequest({url:t,payload:d,requestName:a,onceTrouterReady:function(){e.forEach(function(e){r.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,function(){r.signalingSession.telemetryHelper.recordEvent(l,{causeId:i}),r.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e.id),r.participantOperationHandler.rejectPendingOperation(0,e.id,"timed out waiting for participant to show up in roster",{code:E.default.CALL_END_CODE.TIMEOUT,subCode:E.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:E.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},i)},E.default.TIMEOUT_VALUES_IN_SECONDS.ADD_PARTICIPANT_TIMEOUT,e.id)})},causeId:i}).catch(function(t){var n=T.getErrorForXHRFailure(t);r.logger.info("["+i+"][sendNetworkRequestForAddingParticipant] failed:"+o.getPrintableObject(t)),r.disposed||e.forEach(function(e){r.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e.id),r.participantOperationHandler.rejectPendingOperation(0,e.id,t,n.error,i)})})}else this.logger.info("["+i+"][sendNetworkRequestForAddingParticipants] failed because correct addParticipantUrl is not provided"),e.forEach(function(e){r.participantOperationHandler.rejectPendingOperation(0,e.id,"correct addParticipantUrl is not provided",{code:E.default.CALL_END_CODE.LOCAL_ERROR,subCode:E.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:E.default.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING},i)})},e.prototype.sendNetworkRequestForCallMeBack=function(e,t,n){var i=this;if(t){var r={threadId:this.signalingSession.threadId,messageId:this.signalingSession.teamsMessageId};this.signalingSession.http.sendPostRequest({url:t,payload:s.getPayload(this.signalingSession,[e],r),requestName:_.NETWORK_REQUESTS.CALL_ME_BACK,onceTrouterReady:function(){i.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,function(){i.signalingSession.telemetryHelper.recordEvent(_.EVENTS.CALL_ME_BACK_TIMEOUT,{causeId:n}),i.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,e.id),i.participantOperationHandler.rejectPendingOperation(2,e.id,"timed out waiting for call me back success response",{code:E.default.CALL_END_CODE.TIMEOUT,subCode:E.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:E.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},n)},E.default.TIMEOUT_VALUES_IN_SECONDS.CALL_ME_BACK_TIMEOUT,e.id)},causeId:n}).catch(function(t){var r=T.getErrorForXHRFailure(t);i.logger.info("["+n+"][sendNetworkRequestForCallMeBack] failed: "+o.getPrintableObject(r)),i.disposed||(i.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,e.id),i.participantOperationHandler.rejectPendingOperation(2,e.id,t,r.error,n))})}else this.logger.info("["+n+"][sendNetworkRequestForCallMeBack] failed because correct addParticipantUrl is not provided"),this.participantOperationHandler.rejectPendingOperation(2,e.id,"correct addParticipantUrl is not provided",{code:E.default.CALL_END_CODE.LOCAL_ERROR,subCode:E.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:E.default.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING},n)},e.prototype.sendNetworkRequestForAdmittingParticipant=function(e,t,n){var i=this;t?this.signalingSession.http.sendPostRequest({url:t,payload:l.getPayload(this.signalingSession,e),requestName:_.NETWORK_REQUESTS.ADMIT_PARTICIPANT,onceTrouterReady:function(){i.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,function(){i.signalingSession.telemetryHelper.recordEvent(_.EVENTS.ADMIT_PARTICIPANT_TIMEOUT),i.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),i.participantOperationHandler.rejectPendingOperation(1,e.id,"timed out waiting for participant to show up in roster",{code:E.default.CALL_END_CODE.TIMEOUT,subCode:E.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:E.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},n)},E.default.TIMEOUT_VALUES_IN_SECONDS.ADMIT_PARTICIPANT_TIMEOUT,e.id)},causeId:n}).catch(function(t){var r=T.getErrorForXHRFailure(t);i.logger.info("["+n+"][sendNetworkRequestForAdmittingParticipant][failed][reason="+o.getPrintableObject(r)+"]"),i.disposed||(i.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),i.participantOperationHandler.rejectPendingOperation(1,e.id,t,r.error,n))}):(this.logger.info("["+n+"][sendNetworkRequestForAdmittingParticipant] failed because correct admitParticipantUrl is not provided"),this.participantOperationHandler.rejectPendingOperation(1,e.id,"correct admitParticipantUrl is not provided",{code:E.default.CALL_END_CODE.LOCAL_ERROR,subCode:E.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:E.default.CALL_END_PHRASE.ADMIT_PARTICIPANT_URL_MISSING},n))},e.prototype.getCurrentParticipantsInCallModality=function(e){var t={},n=[E.default.PARTICIPANT_AUDIO_STATE.CONNECTED];return e||n.push(E.default.PARTICIPANT_AUDIO_STATE.CONNECTING,E.default.PARTICIPANT_AUDIO_STATE.RINGING),this.signalingSessionCallback.getRemoteParticipantCollection().forEach(function(e){n.some(function(t){return t===e.audioState})&&(t[e.mri]=!0)}),t},e.prototype.internalHandleRemoveParticipantFailure=function(e,t,n){if(this.participantOperationHandler.hasPendingOperation(3,e,n)){this.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e),this.logger.info("["+n+"][internalHandleRemoveParticipantFailure] failed for "+this.piiUtils.scrubMriOrOmit(e)+" reason "+o.getPrintableObject(t));var i=this.getCallEndGivenParticipantFailure(t);this.participantOperationHandler.rejectPendingOperation(3,e,i.phrase,i,n)}},e.prototype.internalHandleCallMeBackSuccessHelper=function(e,t){if(this.participantOperationHandler.hasPendingOperation(2,e,t)){var n={id:e};return this.logger.info("participant : "+e+" was successfully added. Resolving CallMeBack request"),this.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,e),this.participantOperationHandler.resolvePendingOperation(2,n.id,n,t),!0}return!1},e.prototype.internalHandleAddParticipantFailure=function(e,t){var n=this;void 0===t&&(t=T.causeId());var i=e.body;if(i.participantInfos)i.participantInfos.forEach(function(i){var r=[i.participant.participantId],o=n.participantOperationHandler.getRnlMri(r,t)||i.participant.id;n.rejectAddParticipantFailure(o,i.transactionEnd,e,t)});else if(i.participants)for(var r=0,o=Object.keys(i.participants);r<o.length;r++){var a=o[r];this.rejectAddParticipantFailure(a,i.participants[a],e,t)}},e.prototype.rejectAddParticipantFailure=function(e,t,n,i){var r=this.getCallEndGivenParticipantFailure(t);this.signalingSession.telemetryHelper.recordIncomingEvent(_.EVENTS.HANDLE_ADD_PARTICIPANT_FAILURE,n,r),this.participantOperationHandler.hasPendingOperation(0,e,i)?(this.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e),this.logger.info("participantAdd failed for : "+e+" reason : "+o.getPrintableObject(t)),this.participantOperationHandler.rejectPendingOperation(0,e,r.phrase,r,i)):this.participantOperationHandler.hasPendingOperation(2,e,i)&&(this.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,e),this.logger.info("callMeBack failed for : "+e+" reason : "+o.getPrintableObject(t)),this.participantOperationHandler.rejectPendingOperation(2,e,r.phrase,r,i))},e.prototype.internalHandleAdmitParticipantSuccess=function(e,t){for(var n=0,i=e.body.participants;n<i.length;n++){var r=i[n];this.participantOperationHandler.hasPendingOperation(1,r,t)&&(this.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,r),this.logger.info("Admit participant success for : "+this.piiUtils.scrubMriOrOmit(r)),this.participantOperationHandler.resolvePendingOperation(1,r,void 0,t))}},e.prototype.internalHandleAdmitParticipantFailure=function(e,t){for(var n=e.body,i=0,r=Object.keys(n.participants);i<r.length;i++){var a=r[i];if(this.participantOperationHandler.hasPendingOperation(1,a,t)){this.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,a);var s=n.participants[a];this.logger.info("Admit participant failed for : "+a+" reason : "+o.getPrintableObject(s));var c=this.getCallEndGivenParticipantFailure(s);this.signalingSession.telemetryHelper.recordIncomingEvent(_.EVENTS.HANDLE_ADMIT_PARTICIPANT_FAILURE,e,c),this.participantOperationHandler.rejectPendingOperation(1,a,c.phrase,c,t)}}},e.prototype.getCallEndGivenParticipantFailure=function(e){var t={code:e.code,subCode:e.subCode,phrase:e.phrase,resultCategories:e.resultCategories};return e.code===E.default.CALL_END_CODE.CALL_MODALITY_FAILURE&&e.callControllerTransactionEnd?t=i({},e.callControllerTransactionEnd):e.code===E.default.CALL_END_CODE.ATC_CONTROLLER_FAILURE&&e.atcControllerTransactionEnd&&(t=i({},e.atcControllerTransactionEnd)),t},e}();t.default=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function e(){this.requests={}}return e.prototype.clear=function(e,t){var n=this,r=t||{code:i.default.CALL_END_CODE.SUCCESS,subCode:i.default.CALL_END_SUB_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.requests).forEach(function(t){n.rejectOperation(t,e,r)})},e.prototype.hasOperation=function(e){return this.requests.hasOwnProperty(e)},e.prototype.getAllOperations=function(){return this.requests},e.prototype.getOperation=function(e){return this.hasOperation(e)?this.requests[e]:null},e.prototype.setOperation=function(e,t){return!this.hasOperation(e)&&(this.requests[e]=t,!0)},e.prototype.rejectOperation=function(e,t,n){var i=new Error(t);if(n&&(i.endCode=n),this.hasOperation(e)){var r=this.requests[e].promise;delete this.requests[e],r.reject(i)}},e.prototype.resolveOperation=function(e,t){if(this.hasOperation(e)){var n=this.requests[e].promise;delete this.requests[e],n.resolve(t)}},e}(),o=function(){function e(e){this.logger=e,this.localAddParticipantRequests=new r,this.localAdmitParticipantRequests=new r,this.localCallMeBackRequests=new r,this.localRemoveParticipantEndpointRequests=new r,this.localRemoveParticipantRequests=new r,this.participantIdMriMap=new Map}return e.prototype.dispose=function(e,t,n){this.logger.info("["+n+"][dispose]"),this.rejectAllPendingOperations(e,t)},e.prototype.getAllPendingOperations=function(e,t){this.logger.info("["+t+"][getAllPendingOperations] "+e);var n=this.getOperationTable(e);return n?n.getAllOperations():null},e.prototype.getPendingOperation=function(e,t,n){this.logger.info("["+n+"][getPendingOperation] "+e+" "+t);var i=this.getOperationTable(e);return i?i.getOperation(t):null},e.prototype.getRnlMri=function(e,t){this.logger.info("["+t+"][getRnlMri] "+e);for(var n=0,i=e;n<i.length;n++){var r=i[n];if(this.participantIdMriMap.has(r))return this.participantIdMriMap.get(r)}return""},e.prototype.hasPendingOperation=function(e,t,n){this.logger.info("["+n+"][hasPendingOperation] "+e+" "+t+"}");var i=this.getOperationTable(e);return!!i&&i.hasOperation(t)},e.prototype.rejectPendingOperation=function(e,t,n,i,r){this.logger.info("["+r+"][rejectPendingOperation] "+e+" "+t+" reason: "+n);var o=this.getOperationTable(e);o&&o.rejectOperation(t,n,i)},e.prototype.resolvePendingOperation=function(e,t,n,i){this.logger.info("["+i+"][resolvePendingOperation]: "+t);var r=this.getOperationTable(e);r&&r.resolveOperation(t,n)},e.prototype.setPendingOperation=function(e,t,n,i){this.logger.info("["+i+"][setPendingOperation] "+e+" "+t+" value: "+n);var r=this.getOperationTable(e);if(!r)return!1;if(0===e){var o=n&&n.participant&&n.participant.participantId;o&&this.participantIdMriMap.set(o,t)}return r.setOperation(t,n)},e.prototype.getOperationTable=function(e){switch(e){case 0:return this.localAddParticipantRequests;case 1:return this.localAdmitParticipantRequests;case 2:return this.localCallMeBackRequests;case 4:return this.localRemoveParticipantEndpointRequests;case 3:return this.localRemoveParticipantRequests;default:return null}return null},e.prototype.rejectAllPendingOperations=function(e,t){this.logger.info("rejectLocalQueuedOperations"),this.localAddParticipantRequests.clear(e,t),this.localAdmitParticipantRequests.clear(e,t),this.localCallMeBackRequests.clear(e,t),this.localRemoveParticipantRequests.clear(e,t),this.localRemoveParticipantEndpointRequests.clear(e,t)},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n,a){o.assertNotNull(e,"signalingSession cannot be null");var s=t.map(function(e){return o.assertNotNull(e,"remoteParticipant cannot be null"),{id:e.id,assertedId:e.assertedId,displayName:e.displayName,participantId:e.participantId}});return{payload:{disableUnmute:n&&n.disableUnmute,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,alternateId:n?n.alternateId:null},to:s},participantInvitationData:n.additionalData,replacementDetails:a,links:{addParticipantSuccess:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t){return o.assertNotNull(e,"signalingSession cannot be null"),o.assertNotNull(t,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,displayName:t.displayName}]},links:{admitFailure:r.get(e,i.URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE),admitSuccess:r.get(e,i.URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaTypes:["audio"]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t,n){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"muteScope be null"),i.assertNotNull(n,"participantList cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:t,muteParticipants:n,mediaTypes:["audio"]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n,a,s){o.assertNotNull(e,"signalingSession cannot be null"),o.assertNotNull(t,"participantsIds cannot be null");var c=n?{threadId:n,messageId:a||null}:null,l=[];return t.forEach(function(e){var t={id:e};l.push(t)}),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},invitationType:i.default.INVITATION_TYPE.NUDGE,to:l},participantInvitationData:s,groupChat:c,links:{nudgeParticipantSuccess:r.get(e,i.URL_PATH.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:r.get(e,i.URL_PATH.CONV_NUDGE_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n){o.assertNotNull(e,"signalingSession cannot be null"),o.assertNotNull(t,"participantsIds cannot be null");var a=[];return t.forEach(function(e){var t={id:e};a.push(t)}),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},invitationType:i.default.INVITATION_TYPE.NUDGE,to:a},participantInvitationData:n,links:{nudgeParticipantSuccess:r.get(e,i.URL_PATH.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:r.get(e,i.URL_PATH.CONV_NUDGE_PARTICIPANT_FAILURE),addParticipantSuccess:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{transactionEnd:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n){return o.assertNotNull(e,"signalingSession cannot be null"),o.assertNotNull(t,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:n,toEndpoints:[{id:t.id,endpointId:t.endpointId}]},links:{removeParticipantSuccess:r.get(e,i.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:r.get(e,i.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t){return o.assertNotNull(e,"signalingSession cannot be null"),o.assertNotNull(t,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,displayName:t.displayName}]},links:{removeParticipantSuccess:r.get(e,i.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:r.get(e,i.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaTypes:["audio"]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t,n,r){void 0===r&&(r=""),i.assertNotNull(n&&"specified"===n,"Only non-null non-empty scope of 'specified' is supported."),i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"participantsIds cannot be null");var o=[];return t.forEach(function(e){var t={id:e,meetingRole:r};o.push(t)}),{payload:{from:{id:e.participantManager.localParticipant.id,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:n,to:o}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),r=n(33),o=n(10),a=n(5),s=n(1),c=n(0),l=function(){function e(e,t){var n=this;this.participantManager=e,this.logger=t,this.handleRosterUpdate=function(e,t,i,r){if("Delta"===e.type||"MultiPartyEndpoint"===e.type){if(void 0===e.sequenceNumber&&(e.sequenceNumber=n.lastRosterUpdateSeqNumber),n.logger.info("["+r+"][handleRosterUpdate][sequenceNumber="+e.sequenceNumber+"]"),n.rostersInLifetime.add(e.sequenceNumber),"Delta"===e.type)n.logger.info("["+r+"][handleRosterUpdate], RosterType: Delta, isFullRoster: "+i),n.handleDeltaRoster(e,i,t,r);else{if(n.logger.info("["+r+"][handleRosterUpdate], RosterType: MultiPartyEndpoint"),n.isRosterStale(e,r))return n.participantManager.signalingSession.telemetryHelper.recordEvent(a.EVENTS.IGNORE_OLD_ROSTER,{lastRosterUpdateSeqNumber:n.lastRosterUpdateSeqNumber,sequenceNumber:e.sequenceNumber,causeId:r}),void n.logger.info("["+r+"][handleRosterUpdate] Ignoring old roster update: received "+e.sequenceNumber+", but already handled "+n.lastRosterUpdateSeqNumber);for(var s=0,c=Object.keys(e.participants);s<c.length;s++){var l=c[s],u=o.default.fromRoster(e.participants[l]);n.handleRosterParticipant(u,t,r)}n.checkForRemovedParticipants(t,e.participants,r),n.participantManager.signalingSessionCallback.onParticipantCountsUpdated(e.participantCounts,r)}e.sequenceNumber>n.lastRosterUpdateSeqNumber&&(n.lastRosterUpdateSeqNumber=e.sequenceNumber,n.firstRosterUpdateSeqNumber<0&&(n.firstRosterUpdateSeqNumber=n.lastRosterUpdateSeqNumber),n.participantCountInFirstRoster<0&&(n.participantCountInFirstRoster=e.participants.length),n.maxConcurrentParticipantsDuringLeg=Math.max(n.maxConcurrentParticipantsDuringLeg,e.participants.length)),n.recordTelemetry(e,i),n.participantManager.signalingSessionCallback.onRosterHandlingComplete()}else n.logger.warn("["+r+"][handleRosterUpdate][sequenceNumber="+e.sequenceNumber+"] invalid roster type "+e.type)},this.isRosterStale=function(e,t){return n.logger.info("["+t+"][isRosterStale] "+(e.sequenceNumber<n.lastRosterUpdateSeqNumber)),e.sequenceNumber<n.lastRosterUpdateSeqNumber},this.updateLocalParticipantFromSubscribe=function(e,t){n.logger.info("["+t+"][updateLocalParticipantFromSubscribe]"),n.updateLocalParticipant(e,t)},this.lastRosterUpdateSeqNumber=-1,this.firstRosterUpdateSeqNumber=-1,this.tombstoneSequence=new Map,this.latestRosterVersionForActiveParticipants=new Map,this.rostersInLifetime=new Set,this.maxConcurrentParticipantsDuringLeg=-1,this.participantCountInFirstRoster=-1}return e.prototype.recordTelemetry=function(e,t){var n={participantCountInLastRoster:e.participants.length,participantCountInFirstRoster:this.participantCountInFirstRoster,sequenceNumberOfLastRoster:this.lastRosterUpdateSeqNumber,sequenceNumberOfFirstRoster:this.firstRosterUpdateSeqNumber,rosterType:e.type,isFullRoster:t,maxConcurrentParticipantsDuringLeg:this.maxConcurrentParticipantsDuringLeg,totalParticipantsDuringLifetimeOfLeg:this.tombstoneSequence.size+this.latestRosterVersionForActiveParticipants.size,countOfMissingNotifications:this.getMissingNotificiations()};this.logger.info("[recordTelemetry] data "+JSON.stringify(n,null,4)),this.participantManager.signalingSession.telemetryHelper.recordIncomingEvent(a.EVENTS.HANDLE_ROSTER_UPDATE,e,n)},e.prototype.getMissingNotificiations=function(){var e=this.lastRosterUpdateSeqNumber-this.firstRosterUpdateSeqNumber+1-this.rostersInLifetime.size;return e>0?e:0},e.prototype.isParticipantRosterStale=function(e,t){if(this.logger.info("[isParticipantRosterStale], rosterParticipantVersion "+t),t){if(this.tombstoneSequence.has(e))return t<=this.tombstoneSequence.get(e);if(this.latestRosterVersionForActiveParticipants.has(e))return t<=this.latestRosterVersionForActiveParticipants.get(e)}return!1},e.prototype.handleDeltaRoster=function(e,t,n,i){if(this.logger.info("["+i+"][handleDeltaRoster] localRoster "+n+" isFullRoster "+t),t){if(this.isRosterStale(e,i))return this.participantManager.signalingSession.telemetryHelper.recordEvent(a.EVENTS.IGNORE_OLD_ROSTER,{lastRosterUpdateSeqNumber:this.lastRosterUpdateSeqNumber,sequenceNumber:e.sequenceNumber,causeId:i}),void this.logger.info("["+i+"][handleRosterUpdate] Ignoring old roster update: received "+e.sequenceNumber+", but already handled "+this.lastRosterUpdateSeqNumber);for(var r=0,s=Object.keys(n);r<s.length;r++){var c=s[r];if(!e.participants.hasOwnProperty(c)){var l=new o.default({id:c});this.logger.info("["+i+"][handleRosterUpdate] participant missing from delta, full roster"),this.handleRemovedDeltaRosterParticipant(l,e.sequenceNumber,n,i)}}}else if(!e||!e.participants)return void this.logger.warn("["+i+"][handleRosterUpdate] participants blob empty in delta roster");for(var u=0,d=Object.keys(e.participants);u<d.length;u++){var p=d[u],f=e.participants[p];this.isParticipantRosterStale(p,f.version)||(l=o.default.fromRoster(f),f.state&&"active"===f.state?(this.logger.info("["+i+"][handleDeltaRoster] participant active"),this.handleRosterParticipant(l,n,i),this.tombstoneSequence.has(p)&&this.tombstoneSequence.delete(p),this.latestRosterVersionForActiveParticipants.set(p,f.version)):f.state&&"inactive"===f.state?(l=l||new o.default({id:f.details.id}),this.logger.info("["+i+"][handleDeltaRoster] participant inactive"),this.handleRemovedDeltaRosterParticipant(l,f.version,n,i)):this.logger.info("["+i+"][handleDeltaRoster] unexpected participant state "+f.state))}this.handleRemoveParticipantRequests(this.getActiveParticipants(e.participants),i),this.participantManager.signalingSessionCallback.onParticipantCountsUpdated(e.participantCounts,i)},e.prototype.getRnlMri=function(e,t){var n=this.participantManager.participantOperationHandler;if(e){var i=this.getRnlParticipantIdsFromRoster(e,t);return n.getRnlMri(i,t)}return""},e.prototype.handleRemovedDeltaRosterParticipant=function(e,t,n,i){var r=e.id,o=this.getRnlMri(e,i),a="";n.hasOwnProperty(r)?a=r:n.hasOwnProperty(o)&&(a=o),a&&this.handleRemovedParticipant(n,a,i),this.tombstoneSequence.set(r,t),this.latestRosterVersionForActiveParticipants.has(r)&&this.latestRosterVersionForActiveParticipants.delete(r)},e.prototype.handleRemovedParticipant=function(e,t,n){var i=this.participantManager.signalingSessionCallback,o=this.participantManager.signalingSession;!1!==e[t]&&(c.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,t),this.logger.info("["+n+"][handleRemovedParticipant] "+r.scrubMriOrOmit(t)+" removed from roster"),i.onParticipantRemoved({id:t},n),o.clearParticipantCallLinks(t))},e.prototype.getActiveParticipants=function(e){for(var t={},n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];"inactive"!==e[r].state&&(t[r]=e[r])}return t},e.prototype.handleRosterParticipant=function(e,t,n){if(e)if(e.id!==this.participantManager.localParticipant.id){var i=this.participantManager.participantOperationHandler,o=this.participantManager.signalingSession,a=this.participantManager.signalingSessionCallback,l=e.id,u=this.getRnlMri(e,n);o.signalingAgentConfig.overrideDisplayName&&o.remoteCaller&&e.participantId===o.remoteCaller.participantId&&(e.displayName=o.remoteCaller.displayName),c.tryAddNewKeyToHashTable(this.participantManager.connectedRemoteParticipantIds,e.id,!0);var d=t.hasOwnProperty(e.id),p=t.hasOwnProperty(u);(d||p)&&(t[e.id]=!1),i.hasPendingOperation(0,e.id,n)&&this.isParticipantInCall(e)?(this.logger.info("participant "+r.scrubMriOrOmit(e.id)+" appears in roster. Resolving AddParticipant request"),o.timeoutManager.stopTimer(s.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e.id),i.resolvePendingOperation(0,e.id,e,n)):u&&i.hasPendingOperation(0,u,n)&&this.isParticipantInCall(e)?(this.logger.info("participant "+r.scrubMriOrOmit(u)+" appears in roster. Resolving AddParticipant request"),o.timeoutManager.stopTimer(s.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,u),i.resolvePendingOperation(0,u,e,n)):i.hasPendingOperation(1,e.id,n)&&this.isParticipantInCall(e)&&(this.logger.info("participant: "+r.scrubMriOrOmit(e.id)+" appears in roster. Resolving AdmitParticipant request"),o.timeoutManager.stopTimer(s.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),i.resolvePendingOperation(1,e.id,e,n)),d?(this.logger.info("participantId="+e.participantId+" updated "+r.scrubMriOrOmit(e.id)),a.onParticipantUpdated(e,n),o.setParticipantCallLinks(e)):p?(this.logger.info("RNL participant participantId="+e.participantId+" removed old "+r.scrubMriOrOmit(u)+" and added new "+l),a.onParticipantRemoved({id:u},n),o.clearParticipantCallLinks(u),a.onParticipantJoined(e,n),o.setParticipantCallLinks(e)):i.hasPendingOperation(3,e.id,n)?this.logger.info("participantId="+e.participantId+" ignored "+r.scrubMriOrOmit(e.id)):(this.logger.info("participantId="+e.participantId+" joined "+r.scrubMriOrOmit(e.id)),a.onParticipantJoined(e,n),o.setParticipantCallLinks(e))}else this.updateLocalParticipant(e,n);else this.logger.info("[handleRosterParticipant] ["+n+"] rosterParticipant processing skipped because null.")},e.prototype.getRnlParticipantIdsFromRoster=function(e,t){for(var n=[],i=0,r=e.endpointDetails;i<r.length;i++){var o=r[i];n.push(o.participantId)}return this.logger.info("["+t+"][getRnlParticipantIdsFromRoster] "+JSON.stringify(n)),n},e.prototype.isParticipantInCall=function(e){return e.endpointDetails&&e.endpointDetails[0]&&!e.endpointDetails[0].isLobby},e.prototype.updateLocalParticipant=function(e,t){var n=this.participantManager.localParticipant,r=this.participantManager.signalingSession,o=this.participantManager.signalingSessionCallback;if(this.logger.info("["+t+"][updateLocalParticipant]"),e&&e.endpointDetails){var s=i.find(e.endpointDetails,function(e){return n.endpointId===e.endpointId}),c=i.find(n.endpointDetails,function(e){return n.endpointId===e.endpointId});!s||!s.isLobby||c&&c.isLobby?!s||s.isLobby||c&&!c.isLobby||r.telemetryHelper.recordEvent(a.EVENTS.CONNECTED,{causeId:t}):r.telemetryHelper.recordEvent(a.EVENTS.IN_LOBBY,{causeId:t})}e&&(n.endpointDetails=e.endpointDetails,n.acceptedBy=e.acceptedBy,n.role=e.role,n.meetingRole=e.meetingRole,n.tenantId=e.tenantId,n.isLobby=e.isLobby,n.publishedStates=e.publishedStates,this.participantManager.localParticipant.fromRoster=!0,o.onSelfParticipantUpdated(n,t))},e.prototype.checkForRemovedParticipants=function(e,t,n){var i=this.participantManager.signalingSessionCallback,o=this.participantManager.signalingSession,a=this.participantManager.participantOperationHandler;this.logger.info("["+n+"][checkForRemovedParticipants]");for(var s=0,l=Object.keys(e);s<l.length;s++){var u=l[s];e.hasOwnProperty(u)&&!1!==e[u]&&!a.hasPendingOperation(0,u,n)&&(c.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,u),this.logger.info("["+n+"][checkForRemovedParticipants] "+r.scrubMriOrOmit(u)+" removed from roster"),i.onParticipantRemoved({id:u},n),o.clearParticipantCallLinks(u))}this.handleRemoveParticipantRequests(t,n)},e.prototype.handleRemoveParticipantRequests=function(e,t){var n=this.participantManager.signalingSession,i=this.participantManager.participantOperationHandler;this.logger.info("handleRemoveParticipantRequests ["+t+"] dynamicRosterParticipants");var a=[];Object.keys(e).forEach(function(t){var n=o.default.fromRoster(e[t]);n&&n.endpointDetails&&n.endpointDetails.forEach(function(e){e.originalId&&a.push(e.originalId)})});for(var l=i.getAllPendingOperations(3,t),u=0,d=Object.keys(l);u<d.length;u++){var p=d[u];-1!==a.indexOf(p)||e.hasOwnProperty(p)||(this.logger.info("["+t+"][handleRemoveParticipantRequests] "+r.scrubMriOrOmit(p)+" no longer appears in roster. Resolving RemoveParticipant request"),c.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,p),n.timeoutManager.stopTimer(s.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,p),i.resolvePendingOperation(3,p,{id:p},t))}},e}();t.default=l},function(e,t,n){"use strict";
/*!
 *  index.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(9)),i(n(13)),i(n(111)),i(n(35)),i(n(115))},function(e,t,n){"use strict";
/*!
 *  RootToolsManager.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(112),s=n(13),c=n(9),l=n(35),u=s.LogFactory.instance().component("RootToolsManager");s.LogFactory.instance().declareComponentSafe("RootToolsManager",!0),function(e){e[e.InternalBuild=0]="InternalBuild",e[e.PublicBuild=1]="PublicBuild"}(o=t.BuildType||(t.BuildType={}));var d=o.InternalBuild;function p(e,t){var n=[];for(var i in e)n.push(t(i,e[i]));return n}function f(e,t,n){if(null==e)return null==t||0===t.length;if(null==t)return null==e||0===e.length;if(e.length===t.length){for(var i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}return!1}function h(e,t){return null==e?null==t:null==t?null==e:e.arg===t.arg&&e.op===t.op&&e.value===t.value}function g(e,t){return null==e?null==t||0===t.logId:null==t?null==e||0===e.logId:e.logId===t.logId&&e.name===t.name&&f(e.matchers,t.matchers,h)}function m(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.parsedLevel===t.level}function v(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.level===t.level}function y(e){for(var t=[],n=0;n<e.length;n++)"string"==typeof e[n]||"number"==typeof e[n]?t.push(e[n]):t.push(JSON.stringify(e[n]));return t}t.setBuildType=function(e){var t=d;return d=e,t};var S=function(e){function t(t,n,i){var r=e.call(this)||this;return r._unmetConditions=[],r._rtMan=t,r._triggerCallback=n,r._ecsConfig=i,r.resetConditions(),r}return r(t,e),t.prototype.config=function(){return this._ecsConfig},t.prototype.configEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.mutualSubmissionType===e.mutualSubmissionType&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&this._ecsConfig.experimentTarget===e.experimentTarget&&g(this._ecsConfig.resetCondition,e.resetCondition)&&f(this._ecsConfig.conditions,e.conditions,g)&&f(this._ecsConfig.filters,e.filters,v)},t.prototype.nativeConfigEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&g(this._ecsConfig.resetCondition,e.resetCondition)&&f(this._ecsConfig.conditions,e.conditions,g)&&f(this._ecsConfig.filters,e.filters,m)},t.prototype.needReset=function(e){return!this.configEquals(e)},t.prototype.resetConditions=function(){this._unmetConditions=[];for(var e=0;e<this._ecsConfig.conditions.length;e++)this._unmetConditions.push(e)},t.prototype.matcherMatches=function(e,t){if(e.arg>=t.length)return!1;var n=t[e.arg],i="string"==typeof n?e.value:parseInt(e.value,10);return"="===e.op||"=="===e.op?n===i:"!="===e.op?n!==i:"<"===e.op?n<i:"<="===e.op?n<=i:">"===e.op?n>i:">="===e.op?n>=i:"CONTAINS"===e.op.toUpperCase()&&(""+n).indexOf(e.value)>=0},t.prototype.conditionMatches=function(e,t,n){if(t!==e.logId)return!1;if(e.matchers)for(var i=0;i<e.matchers.length;i++)if(!this.matcherMatches(e.matchers[i],n))return!1;return!0},t.prototype.log=function(e,t,n,i){if(0!==this._unmetConditions.length&&e.component!==u){var r=this._ecsConfig;r.resetCondition&&this.conditionMatches(r.resetCondition,t,i)&&(u.debug4("LogTrigger %s: resetCondition met",r.name),this.resetConditions());for(var o=0;o<this._unmetConditions.length;o++){var a=this._unmetConditions[o];if(this.conditionMatches(r.conditions[a],t,i)){u.debug4("LogTrigger %s: condition %s met",r.name,r.conditions[a].name),this._unmetConditions.splice(o,1);break}}0===this._unmetConditions.length&&(u.debug1("LogTrigger %s has triggered, trying to send the log",r.name),this._triggerCallback.call(this._rtMan,r),r.reenableAfterTriggering&&this.resetConditions())}},t.prototype.receiveAll=function(){return!0},t}(l.AbstractLogAppender),_=function(e){function t(t,n,i){var r=e.call(this)||this;return r._circularBuffer=[],r._circularBufferMaxSize=0,r._onBufferOverflow=null,r._circularBuffer=[],r._circularBufferMaxSize=n,r._includeUnsafe=t,r._onBufferOverflow=i||function(){return r._circularBuffer.shift()},r}return r(t,e),t.prototype.log=function(e,t,n,i){if((this._includeUnsafe||e.component.safe())&&!(this._circularBuffer.length>this._circularBufferMaxSize)){var r={md:e,logId:t,messages:y(i)};this._circularBuffer.push(r),this._circularBuffer.length>this._circularBufferMaxSize&&this._onBufferOverflow()}},t.prototype.visitReverseOrder=function(e){for(var t=this._circularBuffer.length-1;t>=0;t--){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.visitForwardOrder=function(e){for(var t=0;t<this._circularBuffer.length;t++){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.needReset=function(e,t){return e!==this._includeUnsafe||t!==this._circularBufferMaxSize},t.prototype.dumpLogBuffer=function(e,t,n){var i=this,r=new E(e.reverse),o=e.filter.map(function(e){return{component:"root"===e.component?"":e.component,parsedLevel:e.level}}),a=n||{matchedLines:0,totalLines:0};return(e.reverse?this.visitReverseOrder:this.visitForwardOrder).apply(this,[function(e,n,s){return a.totalLines++,i.filterMatches(e,n,s,o)&&(a.matchedLines++,r.log(e.component,e.timestamp,e.level,n,s)),!t||r._data.length<t}]),r.close(),r.data()},t.prototype.filterMatches=function(e,t,n,i){for(var r=0;r<i.length;r++)if((""===i[r].component||e.component.name()===i[r].component||e.component.name().substr(0,i[r].component.length)===i[r].component&&"."===e.component.name().charAt(i[r].component.length))&&e.level>=i[r].parsedLevel)return!0;return!1},t.prototype.clear=function(){this._circularBuffer=[]},t.prototype.size=function(){return this._circularBuffer.length},t.prototype.empty=function(){return 0===this.size()},t.prototype.capacity=function(){return this._circularBufferMaxSize},t}(l.AbstractLogAppender);t.CircularBuffer=_;var E=function(){function e(e){this._reverse=e,this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this._data="ULOG2"+String.fromCharCode(33)+String.fromCharCode(32),this._data+=e?String.fromCharCode(34):String.fromCharCode(32),this._data+=String.fromCharCode(32)}return e.prototype._add8=function(e){if(this._pending.push(255&e),3===this._pending.length){var t=(this._pending[0]<<16)+(this._pending[1]<<8)+(this._pending[2]<<0),n=this._base64chars[t>>18&63]+this._base64chars[t>>12&63]+this._base64chars[t>>6&63]+this._base64chars[t>>0&63];this._data+=n,this._pending=[]}},e.prototype._add16=function(e){this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add32=function(e){this._add8(e>>24&255),this._add8(e>>16&255),this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add64=function(e){this._add32(e/4294967296|0),this._add32(0|e)},e.prototype._addS=function(e){for(var t=0;t<e.length;t++)this._add8(e.charCodeAt(t));this._add8(0)},e.prototype._close=function(){for(;this._pending.length;)this._add8(0)},e.prototype.log=function(e,t,n,i,r){var o=this._components[e.name()];o||(o=++this._componentCount,this._components[e.name()]=o,this._add8(2),this._add16(o),this._addS(e.name()),this._addS(""),this._addS(""),this._add8(e.safe()?1:0));var a=128;this._first&&(a|=2);var s=t-this._lastts;this._lastts=t,s>-128&&s<128&&(a|=1),this._add8(a),1&a?this._add8(s):this._add64(1e3*t),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(o),this._add8(n),this._add32(i),this._add8(r.length);for(var c=0;c<r.length;c++)this._add8(8),this._addS(""+r[c]);this._first=!1},e.prototype.close=function(){this._add8(7),this._close()},e.prototype.data=function(){return this._data},e.prototype.empty=function(){return this._first},e}(),T=function(e){function t(t,n,i,r){var o=e.call(this)||this;return o._capacity=t,o._onBufferOverflow=n,o._enableThrottling=i,o._maxVerbosityLevel=r,o._outputFormatter=new E(!1),o._linesStored=0,o._throttling=!1,o._linesThrottled=0,o}return r(t,e),t.prototype.log=function(e,t,n,i){this._maxVerbosityLevel&&e.level<this._maxVerbosityLevel||(this._throttling?this._linesThrottled++:(this._linesStored++,this._outputFormatter.log(e.component,e.timestamp,e.level,t,y(i))),this._linesStored>this._capacity&&(this._enableThrottling?this._throttling||(this._throttling=!0):this._onBufferOverflow()))},t.prototype.dumpAndReset=function(){if(this._outputFormatter.empty())return"";this._linesThrottled>0&&this._outputFormatter.log(u,(new Date).getTime(),c.LogLevel.Fatal,-1,["RooToolsManager: Log buffer overflow! "+this._linesThrottled+" lines thrown away"]),this._outputFormatter.close();var e=this._outputFormatter.data();return this.clearBuffer(),e},t.prototype.empty=function(){return this._outputFormatter.empty()},t.prototype.clearBuffer=function(){this._outputFormatter=new E(!1),this._linesStored=0,this._linesThrottled=0,this._throttling=!1},t.prototype.capacity=function(){return this._capacity},t.prototype.throttlingEnabled=function(){return this._enableThrottling},t.prototype.size=function(){return this._linesStored},t.prototype.maxVerbosityLevel=function(){return this._maxVerbosityLevel},t}(l.AbstractLogAppender);function C(e){return"Native"===e||"JavaScript"===e||"Mixed"===e}t.DumperBuffer=T;var I=function(){function e(){this._maxUploadSize=0,this._jsToNativeBuffer=null,this._jsToNativeBufferHandle=null,this._jsToNativeFlushTimer=null,this._jsToNativeFlushInterval=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:c.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget="Mixed",this._BRBCallback=null}return e.prototype.setDelegate=function(e){this._glue=e,this.registerListeners()},e.prototype.isDelegateSet=function(){return null!=this._glue},e.prototype.setNativeFunctions=function(e){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=e,this._native&&this._native.log_config.addLogTriggerListener(this)},e.prototype.applyLogLevels=function(){var e={};for(var t in this._localLogLevels)e[t]=this._localLogLevels[t];e[""]=e.root||c.LogLevel.Debug4,delete e.root;var n=p(e,function(e,t){return{component:e,level:t}});n.sort(function(e,t){return e.component.length-t.component.length}),n.forEach(function(e){return s.LogFactory.instance().component(e.component).setLevel(e.level)}),this._native&&this._native.log_config.setLogLevelConfig(n)},e.prototype.setLocalLogLevelConfig=function(e){this._localLogLevels=e,this.applyLogLevels()},e.prototype.parseMatcher=function(e){return null==e||null==e.arg||null==e.op||null==e.value?null:{arg:e.arg,op:e.op,value:e.value}},e.prototype.parseCondition=function(e){if(null==e||null==e.logId)return null;if(e.matchers&&!(e.matchers instanceof Array))return null;var t,n={name:e.name||(t=e.logId,(4294967296+t).toString(16).substr(-8)),logId:e.logId,matchers:[]};if(e.matchers&&e.matchers.length)for(var i=0,r=e.matchers;i<r.length;i++){var o=r[i],a=this.parseMatcher(o);a&&n.matchers.push(a)}return n},e.prototype.parseFilter=function(e){return null==e||null==e.component||0===e.component.length?null:{component:e.component,level:e.level,parsedLevel:s.LogFactory.levelFromString(e.level)}},e.prototype.parseConfig=function(e,t,n){if(null==e)return null;if(!(e.conditions instanceof Array)||0==e.conditions.length)return null;if(!(e.filters instanceof Array)||0==e.filters.length)return null;if(e.resetCondition&&!this.parseCondition(e.resetCondition))return null;for(var i={name:e.name||t+"->"+n,ecsNs:t,reenableAfterTriggering:e.reenableAfterTriggering||!1,mutualSubmissionType:e.mutualSubmissionType||"",includeUnsafe:d!==o.PublicBuild&&(e.includeUnsafe||!1),experimentTarget:C(e.experimentTarget)&&e.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==e.resetCondition?e.resetCondition:this.parseCondition(e.resetCondition),filters:[]},r=0,a=e.conditions;r<a.length;r++){var s=a[r],c=this.parseCondition(s);c&&i.conditions.push(c)}for(var l=0,u=e.filters;l<u.length;l++){var p=u[l],f=this.parseFilter(p);f&&i.filters.push(f)}return 0===i.conditions.length?null:i},e.prototype.isExperimentListed=function(e,t,n,i){return!!e&&(!(!i||!e.some(function(e){return"*"===e.namespace}))||e.some(function(e){return e.namespace===t&&(e.experiment===n||"*"==e.experiment)}))},e.prototype.isExperimentAllowed=function(e,t,n){return!this.isExperimentListed(e.blacklist,t,n,!0)||this.isExperimentListed(e.whitelist,t,n,!1)},e.prototype.findTrigger=function(e,t){for(var n in e)if(e[n].configEquals(t))return n;return null},e.prototype.findTriggerByNativeConfig=function(e,t){for(var n in e)if(e[n].nativeConfigEquals(t))return n;return null},e.prototype.OnEcsChange=function(){var e=this;return null==this._glue?a.Resolved():this._glue.fetchEcsConfig("SkypeRootTools","ULBaseline").then(function(t){u.debug4("Reloading ULBaseline config - new config: %@",t),t||(u.warn("No ULBaseline config"),t={}),e._maxUploadSize=t.logUpload&&t.logUpload.maxSize||1024;var n=[],i=e._triggers;e._triggers={};var r=(t.logUpload&&t.logUpload.maxSize||1024)/100,o=t.circularBuffer&&t.circularBuffer.enabled,d=t.circularBuffer&&t.circularBuffer.buffers||e._defaultBuffers,f=t.circularBuffer&&t.circularBuffer.storeUnsafe;e._defaultExperimentTarget=C(t.defaultExperimentTarget)&&t.defaultExperimentTarget||"Mixed";var h=t.killswitch||e._defaultKillswitch,g=t.blacklists||e._defaultBlacklists;g.component.length>0&&s.LogFactory.instance().setComponentBlacklist(g.component);var m={};(t.componentLevels||[]).forEach(function(e){return m[e.component]=e.level}),function e(t,n,i){return n<t.length?i(t[n]).then(function(){return e(t,n+1,i)}):a.Resolved()}(t.configPaths||[],0,function(t){return e._glue.fetchEcsConfig(t.ns,t.key).then(function(r){var a=r instanceof Array?r:[r];u.debug4("Reloading ECS config for %s->%s - new config: %@",t.ns,t.key,a);for(var s=0,c=a;s<c.length;s++){var l=c[s];if(null!=l){var d=e.parseConfig(l,t.ns,t.key);if(null!=d)if("JavaScript"===d.experimentTarget||"Mixed"===d.experimentTarget)if(u.debug2("Parsed ECS config for %s->%s - %@",t.ns,t.key,d),e.isExperimentAllowed(h,t.ns,d.name)){u.debug2("Allowing %s->%s:%s according to killswitch",t.ns,t.key,d.name),o=!0;var p=e.findTrigger(i,d);null!=p?(u.debug2("Triggers updated, keeping trigger %s",d.name),e._triggers[p]=i[p],delete i[p]):n.push(d),d.filters&&d.filters.forEach(function(e){return m[e.component]=Math.min(m[e.component]||255,e.parsedLevel)}),d.includeUnsafe&&(f=!0)}else u.debug2("Disallowing %s->%s according to killswitch",t.ns,t.key);else u.debug4("Skipping %s->%s, targeted for %s",t.ns,t.key,d);else u.error("Failed to parse ECS config for %s->%s",t.ns,t.key)}}})}).always(function(){for(var t in e.applyLogLevels(),i)u.debug2("Triggers updated, removing trigger %s",i[t].config().name),s.LogFactory.instance().removeAppender(+t);if(n.forEach(function(t){u.debug2("Triggers updated, adding trigger %s",t.name);var n=new S(e,e._triggered,t),i=s.LogFactory.instance().addAppender(n);e._triggers[String(i)]=n}),m[""]=m.root||c.LogLevel.Debug4,delete m.root,!e._circularBuffer||o&&!e._circularBuffer.needReset(f,r)?e._circularBuffer&&(Object.keys(i).length>0||n.length>0?(u.debug2("Buffer updated, reapplying log levels, removing log levels wrapper"),s.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBufferHandle=null):u.debug2("Buffer updated, no change")):(u.debug2("Buffer updated, removing existing buffer"),s.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBuffer=null,e._circularBufferHandle=null),o&&(e._circularBuffer||(u.debug2("Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)",f,r),e._circularBuffer=new _(f,r)),null==e._circularBufferHandle&&(u.debug2("Creating log level wrapper"),e._circularBufferHandle=s.LogFactory.instance().addAppender(l.wrapAppenderWithLogLevels(e._circularBuffer,m),c.AppenderFlags.InsertFront))),e._native){var a=p(m,function(e,t){return{component:e,level:t}});a.sort(function(e,t){return e.component.length-t.component.length}),e._native.log_config.setLogBufferConfig(o,{storeUnsafe:f,buffers:d},a);var h=[];for(var g in e._triggers){var v=e._triggers[g].config();h.push({name:v.name,ecsNs:v.ecsNs,conditions:v.conditions,resetCondition:v.resetCondition,includeUnsafe:v.includeUnsafe,reenableAfterTriggering:v.reenableAfterTriggering,filters:v.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),dumpFile:!1,metadata:{}})}e._native.log_config.setLogTriggerConfig(h,{})}})})},e.prototype._send=function(e,t){null!=this._glue&&(this._glue.sendTelemetry("638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104",{logTriggerName:e.name,logEcsNs:e.ecsNs,logdata:t}),u.debug4("LogSender::send, sent %d bytes",t.length))},e.prototype.triggered=function(e,t){},e.prototype.triggeredPartially=function(e,t,n,i,r){var o=this.findTriggerByNativeConfig(this._triggers,e);if(o){var a={level:t.level,component:s.LogFactory.instance().component(t.component),timestamp:t.timestamp};this._triggers[o].log(a,n,i,r)}},e.prototype.reset=function(e){var t=this.findTriggerByNativeConfig(this._triggers,e);t&&this._triggers[t].resetConditions()},e.prototype.dumpLogBuffer=function(e,t){if(this._circularBuffer){var n={matchedLines:0,totalLines:0},i=this._circularBuffer.dumpLogBuffer(e,this._maxUploadSize,n);if(u.debug4("dumpLogBuffer: dumped %d of %d lines, size of payload: %d",n.matchedLines,n.totalLines,null!=i?i.length:0),this._native){var r=a.Defer();return this._native.log_config.mergeAndDumpLogBuffer(i,e,t,function(e){return r.resolve(e)}),r.promise()}return a.Resolved(i)}return u.warn("dumpLogBuffer: no log buffer enabled"),a.Rejected()},e.prototype._triggered=function(e){var t=this,n={compression:c.LogFileCompression.Compress,encoding:c.LogFileEncoding.Base64,encryption:c.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},i={includeUnsafe:e.includeUnsafe,filter:e.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),reverse:!0};this.dumpLogBuffer(i,n).then(function(n){return t._send(e,n)})},e.prototype.sendBRBEvent=function(e){try{if(u.debug2("sendBRBEvent %s",JSON.stringify(e)),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var t={eventType:"uploadBRB",mutualSubmissionType:"call",payload:e};this._glue.sendLoggingEventToNative(JSON.stringify(t),"")}}catch(e){u.error("sendBRBEvent %s: %s",e.name,e.message)}},e.prototype.setBRBCallback=function(e){u.debug2("setBRBCallback"),null!=this._glue?"function"==typeof this._glue.setNativeLoggingEventCallback?this._BRBCallback=e:u.warn("setBRBCallback: RootToolsManagerDelegate missing setNativeLoggingEventCallback method"):u.warn("setBRBCallback: RootToolsManagerDelegate is not set")},e.prototype.registerListeners=function(){var e=this;null!=this._glue&&"function"==typeof this._glue.setNativeLoggingEventCallback?this._glue.setNativeLoggingEventCallback(function(t,n){return e.handleNativeLoggingEvent(t,n)}):u.warn("registerListeners: RootToolsManagerDelegate missing setNativeLoggingEventCallback method")},e.prototype.handleNativeLoggingEvent=function(e,t){try{u.debug2("Native Log event message: %s aux: %s",e,t);var n=JSON.parse(e);if(n.eventType&&"uploadBRB"===n.eventType){if("function"!=typeof this._BRBCallback)return void u.warn("BRBCallback not set, ignoring native event");u.debug4("Sending BRB callback: %@",n.payload),this._BRBCallback(n.payload)}else n.eventType&&"jsLogFileConfiguration"===n.eventType&&this.handleLogFileConfigEvent(n)}catch(e){u.error("handleNativeLoggingEvent %s: %s",e.name,e.message)}},e.prototype.handleLogFileConfigEvent=function(e){if(e.payload){var t=e.payload;if(t.enabled){if(t.chunkSize&&t.flushInterval){var n={chunkSize:t.chunkSize,flushInterval:t.flushInterval,enableThrottling:t.enableThrottling,maxVerbosityLevel:t.maxVerbosityLevel};this.startJsToNativeLogging(n)}}else this.flushDisableJsToNativeLogging()}},e.prototype.logExternalForDDL=function(e,t){try{if(u.debug2("logExternalForDDL %s %s",e,t),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var n={eventType:"logInSClog",payload:{message:e,parameters:t}};this._glue.sendLoggingEventToNative(JSON.stringify(n),"")}else u.warn("ignoring logExternalForDDL, delegate misconfigured")}catch(e){u.error("logExternalForDDL %s: %s",e.name,e.message)}},e.prototype.startJsToNativeLogging=function(e){var t=this,n=e.chunkSize,i=e.flushInterval,r=e.enableThrottling,o=this._getVerbosityLevelFromConfig(e.maxVerbosityLevel);if(this._jsToNativeBuffer){if(this._jsToNativeBuffer.capacity()===n&&this._jsToNativeFlushInterval===i&&this._jsToNativeBuffer.throttlingEnabled()===r&&this._jsToNativeBuffer.maxVerbosityLevel()===o)return void u.debug1("Same JS2Native settings received - doing nothing");u.debug1("Reapplying js to native settings"),this.flushDisableJsToNativeLogging()}this._jsToNativeBuffer=new T(n,function(){t.onJsToNativeBufferReady(t._jsToNativeBuffer)},r,o),this.setJsToNativeFlushTimeout(i),this._jsToNativeFlushInterval=i,this._jsToNativeBufferHandle=s.LogFactory.instance().addAppender(this._jsToNativeBuffer)},e.prototype._getVerbosityLevelFromConfig=function(e){return e?s.LogFactory.levelFromString(e):null},e.prototype.flushDisableJsToNativeLogging=function(){this._jsToNativeBuffer&&this.onJsToNativeBufferReady(this._jsToNativeBuffer),this.plainDisableJsToNativeLogging()},e.prototype.plainDisableJsToNativeLogging=function(){this.clearJsToNativeFlushTimeout(),this._jsToNativeBufferHandle&&(s.LogFactory.instance().removeAppender(this._jsToNativeBufferHandle),this._jsToNativeBufferHandle=0,this._jsToNativeBuffer=null,u.debug1("Disabling forwarding JS logs to native"))},e.prototype.onJsToNativeBufferReady=function(e){null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative?(this.clearJsToNativeFlushTimeout(),this.dumpJsToNativeBuffer(e),this.setJsToNativeFlushTimeout(this._jsToNativeFlushInterval)):this.plainDisableJsToNativeLogging()},e.prototype.dumpJsToNativeBuffer=function(e){if(!e.empty()){var t=e.dumpAndReset();this._glue.sendLoggingEventToNative(JSON.stringify({eventType:"writeLogData"}),t)}},e.prototype.clearJsToNativeFlushTimeout=function(){this._jsToNativeFlushTimer&&(clearTimeout(this._jsToNativeFlushTimer),this._jsToNativeFlushTimer=null)},e.prototype.setJsToNativeFlushTimeout=function(e){var t=this;!this._jsToNativeFlushTimer&&e&&(this._jsToNativeFlushTimer=setTimeout(function(){t._jsToNativeFlushTimer=null,t.onJsToNativeBufferReady(t._jsToNativeBuffer)},e))},e.prototype.stopAsyncOperations=function(){this.flushDisableJsToNativeLogging()},e}();t.RootToolsManager=new I},function(e,t,n){"use strict";(function(e){function n(e){return null!=e&&"function"==typeof e.then}function i(e){return null!=e&&"function"==typeof e.cancel}function r(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var o,a=[],s=void 0!==e;function c(t){a.push(t),1===a.length&&(s?e(l):setTimeout(l,0))}function l(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function d(e){return(new o.SyncTask).resolve(e).promise()}function p(e){var t=u(),r=!1;return t.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){n(e)?e.then(function(e){r||(r=!0,t.resolve(e))},function(e){r||(r=!0,t.reject(e))}):r||(r=!0,t.resolve(e))}),t.promise()}t.asyncCallback=c,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var i=this,r=new e;return r.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,i._cancelInternal(e)}),t.task=r,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:r._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),r.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?r(function(){var r=t.successFunc(o._storedResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?r(function(){var r=t.failFunc(o._storedErrResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return d([]);var t,r=u(),a=e.length,s=Array(e.length);r.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})});var c=function(){0==--a&&(void 0!==t?r.reject(t):r.resolve(s))};return e.forEach(function(e,i){n(e)?e.then(function(e){s[i]=e,c()},function(e){void 0===t&&(t=void 0===e||e),c()}):(s[i]=e,c())}),r.promise()},t.Defer=u,t.Resolved=d,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=p,t.raceTimer=function(e,t){var n=u(),i=setTimeout(function(){n.resolve({timedOut:!0})},t);return p([e.then(function(e){return clearTimeout(i),{timedOut:!1,result:e}}),n.promise()])}}).call(this,n(113).setImmediate)},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(114),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(34))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r,o,a,s,c=1,l={},u=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){h(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&h(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),i=function(t){e.postMessage(a+t,"*")}):e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){h(e.data)},i=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(r=d.documentElement,i=function(e){var t=d.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):i=function(e){setTimeout(h,0,e)},p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return l[c]=r,i(c),c++},p.clearImmediate=f}function f(e){delete l[e]}function h(e){if(u)setTimeout(h,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{f(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(34),n(24))},function(e,t,n){"use strict";
/*!
 *  pii.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2017-01-16
 *  Copyright 2017 Microsoft. All rights reserved.
 *
 */Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(e){return e},o=!0,a=r,s={},c=0,l=/^([0-9][0-9]?):([^<>\*\{\}&'\"\/\\?^`|~\s]+)$/;!function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.InternalSkype=48]="InternalSkype"}(i||(i={}));var u=[i.Thread,i.InternalSkype,i.Bot];t.enableAnonymization=function(e){o=e},t.useTagger=function(e){a=e||r},function(e){function t(e){return o?e?s[e]||function(e){return s[e]="u"+ ++c}(e):null:e}e.UserName=function(e){var n=t(e);return a(n)},e.Mri=function(e){var n,i=e.match(l);if(i){var r=Number(i[1]),o=i[2];n=-1!=u.indexOf(r)?e:r+":"+t(o)}else n=t(e);return a(n)},e.Omit=function(e){var t;return t=o?"number"==typeof e?19229:"string"==typeof e?e.charAt(0)+"...":null:e,a(t)}}(t.pii||(t.pii={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t){return o.assertNotNull(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},links:{admitAllStatus:r.get(e,i.URL_PATH.CONV_ADMIT_ALL_STATUS)},operationId:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n){void 0===n&&(n=!0),o.assertNotNull(e,"signalingSession cannot be null"),o.assertNotNull(t,"joinUrl cannot be null");var a={type:e.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint",rosterUpdate:r.get(e,i.URL_PATH.CONV_ROSTER_UPDATE)},s=e.getEndpointCapabilities(),c={payload:{attach:{requireMediaContent:n,links:{end:r.get(e,i.URL_PATH.END)},locationContent:e.getLocationContent(),networkContent:e.getNetworkContent(),areaContent:e.getAreaContent()},capabilities:e.signalingAgentConfig.enableDeltaRosterWeb?null:s,endpointCapabilities:e.signalingAgentConfig.enableDeltaRosterWeb?s:null,additionalActions:[{input:{capabilities:e.signalingAgentConfig.enableDeltaRosterWeb?null:s,endpointCapabilities:e.signalingAgentConfig.enableDeltaRosterWeb?s:null,conversationRequest:{applicationType:e.participantManager.localParticipant.applicationType,roster:a,links:{conversationEnd:r.get(e,i.URL_PATH.CONV_END),conversationUpdate:r.get(e,i.URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},endpointMetadata:e.endpointMetadata,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}},name:"join",url:t,waitForResponse:!0}]}};return e.signalingAgentConfig.ecsEtag&&(c.payload.debugContent={ecsEtag:e.signalingAgentConfig.ecsEtag}),c.payload.additionalActions.length>0&&e.deviceType&&"default"!==e.deviceType&&(c.payload.additionalActions[0].input.conversationRequest.deviceType=e.deviceType),c}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e){return o.assertNotNull(e,"signalingSession cannot be null"),{payload:{callAcceptanceAcknowledgement:{links:{mediaRenegotiation:r.get(e,i.URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,i.URL_PATH.TRANSFER),replacement:r.get(e,i.URL_PATH.REPLACE),balanceUpdate:r.get(e,i.URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,i.URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:r.get(e,i.URL_PATH.CONTROL_VIDEO_STREAMING)}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n,a){o.assertNotNull(e,"signalingSession cannot be null");var s=o.getMediaTypes(n);e.telemetryHelper.addOutgoingModalities(s);var c=e.getEndpointCapabilities();return{payload:{callAcceptance:{acceptedBy:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},acceptedCallModalities:s,capabilities:e.signalingAgentConfig.enableDeltaRosterWeb?null:c,endpointCapabilities:e.signalingAgentConfig.enableDeltaRosterWeb?c:null,clientEndpointCapabilities:0!==a?a:null,links:{mediaRenegotiation:r.get(e,i.URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,i.URL_PATH.TRANSFER),replacement:r.get(e,i.URL_PATH.REPLACE),balanceUpdate:r.get(e,i.URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,i.URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:r.get(e,i.URL_PATH.CONTROL_VIDEO_STREAMING)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent,callKeepAliveInterval:null}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{callProgress:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},status:"ringing",phrase:"ringing"}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0);t.getPayload=function(e,t,n){r.assertNotNull(e,"signalingSession cannot be null"),r.assertCallEndReason(t);var o={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:i.default.CALL_END_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:t}};return n&&t.code===i.default.CALL_END_CODE.CANCEL&&(o.payload.callTransactionEnd.callQualityDiagnosticsInformation=n),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n,a){o.assertNotNull(e,"signalingSession cannot be null");var s=[];s=a.invitationType===i.default.INVITATION_TYPE.NUDGE&&Array.isArray(a.participantsToNudge)?a.participantsToNudge.map(function(e){return{id:e}}):e.participantManager.getParticipantsToInitiateCallWith(),e.signalingAgentConfig.doHostlessCalling||o.assert(s.length>0,"remoteParticipants need to be set before a call can be made");var c={type:e.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint",rosterUpdate:r.get(e,i.URL_PATH.CONV_ROSTER_UPDATE)},l=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,u=e.contentSharingManager.getContentSharingInfoToStartSharing(),d=null===u?null:{identifier:u.contentIdentifier,subject:u.subject,sessionState:u.sessionState,sessionUpdateSequenceNumber:u.sequenceNumber,links:{sessionUpdate:r.get(e,i.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,i.URL_PATH.CONV_CONTENT_SHARING_END)}},p=e.broadcastSession.getContext(),f=e.getEndpointCapabilities(a.enableLightWeightMeeting);1===s.length&&e.telemetryHelper.setCalleeType(s[0].id),e.numberOfOriginalInvitees=s.length;var h=[];s.forEach(function(t){var n={id:t.id};t.displayName&&(n.displayName=t.displayName),t.participantId&&(n.participantId=t.participantId),(a.callToVoicemail||e.transferContext&&e.transferContext.target&&"voicemail"===e.transferContext.target.endpointType)&&(n.endpointType="voicemail"),h.push(n)});var g=e.transferContext?e.transferContext.transferor:null,m={};a.callToVoicemail&&(a.voicemailResourcePath&&(m.localResourcePath=a.voicemailResourcePath),a.voicemailItemId&&(m.voicemailItemId=a.voicemailItemId));var v={payload:{conversationRequest:{conversationType:a.conversationType,subject:e.convSubject,suppressDialout:a.suppressDialout,applicationType:a.applicationType,roster:c,properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:e.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration},links:{conversationEnd:r.get(e,i.URL_PATH.CONV_END),conversationUpdate:r.get(e,i.URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE),addModalitySuccess:r.get(e,i.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:r.get(e,i.URL_PATH.CONV_ADD_MODALITY_FAILURE),confirmUnmute:r.get(e,i.URL_PATH.CONV_CONFIRM_UNMUTE)}},broadcast:p,contentSharing:d,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,meetingRegistrationId:a.meetingRegistrationId},to:h},capabilities:e.signalingAgentConfig.enableDeltaRosterWeb?null:f,endpointCapabilities:e.signalingAgentConfig.enableDeltaRosterWeb?f:null,clientEndpointCapabilities:a.clientEndpointCapabilities?a.clientEndpointCapabilities:null,endpointMetadata:e.endpointMetadata,groupChat:l,meetingInfo:e.getMeetingInfo(),meetingData:a.meetingData,meetingPreferences:a.meetingPreferences,endpointState:a.endpointState}};if(e.deviceType&&"default"!==e.deviceType&&(v.payload.conversationRequest.deviceType=e.deviceType),a.enableLightWeightMeeting)v.payload.lwj={end:r.get(e,i.URL_PATH.LWJ_END),acceptance:r.get(e,i.URL_PATH.LWJ_ACCEPTANCE)};else{var y=o.getMediaTypes(n);e.telemetryHelper.addOutgoingModalities(y),v.payload.callInvitation={callModalities:y,replaces:null,transferor:g||null,links:{progress:r.get(e,i.URL_PATH.PROGRESS),mediaAnswer:r.get(e,i.URL_PATH.MEDIA_ANSWER),acceptance:r.get(e,i.URL_PATH.ACCEPT),redirection:r.get(e,i.URL_PATH.REDIRECTION),end:r.get(e,i.URL_PATH.END)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),pstnContent:e.pstnContent,emergencyContent:e.getEmergencyContent(),mediaContent:t,voicemailSettings:m,routingFlags:a.routingFlags,invitationData:a.invitationData,locationContent:e.getLocationContent(),networkContent:e.getNetworkContent(),areaContent:e.getAreaContent()},a.pickupCode&&(v.payload.callInvitation.unparkContent={pickupCode:parseInt(a.pickupCode,10)}),a.onBehalfOf&&(v.payload.callInvitation.onBehalfOf={id:a.onBehalfOf}),a.scenario&&(v.payload.conversationRequest.scenario=a.scenario),a.alternateId&&(v.payload.participants.from.alternateId=a.alternateId)}if(a.invitationType===i.default.INVITATION_TYPE.NUDGE&&(v.payload.participants.invitationType=a.invitationType),e.signalingAgentConfig.ecsEtag&&(v.payload.debugContent={ecsEtag:e.signalingAgentConfig.ecsEtag}),a.clientEndpointDebugContent){v.payload.debugContent||(v.payload.debugContent={});try{v.payload.debugContent.clientDebugContent=JSON.parse(a.clientEndpointDebugContent)}catch(e){o.assert(!1,"Failed to parse "+a.clientEndpointDebugContent)}}return v}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0);t.getPayload=function(e,t){return r.assertNotNull(e,"signalingSession cannot be null"),r.assertCallEndReason(t),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:i.default.CALL_END_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED},callTransactionEnd:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPayload=function(e,t){return{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n,a){o.assertNotNull(e,"signalingSession cannot be null");var s={type:e.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint",rosterUpdate:r.get(e,i.URL_PATH.CONV_ROSTER_UPDATE)},c=e.getEndpointCapabilities(a.enableLightWeightMeeting),l=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,u={payload:{conversationRequest:{conversationType:a.conversationType,subject:e.convSubject,suppressDialout:a.suppressDialout,scenario:a.scenario,applicationType:a.applicationType,roster:s,properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:e.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration},links:{conversationEnd:r.get(e,i.URL_PATH.CONV_END),conversationUpdate:r.get(e,i.URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},groupChat:l,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId,meetingRegistrationId:a.meetingRegistrationId}},capabilities:e.signalingAgentConfig.enableDeltaRosterWeb?null:c,endpointCapabilities:e.signalingAgentConfig.enableDeltaRosterWeb?c:null,clientEndpointCapabilities:a.clientEndpointCapabilities?a.clientEndpointCapabilities:null,endpointMetadata:e.endpointMetadata,meetingInfo:e.getMeetingInfo(),meetingData:a.meetingData,meetingPreferences:a.meetingPreferences,endpointState:a.endpointState}};if(e.deviceType&&"default"!==e.deviceType&&(u.payload.conversationRequest.deviceType=e.deviceType),!a.subscribe&&!a.enableLightWeightMeeting){var d=o.getMediaTypes(n);e.telemetryHelper.addOutgoingModalities(d),u.payload.callInvitation={callModalities:d,replaces:null,transferor:null,links:{progress:r.get(e,i.URL_PATH.PROGRESS),mediaAnswer:r.get(e,i.URL_PATH.MEDIA_ANSWER),acceptance:r.get(e,i.URL_PATH.ACCEPT),redirection:r.get(e,i.URL_PATH.REDIRECTION),end:r.get(e,i.URL_PATH.END)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent,locationContent:e.getLocationContent(),networkContent:e.getNetworkContent(),areaContent:e.getAreaContent()}}if(a.enableLightWeightMeeting&&(u.payload.lwj={end:r.get(e,i.URL_PATH.LWJ_END),acceptance:r.get(e,i.URL_PATH.LWJ_ACCEPTANCE)}),e.signalingAgentConfig.ecsEtag&&(u.payload.debugContent={ecsEtag:e.signalingAgentConfig.ecsEtag}),a.clientEndpointDebugContent){u.payload.debugContent||(u.payload.debugContent={});try{u.payload.debugContent.clientDebugContent=JSON.parse(a.clientEndpointDebugContent)}catch(e){o.assert(!1,"Failed to parse "+a.clientEndpointDebugContent)}}return u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0);t.getPayload=function(e,t,n,o){r.assertNotNull(e,"signalingSession cannot be null"),r.assertCallEndReason(t);var a={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:o&&"all"!==o?void 0:o},conversationTransactionEnd:{reason:"noError",code:i.default.CALL_END_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:t}};return n&&t.code===i.default.CALL_END_CODE.CANCEL&&(a.payload.callTransactionEnd.callQualityDiagnosticsInformation=n),a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n){return o.assertNotNull(e,"signalingSession cannot be null"),o.assertNotNull(n,"newOfferLink cannot be null"),{payload:{mediaOfferRequirements:{compatibleContentTypes:t,links:{offerReady:r.get(e,i.URL_PATH.NEW_MEDIA_OFFER)}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t){return o.assertNotNull(t,"signalingSession cannot be null"),{payload:{callTransfer:{target:{id:t.participantManager.localParticipant.id},transferor:{details:{id:t.participantManager.localParticipant.id,endpointId:t.participantManager.localParticipant.endpointId,participantId:t.participantManager.localParticipant.participantId,languageId:t.participantManager.localParticipant.languageId},authorizationToken:null},parkType:e,links:{transferAcceptance:r.get(t,i.URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:r.get(t,i.URL_PATH.TRANSFER_COMPLETION)}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e){return o.assertNotNull(e,"ParkRequestPayload: signalingSession cannot be null"),{payload:{hold:{holdType:"musicOnHold",links:{holdCompletion:r.get(e,i.URL_PATH.PARK_COMPLETION)}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e){return o.assertNotNull(e,"signalingSession cannot be null"),{payload:{callParticipantUpdate:{links:{mediaRenegotiation:r.get(e,i.URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,i.URL_PATH.TRANSFER),replacement:r.get(e,i.URL_PATH.REPLACE),end:r.get(e,i.URL_PATH.END),balanceUpdate:r.get(e,i.URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,i.URL_PATH.RETARGET_COMPLETION)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls()}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPayload=function(e,t,n,i,r,o,a){var s={payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},publishedState:{content:i,level:n,stateType:t,sequenceNumber:r},scope:o}};if(a&&a.length>0){var c=a.map(function(e){return{id:e}});s.payload.to=c}return s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{callEnd:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPayload=function(e,t,n,i,r){var o={from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},sequenceNumber:t,scope:n};return"specified"===n?o.stateIds=i:o.stateType=r,{payload:o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPayload=function(e,t){return{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},searchOptions:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPayload=function(){return{payload:{transferAcceptance:{}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e,t,n,a,s){return o.assertNotNull(t,"signalingSession cannot be null"),o.assertNotNullOrEmpty(e,"transferTarget cannot be null OR empty"),{payload:{callTransfer:{target:{id:e,endpointType:"TransferTypeVoicemail"===a?"voicemail":void 0},transferor:{details:{id:t.participantManager.localParticipant.id,endpointId:t.participantManager.localParticipant.endpointId,participantId:t.participantManager.localParticipant.participantId,languageId:t.participantManager.localParticipant.languageId},authorizationToken:null},links:{transferAcceptance:r.get(t,i.URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:r.get(t,i.URL_PATH.TRANSFER_COMPLETION)},replacementDetails:n,disableForwardingAndUnanswered:s&&s.disableForwardingAndUnanswered}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPayload=function(e){return{payload:{transferCompletion:e}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e){return o.assertNotNull(e,"ResumePayload: signalingSession cannot be null"),{payload:{resume:{links:{resumeCompletion:r.get(e,i.URL_PATH.UNPARK_COMPLETION)}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(t,"clientMetadataJson cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},endpointMetadata:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(t,"clientStateJson cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},endpointState:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e){return o.assertNotNull(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},links:{end:r.get(e,i.URL_PATH.LWJ_END),acceptance:r.get(e,i.URL_PATH.LWJ_ACCEPTANCE)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPayload=function(e,t,n){var i={};return void 0!==n.allowRaiseHands&&(i.allowRaiseHands=n.allowRaiseHands),void 0!==n.attendeeRestrictions&&(i.attendeeRestrictions=n.attendeeRestrictions),void 0!==n.lockMeeting&&(i.lockMeeting=n.lockMeeting),void 0!==n.breakoutRoomsEnabled&&(i.breakoutRoomsEnabled=n.breakoutRoomsEnabled),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},meetingSettings:i,sequenceNumber:t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(2),o=n(0);t.getPayload=function(e){o.assertNotNull(e,"signalingSession cannot be null");var t={type:e.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint",rosterUpdate:r.get(e,i.URL_PATH.CONV_ROSTER_UPDATE)};return{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},roster:t,links:{conversationEnd:r.get(e,i.URL_PATH.CONV_END),conversationUpdate:r.get(e,i.URL_PATH.CONV_UPDATE),confirmUnmute:r.get(e,i.URL_PATH.CONV_CONFIRM_UNMUTE)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{mediaAnswer:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaContent:t,pstnContent:e.pstnContent}}}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(146),a=n(1),s=n(8),c=n(0),l=n(5),u=n(149),d=function(){function e(e,t,n){var d=this;this.signalingSession=e,this.callStartTime=n,this.networkRequestsCompleted=[],this.networkRequestsStarted={},this.networkRequests={},this.localOperationsPerformed=[],this.recordedEvents=[],this.contentSharingOperationsPerformed={},this.outgoingModalities=[],this.incomingModalities=[],this.offeredModalities="",this.answeredModalities="",this.vbssOperations=[],this.vbssStarted=!1,this.localOfferAnswerGenerationTimestamps=[],this.trouterWaitOperations=[],this.telemetryData={},this.contentSharingBaseTelemetryData={},this.httpRequestTelemetryData={},this.connectedStopWatch=null,this.preheatedCallSetupDurationWatch=null,this.callCancelationDurationWatch=null,this.timeToRingStopWatch=null,this.isSdpInCallNotification=!1,this.isPreheated=0,this.addBrokerChannel=function(){d.setMessagingChannel(l.default.MESSAGING_CHANNEL.BROKER)},this.addTrouterChannel=function(){d.setMessagingChannel(l.default.MESSAGING_CHANNEL.TROUTER)},this.addTrouterWaitOperation=function(e){d.trouterWaitOperations.push(d.recordOperation(e))},this.recordIncomingEvent=function(e,t,n){var i=c.extractCauseIdFromMessage(t),r={origin:t.origin,causeId:i,data:n};n||delete r.data,d.recordEvent(e,r)},this.recordEvent=function(e,t){d.logger.debug("Event:",e,t),d.localOperationsPerformed.push(d.recordOperation(e));var n={};n[e]=d.timeSinceCallStart(),t&&(n.data=t),d.recordedEvents.push(n)},this.addOutgoingModalities=function(e){e&&d.outgoingModalities.push(e)},this.addIncomingModalities=function(e){e&&d.incomingModalities.push(e)},this.setOfferedModalities=function(e,t){d.offeredModalities=d.sdpTelemetryFormat(e,t)},this.setAnsweredModalities=function(e,t){d.answeredModalities=d.sdpTelemetryFormat(e,t)},this.setIsSdpInCallNotification=function(e){d.isSdpInCallNotification=e},this.addVbssOperations=function(e){e&&(e===l.default.VBSS_OPERATION.START?d.vbssStarted=!0:d.vbssStarted=!1,d.vbssOperations.push(d.recordOperation(e)))},this.addNetworkOperationStarted=function(e){c.tryAddNewKeyToHashTable(d.networkRequestsStarted,e,d.recordOperation(e))},this.addNetworkOperationCompleted=function(e,t,n){var i=t?l.default.RESULT_VALUE.SUCCESS:l.default.RESULT_VALUE.FAILURE;d.networkRequestsCompleted.push(d.recordOperation(e+":"+i+":"+n)),c.tryRemoveKeyFromHashTable(d.networkRequestsStarted,e)},this.updateNetworkRequest=function(e){d.networkRequests[e.uid]?r.assign(d.networkRequests[e.uid],e):d.networkRequests[e.uid]=e},this.deleteNetworkRequest=function(e){delete d.networkRequests[e.uid]},this.addContentSharingOperation=function(e,t,n){var i;d.contentSharingOperationsPerformed[e]||(d.contentSharingOperationsPerformed[e]=[]);var r=((i={})[t]=d.timeSinceCallStart(),i);d.contentSharingOperationsPerformed[e].push(r);var o=d.contentSharingOperationsPerformed[e].length-1;return n&&d.updateContentSharingOperation(e,o,n),o},this.updateContentSharingOperation=function(e,t,n){if(d.contentSharingOperationsPerformed[e]){for(var i=d.contentSharingOperationsPerformed[e][t],r=[],o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];r.push(s+": "+n[s])}i.data=r.join(", ")}},this.setDirection=function(e){d.telemetryData[l.default.EXTENSIONS.DIRECTION]=e},this.setEndPointId=function(e){d.telemetryData[l.default.CONTEXT_ID.ENDPOINT_ID]=e,d.contentSharingBaseTelemetryData[l.default.CONTEXT_ID.ENDPOINT_ID]=e,d.httpRequestTelemetryData[l.default.CONTEXT_ID.ENDPOINT_ID]=e},this.setParticipantId=function(e){d.telemetryData[l.default.CONTEXT_ID.PARTICIPANT_ID]=e,d.contentSharingBaseTelemetryData[l.default.CONTEXT_ID.PARTICIPANT_ID]=e,d.httpRequestTelemetryData[l.default.CONTEXT_ID.PARTICIPANT_ID]=e},this.setConversationServiceUrl=function(e){d.telemetryData[l.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=e},this.setMeetingInfo=function(e){e||(d.telemetryData[l.default.EXTENSIONS.MEETING_INFO]=e)},this.setSelfParticipantRole=function(e){d.telemetryData[l.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]=e},this.setScenario=function(e){d.telemetryData[l.default.EXTENSIONS.SCENARIO]=e},this.setCallerType=function(e){e&&(d.telemetryData[l.default.EXTENSIONS.CALLER_TYPE]=e.split(":",1)[0])},this.setCalleeType=function(e){e&&(d.telemetryData[l.default.EXTENSIONS.CALLEE_TYPE]=e.split(":",1)[0])},this.setTerminatingData=function(e){d.telemetryData[l.default.EXTENSIONS.CALL_TERMINATING_END]=e.terminatingEnd,d.telemetryData[l.default.EXTENSIONS.CALL_END_CODE]=e.endCode||a.default.CALL_END_CODE.SUCCESS,d.telemetryData[l.default.EXTENSIONS.CALL_END_SUB_CODE]=e.endSubCode||a.default.CALL_END_SUB_CODE.SUCCESS,d.telemetryData[l.default.EXTENSIONS.RESULT_VALUE]=e.resultValue||l.default.RESULT_VALUE.SUCCESS,d.telemetryData[l.default.EXTENSIONS.RESULT_DETAIL]=e.resultDetail||"Call gracefully hungup",d.telemetryData[l.default.EXTENSIONS.RESULT_CAUSE_ID]=e.causeId||"unknown",d.telemetryData[l.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=e.resultCategories||[],d.telemetryData[l.default.EXTENSIONS.CALL_END_CLIENT_SUB_CODE]=e.clientReasonSubCode,d.telemetryData[l.default.EXTENSIONS.CALL_END_CLIENT_PHRASE]=e.clientReasonPhrase},this.startCallInitializationWatch=function(e){d.timeToRingStopWatch=s.build(),e&&(d.timeToRingStopWatch.msElapsed+=e)},this.startCallConnectedWatch=function(){d.connectedStopWatch=s.build()},this.setIsPreheated=function(){d.isPreheated=1},this.startPreheatedCallSetupDurationWatch=function(){d.preheatedCallSetupDurationWatch=s.build()},this.stopPreheatedCallSetupDurationWatch=function(){d.preheatedCallSetupDurationWatch.pause()},this.startCallCancelationDurationWatch=function(){d.callCancelationDurationWatch=s.build()},this.stopCallCancelationDurationWatch=function(){d.callCancelationDurationWatch&&d.callCancelationDurationWatch.pause()},this.getCallCancelationDuration=function(){return d.callCancelationDurationWatch?d.callCancelationDurationWatch.durationInSeconds():0},this.resetCallCancelationDurationWatch=function(){d.callCancelationDurationWatch=null},this.setOfferAnswerGenerationTimestamps=function(e){d.localOfferAnswerGenerationTimestamps.push(d.recordOperation(e))},this.setTimeToRingDuration=function(){d.timeToRingStopWatch&&(d.telemetryData[l.default.EXTENSIONS.TIME_TO_RING_IN_MS]=d.timeToRingStopWatch.duration(),d.timeToRingStopWatch=null)},this.dispose=function(){d.sendCallModalityTelemetryData(),d.sendHttpTelemetryData()},this.setMessagingChannel=function(e){d.telemetryData[l.default.EXTENSIONS.MESSAGING_CHANNEL]||(d.telemetryData[l.default.EXTENSIONS.MESSAGING_CHANNEL]=[]),d.telemetryData[l.default.EXTENSIONS.MESSAGING_CHANNEL].some(function(t){return-1!==t.indexOf(e)})||d.telemetryData[l.default.EXTENSIONS.MESSAGING_CHANNEL].push(d.recordOperation(e))},this.sendHttpTelemetryData=function(){var e=i({},d.httpRequestTelemetryData);e[l.default.CONTEXT_ID.CORRELATION_ID]=d.signalingSession.correlationId,e[l.default.CONTEXT_ID.SIGNALING_SESSION_ID]=d.signalingSession.sessionId,e[l.default.EXTENSIONS.CLIENT_INFORMATION]=d.signalingSession.signalingAgentConfig.clientInformation;var t=Object.keys(d.networkRequests).map(function(e){return delete d.networkRequests[e].uid,d.networkRequests[e]}),n=JSON.stringify({eventStart:d.callStartTime,events:t});e[l.default.EXTENSIONS.NETWORK_REQUESTS_BAG]=n,d.telemetryLogger.logHttpTelemetryEvent(e)},this.sdpTelemetryFormat=function(e,t){if(!e)return"";for(var n=function(e){switch(e){case"main-audio":return"Audio";case"main-video":return"Video";case"applicationsharing-video":return"AppSharing";default:return}},i=function(e){switch(e){case"inactive":return"Inactive";case"sendonly":return t?"ReceiveFromPeer":"SendToPeer";case"recvonly":return t?"SendToPeer":"ReceiveFromPeer";case"sendrecv":default:return"Bidirectional"}},r={"main-audio":0,"main-video":0,"applicationsharing-video":0},a=[],s=0,c=o.parse(e).media;s<c.length;s++){var l=c[s],u=n(l.label);if(u){var d=r[l.label]++,p=i(l.direction);a.push(u+"["+d+"] = "+p)}}return a.join(", ")},this.logger=e.logger,this.telemetryLogger=u.getLogger(e,this.logger),this.telemetryData[l.default.EXTENSIONS.CALL_START_TIME]=this.callStartTime,this.telemetryData[l.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=e.signalingAgentConfig.conversationServiceUrl,this.fillCommonData(t,this.telemetryData),this.fillCommonData(t,this.httpRequestTelemetryData),this.fillCommonData(t,this.contentSharingBaseTelemetryData)}return e.prototype.fillCommonData=function(e,t){t[l.default.EXTENSIONS.APPLICATION_TYPE]=e.applicationType,t[l.default.EXTENSIONS.RING]=e.ring,t[l.default.EXTENSIONS.TENANT_ID]=e.tenantId,t[l.default.EXTENSIONS.ACS_RESOURCE_ID]=e.acsResourceId,t[l.default.EXTENSIONS.REGION]=e.region,t[l.default.EXTENSIONS.PARTITION]=e.partition},e.prototype.addChangingCorrelationId=function(e,t){this.telemetryData[l.default.EXTENSIONS.CHANGING_CORRELATION_ID_OLD_ID]=e,this.telemetryData[l.default.EXTENSIONS.CHANGING_CORRELATION_ID_NEW_ID]=t},e.prototype.addSharedCorrelationId=function(e){this.telemetryData[l.default.CONTEXT_ID.SHARED_CORRELATION_ID]=e},e.prototype.sendContentSharingTelemetryData=function(e,t,n,r,o,a){var s=i({},this.contentSharingBaseTelemetryData),c=this.contentSharingOperationsPerformed[e];c&&(s[l.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=JSON.stringify(c)),s[l.default.CONTEXT_ID.CONTENT_SHARING_CORRELATION_ID]=e,s[l.default.CONTEXT_ID.SIGNALING_SESSION_ID]=t,s[l.default.CONTEXT_ID.CONTENT_SHARING_ID]=a||"",s[l.default.EXTENSIONS.CONTENT_SHARING_SERVICE_URL]=o,s[l.default.EXTENSIONS.CONTENT_SHARING_DIRECTION]=n?l.default.DIRECTION.OUTGOING:l.default.DIRECTION.INCOMING,s[l.default.EXTENSIONS.CALL_END_CODE]=r.code,s[l.default.EXTENSIONS.CALL_END_SUB_CODE]=r.subCode,s[l.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=this.getResultCategoryString(r.resultCategories),s[l.default.EXTENSIONS.CALL_END_CAUSE_ID]=r.causeId,s[l.default.EXTENSIONS.CLIENT_INFORMATION]=this.signalingSession.signalingAgentConfig.clientInformation,delete this.contentSharingOperationsPerformed[e],this.telemetryLogger.logConversationContentSharingEvent(s)},e.prototype.recordOperation=function(e){return e+":"+this.timeSinceCallStart()},e.prototype.timeSinceCallStart=function(){return(new Date).getTime()-this.callStartTime},e.prototype.sendCallModalityTelemetryData=function(){this.vbssStarted&&this.addVbssOperations(l.default.VBSS_OPERATION.CALL_END);var e=function(e){return"number"==typeof e?e/1e3:0};if(this.telemetryData[l.default.EXTENSIONS.CLIENT_INFORMATION]=this.signalingSession.signalingAgentConfig.clientInformation,this.telemetryData[l.default.EXTENSIONS.CALL_END_TIME]=(new Date).getTime(),this.connectedStopWatch&&(this.telemetryData[l.default.EXTENSIONS.CONNECTED_DURATION_IN_MS]=this.connectedStopWatch.duration()),this.telemetryData[l.default.EXTENSIONS.IS_PREHEATED]=this.isPreheated,this.preheatedCallSetupDurationWatch&&(this.telemetryData[l.default.EXTENSIONS.PREHEATED_CALL_SETUP_DURATION_IN_S]=e(this.preheatedCallSetupDurationWatch.duration())),this.callCancelationDurationWatch&&(this.telemetryData[l.default.EXTENSIONS.CALL_CANCELATION_DURATION_IN_S]=e(this.callCancelationDurationWatch.duration())),this.networkRequestsCompleted.length&&(this.telemetryData[l.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=JSON.stringify(this.networkRequestsCompleted)),this.localOperationsPerformed.length&&(this.telemetryData[l.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=JSON.stringify(this.localOperationsPerformed)),this.trouterWaitOperations.length&&(this.telemetryData[l.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS]=JSON.stringify(this.trouterWaitOperations)),this.localOfferAnswerGenerationTimestamps.length&&(this.telemetryData[l.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]=JSON.stringify(this.localOfferAnswerGenerationTimestamps)),this.incomingModalities.length&&(this.telemetryData[l.default.EXTENSIONS.INCOMING_MODALITIES]=JSON.stringify(this.incomingModalities)),this.outgoingModalities.length&&(this.telemetryData[l.default.EXTENSIONS.OUTGOING_MODALITIES]=JSON.stringify(this.outgoingModalities)),this.offeredModalities.length&&(this.telemetryData[l.default.EXTENSIONS.OFFERED_MODALITIES]=this.offeredModalities),this.answeredModalities.length&&(this.telemetryData[l.default.EXTENSIONS.ANSWERED_MODALITIES]=this.answeredModalities),this.telemetryData[l.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=this.getResultCategoryString(this.telemetryData[l.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]),this.telemetryData[l.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION]=this.isSdpInCallNotification.toString(),this.vbssOperations.length&&(this.telemetryData[l.default.EXTENSIONS.VBSS_OPERATIONS]=JSON.stringify(this.vbssOperations)),this.recordedEvents.length){var t=JSON.stringify({eventStart:this.callStartTime,events:this.recordedEvents});this.telemetryData[l.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=t}for(var n=[],i=0,r=Object.keys(this.networkRequestsStarted);i<r.length;i++){var o=r[i];n.push(this.networkRequestsStarted[o])}n.length>0&&(this.telemetryData[l.default.EXTENSIONS.NETWORK_REQUESTS_PENDING]=JSON.stringify(n)),this.telemetryLogger.logConversationCallModalityEvent(this.telemetryData)},e.prototype.getResultCategoryString=function(e){return e&&Array.isArray(e)?e.join(","):""},e}();t.default=d},function(e,t,n){var i=n(147),r=n(148);t.write=r,t.parse=i.parse,t.parseParams=i.parseParams,t.parseFmtpConfig=i.parseFmtpConfig,t.parsePayloads=i.parsePayloads,t.parseRemoteCandidates=i.parseRemoteCandidates,t.parseImageAttributes=i.parseImageAttributes,t.parseSimulcastStreamList=i.parseSimulcastStreamList},function(e,t,n){var i=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;!function(e,t,n,r){if(r&&!n)t[r]=i(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=i(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=n(36),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),i=n[n.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return r(c,i,a)}}),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=i(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(i),r=0;r<n.length;r+=3)t.push({component:n[r],ip:n[r+1],port:n[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var i=n(36),r=/%[sdv%]/g,o=function(e){var t=1,n=arguments,i=n.length;return e.replace(r,function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},a=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var a=t.names[r];t.name?i.push(n[t.name][a]):i.push(n[t.names[r]])}else i.push(n[t.name]);return o.apply(null,i)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,r=t.innerOrder||c,o=[];return n.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})}),e.media.forEach(function(e){o.push(a("m",i.m[0],e)),r.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})})}),o.join("\r\n")+"\r\n"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),r=n(5),o=function(){function e(e,t){var n=this;this.signalingSession=e,this.logger=t,this.logConversationCallModalityEvent=function(e){var t=n.createCallModalityEvent(e);n.logger.info("sending modality telemetry:",n.getStringifiedEventData(t)),t.hostName=location.host,n.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(r.default.EVENT_TYPE.CONVERSATION_CALL_MODALITY,t)},this.logConversationContentSharingEvent=function(e){e[r.default.CONTEXT_ID.CORRELATION_ID]=n.signalingSession.correlationId,e[r.default.EXTENSIONS.ECS_ETAG]=n.signalingSession.signalingAgentConfig.ecsEtag,n.logger.info("sending content sharing telemetry:",n.getStringifiedEventData(e)),e.hostName=location.host,n.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(r.default.EVENT_TYPE.CONVERSATION_CONTENT_SHARING,e)},this.logHttpTelemetryEvent=function(e){e[r.default.EXTENSIONS.ECS_ETAG]=n.signalingSession.signalingAgentConfig.ecsEtag,e[r.default.SIGNALING_CONFIG]=n.getSignalingAgentConfig(),n.logger.info("sending http telemetry:",n.getStringifiedEventData(e)),e.hostName=location.host,n.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(r.default.EVENT_TYPE.CONVERSATION_HTTP_REQUEST,e)},this.getSignalingAgentConfig=function(){var e=[],t=n.signalingSession.signalingAgentConfig;return t.supportsCompressedServicePayload&&e.push(r.default.SIGNALING_CONFIG_FLAGS.SUPPORTS_COMPRESSED_PAYLOAD),t.brokerEnabledOutgoing&&e.push(r.default.SIGNALING_CONFIG_FLAGS.BROKER_OUTGOING_ENABLED),t.brokerEnabledIncoming&&e.push(r.default.SIGNALING_CONFIG_FLAGS.BROKER_INCOMING_ENABLED),t.brokerRequestBatching&&e.push(r.default.SIGNALING_CONFIG_FLAGS.BROKER_REQUEST_BATCHING_ENABLED),t.brokerExclusively&&e.push(r.default.SIGNALING_CONFIG_FLAGS.BROKER_EXCLUSIVELY_ENABLED),t.supportsSynchronousTrouterResponse&&e.push(r.default.SIGNALING_CONFIG_FLAGS.SYNC_TROUTER_RESPONSE),t.handleMediaOfferFromPushNotification&&e.push(r.default.SIGNALING_CONFIG_FLAGS.HANDLE_OFFER_FROM_NOTIFICATION),t.handleNewOfferRequest&&e.push(r.default.SIGNALING_CONFIG_FLAGS.HANDLE_NEW_OFFER_REQUEST),t.sendProgressFromCC&&e.push(r.default.SIGNALING_CONFIG_FLAGS.SEND_PROGRESS_FROM_CC),t.handleUnmuteMuteFromResponse&&e.push(r.default.SIGNALING_CONFIG_FLAGS.HANDLE_UNMUTE_MUTE_FROM_RESPONSE),t.useInternalHttpDispatcher&&e.push(r.default.SIGNALING_CONFIG_FLAGS.INTERNAL_HTTP_DISPATCHER),t.enableTokenCache&&e.push(r.default.SIGNALING_CONFIG_FLAGS.ENABLE_TOKEN_CACHE),t.enableTokenPrefetch&&e.push(r.default.SIGNALING_CONFIG_FLAGS.ENABLE_TOKEN_PREFETCH),t.processSelfDataFromSubscribeResponse&&e.push(r.default.SIGNALING_CONFIG_FLAGS.PROCESS_SELF_DATA_FROM_SUBSCRIBE_RESPONSE),e.push(r.default.SIGNALING_CONFIG_FLAGS.SERVER_MUTE_UNMUTE),e.join(",")},this.getStringifiedEventData=function(e){try{return JSON.stringify(e)}catch(e){return"invalid data"}}}return e.prototype.createCallModalityEvent=function(e){var t={};t.Type=r.default.SOURCE.NGC_SOURCE;var n=function(n,i){void 0===i&&(i=!1),e.hasOwnProperty(n)&&(t[n]=i?JSON.stringify(e[n]):e[n])};return t.ResultDetail=e[r.default.EXTENSIONS.RESULT_DETAIL],t.ResultValue=e[r.default.EXTENSIONS.RESULT_VALUE],t.ResultCode=e[r.default.EXTENSIONS.CALL_END_CODE],t.ResultCauseId=e[r.default.EXTENSIONS.RESULT_CAUSE_ID],t[r.default.SIGNALING_CONFIG]=this.getSignalingAgentConfig(),t[r.default.CONTEXT_ID.CORRELATION_ID]=this.signalingSession.correlationId,t[r.default.CONTEXT_ID.SIGNALING_SESSION_ID]=this.signalingSession.sessionId,t[r.default.CONTEXT_ID.ENDPOINT_ID]=e[r.default.CONTEXT_ID.ENDPOINT_ID],t[r.default.CONTEXT_ID.PARTICIPANT_ID]=e[r.default.CONTEXT_ID.PARTICIPANT_ID],t[r.default.EXTENSIONS.ECS_ETAG]=this.signalingSession.signalingAgentConfig.ecsEtag,t[r.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=e[r.default.EXTENSIONS.CONVERSATION_SERVICE_URL],t[r.default.EXTENSIONS.CALL_START_TIME]=JSON.stringify(e[r.default.EXTENSIONS.CALL_START_TIME]),t[r.default.EXTENSIONS.CALL_END_TIME]=JSON.stringify(e[r.default.EXTENSIONS.CALL_END_TIME]),t[r.default.EXTENSIONS.MESSAGING_CHANNEL]=JSON.stringify(e[r.default.EXTENSIONS.MESSAGING_CHANNEL]),t[r.default.EXTENSIONS.IS_GROUP_CALL]=this.signalingSession.multiParty?"true":"false",t[r.default.EXTENSIONS.IS_HOSTLESS_CALL]=this.signalingSession.isHostLessCall?"true":"false",t[r.default.EXTENSIONS.IS_CAST_CALL]=this.signalingSession.isCastCall?"true":"false",t[r.default.EXTENSIONS.IS_ON_BEHALF_OF_CALL]=this.signalingSession.onBehalfOf?"true":"false",t[r.default.EXTENSIONS.CLIENT_INFORMATION]=e[r.default.EXTENSIONS.CLIENT_INFORMATION],t[r.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION]=e[r.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION],t[r.default.EXTENSIONS.CALL_TERMINATING_END]=e[r.default.EXTENSIONS.CALL_TERMINATING_END],t[r.default.EXTENSIONS.CALL_END_CODE]=JSON.stringify(e[r.default.EXTENSIONS.CALL_END_CODE]),t[r.default.EXTENSIONS.CALL_END_SUB_CODE]=JSON.stringify(e[r.default.EXTENSIONS.CALL_END_SUB_CODE]),n(r.default.CONTEXT_ID.SHARED_CORRELATION_ID),n(r.default.EXTENSIONS.DIRECTION),n(r.default.EXTENSIONS.SELF_PARTICIPANT_ROLE),n(r.default.EXTENSIONS.CONNECTED_DURATION_IN_MS,!0),n(r.default.EXTENSIONS.TIME_TO_RING_IN_MS,!0),n(r.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED),n(r.default.EXTENSIONS.NETWORK_REQUESTS_PENDING),n(r.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED),n(r.default.EXTENSIONS.EVENT_TIMESTAMP_BAG),n(r.default.EXTENSIONS.NETWORK_REQUESTS_BAG),n(r.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS),n(r.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS),n(r.default.EXTENSIONS.OUTGOING_MODALITIES),n(r.default.EXTENSIONS.INCOMING_MODALITIES),n(r.default.EXTENSIONS.OFFERED_MODALITIES),n(r.default.EXTENSIONS.ANSWERED_MODALITIES),n(r.default.EXTENSIONS.VBSS_OPERATIONS),n(r.default.EXTENSIONS.CALLER_TYPE),n(r.default.EXTENSIONS.CALLEE_TYPE),n(r.default.EXTENSIONS.SCENARIO),n(r.default.EXTENSIONS.PREHEATED_CALL_SETUP_DURATION_IN_S),n(r.default.EXTENSIONS.CALL_CANCELATION_DURATION_IN_S),n(r.default.EXTENSIONS.IS_PREHEATED),n(r.default.EXTENSIONS.ACS_RESOURCE_ID),n(r.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES),this.signalingSession.callType&&(t[r.default.EXTENSIONS.CALL_TYPE]=this.signalingSession.callType),this.signalingSession.signalingAgentConfig.testCall&&(t[r.default.EXTENSIONS.TEST_CONTEXT_ID]="Test"),this.signalingSession.threadId&&(t[r.default.CONTEXT_ID.THREAD_ID]=i.getLoggableThreadId(this.signalingSession.threadId)),this.signalingSession.teamsMessageId&&(t[r.default.CONTEXT_ID.TEAMS_MESSAGEID]=this.signalingSession.teamsMessageId),this.signalingSession.getMeetingInfo()&&(t[r.default.CONTEXT_ID.TEAMS_MEETINGINFO]=JSON.stringify(this.signalingSession.getMeetingInfo())),this.signalingSession.multiParty&&0===this.signalingSession.numberOfOriginalInvitees&&e.hasOwnProperty(r.default.EXTENSIONS.SELF_PARTICIPANT_ROLE)&&e[r.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]===r.default.ROLE.CALLER&&(t[r.default.EXTENSIONS.IS_MEETUP_CALL]="true"),t},e}();t.TelemetryLogger=o,t.getLogger=function(e,t){return new o(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(5),o=n(1),a=n(2),s=n(0),c=function(){function e(e,t){var n=this;this.disposed=!1,this.lastSeenSeqNumbers={},this.getClientUrls=function(){var e=null;return n.isWebRtcCall&&(e={controlVideoStreaming:a.get(n.signalingSession,o.URL_PATH.CONTROL_VIDEO_STREAMING),dominantSpeakerInfo:a.get(n.signalingSession,o.URL_PATH.DOMINANT_SPEAKER_INFO),csrcInfo:a.get(n.signalingSession,o.URL_PATH.CSRC_INFO)}),e},this.handleDominantSpeakerInfo=function(e){var t=e.body;n.logger.debug("handleDominantSpeakerInfo : ",i.getPrintableObject(t)),n.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_DOMINANT_SPEAKER_INFO,e),n.handleWebRtcNotification(o.default.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO,t.dominantSpeakerInformation)},this.handleControlVideoStreaming=function(e){var t=e.body;n.logger.debug("handleControlVideoStreaming: ",i.getPrintableObject(t)),n.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CONTROL_VIDEO_STREAMING,e),n.handleWebRtcNotification(o.default.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING,t.controlVideoStreaming)},this.handleCsrcInfo=function(e){var t=e.body;n.logger.debug("handleCsrcInfo : ",i.getPrintableObject(t)),n.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CSRC_INFO,e),n.handleWebRtcNotification(o.default.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO,t.csrcInfo)},this.sendWebRtcMediaNotificationAsync=function(e,t){var r=e.operation,a=e.requestUrl,c=e.requestBody,l=e.stackRetry,u=void 0===l||l;n.logger.info("sendWebRtcMediaNotificationAsync"),s.assert(n.isWebRtcCall,"this is not a webrtc call"),s.assertNotNullOrEmpty(a,"correct media notification requestUrl is not provided"),s.assertNotNullOrEmpty(c,"media notification requestBody cannot be null or empty");var d=s.defer(),p={url:a,payload:{payload:c},requestName:r,withoutTrouter:!0,causeId:t};return u||(p.disableRetry=!0),n.signalingSession.http.sendPostRequest(p).then(function(){n.disposed||d.resolve()}).catch(function(e){var t=i.getPrintableObject(e);if(n.logger.error("sendWebRtcMediaNotificationAsync failed because : "+t),!n.disposed){var r=new Error(e);r.endCode=o.default.CALL_END_NETWORK_ERROR,d.reject(r)}}),d.promise},this.dispose=function(){n.logger.info("WebRtcSignalingManager :: dispose"),n.disposed=!0},this.signalingSession=e,this.signalingSessionCallback=t,this.isWebRtcCall=e.signalingAgentConfig.isWebRtcEnabled,this.logger=e.logger,this.lastSeenSeqNumbers[o.default.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING]=-1,this.lastSeenSeqNumbers[o.default.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO]=-1,this.lastSeenSeqNumbers[o.default.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO]=-1}return e.prototype.handleWebRtcNotification=function(e,t){s.assert(this.isWebRtcCall,"ignoring message in non-webrtc call");var n=this.lastSeenSeqNumbers[e];t.sequenceNumber<=n?this.logger.info("ignoring "+e+" . Last seen seq = "+n+" current seq = "+t.sequenceNumber):(this.lastSeenSeqNumbers[e]=t.sequenceNumber,this.signalingSessionCallback.onWebRtcMediaNotification(e,t))},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=this;this.getRequestOptions=function(e,t,i,r){return{headers:t||{},timeout:r,retry:{delay:1e3,enabled:!0,limit:3,strategy:"fixed",isTransientCheck:n.transientFaultPolicy.isTransientFailure,isSuccessCheck:n.transientFaultPolicy.isWebApiSuccess},reporting:{serviceName:"ngcCallController-"+(e||"")},payload:i||null}},this.getAsync=function(e,t){return n.salRequestDispatcher.get(e,t)},this.postAsync=function(e,t){return n.salRequestDispatcher.post(e,t)},this.putAsync=function(e,t){return n.salRequestDispatcher.put(e,t)},this.removeAsync=function(e,t){return n.salRequestDispatcher.remove(e,t)},this.salRequestDispatcher=e,this.transientFaultPolicy=t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.appTelemetryManager=e,this.skypeConcoreToken=t}return e.prototype.sendEvent=function(e,t){this.appTelemetryManager.sendEvent(this.skypeConcoreToken,e,t)},e}();t.default=i}]))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=n(26),c=n(11),l=n(17),u=n(16),d=n(32);!function(e){e.Pending="Pending",e.Success="Success",e.Failure="Failure"}(o||(o={})),function(e){e[e.Event=0]="Event",e[e.Operation=1]="Operation"}(a||(a={}));var p=function(){function e(e,t,n,i,r){this.eventName=e,this.eventStartTime=t,this.type=n,this.causeId=i,this.status=o.Pending,this.eventStartTimestamp=(new Date).getTime(),this.data=[],this.type===a.Event&&delete this.status,r&&this.data.push(r)}return Object.defineProperty(e.prototype,"variant",{set:function(e){this.eventVariant=e},enumerable:!0,configurable:!0}),e.prototype.recordSuccess=function(e,t){this.recordResult(!0,e,t)},e.prototype.recordFailure=function(e,t){this.recordResult(!1,e,t)},e.prototype.addData=function(e){this.data.push(e)},e.prototype.isPending=function(){return this.status===o.Pending},e.prototype.getEvent=function(){var e,t=this,n={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.result,causeId:this.causeId,resultCauseId:this.resultCauseId,variant:this.eventVariant,data:this.data.map(function(e){return t.prepareData(e,!0)}).filter(function(e){return!!e})};return this.type===a.Event&&delete n.status,n.data.length||delete n.data,n.causeId||delete n.causeId,n.resultCauseId||delete n.resultCauseId,n.result||delete n.result,n.variant||delete n.variant,(e={})[this.eventName]=n,e},e.prototype.recordResult=function(e,t,n){this.status=e?o.Success:o.Failure,this.result=this.prepareData(t),this.causeId!==n&&(this.resultCauseId=n),this.duration=(new Date).getTime()-this.eventStartTimestamp},e.prototype.prepareData=function(e,t){void 0===t&&(t=!1);var n=typeof e;if(null==e)return"";if("string"===n)return u.scrubMriOrOmit(e);if("number"===n||"boolean"===n)return String(e);if("function"===n)return"";if(e instanceof Error)return e.toString();try{return Object.keys(e).length?t?e:l.getPIISafeObject(e):""}catch(e){return"invalid"}},e}();!function(e){e.LOCAL="Local",e.REMOTE="Remote"}(t.CALL_TERMINATING_END||(t.CALL_TERMINATING_END={})),function(e){e.SUCCESS="Success",e.FAILURE="Failure"}(t.RESULT_VALUE||(t.RESULT_VALUE={})),function(e){e.INCOMING="Incoming",e.OUTGOING="Outgoing"}(t.DIRECTION||(t.DIRECTION={})),function(e){e.CALLER="caller",e.CALLEE="callee",e.JOIN="join",e.SUBSCRIBE="SUBSCRIBE"}(t.SELF_PARTICIPANT_ROLE||(t.SELF_PARTICIPANT_ROLE={}));var f=function(){function e(e,t,n){this.logger=e,this.startTime=t,this.maxEventsExceeded=n,this.recordedEvents=[],this.ongoingOperations={}}return e.prototype.recordEvent=function(e,t,n){void 0===n&&(n=c.generateCauseId()),this.logger.debug("Event:",e,s.pii.Omit(t));var i=new p(e,this.getEventStartTime(),a.Event,n,t);return this.pushToRecordedEvents(i),i},e.prototype.recordOperationSuccess=function(e,t,n,i){void 0===t&&(t=null),this.logger.info("Event success:",i,e,s.pii.Omit(n),s.pii.Omit(t)),this.recordOperationResult(e,t,!0,n,i)},e.prototype.recordOperationFailure=function(e,t,n,i){this.logger.info("Event failure:",e,s.pii.Omit(n),t),this.recordOperationResult(e,t,!1,n,i)},e.prototype.maybeRecordOperationSuccess=function(e,t,n,i){void 0===t&&(t=null),this.hasOngoingEvent(e,n)&&this.recordOperationSuccess(e,t,n,i)},e.prototype.maybeRecordOperationFailure=function(e,t,n,i){this.hasOngoingEvent(e,n)&&this.recordOperationFailure(e,t,n,i)},e.prototype.recordOperationResult=function(e,t,n,i,r){this.hasOngoingEvent(e,i)||this.recordOperation(e,r,i);var o=this.ongoingOperations[e];i&&(o=o[i]),n?o.recordSuccess(t,r):o.recordFailure(t,r),i?delete this.ongoingOperations[e][i]:delete this.ongoingOperations[e]},e.prototype.recordOperation=function(e,t,n,i){this.logger.debug("Event create: "+n,e,s.pii.Omit(n));var r=new p(e,this.getEventStartTime(),a.Operation,t,i);return this.ongoingOperations[e]||(this.ongoingOperations[e]={}),n?this.ongoingOperations[e][n]=r:this.ongoingOperations[e]=r,this.pushToRecordedEvents(r),r},e.prototype.setOperationVariant=function(e,t,n){var i;(i=n?this.ongoingOperations[e][n]:this.ongoingOperations[e])?i.variant=t:this.logger.error("Could not find operation "+e+" to set variant "+t)},e.prototype.updateOperationData=function(e,t,n,i){try{if(!this.ongoingOperations[e])return void this.recordEvent(e,t,n);i?this.ongoingOperations[e][i]&&this.ongoingOperations[e][i].addData(t):this.ongoingOperations[e].addData(t)}catch(t){return void this.logger.info("Unable to update operation: "+e+" data")}},e.prototype.pushToRecordedEvents=function(e){this.maxEventsExceeded&&this.maxEventsExceeded()&&this.recordedEvents.shift(),this.recordedEvents.push(e)},e.prototype.hasOngoingEvent=function(e,t){return this.ongoingOperations[e]?!(t&&!this.ongoingOperations[e][t]&&(this.logger.warn("Unable to find event for name\\id "+e+"\\"+s.pii.Omit(t)),1)):(this.logger.warn("Unable to find event for name "+e),!1)},e.prototype.getEventStartTime=function(){return(new Date).getTime()-this.startTime},e.prototype.getEventTimestampBag=function(e){var t=JSON.stringify({eventStart:this.startTime,events:this.recordedEvents.filter(function(t){return!e||!t.isPending()}).map(function(e){return e.getEvent()})});return this.logger.info("Call eventTimestampBag "+s.pii.Omit(t)),t},e}();t.TelemetryUtilities=f;var h=function(e){function t(t,n){var i=e.call(this,t,n,function(){return i.recordedEvents.length>150})||this;return i.getHostName=function(){try{return location.host}catch(e){return"unknown"}},i.tsCallingVersion=d.getTsCallingVersion(),i.logger=t.createChild("CallRegistryTelemetry"),i}return r(t,e),t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setParticipantId=function(e){this.participantId=e},t.prototype.setThreadId=function(e){this.threadId=e},t.prototype.setMesageId=function(e){this.messageId=e},t.prototype.setSkypeId=function(e){this.skypeId=e},t.prototype.setApplicationType=function(e){this.applicationType=e},t.prototype.setRing=function(e){this.ring=e},t.prototype.setTenantId=function(e){this.tenantId=e},t.prototype.setAcsResourceId=function(e){this.acsResourceId=e},t.prototype.setRegion=function(e){this.region=e},t.prototype.setPartition=function(e){this.partition=e},t.prototype.getEvent=function(e){var t=function(e){return void 0===e?"":e};return{EndpointId:t(this.endpointId),SkypeId:t(this.skypeId),ParticipantId:t(this.participantId),ThreadId:t(this.threadId),MessageId:t(this.messageId),ApplicationType:t(this.applicationType),Ring:t(this.ring),TenantId:t(this.tenantId),AcsResourceId:t(this.acsResourceId),Region:t(this.region),Partition:t(this.partition),TsCallingVersion:t(this.tsCallingVersion),HostName:this.getHostName(),EventTimestampBag:this.getEventTimestampBag(e),DiagnosticInfo:this.callEndDiagnosticInfo}},t}(f);t.CallRegistryTelemetry=h;var g=function(e){function t(t,n){var i=e.call(this,t,n,function(){return i.inCallMode&&i.recordedEvents.length>150})||this;return i.inCallMode=!1,i.getHostName=function(){try{return location.host}catch(e){return"unknown"}},i.tsCallingVersion=d.getTsCallingVersion(),i.logger=t.createChild("CallTelemetry"),i}return r(t,e),t.prototype.setCallId=function(e){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=e},t.prototype.setConsultativeCallId=function(e){this.consultativeCallId=e},t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setParticipantId=function(e){this.participantId=e},t.prototype.setPreheatFlags=function(e){this.preheatFlags=e},t.prototype.setCallOrigin=function(e){this.origin=e},t.prototype.setThreadId=function(e){this.threadId=e},t.prototype.setMesageId=function(e){this.messageId=e},t.prototype.setSkypeId=function(e){this.skypeId=e},t.prototype.setApplicationType=function(e){this.applicationType=e},t.prototype.setRing=function(e){this.ring=e},t.prototype.setTenantId=function(e){this.tenantId=e},t.prototype.setAcsResourceId=function(e){this.acsResourceId=e},t.prototype.setRegion=function(e){this.region=e},t.prototype.setPartition=function(e){this.partition=e},t.prototype.setFailureType=function(e){this.failureType=e},t.prototype.setIsCast=function(e){this.isCast=e?"True":"False"},t.prototype.setIsEmergency=function(e){this.isEmergency=e?"True":"False"},t.prototype.setRole=function(e){this.isAnonymous="admin"===e?"False":"True"},t.prototype.setCallType=function(e){this.callType=e},t.prototype.setConversationType=function(e){this.conversationType=e},t.prototype.setDirection=function(e){this.direction=e},t.prototype.setSelfParticipantRole=function(e){this.selfParticipantRole=e},t.prototype.setTerminationState=function(e){this.terminationState=e},t.prototype.setTerminationReason=function(e){this.terminationReason=e},t.prototype.setCallEndDiagnosticInfo=function(e){this.callEndDiagnosticInfo=e},t.prototype.setStackConfig=function(e){this.stackConfig=e},t.prototype.getEvent=function(e){var t=function(e){return void 0===e?"":e};return{CorrelationId:t(this.currentCallId),PreviousCorrelationId:t(this.previousCallId),ConsultativeCallId:t(this.consultativeCallId),EndpointId:t(this.endpointId),SkypeId:t(this.skypeId),ParticipantId:t(this.participantId),PreheatFlags:t(this.preheatFlags),CallType:t(this.callType),ConversationType:t(this.conversationType),Direction:t(this.direction),Origin:t(this.origin),SelfParticipantRole:t(this.selfParticipantRole),IsAnonymous:t(this.isAnonymous),ThreadId:u.getLoggableThreadId(t(this.threadId)),MessageId:t(this.messageId),ApplicationType:t(this.applicationType),Ring:t(this.ring),TenantId:t(this.tenantId),AcsResourceId:t(this.acsResourceId),Region:t(this.region),Partition:t(this.partition),FailureType:t(this.failureType),IsCast:t(this.isCast),IsEmergency:t(this.isEmergency),TsCallingVersion:t(this.tsCallingVersion),TerminationState:t(this.terminationState),TerminationReason:t(this.terminationReason),StackConfig:t(this.stackConfig),EventTimestampBag:this.getEventTimestampBag(e),HostName:this.getHostName(),DiagnosticInfo:this.callEndDiagnosticInfo}},t.prototype.switchToInCallTelemetry=function(){this.recordedEvents=this.recordedEvents.filter(function(e){return e.isPending()}),this.inCallMode=!0},t}(f);t.CallTelemetry=g,t.getEndpointInformationForTelemetry=function(e){return Array.isArray(e)?e.map(function(e){return{endpointId:e.endpointId,participantId:e.participantId}}):null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(35),r=n(17);function o(e){return!(!e||!e.code)}t.isTransactionEnd=o,t.getRejectTransactionEnd=function(e,t){return o(e)?e:{code:i.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:void 0!==t?t:i.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:"string"==typeof e?e:r.getPrintableObject(e)}},t.getSuccessTransactionEnd=function(){return{code:i.TRANSACTION_END_CODE.SUCCESS}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=n(35),c=n(11),l=n(41);!function(e){e.CHAINED="Chained",e.SYNC="Sync",e.ASYNC="Async"}(o=t.OPERATION_TYPE||(t.OPERATION_TYPE={})),function(e){e[e.CALL=0]="CALL",e[e.PARTICIPANT=1]="PARTICIPANT"}(a||(a={})),t.callOperation=function(e,t){return u(a.CALL,e,t)},t.participantOperation=function(e,t){return u(a.PARTICIPANT,e,t)},t.operationId=function(e,t,n){if(e[t]._operationIdValue_)throw new Error("can not specify more than one operation id");e[t]._operationIdValue_=n},t.causeId=function(e,t,n){if(e[t]._causeIdValue_)throw new Error("can not specify more than one cause id");e[t]._causeIdValue_=n},t.callStartOptions=function(e,t,n){if(e[t]._callStartOptionsValue_)throw new Error("can not specify options more than once");e[t]._callStartOptionsValue_=n},t.reason=function(e,t,n){if(e[t]._clientReasonValue_)throw new Error("can not specify reason more than once");e[t]._clientReasonValue_=n};var u=function(e,t,n){return function(i,a,u){var p=u.value,f=i[a]&&i[a]._operationIdValue_,h=i[a]&&i[a]._causeIdValue_,g=i[a]&&i[a]._callStartOptionsValue_,m=i[a]&&i[a]._clientReasonValue_,v=n&&n.type||o.ASYNC;return u.value=function(){for(var i=this,a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];var y=void 0!==f?a[f]:void 0;if(void 0!==y)if(Array.isArray(y))try{var S=y.map(function(e){return e.toString()}).sort().concat().toString();y=function(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(S).toString()}catch(e){return Promise.reject(32)}else if(y&&"object"==typeof y)try{var _=JSON.stringify(y);n&&n.operationIdKey&&y.hasOwnProperty(n.operationIdKey)&&(_=y[n.operationIdKey]),y=_}catch(e){return Promise.reject(32)}var E,T=c.generateCauseId();void 0!==h&&(a[h]&&c.validateCauseId(a[h])?T=a[h]:a[h]=T),void 0!==m&&a[m]&&(E=a[m]);var C=d(this,e);if(C.logOperation(T,t),n&&n.singular&&C.hasPendingOperation(t))return C.logOperation(T,t,"Not allowed, pending operation exists"),Promise.reject(60);try{void 0!==g&&a[g]&&this.processCallStartOptions(a[g],T)}catch(e){return Promise.reject(32)}var I=!(!n||!n.convertError),A=function(){return v===o.CHAINED?C.executeChained(p.bind.apply(p,r([i],a)),t,y,T,I,E):v===o.SYNC?C.executeSync(p.bind.apply(p,r([i],a)),t,y,T,I,E):C.execute(p.bind.apply(p,r([i],a)),t,y,T,I,E)};if(t!==s.CALL_OPERATIONS.START_CALL&&t!==s.CALL_OPERATIONS.JOIN_CALL||C.hasPendingOperation(s.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED)||C.createPendingOperation(s.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED).catch(l.noop),n&&n.triggerAttach&&(C.hasPendingOperation(s.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY)||C.createPendingOperation(s.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY).catch(l.noop)),n&&n.type!==o.SYNC){var b=n&&n.waitFor;if(Array.isArray(b))return Promise.all(b.map(function(e){return e&&C.hasPendingOperation(e)&&C.waitForOperation(e,void 0,T)})).then(A,A);if(b&&C.hasPendingOperation(b))return C.waitForOperation(b,void 0,T).then(A,A)}return A()},u}},d=function(e,t){if(t===a.CALL)return e._callOperationHandler;if(t===a.PARTICIPANT)return e._participantOperationHandler;throw new Error("Unsupported operation handler type!")}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(16),l=n(147),u=n(11),d=n(148),p=n(75),f=n(17),h=n(149),g=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.callTelemetry=n,r.logSuccess=function(e,t,n){r._logger.info(e+" execution succeeded, result="+(t?r.stringifyForLogging(t):"void")+", time="+n.duration())},r.logFailure=function(e,t,n){r._logger.info(e+" execution failed, reason="+r.stringifyForLogging(t)+", time="+n.duration())},r.stringifyForLogging=function(e){var t;if(e instanceof Error)t=e.toString()||"Unknown Error";else try{t=JSON.stringify(e)}catch(e){t="Unable to stringify data"}return t},r.convertToTransactionEndIfErrorOrString=function(e,t,n){if(r._logger.info("ecsEnableErrorConversion in operationHandler is: "+r._ecsEnableErrorConversion),t&&r._ecsEnableErrorConversion&&("string"==typeof e||e instanceof Error)){var i=p.getRejectTransactionEnd(e);return r._logger.info(n+" Error converted from "+e+" to "+f.getPrintableObject(i)),i}return e},r._logger=t.createChild("[Operation]"),r._chainedPromise=new d.default(r._logger.createChild("[Chained]")),r._ecsEnableErrorConversion=!!i,r}return r(t,e),t.prototype.resetOperationChain=function(e){this._chainedPromise.reset(e)},t.prototype.executeSync=function(e,t,n,i,r,o){void 0===i&&(i=u.generateCauseId());var a=this.getOperationInfoForLogging(i,t,n),s=h.build();this._logger.info(a+"API calledSync");var c,l=this.callTelemetry.recordOperation(t,i,n,o);try{c=e(),l.recordSuccess(c,i),this.logSuccess(a,c,s)}catch(e){var d=this.convertToTransactionEndIfErrorOrString(e,r,a);l.recordFailure(d,i),this.logFailure(a,d,s)}return c},t.prototype.executeChained=function(e,t,n,i,r,s){return void 0===i&&(i=u.generateCauseId()),o(this,void 0,void 0,function(){return a(this,function(o){return[2,this.checkPendingOperationAndExecute(e,!0,t,n,i,r,s)]})})},t.prototype.execute=function(e,t,n,i,r,s){return void 0===i&&(i=u.generateCauseId()),o(this,void 0,void 0,function(){return a(this,function(o){return[2,this.checkPendingOperationAndExecute(e,!1,t,n,i,r,s)]})})},t.prototype.logOperation=function(e,t){for(var n=this,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var o=i.length&&i.map(function(e){return n.stringifyForLogging(c.scrubMriOrOmit(e))});this._logger.info("["+e+"]["+t+"]API called, "+(o?"with args="+o:""))},t.prototype.rejectPendingOperations=function(t,n,i){var r,o,a,c,l,d;if(void 0===n&&(n=u.generateCauseId()),i){try{for(var p=s(Object.keys(this._deferredOperations)),f=p.next();!f.done;f=p.next()){var h=f.value;this.callTelemetry.maybeRecordOperationFailure(h,i,void 0,n)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}try{for(var g=s(Object.keys(this._deferredOperationsWithOperationId)),m=g.next();!m.done;m=g.next()){h=m.value;try{for(var v=s(Object.keys(this._deferredOperationsWithOperationId[h])),y=v.next();!y.done;y=v.next()){var S=y.value;this.callTelemetry.maybeRecordOperationFailure(h,i,S,n)}}catch(e){l={error:e}}finally{try{y&&!y.done&&(d=v.return)&&d.call(v)}finally{if(l)throw l.error}}}}catch(e){a={error:e}}finally{try{m&&!m.done&&(c=g.return)&&c.call(g)}finally{if(a)throw a.error}}}e.prototype.rejectPendingOperations.call(this,t,n)},t.prototype.checkPendingOperationAndExecute=function(e,t,n,i,r,o,a){var s=this;void 0===r&&(r=u.generateCauseId());var c=this.getOperationInfoForLogging(r,n,i),l=null,d=null;return this.hasPendingOperationWithOperationId(n,i)||this.hasPendingOperation(n)?(this._logger.info(c+"already pending, returning existing operation"),l=this.waitForOperation(n,i,r)):d=this.createPendingOperation(n,i,r),t?(this._logger.info(c+"chained"),this._chainedPromise.chainPromise(function(){return l||s.executeInternal(d,r,e,n,i,o,a)},n,r)):l||this.executeInternal(d,r,e,n,i,o,a)},t.prototype.executeInternal=function(e,t,n,i,r,s,c){return o(this,void 0,void 0,function(){var o,l,u,d,p;return a(this,function(a){switch(a.label){case 0:o=this.getOperationInfoForLogging(t,i,r),this._logger.info(o+" executing operation..."),l=h.build(),this.callTelemetry.recordOperation(i,t,r,c),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n()];case 2:return u=a.sent(),this.callTelemetry.maybeRecordOperationSuccess(i,u,r),this.logSuccess(o,u,l),this.maybeResolveOperation(i,u,r,t),[3,4];case 3:return d=a.sent(),p=this.convertToTransactionEndIfErrorOrString(d,s,o),this.callTelemetry.maybeRecordOperationFailure(i,p,r),this.logFailure(o,p,l),this.maybeRejectOperation(i,p,r,t),[3,4];case 4:return[2,e]}})})},t}(l.default);t.default=g},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),o=n(40);function a(e,t){if(void 0===t&&(t=null),e===o.jsCallEndCodes.Success)switch(t){case o.jsCallEndSubCodes.RemovedFromConversation:case o.jsCallEndSubCodes.RemovedFromCall:return 44;case o.jsCallEndSubCodes.DeniedInLobby:return 55;case o.jsCallEndSubCodes.TimedOutInLobby:return 56;default:return 1}if(null!=t&&t>=o.PstnTerminationCode.CallTerminationSubCodeSipGWMin&&t<=o.PstnTerminationCode.CallTerminationSubCodeSipGWMax){var n=t-o.PstnTerminationCode.CallTerminationSubCodeSipGWMin;return o.pstnConsumerResponseCodeMap[n]?o.pstnConsumerResponseCodeMap[n]:0}return null!=t&&t>=o.EnterpisePstnTerminationCode.CallTerminationSubCodeSipGWMin&&t<=o.EnterpisePstnTerminationCode.CallTerminationSubCodeSipGWMax?o.pstnEnterpriseResponseCodeMap[e]?o.pstnEnterpriseResponseCodeMap[e]:43:e===o.jsCallEndCodes.Forbidden?t===o.jsCallEndSubCodes.UserBlocked?64:t===o.jsCallEndSubCodes.PolicyRestriction?62:t===o.jsCallEndSubCodes.AnonymousJoinDisabledByPolicy?66:t===o.jsCallEndSubCodes.NoLobbyForBroadcastJoin?67:t===o.jsCallEndSubCodes.NotAllowedDueToInformationBarrier?68:t===o.jsCallEndSubCodes.TeamParkPolicyDisabled?70:t===o.jsCallEndSubCodes.B2bJoinDisabledByPolicy?71:t===o.jsCallEndCodes.Success?8:7:e===o.jsCallEndCodes.PreconditionFailed&&t===o.jsCallEndSubCodes.InsufficientCapabilities?63:e===o.jsCallEndCodes.ServiceUnavailable?t===o.jsCallEndSubCodes.BroadcastLimitReached?69:48:e===o.jsCallEndCodes.InternalServerError?7:e===o.jsCallEndCodes.ConfParticipantCountLimitReached?t===o.jsCallEndSubCodes.MaxLobbyParticipantLimitReached?73:59:o.responseCodeMap[e]?o.responseCodeMap[e]:e}function s(e){switch(e){case 0:return"main-audio";case 1:return"main-video";case 3:return"applicationsharing-video";case 4:return"data"}throw new Error("Invalid media type")}function c(e,t){if(void 0!==t&&3!==t&&1!==t)return{mediaType:e,isDisabled:0===t,label:s(e)}}t.convertReason=function(e){return e?a(e.code,e.subCode):0},t.convertSignalingEndpointDetails=function(e){var t={clientVersion:e.clientVersion,participantId:e.participantId,endpointId:e.endpointId,endpointType:e.endpointType,endpointMetadata:e.endpointMetadata,originalId:e.originalId,capabilities:e.capabilities,clientEndpointCapabilities:e.clientEndpointCapabilities};return e.mediaStreams&&(t.mediaStreams=e.mediaStreams),e.lwjSessionInformation&&(t.lwjSessionInformation=e.lwjSessionInformation),e.appliedInteractivityLevel&&(t.appliedInteractivityLevel=e.appliedInteractivityLevel),e.deviceType&&(t.deviceType=e.deviceType),t},t.getTerminationCode=a,t.getCSAEndCode=function(e){var t,n;if(1===e)return o.jsCallEndCodes.Success;var r=Object.keys(o.responseCodeMap).filter(function(t){return o.responseCodeMap[t]===e});if(r.length>=1)try{for(var a=i(r),s=a.next();!s.done;s=a.next()){var c=s.value,l=parseInt(c);if(l&&o.responseCodeMap[l]===e)return l}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o.jsCallEndCodes.UnknownError},t.getMediaLabel=s,t.getMediaState=c,t.getCallStartOptions=function(e){if(e.sendMediaModalities)return e;var t={mediaStates:[]},n=c(0,e.audioDirection?e.audioDirection:4);return n&&t.mediaStates.push(n),(n=c(1,e.withVideo?e.withVideo?4:1:e.videoDirection))&&t.mediaStates.push(n),(n=c(3,e.screenshareDirection?e.screenshareDirection:1))&&t.mediaStates.push(n),e.sendMediaModalities=t,e};var l=function(){function e(e){this.mediaStateConfiguration=e}return e.prototype.isDisabled=function(e){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var t=r.find(this.mediaStateConfiguration.mediaStates,function(t){return t.mediaType===e});return!!t&&!!t.isDisabled}return!1},e.prototype.isInactiveOrDisabled=function(e){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var t=r.find(this.mediaStateConfiguration.mediaStates,function(t){return t.mediaType===e});return!t||!!t.isDisabled}return!1},e.prototype.isSending=function(e){return!(!this.mediaStateConfiguration||!this.mediaStateConfiguration.mediaStates||!r.find(this.mediaStateConfiguration.mediaStates,function(t){return t.mediaType===e&&0==!!t.isDisabled}))},e.prototype.setModality=function(e,t){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var n=r.find(this.mediaStateConfiguration.mediaStates,function(t){return t.mediaType===e});n?n.isDisabled=t:this.mediaStateConfiguration.mediaStates.push({mediaType:e,isDisabled:t,label:s(e)})}},e.prototype.disableModality=function(e){this.setModality(e,!0)},e.prototype.enableModality=function(e){this.setModality(e,!1)},e.prototype.removeModality=function(e){this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates&&r.remove(this.mediaStateConfiguration.mediaStates,function(t){return t.mediaType===e})},e.prototype.setCallAcceptOptions=function(e){var t=this.isDisabled(1),n=this.isDisabled(3);if(e.sendMediaModalities)this.mediaStateConfiguration=e.sendMediaModalities;else{void 0===e.answerMediaType&&(e.answerMediaType=e.withVideo?1:0);var i={mediaStates:[]};switch(e.answerMediaType){case 0:i.mediaStates.push(c(0,4));break;case 1:i.mediaStates.push(c(0,4)),i.mediaStates.push(c(1,4));break;case 2:i.mediaStates.push(c(1,0))}this.mediaStateConfiguration=i}t&&this.setModality(1,!0),n&&this.setModality(3,!0),e.sendMediaModalities=this.mediaStateConfiguration},e}();t.MediaStateConfigHelper=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={OFFER_GENERATION_STARTED:"InitialOfferGenerationStarted",OFFER_GENERATION_ENDED:"InitialOfferGenerationEnded",ANSWER_PROCESSING_STARTED:"InitialAnswerProcessingStarted",ANSWER_PROCESSING_ENDED:"InitialAnswerProcessingEnded",OFFER_PROCESSING_STARTED:"InitialOfferProcessingStarted",OFFER_PROCESSING_ENDED:"InitialOfferProcessingEnded",ANSWER_GENERATION_STARTED:"InitialAnswerGenerationStarted",ANSWER_GENERATION_ENDED:"InitialAnswerGenerationEnded"},r={OFFER_GENERATION_STARTED:"RenegotiationOfferGenerationStarted",OFFER_GENERATION_ENDED:"RenegotiationOfferGenerationEnded",ANSWER_PROCESSING_STARTED:"RenegotiationAnswerProcessingStarted",ANSWER_PROCESSING_ENDED:"RenegotiationAnswerProcessingEnded",OFFER_PROCESSING_STARTED:"RenegotiationOfferProcessingStarted",OFFER_PROCESSING_ENDED:"RenegotiationOfferProcessingEnded",ANSWER_GENERATION_STARTED:"RenegotiationAnswerGenerationStarted",ANSWER_GENERATION_ENDED:"RenegotiationAnswerGenerationEnded"},o=function(){function e(e,t,n){var r=this;this.mediaSession=e,this.signalingSession=t,this.mediaConstants=n,this.operationNames=i,this.configureModalitiesAsync=this.mediaSession.configureModalitiesAsync.bind(this.mediaSession),this.getAllowedModalities=this.mediaSession.getAllowedModalities&&this.mediaSession.getAllowedModalities.bind(this.mediaSession),this.rejectNegotiationAsync=this.mediaSession.rejectNegotiationAsync.bind(this.mediaSession),this.createRemoteRenderer=this.mediaSession.createRemoteRenderer.bind(this.mediaSession),this.getStatsAsync=this.mediaSession.getStatsAsync.bind(this.mediaSession),this.getLastKnownStats=this.mediaSession.getLastKnownStats.bind(this.getLastKnownStats),this.muteInputTypeAsync=this.mediaSession.muteInputTypeAsync.bind(this.mediaSession),this.unmuteInputTypeAsync=this.mediaSession.unmuteInputTypeAsync.bind(this.mediaSession),this.muteInputAsync=this.mediaSession.muteInputAsync.bind(this.mediaSession),this.unmuteInputAsync=this.mediaSession.unmuteInputAsync.bind(this.mediaSession),this.muteOutputAsync=this.mediaSession.muteOutputAsync.bind(this.mediaSession),this.unmuteOutputAsync=this.mediaSession.unmuteOutputAsync.bind(this.mediaSession),this.terminate=this.mediaSession.terminate.bind(this.mediaSession),this.createAudioElement=this.mediaSession.createAudioElement.bind(this.mediaSession);var o=this.getExtensionsManager();o&&o.configureExtension(this.mediaConstants.EXTENSION_TYPE.videoStreamControl,{sender:{send:function(e,t){return r.signalingSession?r.signalingSession.sendWebRtcMediaNotificationAsync(e,t):Promise.reject(new Error("no signaling session"))}}})}return e.prototype.processOfferAsync=function(e,t){var n=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_PROCESSING_STARTED),this.mediaSession.processOfferAsync(e,t).then(function(e){return n.signalingSession.setOfferAnswerGenerationTimestamps(n.operationNames.OFFER_PROCESSING_ENDED),e})},e.prototype.createAnswerAsync=function(e,t){var n=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_GENERATION_STARTED),this.mediaSession.createAnswerAsync(e,t).then(function(t){return n.signalingSession.setOfferAnswerGenerationTimestamps(n.operationNames.ANSWER_GENERATION_ENDED),e||(n.operationNames=r),t})},e.prototype.createOfferAsync=function(e){var t=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_GENERATION_STARTED),this.mediaSession.createOfferAsync(e).then(function(e){return t.signalingSession.setOfferAnswerGenerationTimestamps(t.operationNames.OFFER_GENERATION_ENDED),e})},e.prototype.processAnswerAsync=function(e,t,n,i){var o=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_PROCESSING_STARTED),this.mediaSession.processAnswerAsync(e,t,n,i).then(function(){o.signalingSession.setOfferAnswerGenerationTimestamps(o.operationNames.ANSWER_PROCESSING_ENDED),o.operationNames=r})},e.prototype.completeNegotiationAsync=function(e){var t=this;return this.mediaSession.completeNegotiationAsync(e).then(function(e){return t.signalingSession.setOfferAnswerGenerationTimestamps("NegotiationCompleted"),e})},e.prototype.sendDtmf=function(e){return this.mediaSession.sendDtmf?this.mediaSession.sendDtmf(e):Promise.reject("Not Implemented")},e.prototype.getExtensionsManager=function(){return this.mediaSession.getExtensionsManager?this.mediaSession.getExtensionsManager():null},e.prototype.reconnectAsync=function(e,t){return void 0===t&&(t=!1),this.mediaSession.reconnectAsync(e,t)},e.prototype.completeEscalationAsync=function(e){return this.mediaSession.completeEscalationAsync(e)},e.prototype.rejectEscalationAsync=function(e,t){return this.mediaSession.rejectEscalationAsync(e,t)},e.prototype.getAcceptedTypes=function(){return this.mediaSession.getAcceptedTypes()},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleServerMutedVersion=function(e,t,n){if(!(void 0===t||void 0===t.serverMuteVersion||void 0===n||void 0===n.serverMuteVersion||n.serverMuteVersion>=t.serverMuteVersion)){var i=n&&n.mediaStreams,r=i&&i.filter(function(e){return"audio"===e.type||"audio-teleconferencing"===e.type}),o=t&&t.mediaStreams,a=o&&o.filter(function(e){return"audio"===e.type||"audio-teleconferencing"===e.type});r&&r.length&&(n.serverMuteVersion=t.serverMuteVersion,r[0].serverMuted=a[0].serverMuted,e.info("handleServerMutedVersion: patching server muted state in audio streams updated:"+JSON.stringify(r[0])+" as we encountered stale muteServerVersion. Updated to "+t.serverMuteVersion))}},t.handleMuteUnmuteParticipantInfo=function(e,t,n,i){if("success"!==n.reason||void 0===t||n.serverMuteVersion<=t.serverMuteVersion)return e.info("handleMuteUnmuteParticipantInfo: ignoring updating since we encountered invalid state: "+n.reason+" serverMuteVersion: "+n.serverMuteVersion),!1;var r=t&&t.mediaStreams,o=r&&r.filter(function(e){return"audio"===e.type||"audio-teleconferencing"===e.type});return!!o&&(o[0].serverMuted=i,t.serverMuteVersion=n.serverMuteVersion,e.info("handleMuteUnmuteParticipantInfo: updating since we encountered valid state serverMuteVersion: "+n.serverMuteVersion+" to: "+i+" streams: "+o[0]),!0)}},function(e,t,n){"use strict";var i,r,o,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(8),l=n(35),u=n(74),d=n(11),p=n(17),f=n(15),h=n(16),g=n(79),m=n(81),v=n(83),y=n(43),S=((r={})[0]=[1],r[1]=[2,6,3,4,5,7],r[2]=[6,3,4],r[3]=[1,4,5],r[7]=[3,4],r[4]=[],r[5]=[3,4],r[6]=[3,4],r),_=((o={})[0]="Disconnected",o[1]="Connecting",o[2]="Ringing",o[3]="Connected",o[5]="Connected",o[4]="Disconnected",o[7]="Connecting",o),E=function(e){function t(t,n,i,r,o,a,p){void 0===p&&(p=d.generateCauseId());var f=e.call(this,i)||this;return f.mri=t,f.callTelemetry=o,f.state=0,f.voiceLevel=0,f.isServerMuted=!1,f.endpointType="default",f.balanceUpdates={},f.participantEndpointDetails={},f.recordTelemetryForStateChange=function(e,t,n,i){if(i){var r=l.PARTICIPANT_OPERATIONS_INTERNAL.SET_PARTICIPANT_STATE_INVALID,o={state:t,reason:n,endpoints:[]};f.endpoints&&f.endpoints.endpointDetails&&f.endpoints.endpointDetails.length&&(o.endpoints=u.getEndpointInformationForTelemetry(f.endpoints.endpointDetails)),f.callTelemetry.recordEvent(r,o,e)}},f.checkIfIncomingServerMutedIsUpdated=function(e){f.participantEndpointDetails!=={}&&c.each(e.endpointDetails,function(e){var t=f.participantEndpointDetails[e.participantId];void 0!==t&&m.handleServerMutedVersion(f.logger,t,e)})},f.handleServerMutedInfoUpdate=function(e){var t,n,i=!1;try{for(var r=s(e),o=r.next();!o.done;o=r.next()){var a=o.value,c=f.participantEndpointDetails[a.participantId];m.handleMuteUnmuteParticipantInfo(f.logger,c,a,!0)&&(i=!0)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}i&&f.updateIsServerMuted()},f.id=f.mri,f.logger=i.createChild(function(){return"ICallParticipant["+h.scrubMriOrOmit(f.id)+"]["+f.state+"]"}),f.logger.info("["+p+"]created"),f.streamManager=new v.PluginlessCallStreamManager(f.id,n,r,f.logger,a),f}return a(t,e),Object.defineProperty(t.prototype,"audio",{get:function(){return this.streamManager.audio},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streams",{get:function(){return this.streamManager.streams},enumerable:!0,configurable:!0}),t.prototype.getDiagnosticData=function(){return JSON.stringify({id:h.scrubMriOrOmit(this.id),state:this.state,isServerMuted:this.isServerMuted})},t.prototype.isSameParticipantsMri=function(e){return this.id===e},t.prototype.setMediaSession=function(e,t){void 0===t&&(t=d.generateCauseId()),this.streamManager.setMediaSession(e,t)},t.prototype.updateStreams=function(e,t){void 0===t&&(t=d.generateCauseId());var n=this.logger.createFnLogger("updateStreams",t);this.streamManager.updateStreams(e,t),n.info("mediaStreams="+p.safeJsonStringify(e)),this.raiseChanged()},t.prototype.updateIsServerMuted=function(){if(c.isEmpty(this.participantEndpointDetails))this._updateIsServerMuted(!1);else{var e=!1;c.each(this.participantEndpointDetails,function(t){if(!t.lwjSessionInformation){var n=function(e){return c.filter(t.mediaStreams,function(t){return t.type===e}).sort(v.PluginlessCallStreamManager.compareStreams)},i=n(y.ngcStreamTypes.audio)[0];i||(i=n(y.ngcStreamTypes.audioteleconference)[0]);var r=!(!i||!i.serverMuted)&&i.serverMuted,o=t.endpointState&&t.endpointState.state,a=o&&o.isMuted||!1;!1!==r||!1!==a||(e=!0)}});var t=!e;this._updateIsServerMuted(t)}},t.prototype._updateIsServerMuted=function(e){e!==this.isServerMuted&&(this.isServerMuted=e,this.logger.info("_updateIsServerMuted updating to: "+this.isServerMuted),this.raiseChanged())},t.prototype.updateVoiceLevel=function(e){this.voiceLevel!==e&&(this.voiceLevel=e,this.raiseChanged())},t.prototype.setState=function(e,t,n){if(this.state!==e){var i=this.logger.createFnLogger("setState",n);if(3!==this.state||6!==e){var r=S[this.state].indexOf(e)>=0;this.recordTelemetryForStateChange(n,e,t,!r),r?(i.info("state="+this.state+"->"+e+" reason="+this.stateReason+"->"+t),this.state=e,this.stateReason=t,this.raiseChanged()):i.logFailure("Invalid state transition "+this.state+"->"+e+" attempted")}else i.info("Ignore Connected->EarlyMedia transition, it is a race between media and signaling")}},t.prototype.processParticipantDetails=function(e){var t=this;this.role=e.role,this.meetingRole=e.meetingRole,this.tenantId=e.tenantId,c.isEmpty(e.endpointDetails)||(this.endpoints={endpointDetails:[]},this.participantCapabilities={canConference:!1,canShareScreen:!1,canMerge:!0},this.checkIfIncomingServerMutedIsUpdated(e),this.participantEndpointDetails={},c.each(e.endpointDetails,function(e){var n=g.convertSignalingEndpointDetails(e);if(t.endpoints.endpointDetails.push(n),t.participantEndpointDetails[e.participantId]={endpointId:e.endpointId,serverMuteVersion:e.serverMuteVersion,endpointState:e.endpointState,mediaStreams:e.mediaStreams,lwjSessionInformation:e.lwjSessionInformation},e.capabilities&&(t.participantCapabilities.canConference||"enabled"!==e.capabilities.cloudAudioVideoConference||(t.participantCapabilities.canConference=!0),t.participantCapabilities.canShareScreen||"enabled"!==e.capabilities.cloudScreenSharing||(t.participantCapabilities.canShareScreen=!0),t.participantCapabilities.canMerge||"enabled"!==e.capabilities.cloudMerge||(t.participantCapabilities.canMerge=!0)),t.contentSharingRole=0,e.contentSharing&&e.contentSharing.sessionInformation){var i=e.contentSharing.sessionInformation;"attendee"===i.role?t.contentSharingRole=1:"presenter"===i.role&&(t.contentSharingRole=2)}}),this.updateIsServerMuted(),this.raiseChanged())},t.prototype.toCafeParticipant=function(){return{audioState:_[this.state],mri:this.mri}},t.prototype.getSourceIdForMediaType=function(e){return-1},t.prototype.useLightweightStreams=function(e,t){this.streamManager.useLightweightStreams(e,t)},t}(f.default);t.PluginlessCallParticipant=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=n(154),o=n(155),a=n(156),s=n(43),c=n(84);t.AUDIO_STREAM_DEFAULT_ID=1,t.VIDEO_STREAM_DEFAULT_ID=2,t.SHARING_STREAM_DEFAULT_ID=3;var l=function(){function e(e,n,i,o,s){this.participantId=e,this.mediaSession=n,this.localStats=i,this.imageRenderingSession=s,this.streams={},this.lightweightFrameUris=null,this.cachedSharingStreams=[];var l=i.receive(1,e),u=i.receive(3,e);this.audio=new r.default(n,o,t.AUDIO_STREAM_DEFAULT_ID);var d=new c.default(n,l,o,t.VIDEO_STREAM_DEFAULT_ID),p=new a.default(n,u,o,t.SHARING_STREAM_DEFAULT_ID);this.streams[0]=[d],this.streams[1]=[p],this.logger=o.createChild("PluginlessCallStreamManager")}return e.prototype.setMediaSession=function(e,t){this.logger.info("["+t+"][setMediaSession]"),this.mediaSession=e,[[this.audio],this.streams[0],this.streams[1]].forEach(function(n){return n.forEach(function(n){return n.setMediaSession(e,t)})})},e.prototype.updateStreams=function(t,n){this.logger.info("["+n+"][updateStreams]");var r=function(n){return i.filter(t,function(e){return e.type===n}).sort(e.compareStreams)},o=r(s.ngcStreamTypes.audio)[0]||r(s.ngcStreamTypes.audioteleconference)[0];o&&this.audio.update(o,n),this.updateMediaStreams(r(s.ngcStreamTypes.video),0,n),this.updateMediaStreams(r(s.ngcStreamTypes.sharing),1,n)},e.prototype.useLightweightStreams=function(e,t){this.lightweightFrameUris=e,this.streams[1].length&&(this.logger.info("["+t+"][useLightweightStreams] frameUris updated, recreating sharing streams"),this.streams[1]=[],this.updateMediaStreams(this.cachedSharingStreams,1,t))},e.compareStreams=function(e,t){var n="sendonly"===e.direction||"sendrecv"===e.direction,i="sendonly"===t.direction||"sendrecv"===t.direction;return n&&!i?-1:i&&!n?1:t.sourceId-e.sourceId},e.prototype.updateMediaStreams=function(e,t,n){var r=this,s=this.streams[t];1===t&&(this.cachedSharingStreams=e);var l=s.filter(function(t){return!e.some(function(e){return e.sourceId===t.id})});l.forEach(function(e){return i.remove(s,e)}),l.length&&this.logger.info("["+n+"][updateMediaStreams] Removing "+l.length+" streams of type "+t),e.forEach(function(l,u){var d=i.find(s,function(e){return e.id===l.sourceId});d||(0===t?d=new c.default(r.mediaSession,r.localStats.receive(1,r.participantId),r.logger,l.sourceId):1===t&&(d=r.lightweightFrameUris?new o.default(r.logger,l.sourceId,r.lightweightFrameUris,r.imageRenderingSession):new a.default(r.mediaSession,r.localStats.receive(3,r.participantId),r.logger,l.sourceId)),r.logger.info("["+n+"][updateMediaStreams] Adding stream "+l.sourceId+" of type "+t),s.push(d)),d.update(l,n),d.rank=e.length-u})},e}();t.PluginlessCallStreamManager=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(42),a=n(44),s=function(e){function t(t,n,i,r){var o=e.call(this,t,i,r)||this;return o.rendererStats=n,o.type=0,o}return r(t,e),t.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})},t.prototype.stop=function(){return this.mediaSessionInitPromise.reject(new Error("Video stream stopped")),Promise.resolve(void 0)},t.prototype.start=function(e,t){var n=this;return this.logger.info("video start: target="+e+", options="+JSON.stringify(t)),this.mediaSessionInitPromise.promise.then(function(){return new a.RemoteVideoRenderer(e,n.mediaSession,n.rendererStats)}).then(function(e){return t&&e.setScalingMode(t.scalingMode),n.logger.info("subscribeVideoAsync: videoRenderer="+e+", id="+n.id),e.subscribeVideoAsync(n).catch(function(t){throw e.dispose(),t}).then(function(){return n.isStreaming=!0,e})})},t.prototype.update=function(t,n){this.logger.info("["+n+"][update] stream="+JSON.stringify(t));var i=this.isAvailable;e.prototype.update.call(this,t,n),this.isAvailable&&this.isAvailable!==i&&this.rendererStats.event(o.MediaReceiverEvent.Available)},t}(n(46).default);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){}return e.prototype.process=function(e){return this.mediaLegId=e||this.mediaLegId||i.uniqueId().toUpperCase(),this.mediaLegId},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.relayManager=e,this.sessionStatistics=t}return e.prototype.initialize=function(){},e.prototype.queryRelaysAsync=function(e){var t=this;return this.relayManager.queryRelaysAsync(e).then(function(e){return e.length>0&&t.sessionStatistics.setRelay(e[0]),e})},e.prototype.getStats=function(){return this.relayManager.getStats?this.relayManager.getStats():{unavailable:"1"}},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.initialCallbacks=e,this.queue=[],this.queueCallbacks={onTerminated:this.genCallback(this.initialCallbacks.onTerminated),onSessionErrorOccurred:this.genCallback(this.initialCallbacks.onSessionErrorOccurred),onNegotiationRequired:this.genCallback(this.initialCallbacks.onNegotiationRequired),onAudioStateChanged:this.genCallback(this.initialCallbacks.onAudioStateChanged),onAudioHwSilentChanged:this.genCallback(this.initialCallbacks.onAudioHwSilentChanged),onTransportDisconnected:this.genCallback(this.initialCallbacks.onTransportDisconnected),onTransportConnected:this.genCallback(this.initialCallbacks.onTransportConnected),onTransportInitialized:this.genCallback(this.initialCallbacks.onTransportInitialized),onTransportFailed:this.genCallback(this.initialCallbacks.onTransportFailed),onScreenSharingIncomingDecoderFailed:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderFailed),onScreenSharingIncomingDecoderActive:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderActive),onScreenSharingIncomingDecoderReset:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderReset)}}return e.prototype.flush=function(){this.queue.forEach(function(e){e.method.apply(null,e.args)}),this.clear()},e.prototype.clear=function(){this.queue=[]},e.prototype.genCallback=function(e){var t=this;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return t.queue.push({method:e,args:n})}},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(21),r=n(18),o=function(){function e(e){this.logger=e,this.operationQueue=null,this.currentOperationDeferred=null,this.operationQueue=new i.PromiseQueue(this.logger)}return e.prototype.queueOperation=function(e){var t=this;this.logger.safe.info("queueing operation");var n=new r.SettablePromise,i=this.operationQueue.add(function(){return t.currentOperationDeferred=n,e()});return this.operationQueue.add(n),i},e.prototype.completeCurrentOperation=function(){this.currentOperationDeferred&&(this.logger.safe.info("completing operation"),this.currentOperationDeferred.resolve())},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),r=n(12),o=n(180),a=n(182),s=function(){function e(){}return e.getProvider=function(e,t,n){if("ScreenShare"===e){var s=n.createChild("SharingCP");return"Safari"===i.getBrowserInfo().name?new o.SafariSharingConstraintsProvider(s,r.default.window):new o.SharingConstraintsProvider(s)}return new a.VideoConstraintsProvider(t,n.createChild("VideoCP"))},e}();t.ConstraintsProviderFactory=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8);t.adjustResolitionToAspectRatio=function(e,t){var n=e.width/e.height,r=i.clone(e);return n>t?r.width=Math.floor(e.height*t):n<t&&(r.height=Math.floor(e.width/t)),r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(0),o=function(){function e(e){this.logger=e}return e.prototype.dispose=function(){},e.prototype.updateVideoConstraints=function(e,t,n){var i=this.calculateConstraints(t,n);this.logger.safe.info("Calculated constraints: "+JSON.stringify(i)+" from capabilities: "+JSON.stringify(t));var o=i.resolution,a=i.fps,s=o&&(!r.isInRange(o.width,e.video.minWidth,e.video.maxWidth)||!r.isInRange(o.height,e.video.minHeight,e.video.maxHeight)),c=e.video.fps!==a;if(!s&&!c)return e;var l=e.clone();return s&&this.setResolution(l,o),c&&(l.video.fps=a),l},e.prototype.updateResolution=function(e,t){var n=e.clone();return this.setResolution(n,t),n},e.prototype.setResolution=function(e,t){e.video.maxWidth=t.width,e.video.minWidth=t.width,e.video.maxHeight=t.height,e.video.minHeight=t.height},e.prototype.getKey=function(e){return e.video?r.isEmpty(e.video)?"video":e.video.deviceId&&e.video.minWidth&&e.video.minHeight?e.video.deviceId+"x"+e.video.minWidth+"x"+e.video.minHeight:e.video.minWidth&&e.video.minHeight?e.video.minWidth+"x"+e.video.minHeight:e.video.deviceId?""+e.video.deviceId:(this.logger.safe.error("Cannot create key for constraints: "+i.scrubConstraints(e)),""):"audio"},e.prototype.convertConstraints=function(e,t){if(void 0===t&&(t={}),!e)return null;var n=r.deepClone(t),i=e.deviceId;return e&&i&&(n.deviceId=i),n},e}();t.ConstraintsProviderBase=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e,t){this.logger=e,this.maxCapabilities=t}return e.prototype.ensureValidity=function(e){this.throwIfMissing(e);var t=this.calculateMissing(e);return this.maxCapabilities&&this.applyMaxCapabilities(t),this.logger.safe.info("Validating capabilities "+JSON.stringify(t)),t},e.prototype.throwIfMissing=function(e){if(!e.maxFs&&!e.maxMbps&&!e.maxFps||e.maxFs&&!e.maxMbps&&!e.maxFps||!e.maxFs&&e.maxMbps&&!e.maxFps||!e.maxFs&&!e.maxMbps&&e.maxFps)throw new Error("Missing video capabilities "+JSON.stringify(e))},e.prototype.calculateMissing=function(e){var t=i.shallowClone(e);return!e.maxFs&&e.maxMbps&&e.maxFps&&(t.maxFs=e.maxMbps/e.maxFps),e.maxFs&&!e.maxMbps&&e.maxFps&&(t.maxMbps=e.maxFs*e.maxFps),e.maxFs&&e.maxMbps&&!e.maxFps&&(t.maxFps=e.maxMbps/e.maxFs),t},e.prototype.applyMaxCapabilities=function(e){this.maxCapabilities.maxFs&&(e.maxFs=Math.min(e.maxFs,this.maxCapabilities.maxFs)),this.maxCapabilities.maxMbps&&(e.maxMbps=Math.min(e.maxMbps,this.maxCapabilities.maxMbps)),this.maxCapabilities.maxFps&&(e.maxFps=Math.min(e.maxFps,this.maxCapabilities.maxFps))},e}();t.VideoCapabilitiesValidator=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),r=n(50),o=function(){function e(e){this.resTable=new i.default(e)}return e.prototype.getPolicies=function(e){var t=this;if(!e.video)return[e];var n=this.getSuitableResolutions(e).map(function(n){return t.getConstraintsForResolution(e,n)}),i=e.audio,o={deviceId:e.video.deviceId},a=new r.ConstraintsObject(i,o);return n.push(a),n},e.prototype.getSuitableResolutions=function(e){return this.resTable.getResolutions().filter(function(t){return t.width<=e.video.maxWidth&&t.height<=e.video.maxHeight}).reverse()},e.prototype.getConstraintsForResolution=function(e,t){var n=e.clone();return n.video.minWidth=t.width,n.video.minHeight=t.height,n},e}();t.RequestPolicyGenerator=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),r=n(183),o=n(186),a=function(){function e(){}return e.getStreamProvider=function(e,t,n){var a="Edge"===i.getBrowserInfo().name;if("ScreenShare"===e){if(a&&r.ORTCDisplayStreamProvider.isSupported())return new r.ORTCDisplayStreamProvider(n);if(!a){if(t.config.webrtcGetDisplayMediaEnabled&&o.WebRTCDisplayStreamProvider.isSupported())return new o.WebRTCDisplayStreamProvider(n);if(o.WebRTCExtensionDisplayStreamProvider.isSupported())return new o.WebRTCExtensionDisplayStreamProvider(t,n)}return n.error("GUM stream provider cannot be created for display stream"),null}return a?new r.ORTCMediaStreamProvider(n):new o.WebRTCMediaStreamProvider(t,n)},e}();t.GumStreamProviderFactory=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(12),o=n(96),a=function(){function e(e){this.logger=e}return e.isSupported=function(){return!0},e.prototype.getStream=function(e){var t=this.constraintsAdapter.toGumConstraints(e);return this.logger.safe.info("Constraints to be applied: "+JSON.stringify(i.scrubConstraints(t))),new Promise(function(e,n){r.default.window.navigator.getUserMedia(t,e,n)}).catch(function(t){throw new o.MediaStreamErrorDecorator(t,e).getMediaError()})},e.prototype.applyConstraints=function(e,t){if(!e||!e.getVideoTracks()||!e.getVideoTracks()[0])return Promise.reject("No video tracks found");var n=e.getVideoTracks()[0];return this.applyConstraintsForTrack(n,t)},e.prototype.applyConstraintsForTrack=function(e,t){var n=this.constraintsAdapter.toTrackConstraints(t);return e.applyConstraints?(this.logger.safe.info("Apply constraints: "+JSON.stringify(n)+" on "+JSON.stringify(e.id)),e.applyConstraints(n).catch(function(e){throw new o.MediaStreamErrorDecorator(e,t).getMediaError()})):Promise.reject("track.applyConstraints() is not supported")},e}();t.GumStreamProviderBase=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(9),o=n(0),a=function(){function e(e,t){this.error=e,this.constraints=t}return e.prototype.getMediaError=function(){var e;switch(this.error.name){case"SourceUnavailableError":case"TrackStartError":case"NotReadableError":e={type:i.default.MEDIA_ERROR.sourceUnavailableError,detail:"media device is already used by another process: "+o.stringifyObject(this.error)};break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":e={type:i.default.MEDIA_ERROR.constraintNotSatisfiedError,detail:"could not obtain constrained media stream: "+o.stringifyObject(this.error)};break;case"DevicesNotFoundError":case"NotFoundError":e={type:i.default.MEDIA_ERROR.devicesNotFoundError,detail:"specified device not found: "+o.stringifyObject(this.error)};break;case"NotAllowedError":e="Permission denied by system"===this.error.message?{type:i.default.MEDIA_ERROR.permissionDeniedBySystemError,detail:"no system permissions: "+o.stringifyObject(this.error)}:{type:i.default.MEDIA_ERROR.permissionDeniedError,detail:"permission to use media device was denied: "+o.stringifyObject(this.error)};break;case"PermissionDeniedError":case"PermissionDismissedError":e={type:i.default.MEDIA_ERROR.permissionDeniedError,detail:"permission to use media device was denied: "+o.stringifyObject(this.error)};break;case i.default.MEDIA_ERROR.extensionNotFoundError:e={type:i.default.MEDIA_ERROR.extensionNotFoundError,detail:"extension is not found: "+o.stringifyObject(this.error)};break;case i.default.MEDIA_ERROR.chromeRuntimeNotDefinedError:e={type:i.default.MEDIA_ERROR.chromeRuntimeNotDefinedError,detail:"chrome runtime is not defined: "+o.stringifyObject(this.error)};break;case i.default.MEDIA_ERROR.sharingCancelledError:e=this.getSharingCancelledError(this.error);break;case i.default.MEDIA_ERROR.mediaStreamRequestTimedOut:e={type:i.default.MEDIA_ERROR.mediaStreamRequestTimedOut,detail:"Media Stream request timed out."};break;default:e=this.error.message===i.default.MEDIA_ERROR.sharingCancelledError?this.getSharingCancelledError(this.error):{type:i.default.MEDIA_ERROR.mediaStreamRequestError,detail:"media stream request error: "+o.stringifyObject(this.error)}}return e.isAudio=!!this.constraints.audio,e.detail+=" constraints: "+o.stringifyObject(r.scrubConstraints(this.constraints)),e.message=e.detail,e},e.prototype.getSharingCancelledError=function(e){return{type:i.default.MEDIA_ERROR.sharingCancelledError,detail:"screen sharing cancelled: "+o.stringifyObject(e)}},e}();t.MediaStreamErrorDecorator=a},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Manual=0]="Manual",e[e.Automatic=1]="Automatic"}(i=t.SelectionType||(t.SelectionType={}));var r=function(){function e(){}return e.prototype.getSelectedDevice=function(e){return null},e}(),o=function(){function e(){}return e.prototype.getSelectedDevice=function(e){return e&&(e.find(function(e){return e.isSystemDefault})||e[0])},e}();t.getDeviceSelectionStrategy=function(e){switch(e){case i.Manual:return new r;case i.Automatic:return new o;default:return null}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var l=n(8),u=n(6),d=n(19),p=n(55),f=n(0),h=function(e){function t(t,n,i){var r,o=e.call(this)||this;return o.deviceManager=t,o.serialQueue=n,o.logger=i,o.mediaStreams=((r={}).Audio=null,r.Video=null,r.ScreenShare=null,r),o.streamSubscriptions=new Map,o.currentMediaTypes=[],o}return r(t,e),Object.defineProperty(t.prototype,"streams",{get:function(){return this.mediaStreams},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.stop(),e.prototype.dispose.call(this)},t.prototype.start=function(e){return s(this,void 0,void 0,function(){var t,n=this;return c(this,function(i){switch(i.label){case 0:return t=f.keys(e).filter(function(t){return e[t]}),f.deepEqual(t,this.currentMediaTypes)?(this.logger.safe.info("Requested modalities have not changed. Do nothing"),[2,d.Helper.sendStreamsToModalities(this.streams)]):(this.currentMediaTypes=t,this.logger.safe.info("Starting media session with modalities: "+JSON.stringify(e)),[4,this.updateStreams(this.currentMediaTypes)]);case 1:return i.sent(),this.subscribeOnDeviceManagerEvents(this.deviceManager),this.currentMediaTypes=f.keys(this.streams).filter(function(e){return!!n.streams[e]}),[2,d.Helper.sendStreamsToModalities(this.streams)]}})})},t.prototype.stop=function(){return s(this,void 0,void 0,function(){var e=this;return c(this,function(t){return this.logger.safe.info("Stopping streams"),this.unsubscribeFromDeviceManagerEvents(),f.keys(this.mediaStreams).forEach(function(t){return e.removeStreamByType(t)}),this.currentMediaTypes=[],[2]})})},t.prototype.updateStreams=function(e){return s(this,void 0,void 0,function(){var t,n,i,r,o,a=this;return c(this,function(u){switch(u.label){case 0:return t=this.getAvailableMediaTypes(),n=l.intersection(e,t),i=f.keys(this.mediaStreams).filter(function(e){return a.mediaStreams[e]}),r=f.subtractFrom(n,i),o=f.subtractFrom(i,n),this.logger.safe.info("Adding media streams for types: "+JSON.stringify(r)),[4,Promise.all(r.map(function(e){return s(a,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,this.addStream(e)];case 1:return t.sent(),this.mediaStreams[e]&&this.event("onStreamAdded").raise(e),[2]}})})}))];case 1:return u.sent(),this.logger.safe.info("Removing media streams for types: "+JSON.stringify(o)),o.forEach(function(e){a.event("onStreamRemoving").raise(e),a.removeStreamByType(e)}),[2]}})})},t.prototype.getAvailableMediaTypes=function(){var e=this.deviceManager.getSelectedDevices(),t=[];return e.microphone&&t.push("Audio"),e.camera&&t.push("Video"),t.push("ScreenShare"),t},t.prototype.addStream=function(e){return s(this,void 0,void 0,function(){var t,n;return c(this,function(i){switch(i.label){case 0:if(this.mediaStreams[e])return this.logger.safe.warn("Stream with type: "+e+" is already registered"),[2];t=this.getStream(e),this.subscribeOnMediaStreamEvents(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.start()];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),this.logger.safe.error("Media stream request error: "+JSON.stringify(n)),this.event("onStreamError").raise(e,n),[2];case 4:return this.mediaStreams[e]=t,[2]}})})},t.prototype.removeStreamByType=function(e){var t=this.mediaStreams[e];t?(this.unsubscribeFromMediaStreamEvents(t),t.dispose(),this.mediaStreams[e]=null):this.logger.safe.warn("Stream with type: "+e+" is not registered")},t.prototype.updateStream=function(e){return s(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return this.removeStreamByType(e),[4,this.addStream(e)];case 1:return t.sent(),this.event("onStreamUpdated").raise(e),[2]}})})},t.prototype.subscribeOnMediaStreamEvents=function(e){var t=this;if(!this.streamSubscriptions.has(e)){var n=[];n.push(e.on("onStreamClientError",function(e,n){return t.onStreamError(e,n)})),n.push(e.on("onStreamClientDisposing",function(e){return t.onStreamDisposing(e)})),this.streamSubscriptions.set(e,n)}},t.prototype.unsubscribeFromMediaStreamEvents=function(e){this.streamSubscriptions.has(e)&&(this.streamSubscriptions.get(e).forEach(function(e){return e.dispose()}),this.streamSubscriptions.delete(e))},t.prototype.getStream=function(e){var t=this.mediaStreams[e];return t?(this.logger.safe.info("Stream exists with id: "+t.id+", type: "+e),t):this.getStreamByMediaType(e)},t.prototype.getStreamByMediaType=function(e){switch(e){case"Audio":return this.deviceManager.getAudioStream();case"Video":return this.deviceManager.getVideoStream();case"ScreenShare":var t=!!this.streams.Audio&&!!this.streams.Audio.getMixer();return this.deviceManager.getDisplayStream(t);default:throw new Error("Media type is not supported: "+e)}},t.prototype.getMediaTypeForStream=function(e){var t=this,n=f.keys(this.mediaStreams).find(function(n){return t.mediaStreams[n]===e});return n||this.logger.safe.error("Media type is not found for stream: "+e),n},t.prototype.subscribeOnDeviceManagerEvents=function(e){var t=this;this.deviceManagerSubscription||(this.deviceManagerSubscription=e.on("onSelectedDevicesChanged",function(e,n){return t.onSelectedDevicesChanged(e,n)}))},t.prototype.unsubscribeFromDeviceManagerEvents=function(){this.deviceManagerSubscription&&(this.deviceManagerSubscription.dispose(),this.deviceManagerSubscription=null)},t.prototype.getMediaTypesToUpdate=function(e,t){var n=[];return this.currentMediaTypes.some(function(e){return"Audio"===e})&&e.microphone&&e.microphone!==t.microphone&&n.push("Audio"),this.currentMediaTypes.some(function(e){return"Video"===e})&&e.camera&&e.camera!==t.camera&&n.push("Video"),n},t.prototype.removeStream=function(e){var t=this.getMediaTypeForStream(e);this.removeStreamByType(t)},t.prototype.onSelectedDevicesChanged=function(e,t){return s(this,void 0,void 0,function(){var n,i=this;return c(this,function(r){switch(r.label){case 0:return n=this.getMediaTypesToUpdate(e,t),this.logger.safe.info("Media types to update: "+JSON.stringify(n)),[4,Promise.all(n.map(function(e){return i.updateStream(e)}))];case 1:return r.sent(),[2]}})})},t.prototype.onStreamError=function(e,t){this.removeStream(e)},t.prototype.onStreamDisposing=function(e){this.removeStream(e)},o([p.sequentialize(),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"start",null),o([p.sequentialize(),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"stop",null),o([p.sequentialize(),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"onSelectedDevicesChanged",null),t}(u.default);t.SessionStreamsProvider=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.manager=null,this.extensionType=e}return e.prototype.initialize=function(e){e.manager&&(this.manager=e.manager),e.logger&&(this.logger=e.logger.createChild(this.extensionType))},e.prototype.dispose=function(){this.manager&&(this.manager=null),this.logger&&(this.logger.safe.info("disposed"),this.logger=null)},e.prototype.configure=function(e){this.options=e},e.prototype.getOptions=function(){return this.options},e.prototype.getType=function(){return this.extensionType},e}();t.ExtensionBase=i},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\S*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{name:"signalingFbXMessage",reg:/^x-signaling-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){return"x-signaling-fb:"+("*"===e.payload?"%s":"%d")+" x-message %s"}},{push:"xMediaSettings",reg:/^x-mediasettings:([\S| ]*)/,names:["settings"],format:"x-mediasettings:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.MBPS_VALUES=[2812,4218,8437,16875,33750,67500,108e3,135e3,198e3,244800,27e4,352500,52e4];var r=function(){function e(e,t){this.maxFS=e,this.maxFPS=t}return e.prototype.setMaxFS=function(e,t){return!(this.maxFS===e||(this.maxFS=e,!t)||(t(this),0))},e.prototype.getMaxFS=function(){return this.maxFS},e.prototype.getMaxFPS=function(){return this.maxFPS},e.prototype.getMaxMBPS=function(){return this.calculateMbps(this.maxFS,this.maxFPS)},e.prototype.calculateMbps=function(e,n){var r=e*n/100;return i.getClosestValue(t.MBPS_VALUES,r,!0)},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.queue=[],this.logger=e}return e.prototype.cleanup=function(){this.queue.forEach(function(e){e.reject({notSent:e.tones})}),this.queue=[]},e.prototype.waitForNotification=function(e){var t=this;return e?(this.logger.unsafe.info("sending dtmf tones: ",e),new Promise(function(n,i){t.queue.push({tones:e,resolve:n,reject:i})})):Promise.reject(new Error("invalid input"))},e.prototype.toneSent=function(e){this.queue[0]&&(e===this.queue[0].tones[0]?(this.queue[0].tones=this.queue[0].tones.substr(1),""===this.queue[0].tones&&(this.queue[0].resolve(),this.queue.shift())):(this.queue[0].reject(new Error("sent tone does not match: expected '"+this.queue[0].tones[0]+"' got '"+e+"'")),this.queue.shift(),this.toneSent(e)))},e}();t.DTMFQueue=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(12),s=function(e){function t(t,n,i){var r=e.call(this)||this;return r.videoElement=t,r.minInterval=n,r.maxInterval=i,r.window=a.default.window,r.originalVideoElementSize={width:t.offsetWidth,height:t.offsetHeight},r.initializeSizeTracking(),r}return r(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return this.originalVideoElementSize.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.originalVideoElementSize.height},enumerable:!0,configurable:!0}),t.prototype.initializeSizeTracking=function(){var e=this,t=Math.floor(Math.random()*Math.abs(this.maxInterval-this.minInterval))+this.minInterval;this.elementSizeTrackingRef=this.window.setInterval(function(){e.videoElementSizeChanged()&&(e.saveCurrentVideoElementSize(),e.raiseChanged())},t)},t.prototype.dispose=function(){this.elementSizeTrackingRef&&this.window.clearInterval(this.elementSizeTrackingRef)},t.prototype.videoElementSizeChanged=function(){return this.originalVideoElementSize.width!==this.videoElement.offsetWidth||this.originalVideoElementSize.height!==this.videoElement.offsetHeight},t.prototype.saveCurrentVideoElementSize=function(){this.originalVideoElementSize.width=this.videoElement.offsetWidth,this.originalVideoElementSize.height=this.videoElement.offsetHeight},t}(o.default);t.VideoSizeTracker=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(0),s=n(38),c=n(49),l=n(103),u=function(e){function t(t,n,i,r){var o=e.call(this,r)||this;return o.logger=t,o.configProvider=n,o.subscriptionManager=i,o.disposed=!1,o}return r(t,e),t.prototype.subscribeVideoAsync=function(e,t){var n=this;return new Promise(function(i,r){n.modality=t?o.default.MODALITY.sharing:o.default.MODALITY.video,n.trackElementSizeChange(),n.unsubscribe();var s=n.subscriptionManager.subscribeVideo(n.modality,e);n.subscription=s,n.logger.safe.info("subscribing renderer to type: "+s.getModality()+" msi: "+s.getMsi()),s.onMediaStreamChanged(function(e){n.attachMediaStream(e),n.logger.safe.info("subscribed renderer to type: "+s.getModality()+" msi: "+s.getMsi()+" on stream #"+(e?e.id:"none")),i()}),s.onError(function(e){n.logger.safe.error("failed to subscribe renderer "+a.stringifyObject(e)),r(e)})})},t.prototype.dispose=function(){this.disposed?this.logger.safe.warn("renderer already disposed"):(this.disposed=!0,this.unsubscribe(),this.sizeTracker&&this.sizeTracker.dispose(),this.event("onRendererDisposed").raise(this,this.getVideoElement()),e.prototype.dispose.call(this))},t.prototype.getModality=function(){return this.modality},t.prototype.getMsi=function(){return this.subscription?this.subscription.getMsi():s.MediaSourceIdentifiers.SourceNone},t.prototype.getCurrentResolution=function(){return this.resolution?this.resolution:{width:0,height:0}},t.prototype.trackElementSizeChange=function(){var e=this,t=this.modality===o.default.MODALITY.sharing,n=t?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMin:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMin,i=t?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMax:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMax;n&&i?(this.sizeTracker=new l.VideoSizeTracker(this.getVideoElement(),n,i),this.sizeTracker.changed(function(){return e.onSizeTrackerChanged()})):this.logger.safe.info("skipping video size tracking")},t.prototype.onSizeTrackerChanged=function(){this.resolution={width:this.sizeTracker.width,height:this.sizeTracker.height},this.logger.safe.info("video renderer size changed to "+this.resolution.width+"x"+this.resolution.height),this.event("onRendererSizeChanged").raise(this,this.resolution)},t.prototype.unsubscribeNow=function(){this.subscription&&(this.subscription.disposeNow(),this.subscription=null)},t.prototype.unsubscribe=function(){this.subscription&&(this.subscription.dispose(),this.subscription=null)},t}(c.VideoRendererBase);t.RemoteVideoRenderer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e){this.streams=[],this.listener=e}return e.prototype.add=function(e){this.streams.some(function(t){return t.getId()===e.getId()})||(this.streams.push(e),this.listener.streamAdded(e))},e.prototype.remove=function(e){var t;i.remove(this.streams,function(n){return n.getId()===e&&(t=n,!0)})&&this.listener.streamRemoved(t)},e.prototype.getStreams=function(){return this.streams},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),a=n(6),s=n(0),c=n(38),l=function(){function e(e){this.subscription=e}return e.prototype.getMsi=function(){return this.checkDisposed(),this.subscription.getMsi()},e.prototype.getModality=function(){return this.checkDisposed(),this.subscription.getModality()},e.prototype.onMediaStreamChanged=function(e){this.checkDisposed(),this.mediaStreamChanged=e,this.subscription.isStreamReady()&&this.notifyMediaStreamChanged()},e.prototype.onError=function(e){this.checkDisposed(),this.error=e},e.prototype.dispose=function(){this.subscription&&(this.subscription.dispose(o.generateCauseId(),this),this.subscription=null)},e.prototype.disposeNow=function(){this.subscription&&(this.subscription.disposeNow(),this.subscription=null)},e.prototype.notifyMediaStreamChanged=function(){if(this.mediaStreamChanged){var e=this.subscription.getStream(),t=this.subscription.isStreamReady();this.mediaStreamChanged(e&&t?e.getMediaStream():null)}},e.prototype.notifyError=function(e){this.error&&this.error(e)},e.prototype.checkDisposed=function(){if(!this.subscription)throw new Error("subscription disposed")},e}(),u=function(e){function t(t,n,i){var r=e.call(this)||this;return r.modality=t,r.msi=n,r.disposeTimeout=i,r.clients=[],r.streamReady=!1,r}return r(t,e),t.prototype.client=function(){var e=new l(this);return this.clients.push(e),e},t.prototype.getMsi=function(){return this.msi},t.prototype.getStream=function(){return this.stream},t.prototype.isStreamReady=function(){return this.streamReady},t.prototype.getModality=function(){return this.modality},t.prototype.setStream=function(e){var t=this;e!==this.stream&&(this.stream&&(this.releaseStream(),this.notifyStreamChanged()),this.stream=e,e&&(this.streamReady=!1,e.requestSource(this.msi).then(function(){t.streamReady=!0,t.notifyStreamChanged()}).catch(function(e){t.notifyError(e)})))},t.prototype.notifyError=function(e){this.clients.forEach(function(t){return t.notifyError(e)})},t.prototype.disposeIfInactive=function(){this.clients.length||this.disposeNow()},t.prototype.dispose=function(e,t){var n=this;t?(s.remove(this.clients,function(e){return e===t}),this.clients.length||setTimeout(function(){return n.disposeIfInactive()},this.disposeTimeout)):(this.clients=[],this.disposeNow())},t.prototype.notifyStreamChanged=function(){this.clients.forEach(function(e){return e.notifyMediaStreamChanged()}),this.event("onStreamChanged").raise()},t.prototype.releaseStream=function(){this.stream&&(this.stream.requestSource(c.MediaSourceIdentifiers.SourceNone).catch(function(){}),this.streamReady=!1,this.stream=null)},t.prototype.disposeNow=function(){this.releaseStream(),this.event("onDisposed").raise(this)},t}(a.default),d=function(e){function t(t,n){var i=e.call(this)||this;return i.videoSubscriptions=[],i.subscriptionEvents=new Map,i.logger=t.logger.createChild("subs"),i.configProvider=t.configProvider,i.setStreamProvider(n),i.logger.safe.info("created"),i}return r(t,e),t.prototype.setStreamProvider=function(e){var t=this;this.streamProvider=e,this.streamProvider.onStreamsChanged(function(){return t.streamsChanged()})},t.prototype.subscribeVideo=function(e,t){var n=this;void 0===t&&(t=c.MediaSourceIdentifiers.SourceAny);var i=s.find(this.videoSubscriptions,function(n){return n.getMsi()===t&&n.getModality()===e});if(!i){this.disposeInactiveSubscriptions(),this.logger.safe.info("creating new subscription #"+t+" for modality "+e),this.event("onSubscriptionChanged").raise(1,e,t),i=new u(e,t,this.configProvider.config.webrtcVideoSubscriptionDisposeTimeout);var r=[];r.push(i.on("onDisposed",function(e){return n.onSubscriptionDisposed(e)})),r.push(i.on("onStreamChanged",function(){return n.updateTrackIds()})),this.subscriptionEvents.set(i,r),this.videoSubscriptions.push(i);var o=this.getAvailableStream(e);o&&this.assignStream(i,o)}return i.client()},t.prototype.dispose=function(){var t=o.generateCauseId();this.videoSubscriptions.concat().forEach(function(e){return e.dispose(t)}),this.streamProvider.onStreamsChanged(null),e.prototype.dispose.call(this),this.logger.safe.info("disposed")},t.prototype.disposeInactiveSubscriptions=function(){this.videoSubscriptions.concat().forEach(function(e){e.getStream()&&e.disposeIfInactive()})},t.prototype.streamsChanged=function(){var e=this;this.logger.safe.info("streams changed, subscriptions active: "+this.videoSubscriptions.length),this.videoSubscriptions.forEach(function(t){var n=!t.getStream()||e.isStreamRemoved(t.getStream());if(e.logger.safe.info("Subscription for "+t.getModality()+" "+t.getMsi()+" needs new stream: "+n),n){var i=e.getAvailableStream(t.getModality());i?e.assignStream(t,i):e.resignStream(t)}})},t.prototype.getAvailableStream=function(e){var t=this.streamProvider.getStreams();return s.find(t,function(t){return e===t.getModality()&&t.getMsi()===c.MediaSourceIdentifiers.SourceNone})},t.prototype.isStreamRemoved=function(e){return!this.streamProvider.getStreams().some(function(t){return t===e})},t.prototype.assignStream=function(e,t){this.logger.safe.info("assigning stream #"+t.getId()+" to subscription #"+e.getMsi()),e.setStream(t)},t.prototype.resignStream=function(e){e.getStream()&&(this.logger.safe.info("removing stream from subscription #"+e.getMsi()),e.setStream(null))},t.prototype.onSubscriptionDisposed=function(e){var t=o.generateCauseId();this.event("onSubscriptionChanged").raise(3,e.getModality(),e.getMsi()),this.logger.safe.info("disposing subscription for "+e.getModality()+" #"+e.getMsi()),s.remove(this.videoSubscriptions,function(t){return t===e}),this.streamsChanged(),this.updateTrackIds(),this.subscriptionEvents.has(e)&&(this.subscriptionEvents.get(e).forEach(function(e){return e.dispose(t)}),this.subscriptionEvents.delete(e))},t.prototype.updateTrackIds=function(){var e=[],t=[];this.videoSubscriptions.forEach(function(n){if(n.isStreamReady()){var i=n.getStream().getId().split("-")[1];t.push(i),n.getStream().getMediaStream().getVideoTracks().forEach(function(t){return e.push(t.id)})}}),this.event("onTrackIdsChanged").raise(e),this.configProvider.config.subscribeToSsrcForVideo&&this.event("onTrackSsrcChanged").raise(t)},t}(a.default);t.SubscriptionManager=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),r=n(12),o=n(226),a=n(236);t.default={build:function(e){return void 0!==r.default.window.webkitRTCPeerConnection?e.unifiedPlanEnabled?new o.default(e):new a.WebkitAdapter(e):void 0!==r.default.window.mozRTCPeerConnection||void 0!==r.default.window.RTCPeerConnection&&"Safari"===i.getBrowserInfo().name?new o.default(e):new function(){function e(){throw new Error("unsupported platform")}this.SdpTransform=e,this.RTCPeerConnection=e,this.RTCSessionDescription=e,this.RTCRtpReceiver=e}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(12);function r(){var e=[].slice.apply(arguments),t=e[0]&&o(e[0].type);e.splice(0,t?1:0,null);var n=new(Function.prototype.bind.apply(i.default.window.RTCSessionDescription,e)),r=Object.getOwnPropertyDescriptor(i.default.window.RTCSessionDescription.prototype,"type");return Object.defineProperty(n,"type",{get:function(){return t?"rollback":r.get.call(n)},set:function(e){(t=o(e))||r.set.call(n,e)}}),n}function o(e){return"rollback"===e}t.default={build:function(){return r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(12);!function(e){e[e.Stopped=0]="Stopped",e[e.Started=1]="Started",e[e.Unsupported=2]="Unsupported"}(i=t.ContributingSourcesHandlerState||(t.ContributingSourcesHandlerState={}));var o=function(){function e(e){this.context=e,this._state=i.Stopped,this._lastSources=[],this._window=r.default.window,this._logger=e.logger.createChild("contributingSources")}return e.prototype.startPolling=function(){this._state===i.Stopped&&(this._state=i.Started,this._logger.safe.info("polling started"),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.configProvider.config.webrtcContributingSourcesPollingInterval))},e.prototype.stopPolling=function(){this._state===i.Started&&(this._timer&&(this._window.clearTimeout(this._timer),this._timer=void 0),this._state=i.Stopped,this._logger.safe.info("polling stopped"))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.poll=function(){var e=this;if(this._state===i.Started){var t=this.context.provider();t?(this.context.activeSpeakerManager.onContributingSourcesChanged(t.filter(function(t){var n=e._lastSources.filter(function(e){return e.source===t.source})[0];return!n||n.timestamp!==t.timestamp}).map(function(e){return e.source})),this.updateLastSources(t),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.configProvider.config.webrtcContributingSourcesPollingInterval)):(this._logger.safe.info("contributing sources are not supported on this client"),this._state=i.Unsupported,this.stopPolling())}},e.prototype.updateLastSources=function(e){var t=this;this._lastSources=[],e.forEach(function(e){t._lastSources.push({source:e.source,timestamp:e.timestamp})})},e}();t.ContributingSourcesHandler=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(111),a=n(28),s=function(){function e(e){this.mediaEntities=[],this.mediaEntitiesBackup=[],this.mediaTracks=[],this.logger=e.logger.createChild("MM"),this.configProvider=e.configProvider,this.numVideoChannels=e.numVideoChannels}return e.prototype.fromOffer=function(e,t){var n=this;e.media.forEach(function(e){if(e.type===r.default.MEDIA_TYPE.audio)r.default.MODALITY.audio in t&&n.addMediaEntity(r.default.MODALITY.audio);else if(e.type===r.default.MEDIA_TYPE.video){if(r.default.MODALITY.video in t)for(var i=0;i<n.numVideoChannels;i++)n.addMediaEntity(r.default.MODALITY.video);r.default.MODALITY.sharing in t&&n.addMediaEntity(r.default.MODALITY.sharing)}else e.type===r.default.MEDIA_TYPE.data&&r.default.MODALITY.data in t&&n.addMediaEntity(r.default.MODALITY.data)})},e.prototype.fromRemote=function(e,t){var n=this;e.media.forEach(function(e,r){var o=a.getModality(e);if(0!==e.port&&o in t){if(n.mediaEntities[r]?n.mediaEntities[r].update(o,e.mid||n.generateMid(r)):n.addMediaEntity(o,e.mid||n.generateMid(r)),e.msid)n.mediaEntities[r].setStreamId(e.msid.split(" ")[0]),n.mediaEntities[r].setRemoteTrackId(e.msid.split(" ")[1]);else if(e.ssrcs){var s=i.find(e.ssrcs,function(e){return"msid"===e.attribute});s?(n.mediaEntities[r].setStreamId(s.value.split(" ")[0]),n.mediaEntities[r].setRemoteTrackId(s.value.split(" ")[1])):n.logger.safe.warn("No ssrc msid for media of type "+e.type+" with mid "+e.mid)}var c=e.xSourceStreamId||n.generateSourceStreamId(r);n.mediaEntities[r].setXSourceStreamId(c)}else n.mediaEntities[r]?n.mediaEntities[r].disable():n.addDisabledMediaEntity(o),n.mediaEntities[r].setStreamId(null),n.mediaEntities[r].setRemoteTrackId(null)})},e.prototype.isEmpty=function(){return 0===this.mediaEntities.length},e.prototype.addMediaEntity=function(e,t){this.mediaEntities.push(o.default.create(this.configProvider,e,t||this.generateMid(this.mediaEntities.length)))},e.prototype.addDisabledMediaEntity=function(e){this.mediaEntities.push(o.default.create(this.configProvider,e,null))},e.prototype.getMediaEntities=function(){return this.mediaEntities},e.prototype.getMediaEntity=function(e){return this.mediaEntities[e]},e.prototype.getMediaEntityByMid=function(e){return i.find(this.mediaEntities,function(t){return t.getMid()===e})},e.prototype.getMediaEntitiesByModality=function(e){return this.mediaEntities.filter(function(t){return t.getModality()===e})},e.prototype.getMediaEntityByStreamId=function(e){return i.find(this.mediaEntities,function(t){return t.getStreamId()===e})},e.prototype.getMediaEntityByLocalTrackId=function(e){return i.find(this.mediaEntities,function(t){return t.getLocalTrackIds().indexOf(e)>=0})},e.prototype.getMediaEntityByXSourceStreamId=function(e){return i.find(this.mediaEntities,function(t){return t.getXSourceStreamId()===e})},e.prototype.reset=function(){this.mediaEntities=[]},e.prototype.syncModalities=function(e,t,n){this.disableModalities(t),n||(this.enableModalities(t),this.addModalities(t))},e.prototype.enableModalities=function(e){var t=this;this.mediaEntities.forEach(function(n,i){n.getModality()in e&&n.isDisabled()&&n.update(n.getModality(),t.generateMid(i))})},e.prototype.disableModalities=function(e){this.mediaEntities.forEach(function(t){t.getModality()in e||t.disable()})},e.prototype.addModalities=function(e){var t={};for(var n in this.mediaEntities.map(function(e){return e.getModality()}).forEach(function(e){t[e]=!0}),e)n in t||this.addMediaEntity(n)},e.prototype.setLocalTracksInfo=function(e){this.mediaTracks=e},e.prototype.getLocalTracksInfo=function(){return this.mediaTracks},e.prototype.updateMediaEntitiesWithLocalTracks=function(){var e=this;this.mediaTracks&&this.mediaTracks.forEach(function(t){var n=e.getMediaEntitiesByModality(t.modality)[0];if(n){var i=e.mediaTracks.filter(function(e){return t.modality===e.modality}).map(function(e){return e.trackId});n.setLocalTrackIds(i)}else e.logger.safe.error("Media entity is not found for modality: "+JSON.stringify(t.modality))})},e.prototype.backup=function(){var e=this;this.mediaEntitiesBackup=[],this.mediaEntities.forEach(function(t){e.mediaEntitiesBackup.push(t.clone())})},e.prototype.commit=function(){this.mediaEntitiesBackup=[]},e.prototype.rollback=function(){this.mediaEntities=this.mediaEntitiesBackup},e.prototype.generateSourceStreamId=function(e){return e+10},e.prototype.generateMid=function(e){return"media_"+e},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(101),r=n(2),o=n(28),a=function(){function e(e,t,n,i,r,o,a,s,c,l){this.configProvider=e,this.modality=t,this.mid=n,this.mtype=i,this.streamId=r,this.remoteTrackId=o,this.xSourceStreamId=a,this.remoteSsrc=s,this.videoCapabilities=c,this.extensions=l,this.localTrackIds=[]}return e.getVideoCababilities=function(e,t,n){if(e===r.default.MEDIA_TYPE.video){var o=void 0,a=void 0;return t===r.default.MODALITY.sharing?(o=n.config.webrtcScreensharingCapabilityMaxFS,a=n.config.webrtcScreensharingCapabilityMaxFPS):(o=n.config.webrtcVideoCapabilityMaxFS,a=n.config.webrtcVideoCapabilityMaxFPS),new i.default(o,a)}return null},e.create=function(t,n,i){var r=o.getTypeFromModality(n);return new e(t,n,i,r,null,null,null,null,e.getVideoCababilities(r,n,t),{})},e.prototype.clone=function(){return new e(this.configProvider,this.modality,this.mid,this.mtype,this.streamId,this.remoteTrackId,this.xSourceStreamId,this.remoteSsrc,this.videoCapabilities,this.extensions)},e.prototype.getModality=function(){return this.modality},e.prototype.getType=function(){return this.mtype},e.prototype.getMid=function(){return this.mid},e.prototype.disable=function(){this.mid=null},e.prototype.update=function(t,n){this.modality!==t&&(this.videoCapabilities=e.getVideoCababilities(this.mtype,t,this.configProvider)),this.modality=t,this.mid=n},e.prototype.isDisabled=function(){return!this.mid},e.prototype.isEnabled=function(){return!!this.mid},e.prototype.getVideoCapabilities=function(){return this.videoCapabilities},e.prototype.getStreamId=function(){return this.streamId},e.prototype.setStreamId=function(e){this.streamId=e},e.prototype.setRemoteSsrc=function(e){this.remoteSsrc=e},e.prototype.getRemoteSsrc=function(){return this.remoteSsrc},e.prototype.getRemoteTrackId=function(){return this.remoteTrackId},e.prototype.setRemoteTrackId=function(e){this.remoteTrackId=e},e.prototype.getXSourceStreamId=function(){return this.xSourceStreamId},e.prototype.setXSourceStreamId=function(e){this.xSourceStreamId=e},e.prototype.setLocalTrackIds=function(e){this.localTrackIds=e},e.prototype.getLocalTrackIds=function(){return this.localTrackIds},e.prototype.getExtension=function(e){return this.extensions[e]},e.prototype.setExtension=function(e,t){this.extensions[e]=t},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),r=function(){function e(e,t,n,i,r){this.logger=e,this.webRtcAdapter=t,this.sessionDescription=n,this.negotiationQueue=i,this.mediaManager=r}return e.prototype.dispose=function(){this.peerConnection=null},e.prototype.configure=function(e){this.peerConnection=e},e.prototype.renegotiateNow=function(){return this.renegotiate(null,!0)},e.prototype.renegotiate=function(e,t){if(void 0===t&&(t=!1),!this.peerConnection)throw new Error("trying to renegotiate during empty peerConnection");var n=this.createNegotiationTask(e);return t?(this.logger.safe.info("forced local renegotiation starting"),Promise.resolve(n())):this.negotiationQueue.add(n)},e.prototype.normalizeSDESAnswer=function(e){var t=this.peerConnection.localDescription.sdp,n=i.parse(t),r=i.parse(e);if(n.media[0].crypto)r.media.forEach(function(e){delete e.fingerprint,delete e.setup,e.crypto=e.crypto.filter(function(e){return n.media[0].crypto.some(function(t){return t.id===e.id})}).slice(0,1)}),r.fingerprint&&delete r.fingerprint;else{var o=this.mediaManager.getMediaEntities().find(function(e){return void 0!==e.getExtension("setup")});r.media.forEach(function(e){var t=o&&o.getExtension("setup")||"actpass";"actpass"===e.setup&&(e.setup="active"===t?"passive":"active")})}return i.write(r)},e.prototype.createNegotiationTask=function(e){var t=this,n=function(){if(!t.peerConnection)throw t.logger.safe.warn("no peer connection present"),new Error("trying to renegotiate during empty peerConnection")};return function(){t.logger.safe.debug("Local renegotiation starting...");var i=new t.webRtcAdapter.RTCSessionDescription({sdp:t.normalizeSDESAnswer(t.peerConnection.remoteDescription.sdp),type:"answer"});return e&&e.forEach(function(e){i=e.modifyDescriptor(i)}),Promise.resolve().then(function(){return t.logger.safe.debug("creating offer"),n(),t.peerConnection.createOffer()}).then(function(e){n();var i=t.sessionDescription.createLocalOffer(e.sdp),r=new t.webRtcAdapter.RTCSessionDescription({sdp:i.toLocal(),type:"offer"});return t.logger.safe.debug("setting local description"),t.peerConnection.setLocalDescription(r)}).then(function(){return n(),t.logger.safe.debug("setting remote description"),t.peerConnection.setRemoteDescription(i)}).then(function(e){return t.logger.safe.debug("local renegotiation done"),e}).catch(function(e){throw t.logger.safe.error("local renegotiation failed: ",e.toString()),e})}},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(240),a=n(242),s=n(243),c=n(244),l=function(){function e(e,t,n,i,r){var o=this;this.logger=e,this.settings=t,this.listener=n,this.provider=i,this.configProvider=r,this.mediaSourceModels=[],this.settings.scalingEnabled&&(this.receiverCountCalculator=new a.OptimalReceiversCountCalculator(this.provider,this.settings.videoReceiversCount,this.logger.createChild("OptVideoCnt"),this.settings),this.receiverCountCalculatorSubscription=this.receiverCountCalculator.on("onOptimalReceiversCountChanged",function(e){return o.onOptimalReceiversCountChanged(e)}),this.onOptimalReceiversCountChanged(this.settings.videoReceiversCount))}return e.prototype.dispose=function(){this.mediaSourceModels.forEach(function(e){e.handler&&(e.handler.dispose(),e.handler=null)}),this.mediaSourceModels=null,this.receiverCountCalculator&&(this.receiverCountCalculatorSubscription.dispose(),this.receiverCountCalculatorSubscription=null,this.receiverCountCalculator.dispose(),this.receiverCountCalculator=null),this.statsSubscription&&(this.statsSubscription.dispose(),this.statsSubscription=null),this.sendBandwidthCalculator&&this.disableSendBandwidthCalculator()},e.prototype.updateRegisteredSources=function(e){this.logger.safe.info("Local media params updated: "+JSON.stringify(e));var t=[];this.mediaSourceModels.forEach(function(e){return t.push(e.sourceId)});var n=e.map(function(e){return e.sourceId}),r=i.subtractFrom(t,n);this.removeSourcesWithIds(r);var o=i.subtractFrom(n,t);this.addSourcesWithIds(o,e),this.settings.sendBandwidthNotificationsEnabled&&this.updateSendBandwidthCalculator()},e.prototype.setMaxCapabilities=function(e){var t=this;return Promise.all(e.map(function(e){if(e.capabilities.length)if(e.sourceId){if((1!==e.capabilities.length||void 0!==e.capabilities[0])&&!e.capabilities.some(function(e){return!!e.ssrc})){var n=t.getModelWithSourceId(e.sourceId);n&&e.capabilities.forEach(function(e){e.ssrc||(e.ssrc=n.defaultSSRC)})}if(t.isRegistered(e.sourceId)){t.logger.safe.info("Capabilities handler found for sourceId: "+e.sourceId);var i=t.getModelWithSourceId(e.sourceId);if(!i)return void t.logger.safe.info("Model is not registered for sourceId: "+e.sourceId);var r=t.getOrCreateHandlerForModel(i,e.isSimulcast);return r?r.setMaxCapabilities(e.causeId,e.capabilities):void t.logger.safe.info("Handler is not found for sourceId: "+e.sourceId)}t.logger.safe.info("Source "+e.sourceId+" is not registered for receive capabilities")}else t.logger.safe.info("SourceId is not defined to apply recv capabilities: "+JSON.stringify(e))})).then(function(){t.logger.safe.debug("Max capabilities application completed")}).catch(function(e){t.logger.error("Max capabilities application error: "+JSON.stringify(e))})},e.prototype.resetCurrentResolution=function(){var e=this.mediaSourceModels.find(function(e){return e.modality===r.default.MODALITY.video});e&&e.handler&&e.handler.resetCurrentResolution()},e.prototype.getCurrentResolution=function(){var e=this.mediaSourceModels.find(function(e){return e.modality===r.default.MODALITY.video});return e&&e.handler?e.handler.getCurrentResolution():this.currentResolution&&this.currentResolution.fs},e.prototype.setCurrentResolution=function(e){var t=this.mediaSourceModels.find(function(e){return e.modality===r.default.MODALITY.video});t&&t.handler?t.handler.setCurrentResolution(e):this.currentResolution=e},e.prototype.getOrCreateHandlerForModel=function(e,t){return e.handler||(e.handler=this.getCapabilitiesHandler(e.modality,t)),e.handler},e.prototype.addSourcesWithIds=function(e,t){var n=this;e.forEach(function(e){var i=t.find(function(t){return t.sourceId===e});n.registerSource(e,i.modality,i.defaultSSRC)})},e.prototype.removeSourcesWithIds=function(e){var t=this;e.forEach(function(e){return t.unregisterSource(e)})},e.prototype.registerSource=function(e,t,n){this.logger.safe.info("SourceId "+e+" registered with mediaType: "+t),this.mediaSourceModels.push({modality:t,defaultSSRC:n,sourceId:e})},e.prototype.unregisterSource=function(e){var t=this.mediaSourceModels.find(function(t){return t.sourceId===e});t?(t.handler&&t.handler.dispose(),this.mediaSourceModels.splice(this.mediaSourceModels.indexOf(t),1),this.logger.safe.info("SourceId "+e+" unregistered")):this.logger.safe.info("Model doesn't exist with sourceId "+e)},e.prototype.updateSendBandwidthCalculator=function(){this.mediaSourceModels.some(function(e){return[r.default.MODALITY.video,r.default.MODALITY.sharing].indexOf(e.modality)>-1})?this.enableSendBandwidthCalculator():this.disableSendBandwidthCalculator()},e.prototype.enableSendBandwidthCalculator=function(){var e=this;this.sendBandwidthCalculator||(this.sendBandwidthCalculator=new c.SendBandwidthCalculator(this.configProvider,this.provider,this.logger.createChild("SendBwCalc")),this.sendBandwidthCalculatorSubscription=this.sendBandwidthCalculator.on("onSendBandwidthChanged",function(t){return e.onSendBandwidthChanged(t)}))},e.prototype.disableSendBandwidthCalculator=function(){this.sendBandwidthCalculatorSubscription&&(this.sendBandwidthCalculatorSubscription.dispose(),this.sendBandwidthCalculatorSubscription=null),this.sendBandwidthCalculator&&(this.sendBandwidthCalculator.dispose(),this.sendBandwidthCalculator=null)},e.prototype.getModelWithSourceId=function(e){return this.mediaSourceModels.find(function(t){return t.sourceId===e})},e.prototype.isRegistered=function(e){return!!this.getModelWithSourceId(e)},e.prototype.getCapabilitiesHandler=function(e,t){if(e===r.default.MODALITY.audio)return null;if(e===r.default.MODALITY.video&&!t&&this.settings.customBwEstimationEnabled){var n=new o.AdaptiveCapablitiesHandler(this.listener,this.provider,this.logger.createChild("ach"),this.configProvider,this.settings,t);return this.currentResolution&&n.setCurrentResolution(this.currentResolution),n}return new s.DirectCapabilitiesHandler(e,this.listener,this.provider,t)},e.prototype.onSendBandwidthChanged=function(e){var t=this;return this.listener.onSendBandwidthChanged(e).catch(function(e){t.logger.safe.error("Error while reporting send bandwidth change",e),t.sendBandwidthCalculator.forceUpdate()})},e.prototype.onOptimalReceiversCountChanged=function(e){this.listener.onOptimalVideoReceiversCountChanged(e)},e}();t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(30),a=n(6),s=n(2),c=function(e){function t(t,n,i,r,o){var a=e.call(this)||this;return a.logger=t,a.multiParty=n,a.resolutionTable=i,a.configProvider=r,a.mediaManager=o,a}return r(t,e),t.prototype.getMaxFS=function(e,t){var n=this.resolutionTable.getMaxFS(e,t);return n=this.multiParty?Math.min(n,this.configProvider.config.webrtcMultiPartyRecvVideoMaxFS):Math.min(n,this.configProvider.config.webrtcRecvVideoMaxFS)},t.prototype.rendererSizeChanged=function(e,t){var n=this,i=e.getMediaStream();if(i){var r=this.mediaManager.getMediaEntityByStreamId(i.id);if(!r||!r.getVideoCapabilities())return void this.logger.safe.warn("no capabilities for provided modality: "+e.getModality());var a=this.getMaxFS(t.width,t.height),c=r.getVideoCapabilities();c.setMaxFS(a,function(){if(n.logger.safe.info("updated max-fs video capability to "+a),n.multiParty&&n.configProvider.config.webrtcMultiPartyRecvVideoSignaling){var t=e.getMsi(),i=Number(r.getXSourceStreamId()),l=o.default.build();l.setIfMissing(s.default.VIDEO_CAPABILITIES.MAX_FS_PATH,c.getMaxFS().toString()),l.setIfMissing(s.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH,c.getMaxMBPS().toString()),l.setIfMissing(s.default.VIDEO_CAPABILITIES.MAX_FPS_PATH,c.getMaxFPS().toString()),n.event("onSourceRequestRequired").raise(r.getModality(),i,t,l.toString())}else n.event("onNegotiationRequired").raise()})}else this.logger.safe.warn("renderer has no stream attached")},t}(a.default);t.RemoteVideoResolutionManager=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,i,r){this.logger=e,this.configProvider=t,this.stats=n,this.remoteVideoResolutionManager=i,this.domOverrides=r,this.remoteRendererSubscriptions=new Map,this.lastPreferredResolutions=new Map}return Object.defineProperty(e.prototype,"renderers",{get:function(){var e=[];return this.remoteRendererSubscriptions.forEach(function(t,n){return e.push(n)}),e},enumerable:!0,configurable:!0}),e.prototype.addRemoteRenderer=function(e){this.remoteRendererSubscriptions.set(e,this.subscribeOnEvents(e)),this.updateLimitedResolutions(),this.logger.safe.info("Added renderer to manager")},e.prototype.dispose=function(){this.remoteRendererSubscriptions.forEach(function(e){return e.forEach(function(e){return e.dispose()})}),this.remoteRendererSubscriptions.clear()},e.prototype.subscribeOnEvents=function(e){var t=this;return[e.on("onRendererSizeChanged",function(e,n){return t.onRendererSizeChanged(e,t.limitRendererResolution(n))}),e.on("onRendererDisposed",function(e,n){var i=e;t.remoteRendererSubscriptions.get(i).forEach(function(e){return e.dispose()}),t.remoteRendererSubscriptions.delete(i),t.lastPreferredResolutions.delete(i),t.updateLimitedResolutions(),t.domOverrides.onMediaElementRemoved&&t.domOverrides.onMediaElementRemoved(n)})]},e.prototype.onRendererSizeChanged=function(e,t){this.remoteVideoResolutionManager.rendererSizeChanged(e,t),this.lastPreferredResolutions.set(e,t);var n=e.getMediaStream()&&e.getMediaStream().getVideoTracks();n&&n[0]&&this.stats.setPreferredResolution(n[0].id,t)},e.prototype.updateLimitedResolutions=function(){var e=this;this.lastPreferredResolutions.forEach(function(t,n){var i=e.limitRendererResolution(n.getCurrentResolution());t!==i&&t.height>0&&e.onRendererSizeChanged(n,i)})},e.prototype.limitRendererResolution=function(e){var t=this.configProvider.config.multiviewResolutionLimits[""+this.remoteRendererSubscriptions.size]||this.configProvider.config.multiviewResolutionLimits.more;if(t){if(e.height>e.width&&e.width>t){var n=t/e.width;return{height:Math.ceil(e.height*n),width:t}}if(e.width>e.height&&e.height>t)return n=t/e.height,{height:t,width:Math.ceil(e.width*n)}}return e},e}();t.RemoteVideoManager=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(12),s=n(0),c=n(9),l=n(245),u=n(246),d=n(247);function p(e){var t={};return e.result().forEach(function(e){e.names().forEach(function(n){t[e.type]=t[e.type]||{},t[e.type][e.id]=t[e.type][e.id]||{},t[e.type][e.id][n]=e.stat(n)}),t[e.type][e.id].id=e.id}),t}t.unwrapResults=p;var f=function(e){function t(t,n,i){var r=e.call(this)||this;return r.logger=t,r.configProvider=n,r.window=a.default.window,r.gatheringInterval=1e3,r._sessionInfo=new u.default,r.statisticsMapper=new l.default,r.webRtcStatistics=new d.default(r.logger.createChild("WebrtcStatistics"),r._sessionInfo,r.configProvider,i),r.configProvider=r.configProvider,r.gatheringInterval=Number(r.configProvider.config.webrtcStatPollInterval),r}return r(t,e),Object.defineProperty(t.prototype,"sessionInfo",{get:function(){return this._sessionInfo},enumerable:!0,configurable:!0}),t.prototype.initialize=function(e){this.pc=e,this.startGathering()},t.prototype.startWaitingForStreamStart=function(e,t){void 0===t&&(t=!1),this.webRtcStatistics.startWaitingForStreamStart(e,t)},t.prototype.onDeviceEvent=function(e){this.webRtcStatistics.onDeviceEvent(e)},t.prototype.onMaxCapabilitiesRequested=function(e){this.webRtcStatistics.onMaxCapabilitiesRequested(e)},t.prototype.onMaxCapabilitiesApplied=function(e){this.webRtcStatistics.onMaxCapabilitiesApplied(e)},t.prototype.addSubscriptionEvent=function(e,t,n){this.webRtcStatistics.addSubscriptionEvent(e,t,n)},t.prototype.setSubscribedTrackIds=function(e){this.webRtcStatistics.setSubscribedTrackIds(e)},t.prototype.setSubscribedTrackSsrc=function(e){this.webRtcStatistics.setSubscribedTrackSsrc(e)},t.prototype.setLayouts=function(e,t){this.webRtcStatistics.setLayouts(e,t)},t.prototype.setRawScreenshareAudioInput=function(e){this.webRtcStatistics.setRawScreenshareAudioInput(e)},t.prototype.setPreferredResolution=function(e,t){this.webRtcStatistics.setPreferredResolution(e,t)},t.prototype.setReportedSendBandwidth=function(e){this.webRtcStatistics.setReportedSendBandwidth(e)},t.prototype.setMaxSessionBandwidth=function(e){this.webRtcStatistics.setMaxSessionBandwidth(e)},t.prototype.setTerminated=function(){this.webRtcStatistics.setTerminated()},t.prototype.addIceCandidateError=function(e){this.webRtcStatistics.addIceCandidateError(e)},t.prototype.clearIceCandidateErrors=function(){this.webRtcStatistics.clearIceCandidateErrors()},t.prototype.getReport=function(){var e=this;return this.processStatistics().then(function(){return e.getLastKnownReport()})},t.prototype.getLastKnownReport=function(){var e=this.webRtcStatistics.getReport();return this.addStreamInfoForE2ETests(e),e},t.prototype.dispose=function(){this.interval&&(this.window.clearInterval(this.interval),this.interval=0),this.pc=null},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return null===this.pc&&0===this.interval},enumerable:!0,configurable:!0}),t.prototype.getLastStatistics=function(){return this.statistics},t.prototype.addStreamInfoForE2ETests=function(e){var t=this._sessionInfo.negotiatedModalities;if(t)try{e.localStreams=this.getSendersReport(this.pc.getSenders(),{audio:c.hasSendDirectionality(t.audio),video:c.hasSendDirectionality(t.video)}),e.remoteStreams=this.getReceiversReport(this.pc.getReceivers(),{audio:c.hasReceiveDirectionality(t.audio),video:c.hasReceiveDirectionality(t.video)})}catch(e){this.logger.safe.warn("addStreamInfoForE2ETests failed: "+s.stringifyObject(e))}},t.prototype.getReceiversReport=function(e,t){var n=[];return e.forEach(function(e){var i={tracks:[]};n.push(i),e.track&&("audio"===e.track.kind&&t.audio||"video"===e.track.kind&&t.video)&&i.tracks.push({stream:void 0,track:e.track})}),n},t.prototype.getSendersReport=function(e,t){var n=[],i={tracks:[]};return n.push(i),e.forEach(function(e){e.track&&("audio"===e.track.kind&&t.audio||"video"===e.track.kind&&t.video)&&i.tracks.push({stream:void 0,track:e.track})}),n},t.prototype.startGathering=function(){var e=this;this.isInitialized&&!this.interval&&(this.interval=this.window.setInterval(function(){e.processStatistics()},this.gatheringInterval))},Object.defineProperty(t.prototype,"isInitialized",{get:function(){return this.pc&&this.pc.getStats},enumerable:!0,configurable:!0}),t.prototype.processStatistics=function(){var e=this;return new Promise(function(t){e.pc?e.configProvider.config.webrtcUseNewStatsApi?e.pc.getStats().then(function(n){n.size<1||e.processStatsDict(e.unwrapNewApiResults(n)),t()}).catch(function(n){e.logger.safe.warn("getStats failed: "+s.stringifyObject(n)),t()}):e.pc.getStats(function(n){n.result?(e.processStatsDict(p(n)),t()):t()}):t()})},t.prototype.unwrapNewApiResults=function(e){var t={};return e.forEach(function(e){t[e.type]=t[e.type]||{},t[e.type][e.id]=e}),this.statisticsMapper.build(t)},t.prototype.processStatsDict=function(e){this.webRtcStatistics.processStatsDict(e);var t=0,n=0,i=e.VideoBwe?e.VideoBwe.bweforvideo:null;i&&(t=Number(i.googAvailableReceiveBandwidth),n=Number(i.googAvailableSendBandwidth));var r=1e3*((this.configProvider.mediaConfig.maxBandwidthInKbps||Math.floor(Number.MAX_SAFE_INTEGER/1e3))-(this.configProvider.config.audioBandwidthInKbps||0)),o=isNaN(t)?0:t,a=isNaN(n)?0:n,c={estimatedReceiveBandwidth:Math.min(o,r),estimatedSendBandwidth:Math.min(a,r),remoteVideoStreams:{},localVideoStreams:{},isSpeaking:this.webRtcStatistics.getSpeakingState(),audioHwSilent:this.webRtcStatistics.getAudioHwSilent(),networkSendLevel:this.webRtcStatistics.getNetworkSendLevel(),networkRecvLevel:this.webRtcStatistics.getNetworkRecvLevel()};s.forOwn(e.ssrc,function(e){if("video"===e.mediaType){var t=e.googTrackId;-1!==e.id.indexOf("_recv")?c.remoteVideoStreams[t]={trackId:t,frameRateReceived:Number(e.googFrameRateReceived),frameRateDecoded:Number(e.googFrameRateDecoded),framesDecoded:Number(e.framesDecoded)}:t&&-1!==e.id.indexOf("_send")&&(c.localVideoStreams[t]={trackId:t,ssrc:Number(e.ssrc),frameRateInput:Number(e.googFrameRateInput)})}}),s.deepEqual(this.statistics,c)||(this.statistics=c,this.notifyStatisticsChanged())},t.prototype.notifyStatisticsChanged=function(){this.event("onStatisticsChanged").raise(this.statistics)},t}(o.default);t.StatisticsGatherer=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(249),o=n(250),a=n(251),s=n(252),c=n(253),l=n(254),u=n(255),d=n(256),p=n(257),f=n(258),h=n(259),g=function(){function e(e,t,n){this.startTime=e,this.configProvider=t,this.logger=n,this.subscriptionCounter=0,this.videoFreezeTelemetry=new s.default(this.startTime),this.videoDelayTelemetry=new a.default,this.videoSubscriptionEvents=new p.default(this.configProvider),this.videoQPEvents=new l.default,this.videoResolutionTelemetry=new u.default,this.videoGeneralTelemetry=new c.default,this.videoStreamsCounters=new d.default,this.videoBitrate=new r.default,this.videoMaxCapabilities=new o.default(this.configProvider,this.logger),this.videoOvershoot=new f.default(this.logger),this.keyFrameStats=new h.WebRTCVideoKeyFrameMonitor(this.configProvider,this.logger)}return Object.defineProperty(e.prototype,"isRecvDataGatheringEnabled",{get:function(){return this.subscriptionCounter>0},enumerable:!0,configurable:!0}),e.prototype.startStopRecvDataGathering=function(e){this.logger.safe.info("Receive data gathering is "+(e?"enabled":"disabled")),e?this.subscriptionCounter++:this.subscriptionCounter--,this.subscriptionCounter<0&&this.logger.safe.error("Subscription counter should be less than 0. Actual value is "+this.subscriptionCounter),0===this.subscriptionCounter&&this.stopRecvGathering()},e.prototype.stopDataGathering=function(){this.stopRecvGathering(),this.stopSendGathering()},e.prototype.stopRecvGathering=function(){this.videoFreezeTelemetry.stopRecvDataGathering(),this.videoGeneralTelemetry.stopRecvDataGathering(),this.videoBitrate.stopCapture(i.default.MEDIA_DIRECTION.RECV)},e.prototype.isSendGathering=function(){return this.videoGeneralTelemetry.isGatheringSendData()},e.prototype.stopSendGathering=function(){this.videoGeneralTelemetry.stopSendDataGathering(),this.videoBitrate.stopCapture(i.default.MEDIA_DIRECTION.SEND),this.videoOvershoot.flush(),this.keyFrameStats.flush()},e.prototype.gatherRecvFreezeData=function(e,t){this.videoFreezeTelemetry.gatherFreezeData(e,t)},e.prototype.detectCaptureFreeze=function(e){this.videoFreezeTelemetry.detectCaptureFreeze(e)},e.prototype.getSendCameraFreezeIntervals=function(){return this.videoFreezeTelemetry.getSendCameraFreezeIntervals()},e.prototype.getRecvFreezeDurationCounts=function(){return this.videoFreezeTelemetry.getRecvFreezeDurationCounts()},e.prototype.getRecvFreezeDurationTimestamps=function(){return this.videoFreezeTelemetry.getRecvFreezeDurationTimestamps(this.configProvider.config.maxVideoFreezeTimestampsInBucket)},e.prototype.getRecvFreezeIsOngoing=function(){return this.videoFreezeTelemetry.getRecvFreezeIsOngoing(this.configProvider.config.webrtcEndOfCallFreezeThreshold)},e.prototype.getRecvTotalFreezeDuration=function(){return this.videoFreezeTelemetry.getRecvTotalFreezeDuration()},e.prototype.getRecvAvgFreezeDuration=function(){return this.videoFreezeTelemetry.getRecvAvgFreezeDuration()},e.prototype.getLongestRecvFreezeDuration=function(){return this.videoFreezeTelemetry.getLongestRecvFreezeDuration()},e.prototype.analyzeDelay=function(e,t){this.videoDelayTelemetry.analyzeDelay(e,t)},e.prototype.getDelayCur=function(){return this.videoDelayTelemetry.getDelayCur()},e.prototype.getDelayAvg=function(){return this.videoDelayTelemetry.getDelayAvg()},e.prototype.addSubscriptionEvent=function(e){this.videoSubscriptionEvents.addSubscriptionEvent(e)},e.prototype.getSubscriptionEvents=function(){return this.videoSubscriptionEvents.getSubscriptionEvents()},e.prototype.captureQpData=function(e,t,n){this.videoQPEvents.captureQpData(e,t,n)},e.prototype.getQpAverage=function(e){return this.videoQPEvents.getQpAverage(e)},e.prototype.captureMediaData=function(e,t,n){this.videoGeneralTelemetry.captureMediaData(e,t,n)},e.prototype.captureFrameRate=function(e){this.videoGeneralTelemetry.captureFrameRate(e)},e.prototype.getAvgFrameRate=function(e){return this.videoGeneralTelemetry.getAvgFrameRate(e)},e.prototype.getSendCameraFramerate=function(){return this.videoGeneralTelemetry.getSendCameraFramerate()},e.prototype.getTotalDuration=function(e){return this.videoGeneralTelemetry.getTotalDuration(e)},e.prototype.getTimeSinceLastDecode=function(e){return this.videoGeneralTelemetry.getTimeSinceLastDecode(e)},e.prototype.captureResolutionSample=function(e){this.videoResolutionTelemetry.captureSample(e)},e.prototype.countRecvStreams=function(e){this.videoStreamsCounters.countRecvStreams(e)},e.prototype.getStreamCounts=function(){return this.videoStreamsCounters.getStreamCounts()},e.prototype.getNumResolutionSwitches=function(){return this.videoResolutionTelemetry.resolutionSwitchCount},e.prototype.getResolutionDurations=function(){return this.videoResolutionTelemetry.resolutionDurationRatios},e.prototype.captureBitrateSample=function(e,t){this.videoBitrate.captureSample(e,t)},e.prototype.getBitrateAvg=function(e){return this.videoBitrate.getAvg(e)},e.prototype.getBitrateMax=function(e){return this.videoBitrate.getMax(e)},e.prototype.captureAllocateBandwidth=function(e){this.videoBitrate.captureAllocateBandwidth(e)},e.prototype.getAllocateBandwidthAvg=function(){return this.videoBitrate.getAllocateBandwidthAvg()},e.prototype.capturePreferredResolution=function(e,t){this.videoResolutionTelemetry.capturePreferredResolution(e,t)},e.prototype.setMaxCapabilitesRequested=function(e,t){void 0===t&&(t=!1),this.videoMaxCapabilities.setMaxCapabilitesRequested(e),t||1===e.capabilities.length&&!e.capabilities[0].ssrc||this.setMaxCapabilitiesOvershoot(e.capabilities)},e.prototype.setMaxCapabilitesApplied=function(e,t){void 0===t&&(t=!1),this.videoMaxCapabilities.setMaxCapabilitesApplied(e),t||1===e.capabilities.length&&!e.capabilities[0].ssrc||this.setMaxCapabilitiesOvershoot(e.capabilities)},e.prototype.getMaxCapabilitiesEvents=function(){var e=this.videoMaxCapabilities.getEvents();return JSON.stringify(e)},e.prototype.setCurrentParameters=function(e,t,n){this.videoOvershoot.setCurrentParams(e,t.height/16*(t.width/16),n)},e.prototype.setMaxCapabilitiesOvershoot=function(e){this.videoOvershoot.setMaxCapabilities(e)},e.prototype.getOvershootEvents=function(){var e=this,t=this.videoOvershoot.getEvents();return(t=t.slice(Math.max(0,t.length-(this.configProvider.config.maxReportedOvershootingEvents+1)),t.length)).forEach(function(t){return t.timestamp=t.timestamp-e.startTime}),JSON.stringify(t)},e.prototype.getOvershootTotalDurations=function(){var e=this,t=this.videoOvershoot.getEvents();return t.forEach(function(t){return t.timestamp=t.timestamp-e.startTime}),JSON.stringify({fs:t.reduce(function(e,t){return"fs"===t.overshootType?e+t.duration:e},0),fps:t.reduce(function(e,t){return"fps"===t.overshootType?e+t.duration:e},0)})},e.prototype.setKeyFrameRequested=function(e){e&&this.keyFrameStats.setKeyFrameRequested("FMTP")},e.prototype.setKeyFrameData=function(e){this.keyFrameStats.setKeyFrameData(e)},e.prototype.getKeyFrameStats=function(){if(!this.configProvider.config.webrtcUseNewStatsApi)return"None";var e=this.keyFrameStats.getStats();return JSON.stringify(e)},e.prototype.getReport=function(e,t){var n={};if(n[t+"DurationSeconds"]=this.getTotalDuration(e),n[t+"QpAvg"]=this.getQpAverage(e),n[t+"frameRateAvg"]=this.getAvgFrameRate(e),n[t+"bitrateAvg"]=this.getBitrateAvg(e),n[t+"bitrateMax"]=this.getBitrateMax(e),e===i.default.MEDIA_DIRECTION.SEND)n[t+"DelayCur"]=this.getDelayCur(),n[t+"DelayAvg"]=this.getDelayAvg(),n[t+"TimeSinceLastEncodeStart"]=this.getTimeSinceLastDecode(e),n[t+"AllocateBWAvg"]=this.getAllocateBandwidthAvg(),n[t+"CaptureFramerateAvg"]=this.getSendCameraFramerate(),n[t+"FreezeIntervals"]=this.getSendCameraFreezeIntervals(),n[t+"MaxCapabilities"]=this.getMaxCapabilitiesEvents(),n[t+"OvershootEvents"]=this.getOvershootEvents(),n[t+"OvershootDurations"]=this.getOvershootTotalDurations(),n[t+"KeyFrameStats"]=this.getKeyFrameStats();else if(e===i.default.MEDIA_DIRECTION.RECV){n[t+"TimeSinceLastDecodeStart"]=this.getTimeSinceLastDecode(e),n[t+"FreezeHistogram"]=this.getRecvFreezeDurationCounts(),n[t+"FreezeTimestamps"]=this.getRecvFreezeDurationTimestamps(),n[t+"LongestFreezeDuration"]=this.getLongestRecvFreezeDuration(),n[t+"RecvAvgFreezeDuration"]=this.getRecvAvgFreezeDuration(),n[t+"TotalFreezeDuration"]=this.getRecvTotalFreezeDuration(),n[t+"OngoingFreeze"]=this.getRecvFreezeIsOngoing(),n[t+"NumResolutionSwitches"]=this.getNumResolutionSwitches(),n[t+"PreferredResolution"]=this.videoResolutionTelemetry.preferredResolution,n[t+"ResolutionDurations"]=JSON.stringify(this.getResolutionDurations());var r=this.getStreamCounts();n[t+"StreamsMin"]=r.min,n[t+"StreamsMax"]=r.max,n[t+"StreamsMode"]=r.mode}return n},e}();t.default=g},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,i){var r=e.call(this)||this;return r.statisticsGatherer=t,r.configProvider=i,r.statisticsGathererSubscription=null,r.lastFramerateInput=-1,r.trackInfo=[],r.timeoutId=null,r.logger=n.createChild("localStreamWatcher"),r}return r(t,e),t.prototype.startWatching=function(e){var t=this;this.trackInfo=e,!this.statisticsGathererSubscription&&this.configProvider.config.videoCaptureFreezeTimeout&&(this.statisticsGathererSubscription=this.statisticsGatherer.on("onStatisticsChanged",function(e){return t.onStatisticsChanged(e)}))},t.prototype.stopWatching=function(){this.trackInfo=[],this.statisticsGathererSubscription&&(this.statisticsGathererSubscription.dispose(),this.statisticsGathererSubscription=null),0!==this.lastFramerateInput||this.timeoutId||this.event("onVideoCaptureFreeze").raise(!1),this.disposeTimer(),this.lastFramerateInput=-1},t.prototype.onStatisticsChanged=function(e){var t,n=this;this.trackInfo.length&&(Object.keys(e.localVideoStreams).forEach(function(i){var r=e.localVideoStreams[i];n.trackInfo.some(function(e){return e.ssrc===r.ssrc||e.trackId===r.trackId})&&(!t||t.frameRateInput<r.frameRateInput)&&(t=r)}),t?t.frameRateInput!==this.lastFramerateInput&&(0===t.frameRateInput?this.scheduleCaptureFreezeStart(t.trackId):0===this.lastFramerateInput&&(this.timeoutId?this.disposeTimer():(this.logger.info("onVideoCaptureFreeze end for trackId: "+t.trackId),this.event("onVideoCaptureFreeze").raise(!1))),this.lastFramerateInput=t.frameRateInput):this.logger.safe.warn("WebRTC Stats for send video not found"))},t.prototype.scheduleCaptureFreezeStart=function(e){var t=this;this.timeoutId=window.setTimeout(function(){t.timeoutId=null,t.logger.info("onVideoCaptureFreeze start for trackId: "+e),t.event("onVideoCaptureFreeze").raise(!0)},this.configProvider.config.videoCaptureFreezeTimeout)},t.prototype.disposeTimer=function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)},t}(n(6).default);t.LocalVideoStreamWatcher=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.callbacks=t,this.streamIsActive=!1,this.statsGathererSubscribed=!1,this.lastReceivedFps=0,this.lastFramesDecoded=0,this.configProvider=e.configProvider,this.statisticsGatherer=e.statsGatherer,this.logger=e.logger.createChild("streamWatcher")}return e.prototype.watchStream=function(e){this.currentStream!==e&&(this.currentStream=e,this.startMonitoringStats(),this.disposeTimer())},e.prototype.stopWatchingStream=function(e){e===this.currentStream&&(this.currentStream=null,this.disposeTimer())},e.prototype.dispose=function(){this.callbacks=void 0,this.disposeTimer()},e.prototype.disposeTimer=function(){this.resetTimeoutId&&(clearTimeout(this.resetTimeoutId),this.resetTimeoutId=void 0)},e.prototype.startMonitoringStats=function(){var e=this;this.statsGathererSubscribed||(this.statisticsGatherer.on("onStatisticsChanged",function(t){return e.onStatisticsChanged(t)}),this.statsGathererSubscribed=!0)},e.prototype.onStatisticsChanged=function(e){if(this.currentStream){var t=this.currentStream.getTracks();if(0!==t.length){var n=t[0].id,i=e.remoteVideoStreams[n];i?(this.lastReceivedFps=i.frameRateReceived,this.lastReceivedFps<=0?this.disposeTimer():(i.frameRateDecoded<=0?this.streamBroken||this.scheduleResetScreenShare():(this.streamIsActive||(this.logger.safe.info("Video stream is active now"),this.callbacks.onStreamIncomingDecoderActive(),this.lastFramesDecoded>i.framesDecoded&&this.callbacks.onStreamIncomingDecoderReset()),this.streamIsActive=!0,this.disposeTimer()),this.lastFramesDecoded=i.framesDecoded)):this.logger.safe.warn("WebRTC Stats for video track "+n+" not found")}else this.logger.safe.warn("No tracks found for stream "+this.currentStream.id)}},Object.defineProperty(e.prototype,"streamBroken",{get:function(){return void 0!==this.resetTimeoutId},enumerable:!0,configurable:!0}),e.prototype.scheduleResetScreenShare=function(){var e=this;this.resetTimeoutId=setTimeout(function(){e.resetTimeoutId=void 0,e.streamIsActive=!1,e.logger.safe.error("Decoding 0 frameRate while receiving "+e.lastReceivedFps+", asking for recovery"),e.callbacks.onStreamIncomingDecoderFailed()},this.configProvider.config.webrtcVideoStreamRecoverWaitTimeout)},e}();t.VideoStreamWatcher=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(38),r=function(){function e(e,t,n,r){this.msi=i.MediaSourceIdentifiers.SourceNone,this.operations=Promise.resolve(),this.mediaStream=e,this.modality=t,this.sourceStreamId=n,this.controller=r}return e.prototype.getId=function(){return this.mediaStream.id},e.prototype.getModality=function(){return this.modality},e.prototype.getMsi=function(){return this.msi},e.prototype.getMediaStream=function(){return this.mediaStream},e.prototype.requestSource=function(e){var t=this;this.msi=e;var n=this.operations.then(function(){return t.controller.requestSource(t.modality,t.sourceStreamId,e)});return this.operations=n.catch(function(){}),n},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(102),r=function(){function e(e){this.webRtcSender=null,this.configProvider=e.configProvider,this.queue=new i.DTMFQueue(e.logger)}return e.prototype.sendDtmf=function(e,t){return e&&e.getSenders?(this.syncSender(e),this.webRtcSender?(this.webRtcSender.ontonechange=this.onToneChange.bind(this),this.webRtcSender.insertDTMF(this.webRtcSender.toneBuffer+t,this.configProvider.config.dtmf.toneDuration,this.configProvider.config.dtmf.toneGap),this.queue.waitForNotification(t)):Promise.reject(new Error("not available"))):Promise.reject(new Error("bad peerConnection"))},e.prototype.canSendDtmf=function(e){return!(!e||!e.getSenders)&&(this.syncSender(e),!!this.webRtcSender&&this.webRtcSender.canInsertDTMF)},e.prototype.dispose=function(){this.queue.cleanup()},e.prototype.syncSender=function(e){var t=e.getSenders().filter(function(e){return e.track&&"audio"===e.track.kind}).filter(function(e){return e.dtmf&&e.dtmf.canInsertDTMF})[0];this.webRtcSender&&t&&t.dtmf!==this.webRtcSender&&(this.webRtcSender.ontonechange=null,this.queue.cleanup()),this.webRtcSender=t?t.dtmf:null},e.prototype.onToneChange=function(e){e.tone&&this.queue.toneSent(e.tone)},e}();t.WebRtcDTMFSender=r,t.default={build:function(e){return new r(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=n(33),o=n(30),a=n(0),s=n(2),c=n(9),l=n(28),u=n(60),d=function(){function e(e,t,n,o){this.context=e,this.sessionType=t,this.sdp=n,this.remote=o,this.mediaManager=this.context.mediaManager,this.sdpTransform=this.context.sdpTransform,this.logger=this.context.logger.createChild("SessionDescr"),this.sdpModel=r.parse(this.sdp),this.sdpModel.media.forEach(function(e){i.isUndefined(e.mid)||(e.mid=e.mid.toString())}),this.remote&&!this.context.configProvider.config.disableMsSdp&&new u.MsSdpRemoteModifier(e,t).modify(this.sdpModel)}return e.prototype.clone=function(){return new e(this.context,this.sessionType,this.sdp,this.remote)},e.prototype.getModalities=function(){return this.modalities||l.getModalities(this.sdpModel)},e.prototype.updateModalities=function(e){this.modalities=e},e.prototype.getSrtpInfo=function(){return c.getSrtpInfo(this.sdpModel)},e.prototype.getVideoCodecs=function(){var e={};return this.sdpModel.media.forEach(function(t){"video"===t.type&&t.rtp.map(function(e){return e.codec.toLowerCase()}).forEach(function(t){return e[t]=!0})}),Object.keys(e)},e.prototype.usePrimaryAudioCodecOnly=function(e){new u.AudioPrimaryCodecsModifier(e).modify(this.sdpModel)},e.prototype.isCodecSwitchSupported=function(){var e=this;return!this.sdpModel.media.some(function(t){return t.type===s.default.MEDIA_TYPE.audio&&t.xMediaSettings&&e.containsMediaSetting(t.xMediaSettings,"codecswitchunsupported")})},e.prototype.toLocal=function(){return this.sdpModel=this.sdpTransform.toLocal(this.sdpModel,this.mediaManager,this.mediaManager.isEmpty()),new u.InjectH264SpsPpsIdrInKeyframe(this.context.configProvider).modify(this.sdpModel),r.write(this.sdpModel)},e.prototype.toOffer=function(){return this.toOfferAnswer()},e.prototype.toAnswer=function(){return this.toOfferAnswer()},e.prototype.toOfferAnswer=function(){var e="offer"===this.sessionType;return new u.CandidatesFixup(this.context.configProvider,this.logger).modify(this.sdpModel),(new u.BundleOnlyMediaFixup).modify(this.sdpModel),e&&this.mediaManager.isEmpty()&&this.mediaManager.fromOffer(this.sdpModel,this.modalities),this.mediaManager.syncModalities(this.sdpModel,this.modalities,!e),this.sdpModel=e?this.sdpTransform.toOffer(this.sdpModel,this.mediaManager,this.modalities):this.sdpTransform.toAnswer(this.sdpModel,this.mediaManager,this.modalities),this.context.configProvider.config.disableMsSdp||new u.MsSdpLocalModifier(this.context,this.sessionType).modify(this.sdpModel),new u.InjectH264ParamsModifier(this.mediaManager).modify(this.sdpModel),this.modalities=l.getModalities(this.sdpModel),r.write(this.sdpModel)},e.prototype.toRemote=function(e){return this.modalities=e,this.mediaManager.fromRemote(this.sdpModel,this.modalities),this.sdpModel=this.sdpTransform.toRemote(this.sdpModel,this.mediaManager,this.modalities),r.write(this.sdpModel)},e.prototype.getVideoRecvCapabilities=function(){var e=this.getMediaByLabel(s.default.MEDIA_LABEL.video);return this.getRecvCapabilitiesForMedia(e)},e.prototype.getSharingRecvCapabilities=function(){var e=this.getMediaByLabel(s.default.MEDIA_LABEL.sharing);return this.getRecvCapabilitiesForMedia(e)},e.prototype.getRecvCapabilities=function(){var e=this,t=[];return this.sdpModel.media.forEach(function(n){if(n.mid){var i=e.mediaManager.getMediaEntityByMid(n.mid);if(i){var r={sourceId:i.getXSourceStreamId(),capabilities:[e.getRecvCapabilitiesForMedia(n)]};t.push(r)}else e.logger.safe.info("No media entity for mid: "+JSON.stringify(n.mid)+", existing: "+JSON.stringify(e.mediaManager.getMediaEntities().map(function(e){return e.getMid()})))}else e.logger.safe.info("Modality disabled, no receive caps to handle: "+JSON.stringify(n))}),t},e.prototype.getMediaByType=function(e){return this.sdpModel.media.find(function(t){return t.type===e})},e.prototype.isUnbundled=function(){var e=a.find(this.sdpModel.groups||[],function(e){return"BUNDLE"===e.type});if(!e)return!0;var t=a.find(this.sdpModel.media,function(e){return"audio"===e.type});return!e.mids.toString().split(" ").find(function(e){return e===t.mid})},e.prototype.couldBeUnbundled=function(){return!this.sdpModel.groups||!a.find(this.sdpModel.groups,function(e){return"BUNDLE"===e.type})||this.hasUnbundledIceCandidates()},e.prototype.containsMediaSetting=function(e,t){return e.some(function(e){return-1!==e.settings.indexOf(t)})},e.prototype.getRecvCapabilitiesForMedia=function(e){var t,n=this;return e&&l.forCodec(e,{name:"h264",rate:9e4},function(e){e.fmtp&&e.fmtp.config&&(t=n.parseVideoCapabilitiesFromFmtpConfig(e.fmtp.config))}),t},e.prototype.getMediaByLabel=function(e){return this.sdpModel.media.find(function(t){return t.label===e})},e.prototype.parseVideoCapabilitiesFromFmtpConfig=function(e){var t=o.default.build(e);return{maxFs:+t.get(s.default.VIDEO_CAPABILITIES.MAX_FS_PATH),maxMbps:+t.get(s.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH),maxFps:+t.get(s.default.VIDEO_CAPABILITIES.MAX_FPS_PATH)/100,maxBr:1200*+t.get(s.default.VIDEO_CAPABILITIES.MAX_BR_PATH)}},e.prototype.hasIceCandidatesForMediaType=function(e,t){void 0===t&&(t="");var n=this.sdpModel.media?this.sdpModel.media.filter(function(t){return t.type===e&&!!t.candidates&&0!==t.candidates.length}):[];return t?n.some(function(e){return!!e.candidates&&e.candidates.some(function(e){return e.type===t})}):!!n.length},e.prototype.hasIceCandidates=function(){return this.hasIceCandidatesForMediaType(s.default.MEDIA_TYPE.audio)||this.hasIceCandidatesForMediaType(s.default.MEDIA_TYPE.video)},e.prototype.hasRelayIceCandidates=function(){return this.hasIceCandidatesForMediaType(s.default.MEDIA_TYPE.audio,"relay")||this.hasIceCandidatesForMediaType(s.default.MEDIA_TYPE.video,"relay")},e.prototype.hasUnbundledIceCandidates=function(){var e=this.sdpModel.media.filter(function(e){return e.type===s.default.MEDIA_TYPE.video&&0!==e.port});return this.hasIceCandidatesForMediaType(s.default.MEDIA_TYPE.audio)&&(!e.length||this.hasIceCandidatesForMediaType(s.default.MEDIA_TYPE.video))},e.prototype.hasUnbundledRelayIceCandidates=function(){var e=this.sdpModel.media.filter(function(e){return e.type===s.default.MEDIA_TYPE.video&&0!==e.port});return this.hasIceCandidatesForMediaType(s.default.MEDIA_TYPE.audio,"relay")&&(!e.length||this.hasIceCandidatesForMediaType(s.default.MEDIA_TYPE.video,"relay"))},e.prototype.isIceRestart=function(){return this.mediaManager.getMediaEntities().some(function(e){return e.getExtension("iceRestart")})},e.prototype.isMSRTC=function(){return!!this.sdpModel.xMediaBw},e.prototype.insertFakeCandidateIfNeeded=function(e){this.hasIceCandidates()||(e.setFakeIceCandidate(!0),(new u.NoCandidatesFixup).modify(this.sdpModel))},e}();t.SessionDescription=d;var p=function(){function e(e){this.context=e}return e.prototype.createLocalOffer=function(e){return new d(this.context,"offer",e)},e.prototype.createRemoteOffer=function(e){return new d(this.context,"offer",e,!0)},e.prototype.createLocalAnswer=function(e){return new d(this.context,"answer",e)},e.prototype.createRemoteAnswer=function(e){return new d(this.context,"answer",e,!0)},e}();t.WebRtcSessionDescription=p;var f=function(){function e(){}return e.build=function(e){return new p(e=e||{})},e}();t.SessionDescriptionFactory=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createIceServers=function(e,t){return void 0===t&&(t={}),e.reduce(function(e,n){var i=[],r=n.addresses&&n.addresses[0],o=n.fqdns&&n.fqdns.length>0,a=t.iceUdpAddressType,s=t.iceTcpAddressType,c=t.iceServerTransport;if(!r&&!o)return e;if(c.includes("udp")&&n.udpPort){var l=!o||"fqdn"!==a&&r?r:n.fqdns[0];i.push("turn:"+l+":"+n.udpPort+"?transport=udp")}return c.includes("tcp")&&n.tcpPort&&(l=!o||"fqdn"!==s&&r?r:n.fqdns[0],i.push("turn:"+l+":"+n.tcpPort+"?transport=tcp")),c.includes("tls")&&n.tlsPort&&o&&i.push("turns:"+n.fqdns[0]+":"+n.tlsPort),e.concat({urls:i,credential:n.password,username:n.username})},[])}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=n(15),s=n(44),c=function(e){function t(t,n){var i=e.call(this)||this;return i._deviceManager=t,n.onDevicesChanged=function(e){return i._raiseDevicesChanged(i._mapDevices(e))},t.on("onSelectedDevicesChanged",function(e){return i._raiseDevicesChanged()}),t.on("onPermissionStateChanged",function(){i.event("onPermissionStateChanged").raise()}),i}return r(t,e),Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return this._deviceManager.isAudioOutputSelectionSupported},enumerable:!0,configurable:!0}),t.prototype.getPermissionState=function(e){return"camera"===e?this.getPermissionStateHelper(this._deviceManager.getPermissionState("camera")):"microphone"===e?this.getPermissionStateHelper(this._deviceManager.getPermissionState("microphone")):"unknown"},t.prototype.getPermissionStateHelper=function(e){switch(e){case"granted":return"granted";case"denied":return"denied";case"prompt":return"prompt";default:return"unknown"}},t.prototype.askDevicePermission=function(e){return this._deviceManager.askDevicePermission?this._deviceManager.askDevicePermission(e):Promise.resolve({audio:!0,video:!0})},t.prototype.enumerateDevicesAsync=function(){var e=this;return this._deviceManager.enumerateDevicesAsync().then(function(t){return e._mapDevices(t)})},t.prototype.getPreferredCamera=function(){throw new Error("Not implemented")},t.prototype.selectDevices=function(e){var t=o.assign({},this._deviceManager.getSelectedDevices(),e);this._deviceManager.selectDevices(t)},t.prototype.getSelectedDevices=function(){return this._deviceManager.getSelectedDevices()},t.prototype.getDeviceNameAsync=function(e){return this._deviceManager.getDeviceNameAsync(e)},t.prototype.getSpeakerDeviceDomIdAsync=function(e,t){return this._deviceManager.getSpeakerDeviceDomIdAsync(e)},t.prototype.setDeviceEffectsAsync=function(e,t){return Promise.reject(new Error("Not implemented"))},t.prototype.getDeviceEffectsCapabilityAsync=function(e,t){return Promise.reject(new Error("Not implemented"))},t.prototype.setBackgroundImageAsync=function(e,t){return Promise.reject(new Error("Not implemented"))},t.prototype.sendMessageDeviceVideoEffectsAsync=function(e,t){return Promise.reject(new Error("Not implemented"))},t.prototype.setVideoCaptureConfigAsync=function(e,t){return Promise.reject(new Error("Not implemented"))},t.prototype.getSpeakerVolume=function(){return Promise.reject(new Error("Not implemented"))},t.prototype.getSpeakerSystemVolume=function(){return Promise.reject(new Error("Not implemented"))},t.prototype.setSpeakerVolume=function(e){return Promise.reject(new Error("Not implemented"))},t.prototype.setSpeakerSystemVolume=function(e){return Promise.reject(new Error("Not implemented"))},t.prototype.unmuteMicrophone=function(){return Promise.reject(new Error("Not implemented"))},t.prototype.unmuteSpeaker=function(){return Promise.reject(new Error("Not implemented"))},t.prototype.getNrgLevelsForDeviceTuner=function(e){return Promise.reject(new Error("Not implemented"))},t.prototype.getAudioFeatureCapability=function(e){return Promise.reject(new Error("Not implemented"))},t.prototype.getMicrophoneVolume=function(){return Promise.reject(new Error("Not implemented"))},t.prototype.setMicrophoneVolume=function(e){return Promise.reject(new Error("Not implemented"))},t.prototype.setDeviceTelemetryData=function(e,t,n){return Promise.reject(new Error("Not implemented"))},t.prototype.createPreview=function(e,t,n){return"camera"===t.kind&&o.isUndefined(t.device)?this.createPreviewRenderer(e,n):Promise.reject(new Error("Not yet supported"))},t.prototype.createPreviewRenderer=function(e,t){var n=new s.LocalVideoRenderer(e,this._deviceManager);return Promise.resolve().then(function(){return n.startVideoAsync()}).catch(function(e){throw n.dispose(),e}).then(function(){return t&&n.setScalingMode(t.scalingMode),n})},t.prototype.createScreenSharingPreviewRenderer=function(e,t){return Promise.reject(new Error("Not yet supported"))},t.prototype._raiseDevicesChanged=function(e){var t=this;(e?Promise.resolve(e):this.enumerateDevicesAsync()).then(function(e){t.raiseChanged(),t.event("devicesChanged").raise(e)})},t.prototype._mapDevices=function(e){var t=this;return o.map(e,function(e){return t._mapDeviceDesc(e)})},t.prototype._mapDeviceDesc=function(e){var n=t._mapDeviceType(e.kind);return 1===n?{id:e.id,browserId:e.browserId,label:e.label,kind:n,position:t._mapCameraPosition(e.position)}:4===n?{id:null,browserId:null,label:e.label,kind:n,formFactor:e.formFactor,isPcInternalDevice:e.isPcInternalDevice,microphoneId:e.microphoneId,speakerId:e.speakerId}:{id:e.id,browserId:"default_output_device"===e.browserId?"default":e.browserId,label:e.label,kind:n,isSystemDefault:!!e.isSystemDefault}},t._mapDeviceType=function(e){switch(e){case"camera":return 1;case"microphone":return 2;case"speaker":return 3;case"compositeAudio":return 4;default:throw new Error("Invalid device type '"+e+"'")}},t._mapCameraPosition=function(e){switch(e){case"front":return 1;case"back":return 2;case"external":return 3;default:return 0}},t}(a.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=n(15),s=function(){function e(e){this._sharingSource=e}return e.prototype.getId=function(){return this._sharingSource.getId()},e.prototype.getDeviceId=function(){return String(this._sharingSource.getId())},e.prototype.getType=function(){return this.mapSharingSourceType(this._sharingSource.getType())},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t){return this._sharingSource.getPreviewAsync(e,t)},e.prototype.getDescription=function(){return this._sharingSource.getDescription()},e.prototype.getIcon=function(e,t){return this._sharingSource.getIcon(e,t)},e.prototype.getBounds=function(){},e.prototype.mapSharingSourceType=function(e){switch(e){case 1:return 1;case 2:return 2;default:throw new Error("Invalid sharing source type")}},e}(),c=function(e){function t(t){var n=e.call(this)||this;return n._screenSharingManager=t,n._screenSharingManager.onScreensChanged(function(){n.event("screensChanged").raise()}),n}return r(t,e),t.prototype.enumerateScreensAsync=function(){return this._screenSharingManager.enumerateScreensAsync().then(function(e){return o.map(e,function(e){return new s(e)})})},t.prototype.enumerateWindowsAsync=function(){return this._screenSharingManager.enumerateWindowsAsync().then(function(e){return o.map(e,function(e){return new s(e)})})},t.prototype.enumerateCamerasAsync=function(){return this._screenSharingManager.enumerateCamerasAsync().then(function(e){return o.map(e,function(e){return new s(e)})})},t}(a.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(8),c=n(274),l=n(11),u=n(41),d=n(71),p=n(275),f=n(15),h=n(16),g=n(32),m=n(65),v=n(124),y=n(276),S=n(283),_=n(48),E=n(291),T=n(292),C=n(125),I=n(293),A=n(295),b=function(e){function t(t,n){void 0===n&&(n=1);var i=e.call(this,t)||this;return i.callSupport=n,i}return r(t,e),t}(Error);function R(e){var t={};return e.telemetryLoggers?t=e.telemetryLoggers:e.telemetryService&&e.telemetryService.getGenericTelemetryLogger&&e.telemetryTenants?s.forEach(Object.keys(e.telemetryTenants),function(n){return t[n]=e.telemetryService.getGenericTelemetryLogger(e.telemetryTenants[n])}):e.telemetryService&&(e.telemetryService.sendEvents||e.telemetryService.getCallingAdapter)&&(e.telemetryService.sendEvents&&(t.media={sendEvent:function(t){t.eventName&&(t.eventName=t.eventName.replace(/^(mdsc_)/,"")),e.telemetryService.sendEvents([t])}}),e.telemetryService.getCallingAdapter&&(t.signaling={sendEvent:function(t){e.telemetryService.getCallingAdapter().sendEvent(t.eventName,t.props)}})),t}t.createTelemetryLoggersFromConfig=R;var O=function(e){function t(t,n,i,r,o,a){var s,c,l=e.call(this)||this;return l._config=t,l._mediaAgent=n,l._signalingAgentProvider=i,l._ecsProvider=o,l._imageRendererProvider=a,l.callRegistries=[],l._platformManager=new E.default,l._logger=new d.default(t.logger).createChild("PluginlessStack"),l._telemetryLoggers=R(l._config),n?(l._deviceManager=new v.default(n.getDeviceManager(),r),l._screenSharingManager=new C.default(n.getScreenSharingManager()),l._oneDsManager=new A.OneDsTelemetryTransportLogger(l.createTelemetryConfig()),l._oneDsTelemetryLoggers=(s=l._oneDsManager,(c={}).signaling=s.createLogger("signaling"),c.media=s.createLogger("media"),c)):l._deviceManager=new p.default,l}return r(t,e),t.prototype.createTelemetryConfig=function(){return{configProvider:this._mediaAgent.getConfigProvider(),logger:this._logger.createChild("OneDsLogger"),clientInfo:this._config.signalingAgentConfig.clientInformation,contextProvider:this._config.telemetryContextProvider}},t.build=function(e,n){var i=!1,r=_.default.getInstance(),o=null,a={onDevicesChanged:function(){}},l=s.assign({},e.mediaAgentFactoryConfig,{deviceEvents:a});return r.configure(l),r.init(e.platformType).catch(function(e){i=1===e.length&&"not_supported"===e[0].reason;var t=e.some(function(e){return"incompatible_version"===e.reason});o=t?2:1}).then(function(){if(!e.usePlatformSupportApi)if(o){if(!i||!e.callSettings.useLwjForAllCalls)throw new b("PluginlessStack initialization failed",o)}else{var s=(new E.default).getPlatformSupportLevel(!0);if(1!==s&&2!==s&&(o=1,!e.callSettings.useLwjForAllCalls))throw new b("PluginlessStack initialization failed",o)}var l;o?e.logger.info("Create stack in LWJ mode"):(l=r.getAgent(),n.on("OnECSChanged",function(){var t=n.getEcsConfig("SkypeWebMedia","mediaAgent");t?l.updateConfig(t,n.ETag,n.getEcsConfig("ConfigIDs","SkypeWebMedia")):e.logger.warn("No SkypeWebMedia.mediaAgent config.")}));var u,d=I.signalingAgentProviderFactory.build(e.signalingAgentConfig,n,e.logger);return e.imageRendererConfig&&(u=new c.ImageRendererProvider(e.imageRendererConfig)),new t(e,l,d,a,n,u)}).catch(function(e){throw e instanceof b?e:new b(""+e)})},t.prototype.init=function(){return Promise.resolve()},t.prototype.dispose=function(t){return void 0===t&&(t=l.generateCauseId()),o(this,void 0,void 0,function(){var n,i,r,o,s=this;return a(this,function(a){switch(a.label){case 0:return(n=this._logger.createFnLogger("dispose",t)).info("Dispose"),this._ecsProvider.dispose(),i=function(){s.callRegistries=[],n.info("call registries are disposed"),s._screenSharingManager&&(s._screenSharingManager.dispose(t),s._screenSharingManager=void 0,n.info("screensharing manager is disposed")),s._deviceManager=void 0,s._oneDsManager=void 0,n.info("device manager is disposed"),e.prototype.dispose.call(s)},r=function(e){n.warn("Failed:",e)},o=this.callRegistries.map(function(e){return e.dispose(t).catch(r)}),[4,Promise.all(o)];case 1:return a.sent(),[4,_.default.getInstance().reset(t).catch(r)];case 2:return a.sent(),[2,i()]}})})},t.prototype.getCallRegistry=function(){return this._logger.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this._createCallRegistry()},t.prototype.createCallRegistry=function(e,t){var n=this;void 0===t&&(t=l.generateCauseId());var i=e?h.mriOrId(e.id):void 0,r=this._logger.createFnLogger("createCallRegistry[identity="+i+"]",t),s=this.callRegistries.find(function(t){return t.identity===e.id});return s&&!s.isDisposing?(r.info("callRegistry already exists for "+h.mriOrId(e.id)),Promise.resolve(s)):(s&&s.isDisposing?s.disposePromise:Promise.resolve().then(u.noop)).then(function(){return o(n,void 0,void 0,function(){return a(this,function(t){return[2,s=this._createCallRegistry(e)]})})})},t.prototype._createCallRegistry=function(e){var t=this,n=new m.CallRegistry(this._config.trouterService,this._signalingAgentProvider,this._mediaAgent,this._logger,this._telemetryLoggers,this._config.callSettings,this._ecsProvider,this._imageRendererProvider,e,this._oneDsTelemetryLoggers);return n.on("disposed",function(){t.callRegistries.splice(t.callRegistries.indexOf(n),1)}),this.callRegistries.push(n),n},t.prototype.getDeviceManager=function(){return this._deviceManager},t.prototype.createDeviceManager=function(e){return this._deviceManager},t.prototype.getScreenSharingManager=function(){return this._screenSharingManager},t.prototype.getSetup=function(){},t.prototype.getEcsProvider=function(){return this._ecsProvider},t.prototype.getCallFeedback=function(){return null},t.prototype.fireIntent=function(e,t){},t.prototype.getVersion=function(){return{build:g.getTsCallingVersion(),ovb:g.getOvb()}},t.prototype.getMediaStatus=function(){return null},t.prototype.setMediaConfig=function(e){return this._mediaAgent?(this._mediaAgent.setMediaConfig(e),Promise.resolve()):Promise.reject("not supported in LWJ")},t.prototype.getPlatformSupportLevel=function(){return this._platformManager.getPlatformSupportLevel(!!this._mediaAgent)},t.prototype.getLiveStreamClient=function(){return new y.LiveStreamClient(this._logger.createChild("LiveStreamClient"))},t}(f.default);t.PluginlessStack=O,t.pluginlessStackFactory={build:function(e){var t=new T.PluginlessEcsProvider;return S.initLogger(e,t),O.build(e,t)},getVersion:function(){return{build:g.getTsCallingVersion(),ovb:g.getOvb()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(31);function r(e){var t=i.defer();return e.onload=function(){return t.resolve()},e.onerror=function(e){return t.reject(e)},t.promise}t.isStreamValid=function(e){return e&&!!e.url},t.assert=function(e,t){if(!e)throw new Error("Assert failed"+(void 0!==t?": "+t:""))},t.getElementLoadPromise=r,t.loadScript=function(e,t){var n=e.createElement("script"),i=r(n);return n.src=t,e.head.appendChild(n),i},t.loadCss=function(e,t){var n=e.createElement("link"),i=r(n);return n.href=t,n.rel="stylesheet",e.head.appendChild(n),i}},function(e,t,n){"use strict";var i=n(29),r=n(5),o=n(4),a=0,s=[],c=[],l=[];function u(){return(new Date).getTime()}var d=function(){function e(t,n){var d=0,p=(t||"<unnamed>")+"."+a;function f(e){var t=Object(r.d)();t&&t.QUnit&&console&&console.log("ESPromiseScheduler["+p+"] "+e)}function h(e){n&&n.warnToConsole("ESPromiseScheduler["+p+"] "+e)}a++,Object(o.a)(e,this,function(e){var t=null,n=0;function r(e,t){for(var n=0;n<e.length;n++)if(e[n].id===t)return e.splice(n,1)[0];return null}e.scheduleEvent=function(e,o,a){var g=p+"."+n;n++,o&&(g+="-("+o+")");var m=g+"{"+d+"}";d++;var v,y,S,_={evt:null,tm:u(),id:m,isRunning:!1,isAborted:!1};return _.evt=t?(v=_,y=t,S=new i.a(function(e,t){var n=u()-y.tm,i=y.id;f("["+g+"] is waiting for ["+i+":"+n+" ms] to complete before starting -- ["+c.length+"] waiting and ["+s.length+"] running"),v.abort=function(e){v.abort=null,r(c,g),v.isAborted=!0,t(new Error(e))},y.evt.then(function(n){r(c,g),I(v).then(e,t)},function(n){r(c,g),I(v).then(e,t)})}),c.push(v),S):I(_),(t=_).evt._schId=m,_.evt;function E(e){for(var t=u(),n=t-6e5,i=e.length,r=0;r<i;){var o=e[r];if(o&&o.tm<n){var a=null;o.abort?(a="Aborting ["+o.id+"] due to Excessive runtime ("+(t-o.tm)+" ms)",o.abort(a)):a="Removing ["+o.id+"] due to Excessive runtime ("+(t-o.tm)+" ms)",h(a),e.splice(r,1),i--}else r++}}function T(e,n){var i=!1,o=r(s,e);if(o||(o=r(l,e),i=!0),o){o.to&&(clearTimeout(o.to),o.to=null);var a=u()-o.tm;n?i?h("Timed out event ["+e+"] finally complete -- "+a+" ms"):f("Promise ["+e+"] Complete -- "+a+" ms"):(l.push(o),h("Event ["+e+"] Timed out and removed -- "+a+" ms"))}else f("Failed to remove ["+e+"] from running queue");t&&t.id===e&&(t=null),E(s),E(c),E(l)}function C(e,t){return function(n){return T(e,!0),t&&t(n),n}}function I(t){var n=u();return t.wTm=n-t.tm,t.tm=n,t.isAborted?i.a.reject(new Error("["+g+"] was aborted")):(s.push(t),function(e,t){var n=e.id;return new i.a(function(r,o){f("Event ["+n+"] Starting -- waited for "+(e.wTm||"--")+" ms"),e.isRunning=!0,e.abort=function(t){e.abort=null,e.isAborted=!0,T(n,!1),o(new Error(t))};var s=t(n);s instanceof i.a?(a&&(e.to=setTimeout(function(){T(n,!1),o(new Error("Timed out after ["+a+"] ms"))},a)),function e(t,n,r,o){n.then(function(n){return n instanceof i.a?(f("Event ["+t+"] returned a promise -- waiting"),e(t,n,r,o),n):C(t,r)(n)},C(t,o))}(n,s,function(t){f("Event ["+n+"] Resolving after "+(u()-e.tm)+" ms"),r(t)},o)):(f("Promise ["+n+"] Auto completed as the start action did not return a promise"),r())})}(t,e))}}})}return e.incomplete=function(){return s},e.waitingToStart=function(){return c},e.prototype.scheduleEvent=function(e,t,n){},e}();t.a=d},function(e,t,n){"use strict";var i=n(23),r=n(24),o=n(1),a=n(62),s=n(20),c=o.a.isFunction;function l(e,t){for(var n=[],i=null,r=e.getNext();r;){var a=r.getPlugin();a&&(i&&c(i.setNextPlugin)&&c(a.processTelemetry)&&i.setNextPlugin(a),c(a.isInitialized)&&a.isInitialized()||n.push(a),i=a,r=r.getNext())}o.a.arrForEach(n,function(n){n.initialize(e.getCfg(),e.core(),t,e.getNext())})}function u(e){return e.sort(function(e,t){var n=0,i=c(t.processTelemetry);return c(e.processTelemetry)?n=i?e.priority-t.priority:1:i&&(n=-1),n})}var d=n(4),p=o.a.objDefineAccessors,f=function(e){function t(){var n=e.call(this)||this;n.identifier="ChannelControllerPlugin",n.priority=500;var i,r=o.a.arrForEach;function a(e){e&&e.length>0&&(function(e){r(e,function(e){if(e.priority<500)throw Error("Channel has invalid priority"+e.identifier)})}(e=e.sort(function(e,t){return e.priority-t.priority})),i.push(e))}return Object(d.a)(t,n,function(e,t){e.setNextPlugin=function(e){},e.processTelemetry=function(e,t){i&&r(i,function(i){i.length>0&&n._getTelCtx(t).createNew(i).processNext(e)})},e.getChannelControls=function(){return i},e.initialize=function(n,c,u){e.isInitialized()||(t.initialize(n,c,u),n.isCookieUseDisabled&&o.a.disableCookies(),function(e,t){if(i=[],e&&r(e,function(e){return a(e)}),t){var n=[];r(t,function(e){e.priority>500&&n.push(e)}),a(n)}}((n||{}).channels,u),r(i,function(e){return l(new s.a(e,n,c),u)}))}}),n}return __extends(t,e),t.prototype.processTelemetry=function(e,t){},t.prototype.getChannelControls=function(){return null},t.prototype.initialize=function(e,t,n){},t._staticInit=(p(t.prototype,"ChannelControls",t.prototype.getChannelControls),void p(t.prototype,"channelQueue",t.prototype.getChannelControls)),t}(a.a),h=o.a.arrForEach,g=o.a.isNullOrUndefined,m=function(){function e(){var t,n,r,a,c=!1;Object(d.a)(e,this,function(e){e._extensions=new Array,n=new f,e.logger=o.a.objCreate({throwInternal:function(e,t,n,i,r){void 0===r&&(r=!1)},warnToConsole:function(e){},resetInternalMessageCount:function(){}}),t=[],e.isInitialized=function(){return c},e.initialize=function(t,i,o,a){if(e.isInitialized())throw Error("Core should not be initialized more than once");if(!t||g(t.instrumentationKey))throw Error("Please provide instrumentation key");r=a,e._notificationManager=a,e.config=t||{},t.extensions=g(t.extensions)?[]:t.extensions,(t.extensionConfig=g(t.extensionConfig)?{}:t.extensionConfig).NotificationManager=a,o&&(e.logger=o);var d=[];d.push.apply(d,i.concat(t.extensions)),d=u(d);var p=[],f=[],m={};if(h(d,function(e){if(g(e)||g(e.initialize))throw Error("Extensions must provide callback to initialize");var t=e.priority,i=e.identifier;e&&t&&(g(m[t])?m[t]=i:o.warnToConsole("Two extensions have same priority #"+t+" - "+m[t]+", "+i)),!t||t<n.priority?p.push(e):f.push(e)}),d.push(n),p.push(n),d=u(d),e._extensions=d,l(new s.a([n],t,e),d),l(new s.a(p,t,e),d),e._extensions=p,0===e.getTransmissionControls().length)throw new Error("No channels available");c=!0,e.releaseQueue()},e.getTransmissionControls=function(){return n.getChannelControls()},e.track=function(n){n.iKey||(n.iKey=e.config.instrumentationKey),n.time||(n.time=o.a.toISOString(new Date)),g(n.ver)&&(n.ver="4.0"),e.isInitialized()?e.getProcessTelContext().processNext(n):t.push(n)},e.getProcessTelContext=function(){var t=e._extensions,i=t;return t&&0!==t.length||(i=[n]),new s.a(i,e.config,e)},e.getNotifyMgr=function(){return r||(r=o.a.objCreate({addNotificationListener:function(e){},removeNotificationListener:function(e){},eventsSent:function(e){},eventsDiscarded:function(e,t){},eventsSendRequest:function(e,t){}}),e._notificationManager=r),r},e.getPerfMgr=function(){return a||e.config&&e.config.enablePerfMgr&&(a=new i.a(e.getNotifyMgr())),a},e.setPerfMgr=function(e){a=e},e.eventCnt=function(){return t.length},e.releaseQueue=function(){t.length>0&&(h(t,function(t){e.getProcessTelContext().processNext(t)}),t=[])}})}return e.prototype.initialize=function(e,t,n,i){},e.prototype.getTransmissionControls=function(){return null},e.prototype.track=function(e){},e.prototype.getProcessTelContext=function(){return null},e.prototype.getNotifyMgr=function(){return null},e.prototype.getPerfMgr=function(){return null},e.prototype.setPerfMgr=function(e){},e.prototype.eventCnt=function(){return 0},e.prototype.releaseQueue=function(){},e}(),v=n(63),y=n(64),S=n(34),_=function(e){function t(){var n=e.call(this)||this;return Object(d.a)(t,n,function(e,t){function n(t){var n=e.getNotifyMgr();n&&n.eventsDiscarded([t],v.a.InvalidEvent)}e.initialize=function(e,n,i,r){t.initialize(e,n,i||new S.a(e),r||new y.a(e))},e.track=function(r){Object(i.b)(e.getPerfMgr(),function(){return"AppInsightsCore:track"},function(){if(null===r)throw n(r),Error("Invalid telemetry item");!function(e){if(o.a.isNullOrUndefined(e.name))throw n(e),Error("telemetry name required")}(r),t.track(r)},function(){return{item:r}},!r.sync)},e.addNotificationListener=function(t){var n=e.getNotifyMgr();n&&n.addNotificationListener(t)},e.removeNotificationListener=function(t){var n=e.getNotifyMgr();n&&n.removeNotificationListener(t)},e.pollInternalLogs=function(t){var n=e.config.diagnosticLogInterval;return n&&n>0||(n=1e4),setInterval(function(){var n=e.logger?e.logger.queue:[];o.a.arrForEach(n,function(n){var i={name:t||"InternalMessageId: "+n.messageId,iKey:e.config.instrumentationKey,time:o.a.toISOString(new Date),baseType:S.b.dataType,baseData:{message:n.message}};e.track(i)}),n.length=0},n)}}),n}return __extends(t,e),t.prototype.initialize=function(e,t,n,i){},t.prototype.track=function(e){},t.prototype.addNotificationListener=function(e){},t.prototype.removeNotificationListener=function(e){},t.prototype.pollInternalLogs=function(e){return 0},t}(m),E=n(13),T=n(3),C=function(e){function t(){var n=e.call(this)||this;return n.pluginVersionStringArr=[],n.pluginVersionString="",Object(d.a)(t,n,function(e,t){e.initialize=function(n,o,a,s){Object(i.b)(e,function(){return"AppInsightsCore.initialize"},function(){if(n){n.endpointUrl||(n.endpointUrl="https://browser.events.data.microsoft.com/OneCollector/1.0/");var i=n.propertyStorageOverride;if(i&&(!i.getProperty||!i.setProperty))throw new Error("Invalid property storage override passed.");n.channels&&Object(T.arrForEach)(n.channels,function(t){t&&Object(T.arrForEach)(t,function(t){if(t.identifier&&t.version){var n=t.identifier+"="+t.version;e.pluginVersionStringArr.push(n)}})})}e.getWParam=function(){return"undefined"!=typeof document?0:-1},o&&Object(T.arrForEach)(o,function(t){if(t&&t.identifier&&t.version){var n=t.identifier+"="+t.version;e.pluginVersionStringArr.push(n)}}),e.pluginVersionString=e.pluginVersionStringArr.join(";");try{t.initialize(n,o,a,s)}catch(t){e.logger.throwInternal(r.a.CRITICAL,E.f.ErrorProvidedChannels,"Channels must be provided through config.channels only")}e.pollInternalLogs("InternalLog")},function(){return{config:n,extensions:o,logger:a,notificationManager:s}})},e.track=function(n){Object(i.b)(e,function(){return"AppInsightsCore.track"},function(){var i=n;if(i){i.timings=i.timings||{},i.timings.trackStart=Object(T.getTime)(),Object(T.isLatency)(i.latency)||(i.latency=E.a.Normal);var r=i.ext=i.ext||{};r.sdk=r.sdk||{},r.sdk.ver=T.FullVersionString;var o=i.baseData=i.baseData||{};o.properties||(o.properties={});var a=o.properties;a.version||(a.version=""),""!==e.pluginVersionString&&(a.version=e.pluginVersionString)}t.track(i)},function(){return{item:n}},!n.sync)}}),n}return __extends(t,e),t.prototype.initialize=function(e,t,n,i){},t.prototype.track=function(e){},t}(_);t.a=C},,,function(e,t,n){n(65),n(42),n(47),n(48),n(165),n(80),n(72),n(82),n(44),n(124),n(125),n(126),e.exports=n(297)},function(e,t,n){"use strict";var i={};(0,n(25).assign)(i,n(134),n(137),n(70)),e.exports=i},function(e,t,n){"use strict";var i=n(135),r=n(25),o=n(68),a=n(45),s=n(69),c=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(a[n]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var u;if(u="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=i.deflateSetDictionary(this.strm,u)))throw new Error(a[n]);this._dict_set=!0}}function u(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}l.prototype.push=function(e,t){var n,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=o.string2buf(e):"[object ArrayBuffer]"===c.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new r.Buf8(l),s.next_out=0,s.avail_out=l),1!==(n=i.deflate(s,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(s.output,s.next_out))):this.onData(r.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),s.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=l,t.deflate=u,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,u(e,t)}},function(e,t,n){"use strict";var i,r=n(25),o=n(136),a=n(66),s=n(67),c=n(45);function l(e,t){return e.msg=c[t],t}function u(e){return(e<<1)-(e>4?9:0)}function d(e){for(var t=e.length;--t>=0;)e[t]=0}function p(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function f(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,p(e.strm)}function h(e,t){e.pending_buf[e.pending++]=t}function g(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function m(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,l=e.window,u=e.w_mask,d=e.prev,p=e.strstart+258,f=l[o+a-1],h=l[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+a]===h&&l[n+a-1]===f&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<p);if(i=258-(p-o),o=p-258,i>a){if(e.match_start=t,a=i,i>=s)break;f=l[o+a-1],h=l[o+a]}}}while((t=d[t&u])>c&&0!=--r);return a<=e.lookahead?a:e.lookahead}function v(e){var t,n,i,o,c,l,u,d,p,f,h=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=h+(h-262)){r.arraySet(e.window,e.window,h,h,0),e.match_start-=h,e.strstart-=h,e.block_start-=h,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=h?i-h:0}while(--n);t=n=h;do{i=e.prev[--t],e.prev[t]=i>=h?i-h:0}while(--n);o+=h}if(0===e.strm.avail_in)break;if(l=e.strm,u=e.window,d=e.strstart+e.lookahead,p=o,f=void 0,(f=l.avail_in)>p&&(f=p),n=0===f?0:(l.avail_in-=f,r.arraySet(u,l.input,l.next_in,f,d),1===l.state.wrap?l.adler=a(l.adler,u,f,d):2===l.state.wrap&&(l.adler=s(l.adler,u,f,d)),l.next_in+=f,l.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function y(e,t){for(var n,i;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=m(e,n)),e.match_length>=3)if(i=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function S(e,t){for(var n,i,r;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=m(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=o._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function _(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function E(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):l(e,-2)}function T(e){var t,n=E(e);return 0===n&&((t=e.state).window_size=2*t.w_size,d(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function C(e,t,n,i,o,a){if(!e)return-2;var s=1;if(-1===t&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),o<1||o>9||8!==n||i<8||i>15||t<0||t>9||a<0||a>4)return l(e,-2);8===i&&(i=9);var c=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),d(this.dyn_ltree),d(this.dyn_dtree),d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),d(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=c,c.strm=e,c.wrap=s,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new r.Buf8(2*c.w_size),c.head=new r.Buf16(c.hash_size),c.prev=new r.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new r.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=a,c.method=n,T(e)}i=[new _(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(v(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,f(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)}),new _(4,4,8,4,y),new _(4,5,16,8,y),new _(4,6,32,32,y),new _(4,4,16,16,S),new _(8,16,32,32,S),new _(8,16,128,128,S),new _(8,32,128,256,S),new _(32,128,258,1024,S),new _(32,258,258,4096,S)],t.deflateInit=function(e,t){return C(e,t,8,15,8,0)},t.deflateInit2=C,t.deflateReset=T,t.deflateResetKeep=E,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,r,a,c;if(!e||!e.state||t>5||t<0)return e?l(e,-2):-2;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&4!==t)return l(e,0===e.avail_out?-5:-2);if(r.strm=e,n=r.last_flush,r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,h(r,31),h(r,139),h(r,8),r.gzhead?(h(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),h(r,255&r.gzhead.time),h(r,r.gzhead.time>>8&255),h(r,r.gzhead.time>>16&255),h(r,r.gzhead.time>>24&255),h(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),h(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(h(r,255&r.gzhead.extra.length),h(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=s(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(h(r,0),h(r,0),h(r,0),h(r,0),h(r,0),h(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),h(r,3),r.status=113);else{var m=8+(r.w_bits-8<<4)<<8;m|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(m|=32),m+=31-m%31,r.status=113,g(r,m),0!==r.strstart&&(g(r,e.adler>>>16),g(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),p(e),a=r.pending,r.pending!==r.pending_buf_size));)h(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),p(e),a=r.pending,r.pending===r.pending_buf_size)){c=1;break}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,h(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===c&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),p(e),a=r.pending,r.pending===r.pending_buf_size)){c=1;break}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,h(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===c&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&p(e),r.pending+2<=r.pending_buf_size&&(h(r,255&e.adler),h(r,e.adler>>8&255),e.adler=0,r.status=113)):r.status=113),0!==r.pending){if(p(e),0===e.avail_out)return r.last_flush=-1,0}else if(0===e.avail_in&&u(t)<=u(n)&&4!==t)return l(e,-5);if(666===r.status&&0!==e.avail_in)return l(e,-5);if(0!==e.avail_in||0!==r.lookahead||0!==t&&666!==r.status){var y=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(v(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var n,i,r,a,s=e.window;;){if(e.lookahead<=258){if(v(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=s[r=e.strstart-1])===s[++r]&&i===s[++r]&&i===s[++r]){a=e.strstart+258;do{}while(i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&r<a);e.match_length=258-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(r,t):i[r.level].func(r,t);if(3!==y&&4!==y||(r.status=666),1===y||3===y)return 0===e.avail_out&&(r.last_flush=-1),0;if(2===y&&(1===t?o._tr_align(r):5!==t&&(o._tr_stored_block(r,0,0,!1),3===t&&(d(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),p(e),0===e.avail_out))return r.last_flush=-1,0}return 4!==t?0:r.wrap<=0?1:(2===r.wrap?(h(r,255&e.adler),h(r,e.adler>>8&255),h(r,e.adler>>16&255),h(r,e.adler>>24&255),h(r,255&e.total_in),h(r,e.total_in>>8&255),h(r,e.total_in>>16&255),h(r,e.total_in>>24&255)):(g(r,e.adler>>>16),g(r,65535&e.adler)),p(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?l(e,-2):(e.state=null,113===t?l(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,i,o,s,c,l,u,p,f=t.length;if(!e||!e.state)return-2;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return-2;for(1===s&&(e.adler=a(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(d(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new r.Buf8(n.w_size),r.arraySet(p,t,f-n.w_size,n.w_size,0),t=p,f=n.w_size),c=e.avail_in,l=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,v(n);n.lookahead>=3;){i=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--o);n.strstart=i,n.lookahead=2,v(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,n.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var i=n(25);function r(e){for(var t=e.length;--t>=0;)e[t]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=new Array(576);r(l);var u=new Array(60);r(u);var d=new Array(512);r(d);var p=new Array(256);r(p);var f=new Array(29);r(f);var h,g,m,v=new Array(30);function y(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function S(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function _(e){return e<256?d[e]:d[256+(e>>>7)]}function E(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function T(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,E(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function C(e,t,n){T(e,n[2*t],n[2*t+1])}function I(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function A(e,t,n){var i,r,o=new Array(16),a=0;for(i=1;i<=15;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=I(o[s]++,s))}}function b(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function R(e){e.bi_valid>8?E(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function O(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function P(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&O(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!O(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function N(e,t,n){var i,r,s,c,l=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],r=e.pending_buf[e.l_buf+l],l++,0===i?C(e,r,t):(C(e,(s=p[r])+256+1,t),0!==(c=o[s])&&T(e,r-=f[s],c),C(e,s=_(--i),n),0!==(c=a[s])&&T(e,i-=v[s],c))}while(l<e.last_lit);C(e,256,t)}function M(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==o[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)P(e,o,n);r=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,P(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,c=t.dyn_tree,l=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,h=t.stat_desc.max_length,g=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=c[2*c[2*(i=e.heap[n])+1]+1]+1)>h&&(o=h,g++),c[2*i+1]=o,i>l||(e.bl_count[o]++,a=0,i>=f&&(a=p[i-f]),s=c[2*i],e.opt_len+=s*(o+a),d&&(e.static_len+=s*(u[2*i+1]+a)));if(0!==g){do{for(o=h-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[h]--,g-=2}while(g>0);for(o=h;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>l||(c[2*r+1]!==o&&(e.opt_len+=(o-c[2*r+1])*c[2*r],c[2*r+1]=o),i--)}}(e,t),A(o,l,e.bl_count)}function w(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<c&&r===a||(s<l?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=r,0===a?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4))}function D(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<c&&r===a)){if(s<l)do{C(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(C(e,r,e.bl_tree),s--),C(e,16,e.bl_tree),T(e,s-3,2)):s<=10?(C(e,17,e.bl_tree),T(e,s-3,3)):(C(e,18,e.bl_tree),T(e,s-11,7));s=0,o=r,0===a?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4)}}r(v);var L=!1;function k(e,t,n,r){T(e,0+(r?1:0),3),function(e,t,n,r){R(e),E(e,n),E(e,~n),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){L||(function(){var e,t,n,i,r,c=new Array(16);for(n=0,i=0;i<28;i++)for(f[i]=n,e=0;e<1<<o[i];e++)p[n++]=i;for(p[n-1]=i,r=0,i=0;i<16;i++)for(v[i]=r,e=0;e<1<<a[i];e++)d[r++]=i;for(r>>=7;i<30;i++)for(v[i]=r<<7,e=0;e<1<<a[i]-7;e++)d[256+r++]=i;for(t=0;t<=15;t++)c[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,c[8]++;for(;e<=255;)l[2*e+1]=9,e++,c[9]++;for(;e<=279;)l[2*e+1]=7,e++,c[7]++;for(;e<=287;)l[2*e+1]=8,e++,c[8]++;for(A(l,287,c),e=0;e<30;e++)u[2*e+1]=5,u[2*e]=I(e,5);h=new y(l,o,257,286,15),g=new y(u,a,0,30,15),m=new y(new Array(0),s,0,19,7)}(),L=!0),e.l_desc=new S(e.dyn_ltree,h),e.d_desc=new S(e.dyn_dtree,g),e.bl_desc=new S(e.bl_tree,m),e.bi_buf=0,e.bi_valid=0,b(e)},t._tr_stored_block=k,t._tr_flush_block=function(e,t,n,i){var r,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),M(e,e.l_desc),M(e,e.d_desc),a=function(e){var t;for(w(e,e.dyn_ltree,e.l_desc.max_code),w(e,e.dyn_dtree,e.d_desc.max_code),M(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?k(e,t,n,i):4===e.strategy||o===r?(T(e,2+(i?1:0),3),N(e,l,u)):(T(e,4+(i?1:0),3),function(e,t,n,i){var r;for(T(e,t-257,5),T(e,n-1,5),T(e,i-4,4),r=0;r<i;r++)T(e,e.bl_tree[2*c[r]+1],3);D(e,e.dyn_ltree,t-1),D(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),N(e,e.dyn_ltree,e.dyn_dtree)),b(e),i&&R(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(p[n]+256+1)]++,e.dyn_dtree[2*_(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){T(e,2,3),C(e,256,l),function(e){16===e.bi_valid?(E(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var i=n(138),r=n(25),o=n(68),a=n(70),s=n(45),c=n(69),l=n(141),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new l,i.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=i.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(s[n])}function p(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}d.prototype.push=function(e,t){var n,s,c,l,d,p=this.strm,f=this.options.chunkSize,h=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?p.input=o.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(f),p.next_out=0,p.avail_out=f),(n=i.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&h&&(n=i.inflateSetDictionary(this.strm,h)),n===a.Z_BUF_ERROR&&!0===g&&(n=a.Z_OK,g=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&n!==a.Z_STREAM_END&&(0!==p.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(p.output,p.next_out),l=p.next_out-c,d=o.buf2string(p.output,c),p.next_out=l,p.avail_out=f-l,l&&r.arraySet(p.output,p.output,c,l,0),this.onData(d)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(g=!0)}while((p.avail_in>0||0===p.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),p.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=p,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},t.ungzip=p},function(e,t,n){"use strict";var i=n(25),r=n(66),o=n(67),a=n(139),s=n(140);function c(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):-2}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,u(e)):-2}function p(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,d(e))):-2}function f(e,t){var n,i;return e?(i=new l,e.state=i,i.window=null,0!==(n=p(e,t))&&(e.state=null),n):-2}var h,g,m=!0;function v(e){if(m){var t;for(h=new i.Buf32(512),g=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,h,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,g,0,e.work,{bits:5}),m=!1}e.lencode=h,e.lenbits=9,e.distcode=g,e.distbits=5}function y(e,t,n,r){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),r>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>r&&(o=r),i.arraySet(a.window,t,n-r,o,a.wnext),(r-=o)?(i.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=d,t.inflateReset2=p,t.inflateResetKeep=u,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var n,l,u,d,p,f,h,g,m,S,_,E,T,C,I,A,b,R,O,P,N,M,w,D,L=0,k=new i.Buf8(4),x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),p=e.next_out,u=e.output,h=e.avail_out,d=e.next_in,l=e.input,f=e.avail_in,g=n.hold,m=n.bits,S=f,_=h,M=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(2&n.wrap&&35615===g){n.check=0,k[0]=255&g,k[1]=g>>>8&255,n.check=o(n.check,k,2,0),g=0,m=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&g)){e.msg="unknown compression method",n.mode=30;break}if(m-=4,N=8+(15&(g>>>=4)),0===n.wbits)n.wbits=N;else if(N>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<N,e.adler=n.check=1,n.mode=512&g?10:12,g=0,m=0;break;case 2:for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(n.flags=g,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=g>>8&1),512&n.flags&&(k[0]=255&g,k[1]=g>>>8&255,n.check=o(n.check,k,2,0)),g=0,m=0,n.mode=3;case 3:for(;m<32;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.head&&(n.head.time=g),512&n.flags&&(k[0]=255&g,k[1]=g>>>8&255,k[2]=g>>>16&255,k[3]=g>>>24&255,n.check=o(n.check,k,4,0)),g=0,m=0,n.mode=4;case 4:for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&n.flags&&(k[0]=255&g,k[1]=g>>>8&255,n.check=o(n.check,k,2,0)),g=0,m=0,n.mode=5;case 5:if(1024&n.flags){for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.length=g,n.head&&(n.head.extra_len=g),512&n.flags&&(k[0]=255&g,k[1]=g>>>8&255,n.check=o(n.check,k,2,0)),g=0,m=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((E=n.length)>f&&(E=f),E&&(n.head&&(N=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,l,d,E,N)),512&n.flags&&(n.check=o(n.check,l,E,d)),f-=E,d+=E,n.length-=E),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break e;E=0;do{N=l[d+E++],n.head&&N&&n.length<65536&&(n.head.name+=String.fromCharCode(N))}while(N&&E<f);if(512&n.flags&&(n.check=o(n.check,l,E,d)),f-=E,d+=E,N)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break e;E=0;do{N=l[d+E++],n.head&&N&&n.length<65536&&(n.head.comment+=String.fromCharCode(N))}while(N&&E<f);if(512&n.flags&&(n.check=o(n.check,l,E,d)),f-=E,d+=E,N)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;m<16;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}g=0,m=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;m<32;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}e.adler=n.check=c(g),g=0,m=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=p,e.avail_out=h,e.next_in=d,e.avail_in=f,n.hold=g,n.bits=m,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){g>>>=7&m,m-=7&m,n.mode=27;break}for(;m<3;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}switch(n.last=1&g,m-=1,3&(g>>>=1)){case 0:n.mode=14;break;case 1:if(v(n),n.mode=20,6===t){g>>>=2,m-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}g>>>=2,m-=2;break;case 14:for(g>>>=7&m,m-=7&m;m<32;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&g,g=0,m=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(E=n.length){if(E>f&&(E=f),E>h&&(E=h),0===E)break e;i.arraySet(u,l,d,E,p),f-=E,d+=E,h-=E,p+=E,n.length-=E;break}n.mode=12;break;case 17:for(;m<14;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(n.nlen=257+(31&g),g>>>=5,m-=5,n.ndist=1+(31&g),g>>>=5,m-=5,n.ncode=4+(15&g),g>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;m<3;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.lens[x[n.have++]]=7&g,g>>>=3,m-=3}for(;n.have<19;)n.lens[x[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,w={bits:n.lenbits},M=s(0,n.lens,0,19,n.lencode,0,n.work,w),n.lenbits=w.bits,M){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;A=(L=n.lencode[g&(1<<n.lenbits)-1])>>>16&255,b=65535&L,!((I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(b<16)g>>>=I,m-=I,n.lens[n.have++]=b;else{if(16===b){for(D=I+2;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(g>>>=I,m-=I,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}N=n.lens[n.have-1],E=3+(3&g),g>>>=2,m-=2}else if(17===b){for(D=I+3;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}m-=I,N=0,E=3+(7&(g>>>=I)),g>>>=3,m-=3}else{for(D=I+7;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}m-=I,N=0,E=11+(127&(g>>>=I)),g>>>=7,m-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;E--;)n.lens[n.have++]=N}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,w={bits:n.lenbits},M=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,w),n.lenbits=w.bits,M){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,w={bits:n.distbits},M=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,w),n.distbits=w.bits,M){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(f>=6&&h>=258){e.next_out=p,e.avail_out=h,e.next_in=d,e.avail_in=f,n.hold=g,n.bits=m,a(e,_),p=e.next_out,u=e.output,h=e.avail_out,d=e.next_in,l=e.input,f=e.avail_in,g=n.hold,m=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;A=(L=n.lencode[g&(1<<n.lenbits)-1])>>>16&255,b=65535&L,!((I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(A&&0==(240&A)){for(R=I,O=A,P=b;A=(L=n.lencode[P+((g&(1<<R+O)-1)>>R)])>>>16&255,b=65535&L,!(R+(I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}g>>>=R,m-=R,n.back+=R}if(g>>>=I,m-=I,n.back+=I,n.length=b,0===A){n.mode=26;break}if(32&A){n.back=-1,n.mode=12;break}if(64&A){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&A,n.mode=22;case 22:if(n.extra){for(D=n.extra;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;A=(L=n.distcode[g&(1<<n.distbits)-1])>>>16&255,b=65535&L,!((I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(0==(240&A)){for(R=I,O=A,P=b;A=(L=n.distcode[P+((g&(1<<R+O)-1)>>R)])>>>16&255,b=65535&L,!(R+(I=L>>>24)<=m);){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}g>>>=R,m-=R,n.back+=R}if(g>>>=I,m-=I,n.back+=I,64&A){e.msg="invalid distance code",n.mode=30;break}n.offset=b,n.extra=15&A,n.mode=24;case 24:if(n.extra){for(D=n.extra;m<D;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===h)break e;if(E=_-h,n.offset>E){if((E=n.offset-E)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}E>n.wnext?(E-=n.wnext,T=n.wsize-E):T=n.wnext-E,E>n.length&&(E=n.length),C=n.window}else C=u,T=p-n.offset,E=n.length;E>h&&(E=h),h-=E,n.length-=E;do{u[p++]=C[T++]}while(--E);0===n.length&&(n.mode=21);break;case 26:if(0===h)break e;u[p++]=n.length,h--,n.mode=21;break;case 27:if(n.wrap){for(;m<32;){if(0===f)break e;f--,g|=l[d++]<<m,m+=8}if(_-=h,e.total_out+=_,n.total+=_,_&&(e.adler=n.check=n.flags?o(n.check,u,_,p-_):r(n.check,u,_,p-_)),_=h,(n.flags?g:c(g))!==n.check){e.msg="incorrect data check",n.mode=30;break}g=0,m=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;m<32;){if(0===f)break e;f--,g+=l[d++]<<m,m+=8}if(g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}g=0,m=0}n.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=p,e.avail_out=h,e.next_in=d,e.avail_in=f,n.hold=g,n.bits=m,(n.wsize||_!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&y(e,e.output,e.next_out,_-e.avail_out)?(n.mode=31,-4):(S-=e.avail_in,_-=e.avail_out,e.total_in+=S,e.total_out+=_,n.total+=_,n.wrap&&_&&(e.adler=n.check=n.flags?o(n.check,u,_,e.next_out-_):r(n.check,u,_,e.next_out-_)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===S&&0===_||4===t)&&0===M&&(M=-5),M)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&r(1,t,i,0)!==n.check?-3:y(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,i,r,o,a,s,c,l,u,d,p,f,h,g,m,v,y,S,_,E,T,C,I,A,b;n=e.state,i=e.next_in,A=e.input,r=i+(e.avail_in-5),o=e.next_out,b=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,d=n.wnext,p=n.window,f=n.hold,h=n.bits,g=n.lencode,m=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{h<15&&(f+=A[i++]<<h,h+=8,f+=A[i++]<<h,h+=8),S=g[f&v];t:for(;;){if(f>>>=_=S>>>24,h-=_,0==(_=S>>>16&255))b[o++]=65535&S;else{if(!(16&_)){if(0==(64&_)){S=g[(65535&S)+(f&(1<<_)-1)];continue t}if(32&_){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}E=65535&S,(_&=15)&&(h<_&&(f+=A[i++]<<h,h+=8),E+=f&(1<<_)-1,f>>>=_,h-=_),h<15&&(f+=A[i++]<<h,h+=8,f+=A[i++]<<h,h+=8),S=m[f&y];n:for(;;){if(f>>>=_=S>>>24,h-=_,!(16&(_=S>>>16&255))){if(0==(64&_)){S=m[(65535&S)+(f&(1<<_)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(T=65535&S,h<(_&=15)&&(f+=A[i++]<<h,(h+=8)<_&&(f+=A[i++]<<h,h+=8)),(T+=f&(1<<_)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=_,h-=_,T>(_=o-a)){if((_=T-_)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,I=p,0===d){if(C+=l-_,_<E){E-=_;do{b[o++]=p[C++]}while(--_);C=o-T,I=b}}else if(d<_){if(C+=l+d-_,(_-=d)<E){E-=_;do{b[o++]=p[C++]}while(--_);if(C=0,d<E){E-=_=d;do{b[o++]=p[C++]}while(--_);C=o-T,I=b}}}else if(C+=d-_,_<E){E-=_;do{b[o++]=p[C++]}while(--_);C=o-T,I=b}for(;E>2;)b[o++]=I[C++],b[o++]=I[C++],b[o++]=I[C++],E-=3;E&&(b[o++]=I[C++],E>1&&(b[o++]=I[C++]))}else{C=o-T;do{b[o++]=b[C++],b[o++]=b[C++],b[o++]=b[C++],E-=3}while(E>2);E&&(b[o++]=b[C++],E>1&&(b[o++]=b[C++]))}break}}break}}while(i<r&&o<s);i-=E=h>>3,f&=(1<<(h-=E<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=f,n.bits=h}},function(e,t,n){"use strict";var i=n(25),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,u,d,p){var f,h,g,m,v,y,S,_,E,T=p.bits,C=0,I=0,A=0,b=0,R=0,O=0,P=0,N=0,M=0,w=0,D=null,L=0,k=new i.Buf16(16),x=new i.Buf16(16),F=null,U=0;for(C=0;C<=15;C++)k[C]=0;for(I=0;I<c;I++)k[t[n+I]]++;for(R=T,b=15;b>=1&&0===k[b];b--);if(R>b&&(R=b),0===b)return l[u++]=20971520,l[u++]=20971520,p.bits=1,0;for(A=1;A<b&&0===k[A];A++);for(R<A&&(R=A),N=1,C=1;C<=15;C++)if(N<<=1,(N-=k[C])<0)return-1;if(N>0&&(0===e||1!==b))return-1;for(x[1]=0,C=1;C<15;C++)x[C+1]=x[C]+k[C];for(I=0;I<c;I++)0!==t[n+I]&&(d[x[t[n+I]]++]=I);if(0===e?(D=F=d,y=19):1===e?(D=r,L-=257,F=o,U-=257,y=256):(D=a,F=s,y=-1),w=0,I=0,C=A,v=u,O=R,P=0,g=-1,m=(M=1<<R)-1,1===e&&M>852||2===e&&M>592)return 1;for(;;){S=C-P,d[I]<y?(_=0,E=d[I]):d[I]>y?(_=F[U+d[I]],E=D[L+d[I]]):(_=96,E=0),f=1<<C-P,A=h=1<<O;do{l[v+(w>>P)+(h-=f)]=S<<24|_<<16|E|0}while(0!==h);for(f=1<<C-1;w&f;)f>>=1;if(0!==f?(w&=f-1,w+=f):w=0,I++,0==--k[C]){if(C===b)break;C=t[n+d[I]]}if(C>R&&(w&m)!==g){for(0===P&&(P=R),v+=A,N=1<<(O=C-P);O+P<b&&!((N-=k[O+P])<=0);)O++,N<<=1;if(M+=1<<O,1===e&&M>852||2===e&&M>592)return 1;l[g=w&m]=R<<24|O<<16|v-u|0}}return 0!==w&&(l[v+w]=C-P<<24|64<<16|0),p.bits=R,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(17);function r(e,t,n){if(!e)return n.info("sanitizeMeetingCode["+t+"] empty / undefined meeting code parameter"),e;var i=e.replace(/\s/g,"");return i=i.replace(/-/g,""),n.info("sanitizeMeetingCode["+t+"] meetingCode: "+e+", sanitizedMeetingCode: "+i),i}function o(e,t,n){if(!e)return n.info("getMeetingCodeFromMeetingUrl["+t+"] empty / undefined meeting Url parameter"),e;var r=new URL(e),o="";if(r&&r.pathname&&r.pathname.split("/").length>=2){var a=r.pathname.split("/");"meet"===a[a.length-2]&&(o=a[a.length-1])}return n.info("getMeetingCodeFromMeetingUrl["+t+"] meetingUrl: "+e+", meetingUrlObject: "+i.safeJsonStringify(r)+", meetingCode: "+o),o}t.isMeetingCodeUrl=function(e){var t=new URL(e).pathname.split("/");return t.pop(),"meet"===t.pop()},t.sanitizeMeetingCode=r,t.getMeetingCodeFromMeetingUrl=o,t.compareMeetingData=function(e,t,n,i){var a=r(e&&e.meetingCode||"",n,i),s=r(t&&t.meetingCode||"",n,i),c=function(e,t){return!!e&&!!t&&e===t};if(c(a,s))return!0;var l=o(e&&e.meetingUrl||"",n,i);l=r(l,n,i);var u=o(t&&t.meetingUrl||"",n,i);if(c(l,u=r(u,n,i)))return!0;if(c(l,s)||c(u,a))return!0;if(e&&e.meetingUrl&&t&&t.meetingUrl){var d=new URL(e.meetingUrl),p=new URL(t.meetingUrl);if(d.hostname===p.hostname&&d.pathname===p.pathname)return!0}return!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=function(){function e(e){this.subscriptions=[],this.eventLogger=e}return e.prototype.subscribe=function(e){return new o(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this;this.subscriptions.slice().forEach(function(n){try{void 0!==n.eventHandler&&e(n.eventHandler)}catch(e){t.eventLogger&&t.eventLogger.warn&&t.eventLogger.warn("Event handler exception caught!",e)}})},e}();t.EventSourceImpl=r;var o=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;i.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=void 0},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStringBase64=function(e){if(!e)return!1;try{return atob(e),!0}catch(e){return!1}},t.isPromiseLike=function(e){return!!e&&"function"==typeof e.then}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONSTANTS={CODE:{SUCCESS:0,CLIENT_ERROR_CODE:499},SUB_CODE:{ACTION_NOT_ALLOWED:3548,ABANDONED:4990,ENDED_BY_REMOTE_ENDPOINT:5028}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=/;aliases=.*$/i;t.MRI_SKYPE_PREFIX="8:",t.MRI_ALIAS_PREFIX=";aliases=",t.MRI_SIP_PREFIX="2:",t.PSTN_MRI_PREFIX="4:",t.stripMriAliases=function(e){return e?e.replace(i,""):e},t.generateAliasedMri=function(e,n){var i=e;return n&&(i+=t.MRI_ALIAS_PREFIX+t.MRI_SIP_PREFIX+n),i}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(41),o=n(16),a=n(31),s=n(11),c=n(17),l=function(){function e(e){var t=this;this._disposed=!1,this._logger=e.createChild("[ASYNC]"),this._endOperationDeferred=a.defer(),this._endOperationDeferred.promise.catch(function(e){t._logger.info("Rejected all operations")}),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._deferredOperationsWithCauseId={},this._logger=e}return e.prototype.registerPromise=function(e,t){var n=!1,i=function(){n=!0};t.then(i,i);var r=this._endOperationDeferred.promise.catch(function(t){if(!n)throw new Error("Operation "+e+" did not complete, reason:"+t)});return Promise.race([r,t])},e.prototype.updateOperationId=function(e,t){var n=this;this._logger.info("updateOperationId "+e+" "+t),Object.keys(this._deferredOperationsWithOperationId).forEach(function(i){i&&n._deferredOperationsWithOperationId[i]&&(n._logger.info("_deferredOperationsWithOperationId "+i),Object.keys(n._deferredOperationsWithOperationId[i]).forEach(function(r){r&&n._deferredOperationsWithOperationId[i][r]&&(n._logger.info("_deferredOperationsWithOperationId "+r+" "+t),r===e&&(n._deferredOperationsWithOperationId[i][t]=n._deferredOperationsWithOperationId[i][r],delete n._deferredOperationsWithOperationId[i][r]))}))}),Object.keys(this._deferredOperationsWithCauseId).forEach(function(i){i&&n._deferredOperationsWithCauseId[i]&&(n._logger.info("_deferredOperationsWithCauseId "+i),Object.keys(n._deferredOperationsWithCauseId[i]).forEach(function(r){r&&n._deferredOperationsWithCauseId[i][r]&&(n._logger.info("_deferredOperationsWithCauseId "+r+" "+t),r===e&&(n._deferredOperationsWithOperationId[i][t]=n._deferredOperationsWithOperationId[i][r],delete n._deferredOperationsWithOperationId[i][r]))}))})},e.prototype.createPendingOperation=function(e,t,n){var i=this;void 0===n&&(n=s.generateCauseId());var c=a.defer();c.promise.catch(r.noop);var l,u=this.getOperationInfoForLogging(n,e,t);if(this._logger.info(u+"[creating...]"),this._disposed)return this._logger.info(u+"[create failed, call is disposed]"),Promise.reject(60);if(t){if(this._deferredOperationsWithOperationId[e]||(this._deferredOperationsWithOperationId[e]={}),this._deferredOperationsWithOperationId[e][t])return this._logger.warn(u+" Deferred operation with given name and operation id is already defined"),Promise.reject(new Error("Deferred operation with given name is already defined:"+e+"/"+o.scrubMriOrOmit(t)));this._deferredOperationsWithOperationId[e][t]={deferred:c,causeId:n},this._deferredOperationsWithCauseId[n]||(this._deferredOperationsWithCauseId[n]={}),this._deferredOperationsWithCauseId[n][t]=c,l=this._endOperationDeferred.promise.catch(function(n){if(i.hasPendingOperationWithOperationId(e,t))throw new Error("Operation "+e+" "+t+" did not complete, reason:"+n)})}else{if(this._deferredOperations[e])return this._logger.warn(u+" Deferred operation with given name is already defined"),Promise.reject(new Error("Deferred operation with given name is already defined:"+e));this._deferredOperationsWithCauseId[n]||(this._deferredOperationsWithCauseId[n]={}),this._deferredOperationsWithCauseId[n][""]=c,this._deferredOperations[e]={deferred:c,causeId:n},l=this._endOperationDeferred.promise.catch(function(t){if(i.hasPendingOperation(e))throw new Error("Operation "+e+" did not complete, reason:"+t)})}return Promise.race([l,c.promise])},e.prototype.hasPendingOperation=function(e){return!!this._deferredOperations[e]},e.prototype.hasAtleastOneOfPendingOperation=function(e){var t,n;try{for(var r=i(e),o=r.next();!o.done;o=r.next()){var a=o.value;if(this.hasPendingOperation(a))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!1},e.prototype.hasPendingOperationWithOperationId=function(e,t){return!(!t||!this._deferredOperationsWithOperationId[e]||!this._deferredOperationsWithOperationId[e][t])},e.prototype.hasPendingOperationWithCauseId=function(e,t){return t||(t=""),!!this._deferredOperationsWithCauseId[e][t]},e.prototype.getPendingOperationWithCauseId=function(e,t){return this.hasPendingOperationWithCauseId(e,t)?this._deferredOperationsWithCauseId[e][t].promise:Promise.reject("["+e+"]["+t+"]: getPendingOperationWithCauseId for given causeId, operationId")},e.prototype.resolveOperationWithCauseId=function(e,t,n){if(this.hasPendingOperationWithCauseId(e)){t||(t="");var i=this._deferredOperationsWithCauseId[e][t],r=i.promise;return i.resolve(n),this._logger.info("["+e+"]["+t+"] resolved, result="+(c.getPrintableObject(n)||"void")),delete this._deferredOperationsWithCauseId[e][t],r}return Promise.reject("["+e+"]["+t+"] resolveOperationWithCauseId failed, operation not found")},e.prototype.rejectOperationWithCauseId=function(e,t,n){if(this.hasPendingOperationWithCauseId(e)){t||(t="");var i=this._deferredOperationsWithCauseId[e][t],o=i.promise;return o.catch(r.noop),i.reject(n),this._logger.info("["+e+"]["+t+"] rejected, result="+(c.getPrintableObject(n)||"void")),delete this._deferredOperationsWithCauseId[e][t],o}return Promise.reject("["+e+"]["+t+"] rejectOperationWithCauseId failed, operation not found")},e.prototype.maybeResolveOperationWithCauseId=function(e,t,n){var i=this;this.hasPendingOperationWithCauseId(e,t)?this.resolveOperationWithCauseId(e,t,n).catch(function(t){i._logger.info(e+"maybeResolveOperationWithCauseId failed, reason="+c.getPrintableObject(t))}):this._logger.info(e+"maybeResolveOperationWithCauseId ignored, operation does not exist")},e.prototype.maybeRejectOperationWithCauseId=function(e,t,n){this.hasPendingOperationWithCauseId(e,t)?this.rejectOperationWithCauseId(e,t,n).catch(r.noop):this._logger.info(e+"maybeRejectOperationWithCauseId ignored, operation does not exist")},e.prototype.getPendingOperation=function(e,t,n){return void 0===n&&(n=s.generateCauseId()),!t&&this._deferredOperations[e]?this._deferredOperations[e].deferred.promise:this._deferredOperationsWithOperationId[e]&&this._deferredOperationsWithOperationId[e][t]?this._deferredOperationsWithOperationId[e][t].deferred.promise:Promise.reject(this.getOperationInfoForLogging(n,e,t)+": Deferred operation with given name and operation does not exist")},e.prototype.waitForOperation=function(e,t,n){return void 0===n&&(n=s.generateCauseId()),this.hasPendingOperationWithOperationId(e,t)?this._deferredOperationsWithOperationId[e][t].deferred.promise:this.hasPendingOperation(e)?this._deferredOperations[e].deferred.promise:Promise.reject(this.getOperationInfoForLogging(n,e,t)+"failed=wait failed, operation not found")},e.prototype.resolveOperation=function(e,t,n,i,r){if(void 0===i&&(i=s.generateCauseId()),void 0===r&&(r=!1),!e)return Promise.reject("Unable to resolve deferred operation with empty name");if(this.hasPendingOperationWithOperationId(e,n)){var o=(a=this._deferredOperationsWithOperationId[e][n]).deferred.promise;return a.deferred.resolve(t),this._logger.info(this.getOperationInfoForLogging(a.causeId,e,n)+"resolved, result="+(c.getPrintableObject(t)||"void")),r||delete this._deferredOperationsWithOperationId[e][n],o}if(this.hasPendingOperation(e)){var a=this._deferredOperations[e];return o=this._deferredOperations[e].deferred.promise,this._deferredOperations[e].deferred.resolve(t),this._logger.info(this.getOperationInfoForLogging(a.causeId,e,n)+"resolved, result="+(c.getPrintableObject(t)||"void")),r||delete this._deferredOperations[e],o}return Promise.reject(this.getOperationInfoForLogging(i,e,n)+"failed=resolve failed, operation not found")},e.prototype.rejectOperation=function(e,t,n,i){return void 0===i&&(i=s.generateCauseId()),e?this.hasPendingOperationWithOperationId(e,n)?((a=(o=this._deferredOperationsWithOperationId[e][n]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"rejected, reason="+(c.getPrintableObject(t)||"void")),delete this._deferredOperationsWithOperationId[e][n],a):this.hasPendingOperation(e)?((a=(o=this._deferredOperations[e]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"rejected, reason="+(c.getPrintableObject(t)||"void")),delete this._deferredOperations[e],a):Promise.reject(this.getOperationInfoForLogging(i,e,n)+"failed=reject failed, operation not found"):Promise.reject("Unable to reject deferred operation with empty name");var o,a},e.prototype.maybeResolveOperation=function(e,t,n,i){var r=this;void 0===i&&(i=s.generateCauseId());var o=this.getOperationInfoForLogging(i,e,n);this.hasPendingOperationWithOperationId(e,n)||this.hasPendingOperation(e)?this.resolveOperation(e,t,n,i).catch(function(e){r._logger.info(o+"maybeResolveOperation failed, reason="+c.getPrintableObject(e))}):this._logger.info(o+"maybeResolveOperation ignored, operation does not exist")},e.prototype.maybeResolveOperations=function(e,t,n,r){var o,a;void 0===r&&(r=s.generateCauseId());try{for(var c=i(e),l=c.next();!l.done;l=c.next()){var u=l.value;this.maybeResolveOperation(u,t,n,r)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},e.prototype.maybeRejectOperation=function(e,t,n,i){void 0===i&&(i=s.generateCauseId());var o=this.getOperationInfoForLogging(i,e,n);this.hasPendingOperationWithOperationId(e,n)||this.hasPendingOperation(e)?this.rejectOperation(e,t,n,i).catch(r.noop):this._logger.info(o+"maybeRejectOperation ignored, operation does not exist")},e.prototype.maybeRejectOperations=function(e,t,n,r){var o,a;void 0===r&&(r=s.generateCauseId());try{for(var c=i(e),l=c.next();!l.done;l=c.next()){var u=l.value;this.maybeRejectOperation(u,t,n,r)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},e.prototype.rejectPendingOperations=function(e,t){var n=this;void 0===t&&(t=s.generateCauseId()),this._disposed=!0,this._logger.info("["+t+"]rejectPendingOperations="+e),Object.keys(this._deferredOperations).forEach(function(i){n.maybeRejectOperation(i,e,void 0,t),n._deferredOperationsWithOperationId[t]&&delete n._deferredOperationsWithOperationId[t][""]}),Object.keys(this._deferredOperationsWithOperationId).forEach(function(i){Object.keys(n._deferredOperationsWithOperationId[i]).forEach(function(r){n.maybeRejectOperation(i,e,r,t),n._deferredOperationsWithOperationId[t]&&delete n._deferredOperationsWithOperationId[t][r]})}),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._endOperationDeferred.reject(e)},e.prototype.getOperationInfoForLogging=function(e,t,n){return void 0===n&&(n=""),"["+e+"]["+t+"]"+(n?"["+o.scrubMriOrOmit(n)+"]":"")},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=n(11),o=function(){function e(e){this._logger=e,this._promise=Promise.resolve(void 0),this._actionQueue=[]}return e.prototype.chainPromise=function(e,t,n,o){var a=this;void 0===n&&(n=r.generateCauseId()),void 0===o&&(o=!1);var s=Date.now(),c=(("function"==typeof t?t():t)||"").toString();this._actionQueue.push(c),this._logger.info("["+n+"]["+c+"]enqueueing, queue=["+this._actionQueue+"], reset="+o);var l=function(){a._actionQueue=a._actionQueue.filter(function(e){return e!==c})};return o&&this.reset(n),this._promise=this._promise.catch(i.noop).then(function(){var t=Date.now()-s;return a._logger.info("["+n+"]["+c+"]begin, delayMs="+t),e()}),this._promise.then(function(){l();var e=Date.now()-s;a._logger.info("["+n+"]["+c+"]success, durationMs="+e)},function(e){l();var t=Date.now()-s;a._logger.warn("["+n+"]["+c+"]failed="+e+", drationMs="+t)}),this._promise},e.prototype.reset=function(e){this._logger.info("["+e+"] resetting"),this._promise=Promise.resolve(void 0)},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){var e=this;this.msElapsed=0,this.isPaused=!1,this._startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e._startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e._startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e._startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}}return Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},enumerable:!0,configurable:!0}),e}();t.Stopwatch=i,t.build=function(){return new i}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),t.findParticipantUsingParticipantLegId=function(e,t){return e.participants.find(function(e){return function(e,t){var n,r;if(e.endpoints&&e.endpoints.endpointDetails)try{for(var o=i(e.endpoints.endpointDetails),a=o.next();!a.done;a=o.next())if(a.value.participantId===t)return!0}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return!1}(e,t)})}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(17);t.isOneOfPhaseErrors=function(e,t){return t&&void 0!==t.phase&&!!e[t.phase]},t.isPhaseError=function(e,t){return t&&void 0!==t.phase&&t.phase===e},t.default=function(e){var t=this,n={},a=function(e){n[e]={status:"Pending"}},s=function(e,t){n[e].t=t,delete n[e].status},c=function(e,t,i){n[e].status="Failed",n[e].t=t,n[e].reason=o.getPrintableObject(i)};return{execute:function(l,u){return i(t,void 0,void 0,function(){var t,i,d,p,f;return r(this,function(r){switch(r.label){case 0:t=e.createChild("[phase="+l+"]"),a(l),t.info("started"),i=(new Date).getTime(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,u()];case 2:return d=r.sent(),f=+new Date-i,t.logSuccess("done, time="+f),s(l,f),[2,d];case 3:throw p=r.sent(),f=+new Date-i,t.logFailure("time="+f+", error="+o.getPrintableObject(p)),c(l,f,p),{phase:l,error:p,phases:n};case 4:return[2]}})})},executeSync:function(t,i){var r=e.createChild("[phase="+t+"]");r.info("started"),a(t);var l=(new Date).getTime();try{var u=i(),d=+new Date-l;return s(t,d),r.logSuccess("done, time="+d),u}catch(e){throw d=+new Date-l,r.logFailure("time="+d+", error="+o.getPrintableObject(e)),c(t,d,e),{phase:t,error:e,phases:n}}},getTelemetryData:function(){return n}}}},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.callStateIsAnyOf=function(e,t){return-1!==t.indexOf(e)},t.validStateTransitions=((i={})[0]=[1,2,8,6,10,11,9],i[1]=[2,6,7,10],i[2]=[1,3,6,7,9,10],i[3]=[6,7,4,5,10],i[8]=[1,11,10,2,9,6,7],i[4]=[6,7,3,5,10],i[5]=[6,7,3,4,10],i[9]=[3,6,7,10],i[10]=[3,6,7,9,4,5],i[11]=[12,1,2,6,7],i[12]=[2,6,7],i[6]=[7],i[7]=[],i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(26),r=n(8),o=n(16);function a(e,t,n,r){var o=JSON.stringify(e),a=JSON.parse(o);return a&&(s(e,a,t,i.pii.Omit),s(e,a,n,i.pii.Mri),s(e,a,r,i.pii.UserName)),JSON.stringify(a)}function s(e,t,n,i){n&&r.each(n,function(n){e[n]&&(t[n]=i(e[n]))})}t.scrubSignalingParticipant=function(e){return"id="+i.pii.Mri(e.id)+", participantId="+e.participantId},t.scrubITransferContext=function(e){return a(e,[],["transferorMri","targetMri"])},t.scrubAddParticipantPayload=function(e){var t="payload: ";if(e.participants){if(e.participants.from){var n=e.participants.from;t+="from: "+a(n,["id"],[],["displayName"])+", to: "}if(e.participants.to){var s=e.participants.to;r.each(s,function(e){var n=a(e,["id","assertedId"],[],["displayName"]);t+=n+", "})}}return e.threadId&&(t+="threadId: "+o.getLoggableThreadId(e.threadId)+", "),e.messageId&&(t+="messageId: "+e.messageId+", "),e.sipUri&&(t+="sipUri: "+e.sipUri+", "),e.participantInvitationData&&(t+="participantInvitationData: "+i.pii.Omit(e.participantInvitationData)+", "),e.links&&(t+="links: "+JSON.stringify(e.links)),e.alternateId&&(t+="alternateId: "+i.pii.Omit(e.alternateId)),t}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n(46).default);t.default=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(44),c=function(e){function t(t,n,i,r){var o=e.call(this,void 0,t,n)||this;return o.frameUris=i,o.imageRenderingSession=r,o.type=1,o.renderers=[],o.imageRendererId=0,o}return r(t,e),t.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})},t.prototype.stop=function(){return o(this,void 0,void 0,function(){return a(this,function(e){return this.dispose(),[2,Promise.resolve()]})})},t.prototype.start=function(e){return o(this,void 0,void 0,function(){var t,n=this;return a(this,function(i){return this.imageRenderingSession?(this.imageRendererId++,this.logger.info("Image stream start stream id:"+this.id+", imageRendererId: "+this.imageRendererId),t=new s.RemoteImageRenderer(this.imageRenderingSession,e,this.imageRendererId),this.renderers.push(t),[2,t.start(this.frameUris).catch(function(e){throw n.logger.error("Failed starting renderer, stream id:"+n.id+", imageRendererId: "+n.imageRendererId+": "+e),e}).then(function(){return n.isStreaming=!0,t})]):[2,Promise.reject("imageRenderingSession not passed, id: "+this.id)]})})},t.prototype.dispose=function(){var t=this;e.prototype.dispose.call(this),this.isStreaming=!1,this.renderers.forEach(function(e){try{e.dispose()}catch(e){t.logger.error("Failed disposing renderer, stream id:"+t.id+": "+e)}}),this.renderers=[]},t}(n(46).default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.type=1,o}return r(t,e),t}(n(84).default);t.default=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(15),l=n(35),u=n(11),d=n(77),p=n(78),f=n(40),h=function(e){function t(t,n,i,r,o,a,s,c){void 0===a&&(a="");var l=e.call(this)||this;return l.callTelemetry=t,l.signalingSession=i,l.contentSharingGuid=r,l.contentSharingIdentity=o,l.state=a,l.subject=s,l.handleOperationFailure=function(e,t,n){n.logFailure(e);var i=l.getTerminatedReasonFromError(e);return t.updateStatusTo&&(l.contentSharingStatus=t.updateStatusTo,l.rejectContentSharing(i)),Promise.reject(i)},l._logger=n.createChild(function(){return"[ContentSharingSession]["+l.contentSharingGuid+"]"}),l.contentSharingStatus=0,l.contentSharingTerminationReason=null,l.contentSharingState=a,l._callOperationHandler=new p.default(l._logger,l.callTelemetry),c&&(l.sessionId=c),l}return r(t,e),Object.defineProperty(t.prototype,"contentSharingStatus",{get:function(){return this.status},set:function(e){if(this._logger.info("[set contentSharingStatus][currentStatus="+this.status+"][newStatus="+e+"]"),this.callTelemetry.recordEvent(l.CONTENT_SHARING_OPERATIONS_INTERNAL.SET_CONTENT_SHARING_STATUS,{newStatus:e,oldStatus:this.status}),this.status!==e&&7!==this.status&&8!==this.status){if(this._logger.info("[set contentSharingStatus] Changing content sharing status to: "+e),this.status=e,7===this.status){var t={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"[set contentSharingStatus] Content sharing is disconnected"};this._callOperationHandler.maybeResolveOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING),this._callOperationHandler.rejectPendingOperations(t)}2!==this.status&&5!==this.status||(t={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Content sharing cannot be ended when not presenting"},this._callOperationHandler.maybeRejectOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,t)),3===this.status&&(this._callOperationHandler.maybeResolveOperation(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),this._callOperationHandler.maybeResolveOperation(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL)),this.raiseChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentSharingState",{get:function(){return this.state},set:function(e){this.state!==e&&(this.state=e,this.raiseChanged())},enumerable:!0,configurable:!0}),t.prototype.startContentSharing=function(e){var t=this;void 0===e&&(e=u.generateCauseId());var n=this._logger.createFnLogger(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING,e);if(0!==this.contentSharingStatus){var i="["+e+"][startContentSharing][failed][reason=InvalidState]",r={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return n.logFailure("state="+this.contentSharingStatus+", reason="+i),Promise.reject(r)}return this.signalingSession.startContentSharingAsync(this.contentSharingIdentity,this.contentSharingState,this.subject,this.contentSharingGuid,e).then(function(e){t.sessionId=e.sessionId,t.contentSharingStatus=3,t.presenterId=t.signalingSession.participantManager.localParticipant.id}).catch(function(i){return t.handleOperationFailure(i,{causeId:e,operation:l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING,updateStatusTo:8},n)}),this._callOperationHandler.waitForOperation(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING)},t.prototype.joinContentSharing=function(e){var t=this;void 0===e&&(e=u.generateCauseId());var n=this._logger.createFnLogger(l.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING,e);if(2!==this.contentSharingStatus){var i="["+e+"][joinContentSharing][failed][reason=InvalidState]",r={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return n.logFailure("state="+this.contentSharingStatus+", reason="+i),Promise.reject(r)}return this.signalingSession.joinContentSharingAsync(this.contentSharingGuid,e).then(function(e){return t.contentSharingStatus=4,t.contentSharingState=e.sessionState,t.presenterId=e.presenter,Promise.resolve()}).catch(function(i){return t.handleOperationFailure(i,{causeId:e,operation:l.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING,updateStatusTo:8},n)})},t.prototype.updateContentSharingSessionState=function(e,t,n){var i=this;void 0===n&&(n=u.generateCauseId());var r=this._logger.createFnLogger(l.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,n);if(3!==this.contentSharingStatus){var o="["+n+"][updateContentSharingSessionState][failed][reason=InvalidState]",a={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:o};return r.logFailure("state="+this.contentSharingStatus+", reason="+o),Promise.reject(a)}return this.signalingSession.updateContentSharingSessionStateAsync(this.contentSharingGuid,t,n).then(function(){return Promise.resolve()}).catch(function(t){return i.handleOperationFailure(t,{causeId:n,operation:l.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,operationId:e},r)})},t.prototype.takeContentSharingControl=function(e){var t=this;void 0===e&&(e=u.generateCauseId());var n=this._logger.createFnLogger(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL,e);if(5!==this.contentSharingStatus){var i="["+e+"][updateContentSharingSessionState][failed][reason=InvalidState]",r={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return n.logFailure("state="+this.contentSharingStatus+", reason="+i),Promise.reject(r)}return this.signalingSession.takeContentSharingControlAsync(this.contentSharingGuid,e).then(function(){t.contentSharingStatus=3,t.presenterId=t.signalingSession.participantManager.localParticipant.id}).catch(function(i){return t.handleOperationFailure(i,{causeId:e,operation:l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL},n)}),this._callOperationHandler.waitForOperation(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL)},t.prototype.updateContentSharingParticipantStateToViewer=function(e){var t=this;void 0===e&&(e=u.generateCauseId());var n=this._logger.createFnLogger(l.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE,e);if(4!==this.contentSharingStatus){var i="["+e+"][updateContentSharingSessionState][failed][reason=InvalidState]",r={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return n.logFailure("state="+this.contentSharingStatus+", reason="+i),Promise.reject(r)}return this.signalingSession.updateContentSharingParticipantStateAsync(this.contentSharingGuid,e).then(function(){return t.contentSharingStatus=t.presenterId===t.signalingSession.participantManager.localParticipant.id?3:5,Promise.resolve()}).catch(function(i){return t.handleOperationFailure(i,{causeId:e,operation:l.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE},n)})},t.prototype.stopContentSharing=function(e){var t=this;void 0===e&&(e=u.generateCauseId());var n=this._logger.createFnLogger(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,e);if(2===this.contentSharingStatus||4===this.contentSharingStatus||5===this.contentSharingStatus){var i="["+e+"][stopContentSharing][failed][reason=InvalidState]",r={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return n.logFailure("state="+this.contentSharingStatus+", reason="+i),Promise.reject(r)}return this.signalingSession.deleteContentSharingAsync(this.contentSharingGuid,e).then(function(){return t.contentSharingStatus=7,t._callOperationHandler.waitForOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING)}).catch(function(i){return t.handleOperationFailure(i,{causeId:e,operation:l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING},n)})},t.prototype.dispose=function(t){void 0===t&&(t=u.generateCauseId()),this._callOperationHandler.rejectPendingOperations({terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Call ended"},t),this.contentSharingStatus=7,this.contentSharingState="",e.prototype.dispose.call(this)},t.prototype.rejectContentSharing=function(e){if(void 0===e&&(e={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"[rejectContentSharing] Content sharing is disconnected"}),7!==this.status&&8!==this.status)throw new Error("Tried to reject content sharing with status="+this.status);this._callOperationHandler.maybeResolveOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING),this._callOperationHandler.rejectPendingOperations(e)},t.prototype.getTerminatedReasonFromError=function(e){var t=e&&e.endCode&&e.endCode.code||0,n={terminatedReason:32,terminatedReasonCode:t,terminatedReasonSubCode:e&&e.endCode&&e.endCode.subCode||0,errorMessage:e};switch(t){case f.jsCallEndCodes.NotFound:n.terminatedReason=34,n.errorMessage="Active session not found on server";break;case f.jsCallEndCodes.Forbidden:n.terminatedReason=8,n.errorMessage="Failed due to insufficient permissions"}return n},o([d.callOperation(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),s(0,d.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"startContentSharing",null),o([d.callOperation(l.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING),s(0,d.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"joinContentSharing",null),o([d.callOperation(l.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE),s(0,d.operationId),s(2,d.causeId),a("design:type",Function),a("design:paramtypes",[String,String,Object]),a("design:returntype",Promise)],t.prototype,"updateContentSharingSessionState",null),o([d.callOperation(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL),s(0,d.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"takeContentSharingControl",null),o([d.callOperation(l.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE),s(0,d.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"updateContentSharingParticipantStateToViewer",null),o([d.callOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,{waitFor:l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING}),s(0,d.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"stopContentSharing",null),t}(c.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9);t.hasSendDirectionality=i.hasSendDirectionality,t.hasReceiveDirectionality=i.hasReceiveDirectionality},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(11),c=function(e){function t(t){var n=e.call(this)||this;return n.mainChannel=null,n._state=1,n.logger=t.createChild("PluginlessDataChannel"),n}return r(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),t.prototype.registerSessionDataChannel=function(e,t){this.sessionDataChannel&&this.stop(t),this.sessionDataChannel=e,this.subscribeForSessionDataChannelEvents()},t.prototype.requestDataChannelHandler=function(e,t){return this.sessionDataChannel.getDataChannel(e,t)},t.prototype.sendUserEvents=function(e,t){return o(this,void 0,void 0,function(){var n;return a(this,function(i){return this.mainChannel?(n=t?t.map(function(e){return parseInt(e,10)}):[],this.mainChannel.sendMessage(e,n),[2]):(this.logger.info("sendUserEvents() no data channel available"),[2,Promise.reject("Main DataChannel is not active")])})})},t.prototype.start=function(e){this.mainChannel?this.logger.info("["+e+"] already started"):(this.logger.info("["+e+"] starting"),this.mainChannel=this.sessionDataChannel.getMainChannel(e),this.subscribeForMainDataChannelEvents())},t.prototype.stop=function(e){this.mainChannel&&(this.logger.info("["+e+"] stopping"),this.mainChannel.dispose(),this.mainChannel=null)},t.prototype.dispose=function(){this.stop(void 0),e.prototype.dispose.call(this)},t.prototype.subscribeForMainDataChannelEvents=function(){var e=this;this.mainChannel.on("onmessage",function(t,n){e.event("remoteUserEventsReceived").raise(n.toString(),t)})},t.prototype.subscribeForSessionDataChannelEvents=function(){var e=this;this.sessionDataChannel.on("onStateChanged",function(t){var n=s.generateCauseId();switch(t){case 1:e.start(n),e.setState(0);break;case 0:e.stop(n),e.setState(1);break;default:e.logger.warn("["+n+"] unhandled SessionDataChannelState "+t)}})},t.prototype.setState=function(e){this._state!==e&&(this._state=e,this.logger.info("PluginlessDataChannelState changed, state="+this._state),this.event("onDataChannelStateUpdated").raise(this._state))},t}(n(15).default);t.PluginlessDataChannel=c},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=function(){function e(e){this.logger=e,this.extensionId="nkeimhogjdpnpccoofpliimaahmaaome",this.editorExtensionId="ncbjelpjchkpbikbpkcchkhkblodoama",this.logId="WebRTCLogs",this.connectionCount=0}return e.prototype.changeCallState=function(e){return i(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,this.isExtensionAvailable()];case 1:return t.sent()?2!==e?[3,4]:0!==this.connectionCount?[3,3]:[4,this.startInternal()]:[2,void 0];case 2:t.sent(),t.label=3;case 3:this.connectionCount++,t.label=4;case 4:return 7!==e?[3,6]:(this.connectionCount--,0!==this.connectionCount?[3,6]:[4,this.stopInternal()]);case 5:t.sent(),t.label=6;case 6:return[2]}})})},e.prototype.collect=function(){return i(this,void 0,void 0,function(){var e=this;return r(this,function(t){switch(t.label){case 0:return[4,this.isExtensionAvailable()];case 1:return t.sent()?this.collectPromise?[2,this.collectPromise]:[2,this.collectPromise=new Promise(function(t){return i(e,void 0,void 0,function(){var e,n,i;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),(e=this.connectionCount>0)?[4,this.stopInternal()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.sendMessage(this.extensionId,{method:"logging.store",logId:this.logId})];case 3:return r.sent(),[4,this.gatherFromStorage()];case 4:return n=r.sent(),e&&this.startInternal(),t(n.length>0?n.join("\r\n"):""),[3,6];case 5:return i=r.sent(),this.logger.error("Error while collecting logs",i),t(JSON.stringify(i)),[3,6];case 6:return this.collectPromise=void 0,[2]}})})})]:[2,""]}})})},e.prototype.isExtensionAvailable=function(){return i(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:if(void 0!==this.isAvailable)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sendMessage(this.extensionId,{method:"isExtensionEnabled"})];case 2:return t.sent(),this.isAvailable=!0,[3,4];case 3:return e=t.sent(),this.logger.warn("Extension cannot be accessed",e),this.isAvailable=!1,[3,4];case 4:return[3,6];case 5:void 0===this.isAvailable&&(this.isAvailable=!1),t.label=6;case 6:return[2,this.isAvailable]}})})},e.prototype.startInternal=function(){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.sendMessage(this.extensionId,{method:"logging.start"})];case 1:return e.sent(),this.logger.info("Logging started"),[2]}})})},e.prototype.stopInternal=function(){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.sendMessage(this.extensionId,{method:"logging.stop"})];case 1:return e.sent(),this.logger.info("Logging stopped"),[2]}})})},e.prototype.gatherFromStorage=function(){return i(this,void 0,void 0,function(){var e,t;return r(this,function(n){switch(n.label){case 0:e=[],t={offset:0},n.label=1;case 1:return[4,this.sendMessage(this.editorExtensionId,{api:"getWebRtcLog",logId:this.logId,offset:t.offset})];case 2:t=n.sent(),e.push(t.data),this.logger.info("Batch gathered with offset: "+t.offset+", moreData: "+t.moreData),n.label=3;case 3:if(t.moreData)return[3,1];n.label=4;case 4:return this.logger.info("Finished gathering"),[2,e]}})})},e.prototype.sendMessage=function(e,t){return new Promise(function(n,i){var r=chrome.runtime;r.sendMessage(e,t,function(e){if(!e||e&&e.error){var o=e?JSON.stringify(e.error):r.lastError;i("sendMessage "+JSON.stringify(t)+" failed with error: "+o)}n(e)})})},e}();t.WebRtcInternalsCollector=a;var s,c={getInstance:function(e,t,n){return t&&t.getConfig().enableWebRtcInternalsLogs&&"EdgeAnaheim"===o.getBrowserInfo().name?(s||(s=new a(e)),function(e){var t=e.on("callStateChanged",function(){var n=e.state;s.changeCallState(n),7===n&&t.dispose()})}(n),s):(e.info("WebRTC internal logging is disabled"),{collect:function(){return Promise.resolve("")}})}};t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStreamInformation=function(e){var t=[];return e.forEach(function(e){try{var n=t.find(function(t){return t.participantId===e.participantId&&t.endpointId===e.endpointId});n||(n={participantId:e.participantId,endpointId:e.endpointId},t.push(n)),"audio"!==e.type&&"audioteleconference"!==e.type||(n.serverMuted=e.serverMuted),n[e.type]=e.direction}catch(e){t=[]}}),t}},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=n(0),c={Service:{url:"https://edge.skype.com/trap",tokenUrl:"https://edge.skype.com/trap/tokens",disabled:!1},Relay:{addresses:["13.107.8.2"],tcpPort:443,udpPort:3478,Lync:{addresses:["mr.skype.net"],fqdns:[],tcpPort:443,udpPort:3478},Skype:{addresses:["13.107.8.2"],fqdns:[],tcpPort:443,udpPort:3478},Turn:{addresses:["52.113.193.150"],fqdns:["eu.turn.teams.microsoft.com"],tcpPort:443,udpPort:3478,tlsPort:443,realm:"rtcmedia",url:"https://eu.turn.skype.com/relay"}},Token:{earlyRefreshMinutes:60,earlyRefreshPercentage:50}};function l(e){return{expires:e.expires,username:e.username,password:e.password,realm:e.realm}}var u=function(){function e(){this.reports={}}return e.prototype.watch=function(e){var t={time:Date.now(),duration:-1};return this.reports[e]&&(e+="_last"),this.reports[e]=t,{end:function(e){e?t.error=e:t.duration=Date.now()-t.time}}},e.prototype.getReports=function(){return this.reports},e}(),d=function(){function e(e){this.updateRelaysPromise=null,this.config=a.cloneDeep(c),this.trapTokens={},this.timers=new u,this.context=e,this.logger=e.logger.createChild("RM"),this.request=e.request}return e.prototype.initialize=function(){this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync(!0))},e.prototype.queryRelaysAsync=function(e){return void 0===e&&(e={}),r(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:return this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync()),[4,this.updateRelaysPromise];case 1:return t=n.sent(),!e.useTurnRedirector&&this.config.Relay.Turn.realm?[3,3]:[4,this.fetchTurnRelayAddresses(e.relayType,t,e.turnRedirectorTimeout)];case 2:t=n.sent(),n.label=3;case 3:return t?"turn"===e.relayType?[2,t.Turn]:[2,e.isRemoteClientLync?t.Lync:t.Skype]:[2,[]]}})})},e.prototype.getStats=function(){return this.timers.getReports()},e.prototype.fetchTurnRelayAddresses=function(e,t,n){var i=this;if("turn"===e){var r=this.config.Relay.Turn.url,o=this.timers.watch("turnRelayFetch");return this.request.get(r,{timeout:n}).then(function(e){o.end();var n=e.response,r=t.Turn[0];return r.addresses=n.relay?[n.relay]:[],r.fqdns=n.fqdn?[n.fqdn]:[],n.transports&&n.transports.forEach(function(e){var t=e.transport;"udp"===t?r.udpPort=e.port:"tcp"===t?r.tcpPort=e.port:"tls"===t&&(r.tlsPort=e.port)}),a.assign(r,l(i.getTrapToken(n.realm))),Promise.resolve(t)}).catch(function(e){var n="Error: "+i.parseErrorMessage(e);return o.end(n),i.logger.error("failed to retreive turn relay addresses",i.parseErrorMessage(n)),Promise.resolve(t)})}return Promise.resolve(t)},e.prototype.parseErrorMessage=function(e){return e?e.message?"status: "+e.status+" with "+e.message:e.response?"status: "+e.status+" with "+s.stringifyObject(e.response):"status: "+e.status+" with no message":"unknown error"},e.prototype.updateRelaysFromConfigAsync=function(e){var t=this;void 0===e&&(e=!1);var n=this.getConfigAsync().then(function(){return t.updateRelaysAsync()}).then(function(e){return t.updateRelaysPromise=n,e}).catch(function(n){return t.updateRelaysPromise=null,e?t.logger.warn("failed to retrieve relays",s.stringifyObject(n)):t.logger.error("failed to retrieve relays",s.stringifyObject(n)),null});return n},e.prototype.refreshRelaysFromConfig=function(){this.request.isOnline()?this.updateRelaysFromConfigAsync():(this.updateRelaysPromise=null,this.logger.warn("not refreshing relays due to no network connection"))},e.prototype.updateRelaysAsync=function(){var e,t=this,n=this.config.Service.tokenUrl;return(this.context.trapTokenCredentialsProvider?function(){return r(t,void 0,void 0,function(){return o(this,function(t){return e=this.timers.watch("trapTokenFetch"),[2,this.context.trapTokenCredentialsProvider()]})})}:function(){return r(t,void 0,void 0,function(){var t,i,r;return o(this,function(o){switch(o.label){case 0:t=this.timers.watch("skypeTokenFetch"),i="",o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.context.tokenProvider()];case 2:return i=o.sent(),[3,4];case 3:throw r=o.sent(),t.end(""+r),r;case 4:return t.end(),e=this.timers.watch("trapTokenFetch"),[4,this.request.get(n,{headers:{"X-Skypetoken":i,"api-version":2}})];case 5:return[2,o.sent().response]}})})})().then(function(n){e.end();var r,o=t.config.Token.earlyRefreshMinutes,a=t.config.Token.earlyRefreshPercentage;t.storeTrapTokens(n),r=Math.max(n.expires-60*o,n.expires*a/100),setTimeout(t.refreshRelaysFromConfig.bind(t),1e3*r);var s=t.config.Relay.Turn.realm?t.config.Relay.Turn.realm:'"rtcmedia"',c=l(t.getTrapToken(s)),u={Skype:[i({addresses:t.config.Relay.Skype.addresses,fqdns:t.config.Relay.Skype.fqdns,tcpPort:t.config.Relay.Skype.tcpPort,udpPort:t.config.Relay.Skype.udpPort,type:"msturn"},c)],Lync:[i({addresses:t.config.Relay.Lync.addresses,fqdns:t.config.Relay.Lync.fqdns,tcpPort:t.config.Relay.Lync.tcpPort,udpPort:t.config.Relay.Lync.udpPort,type:"msturn"},c)],Turn:[i({addresses:t.config.Relay.Turn.addresses,fqdns:t.config.Relay.Turn.fqdns,tcpPort:t.config.Relay.Turn.tcpPort,udpPort:t.config.Relay.Turn.udpPort,tlsPort:t.config.Relay.Turn.tlsPort,type:"turn"},c)]};return t.logger.info("relays from trap",u),u}).catch(function(t){throw e&&e.end(""+t),t})},e.prototype.storeTrapTokens=function(e){if(e&&e.tokens){var t={};e.tokens.forEach(function(n){t[n.realm]={expires:e.expires,username:n.username,password:n.password,realm:n.realm}}),this.trapTokens=t}else this.logger.error("failed to get tokens from trap response")},e.prototype.getTrapToken=function(e){if("string"==typeof e){var t=e.replace(/^"|"$/g,""),n='"'+t+'"',i=this.trapTokens[n]||this.trapTokens[t];if(i)return i}throw new Error("token for relay not found, realm: "+e)},e.prototype.getConfigAsync=function(){var e=this;this.logger.info("retrieving configuration");var t=this.timers.watch("configFetch");return this.context.configProvider().then(function(n){t.end(),e.logger.info("retrieved configuration:",n),e.config=a.cloneDeep(c),a.mergeWith(e.config,n,function(t,n){if(a.isArray(n))return n.map(function(t){var n=a.trim(t);return t!==n&&e.logger.warn("MDN_TRAP config got santizied '"+t+"'->'"+n+"'"),n})}),e.logger.info("applied configuration:",e.config)}).catch(function(n){e.logger.warn("failed to retrieve configuration",n),t.end(""+n)})},e}();t.RelayManager=d,t.build=function(e){return new d(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=n(19),o=n(273),a=n(27),s=n(48),c=function(){function e(e){try{this.mediaAgentFactory=r.MediaAgent}catch(e){throw new s.MediaAgentError(""+e)}if(!this.mediaAgentFactory||!a.UserAgentConfig.hasMediaApi())throw new s.MediaAgentError(e+" not supported by browser provider","not_supported")}return e.prototype.build=function(e,t){i.defaults(t,{logger:new o.default,tokenProvider:function(){return Promise.resolve("")},relayConfigProvider:function(){},settings:{},domOverrides:{}});var n={getLogger:function(){return t.logger},getSafeLogger:function(){return t.safeLogger},getRelayManager:function(){return t.relayManager},domOverrides:t.domOverrides,settings:i.defaults(t.settings,{enableReconnectChrome:!0,enableReconnectEdge:!0,ortcVideoRendererAggressiveStreamRefresh:!0,renegotiationAttempts:3,iceDisconnectedTimeoutMs:3e4,webrtcVideoCapabilityMaxFS:1200,webrtcVideoCapabilityMaxFPS:3e3,webrtcScreensharingCapabilityMaxFS:8160,webrtcScreensharingCapabilityMaxFPS:1500,webrtcVideoCapabilityCheckIntervalMin:2e4,webrtcVideoCapabilityCheckIntervalMax:3e4,webrtcScreensharingCapabilityCheckIntervalMin:0,webrtcScreensharingCapabilityCheckIntervalMax:0,enableLocalVideoConstraints:!0,webrtcAudioChannelSignalingFeedback:"app recv:dsh",webrtcVideoChannelSignalingFeedback:"app send:src recv:src,vc",webrtcNativeCpuOveruseDisabled:!0,webrtcResolutionManagerCooldownTimeout:15e3,webrtcResolutionManagerRetryDelay:5e3,webrtcMultiPartyVideoScaling:!0,activeSpeaker:{timeToPromote:3e3}})},r=this.mediaAgentFactory.build(n,e);return r.constants=this.mediaAgentFactory.constants,r},e}();t.default=c;var l=function(){return!!s.default&&(s.default.getInstance().register(function(e){return new c(e)}),!0)||setTimeout(l,0)};l()},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=n(8),c=n(14),l=n(167),u=n(168),d=n(169),p=n(171),f=n(173),h=n(0),g=n(174),m=n(2),v=n(176),y=n(9),S=n(205),_=n(206),E=n(223),T=n(225),C=n(262),I=function(){function e(e,t){var n=this;this.context=e,this.deviceManagerObserver=t,this.logger=new S.default(this.context.getSafeLogger&&this.context.getSafeLogger().createChild("MA",void 0,this.context.settings.debug),this.context.getLogger().createChild("MA",void 0,this.context.settings.debug)),this.configProvider=new g.default(this.logger,this.context.settings),this.ufdManager=new f.UFDManager(this.logger.createChild("UFD"),this.configProvider),this.deviceManager=new v.default(this.logger.createChild("DeviceManager"),this.configProvider,this.context.domOverrides,this.ufdManager),this.activeSessions=[],this.capabilities=new l.default(this.configProvider),this.pendingDeviceTelemetryEvents=[],this.callsCount=0,this.mediaConfig={},this.configProvider.on("configUpdated",function(){return n.configApplied()}),this.context.configProvider=this.configProvider,this.deviceManager.on("onDevicesChanged",function(e){return n.onDevicesChanged(e)}),this.deviceManager.on("onDeviceTelemetryEvent",function(e){return n.onDeviceTelemetryEvent(e)})}return e.prototype.createSession=function(e,t,n){var i=this;this.mergeMediaConfig();var r=this.logger,o={getDeviceManager:function(){return i.getDeviceManager()},getLogger:function(){return r},getUfdManager:function(){return i.ufdManager},maContext:this.context,config:n||{},configProvider:this.configProvider},a=("Edge"===c.getBrowserInfo().name?_.default:this.configProvider.config.webrtcSimulcastSessionEnabled?C.default:T.default).build(o,t,e),s=new E.default(this.configProvider,++this.callsCount);s.setMediaQosEnabled(!!this.mediaConfig.enableMediaQoS),s.setPortRangeConfigured(!!this.mediaConfig.mediaPortRanges);var l=function(){if((n.isConference&&i.configProvider.config.enableReconnectImprovementsMultiparty||!n.isConference&&i.configProvider.config.enableReconnectImprovements1on1)&&"Edge"!==c.getBrowserInfo().name){var r=new p.default(a,t,o,e,s,i.configProvider);return r.on("onTerminated",function(e){return i.onSessionTerminated(e)}),r}var l=new d.default(a,t,o,e,s,i.configProvider);return l.on("onTerminated",function(e){return i.onSessionTerminated(e)}),l}();for(this.activeSessions.push(l),this.configProvider.updateSessionCount(this.activeSessions.length);this.pendingDeviceTelemetryEvents.length>0;)l.registerDeviceTelemetryEvent(this.pendingDeviceTelemetryEvents.pop());return l},e.prototype.getDeviceManager=function(){return this.deviceManager},e.prototype.getCapabilities=function(){return this.capabilities},e.prototype.getScreenSharingManager=function(){return new u.ScreenSharingManager},e.prototype.updateConfig=function(e,t,n){this.configProvider.updateConfig(e,t,n)},e.prototype.getConfig=function(){return this.configProvider.config},e.prototype.getConfigProvider=function(){return this.configProvider},e.prototype.setMediaConfig=function(e){s.merge(this.mediaConfig,e)},e.prototype.dispose=function(e){var t=this;return Promise.all(a([this.deviceManager.dispose(),this.capabilities.dispose()],this.activeSessions.map(function(n){return i(t,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,n.terminate(e,{}).catch(h.noop)];case 1:return t.sent(),n.dispose(),[2]}})})}))).then(h.noop,h.noop)},e.prototype.mergeMediaConfig=function(){this.configProvider.mediaConfig.maxBandwidthInKbps=Math.floor((this.mediaConfig.maxBandwidthInBps||0)/1e3),this.configProvider.mediaConfig.isTransportUnbundled=this.configProvider.config.forceUnbundledTransport||this.configProvider.config.enableQosSupport&&(this.mediaConfig.enableMediaQoS||!!this.mediaConfig.mediaPortRanges),this.configProvider.mediaConfig.setMediaPortRanges(this.mediaConfig.mediaPortRanges)},e.prototype.configApplied=function(){window&&(this.configProvider.config.enableDevtoolsAPI?window.webMA||this.injectDevtoolsAPI():window.webMA&&delete window.webMA)},e.prototype.injectDevtoolsAPI=function(){var e=this;window.webMA={config:{addOverride:function(t,n){return e.configProvider.setConsoleOverride(t,n)},clearOverride:function(t){return e.configProvider.clearConsoleOverride(t)},clearAllOverrides:function(){return e.configProvider.clearAllConsoleOverrides()}}}},e.prototype.onDevicesChanged=function(e){var t=this.deviceManager.getDeviceDescriptions(e);this.deviceManagerObserver.onDevicesChanged(t)},e.prototype.onDeviceTelemetryEvent=function(e){this.activeSessions.length>0?this.activeSessions.forEach(function(t){return t.registerDeviceTelemetryEvent(e)}):this.pendingDeviceTelemetryEvents.push(e)},e.prototype.onSessionTerminated=function(e){h.remove(this.activeSessions,function(t){return t===e}),this.configProvider.updateSessionCount(this.activeSessions.length),0===this.activeSessions.length&&this.ufdManager.reset()},e}(),A=function(){function e(){}return e.build=function(e,t){return new I(e,t)},e.constants=m.default,e.helper=y,e}();t.default=A},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(12),r=function(){function e(e){var t=this;this.configProvider=e,this.window=i.default.window,this.updateCapabilityOverrides(),this.configProviderSub=e.on("configUpdated",function(){return t.updateCapabilityOverrides()})}return Object.defineProperty(e.prototype,"audio",{get:function(){return this.getCapability("audio")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this.getCapability("video")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screensharing",{get:function(){return this.getCapability("screensharing")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retargeting",{get:function(){return this.getCapability("retargeting")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.configProviderSub&&this.configProviderSub.dispose()},e.prototype.updateCapabilityOverrides=function(){var e;this.configProvider.config.capabilities&&(this.hasOrtc()?e=this.configProvider.config.capabilities.ortc:this.hasWebRtc()&&(e=this.configProvider.config.capabilities.webrtc)),this.overrides=e||{}},e.prototype.hasMediaCapture=function(){return!!this.window.navigator.getUserMedia},e.prototype.getCapability=function(e){return void 0!==this.overrides[e]?!!this.overrides[e]:this.hasMediaCapture()&&(this.hasOrtc()||this.hasWebRtc())},e.prototype.hasWebRtc=function(){return void 0!==this.window.RTCPeerConnection},e.prototype.hasOrtc=function(){return void 0!==this.window.RTCIceGatherer},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.getId=function(){return 0},e.prototype.getDeviceId=function(){return String(0)},e.prototype.getPreviewAsync=function(e,t){return Promise.resolve(null)},e.prototype.getDescription=function(){return"display"},e.prototype.getType=function(){return 1},e.prototype.getIcon=function(e,t){return Promise.resolve(null)},e}(),r=function(){function e(){this.sharingSource=new i}return e.prototype.onScreensChanged=function(e){return{dispose:function(){}}},e.prototype.enumerateScreensAsync=function(){return Promise.resolve([this.sharingSource])},e.prototype.enumerateWindowsAsync=function(){return Promise.resolve([])},e.prototype.enumerateCamerasAsync=function(){return Promise.resolve([])},e}();t.ScreenSharingManager=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var c=n(11),l=n(19),u=n(85),d=n(86),p=n(6),f=n(170),h=n(88),g=n(0),m=function(e){function t(t,n,i,r,o,a){var s,c=e.call(this)||this;c.context=i,c.callback=r,c.statistics=o,c.configProvider=a,c.audioStreamStates=((s={})[l.Constants.STREAMING_STATE.inactive]=[l.Constants.STREAMING_STATE.active,l.Constants.STREAMING_STATE.failed],s[l.Constants.STREAMING_STATE.active]=[l.Constants.STREAMING_STATE.removed,l.Constants.STREAMING_STATE.stopped,l.Constants.STREAMING_STATE.failed],s),c.rejectedNegotiations=0,c.negotiationState=null,c.iceDisconnectedRetried=!1,c.audioStreamState=l.Constants.STREAMING_STATE.inactive,c.deviceManagerDisposables=[],c.logger=i.getLogger().createChild("Session",n),c.ufdManager=i.getUfdManager(),c.ufdManagerDisposable=c.ufdManager.on("onQualityChanged",function(e){return c.qualityChanged(e)}),c.mediaLegId=new u.default,c.sessionOperationQueue=new h.default(c.logger),c.statistics.setId(n),c.statistics.setETag(c.configProvider.ETag),c.configUpdateDisposable=c.configProvider.on("configUpdated",function(){return c.statistics.setETag(c.configProvider.ETag)}),c.recoverableErrors=c.configProvider.config.recoverableMediaErrors.split(","),i.config.isConference&&c.statistics.setMultiParty();var d=c.getSessionCallbacks();t.callbacks=d,t.relayManagerProvider=c;var p=c.getReconnectManagerCallbacks();return c.reconnectManager=new f.default(t,i,c.statistics,c.sessionOperationQueue,p,d),c.deviceManager=c.context.getDeviceManager(),c.deviceManagerDisposables.push(c.deviceManager.on("onDevicesPermissionChanged",function(){return c.devicePermissionsChanged()})),c.deviceManagerDisposables.push(c.deviceManager.on("onSelectedDevicesChanged",function(){return c.deviceSelectionChanged()})),c.deviceManagerDisposables.push(c.deviceManager.on("onDevicesChanged",function(){return c.deviceListChanged()})),c.deviceManagerDisposables.push(c.deviceManager.on("onMaxVideoSendCapabilitiesChanged",function(e,t){return c.onMaxVideoSendCapabilitiesChanged(e,t)})),c.statistics.setDevicesCount(c.deviceManager.getDevicesCount()),c.ufdManager.applyCurrentState(function(e){return c.qualityChanged(e)}),c}return r(t,e),t.prototype.createOfferAsync=function(e){var t=this;return this.sessionOperationQueue.queueOperation(function(){return t.statistics.negotiation.offering.started(),t.getCurrentSession().createOfferAsync(e).then(function(e){return t.updateSelectedDevices(),e.mediaLegId=t.mediaLegId.process(e.mediaLegId),t.reconnectManager.isReconnecting()&&(t.statistics.registerRetargetOutgoing(),e.newOffer=!0),e}).catch(function(e){throw t.statistics.setError(e),e})}).then(function(e){return e})},t.prototype.processOfferAsync=function(e,t){var n=this;return this.sessionOperationQueue.queueOperation(function(){return n.statistics.negotiation.answering.started(),n.mediaLegId.process(e.mediaLegId),(e.newOffer?n.reconnectManager.acceptReconnectStartAsync(e.escalationOccurring,t):Promise.resolve()).then(function(){return n.getCurrentSession().processOfferAsync(e,t)}).then(function(i){return e.newOffer?n.reconnectManager.acceptReconnectFinish(t).then(function(){return i}):Promise.resolve(i)}).catch(function(e){throw n.statistics.setError(e),e})})},t.prototype.processAnswerAsync=function(e,t,n){var i=this;return new Promise(function(r){return r(i.getCurrentSession().processAnswerAsync(e,t,n))}).catch(function(e){throw i.statistics.setError(e),e})},t.prototype.completeNegotiationAsync=function(e){var t=this;return this.rejectedNegotiations=0,this.getCurrentSession().completeNegotiationAsync(e).then(function(n){return t.negotiationState=n,t.statistics.setFinalAnswerTimestamp((new Date).getTime()),t.statistics.negotiation.current.completed(),t.reconnectManager.onNegotiationCompletedAsync(e)}).then(function(){return t.sessionOperationQueue.completeCurrentOperation(),t.negotiationState}).catch(function(e){throw t.statistics.setError(e),e})},t.prototype.registerReconnectRejection=function(){this.rejectedNegotiations++,this.statistics.negotiation.current.rejected()},t.prototype.isReconnectRetryAllowed=function(){return this.rejectedNegotiations<this.context.configProvider.config.renegotiationAttempts},t.prototype.rejectNegotiationAsync=function(e,t){var n=this;this.logger.safe.info("["+t+"] rejectNegotiationAsync",e),this.registerReconnectRejection();var i=this.isReconnectRetryAllowed()&&this.isRetriableError(e);return this.reconnectManager.reset(),(this.reconnectManager.isReconnecting()?this.reconnectManager.onNegotiationRejectedAsync(e,i,t).then(function(){return n.negotiationState}):this.getCurrentSession().rejectNegotiationAsync(e,t,i)).then(function(e){return n.negotiationState=e,n.sessionOperationQueue.completeCurrentOperation(),e}).catch(function(e){throw n.statistics.setError(e),e})},t.prototype.completeEscalationAsync=function(e){return this.reconnectManager.completeReconnect(e)},t.prototype.rejectEscalationAsync=function(e,t){return this.reconnectManager.rejectReconnect(t)},t.prototype.terminate=function(e,t){return o(this,void 0,void 0,function(){var n,i,r,o=this;return a(this,function(a){switch(a.label){case 0:return i=(n=this.statistics).setPermissionStates,[4,this.deviceManager.getKnownPermissionStates()];case 1:return i.apply(n,[a.sent()]),this.statistics.terminated(t),r=function(){return o.cleanUp()},[2,this.reconnectManager.terminateAsync(e).then(r,r)]}})})},t.prototype.getStatsAsync=function(){var e=this;return this.getMainSession().getStatsAsync().then(function(t){return e.prepareStats(t)})},t.prototype.getLastKnownStats=function(){return this.prepareStats(this.getMainSession().getLastKnownStats())},t.prototype.prepareStats=function(e){return this.statistics.setDeviceList(this.deviceManager.getDeviceDescriptions(),this.deviceManager.getDeviceListDebugInfo()),this.statistics.setRelayManagerTimers(this.getRelayManager().getStats()),this.statistics.generateStatistics(e,this.mediaLegId)},t.prototype.createAnswerAsync=function(e,t){var n=this;return this.getCurrentSession().createAnswerAsync(e,t).then(function(e){return n.updateSelectedDevices(),e.mediaLegId=n.mediaLegId.process(e.mediaLegId),e}).catch(function(e){throw n.statistics.setError(e),e})},t.prototype.configureModalitiesAsync=function(e,t){return g.forOwn(e,function(t,n){t||delete e[n]}),this.reconnectManager.configureModalitiesAsync(e,t)},t.prototype.getAllowedModalities=function(){return this.deviceManager.getAllowedModalities()},t.prototype.createRemoteRenderer=function(e){return this.getMainSession().createRemoteRenderer(e)},t.prototype.sendDtmf=function(e){var t=this;return this.getMainSession().sendDtmf(e).then(function(e){return t.statistics.dtmfResult(!0),e}).catch(function(e){throw t.statistics.dtmfResult(!1),e})},t.prototype.canSendDtmf=function(){return this.reconnectManager.canSendDtmf()},t.prototype.getExtensionsManager=function(){return this.reconnectManager.getExtensionsManager()},t.prototype.muteInputTypeAsync=function(e,t){return this.reconnectManager.muteInputTypeAsync(e,t)},t.prototype.unmuteInputTypeAsync=function(e,t){return this.reconnectManager.unmuteInputTypeAsync(e,t)},t.prototype.muteInputAsync=function(e){return this.statistics.setSwMute(!0),this.ufdManager.setSwMute(!0),this.reconnectManager.muteInputAsync(e)},t.prototype.unmuteInputAsync=function(e){return this.statistics.setSwMute(!1),this.ufdManager.setSwMute(!1),this.reconnectManager.unmuteInputAsync(e)},t.prototype.muteOutputAsync=function(e){return this.statistics.setSpeakerMute(!0),this.reconnectManager.muteOutputAsync(e)},t.prototype.unmuteOutputAsync=function(e){return this.statistics.setSpeakerMute(!1),this.reconnectManager.unmuteOutputAsync(e)},t.prototype.getAcceptedTypes=function(){return this.reconnectManager.getCurrentSession().getAcceptedTypes()},t.prototype.createAudioElement=function(e){this.getCurrentSession().createAudioElement(e)},t.prototype.deviceSelectionChanged=function(){this.updateSelectedDevices(),this.reconnectManager._deviceSelectionChanged()},t.prototype.deviceListChanged=function(){this.deviceManager.isPollingInProgress&&this.statistics.deviceChangedByPoll(),this.statistics.devicesChanged(),this.statistics.setDevicesCount(this.deviceManager.getDevicesCount())},t.prototype.qualityChanged=function(e){this.callback&&this.callback.onQualityChanged&&(this.statistics.registerQualityStateChangedEvent(e),"DeviceSpeakWhileMuted"===e.type&&this.statistics.setSpeakingState("Good"===e.value),this.callback.onQualityChanged(e))},t.prototype.onMaxVideoSendCapabilitiesChanged=function(e,t){this.reconnectManager.getCurrentSession().onMaxVideoSendCapabilitiesChanged(e,t)},t.prototype.devicePermissionsChanged=function(){this.statistics.setSendModalities(this.getAllowedModalities())},t.prototype.registerDeviceTelemetryEvent=function(e){this.getCurrentSession().onDeviceEvent(e),this.statistics.registerDeviceTelemetryEvent(e)},t.prototype.reconnectAsync=function(e,t){return void 0===t&&(t=!1),this.reconnectManager.reconnectAsync(e,t)},t.prototype.isReconnecting=function(){return this.reconnectManager.isReconnecting()},t.prototype.getRelayManager=function(){return this.relayManager||(this.relayManager=new d.default(this.context.maContext.getRelayManager(),this.statistics))},t.prototype.cleanUp=function(){this.callback=null,this.configUpdateDisposable.dispose(),this.deviceManagerDisposables.forEach(function(e){return e.dispose()}),this.ufdManagerDisposable.dispose()},t.prototype.updateSelectedDevices=function(){var e=this,t=this.deviceManager.getSelectedDevices(),n=function(t){return t?e.deviceManager.getDeviceNameAsync(t).then(function(t){return g.scrubDeviceLabelPii(t,e.configProvider.config.devices.piiSafeWords)||"unknown"}):Promise.resolve("none")};Promise.all([n(t.microphone),n(t.speaker),n(t.camera)]).then(function(t){var n=s(t,3),i=n[0],r=n[1],o=n[2];e.statistics.setUsedDevices({microphone:i,speaker:r,camera:o})})},t.prototype.isRetriableError=function(e){return l.Constants.RENEGOTIATION_ERROR.signaling===e||l.Constants.RENEGOTIATION_ERROR.media===e},t.prototype.getCurrentSession=function(){return this.reconnectManager.getCurrentSession()},t.prototype.getMainSession=function(){return this.reconnectManager.getMainSession()},t.prototype.setAudioStreamState=function(e,t){void 0===t&&(t=c.generateCauseId()),this.isAudioStateValid(e)?this.raiseAudioStateChanged(e,t):this.logger.safe.error("["+t+"] audio state transition is invalid: "+this.audioStreamState+" -> "+e)},t.prototype.isAudioStateValid=function(e){return this.audioStreamStates[this.audioStreamState].indexOf(e)>=-1},t.prototype.raiseAudioStateChanged=function(e,t){if(this.logger.safe.info("["+t+"] audio state changed to "+e),this.callback.onAudioStateChanged){var n={content:"audio",direction:"receive",stream:e};this.callback.onAudioStateChanged(n)}},t.prototype.getReconnectManagerCallbacks=function(){var e=this;return{onSessionErrorOccurred:function(t,n){e.setAudioStreamState(l.Constants.STREAMING_STATE.failed),e.callback.onSessionErrorOccurred&&(e.callback.onSessionErrorOccurred(t,n),e.iceDisconnectedRetried&&e.isNetworkMediaError(t)&&e.ufdManager.raisePendingWhitelistingUFD())}}},t.prototype.isNetworkMediaError=function(e){return e.type===l.Constants.MEDIA_ERROR.iceConnectionError||e.type===l.Constants.MEDIA_ERROR.noNetworkError},t.prototype.isRecoverableMediaError=function(e){return this.recoverableErrors.indexOf(e.type)>-1},t.prototype.startReconnect=function(e){return void 0===e&&(e=c.generateCauseId()),this.iceDisconnectedRetried=!0,this.reconnectManager.onIceDisconnect(e)},t.prototype.getSessionCallbacks=function(){var e=this;return{onTerminated:function(){e.event("onTerminated").raise(e)},onSessionErrorOccurred:function(t,n){if(e.getCurrentSession().isReconnectSupported()&&e.isRecoverableMediaError(t)&&!e.iceDisconnectedRetried)return e.startReconnect(n);if(e.iceDisconnectedRetried){var i=e.reconnectManager.rejectReconnect(n);if(e.registerReconnectRejection(),e.isReconnectRetryAllowed()&&e.isRecoverableMediaError(t))return i.then(function(){return e.reconnectAsync(n)});e.isNetworkMediaError(t)&&e.ufdManager.raisePendingWhitelistingUFD()}return e.setAudioStreamState(l.Constants.STREAMING_STATE.failed,n),e.callback.onSessionErrorOccurred(t,n),e.statistics.setError(t),Promise.resolve()},onNegotiationRequired:function(t){return e.callback.onNegotiationRequired(t)},onAudioHwSilentChanged:function(t){e.statistics.setHwSilent(t)},onAudioStateChanged:function(t){e.setAudioStreamState(t)},onTransportConnected:function(t){void 0===t&&(t=c.generateCauseId()),e.logger.safe.info("["+t+"] Transport connectivity established"),e.reconnectManager.onTransportConnected(e.iceDisconnectedRetried,t),e.iceDisconnectedRetried=!1,e.ufdManager.cancelPendingWhitelistingUFD(),e.statistics.registerTransportConnected(),e.statistics.setIceConnectedStateTimestamp((new Date).getTime())},onTransportDisconnected:function(t){return void 0===t&&(t=c.generateCauseId()),e.logger.safe.warn("["+t+"] Transport connectivity lost"),e.reconnectManager.onTransportDisconnect(t),e.statistics.registerTransportDisconnected(),e.getCurrentSession().isReconnectSupported()&&e.configProvider.config.reconnectOnDisconnect?e.startReconnect(t):Promise.resolve()},onTransportFailed:function(){e.statistics.registerTransportFailed()},onTransportInitialized:function(){e.statistics.setIceInitTimestamp((new Date).getTime())},onScreenSharingIncomingDecoderFailed:function(){e.statistics.registerSSIncomingDecoderFailed()},onScreenSharingIncomingDecoderActive:function(){e.statistics.registerSSIncomingDecoderActive()},onScreenSharingIncomingDecoderReset:function(){e.statistics.registerSSIncomingDecoderReset()}}},t}(p.default);t.default=m},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),o=n(2),a=n(0),s=(n(19),n(87)),c=function(){function e(e,t,n,i,r,o){this.session=e,this.statistics=n,this.sessionOperationQueue=i,this.callback=r,this.sessionCallbacks=o,this.allowUFD=!1,this.reconnectGlare=!1,this.escalationType=0,this.logger=t.getLogger().createChild("reconnectManager"),this.settings=t.configProvider.config,this.ufdManager=t.getUfdManager(),this.session.callbacks=o,this.reconnectManagerMessageQueue=new s.default(o)}return e.prototype.getCurrentSession=function(){return this.reconnectSession||this.session},e.prototype.getMainSession=function(){return this.session},e.prototype.getReconnectSession=function(){return this.reconnectSession},e.prototype.onIceDisconnect=function(e){return this.logger.safe.info("["+e+"] reconnect attempt after iceDisconnect error"),this.allowUFD&&this.raiseReconnectEvent("Bad",e),this.isReconnecting()?Promise.resolve():(this.statistics.registerReconnectAttempted(),this.reconnectAsync(e))},e.prototype.onTransportDisconnect=function(e){this.allowUFD&&this.raiseConnectivityLostUFD(e)},e.prototype.onTransportConnected=function(e,t){e&&this.statistics.registerReconnectConnected(),this.allowUFD&&(this.raiseReconnectEvent("Good",t),clearTimeout(this.losingConnectivityTimer)),this.allowUFD=!0},e.prototype.onNegotiationCompletedAsync=function(e){return this.glareTimer&&(clearTimeout(this.glareTimer),this.glareTimer=null),this.isReconnecting()?(this.reconnectGlare=!1,this.statistics.registerRetargetCompleted(),2===this.escalationType?Promise.resolve():this.completeReconnect(e)):(this.reconnectGlare&&(this.reconnectGlare=!1,this.reconnectAsync(e)),Promise.resolve())},e.prototype.onNegotiationRejectedAsync=function(e,t,n){var i=this;this.statistics.registerRetargetRejected();var r=1===this.escalationType;return this.rejectReconnect(n).then(function(){t?i.reconnectAsync(n,r):e===o.default.RENEGOTIATION_ERROR.glare?(i.reconnectGlare=!0,i.glareTimer=window.setTimeout(function(){i.callback.onSessionErrorOccurred({type:o.default.MEDIA_ERROR.iceConnectionError,detail:"Reconnect failed, error - "+a.stringifyObject(e)},n)},i.settings.reconnectGlareCallDropTimeout||1e4)):i.callback.onSessionErrorOccurred({type:o.default.MEDIA_ERROR.iceConnectionError,detail:"Reconnect failed, error - "+a.stringifyObject(e)},n)})},e.prototype.reconnectAsync=function(e,t){var n=this;return void 0===t&&(t=!1),this.logger.safe.info("["+e+"] queueing reconnect, escalation="+t),this.statistics.registerReconnectAttempt(t?"local escalation":"out"),t&&(this.escalationType=1),this.sessionOperationQueue.queueOperation(function(){return n.logger.safe.info("["+e+"] starting reconnect"),n.initReconnect(0!==n.escalationType,e).then(function(){return n.reconnectSession.configureModalitiesAsync(n.session.getConfiguredModalities(),e)}).then(function(){n.sessionOperationQueue.completeCurrentOperation()})})},e.prototype.acceptReconnectStartAsync=function(e,t){return this.logger.safe.info("["+t+"] accepting reconnect"),this.statistics.registerRetargetIncoming(),e&&(this.escalationType=2,this.statistics.registerEscalationStart()),this.initReconnect(e,t)},e.prototype.acceptReconnectFinish=function(e){var t=this.session.getConfiguredModalities();return this.reconnectSession.configureModalitiesAsync(t,e).then(function(){return t})},e.prototype.isReconnecting=function(){return!!this.reconnectSession},e.prototype.reset=function(){this.glareTimer&&(clearTimeout(this.glareTimer),this.glareTimer=null),this.reconnectGlare=!1,this.session.callbacks=this.sessionCallbacks||{}},e.prototype.cleanUp=function(){this.sessionCallbacks=null,this.reset()},e.prototype.terminateAsync=function(e){var t=this,n=function(){return t.terminateReconnectSessionAsync().then(function(){return t.cleanUp()},function(){return t.cleanUp()})};return this.session.terminate(e).then(n,n)},e.prototype.completeReconnect=function(e){if(this.logger.safe.info("["+e+"] completing reconnect"),2===this.escalationType&&this.statistics.registerEscalationCompleted(),this.escalationType=0,this.reconnectSession){this.statistics.registerReconnectAttemptCompleted(),this.reconnectManagerMessageQueue.clear();var t=this.session;return this.session=this.reconnectSession,t.move(this.session,e),this.reconnectSession=null,this.negotiationPausePromise=null,t.terminate(e)}return Promise.resolve()},e.prototype.rejectReconnect=function(e){if(this.logger.safe.info("["+e+"] rejecting reconnect"),2===this.escalationType&&this.statistics.registerEscalationRejected(),this.escalationType=0,this.reconnectSession){this.statistics.registerReconnectAttemptRejected(),this.reconnectManagerMessageQueue.flush();var t=this.reconnectSession;return this.reconnectSession=null,this.unblockCurrentSession(),t.terminate(e)}return Promise.resolve()},e.prototype.configureModalitiesAsync=function(e,t){return this.isReconnecting()?Promise.all([this.session.configureModalitiesAsync(e,t),this.reconnectSession.configureModalitiesAsync(e,t)]).then(function(){return Promise.resolve()}):this.session.configureModalitiesAsync(e,t)},e.prototype.canSendDtmf=function(){return this.session.canSendDtmf()},e.prototype.getExtensionsManager=function(){return this.session.getExtensionsManager()},e.prototype.muteInputTypeAsync=function(e,t){return this.session.muteInputTypeAsync(e,t)},e.prototype.unmuteInputTypeAsync=function(e,t){return this.session.unmuteInputTypeAsync(e,t)},e.prototype.muteInputAsync=function(e){return this.session.muteInputAsync(e)},e.prototype.unmuteInputAsync=function(e){return this.session.unmuteInputAsync(e)},e.prototype.muteOutputAsync=function(e){return this.session.muteOutputAsync(e)},e.prototype.unmuteOutputAsync=function(e){return this.session.unmuteOutputAsync(e)},e.prototype._deviceSelectionChanged=function(){this.session._deviceSelectionChanged(),this.isReconnecting()&&this.reconnectSession._deviceSelectionChanged()},e.prototype.reconnectCloneSession=function(e){var t=this;this.reconnectSession=this.session.clone(e),this.reconnectSession.callbacks=this.sessionCallbacks,this.session.callbacks=i({},this.reconnectManagerMessageQueue.queueCallbacks,{onSessionErrorOccurred:function(e,n){return e.type!==o.default.MEDIA_ERROR.iceConnectionError&&t.reconnectManagerMessageQueue.queueCallbacks.onSessionErrorOccurred(e,n),Promise.resolve()}})},e.prototype.initReconnect=function(e,t){return void 0===e&&(e=!1),this.logger.safe.info("["+t+"] initiate reconnect"),this.reconnectCloneSession(e),this.session.pauseNegotiations&&(this.negotiationPausePromise=this.session.pauseNegotiations()),Promise.all([this.reconnectSession.muteInputAsync(t),this.reconnectSession.muteOutputAsync(t)]).then(r.noop)},e.prototype.unblockCurrentSession=function(){this.negotiationPausePromise&&(this.negotiationPausePromise.resolve(),this.negotiationPausePromise=null)},e.prototype.raiseReconnectEvent=function(e,t){this.ufdManager.signalEvent("NetworkReconnect",e,"Audio",!0,t)},e.prototype.terminateReconnectSessionAsync=function(){return this.reconnectSession?this.reconnectSession.terminate():Promise.resolve()},e.prototype.raiseConnectivityLostUFD=function(e){var t=this;-1!==this.settings.losingConnectivityTimeoutMs&&(this.losingConnectivityTimer=window.setTimeout(function(){return t.raiseReconnectEvent("Poor",e)},this.settings.losingConnectivityTimeoutMs))},e}();t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var c=n(11),l=n(2),u=n(19),d=n(85),p=n(86),f=n(6),h=n(172),g=n(88),m=n(0),v=function(e){function t(t,n,i,r,o,a){var s,c=e.call(this)||this;c.context=i,c.callback=r,c.statistics=o,c.configProvider=a,c.audioStreamStates=((s={})[u.Constants.STREAMING_STATE.inactive]=[u.Constants.STREAMING_STATE.active,u.Constants.STREAMING_STATE.failed],s[u.Constants.STREAMING_STATE.active]=[u.Constants.STREAMING_STATE.removed,u.Constants.STREAMING_STATE.stopped,u.Constants.STREAMING_STATE.failed],s),c.rejectedNegotiations=0,c.negotiationState=null,c.audioStreamState=u.Constants.STREAMING_STATE.inactive,c.deviceManagerDisposables=[],c.logger=i.getLogger().createChild("SessionV2",n),c.ufdManager=i.getUfdManager(),c.ufdManagerDisposable=c.ufdManager.on("onQualityChanged",function(e){return c.qualityChanged(e)}),c.mediaLegId=new d.default,c.sessionOperationQueue=new g.default(c.logger),c.statistics.setId(n),c.setConfigInfo(),c.configUpdateDisposable=c.configProvider.on("configUpdated",function(){return c.setConfigInfo()}),c.recoverableErrors=c.configProvider.config.recoverableMediaErrors.split(","),i.config.isConference&&c.statistics.setMultiParty();var l=c.getSessionCallbacks();t.callbacks=l,t.relayManagerProvider=c;var p=c.getReconnectManagerCallbacks();return c.reconnectManager=new h.default(t,i,c.statistics,c.sessionOperationQueue,p,l),c.deviceManager=c.context.getDeviceManager(),c.deviceManagerDisposables.push(c.deviceManager.on("onDevicesPermissionChanged",function(){return c.devicePermissionsChanged()})),c.deviceManagerDisposables.push(c.deviceManager.on("onSelectedDevicesChanged",function(){return c.deviceSelectionChanged()})),c.deviceManagerDisposables.push(c.deviceManager.on("onDevicesChanged",function(){return c.deviceListChanged()})),c.deviceManagerDisposables.push(c.deviceManager.on("onMaxVideoSendCapabilitiesChanged",function(e,t){return c.onMaxVideoSendCapabilitiesChanged(e,t)})),c.statistics.setDevicesCount(c.deviceManager.getDevicesCount()),c.ufdManager.applyCurrentState(function(e){return c.qualityChanged(e)}),c}return r(t,e),t.prototype.createOfferAsync=function(e){var t=this;return this.sessionOperationQueue.queueOperation(function(){return t.statistics.negotiation.offering.started(),t.getCurrentSession().createOfferAsync(e).then(function(e){return t.updateSelectedDevices(),e.mediaLegId=t.mediaLegId.process(e.mediaLegId),t.reconnectManager.isReconnecting()&&!t.reconnectManager.isSignalingStable()&&(t.statistics.registerRetargetOutgoing(),e.newOffer=!0),e}).catch(function(e){throw t.statistics.setError(e),e})}).then(function(e){return e})},t.prototype.processOfferAsync=function(e,t){var n=this;return this.sessionOperationQueue.queueOperation(function(){return n.statistics.negotiation.answering.started(),n.mediaLegId.process(e.mediaLegId),(e.newOffer?n.reconnectManager.acceptReconnectStartAsync(e.escalationOccurring,t):Promise.resolve()).then(function(){return n.getCurrentSession().processOfferAsync(e,t)}).then(function(i){return e.newOffer?n.reconnectManager.acceptReconnectFinish(t).then(function(e){return i.sharing===l.default.MEDIA_STATE.sendReceive&&(i.sharing=e.sharing===l.default.MEDIA_STATE.send?l.default.MEDIA_STATE.send:l.default.MEDIA_STATE.receive),i}):Promise.resolve(i)}).catch(function(e){throw n.statistics.setError(e),e})})},t.prototype.processAnswerAsync=function(e,t,n){var i=this;return new Promise(function(r){return r(i.getCurrentSession().processAnswerAsync(e,t,n))}).catch(function(e){throw i.statistics.setError(e),e})},t.prototype.completeNegotiationAsync=function(e){var t=this;return this.rejectedNegotiations=0,this.getCurrentSession().completeNegotiationAsync(e).then(function(n){return t.negotiationState=n,t.statistics.setFinalAnswerTimestamp((new Date).getTime()),t.statistics.negotiation.current.completed(),t.reconnectManager.onNegotiationCompletedAsync(e)}).then(function(){return t.sessionOperationQueue.completeCurrentOperation(),t.negotiationState}).catch(function(e){throw t.statistics.setError(e),e})},t.prototype.registerNegotiationRejection=function(e){this.rejectedNegotiations++,this.statistics.negotiation.current.rejected(),e.rollback&&this.statistics.registerRollbackEvent(e.rollback)},t.prototype.isRenegotiationAllowed=function(e){return this.rejectedNegotiations<this.context.configProvider.config.renegotiationAttempts&&!this.reconnectManager.isReconnectScheduled&&(u.Constants.RENEGOTIATION_ERROR.signaling===e||u.Constants.RENEGOTIATION_ERROR.media===e)},t.prototype.rejectNegotiationAsync=function(e,t){var n=this;return this.logger.safe.info("["+t+"] rejectNegotiationAsync",e),(this.reconnectManager.isReconnecting()?this.reconnectManager.onNegotiationRejection(e,t).then(function(){return n.negotiationState}):this.getCurrentSession().rejectNegotiationAsync(e,t,this.isRenegotiationAllowed(e))).then(function(e){return n.negotiationState=e,n.sessionOperationQueue.completeCurrentOperation(),n.registerNegotiationRejection(e),e}).catch(function(e){throw n.statistics.setError(e),e})},t.prototype.completeEscalationAsync=function(e){return this.reconnectManager.completeReconnect(e)},t.prototype.rejectEscalationAsync=function(e){return this.reconnectManager.rejectReconnect(e)},t.prototype.terminate=function(e,t){return o(this,void 0,void 0,function(){var n,i,r,o=this;return a(this,function(a){switch(a.label){case 0:return i=(n=this.statistics).setPermissionStates,[4,this.deviceManager.getKnownPermissionStates()];case 1:return i.apply(n,[a.sent()]),this.statistics.terminated(t),r=function(){return o.cleanUp()},[2,this.reconnectManager.terminateAsync(e).then(r,r)]}})})},t.prototype.getStatsAsync=function(){var e=this;return this.getMainSession().getStatsAsync().then(function(t){return e.prepareStats(t)})},t.prototype.getLastKnownStats=function(){return this.prepareStats(this.getMainSession().getLastKnownStats())},t.prototype.prepareStats=function(e){return this.statistics.setDeviceList(this.deviceManager.getDeviceDescriptions(),this.deviceManager.getDeviceListDebugInfo()),this.statistics.setRelayManagerTimers(this.getRelayManager().getStats()),this.statistics.generateStatistics(e,this.mediaLegId)},t.prototype.createAnswerAsync=function(e,t){var n=this;return this.getCurrentSession().createAnswerAsync(e,t).then(function(e){return n.updateSelectedDevices(),e.mediaLegId=n.mediaLegId.process(e.mediaLegId),e}).catch(function(e){throw n.statistics.setError(e),e})},t.prototype.configureModalitiesAsync=function(e,t){return m.forOwn(e,function(t,n){t||delete e[n]}),this.reconnectManager.configureModalitiesAsync(e,t)},t.prototype.getAllowedModalities=function(){return this.deviceManager.getAllowedModalities()},t.prototype.createRemoteRenderer=function(e){return this.getMainSession().createRemoteRenderer(e)},t.prototype.sendDtmf=function(e){var t=this;return this.getMainSession().sendDtmf(e).then(function(e){return t.statistics.dtmfResult(!0),e}).catch(function(e){throw t.statistics.dtmfResult(!1),e})},t.prototype.canSendDtmf=function(){return this.reconnectManager.canSendDtmf()},t.prototype.getExtensionsManager=function(){return this.reconnectManager.getExtensionsManager()},t.prototype.muteInputTypeAsync=function(e,t){return this.reconnectManager.muteInputTypeAsync(e,t)},t.prototype.unmuteInputTypeAsync=function(e,t){return this.reconnectManager.unmuteInputTypeAsync(e,t)},t.prototype.muteInputAsync=function(e){return this.statistics.setSwMute(!0),this.ufdManager.setSwMute(!0),this.reconnectManager.muteInputAsync(e)},t.prototype.unmuteInputAsync=function(e){return this.statistics.setSwMute(!1),this.ufdManager.setSwMute(!1),this.reconnectManager.unmuteInputAsync(e)},t.prototype.muteOutputAsync=function(e){return this.statistics.setSpeakerMute(!0),this.reconnectManager.muteOutputAsync(e)},t.prototype.unmuteOutputAsync=function(e){return this.statistics.setSpeakerMute(!1),this.reconnectManager.unmuteOutputAsync(e)},t.prototype.getAcceptedTypes=function(){return this.reconnectManager.getCurrentSession().getAcceptedTypes()},t.prototype.createAudioElement=function(e){this.getCurrentSession().createAudioElement(e)},t.prototype.deviceSelectionChanged=function(){this.updateSelectedDevices(),this.reconnectManager._deviceSelectionChanged()},t.prototype.deviceListChanged=function(){this.deviceManager.isPollingInProgress&&this.statistics.deviceChangedByPoll(),this.statistics.devicesChanged(),this.statistics.setDevicesCount(this.deviceManager.getDevicesCount())},t.prototype.qualityChanged=function(e){this.callback&&this.callback.onQualityChanged&&(this.statistics.registerQualityStateChangedEvent(e),"DeviceSpeakWhileMuted"===e.type&&this.statistics.setSpeakingState("Good"===e.value),this.callback.onQualityChanged(e))},t.prototype.devicePermissionsChanged=function(){this.statistics.setSendModalities(this.getAllowedModalities())},t.prototype.registerDeviceTelemetryEvent=function(e){this.getCurrentSession().onDeviceEvent(e),this.statistics.registerDeviceTelemetryEvent(e)},t.prototype.reconnectAsync=function(e,t){return void 0===t&&(t=!1),this.reconnectManager.reconnectAsync(e,!0,t)},t.prototype.isReconnecting=function(){return this.reconnectManager.isReconnecting()},t.prototype.onMaxVideoSendCapabilitiesChanged=function(e,t){this.reconnectManager.getCurrentSession().onMaxVideoSendCapabilitiesChanged(e,t)},t.prototype.getRelayManager=function(){return this.relayManager||(this.relayManager=new p.default(this.context.maContext.getRelayManager(),this.statistics))},t.prototype.cleanUp=function(){this.callback=null,this.configUpdateDisposable.dispose(),this.deviceManagerDisposables.forEach(function(e){return e.dispose()}),this.ufdManagerDisposable.dispose()},t.prototype.updateSelectedDevices=function(){var e=this,t=this.deviceManager.getSelectedDevices(),n=function(t){return t?e.deviceManager.getDeviceNameAsync(t).then(function(t){return m.scrubDeviceLabelPii(t,e.configProvider.config.devices.piiSafeWords)||"unknown"}):Promise.resolve("none")};Promise.all([n(t.microphone),n(t.speaker),n(t.camera)]).then(function(t){var n=s(t,3),i=n[0],r=n[1],o=n[2];e.statistics.setUsedDevices({microphone:i,speaker:r,camera:o})})},t.prototype.getCurrentSession=function(){return this.reconnectManager.getCurrentSession()},t.prototype.getMainSession=function(){return this.reconnectManager.getMainSession()},t.prototype.setAudioStreamState=function(e,t){this.isAudioStateValid(e)?this.raiseAudioStateChanged(e,t):this.logger.safe.error("["+t+"] audio state transition is invalid: "+this.audioStreamState+" -> "+e)},t.prototype.isAudioStateValid=function(e){return this.audioStreamStates[this.audioStreamState].indexOf(e)>=-1},t.prototype.raiseAudioStateChanged=function(e,t){if(this.logger.safe.info("["+t+"] audio state changed to "+e),this.callback.onAudioStateChanged){var n={content:"audio",direction:"receive",stream:e};this.callback.onAudioStateChanged(n)}},t.prototype.getReconnectManagerCallbacks=function(){var e=this;return{onSessionErrorOccurred:function(t,n){e.isNetworkMediaError(t)&&e.ufdManager.raisePendingWhitelistingUFD(),e.endCallOnFailure(t,n)}}},t.prototype.isNetworkMediaError=function(e){return e.type===u.Constants.MEDIA_ERROR.iceConnectionError||e.type===u.Constants.MEDIA_ERROR.noNetworkError},t.prototype.isRecoverableMediaError=function(e){return this.recoverableErrors.indexOf(e.type)>-1},t.prototype.startReconnect=function(e){return void 0===e&&(e=c.generateCauseId()),this.reconnectManager.onIceDisconnect(e)},t.prototype.getSessionCallbacks=function(){var e=this;return{onTerminated:function(){e.logger.safe.warn("call onTerminated"),e.event("onTerminated").raise(e)},onSessionErrorOccurred:function(t,n){if(void 0===n&&(n=c.generateCauseId()),e.isRecoverableMediaError(t)){if(e.reconnectManager.isReconnecting())return e.reconnectManager.onSessionErrorOccurred(t,n);if(e.getCurrentSession().isReconnectSupported())return e.startReconnect(n)}return e.endCallOnFailure(t,n),Promise.resolve()},onNegotiationRequired:function(t){return e.callback.onNegotiationRequired(t)},onAudioHwSilentChanged:function(t){e.statistics.setHwSilent(t)},onAudioStateChanged:function(t,n){e.setAudioStreamState(t,n)},onTransportConnected:function(t){void 0===t&&(t=c.generateCauseId()),e.logger.safe.info("["+t+"] Transport connectivity established"),e.ufdManager.cancelPendingWhitelistingUFD(),e.reconnectManager.onConnected(t),e.statistics.registerTransportConnected(),e.statistics.setIceConnectedStateTimestamp((new Date).getTime())},onTransportDisconnected:function(t){return void 0===t&&(t=c.generateCauseId()),e.logger.safe.warn("["+t+"] Transport connectivity lost"),e.reconnectManager.onTransportDisconnect(t),e.statistics.registerTransportDisconnected(),e.getCurrentSession().isReconnectSupported()&&e.configProvider.config.reconnectOnDisconnect?e.startReconnect(t):Promise.resolve()},onTransportFailed:function(){e.statistics.registerTransportFailed()},onTransportInitialized:function(){e.statistics.setIceInitTimestamp((new Date).getTime())},onScreenSharingIncomingDecoderFailed:function(){e.statistics.registerSSIncomingDecoderFailed()},onScreenSharingIncomingDecoderActive:function(){e.statistics.registerSSIncomingDecoderActive()},onScreenSharingIncomingDecoderReset:function(){e.statistics.registerSSIncomingDecoderReset()}}},t.prototype.endCallOnFailure=function(e,t){this.callback&&(this.callback.onSessionErrorOccurred&&this.callback.onSessionErrorOccurred(e,t),this.statistics.setError(e),this.setAudioStreamState(u.Constants.STREAMING_STATE.failed,t))},t.prototype.setConfigInfo=function(){this.statistics.setETag(this.configProvider.ETag),this.statistics.setConfigIds(this.configProvider.escConfigIds)},t}(f.default);t.default=v},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(31),s=n(0),c=n(2),l=(n(19),n(87)),u=function(){function e(e,t,n,i,r,o){this.session=e,this.statistics=n,this.sessionOperationQueue=i,this.callback=r,this.sessionCallbacks=o,this.wasConnected=!1,this.isDisconnected=!1,this.escalationType=0,this._isSignalingStable=!0,this.reconnectDelayTime=0,this._isReconnectScheduled=!1,this.logger=t.getLogger().createChild("ReconnectManagerV2"),this.ufdManager=t.getUfdManager(),this.settings=t.configProvider.config,this.session.callbacks=o,this.reconnectManagerMessageQueue=new l.default(o)}return e.prototype.getCurrentSession=function(){return this.reconnectSession||this.session},e.prototype.getMainSession=function(){return this.session||this.reconnectSession},e.prototype.getReconnectSession=function(){return this.reconnectSession},e.prototype.onIceDisconnect=function(e){return this.logger.safe.info("["+e+"] reconnect attempt after iceDisconnect error"),this.allowUFD&&this.raiseReconnectEvent("Bad",e),this.isDisconnected=!0,this.isReconnecting()?Promise.resolve():(this.statistics.registerReconnectAttempted(),this.reconnectAsync(e))},e.prototype.onTransportDisconnect=function(e){this.isDisconnected=!0,this.allowUFD&&this.raiseConnectivityLostUFD(e)},e.prototype.onConnected=function(e){this.isDisconnected=!1,this.logger.safe.info("["+e+"] set allow UFD"),this.raiseReconnectEvent("Good",e),this.wasConnected=!0,clearTimeout(this.losingConnectivityTimer)},e.prototype.onNegotiationCompletedAsync=function(e){return this.logger.safe.info("["+e+"] handle negotiation completed"),this.setSignalingState(!0),this.isReconnecting()&&(this.statistics.registerRetargetCompleted(),2===this.escalationType&&this.blockCurrentSession()),Promise.resolve()},e.prototype.onSessionErrorOccurred=function(e,t){var n=this;return this.logger.safe.info("["+t+"] handle session error",s.stringifyObject(e)),this.rejectReconnect(t).then(function(){return n.isReconnectAllowed()?n.scheduleReconnectRetry(t,!1,!1):n.callback.onSessionErrorOccurred(e,t)})},e.prototype.onNegotiationRejection=function(e,t){var n=this;this.logger.safe.info("["+t+"] handle negotiation rejection"),this.statistics.registerRetargetRejected();var i=1===this.escalationType;return this.rejectReconnect(t).then(function(){var r=e===c.default.RENEGOTIATION_ERROR.glare&&i;(e!==c.default.RENEGOTIATION_ERROR.glare||i)&&(n.isRecoverableError(e)||r?n.scheduleReconnectRetry(t,r,i):n.onReconnectFailed(e,t))})},e.prototype.reconnectAsync=function(e,t,n){var i=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),this.logger.safe.info("["+e+"] queueing reconnect, force="+t+", escalation="+n),this.statistics.registerReconnectAttempt(n?"local escalation":"out"),this._isReconnectScheduled=!0,n&&(this.escalationType=1),this.sessionOperationQueue.queueOperation(function(){return i._isReconnectScheduled=!1,!t&&i.session&&i.session.isConnected()?(i.logger.safe.info("["+e+"] old session is active reconnect"),i.isReconnecting()||i.statistics.registerReconnectConnected(),i.sessionOperationQueue.completeCurrentOperation(),Promise.resolve()):i.reconnectSession&&i._isSignalingStable?(i.logger.safe.info("["+e+"] ongoing reconnect is in progress"),i.sessionOperationQueue.completeCurrentOperation(),Promise.resolve()):i.initReconnect(e).then(function(){return i.reconnectSession.configureModalitiesAsync(i.getConfiguredModalities(),e)}).then(function(){i.sessionOperationQueue.completeCurrentOperation()})})},e.prototype.acceptReconnectStartAsync=function(e,t){return this.logger.safe.info("["+t+"] accepting reconnect"),this.statistics.registerRetargetIncoming(),e?(this.escalationType=2,this.statistics.registerEscalationStart()):(!this.isReconnecting()&&this.isDisconnected?this.statistics.registerReconnectAttempted():this.isReconnecting()&&this.rejectReconnect(t),this.statistics.registerReconnectAttempt("in")),this.initReconnect(t)},e.prototype.acceptReconnectFinish=function(e){var t=this.getConfiguredModalities();return this.reconnectSession.configureModalitiesAsync(t,e).then(function(){return t})},e.prototype.isReconnecting=function(){return!!this.reconnectSession},e.prototype.isReconnectScheduled=function(){return this._isReconnectScheduled},e.prototype.cleanUp=function(){this.sessionCallbacks=null,this.reconnectSession=null},e.prototype.terminateAsync=function(e){var t=this,n=function(){return t.terminateReconnectSessionAsync(e).then(function(){return t.cleanUp()},function(){return t.cleanUp()})};return this.getMainSession().terminate(e,{}).then(n,n)},e.prototype.completeReconnect=function(e){return this.logger.safe.info("["+e+"] completing reconnect"),2===this.escalationType&&(this.unblockCurrentSession(),this.statistics.registerEscalationCompleted()),this.escalationType=0,this.reconnectSession&&(this.disposeActiveSession(e),this.session=this.reconnectSession,this.reconnectManagerMessageQueue.clear(),this.statistics.registerReconnectAttemptCompleted(),this._isSignalingStable||this.statistics.registerRetargetCompleted(),this.isDisconnected&&this.statistics.registerReconnectConnected(),this.resetReconnectTimer(),this.reconnectDelayTime=0,this.reconnectSession=null,this.negotiationPausePromise=null,this.session.callbacks=this.sessionCallbacks||{}),Promise.resolve()},e.prototype.rejectReconnect=function(e){return r(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.logger.safe.info("["+e+"] rejecting reconnect"),this.setSignalingState(!1),2===this.escalationType&&this.statistics.registerEscalationRejected(),this.escalationType=0,this.reconnectSession?[4,this.terminateReconnectSessionAsync(e)]:[3,2];case 1:t.sent(),this.statistics.registerReconnectAttemptRejected(),t.label=2;case 2:return this.session&&(this.reconnectManagerMessageQueue.flush(),this.session.callbacks=this.sessionCallbacks,this.unblockCurrentSession()),[2]}})})},e.prototype.configureModalitiesAsync=function(e,t){this.lastKnownConfiguredModalities=e;var n=[];return this.session&&n.push(this.session.configureModalitiesAsync(e,t)),this.reconnectSession&&n.push(this.reconnectSession.configureModalitiesAsync(e,t)),Promise.all(n).then(function(){return Promise.resolve()})},e.prototype.canSendDtmf=function(){return this.getMainSession().canSendDtmf()},e.prototype.getExtensionsManager=function(){return this.getMainSession().getExtensionsManager()},e.prototype.muteInputTypeAsync=function(e,t){return this.getMainSession().muteInputTypeAsync(e,t)},e.prototype.unmuteInputTypeAsync=function(e,t){return this.getMainSession().unmuteInputTypeAsync(e,t)},e.prototype.muteInputAsync=function(e){return this.getMainSession().muteInputAsync(e)},e.prototype.unmuteInputAsync=function(e){return this.getMainSession().unmuteInputAsync(e)},e.prototype.muteOutputAsync=function(e){return this.getMainSession().muteOutputAsync(e)},e.prototype.unmuteOutputAsync=function(e){return this.getMainSession().unmuteOutputAsync(e)},e.prototype._deviceSelectionChanged=function(){this.session&&this.session._deviceSelectionChanged(),this.reconnectSession&&this.reconnectSession._deviceSelectionChanged()},e.prototype.disposeActiveSession=function(e){if(this.session&&this.isReconnecting()){this.logger.safe.info("["+e+"] About to dispose current session...");var t=this.session;return this.lastKnownConfiguredModalities=this.session.getConfiguredModalities(),t.callbacks=this.reconnectManagerMessageQueue.queueCallbacks,t.move(this.reconnectSession,e),this.session=null,t.terminate(e,{},!1)}return Promise.resolve()},Object.defineProperty(e.prototype,"allowUFD",{get:function(){return this.wasConnected},enumerable:!0,configurable:!0}),e.prototype.getConfiguredModalities=function(){return this.getMainSession().getConfiguredModalities()||this.lastKnownConfiguredModalities},e.prototype.scheduleReconnectRetry=function(e,t,n){var i=this,r=this.getReconnectDelayTime();return a.delay(r).then(function(){return i.isReconnectAllowed()||t?i.reconnectAsync(e,n,n):!i.session||i.session.isFailed()?i.onReconnectFailed("the time limit was reached",e):void 0})},e.prototype.isRecoverableError=function(e){return c.default.RENEGOTIATION_ERROR.media===e||c.default.RENEGOTIATION_ERROR.signaling===e},e.prototype.resetReconnectSession=function(e){var t=this,n=null;this.logger.safe.info("["+e+"] Resetting reconnect session. Session exists: old: "+!!this.session+", new: "+!!this.reconnectSession),(n=this.getMainSession().clone(0!==this.escalationType)).callbacks=i({},this.sessionCallbacks,{onTransportConnected:function(e){2!==t.escalationType&&t.completeReconnect(e),t.raiseReconnectEvent("Good",e),t.sessionCallbacks.onTransportConnected(e)}}),this.session&&(this.session.callbacks=i({},this.reconnectManagerMessageQueue.queueCallbacks,{onSessionErrorOccurred:function(e,n){return e.type!==c.default.MEDIA_ERROR.iceConnectionError&&t.reconnectManagerMessageQueue.queueCallbacks.onSessionErrorOccurred(e,n),Promise.resolve()}})),this.reconnectSession&&(this.reconnectSession.move(n,e),this.logger.safe.info("["+e+"] reconnect session still exists during reconnect clone operation"),this.terminateReconnectSessionAsync(e)),this.logger.safe.info("["+e+"] New session reset."),this.reconnectSession=n},e.prototype.initReconnect=function(e){return this.logger.safe.info("["+e+"] initiate reconnect"),this.setReconnectTimer(),this.resetReconnectSession(e),this.setSignalingState(!1),this.session?(this.blockCurrentSession(),Promise.all([this.reconnectSession.muteInputAsync(e),this.reconnectSession.muteOutputAsync(e)]).then(function(){return Promise.resolve()})):Promise.resolve()},e.prototype.blockCurrentSession=function(){this.session.pauseNegotiations&&(this.negotiationPausePromise=this.session.pauseNegotiations())},e.prototype.unblockCurrentSession=function(){this.negotiationPausePromise&&(this.negotiationPausePromise.resolve(),this.negotiationPausePromise=null)},e.prototype.raiseReconnectEvent=function(e,t){this.ufdManager.signalEvent("NetworkReconnect",e,"Audio",!0,t)},e.prototype.terminateReconnectSessionAsync=function(e){return r(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:return this.reconnectSession?(t=new l.default(this.sessionCallbacks),this.reconnectSession.callbacks=t.queueCallbacks,[4,this.reconnectSession.terminate(e,{},!1)]):[3,2];case 1:n.sent(),t.clear(),this.reconnectSession=null,n.label=2;case 2:return[2]}})})},e.prototype.setReconnectTimer=function(){var e=this,t=this.wasConnected?this.settings.reconnectTimeLimit:this.settings.initialReconnectTimeLimit;t>0&&!this.reconnectTimer&&(this.reconnectTimer=window.setTimeout(function(){return e.resetReconnectTimer()},t))},e.prototype.resetReconnectTimer=function(){clearTimeout(this.reconnectTimer),this.reconnectTimer=null},e.prototype.isReconnectAllowed=function(){return!!this.reconnectTimer},e.prototype.getReconnectDelayTime=function(){return 1e3*Math.min(++this.reconnectDelayTime,this.settings.maxReconnectDelayTime)},e.prototype.onReconnectFailed=function(e,t){this.callback.onSessionErrorOccurred({type:c.default.MEDIA_ERROR.iceConnectionError,detail:"Reconnect failed, error - "+s.stringifyObject(e)},t)},e.prototype.isSignalingStable=function(){return this._isSignalingStable},e.prototype.setSignalingState=function(e){this._isSignalingStable=e},e.prototype.raiseConnectivityLostUFD=function(e){var t=this;-1!==this.settings.losingConnectivityTimeoutMs&&(this.losingConnectivityTimer=window.setTimeout(function(){return t.raiseReconnectEvent("Poor",e)},this.settings.losingConnectivityTimeoutMs))},e}();t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(14),s=n(11),c=n(6),l={ZeroCaptureDevicesEnumerated:!0,ZeroRenderDevicesEnumerated:!0},u=function(e){function t(t,n){var i=e.call(this)||this;return i.logger=t,i.configProvider=n,i.evState=new Map,i.swMuted=!1,i.logger.safe.info("Initialized"),i}return r(t,e),t.prototype.signalEvent=function(e,t,n,i,r){void 0===n&&(n="Audio"),void 0===i&&(i=!0),void 0===r&&(r=s.generateCauseId());var o={type:e,value:t,isLocalSource:i,mediaType:n},c=this.getEventKey(o),l=this.evState.get(c);if(!(l&&l.value===t||!l&&"Good"===t)){this.evState.set(c,o);var u=!0;"NetworkRelaysNotReachable"===o.type?(this.lastWhitelistingUFD=o,u=!1):("DeviceSpeakWhileMuted"!==o.type||this.swMuted||"Good"===o.value&&"Good"!==l.value)&&("NetworkRecvQuality"!==o.type||"Edge"!==a.getBrowserInfo().name&&this.configProvider.config.webrtcStatNetworkDetectionEnabled)||(u=!1),l||"Good"!==t||(u=!1),u&&(this.logger.safe.info("["+r+"] Raising UFD "+e+" for "+n+": "+t),this.event("onQualityChanged").raise(o))}},t.prototype.signalDeviceEvent=function(e,t,n){var i=d(e,n);i?this.signalEvent(i,t,n):this.logger.warn("Unknown device quality event type: "+e)},t.prototype.raisePendingWhitelistingUFD=function(){this.lastWhitelistingUFD&&(this.logger.safe.debug("Raising whitelisting UFD "+this.lastWhitelistingUFD.type+": "+this.lastWhitelistingUFD.value),this.event("onQualityChanged").raise(this.lastWhitelistingUFD))},t.prototype.cancelPendingWhitelistingUFD=function(){this.lastWhitelistingUFD=void 0},t.prototype.setSwMute=function(e){if(this.swMuted=e,e){var t=this.evState.get(this.getEventKey({type:"DeviceSpeakWhileMuted",mediaType:"Audio"}));t&&"Good"!==t.value&&this.event("onQualityChanged").raise(t)}},t.prototype.applyCurrentState=function(e){var t,n,i=0;try{for(var r=o(this.evState.values()),a=r.next();!a.done;a=r.next()){var s=a.value;"Good"!==s.value&&(e(s),i++)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}i>0&&this.logger.safe.info("Applied "+i+" UFDs")},t.prototype.reset=function(){var e,t;this.logger.safe.info("Resetting UFD states");var n=this.evState.keys();try{for(var i=o(n),r=i.next();!r.done;r=i.next()){var a=r.value,s=this.evState.get(a);l[s.type]||this.evState.delete(a)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.lastWhitelistingUFD=void 0,this.swMuted=!1},t.prototype.getEventKey=function(e){return e.type+":"+e.mediaType},t}(c.default);function d(e,t){switch(e){case 0:return"Audio"===t?"DeviceCaptureNotFunctioning":"VideoCapturerDeviceStartFailed";case 1:return"Audio"===t?"DeviceCaptureNotFunctioning":"VideoCapturerDeviceStartTimedOut";case 2:return"Audio"===t?"DeviceCaptureMute":void 0;case 3:switch(t){case"ScreenShare":return"ScreenshareRecordingDisabled";case"Audio":return"DeviceCaptureNotMuteButSilent";case"Video":return"VideoCapturePermissionDenied";default:return}default:return}}t.UFDManager=u,t.getQualityEventType=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=n(6),s=n(0),c=n(175),l=n(27),u=function(){function e(e){this.configProvider=e,this._maxBandwidthInKbps=0,this.isTransportUnbundled=!1}return Object.defineProperty(e.prototype,"maxBandwidthInKbps",{get:function(){return this._maxBandwidthInKbps},set:function(e){this._maxBandwidthInKbps=e,this.configProvider.config.maxBandwidthInKbps&&(this._maxBandwidthInKbps=Math.min(this.configProvider.config.maxBandwidthInKbps,this._maxBandwidthInKbps||Number.MAX_SAFE_INTEGER))},enumerable:!0,configurable:!0}),e.prototype.setMediaPortRanges=function(e){this._mediaPortRanges=e},Object.defineProperty(e.prototype,"audioPortRange",{get:function(){if(this.isTransportUnbundled&&this._mediaPortRanges&&this._mediaPortRanges.audioMin&&this._mediaPortRanges.audioMax)return{min:this._mediaPortRanges.audioMin,max:this._mediaPortRanges.audioMax}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoPortRange",{get:function(){if(this.isTransportUnbundled&&this._mediaPortRanges&&this._mediaPortRanges.videoMin&&this._mediaPortRanges.videoMax)return{min:this._mediaPortRanges.videoMin,max:this._mediaPortRanges.videoMax}},enumerable:!0,configurable:!0}),e}(),d=function(e,t){if(o.isArray(e))return t.slice()},p=function(e){function t(t,n){var i=e.call(this)||this;return i.platformConfig=c.getPlatformConfig(),i.sessionCount=0,i.initialSettings=s.deepClone(i.platformConfig.getInitialSettings()),i.pendingSettings=null,i.consoleOverrides={},i.uaConfig=null,i.logger=t.createChild("configProvider"),i.logger.safe.info("configProvider initialized"),n&&s.forOwn(n,function(e,t){return i.initialSettings[t]=e}),o.mergeWith(i.initialSettings,i.platformConfig.getEnforcedSettings(),d),i.settings=i.initialSettings,i.settingsOut=i.settings,i.uaConfig=new l.UserAgentConfig(i),i.mediaSettings=new u(i),i}return r(t,e),t.prototype.updateConfig=function(e,t,n){this.etag=t||this.etag,this.configIds=n||this.configIds;var i=s.deepClone(this.initialSettings);o.mergeWith(i,e,d),this.sessionCount>0?(this.pendingSettings=i,this.logSettings("pendingSettings updated",i)):(this.settings=i,this.settingsOut=s.deepClone(i),o.mergeWith(this.settingsOut,this.consoleOverrides,d),this.event("configUpdated").raise(),this.logSettings("Settings updated",this.settingsOut))},t.prototype.updateSessionCount=function(e){this.sessionCount=e,0===e&&null!==this.pendingSettings&&(this.settings=s.deepClone(this.pendingSettings),this.settingsOut=s.deepClone(this.settings),o.mergeWith(this.settingsOut,this.consoleOverrides,d),this.pendingSettings=null,this.event("configUpdated").raise(),this.logSettings("Pending configuration applied",this.settingsOut))},Object.defineProperty(t.prototype,"config",{get:function(){return this.settingsOut},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultConfig",{get:function(){return this.initialSettings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userAgentConfig",{get:function(){return this.uaConfig},enumerable:!0,configurable:!0}),t.prototype.setMediaConfig=function(e){this.mediaSettings=e},Object.defineProperty(t.prototype,"mediaConfig",{get:function(){return this.mediaSettings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ETag",{get:function(){return this.etag},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"escConfigIds",{get:function(){return this.configIds},enumerable:!0,configurable:!0}),t.prototype.setConsoleOverride=function(e,t){this.consoleOverrides[e]=t,this.updateConfig(this.settings)},t.prototype.clearConsoleOverride=function(e){delete this.consoleOverrides[e],this.updateConfig(this.settings)},t.prototype.clearAllConsoleOverrides=function(){this.consoleOverrides={},this.updateConfig(this.settings)},t.prototype.logSettings=function(e,t){var n=this,i={};s.forOwn(t,function(e,r){t[r]!==n.initialSettings[r]&&(i[r]=e)}),this.logger.safe.info(e+": "+JSON.stringify(i))},t}(a.default);t.default=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=n(2);t.getPlatformConfig=function(){var e=o.getBrowserInfo();return"Safari"===e.name?new c:"Firefox"===e.name?new l:"Chrome"===e.name&&"Mobile"===e.formFactor?new u:"CiscoOS"===e.name?new d:new s};var s=function(){function e(){}return e.prototype.getInitialSettings=function(){return{activeSpeaker:{timeToPromote:3e3},enumerateDevicesTimeout:999999,devicePollingInterval:3e3,devicePollingAlwaysOn:!1,dtmf:{toneDuration:200,toneGap:100},mediaStreamHoldInterval:5e3,ortcAllowedMediaContentType:a.default.ALLOWED_CONTENT_TYPES.SDP_NGC,ortcMediaContentType:a.default.CONTENT_TYPE.SDP,ortcVideoCapabilityCheckIntervalMin:2e4,ortcVideoCapabilityCheckIntervalMax:3e4,ortcVideoCapabilityMaxFS:1200,ortcVideoCapabilityMaxFPS:3e3,ortcOutgoingScreenSharingEnabled:!1,webrtcContributingSourcesPollingInterval:1e3,webrtcIceGatheringTimeoutMs:2e4,webrtcAllowedMediaContentType:a.default.ALLOWED_CONTENT_TYPES.SDP_NGC,webrtcMediaContentType:a.default.CONTENT_TYPE.SDP,webrtcScreensharingCapabilityMaxFS:3600,webrtcScreensharingCapabilityMaxFPS:1500,webrtcStatHwSilentDetectionDuration:5,webrtcStatHwSilentDetectionLevel:7,webrtcStatPollInterval:1e3,webrtcStatStoredRecordsNumber:60,webrtcStatNetworkDetectionDuration:10,webrtcStatNetworkDetectionHysteresis:.01,webrtcStatNetworkDetectionBadLevel:.07,webrtcStatNetworkDetectionGoodLevel:.03,webrtcVideoCapabilityCheckIntervalMin:2e4,webrtcVideoCapabilityCheckIntervalMax:3e4,webrtcVideoCapabilityMaxFS:1200,webrtcVideoCapabilityMaxFPS:3e3,webrtcMultiPartyRecvVideoMaxFS:8160,webrtcRecvVideoMaxFS:8160,webrtcCameraOpenFs:8160,webrtcMultipartyMaxScalingFs:8160,webrtcMaxScalingFs:8160,webrtcMultiPartyVideoScaling:!0,webrtcVideoScaling:!1,webrtcVideoStreamRecoverWaitTimeout:2e4,webrtcBandwidthPerVideoReceiver:2e5,webrtcQualitySlidingWindowPercentile:.3,webrtcQualitySlidingWindowSamples:20,webrtcVideoReceiversCount:1,nonEstimatedDefaultVideoReceiversCount:4,webrtcStatNetworkDetectionEnabled:!1,webrtcUseNewStatsApi:!1,webrtcVideoSubscriptionDisposeTimeout:2e3,webrtcOutgoingScreenSharingEnabled:!0,webrtcGetDisplayMediaEnabled:!0,iceServerTransport:"udp,tcp,tls",iceHostCandidateOnly:!0,iceUdpAddressType:"ip",iceTcpAddressType:"ip",renegotiationAttempts:3,reconnectTimeLimit:9e4,initialReconnectTimeLimit:0,maxReconnectDelayTime:5,waitForRelayOnReconnect:!0,relayWaitSaneTimeoutMs:25e3,useTurnRedirector:!1,turnRedirectorTimeout:25e3,reconnectOnDisconnect:!1,webrtcSpeakingWhileMutedBadDuration:3,webrtcSpeakingWhileMutedDetectionLevel:2e3,webrtcNegotiateDisabledDataModality:!1,recoverableMediaErrors:[a.default.MEDIA_ERROR.iceConnectionError,a.default.MEDIA_ERROR.noNetworkError,a.default.MEDIA_ERROR.srtpError,a.default.MEDIA_ERROR.incompatibleOffer,a.default.MEDIA_ERROR.internalError].join(","),sendCallStartupTelemetry:!0,webrtcMultiPartyRecvVideoSignaling:!0,webrtcVideoDelayThreshold:10,webrtcEndOfCallFreezeThreshold:3,webrtcSubscriptionEventLimit:300,webrtcHandleRollback:!0,losingConnectivityTimeoutMs:-1,ortcAudioOutputSelectionEnabled:!1,iceCandidateFilterMDns:!0,webrtcEnabledTransportCC:!1,webrtcRejectedFeatures:"",webrtcRequiredFeatures:"",webrtcSimulcastSessionEnabled:!1,webrtcSimulcastStreamsCountForVideo:1,webrtcSimulcastStreamsCountForSharing:1,webrtcFmtParamListSupported:!1,webrtcNegotiatedSsrcRangeForVideo:0,webrtcNegotiatedSsrcRangeForSharing:0,webrtcNegotiatedSsrcRangeForVideoOneToOne:0,webrtcNegotiatedSsrcRangeForSharingOneToOne:0,webrtcAllowRestoreKeyframe:!1,webrtcEnabledCustomBwEstimationForVideo:!0,webrtcDisabledSenderBitrate:1e3,maxStoredPreferredResolutionCount:4,maxStoredUFDCount:50,simulcastTelemetryLayoutsPerSession:5,simulcastTelemetryNumModalitySessions:3,maxSendVideoCapabilitiesReportingForVideoEnabled:!1,maxSendVideoCapabilitiesReportingForSharingEnabled:!1,maxReportedOvershootingEvents:20,permissions:{usePositiveInAdp:!1,useNegativeInAdp:!1,adpFallback:!0,adpFallbackAudio:!0,adpFallbackVideo:!0,adpRequestAVLast:!0,rememberNegative:!1},devices:{blacklist:{microphone:"stereo mix \\(",camera:"ir camera",speaker:""},compositeAudioDevices:!0,compositeLabelMatchingThreshold:.5,piiSafeWords:["virtual","usb","test","default","remote audio","built-in","s/pdif","digital","dock","thunderbolt\\d*","line( in| out)?","analog","high definition","smartaudio","macbook","airpod","iphone","ipad","stereo","hands-free","display","dp","displayport","hdmi","cable","nvidia","amd","citrix hdx","vmware","integrated","panoramic","facetime","front","rear","back","desktop","capture","cam","snap camera","obs-camera","vb-audio","vaio","manycam"]},multiviewResolutionLimits:{1:720,2:720,3:480,4:360,more:360},maxVideoFreezeTimestampsInBucket:5,webrtcSendBandwidthNotificationsEnabled:!1,webrtcSendBandwidthIgnoredUpdateLimit:6,webrtcSendBandwidthThreshold:.1,webrtcUnifiedPlanEnabled1on1:!1,webrtcUnifiedPlanEnabledMultiparty:!1,webrtcLastAppliedVideoCapabilitiesCount:5,webrtcLastAppliedVideoCapabilitiesSequenceCount:5,gumRequestTimeout:2e4,videoCaptureFreezeTimeout:5e3,enableReconnectImprovements1on1:!0,enableReconnectImprovementsMultiparty:!0,webrtcCloseAfterIceFailure:!0,audioBandwidthInKbps:90,enableQosSupport:!1,forceUnbundledTransport:!1,allowedAudioCodecs1on1:[],allowedAudioCodecsMultiparty:[],allowedVideoCodecs1on1:p,allowedVideoCodecsMultiparty:[],subscribeToSsrcForVideo:!1,audioRendererUsePauseOnDetach:!1,preferSdesSrtp1on1:!0,preferSdesSrtpMultiparty:!0,useLocalStorageForOneDs:!1,useOneDsLogger:!1,eventsLimitInMem:200,telemetryTenants:{signaling:"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413",media:"1cae5691997646c98b01d15beddae7a3-ce16e198-bc32-420f-ac64-42bb916111af-6865"},collectorUrl:"https://ic3.events.data.microsoft.com/OneCollector/1.0/",transmitProfileName:"REAL_TIME",transmitProfileTimings:[],waitReportStatsAtCallStop:!1,oneStreamPerDeviceType:!1,enableWebRtcInternalsLogs:!1,enableMultiViewStats:!1,webrtcBWJumpLowerLimit:1e5,webrtcBWJumpUpperLimit:3e5,maxKeyFrameTimestampsInBucket:5,enableAudioSharing:!1,enableDevtoolsAPI:!1,enableWebRtcDataChannel:!1,noDummyLocalPreview:!1}},e.prototype.getEnforcedSettings=function(){return{}},e}(),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getEnforcedSettings=function(){return{preferSdesSrtp1on1:!1,preferSdesSrtpMultiparty:!1,webrtcSimulcastSessionEnabled:!0,webrtcUnifiedPlanEnabled1on1:!0,webrtcUnifiedPlanEnabledMultiparty:!0,webrtcUseNewStatsApi:!0,permissions:{usePositiveInAdp:!1,useNegativeInAdp:!1,adpFallback:!0,adpFallbackAudio:!0,adpFallbackVideo:!1,adpRequestAVLast:!1,rememberNegative:!0},devicePollingInterval:1e4,devicePollingAlwaysOn:!0,audioRendererUsePauseOnDetach:!0,subscribeToSsrcForVideo:!0,webrtcEnabledCustomBwEstimationForVideo:!1,insertFakeCandidateIfNeeded:!0,noDummyLocalPreview:!0}},t}(s),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getEnforcedSettings=function(){return{preferSdesSrtp1on1:!1,preferSdesSrtpMultiparty:!1,webrtcSimulcastSessionEnabled:!0,webrtcUnifiedPlanEnabled1on1:!0,webrtcUnifiedPlanEnabledMultiparty:!0,webrtcUseNewStatsApi:!0,webrtcEnabledCustomBwEstimationForVideo:!1,oneStreamPerDeviceType:!0}},t}(s),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getEnforcedSettings=function(){return{oneStreamPerDeviceType:!0}},t}(s),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getEnforcedSettings=function(){return{waitReportStatsAtCallStop:!0}},t}(s),p=[{clockRate:9e4,mimeType:"video/H264"},{clockRate:9e4,mimeType:"video/VP8"},{clockRate:9e4,mimeType:"video/rtx"},{clockRate:9e4,mimeType:"video/VP9"},{clockRate:9e4,mimeType:"video/red"},{clockRate:9e4,mimeType:"video/ulpfec"}]},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(14),l=n(16),u=n(6),d=n(177),p=n(22),f=n(178),h=n(0),g=n(2),m=n(9),v=n(198),y=n(97),S=n(203),_=n(204),E=function(e){function t(t,n,i,r){var a=e.call(this)||this;return a.logger=t,a.configProvider=n,a.domOverrides=i,a.ufdManager=r,a.activeRenderers=[],a.localVideoRendererId=0,a.selectedDevices={camera:null,microphone:null,speaker:null},a.pendingDevices=null,a.streamManagerSubscriptions=[],a.streamSubscriptions=new Map,a.rendererSubscriptions=new Map,a.deviceEnumerator=new v.DeviceEnumerator(n,a.logger.createChild("DeviceEnumerator")),a.permissionManager=new _.PermissionManager(n,{getMediaStream:function(e){return a.getMediaStream(o({},e,{withTimeout:!0}))},hasCamera:function(){return a.hasDeviceType("camera")},raiseTelemetryEvent:function(e,t){return a.raiseTelemetryEvent(e,t)},getActiveConstraints:function(){return a.mediaStreamManager.getActiveConstraints()},handlePermissionStateChange:function(){return a.handlePermissionStateChange()}},a.logger.createChild("PermissionManager")),a.permissionManager.on("onDevicesPermissionChanged",function(){return a.event("onDevicesPermissionChanged").raise()}),a.deviceList.on("onDevicesChanged",function(e){return a.onDevicesChanged(e)}),a.deviceSelection.on("onSelectedDevicesChanged",function(e){return a.onSelectedDevicesChanged(e)}),a.deviceEnumerator.initialize(),a.mediaStreamManager=new f.MediaStreamManager(a.logger.createChild("MediaStreamManager"),a,a.configProvider),a.subscribeOnStreamManagerEvents(a.mediaStreamManager),a}return r(t,e),Object.defineProperty(t.prototype,"devices",{get:function(){return this.deviceList.devices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceList",{get:function(){return this.deviceEnumerator.list},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceSelection",{get:function(){return this.deviceEnumerator.selection},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInitialized",{get:function(){return this.deviceEnumerator.isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return this.configProvider.userAgentConfig.isAudioOutputSelectionSupported},enumerable:!0,configurable:!0}),t.prototype.createPreviewRenderer=function(e){var t=new d.LocalVideoRenderer(e,this,this.logger.createChild("LocalRenderer:"+this.localVideoRendererId++));return this.domOverrides.onMediaElementAdded&&this.domOverrides.onMediaElementAdded(t.getVideoElement()),this.subscribeOnRendererEvents(t),t},t.prototype.askDevicePermission=function(e){var t=this;return this.isInitialized.promise.then(function(){return t.permissionManager.askDevicePermission(e)})},t.prototype.getPermissionState=function(e){return this.permissionManager.getPermissionState(e)},t.prototype.handlePermissionStateChange=function(){this.event("onPermissionStateChanged").raise()},t.prototype.createDevicesHandle=function(e){return new S.DevicesHandle(this.logger.createChild("DevicesHandle"),this.getMediaStream(o({},e,{withTimeout:!1})))},t.prototype.getAllowedModalities=function(){var e=h.shallowClone(this.permissionManager.browserPermittedModalities);return this.hasDeviceType("microphone")||(e.audio=[g.default.MEDIA_STATE.inactive,g.default.MEDIA_STATE.receive]),this.hasDeviceType("camera")||(e.video=[g.default.MEDIA_STATE.inactive,g.default.MEDIA_STATE.receive]),e},t.prototype.getAudioStream=function(){return this.getMediaStream({audio:!0,withTimeout:this.permissionManager.isPermissionKnown("microphone")})},t.prototype.getVideoStream=function(){return this.getMediaStream({video:!0,withTimeout:this.permissionManager.isPermissionKnown("camera")})},t.prototype.getDisplayStream=function(e){var t=e&&this.configProvider.config.enableAudioSharing;return this.getMediaStream({audio:t,sharing:!0,withTimeout:!1})},t.prototype.enumerateDevicesAsync=function(){var e=this;return this.isInitialized.promise.then(function(){return e.getDeviceDescriptions(e.devices)})},t.prototype.getDeviceNameAsync=function(e){var t=this;return this.isInitialized.promise.then(function(){var n=t.devices.find(function(t){return t.guid===e});return n&&n.label?n.label:""})},t.prototype.getSpeakerDeviceDomIdAsync=function(e){var t=this;return this.isInitialized.promise.then(function(){var n=t.devices.find(function(t){return t.guid===e});return n&&n.deviceId?n.deviceId:""})},t.prototype.selectDevices=function(e){var t=this;return this.pendingDevices?(this.logger.safe.info("Overriding device selection until enumeration is complete with "+m.scrubDevices(this.pendingDevices,this.configProvider.config.devices.piiSafeWords)),void(this.pendingDevices=e)):this.isInitialized.isPending?(this.logger.safe.info("Postponing device selection until enumeration is complete"),this.pendingDevices=e,void this.isInitialized.promise.then(function(){t.logger.safe.info("Performing postponed device selection");var e=t.pendingDevices;t.pendingDevices=null,t.selectDevices(e)})):void this.deviceSelection.selectDevices(e)},t.prototype.getSelectedDevices=function(){return this.toSelectedDevices(this.deviceSelection.selectedDevices)},t.prototype.getOutputDeviceId=function(){return this.selectedDevices.speaker&&this.selectedDevices.speaker.deviceId},t.prototype.getDeviceDescriptions=function(e){return(e||this.devices).map(function(e){return e.toDeviceDesc()})},t.prototype.getDevicesCount=function(){return this.devices.reduce(function(e,t){return e[t.type]++,e},{camera:0,speaker:0,microphone:0,compositeAudio:0})},t.prototype.getKnownPermissionStates=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.permissionManager.initialize()];case 1:return e.sent(),[2,this.permissionManager.knownPermissionStates]}})})},t.prototype.dispose=function(){this.unsubscribeFromStreamManagerEvents(),this.deviceEnumerator.dispose(),this.mediaStreamManager.dispose(),e.prototype.dispose.call(this)},t.prototype.toSelectedDevices=function(e){var t={};return Object.keys(e).forEach(function(n){e[n]&&(t[n]=e[n].guid)}),t},t.prototype.getActiveDevices=function(e,t){var n=e.rawStream;if(!n)return this.logger.safe.error("no gum stream found for media stream "+JSON.stringify(e)),null;var i=n.getAudioTracks()&&n.getAudioTracks()[0],r=n.getVideoTracks()&&n.getVideoTracks()[0];return{microphone:this.getActiveDevice(i,t.audio),camera:this.getActiveDevice(r,t.video)}},t.prototype.getActiveDevice=function(e,t){var n=this,i=t&&t.deviceId===g.default.MEDIA_DEVICE.defaultId;if(e&&e.getSettings){var r=e.getSettings();if(r){var o=this.devices.find(function(e){return e.deviceId===r.deviceId});return o?{device:o,isMarkedDefault:i}:(this.logger.safe.error("Active device not found","Device id from track: '"+l.scrubMriOrOmit(r.deviceId)+"', known devices: ["+this.devices.map(function(e){return m.scrubDevices(e,n.configProvider.config.devices.piiSafeWords)})+"]}",JSON.stringify(r),JSON.stringify(t)),null)}}return null},t.prototype.getStreamConstraints=function(e){return e&&{deviceId:e.deviceId}},t.prototype.hasDeviceType=function(e){return h.values(this.devices).some(function(t){return t.type===e})},t.prototype.getConstraints=function(e){var t=this;if(!e.audio&&!e.video&&!e.sharing)throw new Error("requesting nothing");if(this.logger.safe.info("retrieving media stream: ",JSON.stringify(e)),e.sharing)return{audio:e.audio?{deviceId:g.default.SYSTEM_AUDIO_SOURCE_ID}:void 0,sharing:{deviceId:g.default.DISPLAY_SOURCE_ID}};var n=this.selectedDevices.microphone,i=this.selectedDevices.camera,r=e.audio&&n,o=e.video&&i;if(!r&&!o)throw{type:g.default.MEDIA_ERROR.noDeviceSelected,detail:"audio requested "+e.audio+", video requested: "+e.video+" Devices: "+JSON.stringify(this.devices.map(function(e){return m.scrubDevices(e,t.configProvider.config.devices.piiSafeWords)}))};var a=this.getStreamConstraints(n),s=this.getStreamConstraints(i);return{audio:e.audio&&a,video:e.video&&s,withTimeout:e.withTimeout}},t.prototype.getMediaStream=function(e){var t=this,n=this.getConstraints(e),i=this.mediaStreamManager.getMediaStream(n);return this.subscribeOnStreamEvents(i),i.start().then(function(){var n=i.hasAudio(),r=i.hasVideo();n&&t.signalDeviceGood("Audio",i.rawTrack.muted),r&&t.signalDeviceGood("Video",i.rawTrack.muted),t.permissionManager.update(e,e)}).catch(function(n){return t.handleUserMediaError(e,n)}),i},t.prototype.signalDeviceGood=function(e,t){this.ufdManager.signalDeviceEvent(0,"Good",e),this.ufdManager.signalDeviceEvent(1,"Good",e),this.ufdManager.signalDeviceEvent(3,"Good",e),t||"Audio"!==e||this.ufdManager.signalDeviceEvent(2,"Good","Audio")},t.prototype.handlePermissionDeniedError=function(e,t){e.sharing&&"Safari"===c.getBrowserInfo().name?this.ufdManager.signalDeviceEvent(3,"Bad",t):e.sharing||(e.audio&&!e.video?this.permissionManager.update({audio:!0},{audio:!1}):e.video&&!e.audio&&this.permissionManager.update({video:!0},{video:!1}))},t.prototype.handleUserMediaError=function(e,t){var n=this.getMediaType(e);switch(t.type){case g.default.MEDIA_ERROR.permissionDeniedError:this.handlePermissionDeniedError(e,n);break;case g.default.MEDIA_ERROR.permissionDeniedBySystemError:this.ufdManager.signalDeviceEvent(3,"Bad",n);break;case g.default.MEDIA_ERROR.sourceUnavailableError:this.ufdManager.signalDeviceEvent(0,"Bad",n);break;case g.default.MEDIA_ERROR.mediaStreamRequestTimedOut:this.ufdManager.signalDeviceEvent(1,"Bad",n);break;default:this.logger.safe.error("getMediaStream() error: "+h.stringifyObject(t))}},t.prototype.getMediaType=function(e){if(e.sharing)return"ScreenShare";if(e.video)return"Video";if(e.audio)return"Audio";throw new Error("mediaType is not defined for this constraint "+JSON.stringify(e))},t.prototype.subscribeOnStreamEvents=function(e){var t=this,n=[];n.push(e.on("onStreamClientStarted",function(e,n){return t.onStreamStarted(e,n)})),n.push(e.on("onStreamClientDisposing",function(e){return t.onStreamDisposing(e)})),n.push(e.on("onStreamClientEnded",function(e,n){return t.onStreamEnded(e,n)})),n.push(e.on("onStreamClientMuted",function(e,n){return t.onStreamMuted(e,n)})),n.push(e.on("onStreamClientError",function(e,n){return t.onStreamError(e,n)})),this.streamSubscriptions.set(e,n)},t.prototype.unsubscribeFromStreamEvents=function(e){this.streamSubscriptions.has(e)&&(this.streamSubscriptions.get(e).forEach(function(e){return e.dispose()}),this.streamSubscriptions.delete(e))},t.prototype.subscribeOnRendererEvents=function(e){var t=this,n=[];n.push(e.on("onRendererDisposed",function(e,n){return t.onRendererDisposed(e,n)})),n.push(e.on("onRendererStarted",function(e){return t.onRendererStarted(e)})),this.rendererSubscriptions.set(e,n)},t.prototype.unsubscribeFromRendererEvents=function(e){this.rendererSubscriptions.has(e)&&(this.rendererSubscriptions.get(e).forEach(function(e){return e.dispose()}),this.rendererSubscriptions.delete(e))},t.prototype.subscribeOnStreamManagerEvents=function(e){var t=this,n=[];n.push(e.on("onAllStreamsRemoved",function(){return t.onAllStreamsRemoved()})),n.push(e.on("onStreamAcquired",function(e,n,i,r){return t.onStreamAcquired(e,n,i,r)})),this.streamManagerSubscriptions=n},t.prototype.unsubscribeFromStreamManagerEvents=function(){this.streamManagerSubscriptions.forEach(function(e){return e.dispose()})},t.prototype.updateRenderersAsync=function(){var e=this;return Promise.all(this.activeRenderers.map(function(e){return e.updateStreamAsync()})).then(function(){e.logger.safe.info("Renderers updates finished")}).catch(function(t){e.logger.safe.error("Error updating renderers: "+h.stringifyObject(t))})},t.prototype.updateCameraSelectionStrategy=function(e){var t=y.getDeviceSelectionStrategy(e);this.deviceSelection.setCameraSelectionStrategy(t)},t.prototype.onSelectedDevicesChanged=function(e){var t=this.selectedDevices;if(this.selectedDevices=e,!("camera"in t^"camera"in this.selectedDevices||"microphone"in t^"microphone"in this.selectedDevices)){var n=this.toSelectedDevices(this.selectedDevices),i=this.toSelectedDevices(t);this.event("onSelectedDevicesChanged").raise(n,i);var r=this.configProvider.config.devices.piiSafeWords;this.raiseTelemetryEvent("selected_devices_changed",{microphone:this.selectedDevices.microphone&&h.scrubDeviceLabelPii(this.selectedDevices.microphone.label,r),camera:this.selectedDevices.camera&&h.scrubDeviceLabelPii(this.selectedDevices.camera.label,r),speaker:this.selectedDevices.speaker&&h.scrubDeviceLabelPii(this.selectedDevices.speaker.label,r)})}this.updateRenderersAsync()},t.prototype.onDevicesChanged=function(e){var t=this;this.event("onDevicesChanged").raise(e);var n=this.getDevicesCount();this.ufdManager.signalEvent("ZeroCaptureDevicesEnumerated",n.microphone>0?"Good":"Bad"),this.isAudioOutputSelectionSupported&&this.ufdManager.signalEvent("ZeroRenderDevicesEnumerated",n.speaker>0?"Good":"Bad");var i=new Map,r=1;this.raiseTelemetryEvent("devices_changed",{devices:e.map(function(e){var n=i.get(e.groupId)||r++;return i.set(e.groupId,n),{label:h.scrubDeviceLabelPii(e.label,t.configProvider.config.devices.piiSafeWords),isSystemDefault:e.isSystemDefault,kind:e.kind,type:e.type,groupId:""+n}}),debug:this.deviceList.debugInfo})},t.prototype.getDeviceListDebugInfo=function(){return this.deviceList.debugInfo},Object.defineProperty(t.prototype,"isPollingInProgress",{get:function(){return this.deviceEnumerator.isPollingInProgress},enumerable:!0,configurable:!0}),t.prototype.raiseTelemetryEvent=function(e,t){this.logger.safe.info("Device event: "+e+": "+JSON.stringify(this.scrubPayload(e,t))),this.event("onDeviceTelemetryEvent").raise({eventType:e,timestamp:Date.now(),payload:t})},t.prototype.scrubPayload=function(e,t){var n=this;if("selected_devices_changed"===e)return m.scrubDevices(t,this.configProvider.config.devices.piiSafeWords);if("devices_changed"===e){var i=t;return h.values(i.devices).map(function(e){return m.scrubDevices(e,n.configProvider.config.devices.piiSafeWords)})}return t},t.prototype.onStreamStarted=function(e,t){return a(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return this.permissionManager.browserPermittedModalities.audio.some(function(e){return e===g.default.MEDIA_STATE.send})||this.permissionManager.browserPermittedModalities.video.some(function(e){return e===g.default.MEDIA_STATE.send})?[4,this.deviceEnumerator.enumerateDevices()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.getDevicesAfterStreamStart(e,t),"Video"!==e.mediaType&&"ScreenShare"!==e.mediaType||this.notifyMaxVideoSendCapabilitiesChanged(e),[2]}})})},t.prototype.notifyMaxVideoSendCapabilitiesChanged=function(e){var t=e.getResolution(),n=new p.ResolutionInfo(t.width,t.height),i=e.getFrameRate(),r={maxFs:n.fs,maxMbps:n.fs*i,maxFps:i,maxWidth:n.width,maxHeight:n.height};this.logger.safe.info("Capabilities for "+e.mediaType+" stream: "+JSON.stringify(r)),this.event("onMaxVideoSendCapabilitiesChanged").raise(e.mediaType,r)},t.prototype.getDevicesAfterStreamStart=function(e,t){this.deviceEnumerator.startDevicePolling();var n=this.getActiveDevices(e,t);n&&this.deviceList.updateActiveDevices(n),"Video"===e.mediaType&&this.updateCameraSelectionStrategy(y.SelectionType.Manual)},t.prototype.onStreamDisposing=function(e){this.unsubscribeFromStreamEvents(e),"Video"===e.mediaType&&this.updateCameraSelectionStrategy(y.SelectionType.Automatic)},t.prototype.onStreamMuted=function(e,t){"Audio"===e.mediaType&&this.ufdManager.signalDeviceEvent(2,t?"Bad":"Good","Audio")},t.prototype.onStreamEnded=function(e,t){t.error?(this.raiseTelemetryEvent("stream_ended_error",{mediaType:e.mediaType,error:{type:t.error.name,detail:t.error.message}}),"SourceUnavailableError"===t.error.name&&this.ufdManager.signalDeviceEvent(0,"Bad","Audio")):("Audio"!==e.mediaType&&"Video"!==e.mediaType||this.ufdManager.signalDeviceEvent(0,"Bad",e.mediaType),this.raiseTelemetryEvent("stream_ended",e.mediaType))},t.prototype.onStreamError=function(e,t){this.raiseTelemetryEvent("stream_error",{mediaType:e.mediaType,error:t})},t.prototype.onAllStreamsRemoved=function(){this.configProvider.config.devicePollingAlwaysOn||this.deviceEnumerator.stopDevicePolling()},t.prototype.onStreamAcquired=function(e,t,n,i){0!==t&&this.raiseTelemetryEvent("stream_acquired",{mediaType:e,timestamp:t,resolution:n,withAudio:i})},t.prototype.onRendererDisposed=function(e,t){h.remove(this.activeRenderers,function(t){return t===e}),this.domOverrides.onMediaElementRemoved&&this.domOverrides.onMediaElementRemoved(t),this.unsubscribeFromRendererEvents(e)},t.prototype.onRendererStarted=function(e){this.activeRenderers.push(e)},t}(u.default);t.default=E},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(14),c=n(21),l=n(0),u=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.mediaStreamProvider=n,r.logger=i,r.isDisposed=!1,r.serialQueue=new c.PromiseQueue(r.logger.createChild("rendererQueue")),r.logger.safe.info("ctor"),r}return r(t,e),t.prototype.dispose=function(){this.logger.safe.info("dispose"),this.isDisposed=!0,this.event("onRendererDisposed").raise(this,this.getVideoElement()),e.prototype.dispose.call(this),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null)},t.prototype.startVideoAsync=function(){var e=this;return this.logger.safe.info("starting local video"),this.event("onRendererStarted").raise(this),this.serialQueue.add(function(){return e.restartVideo()})},t.prototype.updateStreamAsync=function(){var e=this;return this.logger.safe.info("updating local video"),this.serialQueue.add(function(){return e.restartVideo()})},t.prototype.restartVideo=function(){return o(this,void 0,void 0,function(){var e,t;return a(this,function(n){switch(n.label){case 0:e=this.mediaStreamProvider.getVideoStream(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.start()];case 2:if(n.sent(),this.isDisposed)throw e.dispose(),new Error("local video renderer is disposed");return this.attachStream(e),[3,4];case 3:throw t=n.sent(),this.mediaStreamProvider.raiseTelemetryEvent("video_preview_error",{mediaType:"Video",error:l.stringifyObject(t)}),t;case 4:return[2]}})})},t.prototype.attachStream=function(t){if(this.logger.safe.info("attach media stream "+(t&&t.id)),this.mediaStream!==t)try{this.mediaStream&&("Edge"===s.getBrowserInfo().name&&e.prototype.reattachEventListeners.call(this),this.mediaStream.dispose(),this.mediaStream=null),t&&e.prototype.attachMediaStream.call(this,t.rawStream),this.mediaStream=t}catch(e){throw t&&t.dispose(),e}},t}(n(49).VideoRendererBase);t.LocalVideoRenderer=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=n(6),s=n(21),c=n(9),l=n(27),u=n(179),d=n(193),p=function(e){function t(t,n,i){var r=e.call(this)||this;return r.logger=t,r.deviceManager=n,r.configProvider=i,r.cachedStreamsSubs=new Map,r.cachedStreamsMap=new Map,r.mediaStreamSerialQueue=new s.PromiseQueue(r.logger),r.deviceManager.on("onDevicesChanged",function(e){return r.onDevicesChanged(e)}),r}return r(t,e),t.prototype.getMediaStream=function(e){var t=this;this.logger.safe.info("retrieving media stream: "+JSON.stringify(c.scrubConstraints(e)));var n=this.getSuitableStream(e);n||(this.logger.safe.info("cached stream is not found. Creating a new one with constraints: "+c.scrubConstraints(e)),n=this.createCachedStream(e));var i=n.getClient();return i.start().catch(function(e){t.logger.safe.error("could not start media stream: "+n.id+", total streams: "+t.cachedStreamsMap.size+", error: "+JSON.stringify(e)),t.removeStream(n)}),i},t.prototype.dispose=function(){this.cachedStreamsSubs&&(this.cachedStreamsSubs.forEach(function(e){return e.forEach(function(e){return e.dispose()})}),this.cachedStreamsSubs=null),this.cachedStreamsMap&&(this.cachedStreamsMap.forEach(function(e){return e.dispose()}),this.cachedStreamsMap=null),this.mediaStreamSerialQueue&&(this.mediaStreamSerialQueue.dispose(),this.mediaStreamSerialQueue=null),e.prototype.dispose.call(this)},t.prototype.getCachedStreams=function(){return this.cachedStreamsMap},t.prototype.getActiveConstraints=function(){var e={audio:!1,video:!1,sharing:!1};return this.cachedStreamsMap.forEach(function(t,n){n.audio&&(e.audio=!0),n.video&&(e.video=!0),n.sharing&&(e.sharing=!0)}),e},t.prototype.getSuitableStream=function(e){var t,n=this;return this.cachedStreamsMap.forEach(function(i,r){n.isSuitable(r,e)&&(t=r)}),t&&this.cachedStreamsMap.get(t)},t.prototype.createCachedStream=function(e){var t=this.createStream(e);return this.subscribeOnStreamEvents(t),this.logger.safe.info("created media stream, id: "+t.id+" total: "+this.cachedStreamsMap.size),this.cachedStreamsMap.set(e,t),t},t.prototype.disposeCurrentDeviceStream=function(e){this.cachedStreamsMap.forEach(function(t,n){(e.audio&&n.audio&&e.audio.deviceId!==n.audio.deviceId||e.video&&n.video&&e.video.deviceId!==n.video.deviceId)&&t.dispose()})},t.prototype.createStream=function(e){return this.configProvider.config.oneStreamPerDeviceType&&this.disposeCurrentDeviceStream(e),this.configProvider.config.webrtcSimulcastSessionEnabled&&l.UserAgentConfig.hasApplyConstraints()&&"Edge"!==o.getBrowserInfo().name?new d.SimulcastMediaStream(e,this.mediaStreamSerialQueue,this.configProvider,this.logger):new u.MediaStreamInternal(e,this.mediaStreamSerialQueue,this.logger,this.configProvider)},t.prototype.subscribeOnStreamEvents=function(e){var t=this,n=[];n.push(e.on("onStreamAcquired",function(e,n,i){return t.onStreamAcquired(e,n,i)})),n.push(e.on("onStreamDisposing",function(e){return t.onStreamDisposing(e)})),this.cachedStreamsSubs.set(e,n)},t.prototype.unsubscribeFromStreamEvents=function(e){this.cachedStreamsSubs.get(e).forEach(function(e){return e.dispose()}),this.cachedStreamsSubs.delete(e)},t.prototype.removeStream=function(e){this.logger.safe.info("release media stream generation: "+e.id+" cached: "+this.cachedStreamsMap.size),this.cachedStreamsSubs.has(e)?(this.unsubscribeFromStreamEvents(e),this.cachedStreamsMap.delete(this.getConstraintsForStream(e)),this.cachedStreamsMap.size||this.event("onAllStreamsRemoved").raise()):this.logger.safe.warn("skipping unknown stream "+e.id)},t.prototype.getConstraintsForStream=function(e){var t;return this.cachedStreamsMap.forEach(function(n,i){e===n&&(t=i)}),t},t.prototype.isSuitable=function(e,t){var n=this.isAcceptable(e.audio,t.audio),i=this.isAcceptable(e.video,t.video),r=this.isAcceptable(e.sharing,t.sharing);return n&&i&&r},t.prototype.isAcceptable=function(e,t){return!e&&!t||e&&t&&e.deviceId===t.deviceId},t.prototype.isDeviceOutdated=function(e,t){return e&&e.deviceId&&!t.some(function(t){return t.deviceId===e.deviceId})},t.prototype.onStreamDisposing=function(e){this.logger.safe.info("onStreamDisposing event "+e.id),this.removeStream(e)},t.prototype.onStreamAcquired=function(e,t,n){var i="Audio"===e.mediaType?void 0:!!e.rawStream.getAudioTracks()[0];this.event("onStreamAcquired").raise(e.mediaType,t,n,i)},t.prototype.onDevicesChanged=function(e){var t=this;this.cachedStreamsMap.forEach(function(n,i){if(!i.sharing){var r=t.isDeviceOutdated(i.audio,e),o=t.isDeviceOutdated(i.video,e);(r||o)&&t.cachedStreamsMap.delete(i)}})},t}(a.default);t.MediaStreamManager=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=n(14),c=n(6),l=n(2),u=n(9),d=n(18),p=n(0),f=n(89),h=n(93),g=n(94),m=n(192),v=n(51),y=function(e){function t(n,i,r,o){var a=e.call(this)||this;return a.streamConstraints=n,a.serialQueue=i,a.configProvider=o,a.clientId=0,a.clients=[],a.gumStreams={},a.clientGumStreams=[],a.streamsDump=[],a.isMuted=!1,a.isHold=!1,a.gumStartTime=0,a.streamId=t.streamGeneration++,a.logger=r.createChild("MediaStream:"+a.streamId),a.mediaType=a.getMediaType(a.streamConstraints),a.constraintsProvider=f.ConstraintsProviderFactory.getProvider(a.mediaType,a.configProvider,a.logger),a.currentConstraints=a.constraintsProvider.createConstraintsObject(n),a}return r(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.streamId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawStream",{get:function(){return this.currentGumStream},enumerable:!0,configurable:!0}),t.prototype.applyCapabilities=function(e){var t=this;if(this.currentGumStream){var n=this.constraintsProvider.updateVideoConstraints(this.currentConstraints,e,this.getResolution());if(!n)return Promise.resolve(!1);if(this.currentConstraints!==n){this.currentConstraints=n;var i=this.currentConstraints;return this.hasDisplay()?this.applyConstraints(this.currentConstraints).then(function(){return p.deepEqual(t.currentConstraints,i)}).catch(function(e){return t.logger.safe.error("Apply constraints error: "+p.stringifyObject(e)),!1}):this.applyConstraintsInternal().then(function(){return p.deepEqual(t.currentConstraints,i)})}}return Promise.resolve(!1)},t.prototype.getClient=function(){var e,t;this.currentGumStream?(t=this.getClone(),this.clientGumStreams.push(((e={})[this.constraintsProvider.getKey(this.currentConstraints)]=t,e))):this.clientGumStreams.push({});var n=new m.MediaStreamClient(this,t,this.logger.createChild("Client:"+this.clientId++));return this.clients.push(n),n},t.prototype.getClone=function(){return this.hasDisplay()?this.currentGumStream:this.currentGumStream.clone()},t.prototype.setMuted=function(e){this.isMuted=e,this.clients.forEach(function(t){t.setMuted(e)}),this.enableDisableTracks()},t.prototype.getMuted=function(){return this.isMuted},t.prototype.setHold=function(e){this.isHold=e,this.clients.forEach(function(t){t.setHold(e)}),this.enableDisableTracks()},t.prototype.disposeClient=function(e){var t=this.clients.indexOf(e);if(t>=0&&(this.clients.splice(t,1),this.streamsDump.push(this.clientGumStreams[t]),this.clientGumStreams.splice(t,1),0===this.clients.length))return this.disposeStream()},t.prototype.getMixer=function(){return null},t.prototype.dispose=function(){for(var e=this.clients.length-1;e>=0;e--)this.clients[e].dispose()},t.prototype.disposeStream=function(){var t=this;this.event("onStreamDisposing").raise(this),this.stopGumStream().then(function(){t.event("onStreamDisposed").raise(t)}).catch(function(e){t.event("onStreamError").raise(t,e)}).then(function(){t.constraintsProvider=null,t.serialQueue=null,t.configProvider=null,t.logger=t.logger.createChild("DISPOSED"),e.prototype.dispose.call(t)})},t.prototype.start=function(){var e=this;return this.gumPromise||(this.currentConstraints.video&&"Edge"!==s.getBrowserInfo().name?this.gumPromise=this.applyConstraintsInternal():this.gumPromise=this.updateGumStreamInternal(this.currentConstraints),this.gumPromise=this.gumPromise.then(function(){e.event("onStreamStarted").raise(e,e.currentConstraints)}).catch(function(t){throw e.event("onStreamError").raise(e,t),t})),this.gumPromise},t.prototype.hasAudio=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getAudioTracks().length},t.prototype.hasVideo=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getVideoTracks().length&&this.currentConstraints.video&&this.currentConstraints.video.deviceId!==l.default.DISPLAY_SOURCE_ID},t.prototype.hasDisplay=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getVideoTracks().length&&this.currentConstraints.video&&this.currentConstraints.video.deviceId===l.default.DISPLAY_SOURCE_ID},t.prototype.getVideoDeviceId=function(){return this.currentConstraints.video.deviceId},t.prototype.getResolution=function(){var e=this;if(!["Video","ScreenShare","PanoramicVideo"].some(function(t){return t===e.mediaType}))return null;var t={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},n=v.getResolutionForStream(this.currentGumStream,t);return n===t?this.logger.safe.error("Stream resolution is not avalable, assuming we're at "+t.width+"x"+t.height+" now"):this.logger.safe.info("Stream resolution is "+n.width+"x"+n.height),n},t.prototype.getFrameRate=function(){var e=this;if(!["Video","ScreenShare","PanoramicVideo"].some(function(t){return t===e.mediaType}))return null;var t=v.getFrameRateForStream(this.currentGumStream);return 0===t?this.logger.safe.error("Stream frame rate is not avalable, returning 0"):this.logger.safe.info("Stream fps is "+t),t},t.prototype.getMediaType=function(e){if(e.sharing)return"ScreenShare";if(e.video)return"Video";if(e.audio)return"Audio";throw new Error("Media type is not defined: "+JSON.stringify(e))},t.prototype.updateClients=function(e){var t=this,n=this.constraintsProvider.getKey(e);this.clients.forEach(function(e,i){t.clientGumStreams[i][n]||(t.clientGumStreams[i][n]=t.getClone()),e.update(t.clientGumStreams[i][n])})},t.prototype.applyConstraints=function(e){var t=this.getGumStreamProvider();return Promise.all(this.clients.map(function(n){return t.applyConstraints(n.rawStream,e)})).then(function(){})},t.prototype.applyConstraintsInternal=function(){var e=this;return new Promise(function(t,n){e.logger.safe.info("applying stream constraints: "+JSON.stringify(u.scrubConstraints(e.currentConstraints)));var i=new d.SettablePromise;e.clients.forEach(function(e){e.onApplyConstraints&&e.onApplyConstraints(i.promise)}),t(e.serialQueue.add(function(){var t=new h.RequestPolicyGenerator(e.configProvider).getPolicies(e.currentConstraints);return e.gumPromise=e.updateGumStreamInternal(t[0]),t.slice(1).forEach(function(t){e.gumPromise=e.gumPromise.catch(function(n){if(l.default.MEDIA_ERROR.constraintNotSatisfiedError===n.type)return e.logger.safe.warn("could not obtain constrained media stream, will attempt weaker policy"),e.updateGumStreamInternal(t);throw n.constraints=t,n})}),e.gumPromise}).then(function(){return i.resolve()}).catch(function(t){throw e.logger.safe.error("failed to apply constraints: "+JSON.stringify(u.scrubConstraints(t.constraints))+" error: "+p.stringifyObject(t)),i.reject(t),t}))})},t.prototype.enableDisableTracks=function(){var e=this;this.currentGumStream&&this.currentGumStream.getTracks().forEach(function(t){void 0!==t.enabled&&(t.enabled=!("audio"===t.kind&&e.isMuted||e.isHold),e.logger.safe.info("control media stream track kind: "+t.kind+" enabled: "+t.enabled+" muted: "+t.muted))})},t.prototype.getGumStreamProvider=function(){return g.GumStreamProviderFactory.getStreamProvider(this.mediaType,this.configProvider,this.logger.createChild("MSProvider"))},t.prototype.updateGumStreamInternal=function(e){var t=this;return Promise.resolve().then(function(){t.logger.safe.info("querying user media for stream: "+JSON.stringify(e));var n=t.gumStreams[t.constraintsProvider.getKey(e)];if(n)return n;var i=t.getGumStreamProvider();return t.startRequestCalculation(),i.getStream(e)}).then(function(n){n.getAudioTracks().forEach(function(e){e.onended=function(e){t.logger.safe.info("Audio stream track ended: "+JSON.stringify(e.error&&e.error.name||e)),t.event("onStreamTrackEnded").raise(t,e)},e.onmute=function(){t.logger.safe.info("Audio stream track muted"),t.event("onStreamTrackMuted").raise(t,!0)},e.onunmute=function(){t.logger.safe.info("Audio stream track unmuted"),t.event("onStreamTrackMuted").raise(t,!1)},e.muted&&t.event("onStreamTrackMuted").raise(t,!0),t.logger.safe.info("Audio track added: "+JSON.stringify(e.id))}),t.currentGumStream=n,t.currentConstraints=e.video?t.constraintsProvider.updateResolution(e,t.getResolution()):e,t.logger.safe.info("Stream constraints updated: "+JSON.stringify(t.currentConstraints));var i=t.constraintsProvider.getKey(t.currentConstraints);t.gumStreams[i]!==n&&(t.gumStreams[i]&&(t.logger.safe.info("Stream cache hit for "+i+", stopping old stream"),t.stopOneGumStream(t.gumStreams[i])),t.gumStreams[i]=n),t.updateClients(t.currentConstraints);var r=n.getVideoTracks()[0];r&&(r.onmute=function(e){t.logger.safe.error("Video stream track muted: "+JSON.stringify(u.scrubConstraints(t.currentConstraints))+"; "+JSON.stringify(e))},r.onended=function(e){t.logger.safe.info("Video stream track ended: "+JSON.stringify(u.scrubConstraints(t.currentConstraints))+"; "+JSON.stringify(e.error&&e.error.name||e)),t.event("onStreamTrackEnded").raise(t,e)},t.hasDisplay()&&t.configProvider.config.webrtcDisplayStreamContentHint&&t.applyContentHint(r,t.configProvider.config.webrtcDisplayStreamContentHint),t.logger.safe.info("Video track added: "+JSON.stringify(r.id))),t.enableDisableTracks(),t.logger.safe.info("media stream updated");var o=t.stopRequestCalculation();t.event("onStreamAcquired").raise(t,o,(t.hasVideo()||t.hasDisplay())&&t.getResolution()||void 0)})},t.prototype.applyContentHint=function(e,t){["","text","detail","motion"].indexOf(t)<0?this.logger.safe.error("Cannot apply content hint: "+t):(this.logger.safe.info("Apply content hint: "+t),e.contentHint=t)},t.prototype.startRequestCalculation=function(){this.gumStartTime=Date.now()},t.prototype.stopRequestCalculation=function(){if(0===this.gumStartTime)return 0;var e=Date.now()-this.gumStartTime;return this.gumStartTime=0,e},t.prototype.stopGumStream=function(){var e=this;return this.gumPromise?(this.logger.safe.info("queueing media stream stop"),this.serialQueue.add(function(){return e.stopGumStreamInternal()})):Promise.resolve()},t.prototype.stopOneGumStream=function(e){var t=this;try{e.getTracks().forEach(function(e){t.logger.safe.info("Track is stopped: "+JSON.stringify(e.id)),e.onended=null,e.onmute=null,e.stop()}),this.logger.safe.info("media stream stopped")}catch(e){this.logger.safe.warn("failed to stop media stream: "+p.stringifyObject(e))}},t.prototype.stopGumStreamInternal=function(){var e=this;this.currentGumStream&&(a(this.clientGumStreams,this.streamsDump,[this.gumStreams]).forEach(function(t){return p.forOwn(t,function(t){return e.stopOneGumStream(t)})}),this.gumStreams={},this.clientGumStreams=[],this.streamsDump=[],this.currentGumStream=null)},t.streamGeneration=0,t}(c.default);t.MediaStreamInternal=y},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(90),s=n(50),c=n(91),l=n(181),u=n(92),d=function(e){function t(t){var n=e.call(this,t)||this;return n.initialConstraints={maxWidth:1920,minWidth:1920,maxHeight:1080,minHeight:1080,fps:15},n.maxCapabilities={maxFs:8160,maxFps:15},n.validator=new u.VideoCapabilitiesValidator(n.logger.createChild("CV"),n.maxCapabilities),n.constraintsCalculator=new l.SharingConstraintsCalculator(n.logger.createChild("CC")),n}return r(t,e),t.prototype.createConstraintsObject=function(e){if(!e.sharing)throw new Error("Sharing constraints are not presented: "+JSON.stringify(e));var t=this.convertConstraints(e.sharing,this.initialConstraints),n=e.audio?{}:null;return new s.ConstraintsObject(n,t,!1)},t.prototype.generatePolicies=function(e){return[e]},t.prototype.calculateConstraints=function(e,t){this.logger.safe.info("Stream resolution is "+JSON.stringify(t));var n=this.validator.ensureValidity(e);return this.constraintsCalculator.calculateConstraints(n,t)},t}(c.ConstraintsProviderBase);t.SharingConstraintsProvider=d;var p=function(e){function t(t,n){var i,r,s,c,l=e.call(this,t)||this,u=n.screen.width/n.screen.height;u<1&&(i=o([l.initialConstraints.maxHeight,l.initialConstraints.maxWidth],2),l.initialConstraints.maxWidth=i[0],l.initialConstraints.maxHeight=i[1],r=o([l.initialConstraints.minHeight,l.initialConstraints.minWidth],2),l.initialConstraints.minWidth=r[0],l.initialConstraints.minHeight=r[1]);var d=a.adjustResolitionToAspectRatio({width:l.initialConstraints.maxWidth,height:l.initialConstraints.maxHeight},u);return s=o([d.width,d.height],2),l.initialConstraints.maxWidth=s[0],l.initialConstraints.maxHeight=s[1],d=a.adjustResolitionToAspectRatio({width:l.initialConstraints.minWidth,height:l.initialConstraints.minHeight},u),c=o([d.width,d.height],2),l.initialConstraints.minWidth=c[0],l.initialConstraints.minHeight=c[1],l}return r(t,e),t}(d);t.SafariSharingConstraintsProvider=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(90),r=function(){function e(){this.MAX_SHARING_WIDTH=1920,this.MAX_SHARING_HEIGHT=1080}return e.prototype.getResolutionTable=function(e,t){var n=this.constraintToMaxResolution(e,t);return this.generateResolutionTable(n)},e.prototype.constraintToMaxResolution=function(e,t){var n=this.getPortraitOrLandscapeMaxResolution(e),r=i.adjustResolitionToAspectRatio({width:e.width,height:e.height},t),o=n.width/r.width,a=n.height/r.height,s=Math.min(o,a);return this.resizeResolution(r,s)},e.prototype.resizeResolution=function(e,t){return{width:Math.round(e.width*t),height:Math.round(e.height*t)}},e.prototype.getPortraitOrLandscapeMaxResolution=function(e){return e.width>e.height?{width:this.MAX_SHARING_WIDTH,height:this.MAX_SHARING_HEIGHT}:{width:this.MAX_SHARING_HEIGHT,height:this.MAX_SHARING_WIDTH}},e.prototype.ceilToMackroblockSize=function(e){var t=e.width,n=e.height;return{width:16*Math.ceil(t/16),height:16*Math.ceil(n/16)}},e.prototype.generateResolutionTable=function(e){var t=this;return[1,2/3,1/3,1/6].map(function(n){return t.resizeResolution(e,n)}).map(function(e){return t.ceilToMackroblockSize(e)})},e}();t.ResolutionTableCalculator=r;var o=function(){function e(e){this.logger=e,this.FPS_TABLE=[15,7.5,3.75,1.875],this.resolutionTableCalculator=new r,this.initialAspectRatio=null}return e.prototype.calculateConstraints=function(e,t){var n=this;this.initialAspectRatio||(this.initialAspectRatio=t.width/t.height);var i=this.resolutionTableCalculator.getResolutionTable(t,this.initialAspectRatio),r={resolution:i[i.length-1],fps:this.FPS_TABLE[this.FPS_TABLE.length-1]};return i.some(function(t){var i=n.getFs(t);return n.FPS_TABLE.some(function(o){var a=n.getMbps(i,o);return i<=e.maxFs&&o<=e.maxFps&&a<=e.maxMbps&&(r={resolution:t,fps:o},!0)})})?this.logger.safe.info("Calculated resolution: "+JSON.stringify(r)):this.logger.safe.error("None of available resolutions are suitable: "+JSON.stringify(i)+". Fallback to: "+JSON.stringify(r)),r},e.prototype.getMbps=function(e,t){return e*t},e.prototype.getFs=function(e){return Math.ceil(e.width/16)*Math.ceil(e.height/16)},e}();t.SharingConstraintsCalculator=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(50),a=n(91),s=n(22),c=n(14),l=function(e){function t(t,n){var i=e.call(this,n)||this;return i.configProvider=t,i.resTable=new s.default(t),i}return r(t,e),t.prototype.createConstraintsObject=function(e){var t=this.convertConstraints(e.audio),n=this.convertConstraints(e.video,this.initialVideoConstraints);return new o.ConstraintsObject(t,n,e.withTimeout)},t.prototype.calculateConstraints=function(e){return{resolution:this.resTable.getResolution(e.maxFs),fps:e.maxFps}},Object.defineProperty(t.prototype,"initialVideoConstraints",{get:function(){var e="Edge"===c.getBrowserInfo().name?this.resTable.initialResolution:this.resTable.getResolution(this.configProvider.config.webrtcCameraOpenFs);return{maxWidth:e.width,minWidth:e.width,maxHeight:e.height,minHeight:e.height,fps:30}},enumerable:!0,configurable:!0}),t}(a.ConstraintsProviderBase);t.VideoConstraintsProvider=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(95),a=n(12),s=n(184),c=n(185),l=function(e){function t(t){var n=e.call(this,t)||this;return n.constraintsAdapter=new s.OrtcConstraintsAdapter,n}return r(t,e),t}(o.GumStreamProviderBase);t.ORTCMediaStreamProvider=l;var u=function(e){function t(t){var n=e.call(this,t.createChild("ORTCDispProvider"))||this;return n.constraintsAdapter=new c.OrtcDisplayConstraintsAdapter,n}return r(t,e),t.isSupported=function(){return!!window.navigator.getDisplayMedia},t.prototype.getStream=function(e){var t=this.constraintsAdapter.toGumConstraints(e);return this.logger.safe.info("Constraints to be applied: "+JSON.stringify(t)),a.default.window.navigator.getDisplayMedia(t)},t}(o.GumStreamProviderBase);t.ORTCDisplayStreamProvider=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={};return e.audio&&(t.audio={},e.audio.deviceId&&e.audio.deviceId!==i.default.MEDIA_DEVICE.defaultId&&(t.audio.deviceId={exact:e.audio.deviceId})),e.video&&(t.video={},e.video.deviceId&&(t.video.deviceId={exact:e.video.deviceId}),e.video.minWidth&&(t.video.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.fps=e.video.fps)),t},e.prototype.toTrackConstraints=function(e){throw new Error("Track constraints not supported for ORTC")},e}();t.OrtcConstraintsAdapter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={video:{}};return e.video.minWidth&&(t.video.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.fps=e.video.fps),t},e.prototype.toTrackConstraints=function(e){throw new Error("Track constraints not supported for ORTC")},e}();t.OrtcDisplayConstraintsAdapter=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(95),a=n(96),s=n(12),c=n(2),l=n(0),u=n(187),d=n(188),p=n(189),f=n(190),h=n(191),g=function(e){function t(t,n){var i=e.call(this,n.createChild("WebRTCProvider"))||this;return i.configProvider=t,i.timeoutId=null,void 0!==navigator.webkitGetUserMedia&&void 0!==webkitRTCPeerConnection?i.constraintsAdapter=new d.WebKitConstraintsAdapter:navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&(i.constraintsAdapter=new p.WebRTCConstraintsAdapter),i}return r(t,e),t.prototype.getStream=function(t){var n=this;if(!t.withTimeout||!this.configProvider.config.gumRequestTimeout)return e.prototype.getStream.call(this,t);var i=this.startGumRequestTimer(t),r=e.prototype.getStream.call(this,t).then(function(e){if(!n.timeoutId)throw n.stopStreamAfterTimeout(e,t),n.getMediaStreamTimeoutError(t);return n.stopGumRequestTimer(),e});return Promise.race([i,r]).catch(function(e){throw n.stopGumRequestTimer(),e})},t.prototype.getMediaStreamTimeoutError=function(e){var t={name:c.default.MEDIA_ERROR.mediaStreamRequestTimedOut,message:null,constraintName:null};return new a.MediaStreamErrorDecorator(t,e).getMediaError()},t.prototype.startGumRequestTimer=function(e){var t=this;return new Promise(function(n,i){t.timeoutId=window.setTimeout(function(){t.timeoutId=null,i(t.getMediaStreamTimeoutError(e))},t.configProvider.config.gumRequestTimeout)})},t.prototype.stopGumRequestTimer=function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)},t.prototype.stopStreamAfterTimeout=function(e,t){var n=this;this.logger.safe.info("Stopping media stream acquired after timeout: "+JSON.stringify(e.id)+" with constraints: "+JSON.stringify(t));try{e.getTracks().forEach(function(e){n.logger.safe.info("Track is stopped: "+JSON.stringify(e.id)),e.stop()}),this.logger.safe.info("Media stream stopped: "+e.id)}catch(e){this.logger.safe.warn("Failed to stop media stream: "+l.stringifyObject(e))}},t}(o.GumStreamProviderBase);t.WebRTCMediaStreamProvider=g;var m=function(e){function t(t,n){var i=e.call(this,n.createChild("WebRTCExtDispProvider"))||this;return i.configProvider=t,i.extensionProvider=new u.ExtensionProvider(i.configProvider,i.logger.createChild("Extension")),i.constraintsAdapter=new h.WebRTCExtensionDisplayConstraintsAdapter,i}return r(t,e),t.prototype.getStream=function(t){var n=this;return this.getSourceId().then(function(i){return t.video.sourceId=i,e.prototype.getStream.call(n,t)})},t.prototype.getSourceId=function(){var e=this;return this.extensionProvider.checkAvailability().then(function(){return e.extensionProvider.queryDisplayStreamId()})},t}(o.GumStreamProviderBase);t.WebRTCExtensionDisplayStreamProvider=m;var v=function(e){function t(t){var n=e.call(this,t.createChild("WebRTCDispProvider"))||this;return n.constraintsAdapter=new f.WebRTCDisplayConstraintsAdapter,n}return r(t,e),t.isSupported=function(){return!!window.navigator.mediaDevices.getDisplayMedia},t.prototype.getStream=function(e){var t=this.constraintsAdapter.toGumConstraints(e);return this.logger.safe.info("Constraints to be used: "+JSON.stringify(t)),Promise.resolve().then(function(){return s.default.window.navigator.mediaDevices.getDisplayMedia(t)}).catch(function(t){throw new a.MediaStreamErrorDecorator(t,e).getMediaError()})},t}(o.GumStreamProviderBase);t.WebRTCDisplayStreamProvider=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(21),r=n(18),o=n(2),a=function(){function e(e,t){this.logger=t,this.messageQueue=new i.PromiseQueue(this.logger),this.extensionId=e.config.chromeExtensionId||"mlggpjcbdfbjcfjbibkchfgepekkcidp"}return e.prototype.checkAvailability=function(){var e=this;return this.sendMessage("version").then(function(t){return e.version=t})},e.prototype.queryDisplayStreamId=function(){return this.sendMessage("get-sourceId").then(function(e){if("success"===e.type)return e.streamId;if("error"===e.type&&"NoStreamId"===e.message)throw new Error(o.default.MEDIA_ERROR.sharingCancelledError)})},e.prototype.sendMessage=function(e){if(!chrome||!chrome.runtime||!chrome.runtime.sendMessage)return Promise.reject(new Error(o.default.MEDIA_ERROR.chromeRuntimeNotDefinedError));this.logger.safe.info("sending message to extension "+e+", version "+this.version);var t=new r.SettablePromise;return chrome.runtime.sendMessage(this.extensionId,e,function(e){e?t.resolve(e):t.reject(new Error(o.default.MEDIA_ERROR.extensionNotFoundError))}),this.messageQueue.add(t)},e}();t.ExtensionProvider=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={};return e.audio&&(t.audio={},e.audio.deviceId&&e.audio.deviceId!==r.default.MEDIA_DEVICE.defaultId&&(t.audio.deviceId=e.audio.deviceId)),e.video&&(t.video={mandatory:{}},e.video.deviceId&&(t.video.mandatory.sourceId=e.video.deviceId),e.video.minWidth&&(t.video.mandatory.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.mandatory.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.mandatory.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.mandatory.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.mandatory.maxFrameRate=e.video.fps),i.isEmpty(t.video.mandatory)&&delete t.video.mandatory),t},e.prototype.toTrackConstraints=function(e){var t={};return e.video.minWidth&&(t.width=e.video.minWidth),e.video.minHeight&&(t.height=e.video.minHeight),e.video.fps&&(t.frameRate=e.video.fps),t},e}();t.WebKitConstraintsAdapter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={};if(e.audio&&(t.audio={},e.audio.deviceId&&e.audio.deviceId!==r.default.MEDIA_DEVICE.defaultId&&(t.audio.deviceId={exact:e.audio.deviceId})),e.video)for(var n in t.video={width:{},height:{},frameRate:{}},e.video.deviceId&&(t.video.deviceId={exact:e.video.deviceId}),e.video.minWidth&&(t.video.width.min=e.video.minWidth),e.video.maxWidth&&(t.video.width.max=e.video.maxWidth),e.video.minHeight&&(t.video.height.min=e.video.minHeight),e.video.maxHeight&&(t.video.height.max=e.video.maxHeight),e.video.fps&&(t.video.frameRate.max=e.video.fps),t.video)i.isEmpty(t.video[n])&&delete t.video[n];return t},e.prototype.toTrackConstraints=function(e){var t={};return e.video.minWidth&&(t.width=e.video.minWidth),e.video.minHeight&&(t.height=e.video.minHeight),e.video.fps&&(t.frameRate=e.video.fps),t},e}();t.WebRTCConstraintsAdapter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.toGumConstraints=function(e){if(!e||!e.video)throw new Error("constraints cannot be applied: "+e);var t={video:{}};return e.video.maxWidth&&(t.video.width={max:e.video.maxWidth}),e.video.maxHeight&&(t.video.height={max:e.video.maxHeight}),e.video.fps&&(t.video.frameRate=e.video.fps),e.audio&&(t.audio=!0),t},e.prototype.toTrackConstraints=function(e){var t=navigator.mediaDevices.getSupportedConstraints();if(!t)throw new Error("Constraints are not supported by browser");var n={};return t.width&&e.video.minWidth&&(n.width=e.video.minWidth),t.height&&e.video.minHeight&&(n.height=e.video.minHeight),t.frameRate&&e.video.fps&&(n.frameRate=e.video.fps),n},e}();t.WebRTCDisplayConstraintsAdapter=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.toGumConstraints=function(e){if(!e||!e.video||!e.video.deviceId)throw new Error("constraints cannot be applied: "+e);var t={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.video.sourceId}}};return e.video.minWidth&&(t.video.mandatory.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.mandatory.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.mandatory.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.mandatory.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.mandatory.maxFrameRate=e.video.fps),t},e.prototype.toTrackConstraints=function(e){var t=navigator.mediaDevices.getSupportedConstraints();if(!t)throw new Error("Constraints are not supported by browser");var n={};return t.width&&e.video.minWidth&&(n.width=e.video.minWidth),t.height&&e.video.minHeight&&(n.height=e.video.minHeight),t.frameRate&&e.video.fps&&(n.frameRate=e.video.fps),n},e}();t.WebRTCExtensionDisplayConstraintsAdapter=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(11),s=function(e){function t(t,n,i){var r=e.call(this)||this;return r.mediaStream=t,r.logger=i,r.mediaStreamSubscriptions=[],r.isHold=!1,r.isMuted=r.mediaStream.getMuted(),r.isDisposed=!1,r.originalId=t.id,r.subscribeOnMediaStreamEvents(),r.update(n),r.logger.safe.info("ctor"),r.mediaType=r.mediaStream.mediaType,r}return r(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.originalId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentId",{get:function(){return this.originalId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawStream",{get:function(){return this.gumStream},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawTrack",{get:function(){return this.getTrackByMediaType(this.rawStream,this.mediaType)},enumerable:!0,configurable:!0}),t.prototype.update=function(e){e&&(this.gumStream=e,this.enableDisableTracks())},t.prototype.dispose=function(){this.isDisposed?this.logger.safe.info("already disposed"):(this.isDisposed=!0,this.logger.safe.info("dispose"),this.logger=this.logger.createChild("DISPOSED"),this.event("onStreamClientDisposing").raise(this),this.mediaStream&&(this.mediaStream.disposeClient(this),this.unsubscribeFromMediaStreamEvents(),this.mediaStream=null),this.event("onStreamClientDisposed").raise(this))},t.prototype.clone=function(){var e=this.mediaStream.getClient();return this.isMuted&&e.setMuted(!0),this.isHold&&e.setHold(!0),e},t.prototype.applyCapabilities=function(e){return this.mediaStream.applyCapabilities(e)},t.prototype.setMuted=function(e,t){void 0===t&&(t=a.generateCauseId()),this.isMuted=e||this.mediaStream.getMuted(),this.logger.safe.info("["+t+"] setMuted => "+this.isMuted),this.enableDisableTracks()},t.prototype.setHold=function(e){this.isHold=e,this.enableDisableTracks()},t.prototype.start=function(){return this.mediaStream.start()},t.prototype.hasAudio=function(){return this.mediaStream.hasAudio()},t.prototype.hasVideo=function(){return this.mediaStream.hasVideo()},t.prototype.hasDisplay=function(){return this.mediaStream.hasDisplay()},t.prototype.isSameStream=function(e){return this.parentId===e.parentId},t.prototype.getResolution=function(){return this.mediaStream.getResolution()},t.prototype.getFrameRate=function(){return this.mediaStream.getFrameRate()},t.prototype.getMixer=function(){return this.mediaStream.getMixer()},t.prototype.subscribeOnMediaStreamEvents=function(){var e=this;this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamStarted",function(t,n){e.event("onStreamClientStarted").raise(e,n)})),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamError",function(t,n){e.event("onStreamClientError").raise(e,n)})),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamTrackMuted",function(t,n){e.event("onStreamClientMuted").raise(e,n)})),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamTrackEnded",function(t,n){e.event("onStreamClientEnded").raise(e,n)}))},t.prototype.unsubscribeFromMediaStreamEvents=function(){this.mediaStreamSubscriptions.forEach(function(e){return e.dispose()}),this.mediaStreamSubscriptions=[]},t.prototype.enableDisableTracks=function(){var e=this;this.gumStream?this.gumStream.getTracks().forEach(function(t){void 0!==t.enabled&&(t.enabled=!e.isMuted&&!e.isHold,e.logger.safe.info("Track "+JSON.stringify(t.id)+" enabled state set to => "+t.enabled))}):this.logger.safe.warn("gumStream stream doesn't exist")},t.prototype.getTrackByMediaType=function(e,t){return"Audio"===t?e.getAudioTracks()[0]:e.getVideoTracks()[0]},t}(o.default);t.MediaStreamClient=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=n(6),s=n(89),c=n(94),l=n(194),u=n(195),d=n(51),p=n(0),f=n(197),h=function(e){function t(n,i,r,o){var a=e.call(this)||this;return a.serialQueue=i,a.configProvider=r,a.gumRequestTime=0,a.id=t.streamId++,a.logger=o.createChild("MediaStream:"+a.id),a.mediaType=a.getMediaType(n),a.initialize(n),a}return r(t,e),Object.defineProperty(t.prototype,"rawStream",{get:function(){return this.audioMixer?this.audioMixer.getDestinationStream():this.mediaStream},enumerable:!0,configurable:!0}),t.prototype.start=function(){return this.mediaStreamStartPromise||(this.mediaStreamStartPromise=this.startStream(this.currentConstraints)),this.mediaStreamStartPromise},t.prototype.dispose=function(){var t=this;this.event("onStreamDisposing").raise(this),this.stopMediaStream().catch(function(e){t.event("onStreamError").raise(t,e)}).then(function(){t.constraintsProvider=null,t.serialQueue=null,t.configProvider=null,t.logger=t.logger.createChild("DISPOSED"),t.clientGenerationStrategy.dispose(),t.event("onStreamDisposed").raise(t),e.prototype.dispose.call(t)})},t.prototype.getClient=function(){return this.clientGenerationStrategy.getClient()},t.prototype.disposeClient=function(e){this.clientGenerationStrategy.disposeClient(e)},t.prototype.getMixer=function(){return this.audioMixer},t.prototype.getMediaType=function(e){if(e.sharing)return"ScreenShare";if(e.video)return"Video";if(e.audio)return"Audio";throw new Error("Media type is not defined: "+JSON.stringify(e))},t.prototype.initialize=function(e){var t=this;this.constraintsProvider=s.ConstraintsProviderFactory.getProvider(this.mediaType,this.configProvider,this.logger),this.currentConstraints=this.constraintsProvider.createConstraintsObject(e),this.gumStreamProvider=c.GumStreamProviderFactory.getStreamProvider(this.mediaType,this.configProvider,this.logger),this.mediaStreamRequestStrategy=f.RequestStrategyFactory.getStrategy(this.mediaType,this.gumStreamProvider,this.serialQueue,this.logger,this.configProvider),this.clientGenerationStrategy=new u.CloneClientGeneratorStrategy(this,this.currentConstraints,this.constraintsProvider,this.gumStreamProvider,this.logger),this.clientGenerationStrategy.on("onAllClientsDisposed",function(){return t.onAllClientsDisposed()})},t.prototype.onAllClientsDisposed=function(){this.logger.safe.info("All clients are disposed, disposing master stream"),this.dispose()},t.prototype.startStream=function(e){var t=this;return this.getOrCreateMediaStream(e).then(function(){t.event("onStreamStarted").raise(t,t.currentConstraints)}).catch(function(e){throw t.event("onStreamError").raise(t,e),e})},t.prototype.getOrCreateMediaStream=function(e){var t=this;if(this.mediaStream)return Promise.resolve();var n=this.getRequestStartTimestamp();return this.mediaStreamRequestStrategy.getStream(e).then(function(i){t.gumRequestTime=t.getRequestDuration(n),t.handleMediaStreamRequestSuccess(i,e)})},t.prototype.handleMediaStreamRequestSuccess=function(e,t){this.logger.safe.info("Media stream acquired: "+JSON.stringify(e.id)+" with constraints: "+JSON.stringify(o.scrubConstraints(t))),"Audio"===this.mediaType&&this.configProvider.config.enableAudioSharing&&(this.audioMixer=new l.AudioMixer(e,this.logger)),this.mediaStream=e,this.currentConstraints=t,this.applyState(this.mediaStream),this.event("onStreamAcquired").raise(this,this.gumRequestTime,"Audio"!==this.mediaType&&this.getResolution()||void 0)},t.prototype.applyState=function(e){var t=this;e.getAudioTracks().forEach(function(e){return t.applyAudioState(e)});var n=e.getVideoTracks()[0];this.applyVideoState(n)},t.prototype.applyAudioState=function(e){e&&(e.muted&&this.event("onStreamTrackMuted").raise(this,!0),this.logger.safe.info("Audio track added: "+JSON.stringify(e.id)))},t.prototype.applyVideoState=function(e){e&&("ScreenShare"===this.mediaType&&this.configProvider.config.webrtcDisplayStreamContentHint&&this.applyContentHint(e,this.configProvider.config.webrtcDisplayStreamContentHint),this.logger.safe.info("Video track added: "+JSON.stringify(e.id)))},t.prototype.applyContentHint=function(e,t){["","text","detail","motion"].indexOf(t)<0?this.logger.safe.error("Cannot apply content hint: "+t):(this.logger.safe.info("Apply content hint: "+t),e.contentHint=t)},t.prototype.getRequestStartTimestamp=function(){return Date.now()},t.prototype.getRequestDuration=function(e){return 0===e?0:Date.now()-e},t.prototype.stopMediaStream=function(){var e=this;return this.mediaStreamStartPromise?(this.logger.safe.info("Queueing media stream stop"),this.serialQueue.add(function(){return e.stopMediaStreamInternal()})):Promise.resolve()},t.prototype.stopOneMediaStream=function(e){var t=this;try{e.getTracks().forEach(function(e){t.logger.safe.info("Track is stopped: "+JSON.stringify(e.id)),e.stop()}),this.logger.safe.info("Media stream stopped: "+e.id)}catch(e){this.logger.safe.warn("Failed to stop media stream: "+p.stringifyObject(e))}},t.prototype.stopMediaStreamInternal=function(){this.audioMixer&&this.audioMixer.dispose(),this.mediaStream&&(this.stopOneMediaStream(this.mediaStream),this.mediaStream=null)},t.prototype.getResolution=function(){var e=this;if(!["Video","ScreenShare","PanoramicVideo"].some(function(t){return t===e.mediaType}))return null;var t={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},n=d.getResolutionForStream(this.mediaStream,t);return n===t?this.logger.safe.error("Stream resolution is not avalable, assuming we're at "+t.width+"x"+t.height+" now"):this.logger.safe.info("Stream resolution is "+n.width+"x"+n.height),n},t.prototype.getFrameRate=function(){var e=this;if(!["Video","ScreenShare","PanoramicVideo"].some(function(t){return t===e.mediaType}))return null;var t=d.getFrameRateForStream(this.mediaStream);return 0===t?this.logger.safe.error("Stream frame rate is not avalable, returning 0"):this.logger.safe.info("Stream fps is "+t),t},t.streamId=0,t}(a.default);t.SimulcastMediaStream=h},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(0),c=function(e){function t(t,n){var i=e.call(this)||this;return i.mainStream=t,i.audioContext=new AudioContext,i.destination=i.audioContext.createMediaStreamDestination(),i.interval={timer:0,id:null},i.streamNodeMap=new Map,i.audioVolumeSamples=[],i.logger=n.createChild("AudioMixer"),i.logger.safe.info("Create with main stream: "+t.id+", track: "+i.getTrack(t).id),i.addStream(t),i.logger.safe.info("Destination stream: "+i.getDestinationStream().id+", track: "+i.getTrack(i.getDestinationStream()).id),i}return r(t,e),t.prototype.addSourceStream=function(e){var t=this,n=e.on("onStreamClientDisposing",function(){t.removeSourceStream(e.rawStream),n.dispose()});this.logger.safe.info("Add additional stream to mixer: "+e.rawStream.id+", track: "+this.getTrack(e.rawStream).id),this.addStream(e.rawStream,e.mediaType)},t.prototype.getDestinationStream=function(){return this.destination.stream},t.prototype.setMuted=function(e,t,n){var i=t?this.getTrack(this.mainStream):this.getTrack(this.getDestinationStream());i.enabled=!e,this.logger.safe.info("["+n+"] Track "+i.id+" enabled state set to => "+i.enabled)},t.prototype.dispose=function(){var e,t;try{for(var n=o(this.streamNodeMap.keys()),i=n.next();!i.done;i=n.next()){var r=i.value;this.removeSourceStream(r)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.mainStream=null},t.prototype.addStream=function(e,t){var n=this.audioContext.createMediaStreamSource(e);n.connect(this.destination),this.streamNodeMap.set(e,n),t&&"ScreenShare"===t&&this.analyseInputLevels(n,e)},t.prototype.analyseInputLevels=function(e,t){var n=this;this.nodelAnalyser=this.audioContext.createAnalyser(),this.nodelAnalyser.fftSize=1024,this.nodelAnalyser.smoothingTimeConstant=.1,e.connect(this.nodelAnalyser);var i=new Uint8Array(this.nodelAnalyser.frequencyBinCount);this.interval.timer=window.setInterval(function(){n.nodelAnalyser.getByteFrequencyData(i),n.audioVolumeSamples.push(s.getAvarageVolume(i))},1e3),this.interval.id=t.id},t.prototype.removeSourceStream=function(e){var t=this.streamNodeMap.get(e);t&&(this.logger.safe.info("Remove stream from AudioMixer: "+e.id+", track: "+this.getTrack(e).id),t.disconnect(this.destination),this.streamNodeMap.delete(e),this.interval.id===e.id&&this.stopSharingStatsGathering())},t.prototype.stopSharingStatsGathering=function(){this.event("onAudioScreenSharingDisposed").raise(this.audioVolumeSamples),window.clearInterval(this.interval.timer),this.interval.timer=0,this.interval.id=null},t.prototype.getTrack=function(e){return e.getAudioTracks()[0]},t}(a.default);t.AudioMixer=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(196),s=function(e){function t(t,n,i,r,o){var a=e.call(this)||this;return a.stream=t,a.constraints=n,a.constraintsProvider=i,a.gumStreamProvider=r,a.logger=o,a.clients=[],a.streams=[],a.mediaStreamSubscription=a.stream.on("onStreamAcquired",function(){return a.onStreamAcquired()}),a}return r(t,e),t.prototype.getClient=function(){var e=new a.SimulcastMediaStreamClient(this.stream,this.constraints,this.constraintsProvider,this.gumStreamProvider,this.logger);return this.addClient(e),e},t.prototype.disposeClient=function(e){this.removeClient(e),this.clients.length||this.event("onAllClientsDisposed").raise()},t.prototype.dispose=function(){var t=this;this.mediaStreamSubscription.dispose(),this.clients.length&&this.logger.safe.error("Not all clients are disposed! "+JSON.stringify(this.clients.map(function(e){return e.id}))),this.streams.forEach(function(e){return t.disposeStream(e)}),e.prototype.dispose.call(this)},t.prototype.getOrCreateStream=function(){var e=this.streams.length?this.streams[this.streams.length-1]:this.stream.rawStream;if(!e)return null;var t=e.clone();return this.resetStream(t),this.streams.push(t),t},t.prototype.addClient=function(e){this.updateClient(e),this.clients.push(e)},t.prototype.updateClient=function(e){var t=this.getOrCreateStream();t&&e.update(t)},t.prototype.removeClient=function(e){var t=this.clients.indexOf(e);this.clients.splice(t,1)},t.prototype.addStream=function(){var e=this;this.clients.forEach(function(t){return e.updateClient(t)})},t.prototype.disposeStream=function(e){var t=this;e.getTracks().forEach(function(e){t.logger.safe.info("Stopping track: "+JSON.stringify(e.id)),e.stop()})},t.prototype.onStreamAcquired=function(){this.addStream()},t.prototype.resetStream=function(e){var t=this;e.getTracks().forEach(function(e){t.logger.safe.info("Resetting state for track: "+e.id),e.enabled=!0})},t}(o.default);t.CloneClientGeneratorStrategy=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),c=n(51),l=function(e){function t(n,i,r,o,a){var s=e.call(this)||this;return s.masterStream=n,s.currentConstraints=i,s.constraintsProvider=r,s.streamProvider=o,s.isDisposed=!1,s.masterStreamSubscriptions=[],s.id=t.clientId++,s.parentId=n.id,s.logger=a.createChild("C:"+s.id),s.subscribeOnMasterStreamEvents(),s}return r(t,e),Object.defineProperty(t.prototype,"rawTrack",{get:function(){return this.mediaTrack},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawStream",{get:function(){return this.rawMediaStream||(this.rawMediaStream=new MediaStream([this.mediaTrack])),this.rawMediaStream},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mediaType",{get:function(){return this.masterStream.mediaType},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.logger.safe.info("dispose"),this.logger=this.logger.createChild("DISPOSED"),this.event("onStreamClientDisposing").raise(this),this.mediaTrack&&(this.unsubscribeFromMediaTrackEvents(this.mediaTrack),this.mediaTrack=null),this.masterStream&&(this.masterStream.disposeClient(this),this.unsubscribeFromMasterStreamEvents(),this.masterStream=null),e.prototype.dispose.call(this),this.event("onStreamClientDisposed").raise(this))},t.prototype.applyCapabilities=function(e){var t=this;if(!this.mediaTrack)return Promise.resolve(!1);var n=this.constraintsProvider.updateVideoConstraints(this.currentConstraints,e,this.getResolution());return n&&this.currentConstraints!==n?this.applyConstraints(n).then(function(){return t.currentConstraints=n,!0}).catch(function(e){throw t.logger.safe.error("Apply constraints error: "+JSON.stringify(e)),e}):Promise.resolve(!1)},t.prototype.start=function(){return this.masterStream.start()},t.prototype.clone=function(){return this.masterStream.getClient()},t.prototype.setMuted=function(e,t){this.isMuted=e;var n=this.masterStream.getMixer();n?n.setMuted(e,!0,t):this.applyState(t)},t.prototype.setHold=function(e,t){this.isHold=e,this.applyState(t)},t.prototype.isSameStream=function(e){return this.parentId===e.parentId},t.prototype.getResolution=function(){var e=this;if(!["Video","ScreenShare","PanoramicVideo"].some(function(t){return t===e.mediaType}))return null;var t={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},n=c.getResolutionForTrack(this.mediaTrack,t);return n===t?this.logger.safe.error("Stream resolution is not avalable, assuming we're at "+t.width+"x"+t.height+" now"):this.logger.safe.info("Stream resolution is "+n.width+"x"+n.height),n},t.prototype.getFrameRate=function(){var e=this;if(!["Video","ScreenShare","PanoramicVideo"].some(function(t){return t===e.mediaType}))return null;var t=c.getFrameRateForTrack(this.mediaTrack);return 0===t?this.logger.safe.error("Stream frame rate is not avalable, returning 0"):this.logger.safe.info("Stream fps is "+t),t},t.prototype.update=function(e){e?this.mediaTrack?this.logger.safe.error("Media track is already created: "+this.mediaTrack.id):(this.mediaTrack=this.getTrackByMediaType(e,this.mediaType),this.updateTrackConstraints(),this.subscribeOnMediaTrackEvents(this.mediaTrack),this.hasMasterAudio=e&&e.getAudioTracks().length>0,this.hasMasterVideo=e&&e.getVideoTracks().length>0,this.hasMasterAudio&&this.hasMasterVideo&&(this.rawMediaStream=e),this.logger.safe.info("Media track cloned: "+JSON.stringify(this.mediaTrack.id))):this.logger.safe.error("No master media stream, skipping update")},t.prototype.updateTrackConstraints=function(){return o(this,void 0,void 0,function(){var e,t,n;return a(this,function(i){switch(i.label){case 0:if("ScreenShare"!==this.mediaType)return[2];if(!(e=this.masterStream.getResolution()))return[3,4];(t=this.currentConstraints.clone()).video.maxWidth=e.width,t.video.minWidth=e.width,t.video.maxHeight=e.height,t.video.minHeight=e.height,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.applyConstraints(t)];case 2:return i.sent(),this.currentConstraints=t,[3,4];case 3:return n=i.sent(),this.logger.safe.error("Apply constraints error: "+JSON.stringify(n)),[3,4];case 4:return[2]}})})},t.prototype.getTrackByMediaType=function(e,t){return"Audio"===t?e.getAudioTracks()[0]:e.getVideoTracks()[0]},t.prototype.applyConstraints=function(e){return this.streamProvider.applyConstraintsForTrack(this.mediaTrack,e)},t.prototype.applyState=function(e){this.mediaTrack&&void 0!==this.mediaTrack.enabled&&(this.mediaTrack.enabled=!this.isMuted&&!this.isHold,this.logger.safe.info("["+e+"] Track "+JSON.stringify(this.mediaTrack.id)+" enabled state set to => "+this.mediaTrack.enabled))},t.prototype.subscribeOnMediaTrackEvents=function(e){var t=this;e.onended=function(n){t.logger.safe.info("Track "+e.id+" ended: "+JSON.stringify(n)),t.event("onStreamClientEnded").raise(t,n)},e.onmute=function(){t.logger.safe.info("Track "+e.id+" muted"),t.event("onStreamClientMuted").raise(t,!0)},e.onunmute=function(){t.logger.safe.info("Track "+e.id+" unmuted"),t.event("onStreamClientMuted").raise(t,!1)}},t.prototype.unsubscribeFromMediaTrackEvents=function(e){e.onended=null,e.onmute=null,e.onunmute=null},t.prototype.subscribeOnMasterStreamEvents=function(){var e=this;this.masterStreamSubscriptions.push(this.masterStream.on("onStreamStarted",function(t,n){return e.onMasterStreamStarted(t,n)})),this.masterStreamSubscriptions.push(this.masterStream.on("onStreamError",function(t,n){return e.onMasterStreamError(t,n)})),this.masterStreamSubscriptions.push(this.masterStream.on("onStreamTrackMuted",function(t,n){return e.onMasterStreamMuted(t,n)})),this.masterStreamSubscriptions.push(this.masterStream.on("onStreamDisposing",function(t){return e.onMasterStreamDisposing(t)}))},t.prototype.unsubscribeFromMasterStreamEvents=function(){this.masterStreamSubscriptions.forEach(function(e){return e.dispose()}),this.masterStreamSubscriptions=[]},t.prototype.onMasterStreamStarted=function(e,t){this.event("onStreamClientStarted").raise(this,t)},t.prototype.onMasterStreamError=function(e,t){this.event("onStreamClientError").raise(this,t)},t.prototype.onMasterStreamMuted=function(e,t){this.event("onStreamClientMuted").raise(this,t)},t.prototype.onMasterStreamDisposing=function(e){this.dispose()},t.prototype.hasAudio=function(){return this.hasMasterAudio},t.prototype.hasVideo=function(){return this.hasMasterVideo},t.prototype.getMixer=function(){return this.masterStream.getMixer()},t.clientId=0,t}(s.default);t.SimulcastMediaStreamClient=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(93),a=n(2),s=n(9),c=function(){function e(){}return e.getStrategy=function(e,t,n,i,r){return"Video"===e?new d(t,n,i,r):new u(t,n,i)},e}();t.RequestStrategyFactory=c;var l=function(){function e(e,t,n){this.gumStreamProvider=e,this.serialQueue=t,this.logger=n}return e.prototype.getStream=function(e){var t=this;return this.logger.safe.info("Requesting stream with constraints: "+JSON.stringify(s.scrubConstraints(e))),this.serialQueue.add(function(){return t.request(e)})},e}();t.MediaStreamRequestStrategyBase=l;var u=function(e){function t(t,n,i){return e.call(this,t,n,i.createChild("SimpleStrat"))||this}return r(t,e),t.prototype.request=function(e){return this.gumStreamProvider.getStream(e)},t}(l),d=function(e){function t(t,n,i,r){var a=e.call(this,t,n,i.createChild("MultStrat"))||this;return a.policyGenerator=new o.RequestPolicyGenerator(r),a}return r(t,e),t.prototype.request=function(e){var t=this.policyGenerator.getPolicies(e);return this.makeRequests(t)},t.prototype.makeRequests=function(e){var t=this,n=e[0];return this.logger.safe.info("Requesting media stream with policy: "+JSON.stringify(n)),this.makeRequestWithPolicy(n).catch(function(n){var i=e.slice(1);if(i.length&&a.default.MEDIA_ERROR.constraintNotSatisfiedError===n.type)return t.logger.safe.warn("Could not obtain constrained media stream, will attempt weaker policy"),t.makeRequests(i);throw n})},t.prototype.makeRequestWithPolicy=function(e){return this.gumStreamProvider.getStream(e)},t}(l)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),r=n(12),o=n(36),a=n(0),s=n(199),c=n(52),l=n(200),u=function(){function e(e,t){var n=this;this.configProvider=e,this.logger=t,this.window=r.default.window,this.isInitialized=new i.SettablePromise,this.list=new l.ComposedDeviceList(this.configProvider,this.logger.createChild("DeviceList")),this.selection=new s.DeviceSelection(this.list,this.configProvider,this.logger.createChild("DeviceSelection")),this.configProvider.userAgentConfig.on("isAudioOutputSelectionSupportedChanged",function(){return n.enumerateDevices()}),this.window.navigator.mediaDevices&&(this.window.navigator.mediaDevices.ondevicechange=function(){n.configProvider.config.devicePollingAlwaysOn||n.enableOnDeviceChangeCallbackSupport(),n.enumerateDevices()})}return Object.defineProperty(e.prototype,"isPollingInProgress",{get:function(){return this.pollingInProgress},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){var e=this;this.enumerateDevices().then(function(){return e.isInitialized.resolve()}).catch(function(){return e.isInitialized.reject()})},e.prototype.enumerateDevices=function(){var e=this;return this.window.navigator&&this.window.navigator.mediaDevices&&this.window.navigator.mediaDevices.enumerateDevices?(this.enumerateDevicesPromise||(this.enumerateDevicesCancelDefer=o.defer(),this.enumerateDevicesPromise=o.timeout(this.window.navigator.mediaDevices.enumerateDevices(),this.configProvider.config.enumerateDevicesTimeout,"enumerateDevices",this.enumerateDevicesCancelDefer.promise).catch(function(t){throw e.enumerateDevicesPromise=null,e.enumerateDevicesCancelDefer=null,e.logger.safe.warn("error with enumerating devices:",a.stringifyObject(t)),t}).then(function(t){e.enumerateDevicesPromise=null,e.enumerateDevicesCancelDefer=null,e.list.updateDevices(t.map(function(e){return c.createDevice(e)}))})),this.enumerateDevicesPromise):Promise.reject(new Error("device enumeration unsupported"))},e.prototype.startDevicePolling=function(){var e=this,t=this.configProvider.config.devicePollingInterval,n=this.configProvider.config.devicePollingAlwaysOn;if(!(0===t||this.onDeviceChangeCallbackUsed&&!n||this.pollingTimer||this.pollingInProgress)){var i=function(){e.logger.safe.debug("Polling devices"),e.pollingInProgress=!0,e.enumerateDevices().then(function(){e.pollingInProgress=!1,e.pollingTimer=e.window.setTimeout(i,t)}).catch(function(t){throw e.pollingInProgress=!1,t})};this.logger.safe.info("starting device polling"),i()}},e.prototype.stopDevicePolling=function(){this.enumerateDevicesPromise=null,this.pollingTimer&&(this.logger.safe.info("stopping device polling. onDeviceChange callback used: "+this.onDeviceChangeCallbackUsed),this.enumerateDevicesCancelDefer&&this.enumerateDevicesCancelDefer.reject("Stop device polling"),this.window.clearTimeout(this.pollingTimer),this.pollingTimer=void 0)},e.prototype.dispose=function(){this.stopDevicePolling(),this.window.navigator.mediaDevices.ondevicechange=void 0},e.prototype.enableOnDeviceChangeCallbackSupport=function(){this.onDeviceChangeCallbackUsed=!0,this.stopDevicePolling()},e}();t.DeviceEnumerator=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(0),s=n(2),c=n(97),l=n(9),u=function(e){function t(t,n,i){var r=e.call(this)||this;return r.deviceList=t,r.configProvider=n,r.logger=i,r.currentlySelectedDevices={microphone:null,camera:null,speaker:null},r.deviceSelectionStrategies=new Map,r.deviceAutoSelection=new Map,r.deviceSelectionStrategies.set(s.default.MEDIA_DEVICE.microphone,c.getDeviceSelectionStrategy(c.SelectionType.Automatic)),r.deviceSelectionStrategies.set(s.default.MEDIA_DEVICE.camera,c.getDeviceSelectionStrategy(c.SelectionType.Automatic)),r.deviceSelectionStrategies.set(s.default.MEDIA_DEVICE.speaker,c.getDeviceSelectionStrategy(c.SelectionType.Automatic)),r.deviceAutoSelection.set(s.default.MEDIA_DEVICE.microphone,!0),r.deviceAutoSelection.set(s.default.MEDIA_DEVICE.camera,!0),r.deviceAutoSelection.set(s.default.MEDIA_DEVICE.speaker,!0),r.deviceList.on("onDevicesChanged",function(e){return r.onDevicesChanged(e)}),r.logger.safe.info("Initialized"),r}return r(t,e),Object.defineProperty(t.prototype,"selectedDevices",{get:function(){return a.deepClone(this.currentlySelectedDevices)},enumerable:!0,configurable:!0}),t.prototype.selectDevices=function(e){var t=this,n=!1;a.forOwn(e,function(e,i){t.deviceAutoSelection.set(i,!1);var r=t.getDeviceToSelect(i,t.deviceList.devices.filter(function(e){return e.type===i}),e);t.isSameDevice(t.currentlySelectedDevices[i],r)||(n=!0),t.currentlySelectedDevices[i]=r}),n&&(this.logger.safe.info("Changed from public interface: "+a.values(this.currentlySelectedDevices).map(function(e){return l.scrubDevices(e,t.configProvider.config.devices.piiSafeWords)})),this.event("onSelectedDevicesChanged").raise(this.selectedDevices))},t.prototype.setCameraSelectionStrategy=function(e){this.deviceSelectionStrategies.set(s.default.MEDIA_DEVICE.camera,e)},t.prototype.getDeviceToSelect=function(e,t,n){var i=this,r=n&&t.find(function(e){return e.guid===n});if(!r){var o=this.currentlySelectedDevices[e]&&t.find(function(t){return t.guid===i.currentlySelectedDevices[e].guid});!this.deviceAutoSelection.get(e)&&o?r=o:(!(r=this.deviceSelectionStrategies.get(e).getSelectedDevice(t))&&o&&(r=o),this.deviceAutoSelection.set(e,!0))}return r||t[0]},t.prototype.onDevicesChanged=function(e){var t=this,n=!1;Object.keys(this.currentlySelectedDevices).forEach(function(i){var r=e.filter(function(e){return e.type===i});if(r.length>0){var o=t.getDeviceToSelect(i,r);t.isSameDevice(o,t.currentlySelectedDevices[i])||(t.currentlySelectedDevices[i]=o,n=!0)}else t.currentlySelectedDevices[i]&&(t.currentlySelectedDevices[i]=null,n=!0)}),n&&(this.logger.safe.info("Changed due to device list change: "+a.values(this.currentlySelectedDevices).map(function(e){return l.scrubDevices(e,t.configProvider.config.devices.piiSafeWords)})),this.event("onSelectedDevicesChanged").raise(this.selectedDevices))},t.prototype.isSameDevice=function(e,t){return!e&&!t||e&&t&&e.guid===t.guid},t}(o.default);t.DeviceSelection=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),c=n(2),l=n(0),u=n(201),d=n(202),p=function(e){function t(t,n){var i=e.call(this)||this;return i.configProvider=t,i.logger=n,i.lists=new Map,i.debugInfo={microphone:"",camera:"",speaker:"",compositeAudio:""},i.lists.set(c.default.MEDIA_DEVICE.microphone,[]),i.lists.set(c.default.MEDIA_DEVICE.camera,[]),i.configProvider.userAgentConfig.isAudioOutputSelectionSupported&&(i.lists.set(c.default.MEDIA_DEVICE.speaker,[]),i.configProvider.config.devices.compositeAudioDevices&&i.lists.set(c.default.MEDIA_DEVICE.compositeAudio,[])),t.on("configUpdated",function(){return i.onConfigUpdated()}),t.userAgentConfig.on("isAudioOutputSelectionSupportedChanged",function(){return i.onConfigUpdated()}),i.logger.safe.info("Initialized"),i}return r(t,e),Object.defineProperty(t.prototype,"devices",{get:function(){var e=[];return this.lists.forEach(function(t){return e.push.apply(e,a(t))}),e},enumerable:!0,configurable:!0}),t.prototype.updateDevices=function(e){if(!l.deepEqual(this.latestRawList,e)){this.latestRawList=e;var t=this.devices;this.debugInfo.microphone="microphone",this.debugInfo.camera="camera",this.debugInfo.speaker="speaker",this.debugInfo.compositeAudio="compositeAudio",this.updatePrimitiveDeviceList(c.default.MEDIA_DEVICE.microphone,e.filter(function(e){return e.type===c.default.MEDIA_DEVICE.microphone})),this.updatePrimitiveDeviceList(c.default.MEDIA_DEVICE.camera,e.filter(function(e){return e.type===c.default.MEDIA_DEVICE.camera})),this.lists.get(c.default.MEDIA_DEVICE.speaker)&&(this.updatePrimitiveDeviceList(c.default.MEDIA_DEVICE.speaker,e.filter(function(e){return e.type===c.default.MEDIA_DEVICE.speaker})),this.lists.get(c.default.MEDIA_DEVICE.compositeAudio)&&this.updateCompositeAudioDeviceList(this.lists.get(c.default.MEDIA_DEVICE.microphone),this.lists.get(c.default.MEDIA_DEVICE.speaker)));var n=this.lists.get(c.default.MEDIA_DEVICE.compositeAudio)||[];this.lists.set(c.default.MEDIA_DEVICE.microphone,this.orderDeviceList(this.lists.get(c.default.MEDIA_DEVICE.microphone),n)),this.lists.get(c.default.MEDIA_DEVICE.speaker)&&this.lists.set(c.default.MEDIA_DEVICE.speaker,this.orderDeviceList(this.lists.get(c.default.MEDIA_DEVICE.speaker),n)),l.deepEqual(t,this.devices)||(this.logger.safe.info("Device lists updated and changed"),this.logger.safe.info(this.debugInfo.microphone),this.logger.safe.info(this.debugInfo.camera),this.logger.safe.info(this.debugInfo.speaker),this.logger.safe.info(this.debugInfo.compositeAudio),this.event("onDevicesChanged").raise(this.devices))}},t.prototype.updatePrimitiveDeviceList=function(e,t){var n={str:this.debugInfo[e]};this.lists.set(e,u.compilePrimitiveDeviceList(e,t,this.lists.get(e)||[],this.configProvider,n)),this.debugInfo[e]=n.str},t.prototype.updateCompositeAudioDeviceList=function(e,t){var n={str:this.debugInfo.compositeAudio};this.lists.set(c.default.MEDIA_DEVICE.compositeAudio,d.compileAudioDeviceList(e,t,this.configProvider.config.devices.compositeLabelMatchingThreshold,n)),this.debugInfo.compositeAudio=n.str},t.prototype.orderDeviceList=function(e,t){var n=this;return e.sort(function(e,i){return n.getDevicePriority(i,n.getCompositeAudioDeviceCounterpart(i,t))-n.getDevicePriority(e,n.getCompositeAudioDeviceCounterpart(e,t))})},t.prototype.getCompositeAudioDeviceCounterpart=function(e,t){var n=t.find(function(t){return t.micDeviceId===e.guid||t.speakerDeviceId===e.guid});return n?n[e.type===c.default.MEDIA_DEVICE.speaker?"micDevice":"speakerDevice"]:null},t.prototype.getDevicePriority=function(e,t){var n=0;return e.isSystemDefault&&(n+=100),t&&(n+=1,t.isSystemDefault&&(n+=2)),n},t.prototype.updateActiveDevices=function(e){if(e.microphone&&e.microphone.isMarkedDefault){var t=this.lists.get(c.default.MEDIA_DEVICE.microphone),n=t.findIndex(function(e){return e.isSystemDefault});-1!==n&&t[n]!==e.microphone.device?(this.logger.safe.info("Removing synthetic default microphone"),this.lists.set(c.default.MEDIA_DEVICE.microphone,t.splice(n,1))):e.microphone.device.isSystemDefault=!0}},t.prototype.onConfigUpdated=function(){var e=!1;if(this.configProvider.userAgentConfig.isAudioOutputSelectionSupported){this.lists.has(c.default.MEDIA_DEVICE.speaker)||(this.lists.set(c.default.MEDIA_DEVICE.speaker,[]),e=!0);var t=this.lists.has(c.default.MEDIA_DEVICE.compositeAudio);this.configProvider.config.devices.compositeAudioDevices&&!t?(this.lists.set(c.default.MEDIA_DEVICE.compositeAudio,[]),e=!0):!this.configProvider.config.devices.compositeAudioDevices&&t&&(this.lists.delete(c.default.MEDIA_DEVICE.compositeAudio),e=!0)}else this.lists.has(c.default.MEDIA_DEVICE.speaker)&&(this.lists.delete(c.default.MEDIA_DEVICE.speaker),e=!0),this.lists.has(c.default.MEDIA_DEVICE.compositeAudio)&&(this.lists.delete(c.default.MEDIA_DEVICE.compositeAudio),e=!0);e&&(this.logger.safe.info("Updating device list due to config update"),this.updateDevices(this.latestRawList||[]))},t}(s.default);t.ComposedDeviceList=p},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),o=n(16),a=n(0),s=n(2),c=n(52);t.compilePrimitiveDeviceList=function(e,t,n,l,u){var d,p;void 0===u&&(u={str:""}),u.str+="|input("+t.length+")";var f=[],h=[l.config.devices.blacklist[e],l.defaultConfig.devices.blacklist[e]],g=function(e){try{var n=new RegExp(e,"i");return f=t.filter(function(t){return e&&t.label.match(n)?(u.str+="|-blacklisted("+t.label+")",!1):t.deviceId!==s.default.MEDIA_DEVICE.communicationsId||(u.str+="|-communications",!1)}),"break"}catch(n){u.str+="|filterError('"+e+"', "+a.stringifyObject(n)+")",f=t}};try{for(var m=i(h),v=m.next();!v.done&&"break"!==g(v.value);v=m.next());}catch(e){d={error:e}}finally{try{v&&!v.done&&(p=m.return)&&p.call(m)}finally{if(d)throw d.error}}if(f.length){var y=function(e,t,n){if(1===t.length)return n.str+="|default:only",t[0];var i=t.find(function(e){return e.isSystemDefault&&e.deviceId===s.default.MEDIA_DEVICE.defaultId});if(i){var o=t.filter(function(e){return e!==i});if(1===o.length)return n.str+="|default:firstNonDefault",o[0];if(""!==i.groupId){var c=o.filter(function(e){return e.groupId===i.groupId});if(1===c.length)return n.str+="|default:groupId",c[0]}var l=e.find(function(e){return e.isSystemDefault});if(l){var u=o.find(function(e){return e.deviceId===l.deviceId});if(u)return n.str+="|default:previousList",u}var d=o.map(function(e){return e.label}),p=a.getMaxSubstring(i.label,d),f=o.find(function(e){return e.label===p});if(f)return n.str+="|default:label",f}else if("Edge"!==r.getBrowserInfo().name)return n.str+="|default:noSynthetic",t.find(function(e){return e.isSystemDefault})||t[0];return n.str+="|default:anyOrNull",t.find(function(e){return e.isSystemDefault})||null}(n,f,u);if(y&&(y.isSystemDefault=!0,u.str+="|default("+o.scrubMriOrOmit(y.guid)+")"),f.length>1&&(f=f.filter(function(e){return e.deviceId!==s.default.MEDIA_DEVICE.defaultId||(u.str+="|-defaultId",!1)})),e===s.default.MEDIA_DEVICE.camera||y||(u.str+="|+syntheticDefault",f.unshift(c.createDefaultDevice(e))),n.forEach(function(e){var t=f.find(function(t){return t.guid===e.guid});t&&!t.label&&e.label&&(u.str+="|migrateLabel("+o.scrubMriOrOmit(t.guid)+")",t.label=e.label)}),e===s.default.MEDIA_DEVICE.speaker){var S=f.filter(function(e){return""===e.label});S.length>1&&S.length===f.length&&(f=y?[y]:[f[0]],u.str+="|-filteredEmptyLabels("+S.length+")")}}return f}},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=n(0),c=n(52);function l(e,t){var n,i,r,a,c=999,l=null;if(e.length>0&&t.length>0)try{for(var u=o(e),d=u.next();!d.done;d=u.next()){var p=d.value;try{for(var f=o(t),h=f.next();!h.done;h=f.next()){var g=h.value,m=s.levenshteinDistance(p.label,g.label);m<c&&(c=m,l={microphone:p,speaker:g})}}catch(e){r={error:e}}finally{try{h&&!h.done&&(a=f.return)&&a.call(f)}finally{if(r)throw r.error}}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}return l}function u(e,t){if(e===t)return e;var n=s.getLongestCommonContiguousSubstring(e,t);n=n.trim().replace(/^\((.+)\)$/,"$1");var i="",r="",o=0,a=[d(e),d(t)];if(0===a[0]||0===a[1])return n;for(var c=0;c<n.length;c++)if("("===n[c])o++,r+=n[c];else if(")"===n[c]){if(!(o>0))break;o--,i+=r+=n[c],r=""}else o>0?r+=n[c]:i+=n[c];var l=d(i);return l!==a[0]&&l!==a[1]||(i=u(n,i=i.replace(/\w+\s?\((.+)\)/,"$1"))),i.trim()}function d(e){for(var t=["(",")"],n=0,i=function(i){t.some(function(t){return e[i]===t})&&n++},r=0;r<e.length;r++)i(r);return n}t.compileAudioDeviceList=function(e,t,n,i){void 0===n&&(n=.5),void 0===i&&(i={str:""});var d=[];if(e.length&&t.length){var p=function(e,t,n){var i,s,c,u;void 0===n&&(n={str:""});var d=new Set;try{for(var p=o(r(e,t)),f=p.next();!f.done;f=p.next()){var h=f.value;d.add(h.groupId)}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}var g=[],m=function(i){var r=e.filter(function(e){return e.groupId===i}),o=t.filter(function(e){return e.groupId===i});if(r&&o)if(1==r.length&&1==o.length)g.push({microphone:r[0],speaker:o[0]}),n.str+="|pairSimple("+a.scrubMriOrOmit(r[0].guid)+", "+a.scrubMriOrOmit(o[0].guid)+")";else if(r.length>1||o.length>1)for(var s=l(r,o);s;)n.str+="|pairComplex("+a.scrubMriOrOmit(s.microphone.guid)+", "+a.scrubMriOrOmit(s.speaker.guid)+")",g.push(s),r=r.filter(function(e){return e!==s.microphone}),o=o.filter(function(e){return e!==s.speaker}),s=l(r,o)};try{for(var v=o(d.values()),y=v.next();!y.done;y=v.next()){var S=y.value;m(S)}}catch(e){c={error:e}}finally{try{y&&!y.done&&(u=v.return)&&u.call(v)}finally{if(c)throw c.error}}return g}(e.filter(function(e){return""!==e.groupId}),t.filter(function(e){return""!==e.groupId}),i);p.length&&(d.push.apply(d,r(p.map(function(e){return c.createCompositeAudioDevice(e.microphone,e.speaker,u(e.microphone.label,e.speaker.label))}))),i.str+="|directMatched("+d.length+")");var f=d.length;d.push.apply(d,r(function(e,t,n,i){var r=[];return e.length&&t.length?(e.forEach(function(e){var o=t.filter(function(t){return t.groupId===e.groupId});if(o.length){var l=s.getLongestCommonContiguousSubstring(e.label,o[0].label).length,d=o.sort(function(t,n){var i=s.getLongestCommonContiguousSubstring(e.label,t.label),r=s.getLongestCommonContiguousSubstring(e.label,n.label);return i.length>l&&(l=i.length),r.length>l&&(l=r.length),r.length-i.length});if(d.length){var p=l/e.label.length;p>n&&(r.push(c.createCompositeAudioDevice(e,d[0],u(e.label,d[0].label))),i.str+="|lbl_matched("+a.scrubMriOrOmit(e.guid)+" & "+a.scrubMriOrOmit(d[0].guid)+", "+Math.round(1e4*p)/100+"%)")}}else i.str+="|lbl_nocand("+a.scrubMriOrOmit(e.guid)+")"}),r):r}(e.filter(function(e){return!d.some(function(t){return t.micDeviceId===e.guid})}),t.filter(function(e){return!d.some(function(t){return t.speakerDeviceId===e.guid})}),n,i))),i.str+="|otherMatched("+(d.length-f)+")"}return d}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(19),a=n(6),s=n(0),c=function(e){function t(t,n){var i=e.call(this)||this;return i.logger=t,i.mediaStream=n,i.subs=[],i.subscribeOnMediaStreamEvents(n),i}return r(t,e),t.prototype.acquire=function(){var e=this;return this.mediaStream?this.mediaStream.start().then(function(){return e.logger.safe.info("Stream acquired")}).catch(function(t){throw e.logger.safe.warn("Failed to acquire the stream: "+s.stringifyObject(t)),t}):Promise.reject("Disposed")},t.prototype.dispose=function(){this.logger.safe.info("Disposing stream"),this.unsubscribeFromMediaStreamEvents(),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null)},t.prototype.subscribeOnMediaStreamEvents=function(e){var t=this;this.subs=[e.on("onStreamClientStarted",function(){return t.event("onStreamStateChanged").raise("active")}),e.on("onStreamClientMuted",function(e,n){return t.event("onStreamStateChanged").raise(n?"inactive":"active")}),e.on("onStreamClientEnded",function(){return t.event("onStreamStateChanged").raise("stopped")}),e.on("onStreamClientError",function(e,n){var i=n.type===o.Constants.MEDIA_ERROR.permissionDeniedError||n.type===o.Constants.MEDIA_ERROR.sharingCancelledError;t.event("onStreamStateChanged").raise(i?"cancelled":"failed")})]},t.prototype.unsubscribeFromMediaStreamEvents=function(){this.subs.forEach(function(e){return e.dispose()}),this.subs=[]},t}(a.default);t.DevicesHandle=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),c=n(12),l=n(0),u=n(2),d=n(27),p=[u.default.MEDIA_STATE.inactive,u.default.MEDIA_STATE.receive,u.default.MEDIA_STATE.send,u.default.MEDIA_STATE.sendReceive],f=[u.default.MEDIA_STATE.inactive,u.default.MEDIA_STATE.receive],h=function(e){function t(t,n,i){var r=e.call(this)||this;return r.configProvider=t,r.deviceManager=n,r.logger=i,r.currentState={microphone:"unknown",camera:"unknown"},r.lastGum={audio:!1,video:!1},r.registeredTrackers=new Set,r.window=c.default.window,r.permittedModalities={audio:p,video:p,sharing:p},r.initialize(),r}return r(t,e),t.prototype.initialize=function(){return o(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return"unknown"!==this.currentState.microphone&&"unknown"!==this.currentState.camera?[3,3]:(this.logger.safe.info("Initializing"),[4,this.registerPermissionTracker("microphone")]);case 1:return e.sent(),[4,this.registerPermissionTracker("camera")];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.getPermissionState=function(e){return this.currentState[e]||"unknown"},t.prototype.isPermissionKnown=function(e){var t=this.getPermissionState(e);return"unknown"!==t&&"prompt"!==t},Object.defineProperty(t.prototype,"browserPermittedModalities",{get:function(){return this.permittedModalities},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"knownPermissionStates",{get:function(){return l.deepClone(this.currentState)},enumerable:!0,configurable:!0}),t.prototype.update=function(e,t){var n=this,i=l.deepClone(t);e.audio||delete i.audio,e.video||delete i.video;var r=l.deepClone(this.permittedModalities);l.forOwn(i,function(e,t){n.permittedModalities[t]=e?p:f}),l.deepEqual(r,this.permittedModalities)||this.event("onDevicesPermissionChanged").raise()},t.prototype.askDevicePermission=function(e){return o(this,void 0,void 0,function(){var t,n,i,r,s,c,u,d=this;return a(this,function(f){switch(f.label){case 0:if(t=e?l.deepClone(e):{audio:!0,video:this.deviceManager.hasCamera()},this.configProvider.config.permissions.rememberNegative&&(t.audio=t.audio&&this.permittedModalities.audio===p,t.video=t.video&&this.permittedModalities.video===p),t.sharing)throw new Error("askDevicePermission does not support sharing constraints.");return n={audio:!1,video:!1},this.lastGum={audio:!1,video:!1},i=function(n,i,r){return o(d,void 0,void 0,function(){var o;return a(this,function(a){switch(a.label){case 0:return o={audio:!!n.audio,video:!!n.video,sharing:!0},!(this.configProvider.config.permissions.adpRequestAVLast&&t.audio&&t.video)||this.lastGum.audio&&this.lastGum.video?[3,2]:(this.logger.safe.info("Prompting for audio and video to ensure omnibar state"),[4,this.askDevicePermissionPrompt({audio:!0,video:!0},!1)]);case 1:a.sent(),a.label=2;case 2:return this.update(t,o),this.deviceManager.raiseTelemetryEvent("ask_device_permission",{constraints:e,resultConstraints:n,error:r,reason:i}),[2,o]}})})},[4,this.initialize()];case 1:return f.sent(),r=this.getPermissionState("microphone"),s=this.getPermissionState("camera"),this.logger.safe.info("Permission state { audio: "+r+", video: "+s+" }"),!this.configProvider.config.permissions.useNegativeInAdp||t.audio&&"denied"!==r||t.video&&"denied"!==s?this.configProvider.config.permissions.usePositiveInAdp&&(!t.audio||t.audio&&"granted"===r)&&(!t.video||t.video&&"granted"===s)?[2,i(t,"navigator_permissions_granted")]:[3,2]:[2,i(n,"navigator_permissions_denied")];case 2:return f.trys.push([2,4,,5]),c=i,[4,this.askDevicePermissionPrompt(t,this.configProvider.config.permissions.adpFallback)];case 3:return[2,c.apply(void 0,[f.sent(),"stream_acquisition"])];case 4:return u=f.sent(),[2,i(n,"stream_acquisition",u)];case 5:return[2]}})})},t.prototype.askDevicePermissionPrompt=function(e,t){return void 0===t&&(t=!0),o(this,void 0,void 0,function(){var n,i,r,o,s,c,u;return a(this,function(a){switch(a.label){case 0:n={audio:!1,video:!1},a.label=1;case 1:return a.trys.push([1,4,,16]),(i=this.deviceManager.getMediaStream(e))?(this.lastGum=l.deepClone(e),[4,i.start()]):[3,3];case 2:a.sent(),n.audio=i.hasAudio(),n.video=i.hasVideo(),this.disposeLater(i),a.label=3;case 3:return[2,n];case 4:if(r=a.sent(),!(e.audio&&e.video&&t))return[3,14];a.label=5;case 5:return a.trys.push([5,8,,9]),o=n,(s=this.configProvider.config.permissions.adpFallbackVideo)?[4,this.askDevicePermissionPrompt({video:!0})]:[3,7];case 6:s=a.sent().video,a.label=7;case 7:return o.video=s,[3,9];case 8:return a.sent(),[3,9];case 9:return a.trys.push([9,12,,13]),c=n,(u=this.configProvider.config.permissions.adpFallbackAudio)?[4,this.askDevicePermissionPrompt({audio:!0})]:[3,11];case 10:u=a.sent().audio,a.label=11;case 11:return c.audio=u,[3,13];case 12:return a.sent(),[3,13];case 13:return[3,15];case 14:if(t)throw r;a.label=15;case 15:return[2,n];case 16:return[2]}})})},t.prototype.disposeLater=function(e){setTimeout(function(){e.dispose()},this.configProvider.config.mediaStreamHoldInterval)},t.prototype.registerPermissionTracker=function(e){return o(this,void 0,void 0,function(){var t,n,i=this;return a(this,function(r){switch(r.label){case 0:if(this.registeredTrackers.has(e))return[2];if(!d.UserAgentConfig.hasPermissionsApi())return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.window.navigator.permissions.query({name:e})];case 2:return t=r.sent(),this.handlePermissionStateChanged(e,t.state),t.onchange=function(){return i.handlePermissionStateChanged(e,t.state)},this.registeredTrackers.add(e),[3,4];case 3:return n=r.sent(),this.logger.safe.error("Error querying permissions for "+e+": "+n),[3,4];case 4:return[3,6];case 5:this.logger.safe.warn("Permissions API is not supported in this browser."),r.label=6;case 6:return[2]}})})},t.prototype.handlePermissionStateChanged=function(e,t){this.logger.safe.info("Permission state for "+e+" changed "+this.currentState[e]+" -> "+t),this.currentState[e]=t,this.deviceManager.raiseTelemetryEvent("permissions_state_changed",this.knownPermissionStates),this.deviceManager.handlePermissionStateChange()},t}(s.default);t.PermissionManager=h},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.safe=e,this.unsafe=t,this.safe||(this.safe=this.unsafe)}return e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).warn.apply(e,r(t))},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).error.apply(e,r(t))},e.prototype.debug=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).debug.apply(e,r(t))},e.prototype.info=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).info.apply(e,r(t))},e.prototype.createChild=function(t){return new e(this.safe.createChild(t),this.unsafe.createChild(t))},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(53),o=n(207),a=n(21),s=n(54),c=n(98),l=n(56),u=n(0),d=n(2),p=n(57),f=n(9),h=n(59),g=n(37),m=n(215),v=n(218),y=n(219),S=n(221),_=n(222);function E(e,t,n){var T;this.configureModalitiesAsync=function(e){var t=Q.then(function(){if(!e||!e.audio&&!e.video&&!e.sharing)throw new Error("Invalid parameters!"+JSON.stringify(e));var t=Promise.resolve();return!f.areSendDirectionsFulfilled(e,U)&&x.state!==x.HAVE_REMOTE_OFFER&&(t=t.then(function(){return W.start(f.getSendMediaModalities(e))}).then(function(t){e=f.mergeSendModalities(e,t)})),t.then(function(){var t=!C||!f.areNegotiatedDirectionsFulfilled(e,U);C=e,t&&ae()}).then(function(){return C})});return Q=t.catch(function(e){R.safe.warn("Error during configuring modalities: "+e)}),t},this.getConfiguredModalities=function(){return C},this.processOfferAsync=function(e){return new Promise(function(t){H=!1;var n,i=e.blob;R.unsafe.debug("PROCESS OFFER","sdp:",i),u.throwIfNotSupported(e.contentType,V),G=e.contentType,x.change(x.HAVE_REMOTE_OFFER),n=D.sdpToParams(i),w.processOffer(n),M=n.transportParams,t(I=f.invertModalities(g.default.getModalitiesFromMedia(n.media)))})},this.createAnswerAsync=function(e){return e?(x.change(x.HAVE_LOCAL_PRANSWER,!0),Promise.resolve({blob:"",contentType:G,modalities:{audio:"sendrecv",video:"sendrecv",sharing:"sendrecv"}})):Promise.resolve().then(function(){if(x.change(x.HAVE_LOCAL_ANSWER,!0),!C)throw new Error("Modalities not configured for answer");A=f.excludePassiveModalities(C,X,I),t=w.createMediaDescriptorsForAnswer(A);var e=f.getSendMediaModalities(A);return Promise.all([W.start(e),K.assureInitAsync("controlled",se(t),!0)])}).then(function(){return K.waitIceCompletionIfNeededAsync(M)}).then(function(){return K.getLocalParamsAsync()}).then(function(n){le(n),ne(t);var i=w.createAnswer(t,n,re(),e);x.complete(),P.callbacks.onTransportInitialized&&P.callbacks.onTransportInitialized();var r=D.paramsToSdp(i);return R.debug(e?"CREATE PRANSWER":"CREATE ANSWER","sdp:",r),{blob:r,contentType:G}});var t},this.createOfferAsync=function(){return new Promise(function(t){if(H=!0,x.change(x.HAVE_LOCAL_OFFER,!0),A=f.excludePassiveModalities(C,X,I),!I||!I.video||I.video!==d.default.MEDIA_STATE.send&&I.video!==d.default.MEDIA_STATE.sendReceive||C.video!==d.default.MEDIA_STATE.inactive&&C.video!==d.default.MEDIA_STATE.receive||F.forEach(function(e){e.getMediaParameters().descr.label===d.default.MEDIA_LABEL.video&&e.stopSender()}),I=A,f.hasSendDirectionality(A.sharing)&&!e.configProvider.config.ortcOutgoingScreenSharingEnabled)throw new Error("unsupported shreensharing send directionality in _negotiatingModalities "+JSON.stringify(A));var n=w.createMediaDescriptorsForOffer(A);t(ue("controlling",se(n),!0).catch(function(e){if("IceGatherer failed!"===e.message)return ee.IceGathererFailed="true",R.safe.info("IceGatherer failed! Retry without relays"),K.stop(),ue("controlling",se(n),!1);throw e}).then(function(e){le(e),ne(n);var t=w.createOffer(n,e,re());x.complete();var i=D.paramsToSdp(t);return R.debug("CREATE OFFER","sdp:",i),{blob:i,contentType:G}}))})},this.processAnswerAsync=function(e,t,n){void 0===t&&(t=i.generateCauseId());var r=e.blob;if(R.debug(n?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",r),n)return x.change(x.HAVE_REMOTE_PRANSWER),R.safe.info("["+t+"] ignoring provisional answer"),Promise.resolve();G=e.contentType;var o=D.sdpToParams(r),a=f.invertModalities(g.default.getModalitiesFromMedia(o.media)),s=f.getSendMediaModalities(a);return W.start(s).then(function(){return x.change(x.HAVE_REMOTE_ANSWER),w.processAnswer(o),P.callbacks.onTransportInitialized&&P.callbacks.onTransportInitialized(),a})},this.completeNegotiationAsync=function(){return Promise.resolve().then(function(){x.change(x.STABLE,!0);var t=w.completeNegotiation(),n=t.media,i=function(e){var t=arguments[1];if(W.stop(),e)return t;throw t};return function(e){F.forEach(function(t,n){t.setTransportId(e[n].descr.transportId)})}(n),K.configureTransportAsync(t,function(e){var t=[];return e.forEach(function(e){e.descr.enabled&&-1===t.indexOf(e.descr.transportId)&&t.push(e.descr.transportId)}),t}(n)).then(function(){!function(){if(he())throw new Error("session is already terminated")}();for(var t=0;t<n.length;t++){var i=void 0,r=void 0;if(F[t]){i=K.getTransportById(F[t].getTransportId());var o=de(n[t].descr.label);r=W.streams[o]}if(n[t].descr.label===d.default.MEDIA_LABEL.audio){var a=F[t].getRecvTrack();F[t].configureChannel(n[t],i,r),F[t].getRecvTrack()&&F[t].getRecvTrack()!==a?(e.configProvider.userAgentConfig.isAudioOutputSelectionSupported&&q.setOutputDevice(e.getDeviceManager().getOutputDeviceId()),q.play(new MediaStream([F[t].getRecvTrack()]))):!F[t].getRecvTrack()&&a&&q.stop()}else(n[t].descr.label===d.default.MEDIA_LABEL.video||n[t].descr.label===d.default.MEDIA_LABEL.sharing)&&F[t].configureChannel(n[t],i,r)}pe(),x.complete(),U=g.default.getModalitiesFromMedia(n);var s=f.excludePassiveModalities(C,X,I),c=j||!f.areNegotiatedDirectionsAcceptable(s,A,U);return c&&ae(),R.safe.info("_completeNegotiationAsync: configured:",JSON.stringify(C),"_negotiatingModalities:",JSON.stringify(A),"activeModalities:",JSON.stringify(U)),{isComplete:!c,activeModalities:U,offeredModalities:I,attemptedModalities:A,configuredModalities:C,initiator:H}}).then(i.bind(null,!0),i.bind(null,!1))})},this.rejectNegotiationAsync=function(e,t,n){return new Promise(function(i){var r=e===d.default.RENEGOTIATION_ERROR.local;x.state=x.STABLE,R.safe.error("["+t+"] negotiation failed","error:",e),n&&(R.safe.info("retrying failed negotiation"),ae()),i({isComplete:r,activeModalities:U,offeredModalities:I,attemptedModalities:A,configuredModalities:C,initiator:H})})},this.createRemoteRenderer=function(e,t){return J.create(e,t)},this.sendDtmf=function(e){var t=ie(F,d.default.MEDIA_LABEL.audio);return t?t.sendDtmf(e):Promise.reject(new Error("no audio channel"))},this.canSendDtmf=function(){var e=ie(F,d.default.MEDIA_LABEL.audio);return!!e&&e.canSendDtmf()},this.getLastKnownStats=function(){return{type:"OrtcMediaStats",data:{}}},this.getStatsAsync=fe,this.terminate=function(){return R.safe.info("terminate"),fe().then(function(){x.change(x.TERMINATED),ge()},ge)},this.isReconnectSupported=function(){return e.configProvider.config.enableReconnectEdge},this.muteInputTypeAsync=function(e){return me(e,!0)},this.unmuteInputTypeAsync=function(e){return me(e,!1)},this.muteInputAsync=function(){return O=!0,me("Audio",!0)},this.unmuteInputAsync=function(){return O=!1,me("Audio",!1)},this.setMuteAsync=me,this.muteOutputAsync=function(e){return void 0===e&&(e=i.generateCauseId()),q.setMuted(!0,e),Promise.resolve()},this.unmuteOutputAsync=function(e){return void 0===e&&(e=i.generateCauseId()),q.setMuted(!1,e),Promise.resolve()},this.createAudioElement=function(e){},this._deviceSelectionChanged=function(){R.safe.info("_deviceSelectionChanged");var t=f.getSendMediaModalities(U);he()||!t.Audio&&!t.Video||W.stop().then(function(){return W.start(t)}).then(function(){var n;return t.Audio&&W.streams.Audio&&(n=ie(F,d.default.MEDIA_LABEL.audio),function(){var t=e.getDeviceManager().getOutputDeviceId();if(q.getDeviceId()!==t&&e.configProvider.userAgentConfig.isAudioOutputSelectionSupported){q.stop();var n=q.getStream();q.setOutputDevice(t),n&&q.play(n)}}(),n.updateLocalMediaStream(W.streams.Audio)),t.Video&&W.streams.Video&&(n=ie(F,d.default.MEDIA_LABEL.video)).updateLocalMediaStream(W.streams.Video),W.stop()}).catch(function(e){oe({type:d.default.MEDIA_ERROR.internalError,detail:e}),W.stop()})},this.onDeviceEvent=u.noop,this.onContributingSourcesChanged=null,this.callbacks={},this.getExtensionsManager=function(){return $},this.clone=function(i){void 0===i&&(i=!1);var r=u.shallowClone(e);r.config=u.shallowClone(e.config),r.ortcMediaContentType=G,i&&(r.config.isConference=!0);var o=new E(r,t,n);return T&&(o.relayManagerProvider=T),o.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,o},this.setInternals=function(e){e.renderers&&(J&&J.terminate(),(J=e.renderers).reset(),pe()),e.audioRenderer&&(e.audioRenderer.play(q.getStream()),q=e.audioRenderer)},this.move=function(e){q.stop(),e.setInternals({renderers:J,audioRenderer:q}),O?e.muteInputAsync():e.unmuteInputAsync(),J=null,q=null,this.callbacks.onTerminated=null},this.isFailed=function(){return K.iceTransport&&"failed"===K.iceTransport.state},this.isConnected=function(){return K.iceTransport&&("connected"===K.iceTransport.state||"completed"===K.iceTransport.state)},this.getAcceptedTypes=function(){return V};var C,I,A,b=e.config.iceTransportPolicy?e.config.iceTransportPolicy:d.default.ICE_TRANSPORT_POLICY.all,R=e.getLogger().createChild("ortc"),O=e.config.muted,P=this,N=!e.config.isConference,M=null,w=new v.default(R,e.configProvider,e.config.isConference),D=new y.default,L=!1,k=!1,x=new function(){var e=this;function t(t){throw new Error("Invalid state change:"+e.state+" "+t+" changing: "+e.changing)}this.STABLE="stable",this.NEGOTIATION_REQUESTED="negotiation_requested",this.HAVE_LOCAL_OFFER="have_local_offer",this.HAVE_REMOTE_PRANSWER="have_remote_pranswer",this.HAVE_REMOTE_ANSWER="have_remote_answer",this.HAVE_REMOTE_OFFER="have_remote_offer",this.HAVE_LOCAL_PRANSWER="have_local_pranswer",this.HAVE_LOCAL_ANSWER="have_local_answer",this.TERMINATED="terminated",this.state=e.STABLE,this.changing=!1,this.change=function(n,i){switch(e.busy&&t(n),i&&(e.changing=i),n){case e.STABLE:e.state!==e.HAVE_REMOTE_ANSWER&&e.state!==e.HAVE_LOCAL_ANSWER&&t(n);break;case e.NEGOTIATION_REQUESTED:e.state!==e.STABLE&&t(n);break;case e.HAVE_LOCAL_OFFER:e.state!==e.STABLE&&e.state!==e.NEGOTIATION_REQUESTED&&t(n);break;case e.HAVE_REMOTE_PRANSWER:case e.HAVE_REMOTE_ANSWER:e.state!==e.HAVE_LOCAL_OFFER&&e.state!==e.HAVE_REMOTE_PRANSWER&&t(n);break;case e.HAVE_REMOTE_OFFER:e.state!==e.STABLE&&e.state!==e.NEGOTIATION_REQUESTED&&t(n);break;case e.HAVE_LOCAL_PRANSWER:case e.HAVE_LOCAL_ANSWER:e.state!==e.HAVE_REMOTE_OFFER&&e.state!==e.HAVE_LOCAL_PRANSWER&&t(n);break;case e.TERMINATED:break;default:t(n)}e.state=n},this.complete=function(){e.changing=!1}},F=[],U={},j=!1,H=!1,B={triggerIceReinvite:function(){e.configProvider.config.disableIceReinvite?R.safe.info("ICE-reinvite disabled - triggerIceReinvite skipped"):(R.safe.info("triggerIceReinvite"),ae(!0))},onConnected:function(e){var t=ie(F,d.default.MEDIA_LABEL.audio);t&&t.getTransportId()===e&&(R.safe.info("audio channel transport connected"),P.callbacks.onAudioStateChanged(d.default.STREAMING_STATE.active)),P.callbacks.onTransportConnected&&P.callbacks.onTransportConnected()},onError:function(e,t){e.type=e.type||d.default.MEDIA_ERROR.iceConnectionError,e.detail=e.detail||"none";var n=ie(F,d.default.MEDIA_LABEL.audio)||F[0];n&&n.getTransportId()===t&&(R.error("primary transport disconnected, ending call"),oe(e))}},G=u.getFrom("ortcMediaContentType",e.config,e.configProvider.config),V=e.configProvider.config.ortcAllowedMediaContentType,W=new c.SessionStreamsProvider(e.getDeviceManager(),new a.PromiseQueue(R),R.createChild("SessionStreamsProvider")),q=new s.default(R.createChild("AudioRenderer"),e.configProvider),K=new S.default(e.configProvider,R,B,e.config.isRemoteClientLync,b,N),z=Promise.resolve({}),J=_.default.build(e.configProvider,R),Y=new l.default,Q=Promise.resolve(),X=e.config.passiveModalities,$=new p.default(R.createChild("ExtMgr")),Z=new r.ActiveSpeakerManager(n.onContributingSourcesChanged,n.onDominantSpeakerChanged),ee={IceGathererFailed:"false"};function te(e){if(e===d.default.MEDIA_TYPE.audio)return h.MediaChannelType.Audio;if(e===d.default.MEDIA_TYPE.video)return h.MediaChannelType.Video;throw new Error("Error in media descriptors descr.type: "+e)}function ne(t){for(var n=0;n<t.length;n++){if(t[n].label!==d.default.MEDIA_LABEL.audio||F[n])t[n].label===d.default.MEDIA_LABEL.video?F[n]||(i=R.createChild("VStrm_"+t[n].mediaId+":"),F[n]=new m.default(e.configProvider,t[n].mediaId,i,te(t[n].type),t[n].label,P,Y,!1)):t[n].label!==d.default.MEDIA_LABEL.sharing||F[n]||(i=R.createChild("SStrm_"+t[n].mediaId+":"),F[n]=new m.default(e.configProvider,t[n].mediaId,i,te(t[n].type),t[n].label,P,Y,!0));else{var i=R.createChild("AStrm_"+t[n].mediaId+":");F[n]=new m.default(e.configProvider,t[n].mediaId,i,te(t[n].type),t[n].label,P,Y,!1)}if(F[n]&&(F[n].setMute(O),F[n].preconfigureChannel(t[n])),F[n]&&F[n].getLabel()!==t[n].label)throw new Error("Error in media descriptors ch.label: "+F[n].getLabel()+" descr.label: "+t[n].label)}}function ie(e,t){for(var n=0;n<e.length;n++)if(e[n].getLabel()===t)return e[n];return null}function re(){for(var e=[],t=0;t<F.length;t++)F[t]&&(e[t]=F[t].getLocalParameters());return e}function oe(e){R.safe.error("Media error occurred","type:",e.type,"detail:",e.detail?e.detail.toString():"no details"),e.detail&&e.detail.stack&&R.safe.error("Stack:",e.detail.stack),P.callbacks.onSessionErrorOccurred&&P.callbacks.onSessionErrorOccurred(e)}function ae(e){x.state!==x.STABLE||x.changing?e&&(j=!0):(x.change(x.NEGOTIATION_REQUESTED),R.safe.info("triggerNegotiation","mods:",JSON.stringify(C),"force:",e),j=!1,P.callbacks.onNegotiationRequired&&P.callbacks.onNegotiationRequired())}function se(e){var t=0;return e.forEach(function(e){e.needsTransport&&t++}),t}function ce(e,t){P.callbacks.onAudioQualityChanged&&P.callbacks.onAudioQualityChanged({type:e,value:t?"Bad":"Good",isLocalSource:!0,mediaType:"Audio"})}function le(e){if(K.hasIceCandidates(e)==L&&(ce("NoNetwork",L=!L),L))throw{type:d.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"};K.hasIceCandidates(e)&&K.hasRelayIceCandidates(e)==k&&ce("NetworkRelaysNotReachable",k=!k)}function ue(e,t,n){return K.assureInitAsync(e,t,n).then(function(){return K.getLocalParamsAsync()})}function de(e){switch(e){case d.default.MEDIA_LABEL.audio:return"Audio";case d.default.MEDIA_LABEL.video:return"Video";case d.default.MEDIA_LABEL.sharing:return"ScreenShare"}return null}function pe(){J.update(F.filter(function(e){return d.default.MEDIA_LABEL.video===e.getLabel()||d.default.MEDIA_LABEL.sharing===e.getLabel()}))}function fe(){return he()?z:z=new Promise(function(e){var n={type:"OrtcMediaStats",data:{},localStreams:[{tracks:[]}],remoteStreams:[{tracks:[]}]},i=ie(F,d.default.MEDIA_LABEL.audio),r=ie(F,d.default.MEDIA_LABEL.video),o=ie(F,d.default.MEDIA_LABEL.sharing);i&&i.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:i.getSendTrack()}),r&&r.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:r.getSendTrack()}),o&&o.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:o.getSendTrack()}),i&&i.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:i.getRecvTrack()}),r&&r.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:r.getRecvTrack()}),o&&o.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:o.getRecvTrack()}),Promise.all([i?i.getReportsAsync():{},r?r.getReportsAsync():{},o?o.getReportsAsync():{}]).then(function(i){n.data={CorrelationId:t,mainAudio:i[0],mainVideo:i[1],appsharingVideo:i[2],Session:u.deepClone(ee)},e(n)}).catch(function(t){R.safe.error("getting statistics should never fail:",t),e(n)})})}function he(){return x.state===x.TERMINATED}function ge(){$.dispose(),Z.dispose(),K.stop(),q&&q.dispose(),J&&J.terminate(),F.forEach(function(e){e.terminate()}),P.callbacks.onTerminated&&P.callbacks.onTerminated(),n=null}function me(e,t){return R.safe.info("call setMuteAsync for "+e+" with mute state "+t),F.filter(function(t){return t.getLabel()===function(e){switch(e){case"Audio":return d.default.MEDIA_LABEL.audio;case"Video":return d.default.MEDIA_LABEL.video;case"ScreenShare":return d.default.MEDIA_LABEL.sharing;default:return null}}(e)}).forEach(function(e){return e.setMute(t)}),Promise.resolve()}Object.defineProperty(this,"relayManagerProvider",{set:function(e){T=e,K.relayManagerProvider=T}}),Z.setStrategy(new o.DSHGeneratingStrategy({configProvider:e.configProvider})),R.info("create session","config:",e.config),this.onError=function(e){oe(e)},this.onMediaCapabilitiesChanged=function(e,t){w.onMediaCapabilitiesChanged(e,t),x.state!==x.HAVE_LOCAL_ANSWER&&ae(!0)},this.onContributingSourcesChanged=function(e){x.state!==x.STABLE||x.changing||Z.onContributingSourcesChanged(e)},this.onAudioQualityChanged=function(e){P.callbacks.onAudioQualityChanged&&P.callbacks.onAudioQualityChanged(e)}}t.default={build:function(e,t,n){return new E(e,t,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e){this.sources=[],this.configProvider=e.configProvider,this.ping=this.setupTimer()}return e.prototype.setSources=function(e){var t=this;void 0===e&&(e=[]);var n=e.map(this.getOrCreateSource.bind(this)),i=this.excludeSources(this.sources,n);n.filter(function(e){return!t.isAlreadyActive(e)}).forEach(this.updateSourceTimestamp),i.forEach(function(e){t.updateTotalTime(e),t.resetStartTimestamp(e)}),this.ping||(this.ping=this.setupTimer())},e.prototype.setOnDominantSpeakerChanged=function(e){this.callback=e},e.prototype.dispose=function(){this.clearTimer(),this.sources=null,this.callback=null},e.prototype.excludeSources=function(e,t){return e.filter(function(e){return!t.some(function(t){return e.id===t.id})})},e.prototype.trigger=function(){if(this.hasAnyoneSpoken()){var e=this.sources.map(this.updateTotalTime).sort(function(e,t){return t.totalTime-e.totalTime}).map(function(e){return e.id});e.length&&!i.deepEqual(this.candidates,e)&&(this.candidates=e,this.callback&&this.callback(e)),this.sources.map(this.resetTotalTime).filter(this.isAlreadyActive).forEach(this.updateSourceTimestamp)}else this.clearTimer()},e.prototype.isAlreadyActive=function(e){return!!e.startTimestamp},e.prototype.setupTimer=function(){return window.setInterval(this.trigger.bind(this),this.configProvider.config.activeSpeaker.timeToPromote)},e.prototype.clearTimer=function(){this.ping&&(clearInterval(this.ping),this.ping=null)},e.prototype.getOrCreateSource=function(e){if(this.isExist(e))return this.sourceById(e);var t=new function(e){this.id=e,this.startTimestamp=0,this.totalTime=0}(e);return this.sources.push(t),t},e.prototype.isExist=function(e){return this.sources.some(function(t){return e===t.id})},e.prototype.hasAnyoneSpoken=function(){return this.sources.some(function(e){return 0!==e.startTimestamp||0!==e.totalTime})},e.prototype.sourceById=function(e){return i.find(this.sources,function(t){return e===t.id})},e.prototype.updateSourceTimestamp=function(e){e.startTimestamp=Date.now()},e.prototype.updateTotalTime=function(e){return e.startTimestamp&&(e.totalTime+=Date.now()-e.startTimestamp),e},e.prototype.resetStartTimestamp=function(e){return e.startTimestamp=0,e},e.prototype.resetTotalTime=function(e){return e.totalTime=0,e},e}();t.DSHGeneratingStrategy=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(209),o=n(210),a=function(){function e(){}return e.getExtension=function(e){switch(e){case i.default.EXTENSION_TYPE.dominantSpeakerHistory:return new r.default;case i.default.EXTENSION_TYPE.videoStreamControl:return new o.default;default:throw new Error("Extension of type "+e+" is not found")}},e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=function(e){function t(){var t=e.call(this,o.default.EXTENSION_TYPE.dominantSpeakerHistory)||this;return t.callback=null,t}return r(t,e),t.prototype.initialize=function(t){var n=this;e.prototype.initialize.call(this,t),this.extensionManagerSubscription=this.manager.on("onDominantHistoryMessage",function(e){return n.onDominantHistoryMessage(e)}),t&&t.callback&&(this.callback=t.callback)},t.prototype.dispose=function(){this.extensionManagerSubscription.dispose(),this.extensionManagerSubscription=null,this.callback=null,e.prototype.dispose.call(this)},t.prototype.onDominantHistoryMessage=function(e){this.callback&&this.callback(e.previousDominantSpeakerHistory)},t}(n(99).ExtensionBase);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(99),s=n(211),c=n(214),l=function(e){function t(){var t=e.call(this,o.default.EXTENSION_TYPE.videoStreamControl)||this;return t.messageGenerator=new c.MediaControlMessageGenerator,t}return r(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.subscribeListeners(),this.sourceRequester=new c.SourceRequester(t.logger),this.streamConfigurationHandler=new s.MediaStreamConfigurationHandler(t.logger,t.negotiationEmulator,t.qualityManager,t.configProvider)},t.prototype.configure=function(t){e.prototype.configure.call(this,t),this.sourceRequester.configure(t)},t.prototype.sendSourceRequest=function(e,t,n){var i=this.messageGenerator.getVideoControlMessage(e,t,n);return this.sourceRequester.sendMessage(1,i)},t.prototype.sendBandwidthInfo=function(e,t){var n=this.messageGenerator.getBandwidthInfoMessage(e,t);return this.sourceRequester.sendMessage(0,n)},t.prototype.sendMaxVideoSendCapabilities=function(e,t){var n=this.messageGenerator.getMaxVideoSendCapabilitiesMessage(e,t);return this.sourceRequester.sendMessage(0,n)},t.prototype.dispose=function(){this.unsubscribeListeners(),this.streamConfigurationHandler&&(this.streamConfigurationHandler.dispose(),this.streamConfigurationHandler=null),this.sourceRequester&&(this.sourceRequester.dispose(),this.sourceRequester=null),e.prototype.dispose.call(this)},t.prototype.onMediaStreamControlMessage=function(e){this.streamConfigurationHandler.handleMessage(e)},t.prototype.subscribeListeners=function(){var e=this;this.extensionManagerSubscription=this.manager.on("onMediaStreamControlMessage",function(t){return e.onMediaStreamControlMessage(t)})},t.prototype.unsubscribeListeners=function(){this.extensionManagerSubscription.dispose(),this.extensionManagerSubscription=null},t}(a.ExtensionBase);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(30),r=n(58),o=n(22),a=n(2),s=function(){function e(e,t,n,i){this.logger=e,this.emulator=t,this.qualityManager=n,this.configProvider=i,this.modifiers=this.configProvider.config.webrtcSimulcastSessionEnabled?[]:[new r.BandwidthControlModifier(this.logger,n,new o.default(i),i)]}return e.prototype.dispose=function(){this.modifiers&&(this.modifiers.forEach(function(e){return e.dispose()}),this.modifiers=null),this.emulator=null,this.logger=null},e.prototype.handleMessage=function(e){var t={controlVideoStreaming:e};return this.configureResolution(t),this.modifiers.length?(this.modifiers.forEach(function(e){return e.setVideoControlMessage(t)}),this.emulator.renegotiate(this.modifiers)):Promise.resolve()},e.prototype.configureResolution=function(e){this.logger.safe.info("Signaling FMTP: "+JSON.stringify(e.controlVideoStreaming));var t=String(e.controlVideoStreaming.sequenceNumber),n=e.controlVideoStreaming.controlInfo[0].fmtParamsList,i=e.controlVideoStreaming.controlInfo[0].fmtParams,r=[{causeId:t,isSimulcast:!!n,capabilities:n&&this.configProvider.config.webrtcFmtParamListSupported?this.parseFmtParamsList(n):[this.parseFmtParams(i)],sourceId:+e.controlVideoStreaming.controlInfo[0].sourceId}];this.qualityManager.setMaxCapabilities(r)},e.prototype.parseFmtParamsList=function(e){var t=this;return e.map(function(e){return t.parseFmtParams(e)})},e.prototype.parseFmtParams=function(e){var t=i.default.build(e);return{maxFs:+t.get(a.default.VIDEO_CAPABILITIES.MAX_FS_PATH),maxMbps:+t.get(a.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH),maxFps:+t.get(a.default.VIDEO_CAPABILITIES.MAX_FPS_PATH)/100,maxBr:1200*+t.get(a.default.VIDEO_CAPABILITIES.MAX_BR_PATH),ssrc:+t.get(a.default.VIDEO_CAPABILITIES.SSRC_PATH),keyframe:this.shouldGenerateKeyFrame(t)}},e.prototype.shouldGenerateKeyFrame=function(e){return e.get(a.default.VIDEO_CAPABILITIES.KEYFRAME_PATH)?!!+e.get(a.default.VIDEO_CAPABILITIES.KEYFRAME_PATH):this.configProvider.config.webrtcAllowRestoreKeyframe},e}();t.MediaStreamConfigurationHandler=s},function(e,t,n){var i=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;!function(e,t,n,r){if(r&&!n)t[r]=i(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=i(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=n(100),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),i=n[n.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return r(c,i,a)}}),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=i(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(i),r=0;r<n.length;r+=3)t.push({component:n[r],ip:n[r+1],port:n[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var i=n(100),r=/%[sdv%]/g,o=function(e){var t=1,n=arguments,i=n.length;return e.replace(r,function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},a=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var a=t.names[r];t.name?i.push(n[t.name][a]):i.push(n[t.names[r]])}else i.push(n[t.name]);return o.apply(null,i)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,r=t.innerOrder||c,o=[];return n.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})}),e.media.forEach(function(e){o.push(a("m",i.m[0],e)),r.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})})}),o.join("\r\n")+"\r\n"}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=function(){function e(){this.sequence=0}return e.prototype.getVideoControlMessage=function(e,t,n){var i={controlVideoStreaming:{sequenceNumber:++this.sequence,globalTimeStamp:(new Date).toString(),controlInfo:[{control:"start",sourceId:t,streamMsid:e}]}};return n&&(i.controlVideoStreaming.controlInfo[0].fmtParams=n),i},e.prototype.getBandwidthInfoMessage=function(e,t){return{applyChannelParameters:{multiChannelParameter:{mids:e,mediaParameter:JSON.stringify({payload:{remoteUplinkBWE:{bw:t.toString()}}})}}}},e.prototype.getMaxVideoSendCapabilitiesMessage=function(e,t){var n;function i(e){return 16*Math.ceil(e/16)}var r=((n={})[o.default.VIDEO_CAPABILITIES.MAX_FS_PATH]=t.maxFs,n[o.default.VIDEO_CAPABILITIES.MAX_FPS_PATH]=t.maxFps,n[o.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH]=t.maxMbps,n[o.default.VIDEO_CAPABILITIES.MAX_WIDTH]=i(t.maxWidth),n[o.default.VIDEO_CAPABILITIES.MAX_HEIGHT]=i(t.maxHeight),n);return{applyChannelParameters:{multiChannelParameter:{mids:e,mediaParameter:JSON.stringify({payload:{maxVideoSendCapabilities:{caps:r}}})}}}},e}();t.MediaControlMessageGenerator=a;var s=function(){function e(e){this.logger=e}return e.prototype.dispose=function(){this.sender=null},e.prototype.configure=function(e){this.sender=e.sender},e.prototype.sendMessage=function(e,t){return i(this,void 0,void 0,function(){return r(this,function(n){return this.checkConfigured()?(this.logger.safe.info("sending video control message: "+JSON.stringify(t)),[2,this.sender.send(e,t)]):(this.logger.safe.warn("extension not configured with sender"),[2,null])})})},e.prototype.checkConfigured=function(){return!!this.sender},e}();t.SourceRequester=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),r=n(0),o=n(101),a=n(2),s=n(216),c=n(59),l=n(217),u=n(37);function d(e){if(!e)return"null";if(!e.transport)return"transport not set";var t=e.transport.transport;return t?t.component+" "+t.role+" "+t.state:"ice transport not set"}var p=function(){function e(e,t,n,r,s,c,l,u){this.configProvider=e,this.channelId=t,this.logger=n,this.channelType=r,this.label=s,this.observer=c,this.ssrcGenerator=l,this.maintainResolution=u,this.contributingSourcesPollingInterval=1e3,this.doMute=!1,this.sendActive=!1,this.recvActive=!1,this.lastSources=[],this.subscribedMsi=a.default.MSI.unsubscribe,this.isSsrcUpdated=!1,this.networkSendQualityLevel="Good",this.networkRecvQualityLevel="Good",this.resolutionTable=new i.default(e);var d=e.config.ortcVideoCapabilityMaxFS,p=e.config.ortcVideoCapabilityMaxFPS;this.videoCapabilities=new o.default(d,p),this.ssrcRange=this.generateSsrcRange()}return e.prototype.setTransportId=function(e){this.transportId=e},e.prototype.getTransportId=function(){return this.transportId},e.prototype.getLabel=function(){return this.label},e.prototype.getType=function(){return this.channelType},e.prototype.getSubscrbedMsi=function(){return this.subscribedMsi},e.prototype.getMediaParameters=function(){return this.mediaParams},e.prototype.getLocalParameters=function(){var e=r.deepClone(this.getLocalRtpCaps());this.updateCodecParameters(e);var t={rtpCaps:e,rtxSsrc:this.getRtxSsrc(this.ssrcRange),ssrcRange:this.ssrcRange};return{sender:t,receiver:r.deepClone(t)}},e.prototype.configureChannel=function(e,t,n){this.logger.safe.info("configureChannel","type:",this.channelType,"transport:",d(t)),this.logger.info("descr:",JSON.stringify(e.descr)),this.mediaParams=e,e.descr.enabled?(this.configureSsrc(e.receiver,e.sender),this.configureReceiver(e.descr,e.receiver,t),this.configureSender(e.descr,e.sender,t,n)):this.disable()},e.prototype.updateLocalMediaStream=function(e){this.rtpSender&&this.replaceMediaStreamIfDifferent(e)},e.prototype.canSubscribe=function(){return this.recvActive&&this.rtpReceiver&&this.subscribedMsi===a.default.MSI.unsubscribe&&this.isVideo()},e.prototype.subscribe=function(e){if(this.subscribedMsi===a.default.MSI.unsubscribe&&this.isVideo())return this.subscribedMsi=e,this.requestSendCsrc(this.subscribedMsi);throw new Error("invalid call for subscribe:"+this.subscribedMsi+"type:"+this.channelType)},e.prototype.unsubscribe=function(){if(this.subscribedMsi===a.default.MSI.unsubscribe||!this.isVideo())throw new Error("invalid call for unsubscribe:"+this.subscribedMsi+"type:"+this.channelType);this.subscribedMsi=a.default.MSI.unsubscribe,this.requestSendCsrc(this.subscribedMsi)},e.prototype.getReportsAsync=function(){var e=this.recvActive?this.rtpReceiver:null,t=this.sendActive?this.rtpSender:null,n=e?e.transport.transport:t?t.transport.transport:null;return s.default.build({logger:this.logger},n,t,e).getReport()},e.prototype.getSendTrack=function(){return this.sendActive&&this.rtpSender?this.rtpSender.track:null},e.prototype.getRecvTrack=function(){return this.recvActive&&this.rtpReceiver?this.recvTrack:null},e.prototype.terminate=function(){this.disable(),this.logger.safe.info("terminated")},e.prototype.sendDtmf=function(e){return this.dtmfSender.sendDtmf(this.rtpSender,e)},e.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.rtpSender)},e.prototype.videoSizeChanged=function(e,t){var n=this,i=this.resolutionTable.getMaxFS(e,t);this.videoCapabilities?this.mediaParams.receiver?this.videoCapabilities.setMaxFS(i,function(e){var t=n.mediaParams.receiver.rtpCaps.codecs[0];"h264"===t.name.toLowerCase()&&n.observer.onMediaCapabilitiesChanged(c.VideoCapabilitiesEventType.CODEC_PARAMS_UPDATED,{mediaId:n.channelId,codecName:t.name,capabilities:{"max-fs":e.getMaxFS(),"max-mbps":e.getMaxMBPS(),"max-fps":e.getMaxFPS()}})}):this.logger.safe.warn("no incoming video"):this.logger.safe.error("no capabilities for provided modality:",self)},e.prototype.setMute=function(e){this.doMute=e,this.currMediaStreamRef&&this.currMediaStreamRef.setMuted(e)},e.prototype.preconfigureChannel=function(e){if(e){this.logger.safe.debug("Preconfigure with remote ssrc:",e.remoteSsrcRange),this.logger.safe.debug("Preconfigure label",this.label,"to",e.label),this.label=e.label;var t=this.rtpReceiver&&this.hasSsrcChanged(e.remoteSsrcRange,this.recvRemoteSsrc),n=this.rtpSender&&this.hasSsrcChanged(e.remoteSsrcRange,this.sendRemoteSsrc);(t||n)&&(this.isSsrcUpdated=!0,this.updateSsrcRange())}},e.prototype.getLocalRtpCaps=function(){return this.localRtpCaps||(this.localRtpCaps=this.gatherLocalRtpCaps()),this.localRtpCaps},e.prototype.gatherLocalRtpCaps=function(){var e=this,t=this.typeToString(this.channelType),n=RTCRtpReceiver.getCapabilities(t);if(!n.codecs)return n;if(this.channelType===c.MediaChannelType.Audio&&this.configProvider.config.audioCodec){var i=["cn","red"];r.remove(n.codecs,function(t){var n=t.name.toLowerCase();return n!==e.configProvider.config.audioCodec.toLowerCase()&&-1===i.indexOf(n)})}else this.channelType===c.MediaChannelType.Video&&this.configProvider.config.videoCodec&&r.remove(n.codecs,function(t){return t.name.toLowerCase()!==e.configProvider.config.videoCodec.toLowerCase()});if(this.channelType===c.MediaChannelType.Audio)for(var o=n.codecs.length-1;o>=0;o--){var a=n.codecs[o];"opus"===a.name.toLowerCase()&&(a.preferredPayloadType=111,this.logger.safe.info("Opus payloadType fix, change payload type to 111 for",a.name))}if(this.channelType===c.MediaChannelType.Video){var s=r.find(n.codecs,function(e){return"vp8"===e.name.toLowerCase()});s&&r.remove(n.codecs,function(e){return"vp8"===e.name.toLowerCase()||"rtx"===e.name.toLowerCase()&&s.preferredPayloadType===+e.parameters.apt})}return n},e.prototype.getRtxSsrc=function(e){var t=this.getLocalRtpCaps();return u.default.hasRtx(t.codecs)?this.ssrcRange.min+50:0},e.prototype.replaceMediaStreamIfDifferent=function(e){var t,n;this.isAudio()?(n=this.currMediaStreamRef.rawStream.getAudioTracks()[0],t=e.rawStream.getAudioTracks()):(n=this.currMediaStreamRef.rawStream.getVideoTracks()[0],t=e.rawStream.getVideoTracks());var i=t.length?t[0]:null;if(null!==i){var r=n.getSettings().deviceId,o=i.getSettings().deviceId;if(r!==o){this.logger.safe.info("replacing media track","currDevID:",r,"newDevID:",o,"currTrackID:",n.id,"newTrackID:",i.id);var a=e.clone();a.setMuted(this.doMute),this.isAudio()?this.rtpSender.setTrack(a.rawStream.getAudioTracks()[0]):this.rtpSender.setTrack(a.rawStream.getVideoTracks()[0]),this.currMediaStreamRef.dispose(),this.currMediaStreamRef=a}else this.logger.safe.info("NOT replacing media track","currDevID:",r,"newDevID:",o,"currTrackID:",n.id,"newTrackID:",i.id)}else this.logger.safe.error("media track is not available")},e.prototype.isAudio=function(){return this.channelType===c.MediaChannelType.Audio},e.prototype.isVideo=function(){return this.channelType===c.MediaChannelType.Video},e.prototype.updateContributingSources=function(){var e=this;if(this.recvActive&&this.rtpReceiver){var t=void 0;try{t=this.rtpReceiver.getContributingSources()}catch(e){return void this.logger.safe.error("failed to retrieve contributing sources from receiver","error:",e)}if(!t)return void this.logger.safe.warn("could not retrieve contributing sources from receiver");var n=t.map(function(e){return e.csrc});this.lastSources.length===n.length&&n.every(function(t,n){return t===e.lastSources[n]})||(this.logger.safe.debug("contributing sources changed","sources:",n),this.observer.onContributingSourcesChanged(n)),this.lastSources=n,setTimeout(this.updateContributingSources.bind(this),this.contributingSourcesPollingInterval)}else this.logger.safe.debug("receiver is missing, stop polling for contributing sources")},e.prototype.requestSendCsrc=function(e){if(this.recvActive&&this.rtpReceiver){this.logger.safe.info("_requestSendCsrc","csrc:",e);try{this.rtpReceiver.requestSendCSRC(e)}catch(e){this.logger.safe.error("failed to request send csrc","error:",e)}return!0}return!1},e.prototype.raiseAudioQualityEvent=function(e){var t={type:"NetworkSendQuality",value:"Good",isLocalSource:!0,mediaType:"Audio"};if("NetworkSendQuality"===e.name)t.type="NetworkSendQuality";else{if("NetworkReceiveQuality"!==e.name)return;t.type="NetworkRecvQuality"}if("Good"===e.value)t.value="Good";else if("Poor"===e.value)t.value="Poor";else{if("Bad"!==e.value&&"Catastrophic"!==e.value)return;t.value="Bad"}if("NetworkSendQuality"===t.type){if(this.networkSendQualityLevel===t.value)return;this.networkSendQualityLevel=t.value}else if("NetworkRecvQuality"===t.type){if(this.networkRecvQualityLevel===t.value)return;this.networkRecvQualityLevel=t.value}this.observer.onAudioQualityChanged(t)},e.prototype.createReceiver=function(e,t){var n=this;this.logger.safe.info("_rtpReceiver create");var i=this.typeToString(this.channelType);this.rtpReceiver=new RTCRtpReceiver(e.transport,i),this.recvTrack=this.rtpReceiver.track,this.rtpReceiver.onerror=function(e){n.logger.safe.error("_rtpReceiver.onerror","event:",e),n.observer.onError({type:a.default.MEDIA_ERROR.internalError,detail:JSON.stringify(e),isAudio:n.channelType===c.MediaChannelType.Audio})},this.rtpReceiver.onmsquality=function(e){e.messages.forEach(function(e){n.logger.safe.info("this.rtpReceiver.onmsquality","event:",e),n.raiseAudioQualityEvent(e)})}},e.prototype.createSender=function(e,t,n){var i,r=this;i=this.isAudio()?t.rawStream.getAudioTracks()[0]:t.rawStream.getVideoTracks()[0],this.logger.safe.info("this.rtpSender create trackID:",i.id," transport: ",d(e)),this.rtpSender=new RTCRtpSender(i,e.transport),this.logger.safe.info("this.rtpSender created"),this.rtpSender.onerror=function(e){r.logger.safe.error("this.rtpSender.onerror","event:",e),r.observer.onError({type:a.default.MEDIA_ERROR.internalError,detail:JSON.stringify(e),isAudio:r.channelType===c.MediaChannelType.Audio})},this.rtpSender.onmsquality=function(e){e.messages.forEach(function(e){r.logger.safe.info("this.rtpSender.onmsquality","event:",e),r.raiseAudioQualityEvent(e)})},this.rtpSender.onssrcconflict=function(e){r.logger.safe.error("this.rtpSender.onssrcconflict","event:",e)}},e.prototype.getRecvParams=function(e){var t=u.default.getRecvParams(e.rtpCaps,e.remoteSsrcRange,this.ssrcRange.min,e.rtcpReducedSize,e.rtcpMux,e.rtxSsrc);return this.maintainResolution&&(t.degradationPreference="maintain-resolution"),t.encodings[0].active=this.recvActive,t},e.prototype.getSendParams=function(e){var t=u.default.getSendParams(e.rtpCaps,this.ssrcRange,e.remoteSsrcRange.min,e.rtcpReducedSize,e.rtcpMux,e.rtxSsrc);return t.encodings[0].active=this.sendActive,t},e.prototype.configureSsrc=function(e,t){(this.rtpReceiver&&this.hasSsrcChanged(e.remoteSsrcRange,this.recvRemoteSsrc)||this.rtpSender&&this.hasSsrcChanged(t.remoteSsrcRange,this.sendRemoteSsrc))&&!this.isSsrcUpdated?this.updateSsrcRange():this.isSsrcUpdated=!1},e.prototype.updateSsrcRange=function(){var e=this.generateSsrcRange();this.logger.safe.debug("SSRC updating: ",this.ssrcRange," -> ",e),this.ssrcRange=e,this.observer.onMediaCapabilitiesChanged(c.VideoCapabilitiesEventType.SSRC_UPDATED,{mediaId:this.channelId,ssrcRange:this.ssrcRange,rtxSsrc:this.getRtxSsrc(this.ssrcRange)})},e.prototype.configureReceiver=function(e,t,n){this.rtpReceiver&&this.hasSsrcChanged(t.remoteSsrcRange,this.recvRemoteSsrc)&&(this.logger.safe.info("SSRC changed, resetting receiver"),this.stopReceiver()),this.rtpReceiver||(this.createReceiver(n,t),this.recvRemoteSsrc=t.remoteSsrcRange),this.recvActive=!!e.recv;var i=this.getRecvParams(t);this.logger.safe.debug("rtpReceiver.receive:",JSON.stringify(i)),this.rtpReceiver.receive(i),this.recvActive&&(this.isAudio()?this.updateContributingSources():this.subscribedMsi!==a.default.MSI.unsubscribe&&this.requestSendCsrc(this.subscribedMsi))},e.prototype.stopReceiver=function(){this.rtpReceiver&&(this.logger.safe.info("_rtpReceiver stop & destroy"),this.recvActive=!1,this.recvTrack=null,this.rtpReceiver.stop(),this.rtpReceiver=null)},e.prototype.configureSender=function(e,t,n,i){if(this.rtpSender&&this.hasSsrcChanged(t.remoteSsrcRange,this.sendRemoteSsrc)&&(this.logger.safe.info("SSRC changed, resetting sender"),this.stopSender()),this.sendActive=!!e.send,this.sendActive&&i){this.currMediaStreamRef?this.replaceMediaStreamIfDifferent(i):(this.currMediaStreamRef=i.clone(),this.currMediaStreamRef.setMuted(this.doMute)),this.rtpSender||(this.createSender(n,this.currMediaStreamRef,t),this.sendRemoteSsrc=t.remoteSsrcRange),this.dtmfSender||(this.dtmfSender=new l.default({logger:this.logger,configProvider:this.configProvider})),this.logger.safe.debug("this.rtpSender.configureSender",JSON.stringify(t));var r=this.getSendParams(t);this.logger.safe.debug("this.rtpSender.send:",JSON.stringify(r)),this.rtpSender.send(r)}else this.stopSender(),this.disposeLocalStream()},e.prototype.stopSender=function(){this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.rtpSender&&(this.logger.safe.info("this.rtpSender stop & destroy"),this.sendActive=!1,this.rtpSender.stop(),this.rtpSender=null)},e.prototype.disposeLocalStream=function(){this.currMediaStreamRef&&(this.currMediaStreamRef.dispose(),this.currMediaStreamRef=null)},e.prototype.hasSsrcChanged=function(e,t){return t&&e&&!r.deepEqual(e,t)},e.prototype.updateCodecParameters=function(e){var t=r.find(e.codecs,function(e){return"h264"===e.name.toLowerCase()});t&&t.parameters&&(t.parameters["max-fs"]=this.videoCapabilities.getMaxFS(),t.parameters["max-mbps"]=this.videoCapabilities.getMaxMBPS(),t.parameters["max-fps"]=this.videoCapabilities.getMaxFPS())},e.prototype.disable=function(){this.stopReceiver(),this.stopSender(),this.disposeLocalStream()},e.prototype.generateSsrcRange=function(){return this.channelType===c.MediaChannelType.Audio?this.ssrcGenerator.nextAudioStreamSsrc():this.channelType===c.MediaChannelType.Video?this.ssrcGenerator.nextVideoStreamSsrc():null},e.prototype.typeToString=function(e){return c.MediaChannelType[e].toLowerCase()},e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(36),r=n(0);function o(e,t,n,o){var a=e.logger.createChild("ChannelStats");this.getReport=function(){var e={};function s(t,n,o){if(!t)return null;var s=n+"."+(o?"msGetStats":"getStats"),c=new Promise(function(e){a.safe.info(s,"start"),e(o?t.msGetStats():t.getStats())}).then(function(t){a.safe.info(s,"complete"),e[n]=e[n]||{},r.forOwn(t,function(t){e[n][t.type||t.msType]=t})}).catch(function(e){a.safe.warn(s,"failed:",e)});return i.timeout(c,5e3,s).catch(function(e){a.safe.warn(s,"failed:",e)})}return e.extended={mediaDiagnostic:{reason:function(){if(!t)return"CheckNotCompleted";var e=t.state;return"new"===e||"checking"===e||"connected"===e?"CheckNotCompleted":"completed"===e?"CheckSucceed":"failed"===e||"closed"===e?"CheckFailed":"disconnected"===e?"MediaTimeout":"Unknown DiagnosticReason"}()}},new Promise(function(i){Promise.all([s(t,"iceTransport",!1),s(t,"iceTransport",!0),s(n,"sender",!1),s(n,"sender",!0),s(o,"receiver",!1),s(o,"receiver",!0)]).then(function(){i(e)}).catch(function(t){a.safe.error("getting statistics should never fail",t),i(e)})})}}t.default={build:function(e,t,n,i){return new o(e,t,n,i)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(102),r=function(){function e(e){this.queue=new i.DTMFQueue(e.logger),this.configProvider=e.configProvider}return e.prototype.sendDtmf=function(e,t){return e?(this.syncSender(e),this.ortcSender.canInsertDTMF?(this.ortcSender.insertDTMF(this.ortcSender.toneBuffer+t,this.configProvider.config.dtmf.toneDuration,this.configProvider.config.dtmf.toneGap),this.queue.waitForNotification(t)):Promise.reject(new Error("not available"))):Promise.reject(new Error("bad sender"))},e.prototype.canSendDtmf=function(e){return!!e&&(this.syncSender(e),!!this.ortcSender&&this.ortcSender.canInsertDTMF)},e.prototype.dispose=function(){this.queue.cleanup()},e.prototype.syncSender=function(e){this.ortcSender&&this.ortcSender.sender===e||(this.ortcSender&&(this.ortcSender.ontonechange=null,this.queue.cleanup(),this.ortcSender=null),this.ortcSender=new RTCDtmfSender(e),this.ortcSender.ontonechange=this.onToneChange.bind(this))},e.prototype.onToneChange=function(e){e.tone&&this.queue.toneSent(e.tone)},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(59),a=n(37);t.default=function(e,t,n){var s=n&&t.config.numVideoChannelsGvc?t.config.numVideoChannelsGvc:1;this.processOffer=function(t){c=t,e.debug("PROCESS OFFER","params:",JSON.stringify(c))},this.createMediaDescriptorsForAnswer=function(e){if(u&&u.media.length>c.media.length)throw new Error("Invalid remote offer - removed media lines");var t,n=[],i=!1,o=!1,l=0;d=p(c,!1);for(var h=0;h<c.media.length;h++){if(u&&u.media[h]){if(u.media[h].type!==c.media[h].type)throw new Error("Changing media type not supported");if(u.media[h].label&&c.media[h].label&&u.media[h].label!==c.media[h].label)throw new Error("Changing media label not supported")}c.media[h].descr.label!==r.default.MEDIA_LABEL.audio||i?c.media[h].descr.label===r.default.MEDIA_LABEL.video&&l<s?((t=f(a.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,h),c.media[h])).needsTransport=!0,l>0&&(t.send=!1,t.needsTransport=!1),n.push(t),l++):c.media[h].descr.label!==r.default.MEDIA_LABEL.sharing||o?n.push({enabled:!1,type:c.media[h].descr.type,label:u&&u.media[h]?u.media[h].descr.label:c.media[h].descr.label}):((t=f(a.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,h),c.media[h])).needsTransport=!0,n.push(t),o=!0):((t=f(a.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,h),c.media[h])).needsTransport=!0,n.push(t),i=!0)}if(d){var g=!1;n.forEach(function(e){!g&&e.needsTransport?g=!0:e.needsTransport=!1})}return n},this.createAnswer=function(t,n,o,a){for(var s,u={isOffer:!1,sessionVersion:c.sessionVersion,transportParams:h(n,c.transportParams),media:[],bundled:d,groups:[]},p=!1,f=!1,y=0,S=0,E=0;E<t.length;E++){var T=f&&t[E].label===r.default.MEDIA_LABEL.video||p&&u.bundled,C={},I=i.shallowClone(t[E]);if(I.enabled){p=!0;var A=g(o[E],c.media[E],!1,!1),b=g(o[E],c.media[E],!1,!0);C.receiver=A,C.sender=b,s=I.needsTransport?n[y]:n[S],I.transportId=s.transportId,I.needsTransport&&(S=y,y++),I.label===r.default.MEDIA_LABEL.video&&(I.firstVideoChannel=!f,f=!0),v(I,s,C.receiver)&&v(I,s,C.sender)||(I.enabled=!1,e.safe.warn("Rejecting media since unable to match parameters"))}u.media.push(m(I,C,!1,T,c.media[E].receiver.rtcpReducedSize))}e.debug(a?"CREATE PRANSWER":"CREATE ANSWER","params:",JSON.stringify(u)),a||(l=_(u,c,!1));var R=[];return u.media.forEach(function(e){d&&e.descr.enabled&&e.descr.mid&&R.push(e.descr.mid)}),u.groups=R,u},this.createMediaDescriptorsForOffer=function(e){var t=[],i=!1,o=!1,c=0,l=0;if(u)for(var p=0;p<u.media.length;p++){var f=void 0;u.media[p].descr.label!==r.default.MEDIA_LABEL.audio||i?u.media[p].descr.label===r.default.MEDIA_LABEL.video&&c<s?((f=a.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,l++)).needsTransport=!0,c>0&&(f.send=!1,f.needsTransport=!1),c++):u.media[p].descr.label!==r.default.MEDIA_LABEL.sharing||o?f={enabled:!1,type:u.media[p].descr.type,label:u.media[p].descr.label}:((f=a.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,l++)).needsTransport=!0,o=!0):((f=a.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,l++)).needsTransport=!0,i=!0),f.enabled&&(f.mid=u.media[p].descr.mid),t.push(f)}!i&&e.audio&&((f=a.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,l++)).needsTransport=!0,t.push(f));for(var h=c;h<s&&e.video;h++)f=a.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,l++),h>0?(f.send=!1,f.needsTransport=!1):f.needsTransport=!0,t.push(f);for(!o&&e.sharing&&((f=a.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,l++)).needsTransport=!0,t.push(f)),p=0;p<t.length;p++)t[p].mid||(t[p].mid="m"+p);if(n&&(d=!0),d){var g=!1;t.forEach(function(e){!g&&e.needsTransport?g=!0:e.needsTransport=!1})}return t},this.createOffer=function(t,n,i){for(var o={isOffer:!0,sessionVersion:u?u.sessionVersion:0,transportParams:h(n,u?u.transportParams:[]),groups:[],bundled:d,media:[]},a=!1,s=!1,l=0,p=0,f=0;f<t.length;f++){var g=u&&u.media[f]&&u.media[f].descr.enabled,v=!g&&t[f].enabled,y=void 0,S=s&&t[f].label===r.default.MEDIA_LABEL.video||o.bundled&&a;t[f].enabled&&t[f].mid&&o.groups.push(t[f].mid),y=v?i[f]:u.media[f],t[f].transportId=t[f].needsTransport?n[l].transportId:n[p].transportId,t[f].needsTransport&&(p=l,l++),a=a||g||v,t[f].label===r.default.MEDIA_LABEL.video&&(t[f].firstVideoChannel=!s,s=!0),o.media.push(m(t[f],y,v,S,!0))}return c=o,e.debug("CREATE OFFER","params:",JSON.stringify(c)),c},this.processAnswer=function(t){e.debug("PROCESS ANSWER","params:",JSON.stringify(t)),l=_(c,t,!0)},this.completeNegotiation=function(){return l.sessionVersion++,u=l,e.debug("NEGOTIATED","params:",JSON.stringify(u)),u},this.onMediaCapabilitiesChanged=function(t,n){return t===o.VideoCapabilitiesEventType.CODEC_PARAMS_UPDATED?function(t){var n=i.find(u.media,function(e){return e.descr.mediaId===t.mediaId});if(n){var r=a.default.getCodecByName(t.codecName,n.receiver.rtpCaps.codecs);r&&r.parameters?i.forOwn(t.capabilities,function(n,i){e.safe.info("changing ",i," for ",t.codecName," from ",r.parameters[i]," to ",n),r.parameters[i]=n}):e.safe.warn("codec not found for codecName: ",t.codecName)}else e.safe.warn("mediaCaps not found for mediaId: ",t.mediaId)}(n):t===o.VideoCapabilitiesEventType.SSRC_UPDATED?function(t){var n=i.find(u.media,function(e){return e.descr.mediaId===t.mediaId});n?(e.safe.info("SSRC changing: ",n.receiver.ssrcRange," -> ",t.ssrcRange),e.safe.info("rtxSSRC changing: ",n.receiver.rtxSsrc," -> ",t.rtxSsrc),n.receiver.ssrcRange=i.shallowClone(t.ssrcRange),n.sender.ssrcRange=i.shallowClone(t.ssrcRange),n.receiver.rtxSsrc=t.rtxSsrc,n.sender.rtxSsrc=t.rtxSsrc):e.warn("mediaCaps not found for mediaType: ",t.mediaId,u)}(n):void 0},this.supportsBundling=p;var c=null,l=null,u=null,d=!1;function p(e,n){return n||t.config.ortcPreferBundling||e&&e.bundledOnly?e&&e.groups&&e.groups.length>0:d}function f(e,t){var n=t.descr;n||(n={enabled:!0,send:!0,recv:!0});var i=e.send&&e.enabled&&n.recv&&n.enabled,r=e.recv&&e.enabled&&n.send&&n.enabled,o=e.enabled&&n.enabled&&(i||r||!e.send&&!e.recv||!n.send&&!n.recv),a=t.receiver.ssrcRange;return{enabled:o,mediaId:e.mediaId,mid:void 0===n.mid?null:n.mid.toString(),type:e.type,transportId:e.transportId,needsTransport:e.needsTransport,label:e.label,send:i,recv:r,remoteSsrcRange:a}}function h(e,n,i){for(var r=0;r<e.length;r++)if(e[r]&&(e[r].doRtcpMux=!(n[r]&&!n[r].doRtcpMux)),e[r]&&n[r]){for(var o=!1,s=0;!t.config.disableSdes&&s<n.length;s++)n[s]&&n[s].sdesParamsList&&n[s].sdesParamsList.length&&(o=!0);n[r].doRtcpMux&&(e[r].rtcpIceParams=null,e[r].rtcpIceCandidates=null),e[r].dtlsParams&&n[r].dtlsParams&&(e[r].dtlsParams.role="client"===n[r].dtlsParams.role?"server":"client"),!o&&n[r].dtlsParams||(e[r].dtlsParams=null),o||(e[r].sdesParamsList=[]);var c=null;e[r].sdesParamsList&&n[r].sdesParamsList&&(c=a.default.findMatchingSdesParams(e[r].sdesParamsList,n[r].sdesParamsList))&&(c.localSdesParams.tag=c.remoteSdesParams.tag,e[r].sdesParamsList=[c.localSdesParams],e[r].remoteSdesParams=c.remoteSdesParams)}else e[r]&&e[r].dtlsParams&&(e[r].dtlsParams.role=null);return e}function g(e,t,n,i){var r=i?e.sender:e.receiver,o=i?t.receiver:t.sender,s=a.default.matchRtpCaps(r.rtpCaps,o.rtpCaps,n,i);return{mid:n?r.mid:o.mid,transportId:r.transportId,ssrcRange:r.ssrcRange,remoteSsrcRange:o.ssrcRange,rtxSsrc:a.default.getRtxSsrc(s,r,o,i),rtpCaps:s}}function m(e,t,n,i,r){if(e.enabled){var o=t;return o.sender.rtcpReducedSize=r,o.receiver.rtcpReducedSize=r,o.descr=e,o.justAdded=n,o.bundledWithOther=i,o}return{descr:e}}function v(t,n,i){if(t.enabled){if(!n.sdesParamsList&&!n.dtlsParams)return e.warn("no sdes nor dtls params:",n.sdesParamsList,n.dtlsParams),!1;if(!i.rtpCaps.codecs.length)return e.safe.warn("no common codecs!",i.rtpCaps),!1}return!0}function y(e,t,n){for(var r=[],o=0;o<Math.max(e.length,t.length);o++){var s=null;if(e[o]&&t[o]){(s=i.shallowClone(t[o])).doRtcpMux=e[o].doRtcpMux&&t[o].doRtcpMux,s.enableDtls=e[o].dtlsParams&&t[o].dtlsParams,s.transportId=e[o].transportId;var c=null;e[o].sdesParamsList&&t[o].sdesParamsList&&(c=a.default.findMatchingSdesParams(e[o].sdesParamsList,t[o].sdesParamsList))&&(c.localSdesParams.tag=c.remoteSdesParams.tag,s.sdesParamsList=[c.localSdesParams],s.remoteSdesParams=c.remoteSdesParams)}r.push(s)}return r}function S(e,t,n,i,r){function o(n,r){var o=n?e.sender:e.receiver,a=n?t.sender:t.receiver,s=g(e,t,i,n);return s.rtcpMux=r.doRtcpMux,s.rtcpReducedSize=o.rtcpReducedSize&&a.rtcpReducedSize,s.enableDtls=r.enableDtls,s}var s=f(e.descr,t),c={descr:s};if(s.enabled){s.transportId=r?n[0].transportId:s.transportId;var l=a.default.getTransportIndexById(n,s.transportId),u=r?n[0]:n[l];if(c.descr=s,c.sender=o(!0,u),c.receiver=o(!1,u),!v(s,u,c.sender)||!v(s,u,c.receiver))throw new Error("Failed to verify negotiated parameters!")}return c}function _(e,t,n){if(e.media.length!==t.media.length)throw new Error("Number of media lines doesn't match in offer & answer l:"+e.media.length+" r: "+t.media.length);d=p(t,n);for(var i={sessionVersion:n?e.sessionVersion:t.sessionVersion,transportParams:y(e.transportParams,t.transportParams),bundle:n?e.groups:t.groups,bundled:d,media:[]},r=0;r<e.media.length;r++)i.media.push(S(e.media[r],t.media[r],i.transportParams,n,i.bundled));return i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(220),r=n(30),o=n(0),a=n(2),s=n(37);t.default=function(){function e(e,t){return t?e.replace(/\\/g,"/"):e.replace(/\//g,"\\")}function t(e,t){return e.toLowerCase()===t.toLowerCase()}function n(e){return-1===e.indexOf(":")}function c(e,n,i){i.push({foundation:e.foundation,component:n,transport:function(e,t){var n=e.toUpperCase();if("TCP"===n)switch(t.toLowerCase()){case"active":return"TCP-ACT";case"passive":return"TCP-PASS";case"so":return"TCP-SO"}return n}(e.protocol,e.tcpType),priority:e.priority,ip:e.ip,port:e.port,type:e.type,raddr:t(e.type,"host")?void 0:e.relatedAddress,rport:t(e.type,"host")?void 0:e.relatedPort})}function l(e,t,i,r){e&&e.forEach(function(e){n(e.ip)?c(e,t,i):c(e,t,r)})}function u(e){if(e.iceCandidatePair)return{0:e.iceCandidatePair.local,1:e.rtcpIceCandidatePair?e.rtcpIceCandidatePair.local:null};var t=e.iceCandidates.slice(0).sort(function(e,t){return t.priority-e.priority})[0],n=null;if(e.rtcpIceCandidates)for(var i=0;i<e.rtcpIceCandidates.length;++i){var r=e.rtcpIceCandidates[i];if(r.foundation===t.foundation){n=r;break}}return{0:t,1:n}}function d(i,r,s,c,d,p){var f=r.receiver,h={rtp:[],fmtp:[],rtcpFb:[],ext:[],type:r.descr.type,port:0,protocol:"RTP/SAVP",payloads:"",cryptoscale:[],crypto:[],candidates:[],xCandidatesIpv6:[]};if(!r.descr.enabled)return h.type===a.default.MEDIA_TYPE.video?h.payloads="34":h.payloads="9",h;r.descr.mid&&(h.mid=r.descr.mid);var g,m,v,y,S=u(i);if(h.port=S[0].port,(d&&h.mid===p[0]||!d)&&(g=S[0],m=S[1],c.ip!==g.ip&&(h.connection={version:n(g.ip)?4:6,ip:g.ip})),h.iceUfrag=i.iceParams.usernameFragment,h.icePwd=i.iceParams.password,h.type===a.default.MEDIA_TYPE.audio){var _=function(e){if(0===e.length)return{ptime:0,maxptime:0};var t=e[0].ptime,n=e[0].maxptime;return e.forEach(function(e){n>e.maxptime&&e.maxptime>0&&(n=e.maxptime)}),{ptime:t,maxptime:n}}(f.rtpCaps.codecs);h.maxptime=_.maxptime,h.ptime=_.ptime}h.direction=(v=r.descr.send,y=r.descr.recv,v&&y?"sendrecv":v?"sendonly":y?"recvonly":"inactive"),h.xSsrcRange={ssrcMin:f.ssrcRange.min,ssrcMax:f.ssrcRange.max},h.ssrcGroups=function(e,t){return e?[{semantics:"FID",ssrcs:t+" "+e}]:[]}(r.sender.rtxSsrc,r.sender.ssrcRange.min),h.label=r.descr.label,(h.label!==a.default.MEDIA_LABEL.video||r.descr.firstVideoChannel)&&(h.xSource=h.label),f.rtcpReducedSize&&(h.rtcpRsize=!0),s&&r.justAdded?(i.doRtcpMux&&(h.rtcpMux=!0),h.rtcp={port:m&&m.port||h.port+1}):i.doRtcpMux?h.rtcpMux=!0:h.rtcp={port:m&&m.port||h.port+1};var E=null;function T(e){return 0!==e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:""}if(f.rtpCaps&&f.rtpCaps.codecs&&(f.rtpCaps.codecs.forEach(function(e){h.rtp.push({payload:e.preferredPayloadType,codec:e.name,rate:e.clockRate,encoding:e.numChannels>1?e.numChannels:void 0});var n="";o.forOwn(e.parameters,function(e,t){""!==n&&(n+=";"),n+="events"===t?e:t+"="+e}),""!==n&&h.fmtp.push({payload:e.preferredPayloadType,config:n}),h.payloads+=(h.payloads?" ":"")+e.preferredPayloadType;for(var i=0;i<e.rtcpFeedback.length;i++)t(e.rtcpFeedback[i].type,"x-message")?E=e.rtcpFeedback[i].parameter:h.rtcpFb.push({payload:e.preferredPayloadType,type:e.rtcpFeedback[i].type,subtype:e.rtcpFeedback[i].parameter})}),E&&h.rtcpFb.push({payload:"*",type:"x-message",subtype:E})),f.rtpCaps&&f.rtpCaps.headerExtensions&&f.rtpCaps.headerExtensions.forEach(function(t){h.ext.push({value:t.preferredId,uri:e(t.uri,!1)})}),i.sdesParamsList)for(var C=0;C<i.sdesParamsList.length;++C){var I=i.sdesParamsList[C];t(I.cryptoSuite,"AES_CM_128_HMAC_SHA1_80")?h.crypto.push({id:I.tag,suite:"AES_CM_128_HMAC_SHA1_80",config:I.keyParams[0].keyMethod+":"+I.keyParams[0].keySalt+"|"+I.keyParams[0].lifetime+T(I.keyParams[0])}):t(I.cryptoSuite,"SCALE_AES_CM_128_HMAC_SHA1_80")&&h.cryptoscale.push({id:I.tag,flavor:"client",suite:"AES_CM_128_HMAC_SHA1_80",config:I.keyParams[0].keyMethod+":"+I.keyParams[0].keySalt+"|"+I.keyParams[0].lifetime+T(I.keyParams[0])})}if(r.bundledWithOther||(i.iceCandidatePair?(l([i.iceCandidatePair.local],1,h.candidates,h.xCandidatesIpv6),i.rtcpIceCandidatePair&&!i.doRtcpMux&&l([i.rtcpIceCandidatePair.local],2,h.candidates,h.xCandidatesIpv6),h.remoteCandidates="1 "+i.iceCandidatePair.remote.ip+" "+i.iceCandidatePair.remote.port,i.doRtcpMux?h.remoteCandidates+=" 2 "+i.iceCandidatePair.remote.ip+" "+i.iceCandidatePair.remote.port:h.remoteCandidates+=" 2 "+i.rtcpIceCandidatePair.remote.ip+" "+i.rtcpIceCandidatePair.remote.port):(l(i.iceCandidates,1,h.candidates,h.xCandidatesIpv6),(s&&r.justAdded||!i.doRtcpMux)&&l(i.rtcpIceCandidates,2,h.candidates,h.xCandidatesIpv6)),h.candidates.sort(function(e,t){return+e.foundation-+t.foundation||e.foundation===t.foundation&&e.component-t.component}),h.xCandidatesIpv6.sort(function(e,t){return+e.foundation-+t.foundation||e.foundation===t.foundation&&e.component-t.component})),i.dtlsParams)switch(h.fingerprint={type:i.dtlsParams.fingerprints[0].algorithm,hash:i.dtlsParams.fingerprints[0].value},i.dtlsParams.role){case"auto":h.setup="actpass";break;case"client":h.setup="active";break;case"server":h.setup="passive"}return h}function p(e){var n={foundation:e.foundation,priority:e.priority,ip:e.ip,protocol:function(e){var t=e.toLowerCase();switch(t){case"tcp-act":case"tcp-pass":case"tcp-so":return"tcp";default:return t}}(e.transport),port:e.port,type:e.type};return t(e.type,"host")||(n.tcpType=function(e){switch(e.toLowerCase()){case"tcp-act":return"active";case"tcp-pass":return"passive";case"tcp-so":return"so";default:return}}(e.transport),n.relatedAddress=e.raddr,n.relatedPort=e.rport),n}function f(e,t,n){e.candidates&&e.candidates.forEach(function(e){e.component===t&&n.push(p(e))}),e.xCandidatesIpv6&&e.xCandidatesIpv6.forEach(function(e){e.component===t&&n.push(p(e))})}function h(e){var t=e.match(/(\w+):([a-zA-Z0-9+\/]+={0,2})(\|([0-9\^]+))?(\|([0-9]+):([0-9]+))?/);if(t){var n={keyMethod:t[1],keySalt:t[2],mkiValue:0,mkiLength:0};return void 0!==t[4]&&(n.lifetime=t[4]),void 0!==t[7]&&(n.mkiValue=+t[6],n.mkiLength=+t[7]),n}}function g(e,n){var i={},r=[];function o(e,t,n,i){r.push({tag:e,cryptoSuite:t,keyParams:n,sessionParams:i})}if(n.cryptoscale&&n.cryptoscale.forEach(function(e){var n=t(e.flavor,"server")?h(e.config):void 0;n&&o(e.id,"SCALE_"+e.suite,[n],[])}),n.crypto&&n.crypto.forEach(function(e){var t=h(e.config);t&&o(e.id,e.suite,[t],[])}),i.iceParams={usernameFragment:n.iceUfrag,password:n.icePwd},i.sdesParamsList=r,i.iceCandidates=[],f(n,1,i.iceCandidates),i.doRtcpMux=!!n.rtcpMux,n.rtcpMux||(i.rtcpIceParams={usernameFragment:n.iceUfrag,password:n.icePwd},i.rtcpIceCandidates=[],f(n,2,i.rtcpIceCandidates),e.icelite&&(i.rtcpIceParams.iceLite=!0)),n.remoteCandidates&&(i.iceCandidatePair={}),e.fingerprint||n.fingerprint){var a=n.fingerprint?n.fingerprint:e.fingerprint,s="auto";switch(n.setup?n.setup:e.setup){case"actpass":s="auto";break;case"active":s="client";break;case"passive":s="server"}i.dtlsParams={role:s,fingerprints:[{algorithm:a.type,value:a.hash}]}}return e.icelite&&(i.iceParams.iceLite=!0),i}function m(t){var n=[],i=[];return t.rtp.forEach(function(e){var i={name:e.codec,kind:t.type,clockRate:e.rate,preferredPayloadType:e.payload,numChannels:e.encoding?e.encoding:1,rtcpFeedback:[],parameters:{}};t.type===a.default.MEDIA_TYPE.audio&&(i.ptime=t.ptime,i.maxptime=t.maxptime),t.rtcpFbXMessage&&t.rtcpFbXMessage.length&&t.rtcpFbXMessage.forEach(function(e){"*"!==e.payload&&i.preferredPayloadType!==+e.payload||i.rtcpFeedback.push({type:"x-message",parameter:e.param})}),t.rtcpFb&&t.rtcpFb.length&&t.rtcpFb.forEach(function(e){"*"!==e.payload&&i.preferredPayloadType!==+e.payload||i.rtcpFeedback.push({type:e.type,parameter:e.subtype||""})}),n.push(i)}),t.fmtp&&t.fmtp.forEach(function(e){var t=r.default.build(e.config),i=s.default.getCodecIndexByPayload(e.payload,n);t.names().forEach(function(e){n[i].parameters[e]=t.get(e)})}),t.ext&&t.ext.forEach(function(n){i.push({kind:t.type,uri:e(n.uri,!0),preferredId:n.value})}),{codecs:n,headerExtensions:i,fecMechanisms:[]}}function v(e){e.direction||(e.direction="sendrecv");var t=e.direction.toLowerCase(),n=0!==parseInt(e.port,10);return e.type!==a.default.MEDIA_TYPE.audio&&e.type!==a.default.MEDIA_TYPE.video&&(n=!1),{enabled:n,type:e.type,label:function(){if(n&&!e.label){if(a.default.MEDIA_TYPE.audio===e.type)return a.default.MEDIA_LABEL.audio;if(a.default.MEDIA_TYPE.video===e.type)return a.default.MEDIA_LABEL.video}return e.label}(),mid:e.mid,send:!!n&&("sendrecv"===t||"sendonly"===t),recv:!!n&&("sendrecv"===t||"recvonly"===t)}}function y(e){var t=v(e);if(t.enabled){var n={rtpCaps:m(e),ssrcRange:{min:e.xSsrcRange?e.xSsrcRange.ssrcMin:0,max:e.xSsrcRange?e.xSsrcRange.ssrcMax:0},mid:e.mid||void 0,rtxSsrc:function(e){if(e){var t=o.find(e,function(e){return"FID"===e.semantics});if(t)return+t.ssrcs.split(" ")[1]}return 0}(e.ssrcGroups),rtcpReducedSize:!!e.rtcpRsize};return{descr:v(e),receiver:n,sender:o.deepClone(n)}}var i={rtpCaps:null,ssrcRange:null,rtcpReducedSize:!1};return{descr:t,receiver:i,sender:i}}function S(e){return e&&e.groups?o.find(e.groups,function(e){return"BUNDLE"===e.type}).mids.toString().split(" "):[]}this.paramsToSdp=function(e){var t={},r=e.transportParams[0]||e.transportParams[1]||e.transportParams[2],o=function(e){for(var t=e.iceCandidates.slice(0).sort(function(e,t){return t.priority-e.priority}),n=0;n<t.length;n++)if("host"===t[n].type)return t[n].ip;return"0.0.0.0"}(r),c=u(r)[0];t.groups=s.default.groupsToSdp(e),t.version=0,t.origin={username:"-",sessionId:0,sessionVersion:e.sessionVersion,netType:"IN",ipVer:n(o)?4:6,address:o},t.bandwidth=[{type:"CT",limit:99980}],t.timing={start:0,stop:0},t.name="session",t.connection={version:n(c.ip)?4:6,ip:c.ip},t.xMediaBw={label:a.default.MEDIA_LABEL.video,sendBw:8100,receiveBw:8e3},t.media=[];for(var l=0;l<e.media.length;l++){var p=e.bundled?0:s.default.getTransportIndexById(e.transportParams,e.media[l].descr.transportId),f=e.transportParams[p];t.media.push(d(f,e.media[l],e.isOffer,c,e.bundled,e.groups))}return i.write(t)},this.sdpToParams=function(e){for(var t=i.parse(e),n={sessionVersion:t.origin.sessionVersion,transportParams:[],groups:S(t),bundledOnly:function(e){for(var t=0;t<e.media.length;t++)if(e.media[t].signalingFbXMessage)return!0;var n=S(e);return!(!n||!n[1])&&e.media.some(function(e){return e.mid===n[1]&&(!e.candidates||0===e.candidates.length)})}(t),media:[]},r=0;r<t.media.length;r++){var o=t.media[r],a=y(o);n.media.push(a),a.descr.enabled&&g(t,o).iceCandidates.length>0&&n.transportParams.push(g(t,o)),void 0!==a.mid&&(a.mid=a.mid.toString())}return n}}},function(e,t,n){e.exports=function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return r(n||e)},l,l.exports,e,t,n,i)}return n[a].exports}for(var o=!1,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){var i=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\S*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbXMessage",reg:/^rtcp-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){return"rtcp-fb:"+("*"===e.payload?"%s":"%d")+" x-message %s"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(e){return null!=e.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"cryptoscale",reg:/^cryptoscale:(\d*) (client|server) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","flavor","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"cryptoscale:%d %s %s %s %s":"cryptoscale:%d %s %s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t}},{push:"xCandidatesIpv6",reg:/^x-candidate-ipv6:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/,format:"rtcp-mux"},{name:"rtcpRsize",reg:/^(rtcp-rsize)/,format:"rtcp-rsize"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"label",reg:/^label:(\S*)/,format:"label:%s"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{name:"signalingFbXMessage",reg:/^x-signaling-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){return"x-signaling-fb:"+("*"===e.payload?"%s":"%d")+" x-message %s"}},{push:"xMediaSettings",reg:/^x-mediasettings:([\S| ]*)/,names:["settings"],format:"x-mediasettings:%s"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach(function(e){i[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],2:[function(e,t,n){var i=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;!function(e,t,n,r){if(r&&!n)t[r]=i(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=i(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=e("./grammar"),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},n=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),i=n[n.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return r(c,i,a)}}),t.media=n,t};var s=function(e,t){var n=t.split("=");return 2===n.length&&(e[n[0]]=i(n[1])),e};n.parseFmtpConfig=function(e){return e.split(/\;\s?/).reduce(s,{})},n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(i),r=0;r<n.length;r+=3)t.push({component:n[r],ip:n[r+1],port:n[r+2]});return t}},{"./grammar":1}],3:[function(e,t,n){var i=e("./grammar"),r=/%[sdv%]/g,o=function(e){var t=1,n=arguments,i=n.length;return e.replace(r,function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},a=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var a=t.names[r];t.name?i.push(n[t.name][a]):i.push(n[t.names[r]])}else i.push(n[t.name]);return o.apply(null,i)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,r=t.innerOrder||c,o=[];return n.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})}),e.media.forEach(function(e){o.push(a("m",i.m[0],e)),r.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})})}),o.join("\r\n")+"\r\n"}},{"./grammar":1}],"sdp-transform":[function(e,t,n){var i=e("./parser"),r=e("./writer");n.write=r,n.parse=i.parse,n.parseFmtpConfig=i.parseFmtpConfig,n.parsePayloads=i.parsePayloads,n.parseRemoteCandidates=i.parseRemoteCandidates},{"./parser":2,"./writer":3}]},{},[])("sdp-transform")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),r=n(0),o=n(2),a=n(37);function s(e,t,n,r,a,s,c){var l,u,d=this,p=new i.SettablePromise;this.nominatedCandidatePair=null,t.info("create RTCIceGatherer","options:",JSON.stringify(a.iceGathererOptions)),this.iceGatherer=s?s.createAssociatedGatherer():new RTCIceGatherer(a.iceGathererOptions),t.safe.info("create RTCIceTransport"),this.iceTransport=c?c.createAssociatedTransport():new RTCIceTransport,this.getLocalCandidatesAsync=function(){return p.promise},this.start=function(e,i){if(u)throw new Error("icetransport already started!");u=!0,l=n.createCb(a.iceRole),t.info("RTCIceTransport setRemoteCandidates","candidates:",JSON.stringify(e)),d.iceTransport.setRemoteCandidates(e),t.info("RTCIceTransport start","remoteIceParams:",JSON.stringify(i),"role:",a.iceRole),d.iceTransport.start(d.iceGatherer,i,a.iceRole),t.safe.info("RTCIceTransport start","role:",d.iceTransport.role)},this.dispose=function(){t.safe.info("dispose"),d.iceTransport.stop(),d.iceTransport=null,d.iceGatherer=null,p.isPending&&p.reject(new Error("operation canceled due to stop")),l&&l.dispose()},this.iceGatherer.onlocalcandidate=function(e){t.info("RTCIceGatherer.onlocalcandidate","candidate:",JSON.stringify(e.candidate)),0===Object.keys(e.candidate).length&&p.resolve()},this.iceGatherer.onerror=function(e){t.safe.error("RTCIceGatherer.onerror","event:",e),p.reject(new Error("IceGatherer failed!"))},this.iceTransport.onicestatechange=function(){d.iceTransport&&(t.safe.info("RTCIceTransport.onicestatechange","state:",d.iceTransport.state),"completed"===d.iceTransport.state?(t.info("pair:",JSON.stringify(d.iceTransport.getNominatedCandidatePair())),d.nominatedCandidatePair=d.iceTransport.getNominatedCandidatePair(),l.iceCompleted(),r.onConnected(e)):"connected"===d.iceTransport.state?r.onConnected(e):"disconnected"===d.iceTransport.state&&(t.safe.error("audio ICE transport disconnected, ending call!"),r.onError({type:o.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"},e)))},this.iceTransport.oncandidatepairchange=function(e){t.info("RTCIceTransport.oncandidatepairchange","event:",e)}}var c=0;function l(e,t,n,i,r,a,l){var u,d,p,f,h=this,g=!1;function m(e){var t=e;return(r.iceCandidateType||r.iceCandidateTransport)&&(t=t.filter(function(e){var t=!0,n=!0;return r.iceCandidateType&&(t=e.type.match(new RegExp(r.iceCandidateType),"i")),r.iceCandidateTransport&&(n=e.protocol.match(new RegExp(r.iceCandidateTransport,"i"))),t&&n})),r.iceGathererOptions.gatherPolicy===o.default.ICE_TRANSPORT_POLICY.relay&&t.forEach(function(e){e.relatedAddress=e.ip,e.relatedPort=e.port}),t}this.transportId=c++,u=new s(this.transportId,t.createChild("IceT"),n,i,r),p=new function(e,t,n,i){var r=this,a=!1;this.dtlsTransport=new RTCDtlsTransport(n),this.dtlsTransport.ondtlsstatechange=function(){t.safe.info("RTCDtlsTransport.ondtlsstatechange","state:",event.state,"role:",r.dtlsTransport?r.dtlsTransport.getLocalParameters().role:"")},this.dtlsTransport.onerror=function(n){t.safe.error("RTCDtlsTransport.onerror","event:",n),i.onError({type:o.default.MEDIA_ERROR.srtpError,detail:n},e)},this.startAsync=function(e){if(a)throw new Error("dtlstransport already started!");return a=!0,t.info("RTCDtlsTransport.start","params:",JSON.stringify(e)),r.dtlsTransport.start(e),Promise.resolve()},this.dispose=function(){a&&r.dtlsTransport.stop(),r.dtlsTransport=null}}(this.transportId,t.createChild("DtlsT"),u.iceTransport,i),a&&(d=new s(this.transportId,t.createChild("RtcpIceT"),n,i,r,u.iceGatherer,u.iceTransport)),Object.defineProperty(this,"transport",{get:function(){return!e.config.disableSdes&&f?f:p?p.dtlsTransport:null}}),this.isStarted=function(){return g},this.getLocalParamsAsync=function(){return(d?Promise.all([u.getLocalCandidatesAsync(),d.getLocalCandidatesAsync()]):u.getLocalCandidatesAsync()).then(function(){return{transportId:h.transportId,iceParams:u.iceGatherer.getLocalParameters(),iceCandidates:m(u.iceGatherer.getLocalCandidates()),iceCandidatePair:u.nominatedCandidatePair,sdesParamsList:l,dtlsParams:p?p.dtlsTransport.getLocalParameters():null,rtcpIceParams:d?d.iceGatherer.getLocalParameters():null,rtcpIceCandidates:d?m(d.iceGatherer.getLocalCandidates()):null,rtcpIceCandidatePair:d?d.nominatedCandidatePair:null}})},this.startAsync=function(e){if(g)throw new Error("mediaTransport already started!");var n=Promise.resolve();return g=!0,u.start(e.iceCandidates,e.iceParams),d&&(e.doRtcpMux?(d.dispose(),d=null):d.start(e.rtcpIceCandidates,e.rtcpIceParams)),e.enableDtls?n=p.startAsync(e.dtlsParams):f||(t.debug("RTCSrtpSdesTransport","local:",JSON.stringify(e.sdesParamsList[0]),"remote:",JSON.stringify(e.remoteSdesParams)),(f=new RTCSrtpSdesTransport(u.iceTransport,e.sdesParamsList[0],e.remoteSdesParams)).onerror=function(e){t.info("RTCSrtpSdesTransport.onerror","event:",e),i.onError({type:o.default.MEDIA_ERROR.srtpError,detail:e},h.transportId)}),n},this.dispose=function(){t.safe.info("dispose"),u.dispose(),u=null,d&&(d.dispose(),d=null),p&&(p.dispose(),p=null)}}function u(e,t){var n=[],o=!1,a=new i.SettablePromise,s=0;function c(i){var c=this;this.dispose=function(){r.remove(n,function(e){return e===c})},this.gotCallback=!1,this.iceCompleted=function(){this.gotCallback=!0,this.gotCallbackFromControlling="controlling"===i;for(var r=0,c=0,l=0;l<n.length;l++)n[l].gotCallback&&r++,n[l].gotCallbackFromControlling&&c++;c&&c===s&&!o&&(e.safe.info("IceCompletionMonitor REINVITE"),o=!0,t.triggerIceReinvite()),r&&r===n.length&&(e.safe.info("IceCompletionMonitor ALL COMPLETE"),a.resolve())}}this.createCb=function(e){var t=new c(e);return n.push(t),"controlling"===e&&(o=!1,s++),a.reject(void 0),a=new i.SettablePromise,t},this.waitAllCallbacksAsync=function(){return a.promise}}t.default=function(e,t,n,i,r,s){var c,d=this,p=[],f=r||o.default.ICE_TRANSPORT_POLICY.all,h=new u(t,n),g=null;this.relayManagerProvider=null,e.config.disableSdes||(g=RTCSrtpSdesTransport.getLocalParameters().filter(function(e){return"SCALE_AES_CM_128_HMAC_SHA1_80"!==e.cryptoSuite})),this.getTransportById=function(e){return p[a.default.getTransportIndexById(p,e)]},this.assureInitAsync=function(r,o,a){return new Promise(function(u){t.safe.info("assureInitAsync",o),u((a?function(){if(!c){if(!d.relayManagerProvider)throw new Error("relay manager provider is not set!");var e={relayType:"msturn",isRemoteClientLync:i};c=d.relayManagerProvider.getRelayManager().queryRelaysAsync(e)}return c}():Promise.resolve([])).then(function(i){for(var a,c={iceRole:r,iceCandidateType:e.config.iceCandidateType,iceCandidateTransport:e.config.iceCandidateTransport,iceGathererOptions:{gatherPolicy:f,iceServers:function(e){return e.reduce(function(e,t){var n=t.fqdns;return n&&0!==n.length||(n=t.addresses||[]),n.map(function(n){e.push({urls:t.type+":"+n+":"+t.udpPort+"?transport=udp",credential:t.password,username:t.username}),e.push({urls:t.type+":"+n+":"+t.tcpPort+"?transport=tcp",credential:t.password,username:t.username})}),e},[])}(i),portRange:null}},u=p.length;u<o;u++){t.safe.info("assureInitAsync "+u+c.iceRole),e.config.mediaPortRanges&&(c.iceGathererOptions.portRange=(a=e.config.mediaPortRanges,0===u?{min:a.audioMin,max:a.audioMax}:{min:a.videoMin,max:a.videoMax}));var d={onError:n.onError,onConnected:n.onConnected},m=new l(e,t.createChild("MT"+u),h,d,c,s,g);p.push(m)}}))})},this.getLocalParamsAsync=function(){return t.safe.info("getLocalParamsAsync"),new Promise(function(e){var t=p.map(function(e){return e.getLocalParamsAsync()});e(Promise.all(t))})},this.hasIceCandidates=function(e){return e.some(function(e){return!!e.iceCandidates&&e.iceCandidates.length>0})},this.hasRelayIceCandidates=function(e){return this.hasIceCandidates(e)&&e.some(function(e){return!!e.iceCandidates&&e.iceCandidates.some(function(e){return"relay"===e.type})})},this.waitIceCompletionIfNeededAsync=function(e){return new Promise(function(n){var i="";(e[0]&&e[0].iceCandidatePair||e[1]&&e[1].iceCandidatePair)&&(t.safe.info("waiting ICE completed state!"),i=h.waitAllCallbacksAsync()),n(i)})},this.configureTransportAsync=function(e,t){return new Promise(function(n){var i=[],r=e.transportParams;p=p.filter(function(e){return-1!==t.findIndex(function(t){return t===e.transportId})?(e.isStarted()||i.push(e.startAsync(function(e,t){return e.find(function(e){return e.transportId===t})}(r,e.transportId))),!0):(e.dispose(),!1)}),n(Promise.all(i))})},this.stop=function(){p.forEach(function(e){e.dispose()}),p=[]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(49),r=n(103),o=n(18),a=n(12),s=n(0),c=n(2);t.default={build:function(e,t){return new function(e,t){var n=t.createChild("OrtcVideoRendererGroup"),l=[],u=a.default.window,d=[];function p(t,a){i.VideoRendererBase.call(this,t);var p,f,h,g,m=this,v=this.dispose.bind(this),y=!1,S=new o.SettablePromise;this.on("onVideoSizeChanged",function(e,t){e&&t&&E()}),this.updateRecvTrack=function(e,t){if(t!==function(){var e=m.getMediaStream();return e?e.getVideoTracks()[0]:null}()){var i=t?new MediaStream([t]):null;n.safe.info("updating renderer media stream to",i),m.attachMediaStream(i),f!==e&&(f=e,n.safe.info("renderer subscribed msi updated to",e))}};var _=this.attachMediaStream.bind(this);function E(){g&&(n.safe.info("stopping video tag periodic refresh"),u.clearInterval(g),g=null)}function T(){p&&(p.remove(m),p=void 0),f=void 0}function C(e,t){return s.find(l,function(n){return n.rendererType===e&&n.msi===t})}this.attachMediaStream=function(t){return e.config.ortcVideoRendererAggressiveStreamRefresh&&(t?g||(n.safe.info("starting video tag periodic refresh"),g=u.setInterval(function(){m.getVideoElement().play()},1e3)):E()),_(t)},this.subscribeVideoAsync=function(t,i){var a=t||c.default.MSI.subscribeAny,u=i?c.default.RENDERER_TYPE.sharing:c.default.RENDERER_TYPE.video;return n.safe.info("subscribing renderer to type:",u,"msi:",t),new Promise(function(t){if(!y){var i=f!==a;i&&T(),S.isPending&&(S.resolve(),S=new o.SettablePromise),a!==c.default.MSI.unsubscribe&&i?(function(e,t){if(!C(e,t)){var n,i=new o.SettablePromise,r=[],a=!1,u=function(){a||(r=[],i.isPending&&i.reject(new Error("disposing renderer")),n&&n.unsubscribe(),s.remove(l,function(n){return n.rendererType===e&&n.msi===t}),a=!0,l.forEach(function(e){e.update()}))},f=function(){if(i.isPending){var o=function(e){return s.find(d,function(t){return t.canSubscribe()&&t.label===function(e){switch(e){case c.default.MODALITY.video:return c.default.MEDIA_LABEL.video;case c.default.MODALITY.sharing:return c.default.MEDIA_LABEL.sharing}return"unknown"}(e)})}(e);o&&(o.subscribe(t),n=o,i.resolve())}if(n){var a=n.getRecvTrack();r.forEach(function(e){e.updateRecvTrack(t,a)})}};l.push({rendererType:e,msi:t,add:function(e,t){i.promise.then(t.resolve,t.reject),r.push(e),f()},remove:function(e){s.remove(r,function(t){return t===e}),0===r.length&&u()},getChannel:function(){return n},update:f,dispose:u,reset:function(){i=new o.SettablePromise}})}(p=C(e,t)).add(m,S)}(u,a),e.config.ortcVideoCapabilityCheckIntervalMin&&e.config.ortcVideoCapabilityCheckIntervalMax?h||(h=new r.VideoSizeTracker(m.getVideoElement(),e.config.ortcVideoCapabilityCheckIntervalMin,e.config.ortcVideoCapabilityCheckIntervalMax)).changed(function(){n.safe.info("video renderer size changed, updating capabilities"),p.getChannel()&&p.getChannel().videoSizeChanged(h.width,h.height)}):n.safe.info("skipping video size tracking")):S.resolve()}t(S.promise)})},this.dispose=function(){n.safe.debug("disposing remote renderer"),h&&(h.dispose(),h=null),E(),T(),S.isPending&&S.reject(new Error("disposing renderer")),y=!0,v()}}this.create=function(e,t){return new p(e,t)},this.reset=function(){return l.forEach(function(e){return e.reset()})},this.update=function(e){d=e,l.forEach(function(e){return e.update()})},this.terminate=function(){return l.forEach(function(e){return e.dispose()})},p.prototype=Object.create(i.VideoRendererBase.prototype)}(e,t)}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=n(0),a=n(224),s=n(19),c=function(){function e(){this.startTime=0,this.elapsed=0,this._count=0}return e.prototype.start=function(){this.startTime||(this.startTime=Date.now(),this._count++)},e.prototype.stop=function(){this.startTime&&(this.elapsed+=Date.now()-this.startTime,this.startTime=0)},e.prototype.isRunning=function(){return!!this.startTime},e.prototype.getElapsed=function(){return this.startTime?this.elapsed+Date.now()-this.startTime:this.elapsed},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e}(),l=function(){function e(e){void 0===e&&(e="Good"),this.stopWatches=[],this.currentLevel=e,this.getStopWatch(e).start()}return e.prototype.updateLevel=function(e){this.currentLevel!==e&&(this.getStopWatch(this.currentLevel).stop(),this.currentLevel=e,this.getStopWatch(this.currentLevel).start())},e.prototype.getCount=function(e){var t=this.stopWatches[e];return t?t.count:0},e.prototype.getElapsed=function(e){var t=this.stopWatches[e];return t?t.getElapsed():0},e.prototype.getStopWatch=function(e){var t=this.stopWatches[e];return t||(t=new c,this.stopWatches[e]=t),t},e}(),u=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\:[0-9]{2,5})?$/),d=RegExp(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/),p=RegExp(/^\[(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\](\:[0-9]{2,5})$/),f=function(){function e(e,t){this.configProvider=e,this.callNumber=t,this.negotiation={offering:this.offering(),answering:this.answering(),current:this.current()},this.creationTime=Date.now(),this.negotiationCount=0,this.initialNegotiationCompleted=!1,this.multiParty=!1,this.noIceCandidatesGoodEventCount=0,this.noIceCandidatesBadEventCount=0,this.noRelayIceCandidatesGoodEventCount=0,this.noRelayIceCandidatesBadEventCount=0,this.cameraInUseBadEventCount=0,this.cameraInUseGoodEventCount=0,this.microphoneInUseBadEventCount=0,this.microphoneInUseGoodEventCount=0,this.cameraFreezeStartEventCount=0,this.cameraFreezeEndEventCount=0,this.networkRecv=new l,this.networkSend=new l,this.retargetIncomingCount=0,this.retargetOutgoingCount=0,this.retargetCompletedCount=0,this.retargetRejectedCount=0,this.reconnectAttemptedCount=0,this.reconnectConnectedCount=0,this.escalationAttemptedCount=0,this.escalationCompletedCount=0,this.escalationRejectedCount=0,this.screenSharingIncomingDecoderFailureCount=0,this.screenSharingIncomingDecoderActiveCount=0,this.screenSharingIncomingDecoderResetCount=0,this.duration=0,this.terminationReason={},this.terminationTime=0,this.sessionId="0",this.rejectedNegotiationCount=0,this.mediaError={type:"none",detail:"none"},this.incompatibleOffer=!1,this.dtmfSuccess=0,this.dtmfFailure=0,this.relay=null,this.relayManagerTimers=null,this.allowedAudioSend=!0,this.allowedVideoSend=!0,this.allowedScreensharingSend=!0,this.iceInitTime=0,this.finalAnswerTime=0,this.iceConnectedStateTime=0,this.usedDevices=null,this.deviceSelectionChangeCount=0,this.devicesChangeCount=0,this.devicesPollChangeCount=0,this.mute=new c,this.osMute=new c,this.hwSilent=new c,this.isSpeaking=new c,this.swMute=new c,this.speakerMute=new c,this.deviceTelemetryEvents=[],this.devicesCount=null,this.reconnectStats=new a.default(this.creationTime),this.transportDisconnected=!1,this.transportReconnectedCount=0,this.ufds=[],this.mediaQosEnabled=!1,this.portRangeConfigured=!1,this.rollbackNegotiation=[]}return e.prototype.terminated=function(e){this.terminationReason=o.deepClone(e),this.terminationTime=Date.now(),this.duration=this.terminationTime-this.creationTime,this.osMute.stop(),this.swMute.stop(),this.hwSilent.stop(),this.isSpeaking.stop(),this.mute.stop(),this.speakerMute.stop()},e.prototype.setMultiParty=function(){this.multiParty=!0},e.prototype.updateCommonMute=function(){this.swMute.isRunning()||this.osMute.isRunning()?this.mute.start():this.swMute.isRunning()||this.osMute.isRunning()||this.mute.stop()},e.prototype.setDeviceList=function(e,t){var n=this;this.deviceList=e.map(function(e){return{label:o.scrubDeviceLabelPii(e.label,n.configProvider.config.devices.piiSafeWords),kind:e.kind}}),t&&(this.deviceDebugStrings=o.deepClone(t))},e.prototype.setPermissionStates=function(e){this.permissionStates=e},e.prototype.setSwMute=function(e){e?this.swMute.start():this.swMute.stop(),this.updateCommonMute()},e.prototype.setSpeakerMute=function(e){e?this.speakerMute.start():this.speakerMute.stop()},e.prototype.setHwSilent=function(e){e?this.hwSilent.start():this.hwSilent.stop()},e.prototype.setSpeakingState=function(e){e?this.isSpeaking.start():this.isSpeaking.stop()},e.prototype.setETag=function(e){this.ETag=e},e.prototype.setConfigIds=function(e){this.configIds=e},e.prototype.registerQualityStateChangedEvent=function(e){switch(e.type){case"NoNetwork":"Good"===e.value?this.noIceCandidatesGoodEventCount++:this.noIceCandidatesBadEventCount++;break;case"NetworkRelaysNotReachable":"Good"===e.value?this.noRelayIceCandidatesGoodEventCount++:this.noRelayIceCandidatesBadEventCount++;break;case"DeviceCaptureNotFunctioning":"Good"===e.value?this.microphoneInUseGoodEventCount++:this.microphoneInUseBadEventCount++;break;case"VideoCapturerDeviceStartFailed":"Good"===e.value?this.cameraInUseGoodEventCount++:this.cameraInUseBadEventCount++;break;case"DeviceCaptureMute":"Bad"===e.value?this.osMute.start():this.osMute.stop(),this.updateCommonMute();break;case"NetworkRecvQuality":this.networkRecv.updateLevel(e.value);break;case"NetworkSendQuality":this.networkSend.updateLevel(e.value);break;case"VideoCaptureDeviceFreeze":"Good"===e.value?this.cameraFreezeEndEventCount++:this.cameraFreezeStartEventCount++}"DeviceSpeakWhileMuted"!==e.type&&this.ufds.push(i({},e,{timestamp:Date.now()-this.creationTime})),this.ufds.length>this.configProvider.config.maxStoredUFDCount&&this.ufds.shift()},e.prototype.registerRetargetIncoming=function(){this.retargetIncomingCount++},e.prototype.registerRetargetOutgoing=function(){this.retargetOutgoingCount++},e.prototype.registerRetargetCompleted=function(){this.retargetCompletedCount++},e.prototype.registerRetargetRejected=function(){this.retargetRejectedCount++},e.prototype.registerEscalationStart=function(){this.escalationAttemptedCount++},e.prototype.registerEscalationCompleted=function(){this.escalationCompletedCount++},e.prototype.registerEscalationRejected=function(){this.escalationRejectedCount++},e.prototype.registerRollbackEvent=function(e){e&&this.rollbackNegotiation.push({type:e.type,attempt:this.rollbackNegotiation.length+1,error:e.error?e.error:""})},e.prototype.registerReconnectAttempted=function(){this.reconnectAttemptedCount++,this.reconnectStats.onReconnectStart()},e.prototype.registerReconnectConnected=function(){this.reconnectConnectedCount++,this.reconnectStats.onReconnectConnected()},e.prototype.registerSSIncomingDecoderFailed=function(){this.screenSharingIncomingDecoderFailureCount++},e.prototype.registerSSIncomingDecoderActive=function(){this.screenSharingIncomingDecoderActiveCount++},e.prototype.registerSSIncomingDecoderReset=function(){this.screenSharingIncomingDecoderResetCount++},e.prototype.registerDeviceTelemetryEvent=function(e){e.timestamp=e.timestamp-this.creationTime,this.deviceTelemetryEvents.push(e)},e.prototype.registerReconnectAttempt=function(e){this.reconnectStats.onReconnectAttempt(e)},e.prototype.registerReconnectAttemptCompleted=function(){this.reconnectStats.onReconnectCompleted()},e.prototype.registerReconnectAttemptRejected=function(){this.reconnectStats.onReconnectRejected()},e.prototype.setMediaLegId=function(e){this.mediaLegId=e},e.prototype.setId=function(e){this.sessionId=e},e.prototype.setError=function(e){e.type===s.Constants.MEDIA_ERROR.incompatibleOffer&&(this.incompatibleOffer=!0),this.mediaError.type=e.type||s.Constants.MEDIA_ERROR.internalError,this.mediaError.detail=e.detail||e.toString()},e.prototype.setRelay=function(e){this.relay={address:e.addresses.join(),expires:e.expires,realm:e.realm,credentials:!(!e.username||!e.password),ports:[e.udpPort?"udp:"+e.udpPort:"",e.tcpPort?"tcp:"+e.tcpPort:"",e.tlsPort?"tls:"+e.tlsPort:""].join(","),fqdns:e.fqdns?e.fqdns.join():"none"}},e.prototype.setRelayManagerTimers=function(e){this.relayManagerTimers=e},e.prototype.setSendModalities=function(e){this.allowedAudioSend=e.audio.some(function(e){return r.hasSendDirectionality(e)}),this.allowedVideoSend=e.video.some(function(e){return r.hasSendDirectionality(e)}),this.allowedScreensharingSend=e.sharing.some(function(e){return r.hasSendDirectionality(e)})},e.prototype.setIceInitTimestamp=function(e){this.iceInitTime||(this.iceInitTime=e)},e.prototype.setFinalAnswerTimestamp=function(e){this.finalAnswerTime||(this.finalAnswerTime=e)},e.prototype.setIceConnectedStateTimestamp=function(e){this.iceConnectedStateTime||(this.iceConnectedStateTime=e)},e.prototype.dtmfResult=function(e){e?++this.dtmfSuccess:++this.dtmfFailure},e.prototype.setUsedDevices=function(e){this.usedDevices&&!o.weakCompareObject(e,this.usedDevices)&&this.deviceSelectionChangeCount++,this.usedDevices=e},e.prototype.setDevicesCount=function(e){this.devicesCount=e},e.prototype.setMediaQosEnabled=function(e){this.mediaQosEnabled=e},e.prototype.setPortRangeConfigured=function(e){this.portRangeConfigured=e},e.prototype.devicesChanged=function(){this.devicesChangeCount++},e.prototype.deviceChangedByPoll=function(){this.devicesPollChangeCount++},e.prototype.getReport=function(){var e=this.usedDevices||{microphone:"none",speaker:"none",camera:"none"};return{SessionId:this.sessionId,CallNumber:this.callNumber,NoIceCandidatesBadEventCount:this.noIceCandidatesBadEventCount,NoIceCandidatesGoodEventCount:this.noIceCandidatesGoodEventCount,NoRelayIceCandidatesBadEventCount:this.noRelayIceCandidatesBadEventCount,NoRelayIceCandidatesGoodEventCount:this.noRelayIceCandidatesGoodEventCount,CameraInUseBadEventCount:this.cameraInUseBadEventCount,CameraInUseGoodEventCount:this.cameraInUseGoodEventCount,MicrophoneInUseBadEventCount:this.microphoneInUseBadEventCount,MicrophoneInUseGoodEventCount:this.microphoneInUseGoodEventCount,CameraFreezeStartEventCount:this.cameraFreezeStartEventCount,CameraFreezeEndEventCount:this.cameraFreezeEndEventCount,RetargetIncomingCount:this.retargetIncomingCount,RetargetOutgoingCount:this.retargetOutgoingCount,RetargetCompletedCount:this.retargetCompletedCount,RetargetRejectedCount:this.retargetRejectedCount,ReconnectAttemptedCount:this.reconnectAttemptedCount,ReconnectConnectedCount:this.reconnectConnectedCount,EscalationAttemptedCount:this.escalationAttemptedCount,EscalationCompletedCount:this.escalationCompletedCount,EscalationRejectedCount:this.escalationRejectedCount,ScreenSharingIncomingDecoderFailureCount:this.screenSharingIncomingDecoderFailureCount,ScreenSharingIncomingDecoderFailureRecoverDelta:this.screenSharingIncomingDecoderFailureCount-this.screenSharingIncomingDecoderActiveCount,ScreenSharingIncomingDecoderResetCount:this.screenSharingIncomingDecoderResetCount,CreationTime:this.getHpTimeFromMillis(this.creationTime),InitTime:this.getHpTimeFromMillis(this.creationTime),TerminationTime:this.getHpTimeFromMillis(this.terminationTime),CallDuration:this.getHpTimeFromMillis(this.getCurrentDuration()),InitialNegotiationType:this.initialNegotiationType||"none",InitialNegotiationCompleted:this.initialNegotiationCompleted,NegotiationCount:this.negotiationCount,RejectedNegotiationCount:this.rejectedNegotiationCount,MediaLegId:this.mediaLegId,MultiParty:this.multiParty,ErrorType:this.mediaError.type,ErrorDetail:this.mediaError.detail,TerminationReason:this.terminationReason,IncompatibleOffer:this.incompatibleOffer,DtmfSuccess:this.dtmfSuccess,DtmfFailure:this.dtmfFailure,Relay:this.relay?JSON.stringify(this.relay):"none",RelayManager:this.relayManagerTimers?JSON.stringify(this.relayManagerTimers):"none",AllowedAudioSend:this.allowedAudioSend,AllowedVideoSend:this.allowedVideoSend,AllowedScreensharingSend:this.allowedScreensharingSend,IceInitTime:this.getHpTimeFromMillis(this.iceInitTime),FinalAnswerTime:this.getHpTimeFromMillis(this.finalAnswerTime),IceConnectedStateTime:this.getHpTimeFromMillis(this.iceConnectedStateTime),UsedMicrophone:e.microphone,UsedSpeaker:e.speaker,UsedCamera:e.camera,DeviceSelectionChangeCount:this.deviceSelectionChangeCount,DevicesChangeCount:this.devicesChangeCount,DevicesPollChangeCount:this.devicesPollChangeCount,DevicesCount:this.devicesCount?JSON.stringify(this.devicesCount):"none",ETag:this.ETag||"",ConfigIds:this.configIds?Array.isArray(this.configIds)?this.configIds.join(","):this.configIds:"",CallMutedRatio:this.getDurationRatio(this.mute.getElapsed()),CallOsMuted:this.getHpTimeFromMillis(this.osMute.getElapsed()),CallHwSilent:this.getHpTimeFromMillis(this.hwSilent.getElapsed()),CallSwMuted:this.getHpTimeFromMillis(this.swMute.getElapsed()),CallSpeakerMuted:this.getHpTimeFromMillis(this.speakerMute.getElapsed()),CallIsSpeaking:this.getHpTimeFromMillis(this.isSpeaking.getElapsed()),NetworkRecvGood:this.networkRecv.getCount("Good")-1,NetworkRecvPoor:this.networkRecv.getCount("Poor"),NetworkRecvBad:this.networkRecv.getCount("Bad"),NetworkSendGood:this.networkSend.getCount("Good")-1,NetworkSendPoor:this.networkSend.getCount("Poor"),NetworkSendBad:this.networkSend.getCount("Bad"),NetworkRecvGoodRatio:this.getDurationRatio(this.networkRecv.getElapsed("Good")),NetworkRecvPoorRatio:this.getDurationRatio(this.networkRecv.getElapsed("Poor")),NetworkRecvBadRatio:this.getDurationRatio(this.networkRecv.getElapsed("Bad")),NetworkSendGoodRatio:this.getDurationRatio(this.networkSend.getElapsed("Good")),NetworkSendPoorRatio:this.getDurationRatio(this.networkSend.getElapsed("Poor")),NetworkSendBadRatio:this.getDurationRatio(this.networkSend.getElapsed("Bad")),DeviceEvents:JSON.stringify(this.deviceTelemetryEvents),DeviceList:JSON.stringify(this.deviceList),DeviceListDebug:JSON.stringify(this.deviceDebugStrings),PermissionStates:JSON.stringify(this.permissionStates),ReconnectAttempts:this.reconnectStats.getReport(),ReconnectInProgress:this.reconnectStats.isReconnecting(),TransportReconnectedCount:this.transportReconnectedCount,UFDs:JSON.stringify(this.ufds),MediaQosEnabled:this.mediaQosEnabled,PortRangeConfigured:this.portRangeConfigured,RollbackNegotiation:JSON.stringify(this.rollbackNegotiation)}},e.prototype.generateStatistics=function(e,t){var n=this;if(this.setMediaLegId(t.process()),"OrtcMediaStats"!==e.type&&"WebRtcMediaStats"!==e.type)throw new Error("Unknown stats type - "+e.type);return e.data.metrics=this.getReport(),o.forOwnRec(e.data,function(e,t,i){i[t]=n.addPiiToStatsValue(e)}),e},e.prototype.registerTransportConnected=function(){this.transportDisconnected&&(this.transportDisconnected=!1,this.transportReconnectedCount++)},e.prototype.registerTransportDisconnected=function(){this.transportDisconnected=!0},e.prototype.registerTransportFailed=function(){this.transportDisconnected=!1},e.prototype.resetError=function(){this.setError({type:"none",detail:"none"})},e.prototype.addPiiToStatsValue=function(e){var t=0;return u.test(e)?t=13:(d.test(e)||p.test(e))&&(t=4),{type:t,value:e,__VALUE__:!0}},e.prototype.offering=function(){var e=this;return{started:function(){e.currentNegotiationType="Offering",e.negotiationStarted()}}},e.prototype.answering=function(){var e=this;return{started:function(){e.currentNegotiationType="Answering",e.negotiationStarted()}}},e.prototype.negotiationStarted=function(){this.initialNegotiationType=this.initialNegotiationType||this.currentNegotiationType,++this.negotiationCount},e.prototype.current=function(){var e=this;return{completed:function(){e.initialNegotiationCompleted=!0,e.resetError()},rejected:function(){++e.rejectedNegotiationCount}}},e.prototype.getDurationRatio=function(e){var t=this.getCurrentDuration();return e/(0!==t?t:1)},e.prototype.getCurrentDuration=function(){return this.duration>0?this.duration:Date.now()-this.creationTime},e.prototype.getHpTimeFromMillis=function(e){return 1e4*e},e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.creationTime=e,this.records=[],this.activeRecord=null,this.activeAttempt=null,this.reconnectState=!1}return e.prototype.getReport=function(){return this.records.length?JSON.stringify(this.records):""},e.prototype.isReconnecting=function(){return this.reconnectState},e.prototype.onReconnectStart=function(){this.reconnectState=!0,this.activeRecord||(this.activeRecord={attempts:[],endTime:null,startTime:Date.now()-this.creationTime},this.records.push(this.activeRecord))},e.prototype.onReconnectAttempt=function(e){if(!this.activeRecord)return null;this.activeAttempt={direction:e,status:!1,endTime:null,startTime:this.getTimestamp()},this.reconnectState=!0,this.activeRecord.attempts.push(this.activeAttempt)},e.prototype.onReconnectConnected=function(){if(!this.activeRecord)return null;this.reconnectState=!1,this.activeRecord.endTime=this.getTimestamp(),this.activeRecord=this.activeAttempt=null},e.prototype.onReconnectCompleted=function(){this.reconnectState=!1,this.resolveReconnectAttempt(!0)},e.prototype.onReconnectRejected=function(){this.resolveReconnectAttempt(!1)},e.prototype.resolveReconnectAttempt=function(e){this.activeAttempt&&this.activeRecord&&(this.activeAttempt.status=e,this.activeAttempt.endTime=this.getTimestamp())},e.prototype.getTimestamp=function(){return Date.now()-this.creationTime-this.activeRecord.startTime},e}();t.default=i},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(11),c=n(36),l=n(53),u=n(21),d=n(54),p=n(104),f=n(22),h=n(18),g=n(56),m=n(38),v=n(105),y=n(106),S=n(0),_=n(2),E=n(58),T=n(57),C=n(9),I=n(107),A=n(109),b=n(110),R=n(112),O=n(113),P=n(114),N=n(115),M=n(116),w=n(118),D=n(119),L=n(120),k=n(121),x=n(122),F=n(123),U=0,j=function(){function e(e,t,n){var i,r=this;this.context=e,this.callId=t,this.callback=n,this.callbacks={},this.configProvider=this.context.configProvider,this.logger=this.context.getLogger().createChild("webrtc-"+ ++U),this.deviceManager=this.context.getDeviceManager(),this.webrtcAdapter=I.default.build({global:this.context.maContext,configProvider:this.configProvider}),this.multiParty=this.context.config&&this.context.config.isConference,this.iceHostCandidateOnly=this.multiParty&&S.getFrom("iceHostCandidateOnly",this.context.config,this.configProvider.config),this.mediaManager=new b.default({logger:this.logger,configProvider:this.configProvider,numVideoChannels:this.multiParty&&this.configProvider.config.numVideoChannelsGvc||1,unifiedPlanEnabled:!1}),this.resolutionTable=new f.default(this.configProvider),this.sessionDescription=x.SessionDescriptionFactory.build({sdpTransform:new this.webrtcAdapter.SdpTransform(this.context),mediaManager:this.mediaManager,logger:this.logger,configProvider:this.configProvider,configuration:this.getStreamTransformConfiguration()}),this.allowedMediaContentType=S.getFrom("webrtcAllowedMediaContentType",this.context.config,this.configProvider.config).concat(),this.receiveStreamCollection=new v.default({streamAdded:function(e){return r.streamAdded(e)},streamRemoved:function(e){return r.streamRemoved(e)}}),this.stats=new M.StatisticsGatherer(this.logger,this.configProvider,this.mediaManager),this.scalingEnabled=this.multiParty?this.configProvider.config.webrtcMultiPartyVideoScaling:this.configProvider.config.webrtcVideoScaling,this.maxResolution=this.multiParty?this.resolutionTable.getResolution(this.configProvider.config.webrtcMultipartyMaxScalingFs):this.resolutionTable.getResolution(this.configProvider.config.webrtcMaxScalingFs),this.qualityManager=new O.default(this.logger.createChild("qm"),{videoReceiversCount:this.configProvider.config.webrtcVideoReceiversCount,bandwidthPerVideoReceiver:this.configProvider.config.webrtcBandwidthPerVideoReceiver,nonEstimatedDefaultVideoReceiversCount:this.configProvider.config.nonEstimatedDefaultVideoReceiversCount,slidingWindowSamples:this.configProvider.config.webrtcQualitySlidingWindowSamples,slidingWindowPercentile:this.configProvider.config.webrtcQualitySlidingWindowPercentile,scalingEnabled:this.scalingEnabled,cooldownTimeout:this.configProvider.config.webrtcResolutionManagerCooldownTimeout,retryDelay:this.configProvider.config.webrtcResolutionManagerRetryDelay,maxResolution:this.maxResolution,customBwEstimationEnabled:!0,sendBandwidthNotificationsEnabled:this.multiParty&&this.configProvider.config.webrtcSendBandwidthNotificationsEnabled},{onOptimalVideoReceiversCountChanged:function(e){return r.onOptimalVideoReceiversCountChanged(e)},onReceiveCapabilitiesChanged:function(e,t,n){return r.applyCapabilitiesForModality(e,t,n)},onSendBandwidthChanged:function(e){return r.onSendBandwidthChanged(e)}},this.stats,this.configProvider),this.videoStreamWatcher=new D.VideoStreamWatcher({statsGatherer:this.stats,configProvider:this.configProvider,logger:this.logger},{onStreamIncomingDecoderFailed:function(){r.logger.safe.warn("ScreenSharing stream decoding failed"),r.resetScreenSharingStream(),r.callbacks.onScreenSharingIncomingDecoderFailed&&r.callbacks.onScreenSharingIncomingDecoderFailed()},onStreamIncomingDecoderActive:function(){r.callbacks.onScreenSharingIncomingDecoderActive&&r.callbacks.onScreenSharingIncomingDecoderActive()},onStreamIncomingDecoderReset:function(){r.callbacks.onScreenSharingIncomingDecoderReset&&r.callbacks.onScreenSharingIncomingDecoderReset()}}),this.localVideoStreamWatcher=new w.LocalVideoStreamWatcher(this.stats,this.logger,this.configProvider),this.activeSpeakerManager=new l.ActiveSpeakerManager(this.callback.onContributingSourcesChanged,this.callback.onDominantSpeakerChanged),this.contributingSources=new A.ContributingSourcesHandler({activeSpeakerManager:this.activeSpeakerManager,logger:this.logger,configProvider:this.configProvider,provider:function(){if(!r.peerConnection)return[];if(r.peerConnection.getReceivers&&r.multiParty){var e=r.peerConnection.getReceivers().filter(function(e){return"audio"===e.track.kind})[0];if(!e)return[];if(e.getContributingSources)return e.getContributingSources()}}}),this.passiveModalities=this.context.config.passiveModalities,this.senders={},this.negotiationQueue=new u.PromiseQueue(this.logger),this.negotiationEmulator=new R.default(this.logger.createChild("negotiationEmulator"),this.webrtcAdapter,this.sessionDescription,this.negotiationQueue,this.mediaManager),this.extensionsManager=this.setupExtensionsManager(),this.toBeCalledAfterConnected=[],this.iceTransportPolicy=this.configProvider.config.iceTransportPolicyForced||this.context.config.iceTransportPolicy||_.default.ICE_TRANSPORT_POLICY.all,this.peerConnection=null,this.mediaStreams=new Map,this.doAudioMute=this.context.config.muted,this.iceCandidatesDeferred=new h.SettablePromise,this.iceCandidatesTimer=null,this.triggerRenegotiationFlag=!1,this.canTriggerRenegotiation=!0,this.noIceCandidates=!1,this.noRelayIceCandidates=!1,this.forceMediaStreamUpdate=!1,this.negotiatedModalities={},this.iceDisconnectedTimer=null,this.statisticsReport=Promise.resolve({}),this.terminated=!1,this.initiator=!1,this.streamsChangedListener=null,this.dtmfSender=k.default.build({logger:this.logger,configProvider:this.configProvider}),this.mediaContentType=S.getFrom("webrtcMediaContentType",this.context.config,this.configProvider.config),this.streamsChangedNotificationScheduled=!1,this.subscriptionManager=new y.SubscriptionManager({logger:this.logger,configProvider:this.configProvider},{getStreams:function(){return r.getStreams()},onStreamsChanged:function(e){return r.onStreamsChanged(e)}}),this.remoteVideoResolutionManager=new P.RemoteVideoResolutionManager(this.logger.createChild("rvrm"),this.multiParty,this.resolutionTable,this.configProvider,this.mediaManager),this.remoteVideoManager=new N.RemoteVideoManager(this.logger.createChild("RemoteVideoManager"),this.configProvider,this.stats,this.remoteVideoResolutionManager,this.context.maContext.domOverrides),this.hwSilent=!1,this.configuredModalitiesPromise=Promise.resolve(),this.negotiationCompletedPromise=new h.SettablePromise,this.ssrcGenerator=new g.default,this.ssrcs=((i={}).Audio=this.getSsrcRangeForMediaType("Audio"),i.Video=this.getSsrcRangeForMediaType("Video"),i.ScreenShare=this.getSsrcRangeForMediaType("ScreenShare"),i),this.forceKeyFramePromise=null,this.ufdManager=e.getUfdManager(),this.stats.on("onStatisticsChanged",function(e){r.updateQualityLevels(e)}),this.negotiationCompletedPromise.promise.catch(function(){}),this.negotiationCompletedPromise.reject("placeholder"),this.remoteVideoResolutionManager.on("onNegotiationRequired",function(){return r.triggerRenegotiation(!0)}),this.remoteVideoResolutionManager.on("onSourceRequestRequired",function(e,t,n,i){return r.requestSource(e,t,n,i)}),this.setSubsForSubscriptionManager(),this.localVideoStreamWatcher.on("onVideoCaptureFreeze",function(e){r.isConnected()&&r.ufdManager.signalEvent("VideoCaptureDeviceFreeze",e?"Bad":"Good","Video")}),this.configProvider.mediaConfig.maxBandwidthInKbps&&this.stats.setMaxSessionBandwidth(this.configProvider.mediaConfig.maxBandwidthInKbps),this.createAudioRenderer()}return Object.defineProperty(e.prototype,"audioStream",{get:function(){return this.mediaStreams.get("Audio")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoStream",{get:function(){return this.mediaStreams.get("Video")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayStream",{get:function(){return this.mediaStreams.get("ScreenShare")},enumerable:!0,configurable:!0}),e.prototype.getAcceptedTypes=function(){return this.allowedMediaContentType},e.prototype.clone=function(t){void 0===t&&(t=!1);var n=S.shallowClone(this.context);n.config=S.shallowClone(this.context.config),n.config.webrtcMediaContentType=this.mediaContentType,n.config.webrtcAllowedMediaContentType=this.allowedMediaContentType,t?n.config.isConference=!0:(n.config.iceHostCandidateOnly=!1,this.configProvider.config.waitForRelayOnReconnect&&(n.config.webrtcIceGatheringTimeoutIncreased=!0));var i=new e(n,this.callId,this.callback);return this.relayManagerProvider&&(i.relayManagerProvider=this.relayManagerProvider),i.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,i},e.prototype.setInternals=function(e){var t=this;if(e.extensionsManager&&this.extensionsManager){var n=e.extensionsManager.getExtension(_.default.EXTENSION_TYPE.videoStreamControl);n&&n.getOptions()&&this.extensionsManager.configureExtension(_.default.EXTENSION_TYPE.videoStreamControl,n.getOptions())}e.subscriptionManager&&(this.subscriptionManager&&this.subscriptionManager.dispose(),this.subscriptionManager=e.subscriptionManager,this.subscriptionManager.setStreamProvider({getStreams:function(){return t.getStreams()},onStreamsChanged:function(e){return t.onStreamsChanged(e)}}),this.setSubsForSubscriptionManager(),this.notifyStreamsChanged()),e.audioRenderer&&(e.audioRenderer.play(this.audioRenderer.getStream()),this.audioRenderer=e.audioRenderer),e.remoteVideoManager&&e.remoteVideoManager.renderers.forEach(function(e){return t.remoteVideoManager.addRemoteRenderer(e)})},e.prototype.setSubsForSubscriptionManager=function(){var e=this;this.subscriptionManager.on("onTrackIdsChanged",function(t){return e.stats.setSubscribedTrackIds(t)}),this.subscriptionManager.on("onTrackSsrcChanged",function(t){return e.stats.setSubscribedTrackSsrc(t)}),this.subscriptionManager.on("onSubscriptionChanged",function(t,n,i){return e.stats.addSubscriptionEvent(t,n,i)})},e.prototype.move=function(e,t){e.setInternals({subscriptionManager:this.subscriptionManager,extensionsManager:this.extensionsManager,audioRenderer:this.audioRenderer,remoteVideoManager:this.remoteVideoManager}),this.doAudioMute?e.muteInputAsync(t):e.unmuteInputAsync(t),this.subscriptionManager=null,this.audioRenderer=null,this.callbacks.onTerminated=null},e.prototype.setMuteAsync=function(e,t,n){return this.logger.safe.info("["+n+"] call setMuteAsync with mute state "+t+", audio stream exists: "+!!this.audioStream),"Audio"===e&&this.audioStream?this.audioStream.setMuted(t,n):"Video"===e&&this.videoStream?this.videoStream.setMuted(t,n):"ScreenShare"===e&&this.displayStream&&this.displayStream.setMuted(t,n),this.updateQualityLevels(this.stats.getLastStatistics()),Promise.resolve()},e.prototype.configureModalitiesAsync=function(e,t){var n=this,i=this.configuredModalitiesPromise.then(function(){if(!e||!e.audio&&!e.video&&!e.sharing)throw new Error("Invalid parameters! "+JSON.stringify(e));var i=!n.configuredModalities||!C.areNegotiatedDirectionsFulfilled(e,n.negotiatedModalities);return n.configuredModalities=e,n.logger.safe.info("["+t+"] configure modalities","audio: "+e.audio,"video: "+e.video,"sharing: "+e.sharing,"peerconnection: "+!!n.peerConnection,"pc.signalingState: "+(n.peerConnection?n.peerConnection.signalingState:"-"),"needNewRenegotiation: "+i),i&&n.triggerRenegotiation(!1,t),n.configuredModalities});return this.configuredModalitiesPromise=i.catch(function(e){n.logger.safe.warn("["+t+"] Error during configuring modalities: "+S.stringifyObject(e))}).then(function(){}),i.then(function(){})},e.prototype.getConfiguredModalities=function(){return this.configuredModalities},e.prototype.createAudioElement=function(e){},e.prototype.createOfferAsync=function(e){var t=this,n=this.negotiationQueue.add(function(){return new Promise(function(n){t.logger.safe.info("["+e+"] create [offer] configured: "+JSON.stringify(t.configuredModalities)),t.initiator=!0,t.throwIfModalitiesNotConfigured("no configured modalities to create offer for"),t.canTriggerRenegotiation=!1,t.negotiatingModalities=C.excludePassiveModalities(t.configuredModalities,t.passiveModalities,t.offeredModalities),t.offeredModalities=t.negotiatingModalities,t.configProvider.config.webrtcNegotiateDisabledDataModality&&!t.offeredModalities[_.default.MODALITY.data]&&t.multiParty&&(t.offeredModalities[_.default.MODALITY.data]=_.default.MEDIA_STATE.inactive),C.isOnHold(t.offeredModalities)&&!S.isEmpty(t.negotiatedModalities)&&Object.keys(t.offeredModalities).forEach(function(e){void 0===t.negotiatedModalities[e]&&delete t.offeredModalities[e]}),n(t.updatePeerConnectionStreamsAsync(t.offeredModalities,!0,!0,e).then(function(){var n=t.createNegotiationConstraints(t.offeredModalities);return t.logger.safe.info("["+e+"] create [offer] offered: "+JSON.stringify(t.offeredModalities)+" constraints: "+JSON.stringify(n)),t.peerConnection.createOffer(n)}).then(function(n){t.logger.unsafe.debug("["+e+"] create [offer] offer from peer connection","sdp:",n.sdp);var i=t.sessionDescription.createLocalOffer(n.sdp);t.hasIceCandidates(i)||t.resetCandidateGathering(e),t.stats.startWaitingForStreamStart(t.offeredModalities);var r=new t.webrtcAdapter.RTCSessionDescription({sdp:i.toLocal(),type:"offer"});return t.setupIceGatheringTimeout(e),Promise.all([t.peerConnection.setLocalDescription(r),t.iceCandidatesDeferred.promise])}).then(function(){var n=t.sessionDescription.createLocalOffer(t.peerConnection.localDescription.sdp);n.updateModalities(t.offeredModalities),t.checkIceCandidates(n);var i=n.toOffer();t.logger.unsafe.debug("CREATE OFFER","sdp:",i);var r={blob:i,contentType:t.mediaContentType};return""===t.configProvider.config.webrtcRequiredFeatures||t.multiParty||(r.requiredFeatures=t.configProvider.config.webrtcRequiredFeatures),t.doRetargetIfNeeded(r,n,e),r}))})});return this.resetNegotiationQueue(),n},e.prototype.processOfferAsync=function(e,t){var n=this,i=this.negotiationQueue.add(function(){return new Promise(function(i){var r=e.blob;if(n.logger.unsafe.debug("["+t+"] process [offer]","sdp:",r),S.throwIfNotSupported(e.contentType,n.allowedMediaContentType),n.mediaContentType=e.contentType,e.requiredFeatures){var o=n.configProvider.config.webrtcRejectedFeatures.split(","),a=e.requiredFeatures.split(",");S.throwIfFeatureNotSupported(a,o)}n.initiator=!1,n.offeredDescription=n.sessionDescription.createRemoteOffer(r),n.canTriggerRenegotiation=!1,n.offeredModalities=C.invertModalities(n.offeredDescription.getModalities()),n.peerConnection||(n.context.configProvider.mediaConfig.isTransportUnbundled?n.context.configProvider.mediaConfig.isTransportUnbundled=n.offeredDescription.couldBeUnbundled():n.context.configProvider.mediaConfig.isTransportUnbundled=n.offeredDescription.isUnbundled());var s=Promise.resolve(n.offeredModalities);if(C.hasSendDirectionality(n.offeredModalities.video)||C.hasReceiveDirectionality(n.offeredModalities.video)||C.hasSendDirectionality(n.offeredModalities.sharing)||C.hasReceiveDirectionality(n.offeredModalities.sharing)){var c=n.offeredDescription.getVideoCodecs();s=n.webrtcAdapter.RTCRtpReceiver.getCapabilities("video").then(function(e){if(!e.codecs.some(function(e){return c.some(function(t){return e.mimeType===t})})){n.logger.safe.warn("["+t+"] offer doesn't contain any supported video codecs");var i=S.shallowClone(n.offeredModalities);return i.video=void 0,i.sharing=void 0,i}return n.offeredModalities}).catch(function(e){return n.logger.safe.error("["+t+"] failed to get video capability "+S.stringifyObject(e)),n.offeredModalities})}i(s.then(function(e){return n.logger.safe.info("["+t+"] process [offer] offered: "+JSON.stringify(n.offeredModalities)+" acceptable: "+JSON.stringify(e)),e}))})});return this.resetNegotiationQueue(),i},e.prototype.createAnswerAsync=function(e,t){var n=this;return new Promise(function(i){if(e)i({blob:"",contentType:n.mediaContentType});else{n.logger.safe.info("["+t+"] create [answer] offered: "+JSON.stringify(n.offeredModalities)+" configured: "+JSON.stringify(n.configuredModalities)),n.throwIfModalitiesNotConfigured("no configured modalities to create answer for"),n.negotiatingModalities=C.excludePassiveModalities(n.configuredModalities,n.passiveModalities,n.offeredModalities);var r=C.negotiateModalities(n.offeredModalities,n.negotiatingModalities),o=n.offeredDescription.clone();i(n.updatePeerConnectionStreamsAsync(r,!0,!1,t).then(function(){return n.handleCodecSwitchUnsupported(t)}).then(function(){var e=n.offeredDescription.toRemote(r);n.mediaManager.updateMediaEntitiesWithLocalTracks(),n.registerMediaSources();var i=new n.webrtcAdapter.RTCSessionDescription({sdp:e,type:"offer"});return n.updateDescriptor(i,o),n.logger.unsafe.info("["+t+"] create [answer] set remote description","negotiated:",r,"sdp:",i.sdp),n.peerConnection.setRemoteDescription(i)}).then(function(){return n.callbacks.onTransportInitialized&&n.callbacks.onTransportInitialized(),n.updatePeerConnectionStreamsAsync(r,!1,!0,t)}).then(function(){return n.handleSharingRecvCapabilities(o),n.handleVideoRecvCapabilities(o)}).then(function(){return n.peerConnection.createAnswer()}).then(function(e){n.logger.unsafe.debug("["+t+"] create [answer] answer from peer connection","sdp:",e.sdp);var i=n.sessionDescription.createLocalAnswer(e.sdp);n.hasIceCandidates(i)||n.resetCandidateGathering(t),n.stats.startWaitingForStreamStart(r);var o=new n.webrtcAdapter.RTCSessionDescription({sdp:i.toLocal(),type:"answer"});return n.setupIceGatheringTimeout(t),Promise.all([n.peerConnection.setLocalDescription(o),n.iceCandidatesDeferred.promise])}).then(function(){var e=n.sessionDescription.createLocalAnswer(n.peerConnection.localDescription.sdp);e.updateModalities(r),n.checkIceCandidates(e);var i=e.toAnswer();return r=e.getModalities(),C.areNegotiatedDirectionsAcceptable(n.configuredModalities,n.negotiatingModalities,r)||n.triggerRenegotiation(!0,t),n.setNegotiatedModalities(r),n.logger.unsafe.debug("CREATE ANSWER","sdp:",i),{blob:i,contentType:n.mediaContentType}}))}})},e.prototype.processAnswerAsync=function(e,t,n){var i=this,r=e.blob;if(this.logger.unsafe.debug(n?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",r),n)return this.logger.safe.info("["+t+"] process [pranswer] ignored"),Promise.resolve();this.mediaContentType=e.contentType,-1===this.allowedMediaContentType.indexOf(this.mediaContentType)&&this.allowedMediaContentType.push(this.mediaContentType);var o=this.sessionDescription.createRemoteAnswer(r),a=o.clone(),s=C.invertModalities(o.getModalities());this.setNegotiatedModalities(s);var c=o.toRemote(this.negotiatedModalities);this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.registerMediaSources();var l=new this.webrtcAdapter.RTCSessionDescription({sdp:c,type:"answer"});return this.updateDescriptor(l,a),this.logger.unsafe.info("["+t+"] process [answer] set remote description","negotiated:",this.negotiatedModalities,"sdp:",l.sdp),this.peerConnection.setRemoteDescription(l).then(function(){return i.callbacks.onTransportInitialized&&i.callbacks.onTransportInitialized(),i.negotiatedModalities}).then(function(){return i.handleSharingRecvCapabilities(a),i.handleVideoRecvCapabilities(a)}).then(function(e){e&&i.triggerRenegotiation(!0,t)})},e.prototype.completeNegotiationAsync=function(e){var t=this;return new Promise(function(n){t.mediaManager.commit();var i=C.excludePassiveModalities(t.configuredModalities,t.passiveModalities,t.offeredModalities),r=t.forceMediaStreamUpdate&&!C.isOnHold(t.negotiatedModalities)||!C.areNegotiatedDirectionsAcceptable(i,t.negotiatingModalities,t.negotiatedModalities)||t.triggerRenegotiationFlag,o=!r;t.canTriggerRenegotiation=!0,t.logger.safe.info("["+e+"] negotiation completed isComplete: "+o+" configured: "+JSON.stringify(t.configuredModalities)+" negotiating: "+JSON.stringify(t.negotiatingModalities)+" offered: "+JSON.stringify(t.offeredModalities)+" negotiated: "+JSON.stringify(t.negotiatedModalities)),r&&t.triggerRenegotiation(!1,e),t.negotiationCompletedPromise.resolve(),n({isComplete:o,activeModalities:t.negotiatedModalities,offeredModalities:t.offeredModalities,attemptedModalities:t.negotiatingModalities,configuredModalities:t.configuredModalities,initiator:t.initiator})})},e.prototype.rejectNegotiationAsync=function(e,t,n){var i=this;return void 0===n&&(n=!1),Promise.resolve().then(function(){if(i.mediaManager.rollback(),i.logger.safe.warn("["+t+"] negotiation rejected isComplete: "+!n+" error: "+e+" configured: "+JSON.stringify(i.configuredModalities)+" negotiating: "+JSON.stringify(i.negotiatingModalities)+" offered: "+JSON.stringify(i.offeredModalities)+" negotiated: "+JSON.stringify(i.negotiatedModalities)),i.peerConnection){if("have-local-offer"===i.peerConnection.signalingState)return i.logger.safe.info("["+t+"] rolling back local description"),i.configProvider.config.webrtcHandleRollback?(i.logger.safe.info("["+t+"] rolling back using local renegotiation"),i.negotiationEmulator.renegotiateNow().then(function(){i.logger.safe.info("["+t+"] rolling back using local complete")})):i.peerConnection.setLocalDescription(new i.webrtcAdapter.RTCSessionDescription({type:"rollback"}));i.logger.safe.error("["+t+"] cannot rollback local description in currrent state: "+i.peerConnection.signalingState)}}).then(function(){i.canTriggerRenegotiation=!0,i.negotiationCompletedPromise.reject("negotiation rejected"),i.getAddedMediaTypes(i.negotiatedModalities,i.negotiatingModalities).forEach(function(e){i.removeTrackByMediaType(e),i.disposeStreamByMediaType(e)}),i.registerLocalStreams()}).then(function(){return n&&(i.logger.safe.info("["+t+"] retrying failed negotiation"),i.triggerRenegotiation(!1,t)),{isComplete:!n,activeModalities:i.negotiatedModalities,offeredModalities:i.offeredModalities,attemptedModalities:i.negotiatingModalities,configuredModalities:i.configuredModalities,initiator:i.initiator}})},e.prototype.createRemoteRenderer=function(e){var t=new p.RemoteVideoRenderer(this.logger,this.configProvider,this.subscriptionManager,e);return this.context.maContext.domOverrides.onMediaElementAdded&&this.context.maContext.domOverrides.onMediaElementAdded(t.getVideoElement()),this.remoteVideoManager.addRemoteRenderer(t),t},e.prototype.getStatsAsync=function(){var e=this;return this.terminated||(this.statisticsReport=this.statisticsReport.then(function(){return e.stats.getReport()}).catch(function(t){return e.logger.safe.error("getting statistics should never fail: "+t.error),t.partialReport})),this.statisticsReport},e.prototype.getLastKnownStats=function(){return this.stats.getLastKnownReport()},e.prototype.isReconnectSupported=function(){return this.configProvider.config.enableReconnectChrome},e.prototype.muteInputTypeAsync=function(e,t){return r(this,void 0,void 0,function(){return o(this,function(n){return this.setMuteAsync(e,!0,t),[2]})})},e.prototype.unmuteInputTypeAsync=function(e,t){return r(this,void 0,void 0,function(){return o(this,function(n){return this.setMuteAsync(e,!1,t),[2]})})},e.prototype.muteInputAsync=function(e){return this.doAudioMute=!0,this.setMuteAsync("Audio",!0,e)},e.prototype.unmuteInputAsync=function(e){return this.doAudioMute=!1,this.setMuteAsync("Audio",!1,e)},e.prototype.muteOutputAsync=function(e){return this.audioRenderer.setMuted(!0,e),Promise.resolve()},e.prototype.unmuteOutputAsync=function(e){return this.audioRenderer.setMuted(!1,e),Promise.resolve()},e.prototype.sendDtmf=function(e){return this.dtmfSender.sendDtmf(this.peerConnection,e)},e.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.peerConnection)},e.prototype.pauseNegotiations=function(){var e=this,t=new h.SettablePromise;return this.negotiationCompletedPromise.promise.catch(function(){}).then(function(){e.setNegotiationPromise(t)}),t},e.prototype.getExtensionsManager=function(){return this.extensionsManager},e.prototype.onDeviceEvent=function(e){this.stats.onDeviceEvent(e)},e.prototype._deviceSelectionChanged=function(){this.peerConnection&&(this.audioRenderer&&this.audioRenderer.getStream()&&this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId()),C.isOnHold(this.negotiatedModalities)||(this.forceMediaStreamUpdate=!0,this.triggerRenegotiation(!0)))},e.prototype.terminate=function(e,t,n){return void 0===n&&(n=!0),r(this,void 0,void 0,function(){var t;return o(this,function(i){switch(i.label){case 0:this.logger.safe.info("["+e+"] terminate"),this.stats.setTerminated(),this.canTriggerRenegotiation=!1,this.cleanUp(e),i.label=1;case 1:return i.trys.push([1,4,5,6]),n?[4,this.getStatsAsync()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[3,6];case 4:return t=i.sent(),this.logger.safe.error("["+e+"] Error while gathering stats "+S.stringifyObject(t)),[3,6];case 5:return this.stats.dispose(),this.terminated=!0,[7];case 6:return[2]}})})},e.prototype.cleanUp=function(e){this.activeSpeakerManager.dispose(),this.negotiationQueue.dispose(),this.negotiationCompletedPromise.reject("webRtcSession cleanUp"),this.localVideoStreamWatcher.dispose(),this.remoteVideoManager.dispose(),this.resetPeerConnection(e),this.subscriptionManager&&this.subscriptionManager.dispose(),this.clearIceDisconnectedTimer(),this.extensionsManager&&this.extensionsManager.dispose(),this.callbacks.onTerminated&&this.callbacks.onTerminated(this)},e.prototype.resetPeerConnection=function(e){this.logger.safe.info("["+e+"] reset peer connection"),this.audioRenderer&&this.audioRenderer.dispose(),this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.peerConnection&&this.peerConnection.close(),this.toBeCalledAfterConnected=[],this.disposeStreams(),this.videoStreamWatcher.dispose(),this.peerConnection=null,this.contributingSources.stopPolling(),this.negotiationEmulator.configure(null),this.peerConnectionPromise=null,this.resetCandidateGathering(e),this.canTriggerRenegotiation=!0,this.negotiatedModalities={}},e.prototype.resetNegotiationQueue=function(){this.negotiationCompletedPromise.reject("promise expired"),this.setNegotiationPromise(new h.SettablePromise)},e.prototype.setNegotiationPromise=function(e){this.terminated||(this.negotiationCompletedPromise=e,this.negotiationQueue.add(this.negotiationCompletedPromise))},e.prototype.setupExtensionsManager=function(){var e=new T.default(this.logger.createChild("ExtMgr"));return e.addExtension(_.default.EXTENSION_TYPE.dominantSpeakerHistory,{logger:this.logger,callback:this.activeSpeakerManager.onDominantSpeakerHistoryChanged.bind(this.activeSpeakerManager)}),e.addExtension(_.default.EXTENSION_TYPE.videoStreamControl,{logger:this.logger,negotiationEmulator:this.negotiationEmulator,qualityManager:this.qualityManager,configProvider:this.configProvider}),e},e.prototype.resetScreenSharingStream=function(){var e=this;this.logger.safe.warn("Attemping ScreenSharing stream recovery");var t=this.receiveStreamCollection.getStreams().find(function(e){return e.getModality()===_.default.MODALITY.sharing}),n=new E.ModalityToggler(t.getMediaStream().id,this.logger.createChild("SSModalityToggler"));this.negotiationEmulator.renegotiate([n]).then(function(){return e.logger.safe.warn("ScreenSharing recovery: decoder disabled"),e.negotiationEmulator.renegotiate([n])}).then(function(){e.logger.safe.warn("ScreenSharing recovery: decoder should be active again")})},e.prototype.updateQualityLevels=function(e){if(e){this.hwSilent!==e.audioHwSilent&&(this.hwSilent=e.audioHwSilent,this.callbacks.onAudioHwSilentChanged&&this.callbacks.onAudioHwSilentChanged(this.hwSilent)),this.ufdManager.signalEvent("NetworkRecvQuality",e.networkRecvLevel),this.ufdManager.signalEvent("NetworkSendQuality",e.networkSendLevel);var t=!(!e.isSpeaking||!this.doAudioMute);this.ufdManager.signalEvent("DeviceSpeakWhileMuted",t?"Bad":"Good")}},e.prototype.triggerRenegotiation=function(e,t){void 0===t&&(t=s.generateCauseId()),this.canTriggerRenegotiation?(this.canTriggerRenegotiation=!1,this.triggerRenegotiationFlag=!1,this.logger.safe.info("["+t+"] triggering renegotiation"),this.mediaManager.backup(),this.callbacks.onNegotiationRequired&&this.callbacks.onNegotiationRequired(t)):e&&(this.logger.safe.info("["+t+"] renegotiation postponed"),this.triggerRenegotiationFlag=!0)},e.prototype.throwIfModalitiesNotConfigured=function(e){if(!this.configuredModalities)throw new Error(e)},e.prototype.addTrack=function(e,t,n){if(e){var i=this.modalityByMediaType(n);if(this.logger.safe.info("add media track kind: "+e.kind+" id: "+e.id),this.senders[i])throw new Error("track already created, modality:"+i+", kind:"+e.kind+", id:"+e.id);"closed"!==this.peerConnection.iceConnectionState&&(this.senders[i]=this.peerConnection.addTrack(e,t))}},e.prototype.registerMediaSources=function(){var e=this,t=[];if(this.mediaStreams.forEach(function(n,i){var r={sourceId:e.getSourceIdForStream(n),defaultSSRC:e.ssrcs[i].min,modality:e.modalityByMediaType(i)};t.push(r)}),this.qualityManager.updateRegisteredSources(t),this.videoStream){var n=this.videoStream.getResolution();this.qualityManager.setCurrentResolution(new f.ResolutionInfo(n.width,n.height))}},e.prototype.updateStream=function(e,t){var n=this;return e.start().then(function(){try{var i=n.mediaStreams.get(t);if(i&&e.isSameStream(i))return e.dispose(),null;if(n.removeTrackByMediaType(t),n.disposeStreamByMediaType(t),!n.peerConnection)return e.dispose(),null;if(n.addTrack(e.rawTrack,e.rawStream,t),e.onApplyConstraints=function(i){n.removeTrackByMediaType(t),i.then(function(){n.addTrack(e.rawTrack,e.rawStream,t),n.registerLocalStreams()})},n.mediaStreams.set(t,e),"Video"===t){var r=[n.getMediaTrackInfo(t)];n.localVideoStreamWatcher.startWatching(r)}}catch(i){throw n.removeTrackByMediaType(t),n.disposeStreamByMediaType(t),e.dispose(),i}})},e.prototype.getSourceIdForStream=function(e){var t=e.rawStream.getTracks()[0].id,n=this.mediaManager.getMediaEntityByLocalTrackId(t);return n?(this.logger.safe.info("Media entity found: "+JSON.stringify(n.getXSourceStreamId())),n.getXSourceStreamId()):(this.logger.safe.error("Media entity is not found for stream: "+JSON.stringify(t)),0)},e.prototype.updatePeerConnectionStreamsAsync=function(e,t,n,i){var r=this,o=C.hasSendDirectionality(this.negotiatedModalities.audio),a=C.hasSendDirectionality(this.negotiatedModalities.video),s=C.hasSendDirectionality(this.negotiatedModalities.sharing),c=C.isOnHold(this.negotiatedModalities),l=C.hasSendDirectionality(e.audio),u=C.hasSendDirectionality(e.video),d=C.hasSendDirectionality(e.sharing),p=C.isOnHold(e);if(C.hasSendDirectionality(e.sharing)&&!this.context.configProvider.config.webrtcOutgoingScreenSharingEnabled)throw new Error("unsupported shreensharing send directionality in modalities "+JSON.stringify(e));return this.assurePeerConnectionAsync(i).then(function(){if(r.logger.safe.info("updatePeerConnectionStreamsAsync","pc state",r.peerConnection.signalingState,"hold","[",c,"->",p,"]","audio","[",o,"->",l,"]","video","[",a,"->",u,"]","sharing","[",s,"->",d,"]"),c!==p){if(r.videoStream&&r.videoStream.setHold(p),r.audioStream&&r.audioStream.setHold(p),r.displayStream&&r.displayStream.setHold(p),p)return;if(!p&&r.audioStream){r.removeTrackByMediaType("Audio");var e=r.audioStream.clone();r.audioStream.dispose(),r.mediaStreams.set("Audio",e),r.addTrack(r.audioStream.rawStream.getAudioTracks()[0],r.audioStream.rawStream,"Audio")}}if((o!==l||a!==u||s!==d||r.forceMediaStreamUpdate)&&(n&&(r.forceMediaStreamUpdate=!1),t&&(r.logger.safe.info("not using any media(track api) track, remove all senders"),l||(r.removeTrackByMediaType("Audio"),r.disposeStreamByMediaType("Audio")),n&&u||(r.removeTrackByMediaType("Video"),r.disposeStreamByMediaType("Video")),n&&d||(r.removeTrackByMediaType("ScreenShare"),r.disposeStreamByMediaType("ScreenShare"))),n)){var i=[];if(u){var f=r.deviceManager.getVideoStream();i.push(r.updateStream(f,"Video"))}return d&&(f=r.deviceManager.getDisplayStream(!1),i.push(r.updateStream(f,"ScreenShare"))),l&&(f=r.deviceManager.getAudioStream(),i.push(r.updateStream(f,"Audio").then(function(){r.audioStream.setMuted(r.doAudioMute)}))),Promise.all(i).then(function(){return r.registerLocalStreams()})}})},e.prototype.getMediaTrackInfo=function(e){var t=this.modalityByMediaType(e),n=this.mediaStreams.get(e).rawStream.getTracks()[0].id;return n||this.logger.safe.error("No media track for modality found: "+t),{trackId:n,modality:t,ssrc:this.ssrcs[e].min}},e.prototype.getSsrcRangeForMediaType=function(e){switch(e){case"Audio":return this.ssrcGenerator.nextAudioStreamSsrc();case"Video":case"ScreenShare":return this.ssrcGenerator.nextVideoStreamSsrc();default:return{min:1,max:1}}},e.prototype.getStreamTransformConfiguration=function(){var e,t;return this.multiParty?{ssrcRange:(e={},e[_.default.MEDIA_LABEL.audio]=0,e[_.default.MEDIA_LABEL.video]=this.configProvider.config.webrtcNegotiatedSsrcRangeForVideo,e[_.default.MEDIA_LABEL.sharing]=this.configProvider.config.webrtcNegotiatedSsrcRangeForSharing,e),unifiedPlanEnabled:!1}:{ssrcRange:(t={},t[_.default.MEDIA_LABEL.audio]=0,t[_.default.MEDIA_LABEL.video]=this.configProvider.config.webrtcNegotiatedSsrcRangeForVideoOneToOne,t[_.default.MEDIA_LABEL.sharing]=this.configProvider.config.webrtcNegotiatedSsrcRangeForSharingOneToOne,t),unifiedPlanEnabled:!1}},e.prototype.registerLocalStreams=function(){var e=this,t=[];this.mediaStreams.forEach(function(n,i){t.push(e.getMediaTrackInfo(i))}),this.mediaManager.setLocalTracksInfo(t)},e.prototype.handleVideoRecvCapabilities=function(e){if(this.configProvider.config.enableLocalVideoConstraints&&C.hasReceiveDirectionality(e.getModalities().video)){if(this.videoStream){var t=e.getVideoRecvCapabilities();if(!t)return this.logger.safe.error("No fmt params found for video modality"),Promise.resolve(!1);var n=this.generateReceiveCapabilities(t,this.videoStream);this.qualityManager.setMaxCapabilities([n])}this.logger.safe.error("remote endpoint didn't specify video receive capability")}return Promise.resolve(!1)},e.prototype.handleSharingRecvCapabilities=function(e){if(this.configProvider.config.enableLocalVideoConstraints&&C.hasReceiveDirectionality(e.getModalities().sharing)&&this.displayStream){var t=e.getSharingRecvCapabilities();if(!t)return void this.logger.safe.error("No fmt params found for sharing modality");var n=this.generateReceiveCapabilities(t,this.displayStream);this.qualityManager.setMaxCapabilities([n])}},e.prototype.generateReceiveCapabilities=function(e,t){var n=i({ssrc:0,keyframe:!1},e),r={causeId:s.generateCauseId(),isSimulcast:!1,sourceId:this.getSourceIdForStream(t),capabilities:[n]};return this.logger.safe.info("Generated receive capabilities for stream "+t.id+": "+JSON.stringify(r)),r},e.prototype.updateDescriptor=function(e,t){var n=t.getVideoRecvCapabilities(),i={sourceId:0,streamMsid:0,bandwidth:0};if(n&&this.videoStream&&!this.displayStream&&(i.sourceId=this.getSourceIdForStream(this.videoStream),i.streamMsid=this.videoStream.id,i.bandwidth=n.maxBr?n.maxBr:Number.MAX_VALUE),i.bandwidth>0){i.bandwidth=Math.floor(i.bandwidth/1200);var r=new E.BandwidthControlModifier(this.logger,this.qualityManager,this.resolutionTable,this.context.configProvider);r.setControlItem(i),r.modifyDescriptor(e)}},e.prototype.removeTrackByMediaType=function(e){return this.removeTracksByModality(this.modalityByMediaType(e))},e.prototype.modalityByMediaType=function(e){switch(e){case"Audio":return _.default.MODALITY.audio;case"Video":return _.default.MODALITY.video;case"ScreenShare":return _.default.MODALITY.sharing;default:throw new Error("Modality is not defined for media type: "+e)}},e.prototype.removeTracksByModality=function(e){var t=this;this.forceKeyFramePromise&&"sharing"===e?this.forceKeyFramePromise.then(function(){t.removeTracksByModality(e)}):e in this.senders&&(this.logger.safe.info("remove sender track kind: "+this.senders[e].track.kind+" track id: "+this.senders[e].track.id),"closed"!==this.peerConnection.iceConnectionState&&this.peerConnection.removeTrack(this.senders[e]),delete this.senders[e])},e.prototype.handleCodecSwitchUnsupported=function(e){var t=this;return this.offeredDescription.isCodecSwitchSupported()?Promise.resolve():this.webrtcAdapter.RTCRtpReceiver.getCapabilities(_.default.MEDIA_TYPE.audio).then(function(e){var n=e.codecs.map(function(e){return e.mimeType});t.offeredDescription.usePrimaryAudioCodecOnly(n)}).catch(function(n){t.logger.safe.error("["+e+"] failed to set primary codec based on audio capability "+S.stringifyObject(n))})},e.prototype.disposeStreamByMediaType=function(e){var t=this.mediaStreams.get(e);t&&(this.mediaStreams.delete(e),t.dispose(),"Video"===e&&this.localVideoStreamWatcher.stopWatching())},e.prototype.disposeStreams=function(){var e=this;this.mediaStreams.forEach(function(t,n){return e.disposeStreamByMediaType(n)})},e.prototype.assurePeerConnectionAsync=function(e){var t=this;if(!this.peerConnectionPromise){if(!this.relayManagerProvider)throw new Error("relay manager provider is not set!");this.logger.safe.info("fetching relay details from RelayManager...");var n={relayType:"turn",isRemoteClientLync:this.context.config.isRemoteClientLync,useTurnRedirector:this.configProvider.config.useTurnRedirector,turnRedirectorTimeout:this.configProvider.config.turnRedirectorTimeout};this.peerConnectionPromise=this.relayManagerProvider.getRelayManager().queryRelaysAsync(n).then(function(n){if(t.terminated)throw new Error("session already disposed");var i={optional:[]},r=F.createIceServers(n,t.configProvider.config);t.configureCrypto(i),t.configureCpuThreshold(i),t.logger.safe.info("create peer connection");var o=t.peerConnection=new t.webrtcAdapter.RTCPeerConnection({iceServers:r,rtcpMuxPolicy:"require",iceTransportPolicy:t.iceTransportPolicy,bundlePolicy:t.context.configProvider.mediaConfig.isTransportUnbundled?"balanced":"max-bundle",sdpSemantics:"plan-b",audioPortRange:t.configProvider.mediaConfig.audioPortRange,videoPortRange:t.configProvider.mediaConfig.videoPortRange},i);t.negotiationEmulator.configure(o),t.stats.initialize(o),t.stats.sessionInfo.setIceServers(r),t.stats.sessionInfo.setIceTransportPolicy(t.iceTransportPolicy),t.contributingSources.startPolling(),o.onnegotiationneeded=function(){t.logger.safe.info("onnegotiationneeded signalingState: "+o.signalingState)},o.onsignalingstatechange=function(){t.stats.sessionInfo.setSignalingConnectionState(o.signalingState),t.logger.safe.info("onsignalingstatechange signalingState: "+o.signalingState)},o.onicecandidateerror=function(e){var n=a(e.hostCandidate?e.hostCandidate.split(":"):[e.address,e.port],2),i=n[0],r=n[1];t.logger.safe.warn("On ICE candidate error "+e.url+" | "+i+":"+r+": code "+e.errorCode+": "+e.errorText),t.isConnected()&&!t.iceCandidatesDeferred.isPending||t.stats.addIceCandidateError({address:i,port:+r,url:e.url,errorCode:e.errorCode,errorText:e.errorText})};var c=function(e){if(!t.isConnected())return t.logger.safe.info("onaddstream handling postponed till PC is connected"),void t.toBeCalledAfterConnected.push(function(){return c(e)});var n=e.stream;t.logger.safe.info("onaddstream stream: "+n.id);var i=t.mediaManager.getMediaEntityByStreamId(n.id);if(i||(t.logger.safe.info("cannot find media entity with stream id "+n.id+" trying to fallback"),n.getAudioTracks()[0]&&(i=t.mediaManager.getMediaEntitiesByModality(_.default.MODALITY.audio)[0])),i){var r=t.createReceiveStream(n,i.getModality(),+i.getXSourceStreamId());t.receiveStreamCollection.add(r)}else t.logger.safe.error("could not find media entity for an added stream: "+n.id)};o.onaddstream=c,o.ontrack=function(e){t.logger.safe.info("ontrack track: "+e.track)};var l=function(e){if(!t.isConnected())return t.logger.safe.info("onremovestream handling postponed till PC is connected"),void t.toBeCalledAfterConnected.push(function(){return l(e)});t.logger.safe.info("onremovestream stream: "+e.stream),t.receiveStreamCollection.remove(e.stream.id)};o.onremovestream=l,o.onicecandidate=function(n){var i=n.candidate;if(i){var a=C.parseCandidateString(i.candidate);t.logger.safe.info("["+e+"] onicecandidate candidate: prio:"+a.priority+" type:"+a.type+" port:"+a.port),t.logger.unsafe.info("["+e+"] candidate details: "+i.candidate)}else t.logger.safe.info("["+e+"] onicecandidate candidate: null");if(t.iceCandidatesDeferred.isPending){var s=!t.initiator||!t.context.config.webrtcIceGatheringTimeoutIncreased,c=t.iceHostCandidateOnly||0===r.length;if(!i&&s||c){i&&t.logger.safe.info("["+e+"] Not waiting for ICE candidates, hoping that host/prflx is enough"),t.logger.safe.info("["+e+"] Is connected:",t.isConnected(),o.iceConnectionState,o.signalingState);var l=!0;t.context.configProvider.mediaConfig.isTransportUnbundled&&i&&(l=t.sessionDescription.createLocalOffer(t.peerConnection.localDescription.sdp).hasUnbundledIceCandidates()),l&&t.completeCandidateGathering(e)}else i&&i.candidate.indexOf("typ relay")>-1&&(l=!0,t.context.configProvider.mediaConfig.isTransportUnbundled&&(l=t.sessionDescription.createLocalOffer(t.peerConnection.localDescription.sdp).hasUnbundledRelayIceCandidates()),l&&(t.stats.clearIceCandidateErrors(),t.completeCandidateGathering(e,{priority:i.priority||i.candidate.split(" ")[3],time:Date.now()-t.iceRelayCandidatesGatherStartTime})))}},o.onicegatheringstatechange=function(){t.logger.safe.info("onicegatheringstatechange iceGatheringState: "+o.iceGatheringState)},o.oniceconnectionstatechange=function(){var e=s.generateCauseId();if(!t.terminated){if(t.stats.sessionInfo.setIceConnectionState(o.iceConnectionState),t.logger.safe.info("["+e+"] oniceconnectionstatechange iceConnectionState: "+o.iceConnectionState+" pc.signalingState: "+o.signalingState),"connected"===o.iceConnectionState||"completed"===o.iceConnectionState)t.onTransportConnected(e);else if("failed"===o.iceConnectionState){if(t.iceCandidatesDeferred.isPending)return t.logger.safe.info("["+e+"] ice failed while gathering candidates, suppressing error"),void t.completeCandidateGathering(e,!1);t.raiseError({type:_.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport failed"},e),t.configProvider.config.webrtcCloseAfterIceFailure&&o.close(),t.onTransportFailed()}"disconnected"===o.iceConnectionState?(t.onTransportDisconnected(e),t.startIceDisconnectedTimer(e)):t.clearIceDisconnectedTimer()}}})}return this.peerConnectionPromise},e.prototype.configureCrypto=function(e){var t=!1,n=this.multiParty?this.configProvider.config.preferSdesSrtpMultiparty:this.configProvider.config.preferSdesSrtp1on1;if(this.offeredDescription){var i=this.offeredDescription.getSrtpInfo();this.stats.sessionInfo.setOfferedSrtpInfo(i),t=!i.dtls||i.sdes&&n}else t=n;t&&(this.logger.safe.info("configuring peer connection to use sdes"),e.optional.push({DtlsSrtpKeyAgreement:!1})),this.stats.sessionInfo.setNegotiatedSrtpInfo({dtls:!t,sdes:!!t})},e.prototype.configureCpuThreshold=function(e){this.configProvider.config.webrtcNativeCpuOveruseDisabled&&this.multiParty&&e.optional.push({googCpuOveruseDetection:!1})},e.prototype.completeCandidateGathering=function(e,t){this.iceCandidatesDeferred.isPending&&(t&&this.stats.sessionInfo.setRelayCandidateInfo(t),this.logger.safe.info("["+e+"] ICE candidates gathered completely"),this.iceCandidatesDeferred.resolve())},e.prototype.onTransportConnected=function(e){if(this.logger.safe.info("["+e+"] audio transport connected"),this.stats.clearIceCandidateErrors(),!this.terminated){for(;this.toBeCalledAfterConnected.length;)this.toBeCalledAfterConnected.shift()();this.callbacks.onAudioStateChanged(_.default.STREAMING_STATE.active,e),this.callbacks.onTransportConnected&&this.callbacks.onTransportConnected(e)}},e.prototype.onTransportDisconnected=function(e){this.callbacks.onTransportDisconnected&&this.callbacks.onTransportDisconnected(e)},e.prototype.onTransportFailed=function(){this.callbacks.onTransportFailed&&this.callbacks.onTransportFailed()},e.prototype.startIceDisconnectedTimer=function(e){var t=this;this.configProvider.config.iceDisconnectedTimeoutMs&&(this.iceDisconnectedTimer=setTimeout(function(){t.logger.safe.error("["+e+"] ice disconnected for "+t.configProvider.config.iceDisconnectedTimeoutMs+"ms. Raise CONSTANTS.MEDIAthis._ERROR.iceConnectionError"),t.raiseError({type:_.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"},e)},this.configProvider.config.iceDisconnectedTimeoutMs))},e.prototype.clearIceDisconnectedTimer=function(){this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null)},e.prototype.raiseError=function(e,t){void 0===t&&(t=s.generateCauseId()),this.logger.safe.error("["+t+"] Media error occurred type: "+e.type+" detail: "+e.detail),this.callbacks.onSessionErrorOccurred&&this.callbacks.onSessionErrorOccurred(e,t)},e.prototype.createNegotiationConstraints=function(e){function t(e){return!!e&&(C.hasReceiveDirectionality(e)||"inactive"===e)}return{offerToReceiveAudio:t(e.audio),offerToReceiveVideo:t(e.video)||t(e.sharing)}},e.prototype.resetCandidateGathering=function(e){this.logger.safe.info("["+e+"] reset candidate gathering"),this.iceCandidatesDeferred.promise.then(function(){},function(){}),this.iceCandidatesDeferred.reject(new Error("reset candidate gathering")),this.iceCandidatesDeferred=new h.SettablePromise},e.prototype.checkIceCandidates=function(e){var t=this.hasIceCandidates(e);if(t===this.noIceCandidates&&(this.noIceCandidates=!this.noIceCandidates,this.ufdManager.signalEvent("NoNetwork",this.noIceCandidates?"Bad":"Good"),this.noIceCandidates))throw{type:_.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"};if(t){var n=this.hasRelayIceCandidates(e);if(n===this.noRelayIceCandidates){if(!n&&("connected"===this.peerConnection.iceConnectionState||"completed"===this.peerConnection.iceConnectionState))return;this.noRelayIceCandidates=!this.noRelayIceCandidates,this.ufdManager.signalEvent("NetworkRelaysNotReachable",this.noRelayIceCandidates?"Bad":"Good")}}},e.prototype.hasIceCandidates=function(e){return this.configProvider.mediaConfig.isTransportUnbundled?e.hasUnbundledIceCandidates():e.hasIceCandidates()},e.prototype.hasRelayIceCandidates=function(e){return this.configProvider.mediaConfig.isTransportUnbundled?e.hasUnbundledRelayIceCandidates():e.hasRelayIceCandidates()},e.prototype.doRetargetIfNeeded=function(e,t,n){var i=t.isIceRestart();this.logger.safe.info("["+n+"] ICE restart: "+i),this.context.configProvider.mediaConfig.isTransportUnbundled&&this.offeredDescription&&this.offeredDescription.isMSRTC()&&i&&!this.multiParty&&t.getSrtpInfo().sdes&&(e.newOffer=!0)},e.prototype.getAddedMediaTypes=function(e,t){e||(e={}),t||(t={});var n=[];return H(e.audio,t.audio)&&n.push("Audio"),H(e.video,t.video)&&n.push("Video"),H(e.sharing,t.sharing)&&n.push("ScreenShare"),n},e.prototype.applyCapabilitiesForModality=function(e,t,n){return e===_.default.MODALITY.video?this.applyCapabilitiesForVideo(t,n[0]):e===_.default.MODALITY.sharing?this.applyCapabilitiesForSharing(t,n[0]):Promise.resolve(!1)},e.prototype.applyCapabilitiesForSharing=function(e,t){var n=this;return this.displayStream?this.applyCapabilities(this.displayStream,t).then(function(i){return n.stats.onMaxCapabilitiesApplied({causeId:e,modality:_.default.MODALITY.sharing,capabilities:[t]}),n.configProvider.config.webrtcAllowRestoreKeyframe?n.forceKeyframe(n.senders[_.default.MODALITY.sharing]).then(function(){return i}):Promise.resolve(i)}):(this.logger.safe.info(JSON.stringify(t)+" is ignored as no sharing stream is sent, no renegotiation"),Promise.resolve(!1))},e.prototype.forceKeyframe=function(e){var t=this;if(!e)return this.logger.safe.error("forceKeyframe: No sender available for sharing"),null;if(this.forceKeyFramePromise)return this.logger.safe.warn("forceKeyframe: already in progress"),this.forceKeyFramePromise;this.logger.safe.info("Restoring keyframe");var n=e.track;return this.forceKeyFramePromise=e.replaceTrack(null).then(function(){return e.replaceTrack(n)}).then(function(){t.forceKeyFramePromise=null,t.logger.safe.info("Restoring keyframe finished")}).catch(function(e){t.forceKeyFramePromise=null,t.logger.safe.error("Restoring keyframe failed: "+e),delete t.senders[_.default.MODALITY.sharing]}),this.forceKeyFramePromise},e.prototype.applyCapabilitiesForVideo=function(e,t){return this.negotiationCompletedPromise.isPending?(this.logger.safe.info("##### Renegotiation is in progress, no local resolution switch for now #####"),this.negotiationCompletedPromise.promise.then(function(){return Promise.resolve(!1)})):this.videoStream?this.scheduleApplyCapabilities(this.videoStream,e,t):(this.logger.safe.info(JSON.stringify(t)+" is ignored as no video is sent, no renegotiation"),Promise.resolve(!0))},e.prototype.scheduleApplyCapabilities=function(e,t,n){var i=this;this.logger.safe.info("Queueing local renegotiation...");var r=!1;return this.negotiationQueue.add(function(){return i.logger.safe.info("############# LOCAL RENEGOTIATION START #############"),i.applyCapabilities(e,n).then(function(){i.stats.onMaxCapabilitiesApplied({causeId:t,modality:_.default.MODALITY.video,capabilities:[n]}),r=!0})}),this.negotiationEmulator.renegotiate().then(function(){return i.logger.safe.info("############# LOCAL RENEGOTIATION END. RESULT: "+r+"  #############"),r})},e.prototype.applyCapabilities=function(e,t){return e?(this.logger.safe.info("Changing resolution to "+JSON.stringify(t)),e.applyCapabilities(t)):(this.logger.safe.info("Resolution "+JSON.stringify(t)+" ignored, no stream is being sent"),Promise.resolve(!1))},e.prototype.onOptimalVideoReceiversCountChanged=function(e){this.callback.onOptimalVideoReceiversCountChanged&&this.callback.onOptimalVideoReceiversCountChanged(e)},e.prototype.onSendBandwidthChanged=function(e){return r(this,void 0,void 0,function(){var t,n,i=this;return o(this,function(r){return this.isConnected()?(t=this.extensionsManager.getExtension(_.default.EXTENSION_TYPE.videoStreamControl),0===(n=this.mediaManager.getMediaEntities().filter(function(e){return[_.default.MODALITY.video,_.default.MODALITY.sharing].indexOf(e.getModality())>-1}).filter(function(e){return e.isEnabled()}).map(function(e){return e.getMid()})).length?[2]:[2,t.sendBandwidthInfo(n,e).then(function(){i.stats.setReportedSendBandwidth(e)})]):[2]})})},e.prototype.getStreams=function(){return this.receiveStreamCollection.getStreams()},e.prototype.onStreamsChanged=function(e){this.streamsChangedListener=e},e.prototype.notifyStreamsChanged=function(){var e=this;this.logger.safe.info("Scheduling stream changed notification: "+this.streamsChangedNotificationScheduled),this.streamsChangedNotificationScheduled||this.negotiationCompletedPromise.promise.catch(function(){}).then(function(){e.streamsChangedNotificationScheduled=!1,e.streamsChangedListener&&e.streamsChangedListener()})},e.prototype.streamAdded=function(e){_.default.MODALITY.audio===e.getModality()&&(this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId()),this.audioRenderer.play(e.getMediaStream())),_.default.MODALITY.sharing===e.getModality()&&this.videoStreamWatcher.watchStream(e.getMediaStream()),this.notifyStreamsChanged()},e.prototype.streamRemoved=function(e){_.default.MODALITY.audio===e.getModality()&&this.audioRenderer.getStream()===e.getMediaStream()&&this.audioRenderer.stop(),_.default.MODALITY.sharing===e.getModality()&&this.videoStreamWatcher.stopWatchingStream(e.getMediaStream()),this.notifyStreamsChanged()},e.prototype.setNegotiatedModalities=function(e){this.negotiatedModalities=e,this.stats.sessionInfo.setNegotiatedModalities(e)},e.prototype.setupIceGatheringTimeout=function(e){var t=this;this.iceRelayCandidatesGatherStartTime=Date.now();var n=this.context.config.webrtcIceGatheringTimeoutIncreased?this.configProvider.config.relayWaitSaneTimeoutMs:this.configProvider.config.webrtcIceGatheringTimeoutMs;if(n){this.iceCandidatesTimer>0&&clearTimeout(this.iceCandidatesTimer);var i=this.iceCandidatesDeferred;this.iceCandidatesTimer=setTimeout(function(){t.iceCandidatesTimer=0,i.isPending&&(t.logger.safe.warn("["+e+"] ICE candidates gathering terminated due to timeout "+n),i.resolve())},n)}},e.prototype.createAudioRenderer=function(){this.audioRenderer=new d.default(this.logger.createChild("AudioRenderer"),this.configProvider),this.context.maContext.domOverrides.onMediaElementAdded&&this.audioRenderer.on("onAudioElementAdded",this.context.maContext.domOverrides.onMediaElementAdded),this.context.maContext.domOverrides.onMediaElementRemoved&&this.audioRenderer.on("onAudioElementRemoved",this.context.maContext.domOverrides.onMediaElementRemoved)},e.prototype.isConnected=function(){var e=this.peerConnection;return e&&("connected"===e.iceConnectionState||"completed"===e.iceConnectionState)},e.prototype.isFailed=function(){return this.peerConnection&&("failed"===this.peerConnection.iceConnectionState||"closed"===this.peerConnection.iceConnectionState)},e.prototype.createReceiveStream=function(e,t,n){return new L.default(e,t,n,this)},e.prototype.requestSource=function(e,t,n,i){var r=this;return this.multiParty?this.negotiatedModalities[e]===_.default.MEDIA_STATE.inactive&&n!==m.MediaSourceIdentifiers.SourceNone?c.delay(10).then(function(){return r.requestSource(e,t,n,i)}):this.negotiationCompletedPromise.isPending?this.negotiationCompletedPromise.promise.catch(function(){}).then(function(){return r.requestSource(e,t,n,i)}):Promise.resolve().then(function(){return r.extensionsManager.getExtension(_.default.EXTENSION_TYPE.videoStreamControl).sendSourceRequest(t,n,i)}):Promise.resolve()},e.prototype.onMaxVideoSendCapabilitiesChanged=function(e,t){},e}();function H(e,t){return!C.hasSendDirectionality(e)&&C.hasSendDirectionality(t)}t.default={build:function(e,t,n){return new j(e,t,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(12),r=n(227),o=n(234),a=n(235);t.default=function(e){this.RTCPeerConnection=i.default.window.RTCPeerConnection,this.RTCSessionDescription=a.SessionDescriptionAdapter,this.SdpTransform=r.UnifiedPlanSdpTransform,this.RTCRtpReceiver=o.default.build(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(228),o=function(){function e(e){this.context=e,this.cname=i.uniqueId()}return e.prototype.toLocal=function(e,t){return this.modify(0,e,t)},e.prototype.toOffer=function(e,t,n){return this.modify(1,e,t,n)},e.prototype.toAnswer=function(e,t,n){return this.modify(2,e,t,n)},e.prototype.toRemote=function(e,t,n){return this.modify(3,e,t,n)},e.prototype.modify=function(e,t,n,o){var a=new r.SdpModifiersChainBuilder(this.context,n,o,this.cname).build(e),s=i.deepClone(t);return a.modify(s),s},e}();t.UnifiedPlanSdpTransform=o},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(60),o=function(){function e(e){this.modifierList=e}return e.prototype.modify=function(e){var t,n;try{for(var r=i(this.modifierList),o=r.next();!o.done;o=r.next())o.value.modify(e)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e}(),a=function(){function e(e,t,n,i){this.context=e,this.mediaManager=t,this.modalities=n,this.cname=i}return e.prototype.build=function(e){return 3===e?new o([new r.DisabledMediaFixup(this.mediaManager),new r.NoBundleInAnswerFixup(this.context.configProvider,this.mediaManager),new r.SendOnlyModalityFixup(this.modalities),new r.NoAudioFixup,new r.ComfortNoiseFixup,new r.G722Fixup,new r.RemoveH264ParamsModifier,new r.InSdpReceiveSsrcFixup,new r.TransportCcModifier(this.context.configProvider),new r.IncomingSrtpFixup(this.context.configProvider,this.context.config.isConference),new r.RemoveLabelsModifier,new r.BandwidthModifier,new r.IncomingDataModalityFixup,new r.BundleGroupModifier(this.context.configProvider)]):0===e?new r.InjectH264SpsPpsIdrInKeyframe(this.context.configProvider):new o([new r.OutgoingDataModalityFixup(this.mediaManager),new r.DisabledMediaFixup(this.mediaManager),new r.AddLabelsModifier(this.mediaManager),new r.ComfortNoiseFixup,new r.TransportCcModifier(this.context.configProvider),new r.DtlsRoleModifier(this.mediaManager,1===e),new r.OutSdpReceiveSsrcFixup(this.context.config.isConference,this.cname),new r.IceRestartChecker(this.mediaManager),new r.ExtensionsFixup,new r.RemoveH264SpsPpsIdrInKeyframe(this.context.configProvider),new r.BundleGroupModifier(this.context.configProvider)])},e}();t.SdpModifiersChainBuilder=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(230),o=n(231),a=n(232),s={audio:"main-audio",video:"main-video"};t.default=function(e){this.toMsSdp=function(r,o){return r.msidSemantic={semantic:"WMS",token:"*"},r.media.forEach(function(a,d){var p;if(a.protocol=i.default.PROFILES.rtpSavp,a.label=a.label||(p=a.type,s.hasOwnProperty(p)&&s[p]||"undefined"),0===a.port){for(var f in a)a.hasOwnProperty(f)&&["type","port","protocol","payloads"].indexOf(f)<0&&delete a[f];a.payloads=34}c.toMsSdp(a,d),a.crypto&&a.crypto.forEach(function(e){e.config+="|2^31"}),0!==a.port&&r.fingerprint&&(a.fingerprint=r.fingerprint),n.toMsSdp(a,r),l.toMsSdp(a,r,o),a.invalid&&(t.error("Unknown SDP attributes! "+a.invalid),delete a.invalid),u(a,!1),0!==a.port&&(a.type===i.default.MEDIA_TYPE.audio&&e.configProvider.config.webrtcAudioChannelSignalingFeedback?a.signalingFbXMessage={payload:"*",param:e.configProvider.config.webrtcAudioChannelSignalingFeedback}:a.type===i.default.MEDIA_TYPE.video&&e.configProvider.config.webrtcVideoChannelSignalingFeedback&&(a.signalingFbXMessage={payload:"*",param:e.configProvider.config.webrtcVideoChannelSignalingFeedback}))}),delete r.fingerprint,r},this.fromMsSdp=function(e,t){for(var i=e.media.length-1;i>=0;--i){var r=e.media[i];if((r.ssrcs&&r.ssrcs[0]||r.xSsrcRange)&&(e.msidSemantic={semantic:"WMS",token:"*"}),0!==r.port){if(c.fromMsSdp(r),delete r.cryptoscale,r.fingerprint&&d(t)&&(r.setup="actpass"),r.crypto)for(var o=r.crypto.length-1;o>=0;--o){var a=r.crypto[o];a.config.match(/.*\|\d+:\d+/)?r.crypto.splice(o,1):a.config=a.config.replace(/(.*)\|2\^\d+/,"$1")}r.remoteCandidates&&(delete r.candidates,delete r.xCandidatesIpv6,delete r.remoteCandidates),n.fromMsSdp(r),r.rtcpFbXMessage&&delete r.rtcpFbXMessage,u(r,!0)}else r.direction||(r.direction="inactive")}return e};var t=e.logger,n=r.default.build(),c=new a.SsrcTransform(e.configuration),l=o.default.build();function u(e,t){var n=[{name:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",encoded:"http:\\\\www.webrtc.org\\experiments\\rtp-hdrext\\abs-send-time"},{name:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",encoded:"http:\\\\www.ietf.org\\id\\draft-holmer-rmcat-transport-wide-cc-extensions-01"}];e.ext&&e.ext.forEach(function(e){n.some(function(n){var i=t?n.encoded:n.name,r=t?n.name:n.encoded;return i===e.uri&&(e.uri=r,!0)})})}function d(e){return"offer"===e.type}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28);t.default={build:function(){return new function(){var e=[{jsep:"active",msSdp:"tcp-act"},{jsep:"passive",msSdp:"tcp-pass"},{jsep:"so",msSdp:"tcp-so"}];function t(t,n){delete t.generation,delete t["network-id"],delete t["network-cost"],t.transport.match(/tcp/i)&&function(t,n){e.some(function(e){if(n){if(e.msSdp===t.transport.toLowerCase())return t.transport="tcp",t.tcptype=e.jsep,!0}else if(t.tcptype&&e.jsep===t.tcptype.toLowerCase())return t.transport=e.msSdp,delete t.tcptype,!0;return!1})}(t,n)}function n(e,t,n){var i=t.connection||n.connection,r=function(e,t,n){return e.port===n&&e.ip===t};return!!i&&(1===e.component?r(e,i.ip,t.port):!!t.rtcp&&r(e,t.rtcp.ip||i.ip,t.rtcp.port))}this.fromMsSdp=function(e){e.candidates=e.candidates||[],e.xCandidatesIpv6&&(e.xCandidatesIpv6.forEach(function(t){e.candidates.push(t)}),delete e.xCandidatesIpv6),e.candidates.forEach(function(e){t(e,!0)})},this.toMsSdp=function(e,r){e.candidates=e.candidates||[],e.candidates.sort(function(t,i){return t.foundation!==i.foundation?t.foundation-i.foundation:t.component!==i.component?t.component-i.component:+n(i,e,r)-+n(t,e,r)}),e.candidates=e.candidates.filter(function(n,i){t(n,!1);var r=e.candidates[i-1];return!r||r.component!==n.component||r.foundation!==n.foundation}),function(e,t){if(e.port&&!e.candidates.length){var n=i.getBundle(t);n&&(e.port=n.port,e.connection=n.connection)}}(e,r)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.toMsSdp=function(e,t,n){"offer"===n.type?e.rtcp&&(e.rtcp={port:e.port}):delete e.rtcp},e}();t.default={build:function(){return new i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(19),a=n(233),s=[{label:r.default.MEDIA_LABEL.audio,id:a.default.STREAM_ID.audio},{label:r.default.MEDIA_LABEL.video,id:a.default.STREAM_ID.video},{label:r.default.MEDIA_LABEL.sharing,id:a.default.STREAM_ID.sharing}].reduce(function(e,t){return e[t.label]=t.id,e},{}),c=i.uniqueId(),l=function(){function e(e){this.configuration=e}return e.prototype.fromMsSdp=function(e){var t=this;if(0!==e.port){if(!this.isRecvOnly(e)||this.configuration.unifiedPlanEnabled){if(e.msid){e.ssrcs&&1===e.ssrcs.length&&(this.addStream(e,e.ssrcs[0].id,e.ssrcs[0].value,e.msid),e.ssrcs.shift());var n=e.msid.split(" ");e.msid=this.getMsidValue(n[0],n[1]||n[0],e.label)}if(e.ssrcs)this.updateMsids(e.ssrcs,function(n,i){return t.getMsidValue(n,i,e.label)});else{var i=this.getFlowSsrcs(e);i.length>0?i.forEach(function(n){t.addStream(e,n,c,t.getMsidValue(i[0],i[0],e.label))}):e.xSsrcRange&&this.addStream(e,e.xSsrcRange.ssrcMin,c,this.getMsidValue(e.xSsrcRange.ssrcMin,e.xSsrcRange.ssrcMin,e.label))}}delete e.xSsrcRange}},e.prototype.toMsSdp=function(e,t){var n;0!==e.port&&(e.ssrcs&&e.ssrcs[0]&&(n=e.ssrcs[0].id),void 0!==n&&(0===t||o.Helper.hasSendDirectionality(e.direction)?e.xSsrcRange={ssrcMin:n,ssrcMax:this.getMaxSsrcForMedia(e,n)}:e.xSsrcRange={ssrcMin:n,ssrcMax:n}))},e.prototype.getMaxSsrcForMedia=function(e,t){var n=this.configuration.ssrcRange[e.label];return n?t+n:t},e.prototype.getFlowSsrcs=function(e){var t;return e.ssrcGroups&&e.type===r.default.MEDIA_TYPE.video&&(e.ssrcGroups.some(function(e){return"FID"===e.semantics&&(t=e,!0)}),t)?t.ssrcs.split(" ").map(function(e){return+e}):[]},e.prototype.addStream=function(e,t,n,i){e.ssrcs=e.ssrcs||[],e.ssrcs.push({attribute:"cname",id:t,value:n}),e.ssrcs.push({attribute:"msid",id:t,value:i})},e.prototype.updateMsids=function(e,t){e.filter(function(e){return"msid"===e.attribute}).forEach(function(e){var n=e.value.split(" ");e.value=t(n[0],n[1]||n[0])})},e.prototype.getMsidValue=function(e,t,n){var i=this.getMsidPrefix(n);return i+e+" "+i+t},e.prototype.getMsidPrefix=function(e){return s[e]?s[e]+a.default.STREAM_ID_DELIMITER:""},e.prototype.isRecvOnly=function(e){return"recvonly"===e.direction},e}();t.SsrcTransform=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={STREAM_ID:{audio:"mainAudio",video:"mainVideo",sharing:"applicationsharingVideo"},STREAM_ID_DELIMITER:"-"}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(33),a=n(36),s=n(12),c=n(27),l=function(){function e(){}return e.prototype.getCapabilities=function(e){var t=RTCRtpReceiver.getCapabilities(e);return t.codecs.forEach(function(e){var t=e.mimeType.toLowerCase().split("/");e.mimeType=t[1]||t[0]}),Promise.resolve(t)},e}(),u=function(){function e(e){this.selfGlobal=e.global.capabilityGatherer=e.global.capabilityGatherer||{},this.getCapabilities("video")}return e.prototype.getCapabilities=function(e){return i(this,void 0,void 0,function(){var t,n,i,c,l;return r(this,function(r){switch(r.label){case 0:if("video"!==e&&"audio"!==e)return[2,Promise.reject(new Error("capabilities for "+e+" are not supported"))];if(this.selfGlobal.gatherTask)return[3,4];t=a.defer(),this.selfGlobal.gatherTask=t.promise,n=new s.default.window.RTCPeerConnection(null),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.createOffer({offerToReceiveVideo:1,offerToReceiveAudio:1})];case 2:return i=r.sent(),c={},o.parse(i.sdp).media.forEach(function(e){c[e.type]=e.rtp.map(function(e){return{mimeType:e.codec.toLowerCase()}})}),n.close(),t.resolve(c),[3,4];case 3:return l=r.sent(),this.selfGlobal.gatherTask=null,n.close(),t.reject(l),[3,4];case 4:return[2,this.selfGlobal.gatherTask.then(function(t){return{codecs:t[e]}})]}})})},e}();t.default={build:function(e){return c.UserAgentConfig.hasCapabilitiesApi()?new l:new u(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(12),r=function(){function e(e){this.originalDescription=new i.default.window.RTCSessionDescription(e)}return Object.defineProperty(e.prototype,"sdp",{get:function(){return this.originalDescription.sdp},set:function(e){this.originalDescription=new i.default.window.RTCSessionDescription({sdp:e,type:this.originalDescription.type})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.originalDescription.type},set:function(e){this.originalDescription=new i.default.window.RTCSessionDescription({sdp:this.originalDescription.sdp,type:e})},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return this.originalDescription.toJSON()},e}();t.SessionDescriptionAdapter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(237),r=n(238),o=n(239),a=n(108);t.WebkitAdapter=function(e){var t=r.default.build(e);this.SdpTransform=i.WebkitSdpTransform,this.RTCPeerConnection=o.default.build(t),this.RTCRtpReceiver={getCapabilities:t.gather},this.RTCSessionDescription=a.default.build()}},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(2),s=n(9),c=n(28),l=n(60),u=[48e3,32e3,24e3,16e3,12e3],d=function(){function e(e){this.cname=o.uniqueId(),this.dataMedia={type:a.default.MEDIA_TYPE.data,protocol:a.default.PROFILES.rtpSavp,port:0},this.configProvider=e.configProvider,this.isMultiparty=e.config.isConference}return e.prototype.fixTelephoneEvent=function(e){var t;return u.forEach(function(t){c.removeCodec(e,{codec:"telephone-event",rate:t})}),c.updatePayload(e,101,999),c.forCodec(e,{name:"telephone-event",rate:8e3},function(e){return t=e.rtp.payload,e.rtp.payload=101,e}),c.updatePayload(e,999,t||101),t},e.prototype.enforceFixedSsrc=function(e,t){var n=this,i=-1;if(e.ssrcs){var r=[];if(e.ssrcs.forEach(function(e){"msid"===e.attribute&&r.push({ssrc:e.id,trackId:m(e.value)})}),e.ssrcs.forEach(function(e){"cname"===e.attribute&&i++;var o=r.filter(function(t){return t&&t.ssrc===e.id})[0].trackId,a=t.filter(function(e){return e.trackId===o})[0];a&&(e.id=n.getVideoSSRC(i,a.ssrc))}),e.ssrcGroups){var o=e.ssrcs.filter(function(e){return"cname"===e.attribute}).map(function(e){return e.id});e.ssrcGroups.forEach(function(e,t){e.ssrcs=[o[2*t],o[2*t+1]].join(" ")})}}},e.prototype.toLocal=function(e,t,n){var i,r=this,a=o.deepClone(e);return a.media.forEach(function(e,o){"audio"===e.type?(n&&(i=r.fixTelephoneEvent(e)),f(e),v(e,r.isMultiparty?r.configProvider.config.allowedAudioCodecsMultiparty:r.configProvider.config.allowedAudioCodecs1on1,n)):(i&&c.updatePayload(e,101,i),r.enforceFixedSsrc(e,t.getLocalTracksInfo()),v(e,r.isMultiparty?r.configProvider.config.allowedVideoCodecsMultiparty:r.configProvider.config.allowedVideoCodecs1on1,n))}),new l.InjectH264SpsPpsIdrInKeyframe(this.configProvider).modify(a),a},e.prototype.toOffer=function(e,t,n){return this.fromNative(e,t,n,!0)},e.prototype.toAnswer=function(e,t,n){return this.fromNative(e,t,n,!1)},e.prototype.toRemote=function(e,t,n){var i,r,l=this,u=o.deepClone(e),d=this.configProvider.mediaConfig.maxBandwidthInKbps;u.bandwidth&&(!d||d>e.bandwidth[0].limit)&&(d=e.bandwidth[0].limit),u.media.forEach(function(e,n){t.getMediaEntity(n).isDisabled()&&e.type!==a.default.MEDIA_TYPE.audio&&(e.port=0)});var m=function(e){return e.groups?o.find(e.groups,function(e){return"BUNDLE"===e.type}):null}(u);if(!m){var v=!1;u.media.forEach(function(e,n){var i=t.getMediaEntity(n);!v&&i.isEnabled()?(e.mid=i.getMid(),v=!0):(i.disable(),e.port=0)}),v&&(u.groups||(u.groups=[]),m={type:"BUNDLE"},u.groups.push(m))}u.media.forEach(function(e){var t=c.getModality(e);n[t]===a.default.MEDIA_STATE.send&&(e.direction&&e.direction.toLowerCase()===a.default.MEDIA_STATE.receive||(e.direction=a.default.MEDIA_STATE.receive))});var y=u.media.filter(function(e){return e.type===a.default.MEDIA_TYPE.video});if(y.length>0){var S=y.filter(function(e){return 0!==e.port});if(S.length>0){(r=o.deepClone(S[0])).bandwidth&&delete r.bandwidth;var _=this.configProvider.config.audioBandwidthInKbps?this.configProvider.config.audioBandwidthInKbps:0;d&&d-_>0&&(r.bandwidth=[{limit:d-_,type:"AS"}]),r.mid="video",r.direction=null,delete r.label,r.ssrcs=[],r.ssrcGroups=[],delete r.msid,S.forEach(function(e){e.ssrcs&&(r.ssrcs=r.ssrcs.concat(e.ssrcs)),e.ssrcGroups&&(r.ssrcGroups=r.ssrcGroups.concat(e.ssrcGroups)),l.configProvider.config.webrtcEnabledTransportCC?function(e){e.rtcpFb||(e.rtcpFb=[]),e.rtcpFb.find(function(e){return"transport-cc"===e.type})||e.rtcpFb.filter(function(e){return"goog-remb"==e.type}).forEach(function(t){return e.rtcpFb.push({payload:t.payload,type:"transport-cc"})})}(r):p(r),r.direction=function(e,t){return e===a.default.MEDIA_STATE.sendReceive||t===a.default.MEDIA_STATE.sendReceive?a.default.MEDIA_STATE.sendReceive:e===t?e:e&&t&&e!==t?a.default.MEDIA_STATE.sendReceive:e||t}(r.direction,e.direction||a.default.MEDIA_STATE.sendReceive)})}else r=g(a.default.MEDIA_TYPE.video,void 0,y[0].protocol)}var E=o.find(u.media,function(e){return e.type===a.default.MEDIA_TYPE.audio});if(E)if(0!==E.port)(i=o.deepClone(E)).mid="audio",delete i.label,function(e){c.removeCodec(e,{codec:"g722",rate:8e3,encoding:2})}(i),f(i),function(e){var t=new Set(["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"]);e.ext&&(e.ext=e.ext.filter(function(e){return!t.has(e.uri)}))}(i);else{i=g(a.default.MEDIA_TYPE.audio,void 0,E.protocol);var T=o.find(u.media,function(e){return!!e.iceUfrag});T&&(i.port=9,i.direction="inactive",i.mid="audio",i.iceUfrag=T.iceUfrag,i.icePwd=T.icePwd,i.rtcpMux=!0,T.crypto&&(i.crypto=T.crypto),T.fingerprint&&(i.fingerprint=T.fingerprint,i.setup=T.setup),i.rtp=[{payload:0,codec:"PCMU",rate:8e3}],i.payloads="0")}u.media.forEach(function(e,t){e.type===a.default.MEDIA_TYPE.data&&(e.payloads===a.default.PAYLOAD_TYPE.DATA_CHANNEL?(e.mid="data",e.type=a.default.MEDIA_TYPE.dataChannel,e.protocol=a.default.PROFILES.udpDtlsSctp,0===e.port&&(u.media[t]=g(e.type,void 0,e.protocol))):u.media[t]=g(e.type,void 0,e.protocol))});var C=o.find(u.media,function(e){return e.type===a.default.MEDIA_TYPE.dataChannel});u.media=[i,r,C].filter(function(e){return e}),t.getMediaEntities()[0].getModality()!==a.default.MODALITY.audio&&u.media.reverse();var I=this.isMultiparty?this.configProvider.config.preferSdesSrtpMultiparty:this.configProvider.config.preferSdesSrtp1on1,A=s.getSrtpInfo(e);return u.media.forEach(function(e){e.type!==a.default.MEDIA_TYPE.dataChannel&&(!I&&e.fingerprint&&e.crypto&&delete e.crypto,e.protocol=!A.dtls||A.sdes&&I?a.default.PROFILES.rtpSavpf:a.default.PROFILES.udpTlsRtpSavpf)}),h(u,this.configProvider.mediaConfig.isTransportUnbundled),u},e.prototype.splitMedia=function(e,t,n,i){var s=this,l=e.getMid(),u=e.getModality(),d=o.deepClone(t);if(d.label=c.getLabelForModality(u),d.direction=i,d.mid=l,d.ssrcs=[],d.ssrcGroups=[],e.getModality()===a.default.MODALITY.data)return d.type=a.default.MEDIA_TYPE.data,d;var p=n.filter(function(e){return e.modality===u});if(p&&p.length){var f=[];t.ssrcs&&(p.forEach(function(e){var n=t.ssrcs.filter(function(t){return"msid"===t.attribute&&e.trackId===m(t.value)}).map(function(e){return e.id});f.push.apply(f,r(n))}),d.ssrcs=t.ssrcs.filter(function(e){return f.indexOf(e.id)>-1}),d.ssrcs.forEach(function(e){"cname"===e.attribute&&(e.value=s.cname)})),t.ssrcGroups&&(d.ssrcGroups=t.ssrcGroups.filter(function(e){var t=e.ssrcs.split(" ");return o.find(t,function(e){return f.indexOf(+e)>-1})}))}else{if(i===a.default.MEDIA_STATE.send||i===a.default.MEDIA_STATE.sendReceive)return g(t.type,c.getLabelForModality(u),t.protocol);i!==a.default.MEDIA_STATE.receive&&i!==a.default.MEDIA_STATE.inactive||(t.type===a.default.MEDIA_TYPE.audio?d.ssrcs=[{id:4195875351,attribute:"cname",value:this.cname}]:t.type===a.default.MEDIA_TYPE.video&&(d.ssrcs=[{id:1,attribute:"cname",value:this.cname}]))}return d},e.prototype.fromNative=function(e,t,n,i){var r=this,s=o.deepClone(e),u=this.configProvider.mediaConfig.maxBandwidthInKbps;u&&(s.bandwidth=[{limit:u,type:"CT"}]),new l.RemoveH264SpsPpsIdrInKeyframe(this.configProvider).modify(s);var d=o.find(s.media,function(e){return e.type===a.default.MEDIA_TYPE.audio}),f=o.find(s.media,function(e){return e.type===a.default.MEDIA_TYPE.video}),m=o.find(s.media,function(e){return e.type===a.default.MEDIA_TYPE.dataChannel}),v={};v[a.default.MODALITY.audio]=d,v[a.default.MODALITY.video]=f,v[a.default.MODALITY.sharing]=f,v[a.default.MODALITY.data]=m||this.dataMedia;var y={};return y[a.default.MODALITY.audio]=t.getMediaEntitiesByModality(a.default.MODALITY.audio)[0],y[a.default.MODALITY.video]=t.getMediaEntitiesByModality(a.default.MODALITY.video)[0],y[a.default.MODALITY.sharing]=t.getMediaEntitiesByModality(a.default.MODALITY.sharing)[0],y[a.default.MODALITY.data]=t.getMediaEntitiesByModality(a.default.MODALITY.data)[0],s.media=[],t.getMediaEntities().forEach(function(e){var o,l=n[e.getModality()];!e.isEnabled()||0===v[e.getModality()].port||e!==y[e.getModality()]&&l===a.default.MEDIA_STATE.send?(o=g(e.getType(),c.getLabelForModality(e.getModality()),v[e.getModality()].protocol),v[e.getModality()].payloads===a.default.PAYLOAD_TYPE.DATA_CHANNEL&&(o.payloads=a.default.PAYLOAD_TYPE.DATA_CHANNEL)):(l!==a.default.MEDIA_STATE.inactive&&e!==y[e.getModality()]&&(l=a.default.MEDIA_STATE.receive),o=r.splitMedia(e,v[e.getModality()],t.getLocalTracksInfo(),l),e!==y[e.getModality()]&&(o.candidates=[]));var u=v[e.getModality()].setup;u&&("actpass"!==u?e.setExtension("setup",u):i&&void 0!==e.getExtension("setup")&&(o.setup="actpass"!==e.getExtension("setup")?e.getExtension("setup"):u));var d=v[e.getModality()].iceUfrag,f=e.getExtension("iceUfrag");e.setExtension("iceRestart",!!d&&!!f&&f!==d),e.setExtension("iceUfrag",d),0===o.port&&e.disable(),r.configProvider.config.webrtcEnabledTransportCC||p(o),s.media.push(o)}),h(s,this.configProvider.mediaConfig.isTransportUnbundled),s},e.prototype.getVideoSSRC=function(e,t){return e%2==1?t+50:t},e}();function p(e){e.ext&&(e.ext=e.ext.filter(function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"!==e.uri})),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter(function(e){return"transport-cc"!==e.type}))}function f(e){c.removeCodec(e,{codec:"CN",rate:16e3})}function h(e,t){var n=o.findIndex(e.groups||[],function(e){return"BUNDLE"===e.type}),i=e.groups?e.groups[n]:void 0;i&&(t?(i.mids=e.media.filter(function(e){return e.type===a.default.MEDIA_TYPE.video}).map(function(e){return e.mid}).filter(function(e){return e}).join(" "),i.mids||delete e.groups[n]):i.mids=e.media.map(function(e){return e.mid}).filter(function(e){return e}).join(" "))}function g(e,t,n){return{type:e,port:0,label:t,payloads:"36",protocol:n}}function m(e){return e.split(" ")[1]}function v(e,t,n){if(t.length&&e.port){var i=t.map(function(e){var t=e.mimeType.split("/"),n={codec:t[1]||t[0],rate:e.clockRate};return e.channels&&(n.encoding=e.channels),e.sdpFmtpLine&&(n.fmtpLine=e.sdpFmtpLine),n});c.filterCodecs(e,i,n)}}t.WebkitSdpTransform=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),r=n(12);t.default={build:function(e){return new function(e){var t,n=r.default.window.webkitRTCPeerConnection;this.gather=function(e){return"video"!==e&&"audio"!==e?Promise.reject(new Error("capabilities for "+e+" are not supported")):(t.gatherTask||(t.gatherTask=new Promise(function(e,r){var o=new n(null);o.createOffer(function(t){var n={};return i.parse(t.sdp).media.forEach(function(e){n[e.type]=e.rtp.map(function(e){return{mimeType:e.codec.toLowerCase()}})}),o.close(),e(n)},function(e){t.gatherTask=null,o.close(),r(e)},{offerToReceiveVideo:1,offerToReceiveAudio:1})})),t.gatherTask.then(function(t){return{codecs:t[e]}}))},t=e.global.webkitCapabilityGatherer=e.global.webkitCapabilityGatherer||{},this.gather("video")}(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),r=n(30),o=n(12),a=n(0),s=n(28),c=n(108),l=[{name:"telephone-event",rate:8e3},{name:"cn",rate:16e3}];function u(e){var t,n,u,d=[];function p(){n.getSenders&&n.addTrack&&n.removeTrack||(n.getSenders=function(){return d.slice()},n.addTrack=function(e,t){if(!e||!t)throw new Error("both media track and stream need to be provided");n.getLocalStreams().some(function(e){return e.id===t.id})||n.addStream(t);var i=a.find(d,function(t){return t.track.id===e.id});return i||(i=new function(e,t){var i;Object.defineProperty(this,"dtmf",{get:function(){return"audio"===e.kind?i=i||n.createDTMFSender(e):null}}),this.track=e,this._stream=t}(e,t),d.push(i)),i},n.removeTrack=function(e){n.getLocalStreams().filter(function(t){return t.id===e._stream.id}).forEach(function(e){n.removeStream(e)}),a.remove(d,function(t){return t===e})})}function f(e){s.forCodec(e,{name:"h264",rate:9e4},function(e){if(e.fmtp){var t=r.default.build(),n=r.default.build(e.fmtp.config);["level-asymmetry-allowed","packetization-mode","profile-level-id"].forEach(function(e){if(n.contains(e)){var i=n.get(e);"profile-level-id"==e&&(i="42C02A"),t.setIfMissing(e,i)}}),e.fmtp.config=t.toString()}})}return u=c.default.build(),(t=[].slice.apply(arguments)).splice(0,1,null),function(e,n){t[1]&&t[1][e]&&(t[1][n]=t[1][e])}("iceTransportPolicy","iceTransports"),n=new(Function.prototype.bind.apply(o.default.window.webkitRTCPeerConnection,t)),[{name:"createOffer",reverseArgs:!0},"createAnswer","setRemoteDescription","setLocalDescription"].forEach(function(e){var t=e.name||e,i=n[t];n[t]=function(){var t=arguments;return new Promise(function(r,o){var a=[r,o];t.length>0&&a.splice(e.reverseArgs?a.length:0,0,t[0]),i.apply(n,a)})}}),function(){["createOffer","createAnswer","setLocalDescription"].forEach(function(t){var i=n[t];n[t]=function(){var t=arguments;return e.gather("video").then(function(){return i.apply(i,t)})}});var t=n.setRemoteDescription;n.setRemoteDescription=function(n){return e.gather("video").then(function(e){var r=e.codecs,o=i.parse(n.sdp);return o.media.forEach(function(e){if("video"===e.type&&(e.rtp.some(function(e){return r.some(function(t){return e.codec.toLowerCase()===t.mimeType})})?f(e):e.port=0),!function(e){return"RTP/SAVPF"!==e.protocol}(e)){var t=s.getBundle(o);t?e.crypto=t.crypto:e.port||o.media.some(function(t){return!!t.port&&(e.crypto=t.crypto,!0)})}}),n.sdp=i.write(o),t(n)})}}(),function(){var e=n.createAnswer;n.createAnswer=function(){var t=arguments;return e.apply(n,t).then(function(e){if(!n.localDescription||!n.localDescription.sdp)return e;var t=i.parse(n.localDescription.sdp),r=[];if(t.media.forEach(function(e){l.forEach(function(t){s.forCodec(e,t,function(e){r.push(e)})})}),r.length){var o=i.parse(e.sdp),a=!1;o.media.forEach(function(e){r.forEach(function(t){s.forCodec(e,{name:t.rtp.codec,rate:t.rtp.rate},function(e){e.rtp.payload!==t.rtp.payload&&(e.rtp.payload=t.rtp.payload,a=!0)})})}),a&&(e=new u({type:e.type,sdp:i.write(o)}))}return e})}}(),function(){var e=n.createOffer;n.createOffer=function(t){var i=arguments;return t&&t.offerToReceiveVideo>1&&(t.offerToReceiveVideo=1),e.apply(n,i)}}(),p(),n}t.default={build:function(e){return u.bind(null,e)}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(21),l=n(55),u=n(92),d=n(0),p=n(2),f=n(241),h=function(){function e(e,t,n,i,r,o){this.listener=e,this.statisticsProvider=t,this.logger=n,this.configProvider=i,this.isSimulcastEnabled=o,this.serialQueue=new c.PromiseQueue(this.logger),this.modality=p.default.MODALITY.video;var a=r.maxResolution?{maxFs:r.maxResolution.fs}:null;this.validator=new u.VideoCapabilitiesValidator(this.logger.createChild("CapsValidator"),a),this.resolutionManager=new f.ResolutionManager(r,this,this.statisticsProvider,this.logger.createChild("rm"),i)}return e.prototype.setMaxCapabilities=function(e,t){return a(this,void 0,void 0,function(){var n;return s(this,function(r){switch(r.label){case 0:return this.statisticsProvider.onMaxCapabilitiesRequested({modality:this.modality,causeId:e,capabilities:t,isSimulcastEnabled:this.isSimulcastEnabled}),this.causeId=e,n=this.validator.ensureValidity(t[0]),this.streamSenderParams=i({},t[0],n),this.resolutionManager.setMaxResolution(this.streamSenderParams.maxFs),this.configProvider.config.webrtcSimulcastSessionEnabled?[4,this.applyCapabilities(this.getParamsToApply())]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},e.prototype.resetCurrentResolution=function(){this.resolutionManager.resetCurrentResolution()},e.prototype.getCurrentResolution=function(){return this.resolutionManager.getCurrentResolution()},e.prototype.setCurrentResolution=function(e){this.resolutionManager.setCurrentResolution(e)},e.prototype.dispose=function(){this.resolutionManager.dispose(),this.resolutionManager=null},e.prototype.applyCapabilities=function(e){return a(this,void 0,void 0,function(){return s(this,function(t){return e?this.lastAppliedSenderParams===e?(this.logger.safe.info("Capabilities already applied: "+JSON.stringify(e)),[2,!0]):(this.logger.safe.info("Capabilities to apply: "+JSON.stringify(e)),this.lastAppliedSenderParams=e,[2,this.listener.onReceiveCapabilitiesChanged(this.modality,this.causeId,[e])]):(this.logger.safe.error("Send capabilities are not set. Cannot apply constraints"),[2,!1])})})},e.prototype.getParamsToApply=function(e){if(!this.streamSenderParams)return null;var t=e||this.resolutionManager.getCurrentResolution();if(!t||this.streamSenderParams.maxFs<=t)return this.streamSenderParams;var n=d.shallowClone(this.streamSenderParams);return n.maxFs=t,n},e.prototype.onResolutionChanged=function(e){return a(this,void 0,void 0,function(){return s(this,function(t){return[2,this.applyCapabilities(this.getParamsToApply(e))]})})},r([l.sequentialize(),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],e.prototype,"applyCapabilities",null),e}();t.AdaptiveCapablitiesHandler=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),r=function(){function e(e,t,n,r,o){var a=this;this.settings=e,this.listener=t,this.provider=n,this.logger=r,this.lastSendBW=0,this.coolingDown=!1,this.cooldownTimer=null,this.cooldownEnd=0,this.active=!1,this.resolutionTable=new i.default(o),this.maxResolution=this.settings.maxResolution,this.settings.scalingEnabled?(this.active=!0,this.statsSubscription=this.provider.on("onStatisticsChanged",function(e){return a.onStatisticsChanged(e)})):this.logger.safe.info("Resolution management disabled: no resolution management for 1x1 calls")}return e.prototype.dispose=function(){this.currentResolution=null,this.pendingResolution=null,this.maxResolution=null,this.listener=null,this.active=!1,clearTimeout(this.cooldownTimer),this.cooldownTimer=null,this.statsSubscription&&(this.statsSubscription.dispose(),this.statsSubscription=null),this.provider=null,this.listener=null},e.prototype.setMaxResolution=function(e){var t=this.resolutionTable.getResolution(e);t!==this.maxResolution&&(this.logger.safe.info("Setting max resolution: "+t),this.maxResolution=t,this.lastSendBW&&this.processEstimatedBandwidth(this.lastSendBW))},e.prototype.resetCurrentResolution=function(){this.currentResolution=null},e.prototype.getCurrentResolution=function(){return this.currentResolution&&this.currentResolution.fs},e.prototype.setCurrentResolution=function(e){this.currentResolution=e},e.prototype.applyRes=function(e){var t=this;this.pendingResolution=e,this.coolingDown&&(!this.currentResolution||e.fs>this.currentResolution.fs)||(this.coolingDown=!0,this.logger.safe.info("Changing resolution to "+e),this.listener&&this.listener.onResolutionChanged(e.fs).then(function(n){n?(e===t.pendingResolution&&(t.pendingResolution=null),t.coolingDown&&!t.currentResolution&&(t.coolingDown=!1),t.currentResolution=e,t.cooldown()):(t.logger.safe.info("Unable to apply resolution at the moment"),t.cooldown(5e3))}).catch(function(e){t.logger.safe.error("Error while applying new resolution: "+JSON.stringify(e)),t.pendingResolution=null}))},e.prototype.cooldown=function(e){var t=this;void 0===e&&(e=15e3),!this.active||this.coolingDown&&this.cooldownEnd-Date.now()>15e3||(this.cooldownTimer&&clearTimeout(this.cooldownTimer),this.coolingDown=!0,this.cooldownEnd=Date.now()+15e3,this.cooldownTimer=setTimeout(function(){t.logger.safe.debug("Resolution changer cooled down"),t.coolingDown=!1,t.cooldownTimer=null,t.pendingResolution?t.proposeResolution(t.pendingResolution):t.processEstimatedBandwidth(t.lastSendBW)},e))},e.prototype.proposeResolution=function(e){var t=e;this.maxResolution&&this.maxResolution.fs<t.fs&&(t=this.maxResolution),this.currentResolution&&t.fs===this.currentResolution.fs||this.applyRes(t)},e.prototype.processEstimatedBandwidth=function(e){var t=this.resolutionTable.getResolutionForBitrate(e),n=t.lowRes,i=t.highRes,r=e<this.lastSendBW?i:n;e<this.lastSendBW&&r&&this.currentResolution&&this.currentResolution.fs<r.fs||(r&&this.proposeResolution(r),this.lastSendBW=e)},e.prototype.onStatisticsChanged=function(e){var t=e.estimatedSendBandwidth;t!==this.lastSendBW&&(this.logger.safe.debug("Send BW: "+t),this.processEstimatedBandwidth(t))},e}();t.ResolutionManager=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(0),s=function(e){function t(t,n,i,r){var o=e.call(this)||this;return o.statsProvider=t,o.optimalReceiversCount=n,o.logger=i,o.settings=r,o.bandwidthEstimationAvailable=!1,o.slidingWindow=[],o.subs=o.statsProvider.on("onStatisticsChanged",function(e){return o.onStatisticsChanged(e)}),o}return r(t,e),t.prototype.dispose=function(){this.subs.dispose(),this.subs=null},t.prototype.onStatisticsChanged=function(e){this.processEstimatedBandwidth(e.estimatedReceiveBandwidth)},t.prototype.sample=function(e){if(this.slidingWindow.length>=this.settings.slidingWindowSamples?this.slidingWindow.shift():this.slidingWindow.length===this.settings.slidingWindowSamples-1&&(this.slidingWindow=this.slidingWindow.map(function(t){return e})),this.slidingWindow.push(e),this.slidingWindow.length>=this.settings.slidingWindowSamples){var t=this.slidingWindow.slice().sort(),n=a.average(t);return t[t.length-1]-(t[t.length-1]-n*(1-this.settings.slidingWindowPercentile))}return e},t.prototype.processOptimalReceiversCount=function(){if(!(this.bandwidth<0)){this.bandwidth>0&&!this.bandwidthEstimationAvailable&&(this.bandwidthEstimationAvailable=!0);var e=Math.floor(this.sample(this.bandwidth)/this.settings.bandwidthPerVideoReceiver);0!==e||this.bandwidthEstimationAvailable||(e=this.settings.nonEstimatedDefaultVideoReceiversCount),this.optimalReceiversCount!==Math.max(e,1)&&(e?this.logger.safe.info("optimal video receivers count changed to "+e):(this.logger.safe.warn("there is not enough bandwidth even for a single video receiver"),e=1),this.optimalReceiversCount=e,this.event("onOptimalReceiversCountChanged").raise(this.optimalReceiversCount))}},t.prototype.processEstimatedBandwidth=function(e){this.bandwidth=e,this.processOptimalReceiversCount()},t}(o.default);t.OptimalReceiversCountCalculator=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,i){this.modality=e,this.listener=t,this.statistics=n,this.isSimulcastEnabled=i}return e.prototype.setMaxCapabilities=function(e,t){this.statistics.onMaxCapabilitiesRequested({modality:this.modality,causeId:e,capabilities:t,isSimulcastEnabled:this.isSimulcastEnabled}),this.listener.onReceiveCapabilitiesChanged(this.modality,e,t)},e.prototype.dispose=function(){},e.prototype.resetCurrentResolution=function(){},e.prototype.getCurrentResolution=function(){return null},e.prototype.setCurrentResolution=function(e){},e}();t.DirectCapabilitiesHandler=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,i){var r=e.call(this)||this;return r.configProvider=t,r.statsProvider=n,r.logger=i,r.lastReportedAgo=1/0,r._forceUpdate=!1,r.subs=r.statsProvider.on("onStatisticsChanged",function(e){return r.onStatisticsChanged(e)}),r}return r(t,e),t.prototype.forceUpdate=function(){this._forceUpdate=!0},t.prototype.dispose=function(){this.subs.dispose(),this.subs=null},t.prototype.onStatisticsChanged=function(e){this._forceUpdate?this.updateBandwidth(e.estimatedSendBandwidth):this.processEstimatedBandwidth(e.estimatedSendBandwidth)},t.prototype.processEstimatedBandwidth=function(e){if(this.lastReportedAgo++,e&&this.bandwidth!==e){var t=this.configProvider.config.webrtcSendBandwidthIgnoredUpdateLimit,n=this.configProvider.config.webrtcSendBandwidthThreshold,i=this.lastReportedAgo===1/0,r=!t&&!n,o=t&&this.lastReportedAgo>=t,a=n&&Math.abs((e-this.bandwidth)/this.bandwidth)>=n;(i||r||o||a)&&this.updateBandwidth(e)}},t.prototype.updateBandwidth=function(e){this.bandwidth=e,this.logger.safe.info("Updating send bandwidth: "+this.bandwidth),this.notifySendBandwidthChanged()},t.prototype.notifySendBandwidthChanged=function(){this._forceUpdate=!1,this.event("onSendBandwidthChanged").raise(this.bandwidth),this.lastReportedAgo=0},t}(n(6).default);t.SendBandwidthCalculator=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){this.googCandidatePair={},this.ssrc={},this.googComponent={},this.VideoBwe={bweforvideo:{}}},o=function(){function e(){this.statistics=new r,this.previousFrameRates=new Map}return e.prototype.constructGoogSsrc=function(e){var t=this,n={};if(e.hasOwnProperty("outbound-rtp")){var i=e["outbound-rtp"];Object.keys(i).forEach(function(r){var o="ssrc_"+i[r].ssrc+"_send",a=t.constructSendSsrc(e,i[r]);n[o]=a})}if(e.hasOwnProperty("inbound-rtp")){var r=e["inbound-rtp"];Object.keys(r).forEach(function(i){var o="ssrc_"+r[i].ssrc+"_recv",a=t.constructRecvSsrc(e,r[i]);n[o]=a})}this.statistics.ssrc=n},e.prototype.constructSendSsrc=function(e,t){var n=t.trackId?e.track[t.trackId]:null,r={id:"ssrc_"+t.ssrc+"_send",ssrc:t.ssrc,mediaType:t.mediaType,bytesSent:t.bytesSent,packetsSent:t.packetsSent,packetsLost:this.getStreamSendParam(e,t.ssrc,"packetsLost"),googRtt:Math.round(1e3*this.getStreamSendParam(e,t.ssrc,"roundTripTime")),googCodecName:this.getCodec(e,t.codecId),transportId:t.transportId,googTrackId:n?n.trackIdentifier:void 0,audioInputLevel:this.getSourceParam(e,t,"audio","audioLevel"),totalAudioEnergy:this.getSourceParam(e,t,"audio","totalAudioEnergy"),framesEncoded:t?t.framesEncoded:void 0,googFrameRateEncoded:t&&t.framesEncoded?this.calculateFrameRate(i.default.MEDIA_DIRECTION.SEND,t.framesEncoded,2):void 0,googFrameRateSent:n&&n.framesSent?this.calculateFrameRate(i.default.MEDIA_DIRECTION.SEND,n.framesSent,1):void 0,googFrameRateInput:this.getSourceParam(e,t,"video","framesPerSecond"),googFrameHeightSent:n?n.frameHeight:void 0,googFrameWidthSent:n?n.frameWidth:void 0,googFrameHeightInput:this.getSourceParam(e,t,"video","height"),googFrameWidthInput:this.getSourceParam(e,t,"video","width"),hugeFramesSent:n?n.hugeFramesSent:void 0,keyFramesEncoded:t?t.keyFramesEncoded:void 0,qpSum:t.qpSum,googPlisReceived:t.pliCount,googFirsReceived:t.firCount,googNacksReceived:t.nackCount};return this.removeUndefinedFields(r),r},e.prototype.constructRecvSsrc=function(e,t){var n=t.trackId?e.track[t.trackId]:null,i={id:"ssrc_"+t.ssrc+"_recv",ssrc:t.ssrc,mediaType:t.mediaType,bytesReceived:t.bytesReceived,packetsReceived:t.packetsReceived,packetsLost:t.packetsLost,googJitterBufferMs:Math.round(1e3*t.jitter),googCodecName:this.getCodec(e,t.codecId),googTrackId:n?n.trackIdentifier:void 0,transportId:t.transportId,audioOutputLevel:this.getAudioRecvParam(n,t.mediaType,"audioLevel"),totalAudioEnergy:this.getAudioRecvParam(n,t.mediaType,"totalAudioEnergy"),framesDecoded:t?t.framesDecoded:void 0,googFrameRateDecoded:t&&t.framesDecoded?this.calculateFrameRate(t.trackId,t.framesDecoded,3):void 0,googFrameRateReceived:n&&n.framesReceived?this.calculateFrameRate(t.trackId,n.framesReceived,0):void 0,googFrameHeightReceived:n?n.frameHeight:void 0,googFrameWidthReceived:n?n.frameWidth:void 0,qpSum:t.qpSum,googPlisSent:t.pliCount,googFirsSent:t.firCount,googNacksSent:t.nackCount};return this.removeUndefinedFields(i),i},e.prototype.constructGoogCandidatePair=function(e){var t=this,n=e["candidate-pair"];n&&Object.keys(n).forEach(function(i){var r=t.constructPair(e,n[i]);t.statistics.googCandidatePair[r.id]=r})},e.prototype.constructPair=function(e,t){var n=e["local-candidate"][t.localCandidateId],i=e["remote-candidate"][t.remoteCandidateId],r={bytesReceived:t.bytesReceived,bytesSent:t.bytesSent,googTransportType:n.protocol,googRtt:Math.round(1e3*t.currentRoundTripTime),googLocalAddress:(n.ip?n.ip:n.address)+":"+n.port,googLocalCandidateType:n.candidateType,googRemoteAddress:(i.ip?i.ip:i.address)+":"+i.port,googRemoteCandidateType:i.candidateType,googActiveConnection:t.nominated,requestsReceived:t.requestsReceived,requestsSent:t.requestsSent,responsesReceived:t.responsesReceived,responsesSent:t.responsesSent,consentRequestsSent:t.consentRequestsSent,id:t.id,remoteCandidateId:t.remoteCandidateId,localCandidateId:t.localCandidateId,googWritable:t.writable};return this.removeUndefinedFields(r),r},e.prototype.constructGoogComponent=function(e){var t=this;e.transport&&Object.keys(e.transport).forEach(function(n){t.statistics.googComponent[n]={id:n,selectedCandidatePairId:e.transport[n].selectedCandidatePairId}})},e.prototype.constructVideoBwe=function(e){var t=e["outbound-rtp"],n=e["candidate-pair"];if(t&&n){var i=null;if(Object.keys(t).forEach(function(n){"video"===t[n].mediaType&&e.transport&&!i&&(i=e.transport[t[n].transportId])}),i&&n[i.selectedCandidatePairId]){var r={googAvailableSendBandwidth:n[i.selectedCandidatePairId].availableOutgoingBitrate,googAvailableReceiveBandwidth:n[i.selectedCandidatePairId].availableIncomingBitrate};this.removeUndefinedFields(r),this.statistics.VideoBwe.bweforvideo=r}}},e.prototype.getStreamSendParam=function(e,t,n){var i,r=e["remote-inbound-rtp"];return r&&Object.keys(r).forEach(function(e){r[e].ssrc===t&&(i=r[e][n])}),i},e.prototype.getCodec=function(e,t){if(t&&e.codec&&e.codec[t])return e.codec[t].mimeType.split("/")[1]},e.prototype.getSourceParam=function(e,t,n,i){var r,o=e["media-source"];return o&&t.mediaSourceId&&t.mediaType===n&&o[t.mediaSourceId]&&(r=o[t.mediaSourceId][i]),r},e.prototype.getAudioRecvParam=function(e,t,n){var i;return e&&"audio"===t&&(i=e[n]),i},e.prototype.calculateFrameRate=function(e,t,n){var i=t,r=this.previousFrameRates.has(e)?this.previousFrameRates.get(e):new Map;if(r.has(n)){var o=r.get(n);o<=t&&(i=t-o)}return r.set(n,t),this.previousFrameRates.set(e,r),isNaN(i)?void 0:i},e.prototype.removeUndefinedFields=function(e){Object.keys(e).forEach(function(t){void 0===e[t]&&delete e[t]})},e.prototype.build=function(e){return this.statistics=new r,this.constructGoogCandidatePair(e),this.constructGoogSsrc(e),this.constructGoogComponent(e),this.constructVideoBwe(e),this.statistics},e}();t.default=o},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function o(e){var t="";return e.dtls&&(t+="dtls"),e.sdes&&(t+="sdes"),t}var a=function(){function e(){this.info={OfferedSrtp:"none",NegotiatedSrtp:"none",IceConnectionState:"none",IceConnectionStatePrevious:"none",SignalingState:"none",SignalingStatePrevious:"none",RelayCandidate:"none",IceTransportPolicy:"none",IceServers:"none",FakeIceCandidate:!1}}return e.prototype.setOfferedModalities=function(e){this.offeredModalities=e,this.activeModalities=e},e.prototype.setNegotiatedModalities=function(e){this.negotiatedModalities=e,this.activeModalities=e},e.prototype.setNegotiatedSrtpInfo=function(e){this.info.NegotiatedSrtp=o(e)},e.prototype.setOfferedSrtpInfo=function(e){this.info.OfferedSrtp=o(e)},e.prototype.setIceConnectionState=function(e){this.info.IceConnectionStatePrevious=this.info.IceConnectionState,this.info.IceConnectionState=e},e.prototype.setSignalingConnectionState=function(e){this.info.SignalingStatePrevious=this.info.SignalingState,this.info.SignalingState=e},e.prototype.setRelayCandidateInfo=function(e){this.info.RelayCandidate=JSON.stringify(e)},e.prototype.fillExtensionInfo=function(e){r.assign(e,this.info)},e.prototype.setIceTransportPolicy=function(e){this.info.IceTransportPolicy=e},e.prototype.setIceServers=function(e){var t=e.map(function(e){var t=i({},e);return t.username&&(t.username="true"),t.credential&&(t.credential="true"),t});this.info.IceServers=JSON.stringify(t)},e.prototype.setFakeIceCandidate=function(e){this.info.FakeIceCandidate=e},e}();t.default=a},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(2),s=n(9),c=n(248),l=n(117),u=n(260),d=n(261),p=["googFrameHeightReceived","googFrameWidthReceived","googFrameHeightSent","googFrameWidthSent","googFrameRateInput","googFrameRateSent","googNacksSent","googNacksReceived","googPlisSent","googPlisReceived","googFirsSent","googFirsReceived","framesDecoded","googFrameRateDecoded","googFrameRateReceived","framesEncoded","packetsLost","packetsSent","packetsReceived","bytesReceived","bytesSent","googEncodeUsagePercent","audioInputLevel","audioOutputLevel","googDecodingCTN","googDecodingPLC"],f=["bytesSent","bytesReceived","googRtt","packetsSent","requestsSent","consentRequestsSent","responsesSent","requestsReceived","responsesReceived"],h=["googAvailableReceiveBandwidth","googAvailableSendBandwidth","googTransmitBitrate"],g=function(){function e(e,t,n,i){this.logger=e,this.sessionInfo=t,this.configProvider=n,this.mediaManager=i,this.statsErrors=[],this.subscribedTrackIds=[],this.rawScreenshareAudioInput=[],this.iceCandidateErrors=[],this.terminated=!1,this.hwSilent=!1,this.isSpeaking=!1,this.networkSendLevel="Good",this.networkRecvLevel="Good",this.audioTelemetry=new c.default,this.cameraOpenResolution={width:0,height:0},this.subscribedTrackSsrc=[],this.multiViewVideoTelemetry={},this.extensions={WebRTCStats:{},AudioTransportRecvBitrate:0,AudioTransportSendBitrate:0,AudioPayloadSendBitrate:0,AudioPayloadRecvBitrate:0,VideoPayloadSendBitrate:0,VideoPayloadRecvBitrate:0,TimerAudioTransportRecvBitrate:0,TimerAudioTransportSendBitrate:0,TimerAudioPayloadRecvBitrate:0,TimerAudioPayloadSendBitrate:0,TimerVideoPayloadRecvBitrate:0,TimerVideoPayloadSendBitrate:0,StartTime:Date.now(),EndTime:Date.now(),Audio_recv_jitterBufferAvgSize:0,MaxSessionBandwidth:0},this.report={type:"WebRtcMediaStats",data:{Extensions:this.extensions}},this.videoTelemetry=new l.default(this.extensions.StartTime,this.configProvider,this.logger.createChild("Video")),this.sharingTelemetry=new l.default(this.extensions.StartTime,this.configProvider,this.logger.createChild("Sharing")),this.bandwidthTelemetry=new d.WebRTCBandwidthTelemetry(this.configProvider.config.webrtcBWJumpLowerLimit,this.configProvider.config.webrtcBWJumpLowerLimit),this.storedRecordsNumber=Number(this.configProvider.config.webrtcStatStoredRecordsNumber),this.hwSilentDetectionDuration=Number(this.configProvider.config.webrtcStatHwSilentDetectionDuration),this.hwSilentDetectionLevel=Number(this.configProvider.config.webrtcStatHwSilentDetectionLevel),this.networkDetectionDuration=Number(this.configProvider.config.webrtcStatNetworkDetectionDuration);var r=Number(this.configProvider.config.webrtcStatNetworkDetectionHysteresis);this.networkDetectionBadLevelHigh=Number(this.configProvider.config.webrtcStatNetworkDetectionBadLevel)+r/2,this.networkDetectionBadLevelLow=this.networkDetectionBadLevelHigh-r,this.networkDetectionGoodLevelHigh=Number(this.configProvider.config.webrtcStatNetworkDetectionGoodLevel)+r/2,this.networkDetectionGoodLevelLow=this.networkDetectionGoodLevelHigh-r,this.speakingWhileMutedBadDuration=Number(this.configProvider.config.webrtcSpeakingWhileMutedBadDuration),this.speakingWhileMutedDetectionLevel=Number(this.configProvider.config.webrtcSpeakingWhileMutedDetectionLevel),this.videoDelayTimePeriod=this.configProvider.config.webrtcVideoDelayThreshold,this.maxStoredPreferredResolutions=this.configProvider.config.maxStoredPreferredResolutionCount,this.simulcastVideo=new u.default(this.logger.createChild("simulcastVideo"),this.configProvider),this.simulcastSharing=new u.default(this.logger.createChild("simulcastSharing"),this.configProvider)}return Object.defineProperty(e.prototype,"currentVideoRecvTrackId",{get:function(){return this.extensions.WebRTCStats.ssrc_video_recv&&this.extensions.WebRTCStats.ssrc_video_recv.googTrackId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentSharingRecvTrackId",{get:function(){return this.extensions.WebRTCStats.ssrc_sharing_recv&&this.extensions.WebRTCStats.ssrc_sharing_recv.googTrackId},enumerable:!0,configurable:!0}),e.prototype.setLayouts=function(e,t){switch(e){case"Video":this.simulcastVideo.setActiveLayouts(t);break;case"ScreenShare":this.simulcastSharing.setActiveLayouts(t);break;default:this.logger.safe.warn("Simulcast telemetry for media type "+e+" not found")}},e.prototype.onDeviceEvent=function(e){if("stream_acquired"===e.eventType){var t=e.payload;"Video"===t.mediaType&&(this.cameraOpenResolution=t.resolution)}},e.prototype.onMaxCapabilitiesRequested=function(e){(e.modality===a.default.MODALITY.video?this.videoTelemetry:this.sharingTelemetry).setMaxCapabilitesRequested(e),(e.modality===a.default.MODALITY.video?this.simulcastVideo:this.simulcastSharing).setMaxCapabilities(e.capabilities)},e.prototype.onMaxCapabilitiesApplied=function(e){(e.modality===a.default.MODALITY.video?this.videoTelemetry:this.sharingTelemetry).setMaxCapabilitesApplied(e),(e.modality===a.default.MODALITY.video?this.simulcastVideo:this.simulcastSharing).setMaxCapabilities(e.capabilities)},e.prototype.setSubscribedTrackIds=function(e){this.subscribedTrackIds=e||[]},e.prototype.setSubscribedTrackSsrc=function(e){this.subscribedTrackSsrc=e||[]},e.prototype.setRawScreenshareAudioInput=function(e){this.rawScreenshareAudioInput=this.rawScreenshareAudioInput.length?r(this.rawScreenshareAudioInput,e):e,this.rawScreenshareAudioInput.length>this.storedRecordsNumber&&(this.rawScreenshareAudioInput=this.rawScreenshareAudioInput.slice(-this.storedRecordsNumber))},e.prototype.addSubscriptionEvent=function(e,t,n){var i={evt:e,ts:Date.now()-this.extensions.StartTime,msi:n},r=this.getHandlerForModality(t);r.addSubscriptionEvent(i);var o=1===e;r.startStopRecvDataGathering(o)},e.prototype.getHandlerForModality=function(e){switch(e){case a.default.MODALITY.video:return this.videoTelemetry;case a.default.MODALITY.sharing:return this.sharingTelemetry;default:throw new Error("Handler not found for modality: "+e)}},e.prototype.setTerminated=function(){this.extensions.EndTime=(new Date).getTime(),this.terminated=!0},e.prototype.startWaitingForStreamStart=function(e,t){this.streamStartDetection||this.sessionInfo.setOfferedModalities(e),this.streamStartDetection=!0},e.prototype.processStatsDict=function(e){try{this.extensions.WebRTCStats.hasStatsError=!1;try{this.simulcastVideo.processStats(e),this.simulcastSharing.processStats(e)}catch(e){this.processStatsError(e)}if(this.configProvider.config.enableMultiViewStats){var t=this.extensions.WebRTCStats[a.default.MULTIPLE_RECV_STREAMS]?this.extensions.WebRTCStats[a.default.MULTIPLE_RECV_STREAMS]:{};for(var n in this.constructWebRtcReportForMultipleStreams(t,e),t){var i=t[n];this.processVideoStatsRecv(this.multiViewVideoTelemetry[n],i)}this.extensions.WebRTCStats[a.default.MULTIPLE_RECV_STREAMS]=t}this.constructWebRtcReportForSingleStream(this.extensions.WebRTCStats,e),this.streamStartDetection&&(this.setStartTime(this.sessionInfo.offeredModalities)||this.terminated)&&(this.streamStartDetection=!1),this.calculateHwSilentState(),this.calculateSpeakingState(),this.calculateNetworkQualityLevels(),this.sessionInfo.activeModalities&&(this.processBandwidthStats(),this.processAudioStats(),this.processVideoStatsRecv(this.videoTelemetry,this.extensions.WebRTCStats.ssrc_video_recv),this.processVideoStatsSend(this.videoTelemetry,this.extensions.WebRTCStats.ssrc_video_send),this.processSharingStats(),this.processStreamsCounters()),this.extensions.WebRTCStats.statsErrors=JSON.stringify(this.statsErrors)}catch(e){this.processStatsError(e)}},e.prototype.processBandwidthStats=function(){var e=this.extensions.WebRTCStats.bweStat&&this.extensions.WebRTCStats.bweStat.googAvailableSendBandwidth;e&&this.bandwidthTelemetry.recordSendBandwidth(e[e.length-1])},e.prototype.processStatsError=function(e){var t=o.stringifyObject(e);this.logger.safe.error("getStatsError: "+t),this.extensions.WebRTCStats.hasStatsError=!0;var n=this.statsErrors.find(function(e){return e.error===t});n?n.count++:this.statsErrors.push({error:t,count:1}),this.statsErrors.length>10&&this.statsErrors.splice(1),this.extensions.WebRTCStats.statsErrors=JSON.stringify(this.statsErrors)},e.prototype.processAudioStats=function(){this.extensions.WebRTCStats.ssrc_audio_recv&&this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs&&this.audioTelemetry.captureJitter(this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs)},e.prototype.processVideoStatsSend=function(e,t){t&&s.hasSendDirectionality(this.sessionInfo.activeModalities.video)?(e.captureMediaData(a.default.MEDIA_DIRECTION.SEND,t.googFrameRateSent,t.framesEncoded),e.captureFrameRate(t.googFrameRateInput),e.analyzeDelay(this.videoDelayTimePeriod,t.googAvgEncodeMs),e.captureQpData(a.default.MEDIA_DIRECTION.SEND,t.qpSum,t.framesEncoded),e.captureBitrateSample(a.default.MEDIA_DIRECTION.SEND,this.getLastSampleInt(t.bytesSent)),e.detectCaptureFreeze(t.googFrameRateInput),e.captureAllocateBandwidth(this.extensions.WebRTCStats.bweStat.googAvailableSendBandwidth),e.setCurrentParameters(t.ssrc,{width:this.getLastSampleInt(t.googFrameWidthSent),height:this.getLastSampleInt(t.googFrameHeightSent)},t.googFrameRateSent)):e.isSendGathering()&&e.stopSendGathering()},e.prototype.processVideoStatsRecv=function(e,t){t&&s.hasReceiveDirectionality(this.sessionInfo.activeModalities.video)&&this.videoTelemetry.isRecvDataGatheringEnabled&&(e.gatherRecvFreezeData(t.googFrameRateDecoded,t.googFrameRateReceived),e.captureMediaData(a.default.MEDIA_DIRECTION.RECV,t.googFrameRateReceived,t.googFrameRateDecoded),e.captureQpData(a.default.MEDIA_DIRECTION.RECV,t.qpSum,t.framesDecoded),e.captureBitrateSample(a.default.MEDIA_DIRECTION.RECV,this.getLastSampleInt(t.bytesReceived)),e.captureResolutionSample({width:this.getLastSampleInt(t.googFrameWidthReceived),height:this.getLastSampleInt(t.googFrameHeightReceived)}))},e.prototype.processSharingStats=function(){var e=this.extensions.WebRTCStats.ssrc_sharing_send,t=this.extensions.WebRTCStats.ssrc_sharing_recv;e&&s.hasSendDirectionality(this.sessionInfo.activeModalities.sharing)?(this.sharingTelemetry.captureMediaData(a.default.MEDIA_DIRECTION.SEND,e.googFrameRateSent,e.framesEncoded),this.sharingTelemetry.captureFrameRate(e.googFrameRateInput),this.sharingTelemetry.analyzeDelay(this.videoDelayTimePeriod,e.googAvgEncodeMs),this.sharingTelemetry.captureQpData(a.default.MEDIA_DIRECTION.SEND,e.qpSum,e.framesEncoded),this.sharingTelemetry.captureBitrateSample(a.default.MEDIA_DIRECTION.SEND,this.getLastSampleInt(e.bytesSent)),this.sharingTelemetry.detectCaptureFreeze(e.googFrameRateInput),this.sharingTelemetry.captureAllocateBandwidth(this.extensions.WebRTCStats.bweStat.googAvailableSendBandwidth),this.sharingTelemetry.setCurrentParameters(e.ssrc,{width:this.getLastSampleInt(e.googFrameWidthSent),height:this.getLastSampleInt(e.googFrameHeightSent)},e.googFrameRateSent)):this.sharingTelemetry.isSendGathering()&&this.sharingTelemetry.stopSendGathering(),t&&s.hasReceiveDirectionality(this.sessionInfo.activeModalities.sharing)&&this.sharingTelemetry.isRecvDataGatheringEnabled&&(this.sharingTelemetry.gatherRecvFreezeData(t.googFrameRateDecoded,t.googFrameRateReceived),this.sharingTelemetry.captureMediaData(a.default.MEDIA_DIRECTION.RECV,t.googFrameRateReceived,t.googFrameRateDecoded),this.sharingTelemetry.captureQpData(a.default.MEDIA_DIRECTION.RECV,t.qpSum,t.framesDecoded),this.sharingTelemetry.captureBitrateSample(a.default.MEDIA_DIRECTION.RECV,this.getLastSampleInt(t.bytesReceived)),this.sharingTelemetry.captureResolutionSample({width:this.getLastSampleInt(t.googFrameWidthReceived),height:this.getLastSampleInt(t.googFrameHeightReceived)}))},e.prototype.processStreamsCounters=function(){var e=this.extensions.WebRTCStats.recvCounters;e&&(this.videoTelemetry.countRecvStreams(e[a.default.MODALITY.video]),this.sharingTelemetry.countRecvStreams(e[a.default.MODALITY.sharing]))},e.prototype.setPreferredResolution=function(e,t){this.currentVideoRecvTrackId===e&&this.videoTelemetry.capturePreferredResolution(t,this.maxStoredPreferredResolutions),this.currentSharingRecvTrackId===e&&this.sharingTelemetry.capturePreferredResolution(t,this.maxStoredPreferredResolutions)},e.prototype.setReportedSendBandwidth=function(e){this.extensions.ReportedSendBWMax||this.extensions.ReportedSendBWMin?e>this.extensions.ReportedSendBWMax?this.extensions.ReportedSendBWMax=e:e<this.extensions.ReportedSendBWMin&&(this.extensions.ReportedSendBWMin=e):(this.extensions.ReportedSendBWMax=e,this.extensions.ReportedSendBWMin=e)},e.prototype.setMaxSessionBandwidth=function(e){this.extensions.MaxSessionBandwidth=e},e.prototype.isSubscribed=function(e){return this.configProvider.config.subscribeToSsrcForVideo?this.subscribedTrackSsrc.some(function(t){return t===e.ssrc.toString()}):this.subscribedTrackIds.some(function(t){return t===e.googTrackId})},e.prototype.getReport=function(){var e=this;try{this.videoTelemetry.stopDataGathering(),this.sharingTelemetry.stopDataGathering();var t=this.videoTelemetry.getTotalDuration(a.default.MEDIA_DIRECTION.RECV),n=this.videoTelemetry.getTotalDuration(a.default.MEDIA_DIRECTION.SEND),i=this.sharingTelemetry.getTotalDuration(a.default.MEDIA_DIRECTION.RECV),r=this.sharingTelemetry.getTotalDuration(a.default.MEDIA_DIRECTION.SEND);if(t>0&&(o.forOwn(this.videoTelemetry.getReport(a.default.MEDIA_DIRECTION.RECV,"Video_recv_"),function(t,n){return e.extensions[n]=t}),!o.isEmpty(this.multiViewVideoTelemetry))){var s=[],c=function(e){var t={id:e};o.forOwn(l.multiViewVideoTelemetry[e].getReport(a.default.MEDIA_DIRECTION.RECV,"Video"),function(e,n){void 0!==e&&(t[n]=e)}),s.push(t)},l=this;for(var u in this.multiViewVideoTelemetry)c(u);this.extensions[a.default.MULTIPLE_RECV_STREAMS]=JSON.stringify(s)}for(var d in i>0&&o.forOwn(this.sharingTelemetry.getReport(a.default.MEDIA_DIRECTION.RECV,"Sharing_recv_"),function(t,n){return e.extensions[n]=t}),n>0&&(o.forOwn(this.videoTelemetry.getReport(a.default.MEDIA_DIRECTION.SEND,"Video_send_"),function(t,n){return e.extensions[n]=t}),this.extensions.Bandwidth_jumpsHistogram=JSON.stringify(this.bandwidthTelemetry.getReport()),this.extensions.Video_send_CameraOpenWidth=this.cameraOpenResolution.width,this.extensions.Video_send_CameraOpenHeight=this.cameraOpenResolution.height),r>0&&(o.forOwn(this.sharingTelemetry.getReport(a.default.MEDIA_DIRECTION.SEND,"Sharing_send_"),function(t,n){return e.extensions[n]=t}),this.rawScreenshareAudioInput.length&&(this.extensions.Sharing_send_RawInputVolume=this.rawScreenshareAudioInput.toString())),this.simulcastVideo.setActiveLayouts({}),this.extensions.Video_send_Simulcast=JSON.stringify(this.simulcastVideo.collectedSessions),this.simulcastSharing.setActiveLayouts({}),this.extensions.Sharing_send_Simulcast=JSON.stringify(this.simulcastSharing.collectedSessions),this.iceCandidateErrors.length>0&&(this.extensions.iceCandidateErrors=JSON.stringify(this.iceCandidateErrors)),this.extensions.Audio_recv_jitterBufferAvgSize=this.audioTelemetry.getAvgJitter(),this.extensions.Video_SubscriptionEvents=JSON.stringify(this.videoTelemetry.getSubscriptionEvents()),this.extensions.Sharing_SubscriptionEvents=JSON.stringify(this.sharingTelemetry.getSubscriptionEvents()),this.extensions)void 0===this.extensions[d]&&delete this.extensions[d];return delete this.extensions.WebRTCStats[a.default.MULTIPLE_RECV_STREAMS],this.sessionInfo.fillExtensionInfo(this.extensions),Object.keys(this.extensions.WebRTCStats).length>0&&!this.extensions.WebRTCStats.hasStatsError&&this.calculateAverages(),o.deepClone(this.report)}catch(e){throw this.processStatsError(e),{error:e,partialReport:o.deepClone(this.report)}}},e.prototype.getAudioHwSilent=function(){return this.hwSilent},e.prototype.getSpeakingState=function(){return this.isSpeaking},e.prototype.getNetworkSendLevel=function(){return this.networkSendLevel},e.prototype.getNetworkRecvLevel=function(){return this.networkRecvLevel},e.prototype.addIceCandidateError=function(e){this.iceCandidateErrors.push(e)},e.prototype.clearIceCandidateErrors=function(){this.iceCandidateErrors=[]},e.prototype.setStartTime=function(e){var t=this.extensions.WebRTCStats;if(!t.ssrc_audio_send||!t.ssrc_audio_recv)return!1;var n=function(e,t){return!e||t&&-1===t?t:(new Date).getTime()};return this.extensions.TimerAudioPayloadRecvBitrate=s.hasReceiveDirectionality(e.audio)?n(t.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioPayloadRecvBitrate):-1,this.extensions.TimerAudioPayloadSendBitrate=s.hasSendDirectionality(e.audio)?n(t.ssrc_audio_send.bytesSent,this.extensions.TimerAudioPayloadSendBitrate):-1,this.extensions.TimerAudioTransportRecvBitrate=s.hasReceiveDirectionality(e.audio)?n(t.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioTransportRecvBitrate):-1,this.extensions.TimerAudioTransportSendBitrate=s.hasSendDirectionality(e.audio)?n(t.ssrc_audio_send.bytesSent,this.extensions.TimerAudioTransportSendBitrate):-1,!!(t.ssrc_video_send&&t.ssrc_video_recv&&(this.extensions.TimerVideoPayloadRecvBitrate=s.hasReceiveDirectionality(e.video)?n(t.ssrc_video_recv.bytesReceived,this.extensions.TimerVideoPayloadRecvBitrate):-1,this.extensions.TimerVideoPayloadSendBitrate=s.hasSendDirectionality(e.video)?n(t.ssrc_video_send.bytesSent,this.extensions.TimerVideoSendBitrate):-1,this.extensions.TimerVideoPayloadRecvBitrate&&this.extensions.TimerVideoPayloadSendBitrate&&this.extensions.TimerAudioPayloadRecvBitrate&&this.extensions.TimerAudioPayloadSendBitrate&&this.extensions.TimerAudioTransportRecvBitrate&&this.extensions.TimerAudioTransportSendBitrate))},e.prototype.calculateAverages=function(){var e=this,t=this.extensions.EndTime,n=function(e,n){return e&&t-n>0&&0!==n&&-1!==n?Math.round(8*e/(t-n)):0},i=function(t){var n=t.split(".").reduce(function(e,t){return null==e?e:e[t]},e.extensions.WebRTCStats);return Array.isArray(n)?n[n.length-1]:n};this.extensions.AudioPayloadRecvBitrate=n(i("ssrc_audio_recv.bytesReceived"),this.extensions.TimerAudioPayloadRecvBitrate),this.extensions.AudioPayloadSendBitrate=n(i("ssrc_audio_send.bytesSent"),this.extensions.TimerAudioPayloadSendBitrate),this.extensions.VideoPayloadRecvBitrate=n(i("ssrc_video_recv.bytesReceived"),this.extensions.TimerVideoPayloadRecvBitrate),this.extensions.VideoPayloadSendBitrate=n(i("ssrc_video_send.bytesSent"),this.extensions.TimerVideoPayloadSendBitrate),this.extensions.AudioTransportRecvBitrate=n(i("ssrc_audio_send.pair.bytesReceived"),this.extensions.TimerAudioTransportRecvBitrate),this.extensions.AudioTransportSendBitrate=n(i("ssrc_audio_send.pair.bytesSent"),this.extensions.TimerAudioTransportSendBitrate)},e.prototype.addFilteredFields=function(e,t,n){for(var i in void 0===n&&(n=[]),t)if(t.hasOwnProperty(i)&&"type"!==i)if(-1!==n.indexOf(i)){var r=e[i]||[];r.push(t[i]),r.length>this.storedRecordsNumber&&r.shift(),e[i]||(e[i]=r)}else e[i]=t[i]},e.prototype.processSource=function(e,t,n){if(this.addFilteredFields(e,t,p),t.transportId){var i=n.googComponent[t.transportId];if(e.transport||(e.transport={}),this.addFilteredFields(e.transport,i),i.selectedCandidatePairId){var r=n.googCandidatePair[i.selectedCandidatePairId];e.pair||(e.pair={}),this.addFilteredFields(e.pair,r,f)}}},e.prototype.getWebrtcReport=function(e,t,n,i){var r=e.ssrc[n],o=i?r.id.replace(/[0-9]+/,i):r.id;t[o]?r.ssrc!=t[o].ssrc&&(o.endsWith("video_send")?this.videoTelemetry.stopSendGathering():o.endsWith("video_recv")?this.videoTelemetry.stopRecvGathering():o.endsWith("sharing_send")?this.sharingTelemetry.stopSendGathering():o.endsWith("sharing_recv")&&this.sharingTelemetry.stopRecvGathering()):t[o]={},this.processSource(t[o],r,e)},e.prototype.constructWebRtcReportForSingleStream=function(e,t){var n=this;if(t.ssrc){var i=this.selectSsrcsToCollect(t.ssrc);e.recvCounters=i.recvCounters,delete i.recvCounters,delete i.multiRecv,o.forOwn(i,function(i){o.forOwn(i,function(i,r){n.getWebrtcReport(t,e,i,r)})}),t.VideoBwe&&t.VideoBwe.bweforvideo&&(e.bweStat||(e.bweStat={}),this.addFilteredFields(e.bweStat,t.VideoBwe.bweforvideo,h))}},e.prototype.constructWebRtcReportForMultipleStreams=function(e,t){var n=this;t.ssrc&&this.selectSsrcsToCollect(t.ssrc).multiRecv.forEach(function(i){return n.getWebrtcReport(t,e,i)})},e.prototype.selectSsrcsToCollect=function(e){var t=this,n={send:{},recv:{},recvCounters:{video:0,sharing:0},multiRecv:[]};if(!this.sessionInfo.activeModalities)return n;var i=[];for(var r in e){var c=e[r],u=c.ssrc.toString(),d=c.googTrackId,p=this.configProvider.config.subscribeToSsrcForVideo&&r.endsWith("recv")?this.getMediaEntityByRemoteSsrc(u):this.getMediaEntityForTrack(d),f=p?p.getModality():c.mediaType;if(c.googTrackId&&c.googTrackId.match("applicationsharing")&&f!==a.default.MEDIA_TYPE.sharing&&(f=a.default.MEDIA_TYPE.sharing),r.endsWith("send"))switch(f){case a.default.MEDIA_TYPE.audio:s.hasSendDirectionality(this.sessionInfo.activeModalities.audio)&&(n.send.audio=r);break;case a.default.MEDIA_TYPE.video:this.simulcastVideo.highestFidelitySSRC!=c.ssrc&&n.send.video||!s.hasSendDirectionality(this.sessionInfo.activeModalities.video)||(n.send.video=r);break;case a.default.MEDIA_TYPE.sharing:this.simulcastSharing.highestFidelitySSRC!=c.ssrc&&n.send.sharing||!s.hasSendDirectionality(this.sessionInfo.activeModalities.sharing)||(n.send.sharing=r)}else if(r.endsWith("recv"))switch(f){case a.default.MEDIA_TYPE.audio:s.hasReceiveDirectionality(this.sessionInfo.activeModalities.audio)&&(n.recv.audio=r);break;case a.default.MEDIA_TYPE.video:this.isSubscribed(c)&&s.hasReceiveDirectionality(this.sessionInfo.activeModalities.video)&&(i.push(c),+c.googFrameRateReceived>0&&n.recvCounters[a.default.MODALITY.video]++);break;case a.default.MEDIA_TYPE.sharing:this.isSubscribed(c)&&s.hasReceiveDirectionality(this.sessionInfo.activeModalities.sharing)&&(n.recv.sharing=r,+c.googFrameRateReceived>0&&n.recvCounters[a.default.MODALITY.sharing]++);break;default:this.logger.warn("Unknown media type '"+f+"'")}}if(i.length>0){var h=(i=i.sort(function(e,t){return+e.googFrameHeightReceived-+t.googFrameHeightReceived})).find(function(e){return e.mediaType===a.default.MEDIA_TYPE.video});h&&(n.recv.video=h.id),this.configProvider.config.enableMultiViewStats&&i.length>1&&(n.multiRecv=i.map(function(e){return e.id}),n.multiRecv.length>o.keys(this.multiViewVideoTelemetry).length&&n.multiRecv.forEach(function(e){t.multiViewVideoTelemetry[e]||(t.multiViewVideoTelemetry[e]=new l.default(t.extensions.StartTime,t.configProvider,t.logger.createChild("Video")))}))}return n},e.prototype.getMediaEntityForTrack=function(e){return e&&this.mediaManager.getMediaEntities().find(function(t){return t.getLocalTrackIds().indexOf(e)>=0||t.getRemoteTrackId()===e})},e.prototype.getMediaEntityByRemoteSsrc=function(e){return e&&this.mediaManager.getMediaEntities().find(function(t){return t.getRemoteSsrc()===e})},e.prototype.calculateHwSilentState=function(){var e=this.extensions.WebRTCStats.ssrc_audio_send&&this.extensions.WebRTCStats.ssrc_audio_send.audioInputLevel;if(e&&!(e.length<2*this.hwSilentDetectionDuration)){for(var t=!0,n=e.length-this.hwSilentDetectionDuration-1;n<e.length;n++)if(e[n]>this.hwSilentDetectionLevel){t=!1;break}this.hwSilent!==t&&(this.hwSilent=t,this.logger.safe.info("HW silent changed to "+this.hwSilent))}},e.prototype.calculateSpeakingState=function(){var e=this.extensions.WebRTCStats.ssrc_audio_send&&this.extensions.WebRTCStats.ssrc_audio_send.audioInputLevel;if(e&&!(e.length<=this.speakingWhileMutedBadDuration)){for(var t=!1,n=e.length-this.speakingWhileMutedBadDuration;n<e.length;n++)if(e[n]>this.speakingWhileMutedDetectionLevel){t=!0;break}this.isSpeaking=t}},e.prototype.calculateNetworkQualityLevel=function(e,t,n){if(!e||!t||this.networkDetectionDuration<1||e.length<2*this.networkDetectionDuration)return n;for(var i=e.length-1-this.networkDetectionDuration,r=e[e.length-1];i>=0&&r-e[i]<100*this.networkDetectionDuration;)i--;if(i<0)return n;var o=n,a=r-e[i],s=t[t.length-1]-t[i];if(a>0){var c=s/a;c<this.networkDetectionGoodLevelLow?o="Good":c>this.networkDetectionGoodLevelHigh&&(c<this.networkDetectionBadLevelLow?o="Poor":c>this.networkDetectionBadLevelHigh&&(o="Bad"))}return o},e.prototype.calculateNetworkQualityLevels=function(){this.networkRecvLevel=this.calculateNetworkQualityLevel(this.extensions.WebRTCStats.ssrc_audio_recv&&this.extensions.WebRTCStats.ssrc_audio_recv.googDecodingCTN,this.extensions.WebRTCStats.ssrc_audio_recv&&this.extensions.WebRTCStats.ssrc_audio_recv.googDecodingPLC,this.networkRecvLevel)},e.prototype.getLastSampleInt=function(e){return e&&parseInt(e[e.length-1])||0},e}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){this.jitterDuration=0,this.jitterAvg=0}return e.prototype.captureJitter=function(e){if(null!==e){var t=parseInt(e);this.jitterDuration+=i.default.TIME_INTERVAL.SEC_1,this.jitterAvg+=t}},e.prototype.getAvgJitter=function(){var e=this.jitterAvg/this.jitterDuration;return this.jitterDuration=0,this.jitterAvg=0,e},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){var e;this.bitrateData=((e={})[i.default.MEDIA_DIRECTION.SEND]={lastBytes:0,lastTimestamp:0,maxSample:0,bitrateTotal:0,nSamples:0,allocateBW:0,allocateBWSamples:0},e[i.default.MEDIA_DIRECTION.RECV]={lastBytes:0,lastTimestamp:0,maxSample:0,bitrateTotal:0,nSamples:0},e)}return e.prototype.captureSample=function(e,t){var n=Date.now()/1e3;if(0!==this.bitrateData[e].lastTimestamp&&t>this.bitrateData[e].lastBytes){var i=n-this.bitrateData[e].lastTimestamp,r=8*(t-this.bitrateData[e].lastBytes)/i;this.onBitrateSample(e,r)}this.bitrateData[e].lastTimestamp=n,this.bitrateData[e].lastBytes=t},e.prototype.getMax=function(e){return Math.round(this.bitrateData[e].maxSample)},e.prototype.getAvg=function(e){return 0===this.bitrateData[e].nSamples?0:Math.round(this.bitrateData[e].bitrateTotal/this.bitrateData[e].nSamples)},e.prototype.stopCapture=function(e){this.bitrateData[e].lastBytes=0,this.bitrateData[e].lastTimestamp=0},e.prototype.onBitrateSample=function(e,t){t>this.bitrateData[e].maxSample&&(this.bitrateData[e].maxSample=t),this.bitrateData[e].bitrateTotal+=t,this.bitrateData[e].nSamples++},e.prototype.captureAllocateBandwidth=function(e){if(e){var t=parseInt(e[e.length-1]);this.bitrateData[i.default.MEDIA_DIRECTION.SEND].allocateBW+=t,this.bitrateData[i.default.MEDIA_DIRECTION.SEND].allocateBWSamples+=1}},e.prototype.getAllocateBandwidthAvg=function(){var e=this.bitrateData[i.default.MEDIA_DIRECTION.SEND].allocateBW,t=this.bitrateData[i.default.MEDIA_DIRECTION.SEND].allocateBWSamples;if(e>0&&t>0)return Math.floor(e/t)},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.maxAppliedCapabilitiesCount=t,this.events=[],this.events.push({eventType:"req",timestamp:Date.now(),capabilities:e.capabilities,isSimulcast:e.isSimulcastEnabled})}return e.prototype.setMaxCapabilitiesApplied=function(e){this.events.push({eventType:"app",timestamp:Date.now(),capabilities:e.capabilities,error:e.error||"none"}),this.maxAppliedCapabilitiesCount&&this.events.length>this.maxAppliedCapabilitiesCount+1&&this.events.splice(1,1)},e.prototype.getEvents=function(){return this.events},e}();t.CapabilitiesApplicationSequence=i;var r=function(){function e(e,t){this.configProvider=e,this.logger=t,this.events=[]}return e.prototype.setMaxCapabilitesRequested=function(e){var t=new i(e,this.configProvider.config.webrtcLastAppliedVideoCapabilitiesCount);this.events.push({causeId:e.causeId,seq:t}),this.configProvider.config.webrtcLastAppliedVideoCapabilitiesSequenceCount&&this.events.length>this.configProvider.config.webrtcLastAppliedVideoCapabilitiesSequenceCount&&this.events.shift()},e.prototype.setMaxCapabilitesApplied=function(e){var t=this.events.find(function(t){return t.causeId===e.causeId});t?t.seq.setMaxCapabilitiesApplied(e):this.logger.safe.warn("Requested capabilities with id "+e.causeId+" not found")},e.prototype.getEvents=function(){var e=[];return this.events.forEach(function(t){e.push({causeId:t.causeId,events:t.seq.getEvents()})}),e},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){this.delayCur=[],this.delayTotal=0,this.delayEventCount=0}return e.prototype.analyzeDelay=function(e,t){if(t&&""!==t){this.delayCur.length===e&&this.delayCur.shift();var n=parseInt(t);this.delayCur.push(n),this.delayTotal+=n,this.delayEventCount+=i.default.TIME_INTERVAL.SEC_1}},e.prototype.getDelayCur=function(){if(this.delayCur.length>0){var e=this.delayCur.reduce(function(e,t){return e+t})/this.delayCur.length;return e<0?0:e}},e.prototype.getDelayAvg=function(){if(this.delayEventCount>0&&this.delayTotal>0){var e=this.delayTotal/this.delayEventCount;return e<0?0:e}},e}();t.default=r},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){var t=this;this.startTime=e,this.recvTotalFreezeDuration=0,this.recvFreezeDurations=[],this.recvFreezeIsOngoing=!1,this.recvCurrentFreezeDuration=0,this.recvFreezeCount=0,this.receiveFreezeDurationCounts={},this.longestRecvFreezeDuration=0,this.sendCameraFreezeIntervalsCount=0,this.previousInputFrame=0,this.recvCurrentFreezeStartTimestamp=0,this.receiveFreezeDurationTimestamps={},Object.keys(r.default.HISTOGRAM_BATCH).forEach(function(e){t.receiveFreezeDurationCounts[e]=0,t.receiveFreezeDurationTimestamps[e]=[]})}return e.prototype.gatherFreezeData=function(e,t){if(e&&t){var n=parseInt(e[e.length-1]),i=parseInt(t[t.length-1]);0===n&&i>0||0===i?(this.recvFreezeIsOngoing||(this.recvCurrentFreezeStartTimestamp=Date.now()-this.startTime),this.recvFreezeIsOngoing=!0,this.recvCurrentFreezeDuration+=r.default.TIME_INTERVAL.SEC_1,this.recvTotalFreezeDuration+=r.default.TIME_INTERVAL.SEC_1):n>0&&i>0&&this.recvFreezeIsOngoing&&this.stopRecvDataGathering()}},e.prototype.detectCaptureFreeze=function(e){if(e){var t=parseInt(e[e.length-1]);this.previousInputFrame>0&&0===t&&(this.sendCameraFreezeIntervalsCount+=1),this.previousInputFrame=t}},e.prototype.getSendCameraFreezeIntervals=function(){return this.sendCameraFreezeIntervalsCount>0?this.sendCameraFreezeIntervalsCount:void 0},e.prototype.stopRecvDataGathering=function(){this.recvFreezeIsOngoing=!1,this.recvCurrentFreezeDuration>0&&(this.populateLongestRecvFreezeDuration(),this.populateRecvFreezeDurationCounts(),this.recvFreezeDurations.push(this.recvCurrentFreezeDuration),this.recvFreezeCount+=1),this.recvCurrentFreezeDuration=0},e.prototype.getRecvFreezeDurationCounts=function(){return this.recvFreezeCount>0?JSON.stringify(this.receiveFreezeDurationCounts):void 0},e.prototype.getRecvFreezeDurationTimestamps=function(e){var t=this;if(0!==this.recvFreezeCount){var n={};return Object.keys(this.receiveFreezeDurationTimestamps).forEach(function(i){var r=t.receiveFreezeDurationTimestamps[i].length;n[i]=r>e?t.receiveFreezeDurationTimestamps[i].slice(r-e):t.receiveFreezeDurationTimestamps[i]}),JSON.stringify(n)}},e.prototype.getRecvFreezeIsOngoing=function(e){return this.recvCurrentFreezeDuration>=e&&this.recvFreezeIsOngoing},e.prototype.getRecvTotalFreezeDuration=function(){return this.recvTotalFreezeDuration>0?this.recvTotalFreezeDuration:void 0},e.prototype.getRecvAvgFreezeDuration=function(){if(this.recvTotalFreezeDuration>0&&this.recvFreezeCount>0)return this.recvTotalFreezeDuration/this.recvFreezeCount},e.prototype.getLongestRecvFreezeDuration=function(){return this.longestRecvFreezeDuration>0?this.longestRecvFreezeDuration:void 0},e.prototype.populateRecvFreezeDurationCounts=function(){var e,t;try{for(var n=i(Object.keys(r.default.HISTOGRAM_BATCH)),o=n.next();!o.done;o=n.next()){var a=o.value;if(this.recvCurrentFreezeDuration<=r.default.HISTOGRAM_BATCH[a]){this.receiveFreezeDurationCounts[a]+=1,this.receiveFreezeDurationTimestamps[a].push(this.recvCurrentFreezeStartTimestamp);break}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.recvCurrentFreezeStartTimestamp=0},e.prototype.populateLongestRecvFreezeDuration=function(){this.recvCurrentFreezeDuration>this.longestRecvFreezeDuration&&(this.longestRecvFreezeDuration=this.recvCurrentFreezeDuration)},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){var e;this.mediaData=((e={})[i.default.MEDIA_DIRECTION.SEND]={totalMediaDuration:0,totalFrameCount:0,mediaStartTimestamp:new Date,mediaStarted:!1,timeSinceLastDecode:0,cameraFrameRate:0},e[i.default.MEDIA_DIRECTION.RECV]={totalMediaDuration:0,totalFrameCount:0,mediaStartTimestamp:new Date,mediaStarted:!1,timeSinceLastDecode:0,cameraFrameRate:0},e),this.gatheringSendData=!1}return e.prototype.captureMediaData=function(e,t,n){var r=this.mediaData[e];if(e==i.default.MEDIA_DIRECTION.SEND&&(this.gatheringSendData=!0),t){var o=parseInt(t[t.length-1]);r.totalFrameCount+=o}if(n){var a=parseInt(n[n.length-1]);r.mediaStarted||a>0&&(r.mediaStarted=!0,r.mediaStartTimestamp=new Date)}(n||t)&&r.mediaStarted&&(r.totalMediaDuration+=i.default.TIME_INTERVAL.SEC_1)},e.prototype.captureFrameRate=function(e){var t=this.mediaData[i.default.MEDIA_DIRECTION.SEND];if(e){var n=parseInt(e[e.length-1]);t.cameraFrameRate+=n}},e.prototype.stopRecvDataGathering=function(){var e=this.mediaData[i.default.MEDIA_DIRECTION.RECV],t=(new Date).getTime();e.timeSinceLastDecode=e.totalMediaDuration>0?Math.round((t-e.mediaStartTimestamp.getTime())/1e3):0,e.mediaStarted=!1},e.prototype.isGatheringSendData=function(){return this.gatheringSendData},e.prototype.stopSendDataGathering=function(){var e=this.mediaData[i.default.MEDIA_DIRECTION.SEND],t=new Date;e.timeSinceLastDecode=e.totalMediaDuration>0?Math.round((t.getTime()-e.mediaStartTimestamp.getTime())/1e3):0,this.gatheringSendData=!1,e.mediaStarted=!1},e.prototype.getAvgFrameRate=function(e){var t=this.mediaData[e];if(t.totalMediaDuration>0&&t.totalFrameCount>0)return t.totalFrameCount/t.totalMediaDuration},e.prototype.getTotalDuration=function(e){var t=this.mediaData[e];return t.totalMediaDuration>0?t.totalMediaDuration:void 0},e.prototype.getTimeSinceLastDecode=function(e){var t=this.mediaData[e];return t.timeSinceLastDecode>0?t.timeSinceLastDecode:void 0},e.prototype.getSendCameraFramerate=function(){var e=this.mediaData[i.default.MEDIA_DIRECTION.SEND];if(e.totalMediaDuration>0)return e.cameraFrameRate/e.totalMediaDuration},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){var e;this.qpData=((e={})[i.default.MEDIA_DIRECTION.SEND]={frames:0,qpSum:0},e[i.default.MEDIA_DIRECTION.RECV]={frames:0,qpSum:0},e)}return e.prototype.captureQpData=function(e,t,n){var i=this.qpData[e];if(n&&n.length>0){var r=parseInt(n[n.length-1],10);r>0&&(i.frames=r)}if(t){var o=parseInt(t,10);o>0&&(i.qpSum=o)}},e.prototype.getQpAverage=function(e){var t=this.qpData[e];if(t.qpSum>0&&t.frames>0)return t.qpSum/t.frames},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.resolutionChangedCount=0,this.resDurations={},this.preferredResolutions=[]}return Object.defineProperty(e.prototype,"resolutionSwitchCount",{get:function(){return this.resolutionChangedCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolutionDurationRatios",{get:function(){var e={},t=0;for(var n in this.resDurations)t+=this.resDurations[n];for(var n in this.resDurations)e[n]=this.resDurations[n]/t*100;return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preferredResolution",{get:function(){return this.preferredResolutions},enumerable:!0,configurable:!0}),e.prototype.captureSample=function(e){e&&e.width&&e.height&&(this.lastResolution&&this.lastResolution.height===e.height&&this.lastResolution.width===e.width||this.resolutionChanged(e),this.updateResolutionDuration(e.width+"x"+e.height))},e.prototype.capturePreferredResolution=function(e,t){this.preferredResolutions.length>=t&&this.preferredResolutions.shift(),this.preferredResolutions.push(e.width+"x"+e.height)},e.prototype.updateResolutionDuration=function(e){this.resDurations[e]||(this.resDurations[e]=0),this.resDurations[e]++},e.prototype.resolutionChanged=function(e){this.lastResolution=e,this.resolutionChangedCount++},e}();t.default=i},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.streamsTimers={}}return e.prototype.countRecvStreams=function(e){var t=""+e;this.streamsTimers.hasOwnProperty(t)||(this.streamsTimers[t]=0),this.streamsTimers[t]++},e.prototype.getStreamCounts=function(){var e=this,t={min:void 0,max:void 0,mode:void 0},n=Object.keys(this.streamsTimers).map(Number);return 0==n.length||1==n.length&&0==n[0]||(t.min=Math.min.apply(Math,r(n.filter(function(e){return e>0}))),t.max=Math.max.apply(Math,r(n)),t.mode=n.reduce(function(t,n){return e.streamsTimers[n]>e.streamsTimers[t]?n:t},n[0])),t},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.configProvider=e,this.subscriptionEvents=[]}return e.prototype.addSubscriptionEvent=function(e){this.subscriptionEvents.length>this.configProvider.config.webrtcSubscriptionEventLimit&&this.subscriptionEvents.shift(),this.subscriptionEvents.push(e)},e.prototype.getSubscriptionEvents=function(){return this.subscriptionEvents.length>0?{events:this.subscriptionEvents}:void 0},e}();t.default=i},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a={fs:0,fps:1},s=function(){function e(e){this.logger=e,this.allowed=new Map,this.currentEvents=new Map,this.finishedEvents=[]}return e.prototype.setMaxCapabilities=function(e){var t=this;e.forEach(function(e){e.ssrc&&(t.finishIfActive(e.ssrc),t.allowed.set(e.ssrc,{fs:e.maxFs+a.fs,fps:e.maxFps+a.fps}))})},e.prototype.setCurrentParams=function(e,t,n){var i=this.allowed.get(e);i&&(t>i.fs||n>i.fps)?(this.captureOvershoot(e,n,i.fps,"fps"),this.captureOvershoot(e,t,i.fs,"fs")):i&&this.finishIfActive(e)},e.prototype.flush=function(){var e=this;this.currentEvents.forEach(function(t,n){return e.finishIfActive(n)}),this.allowed.clear()},e.prototype.getEvents=function(){var e=r(o.deepClone(this.finishedEvents)),t=Date.now();return this.currentEvents.forEach(function(n){return n.forEach(function(n){return e.push({ssrc:n.ssrc,timestamp:n.timestamp,duration:t-n.timestamp,overshootType:n.overshootType,amount:n.amount})})}),e},e.prototype.captureOvershoot=function(e,t,n,i){var r=this.currentEvents.get(e)||[],o=r.findIndex(function(e){return e.overshootType===i}),s=r[o],c=t-n,l=a[i];c<=l&&s?(s.duration=Date.now()-s.timestamp,this.finishedEvents.push(s),this.logger.debug("stopped overshooting "+i+" by "+s.amount),r.splice(o,1)):c>l&&!s?(this.logger.safe.info("overshooting "+i+" by "+(t-n)),r.push({ssrc:e,timestamp:Date.now(),duration:-1,overshootType:i,amount:{min:c,max:c}})):c>l&&s&&(s.amount={min:Math.min(s.amount.min,c),max:Math.max(s.amount.max,c)}),r.length?this.currentEvents.set(e,r):this.currentEvents.has(e)&&this.currentEvents.delete(e)},e.prototype.finishIfActive=function(e){var t=this,n=this.currentEvents.get(e);if(n){var i=Date.now();n.forEach(function(e){e.duration=i-e.timestamp,t.finishedEvents.push(e),t.logger.debug("finished overshooting "+e.overshootType+" by "+e.amount)}),this.currentEvents.delete(e)}},e}();t.default=s},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e,t){this.configProvider=e,this.logger=t,this.statsBuilder=new a(this.configProvider),this.lastUnansweredRequestReason="None",this.previousKeyFrameData={kfEncoded:0,fir:0,pli:0,nack:0}}return e.prototype.dispose=function(){this.lastUnansweredRequestTimestamp=null,this.lastUnansweredRequestReason="None"},e.prototype.setKeyFrameRequested=function(e){this.lastUnansweredRequestTimestamp||(this.lastUnansweredRequestTimestamp=Date.now(),this.lastUnansweredRequestReason=e,this.logger.safe.debug("Key frame requested for reason: "+e))},e.prototype.setKeyFrameData=function(e){this.setKeyFramesEncoded(e.kfEncoded);var t=this.getReasonIfKeyFrameRequested(e);this.previousKeyFrameData=e,"None"!==t&&this.setKeyFrameRequested(t)},e.prototype.flush=function(){this.previousKeyFrameData={kfEncoded:0,fir:0,pli:0,nack:0},this.setKeyFrameSent()},e.prototype.getReasonIfKeyFrameRequested=function(e){return e.fir-this.previousKeyFrameData.fir>0?"FIR":e.pli-this.previousKeyFrameData.pli>0?"PLI":e.nack-this.previousKeyFrameData.nack>0?"NACK":"None"},e.prototype.setKeyFramesEncoded=function(e){e-this.previousKeyFrameData.kfEncoded>0&&this.setKeyFrameSent()},e.prototype.getStats=function(){return this.flush(),this.statsBuilder.getStats()},e.prototype.setKeyFrameSent=function(){if("None"!==this.lastUnansweredRequestReason){var e={timestamp:this.lastUnansweredRequestTimestamp,reason:this.lastUnansweredRequestReason,duration:(Date.now()-this.lastUnansweredRequestTimestamp)/1e3};this.statsBuilder.append(e),this.lastUnansweredRequestTimestamp=null,this.lastUnansweredRequestReason="None",this.logger.safe.debug("Key frame sent "+JSON.stringify(e))}},e}();t.WebRTCVideoKeyFrameMonitor=o;var a=function(){function e(e){var t=this;this.configProvider=e,this.hist={},this.timestamps={},Object.keys(r.default.HISTOGRAM_BATCH).forEach(function(e){t.hist[e]=0,t.timestamps[e]=[]})}return e.prototype.append=function(e){var t,n;try{for(var o=i(Object.keys(r.default.HISTOGRAM_BATCH)),a=o.next();!a.done;a=o.next()){var s=a.value;if(e.duration<=r.default.HISTOGRAM_BATCH[s]){this.hist[s]+=1,this.timestamps[s].push(e.timestamp),this.timestamps[s].length>this.configProvider.config.maxKeyFrameTimestampsInBucket&&this.timestamps[s].shift();break}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.getStats=function(){return{hist:this.hist,ts:this.timestamps}},e}();t.KeyFrameEventHistBuilder=a},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(2),a=n(117),s=function(){function e(e,t){this.logger=e,this.configProvider=t,this.currentLayouts={},this.collectedModalitySessions=[],this.startTimestamp=Date.now()}return Object.defineProperty(e.prototype,"collectedSessions",{get:function(){return this.collectedModalitySessions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highestFidelitySSRC",{get:function(){var e,t=this;if(this.currentModalitySession)return r.forOwn(this.currentLayouts,function(n){e=t.getHigherFidelitySSRC(n.ssrc,e)}),e},enumerable:!0,configurable:!0}),e.prototype.setActiveLayouts=function(e){var t=this,n=!1,i=r.keys(e).map(function(e){return Number(e)});r.forOwn(this.currentLayouts,function(e,r){i.some(function(e){return e===r})||(t.collectLayout(r),n=!0)}),!this.currentModalitySession&&i.length>0&&(this.currentModalitySession={timestamp:Date.now()-this.startTimestamp,duration:0,numLayouts:0,layouts:[]},this.logger.safe.info("Modality session started")),i.forEach(function(i){t.currentLayouts[i]||(t.addLayout(i,e[i]),n=!0)}),0===i.length&&this.currentModalitySession&&(this.logger.safe.info("Modality session ended"),this.collectSession(),n=!0),n&&this.logger.safe.debug("Active SSRCs set to ["+i.join(", ")+"]")},e.prototype.setMaxCapabilities=function(e){var t,n;if(r.keys(this.currentLayouts).length)try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value,c=this.currentLayouts[s.ssrc];c&&(c.gatherer.setMaxCapabilitiesOvershoot([s]),c.gatherer.setKeyFrameRequested(s.keyframe))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.addLayout=function(e,t){this.logger.safe.info("Adding layout for ssrc "+e);var n=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp,i=new a.default(n,this.configProvider,this.logger.createChild("Telemetry#"+e));i.setMaxCapabilitiesOvershoot([t]),i.setKeyFrameRequested(t.keyframe),this.currentLayouts[e]={ssrc:e,timestamp:n,duration:0,fmtp:t,gatherer:i},this.currentModalitySession.numLayouts++},e.prototype.processStats=function(e){var t=this;r.keys(this.currentLayouts).map(function(t){return e.ssrc["ssrc_"+t+"_send"]}).forEach(function(e){return!!e&&t.processLayoutData(e)})},e.prototype.processLayoutData=function(e){var t=this,n=e.ssrc;r.forOwn(e,function(e,i){"id"!==i&&(t.currentLayouts[n][i]=e)}),this.currentLayouts[n].gatherer.captureMediaData(o.default.MEDIA_DIRECTION.SEND,[String(e.googFrameRateSent)],[String(e.framesEncoded)]),this.currentLayouts[n].gatherer.captureFrameRate([String(e.googFrameRateInput)]),this.currentLayouts[n].gatherer.analyzeDelay(this.configProvider.config.webrtcVideoDelayThreshold,String(e.googAvgEncodeMs)),this.currentLayouts[n].gatherer.captureQpData(o.default.MEDIA_DIRECTION.SEND,String(e.qpSum),[String(e.framesEncoded)]),this.currentLayouts[n].gatherer.captureBitrateSample(o.default.MEDIA_DIRECTION.SEND,e.bytesSent),this.currentLayouts[n].gatherer.detectCaptureFreeze([String(e.googFrameRateInput)]),this.currentLayouts[n].gatherer.setCurrentParameters(parseInt(String(e.ssrc)),{width:e.googFrameWidthSent,height:e.googFrameHeightSent},e.googFrameRateSent);var i={kfEncoded:parseInt(String(e.keyFramesEncoded)),fir:parseInt(String(e.googFirsReceived)),nack:parseInt(String(e.googNacksReceived)),pli:parseInt(String(e.googPlisReceived))};this.currentLayouts[n].gatherer.setKeyFrameData(i)},e.prototype.collectLayout=function(e){var t=this;for(this.logger.safe.info("Collecting layout for ssrc "+e),this.currentLayouts[e].duration=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp-this.currentLayouts[e].timestamp,this.currentLayouts[e].gatherer.isSendGathering()&&this.currentLayouts[e].gatherer.stopSendGathering(),r.forOwn(this.currentLayouts[e].gatherer.getReport(o.default.MEDIA_DIRECTION.SEND,""),function(n,i){return t.currentLayouts[e][i]=n}),delete this.currentLayouts[e].gatherer,this.currentModalitySession.layouts.push(this.currentLayouts[e]);this.currentModalitySession.layouts.length>this.configProvider.config.simulcastTelemetryLayoutsPerSession;)this.currentModalitySession.layouts.shift();delete this.currentLayouts[e]},e.prototype.collectSession=function(){var e=this;for(this.logger.safe.info("Collecting session"),r.forOwn(this.currentLayouts,function(t,n){e.collectLayout(n)}),this.currentModalitySession.duration=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp,this.collectedModalitySessions.push(this.currentModalitySession);this.collectedModalitySessions.length>this.configProvider.config.simulcastTelemetryNumModalitySessions;)this.collectedModalitySessions.shift();this.currentModalitySession=void 0},e.prototype.getHigherFidelitySSRC=function(e,t){if(!e||!t)return e||t;var n=this.currentLayouts[e].fmtp,i=this.currentLayouts[t].fmtp;return n.maxMbps&&i.maxMbps?n.maxMbps>i.maxMbps?e:t:e||t},e}();t.default=s},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0),a=function(){function e(e,t){var n=this;this.dropBadBandwidth=e,this.dropGoodBandwidth=t,this.dropDurationCounts={},Object.keys(r.default.HISTOGRAM_BATCH).forEach(function(e){n.dropDurationCounts[e]=0})}return e.prototype.recordSendBandwidth=function(e){this.currentDropDuration&&e<this.dropGoodBandwidth||e<this.dropBadBandwidth?this.initiateDrop():this.currentDropDuration&&e>this.dropGoodBandwidth&&this.recoverDrop()},e.prototype.getReport=function(){var e=o.shallowClone(this.dropDurationCounts);return this.currentDropDuration&&(e.ongoingDuration=this.currentDropDuration),e},e.prototype.initiateDrop=function(){this.currentDropDuration?this.currentDropDuration++:this.currentDropDuration=1},e.prototype.recoverDrop=function(){var e,t;try{for(var n=i(Object.keys(r.default.HISTOGRAM_BATCH)),o=n.next();!o.done;o=n.next()){var a=o.value;if(this.currentDropDuration<=r.default.HISTOGRAM_BATCH[a]){this.dropDurationCounts[a]+=1,this.currentDropDuration=0;break}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e}();t.WebRTCBandwidthTelemetry=a},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),s=n(36),c=n(53),l=n(21),u=n(54),d=n(104),p=n(22),f=n(18),h=n(38),g=n(105),m=n(106),v=n(0),y=n(2),S=n(58),_=n(57),E=n(9),T=n(27),C=n(107),I=n(109),A=n(263),b=n(264),R=n(112),O=n(113),P=n(114),N=n(115),M=n(266),w=n(116),D=n(119),L=n(120),k=n(268),x=n(121),F=n(122),U=n(123),j=n(269),H=0,B=function(){function e(e,t,n){var i=this;this.context=e,this.callId=t,this.callback=n,this.callbacks={},this.configProvider=this.context.configProvider,this.logger=this.context.getLogger().createChild("webrtc2-"+ ++H),this.deviceManager=this.context.getDeviceManager(),this.multiParty=this.context.config&&this.context.config.isConference,this.unifiedPlanEnabled=this.multiParty&&this.configProvider.config.webrtcUnifiedPlanEnabledMultiparty||!this.multiParty&&this.configProvider.config.webrtcUnifiedPlanEnabled1on1,this.webrtcAdapter=C.default.build({global:this.context.maContext,configProvider:this.configProvider,unifiedPlanEnabled:this.unifiedPlanEnabled}),this.iceHostCandidateOnly=this.multiParty&&v.getFrom("iceHostCandidateOnly",this.context.config,this.configProvider.config),this.mediaManager=b.MediaManagerFactory.build({logger:this.logger,configProvider:this.configProvider,numVideoChannels:this.multiParty&&this.configProvider.config.numVideoChannelsGvc||1,unifiedPlanEnabled:this.unifiedPlanEnabled}),this.resolutionTable=new p.default(this.configProvider),this.sessionDescription=F.SessionDescriptionFactory.build({sdpTransform:new this.webrtcAdapter.SdpTransform(this.context),mediaManager:this.mediaManager,logger:this.logger,configProvider:this.configProvider,configuration:this.getStreamTransformConfiguration()}),this.allowedMediaContentType=v.getFrom("webrtcAllowedMediaContentType",this.context.config,this.configProvider.config).concat(),this.receiveStreamCollection=new g.default({streamAdded:function(e){return i.streamAdded(e)},streamRemoved:function(e){return i.streamRemoved(e)}}),this.stats=new w.StatisticsGatherer(this.logger,this.configProvider,this.mediaManager),this.scalingEnabled=this.multiParty?this.configProvider.config.webrtcMultiPartyVideoScaling:this.configProvider.config.webrtcVideoScaling,this.qualityManager=new O.default(this.logger.createChild("qm"),{videoReceiversCount:this.configProvider.config.webrtcVideoReceiversCount,bandwidthPerVideoReceiver:this.configProvider.config.webrtcBandwidthPerVideoReceiver,nonEstimatedDefaultVideoReceiversCount:this.configProvider.config.nonEstimatedDefaultVideoReceiversCount,slidingWindowSamples:this.configProvider.config.webrtcQualitySlidingWindowSamples,slidingWindowPercentile:this.configProvider.config.webrtcQualitySlidingWindowPercentile,scalingEnabled:this.scalingEnabled,customBwEstimationEnabled:!(this.multiParty&&!this.configProvider.config.webrtcEnabledCustomBwEstimationForVideo),sendBandwidthNotificationsEnabled:this.multiParty&&this.configProvider.config.webrtcSendBandwidthNotificationsEnabled},this,this.stats,this.configProvider),this.videoStreamWatcher=new D.VideoStreamWatcher({statsGatherer:this.stats,configProvider:this.configProvider,logger:this.logger},{onStreamIncomingDecoderFailed:function(){i.logger.safe.warn("ScreenSharing stream decoding failed"),i.resetScreenSharingStream(),i.callbacks.onScreenSharingIncomingDecoderFailed&&i.callbacks.onScreenSharingIncomingDecoderFailed()},onStreamIncomingDecoderActive:function(){i.callbacks.onScreenSharingIncomingDecoderActive&&i.callbacks.onScreenSharingIncomingDecoderActive()},onStreamIncomingDecoderReset:function(){i.callbacks.onScreenSharingIncomingDecoderReset&&i.callbacks.onScreenSharingIncomingDecoderReset()}}),this.activeSpeakerManager=new c.ActiveSpeakerManager(this.callback.onContributingSourcesChanged,this.callback.onDominantSpeakerChanged),this.contributingSources=new I.ContributingSourcesHandler({activeSpeakerManager:this.activeSpeakerManager,logger:this.logger,configProvider:this.configProvider,provider:function(){if(!i.peerConnection)return[];if(i.peerConnection.getReceivers&&i.multiParty){var e=i.peerConnection.getReceivers().filter(function(e){return"audio"===e.track.kind})[0];if(!e)return[];if(e.getContributingSources)return e.getContributingSources()}}}),this.passiveModalities=this.context.config.passiveModalities,this.negotiationQueue=new l.PromiseQueue(this.logger),this.negotiationEmulator=new R.default(this.logger.createChild("negotiationEmulator"),this.webrtcAdapter,this.sessionDescription,this.negotiationQueue,this.mediaManager),this.extensionsManager=this.setupExtensionsManager(),this.wasConnected=!1,this.toBeCalledAfterConnected=[],this.iceTransportPolicy=this.configProvider.config.iceTransportPolicyForced||this.context.config.iceTransportPolicy||y.default.ICE_TRANSPORT_POLICY.all,this.peerConnection=null,this.doAudioMute=this.context.config.muted,this.iceCandidatesDeferred=new f.SettablePromise,this.iceCandidatesTimer=null,this.iceCandidateReceived=!1,this.triggerRenegotiationFlag=!1,this.canTriggerRenegotiation=!0,this.noIceCandidates=!1,this.noRelayIceCandidates=!1,this.forceMediaStreamUpdate=!1,this.negotiatedModalities={},this.iceDisconnectedTimer=null,this.statisticsReport=Promise.resolve({}),this.terminated=!1,this.initiator=!1,this.streamsChangedListener=null,this.dtmfSender=x.default.build({logger:this.logger,configProvider:this.configProvider}),this.mediaContentType=v.getFrom("webrtcMediaContentType",this.context.config,this.configProvider.config),this.streamsChangedNotificationScheduled=!1,this.subscriptionManager=new m.SubscriptionManager({logger:this.logger,configProvider:this.configProvider},{getStreams:function(){return i.getStreams()},onStreamsChanged:function(e){return i.onStreamsChanged(e)}}),this.remoteVideoResolutionManager=new P.RemoteVideoResolutionManager(this.logger.createChild("rvrm"),this.multiParty,this.resolutionTable,this.configProvider,this.mediaManager),this.remoteVideoManager=new N.RemoteVideoManager(this.logger.createChild("RemoteVideoManager"),this.configProvider,this.stats,this.remoteVideoResolutionManager,this.context.maContext.domOverrides),this.transceiverManager=null,this.streamSendersManager=new j.StreamSendersManager(this.mediaManager,{streamsCountForVideo:this.multiParty&&!this.unifiedPlanEnabled?this.configProvider.config.webrtcSimulcastStreamsCountForVideo:1,streamsCountForSharing:this.multiParty&&!this.unifiedPlanEnabled?this.configProvider.config.webrtcSimulcastStreamsCountForSharing:1},this.logger.createChild("SSM"),this.deviceManager,this.configProvider,this.stats,this.multiParty),this.hwSilent=!1,this.configuredModalitiesPromise=Promise.resolve(),this.negotiationCompletedPromise=new f.SettablePromise,this.ufdManager=e.getUfdManager(),this.stats.on("onStatisticsChanged",function(e){i.updateQualityLevels(e)}),this.negotiationCompletedPromise.promise.catch(function(){}),this.negotiationCompletedPromise.reject("placeholder"),this.remoteVideoResolutionManager.on("onNegotiationRequired",function(){return i.triggerRenegotiation(!0)}),this.remoteVideoResolutionManager.on("onSourceRequestRequired",function(e,t,n,r){return i.requestSource(e,t,n,r)}),this.setSubsForSubscriptionManager(),this.streamSendersManager.on("onActiveLayoutsChanged",function(e,t){i.stats.setLayouts(e,t)}),this.streamSendersManager.on("onAudioScreenSharingDisposed",function(e){i.stats.setRawScreenshareAudioInput(e)}),this.streamSendersManager.on("onVideoCaptureFreeze",function(e){i.isConnected()&&i.ufdManager.signalEvent("VideoCaptureDeviceFreeze",e?"Bad":"Good","Video")}),this.configProvider.mediaConfig.maxBandwidthInKbps&&this.stats.setMaxSessionBandwidth(this.configProvider.mediaConfig.maxBandwidthInKbps),this.createAudioRenderer()}return e.prototype.getAcceptedTypes=function(){return this.allowedMediaContentType},e.prototype.clone=function(t){void 0===t&&(t=!1);var n=v.shallowClone(this.context);n.config=v.shallowClone(this.context.config),n.config.webrtcMediaContentType=this.mediaContentType,n.config.webrtcAllowedMediaContentType=this.allowedMediaContentType,t?n.config.isConference=!0:(n.config.iceHostCandidateOnly=!1,this.configProvider.config.waitForRelayOnReconnect&&(n.config.webrtcIceGatheringTimeoutIncreased=!0));var i=new e(n,this.callId,this.callback);return this.relayManagerProvider&&(i.relayManagerProvider=this.relayManagerProvider),i.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,i},e.prototype.setInternals=function(e){var t=this;if(e.extensionsManager&&this.extensionsManager){var n=e.extensionsManager.getExtension(y.default.EXTENSION_TYPE.videoStreamControl);n&&n.getOptions()&&this.extensionsManager.configureExtension(y.default.EXTENSION_TYPE.videoStreamControl,n.getOptions())}e.subscriptionManager&&(this.subscriptionManager&&this.subscriptionManager.dispose(),this.subscriptionManager=e.subscriptionManager,this.subscriptionManager.setStreamProvider({getStreams:function(){return t.getStreams()},onStreamsChanged:function(e){return t.onStreamsChanged(e)}}),this.setSubsForSubscriptionManager(),this.notifyStreamsChanged()),e.audioRenderer&&(e.audioRenderer.play(this.audioRenderer.getStream()),this.audioRenderer=e.audioRenderer),e.remoteVideoManager&&e.remoteVideoManager.renderers.forEach(function(e){return t.remoteVideoManager.addRemoteRenderer(e)})},e.prototype.setSubsForSubscriptionManager=function(){var e=this;this.subscriptionManager.on("onTrackIdsChanged",function(t){return e.stats.setSubscribedTrackIds(t)}),this.subscriptionManager.on("onTrackSsrcChanged",function(t){return e.stats.setSubscribedTrackSsrc(t)}),this.subscriptionManager.on("onSubscriptionChanged",function(t,n,i){return e.stats.addSubscriptionEvent(t,n,i)})},e.prototype.move=function(e,t){e.setInternals({subscriptionManager:this.subscriptionManager,extensionsManager:this.extensionsManager,audioRenderer:this.audioRenderer,remoteVideoManager:this.remoteVideoManager}),this.doAudioMute?e.muteInputAsync(t):e.unmuteInputAsync(t),this.subscriptionManager=null,this.audioRenderer=null,this.callbacks.onTerminated=null},e.prototype.setMuteAsync=function(e,t,n){return this.logger.safe.info("["+n+"] call setMuteAsync for "+e+" with mute state "+t),this.streamSendersManager.setMuted(e,t,n),this.updateQualityLevels(this.stats.getLastStatistics()),Promise.resolve()},e.prototype.configureModalitiesAsync=function(e,t){var n=this,i=this.configuredModalitiesPromise.then(function(){if(!e||!e.audio&&!e.video&&!e.sharing)throw new Error("Invalid parameters! "+JSON.stringify(e));var i=!n.configuredModalities||!E.areNegotiatedDirectionsFulfilled(e,n.negotiatedModalities);return n.configuredModalities=e,n.logger.safe.info("["+t+"] configure modalities","audio: "+e.audio,"video: "+e.video,"sharing: "+e.sharing,"data: "+e.data,"peerconnection: "+!!n.peerConnection,"pc.signalingState: "+(n.peerConnection?n.peerConnection.signalingState:"-"),"needNewRenegotiation: "+i),i&&n.triggerRenegotiation(!1,t),n.configuredModalities});return this.configuredModalitiesPromise=i.catch(function(e){n.logger.safe.warn("["+t+"] Error during configuring modalities: "+v.stringifyObject(e))}).then(function(){}),i.then(function(){})},e.prototype.getConfiguredModalities=function(){return this.configuredModalities},e.prototype.createAudioElement=function(e){this.audioRenderer.assureAudioElement(e)},e.prototype.createOfferAsync=function(e){var t=this,n=this.negotiationQueue.add(function(){return new Promise(function(n){t.logger.safe.info("["+e+"] create [offer] configured: "+JSON.stringify(t.configuredModalities)),t.initiator=!0,t.throwIfModalitiesNotConfigured("no configured modalities to create offer for"),t.canTriggerRenegotiation=!1,t.negotiatingModalities=E.excludePassiveModalities(t.configuredModalities,t.passiveModalities,t.offeredModalities),n(t.assurePeerConnectionAsync(e).then(function(){return t.logger.safe.info("["+e+"] updatePeerConnectionStreamsAsync, pc state: "+JSON.stringify(t.peerConnection.signalingState)),t.transceiverManager&&t.transceiverManager.assureTransceivers(t.negotiatingModalities),t.assureStreamsAndDataChannel(t.negotiatingModalities,e)}).then(function(n){t.offeredModalities=n,t.configProvider.config.webrtcNegotiateDisabledDataModality&&!t.offeredModalities[y.default.MODALITY.data]&&t.multiParty&&(t.offeredModalities[y.default.MODALITY.data]=y.default.MEDIA_STATE.inactive),E.isOnHold(t.offeredModalities)&&!v.isEmpty(t.negotiatedModalities)&&Object.keys(t.offeredModalities).forEach(function(e){void 0===t.negotiatedModalities[e]&&delete t.offeredModalities[e]});var i=t.transceiverManager?{}:t.createNegotiationConstraints(t.offeredModalities);return t.logger.safe.info("["+e+"] create [offer] offered: "+JSON.stringify(t.offeredModalities)+" constraints: "+JSON.stringify(i)),t.peerConnection.createOffer(i)}).then(function(n){t.logger.unsafe.debug("["+e+"] create [offer] offer from peer connection, sdp: "+n.sdp);var i=t.sessionDescription.createLocalOffer(n.sdp);t.hasIceCandidates(i)||t.resetCandidateGathering(e),t.stats.startWaitingForStreamStart(t.offeredModalities);var r=new t.webrtcAdapter.RTCSessionDescription({sdp:i.toLocal(),type:"offer"});return t.setupIceGatheringTimeout(e),Promise.all([t.peerConnection.setLocalDescription(r),t.iceCandidatesDeferred.promise])}).then(function(){t.streamSendersManager.activate();var n=t.sessionDescription.createLocalOffer(t.peerConnection.localDescription.sdp);t.configProvider.config.insertFakeCandidateIfNeeded&&t.iceCandidateReceived&&n.insertFakeCandidateIfNeeded(t.stats.sessionInfo),n.updateModalities(t.offeredModalities),t.checkIceCandidates(n);var i=n.toOffer();t.logger.unsafe.debug("["+e+"] CREATE OFFER","sdp:",i);var r={blob:i,contentType:t.mediaContentType};return""===t.configProvider.config.webrtcRequiredFeatures||t.multiParty||(r.requiredFeatures=t.configProvider.config.webrtcRequiredFeatures),t.doRetargetIfNeeded(r,n,e),r}))})});return this.resetNegotiationQueue(),n},e.prototype.processOfferAsync=function(e,t){var n=this,i=this.negotiationQueue.add(function(){return new Promise(function(i){var r=e.blob;if(n.logger.unsafe.debug("["+t+"] process [offer]","sdp:",r),v.throwIfNotSupported(e.contentType,n.allowedMediaContentType),n.mediaContentType=e.contentType,e.requiredFeatures){var o=n.configProvider.config.webrtcRejectedFeatures.split(","),a=e.requiredFeatures.split(",");v.throwIfFeatureNotSupported(a,o)}n.initiator=!1,n.offeredDescription=n.sessionDescription.createRemoteOffer(r),n.canTriggerRenegotiation=!1,n.offeredModalities=E.invertModalities(n.offeredDescription.getModalities()),n.peerConnection||(n.context.configProvider.mediaConfig.isTransportUnbundled?n.context.configProvider.mediaConfig.isTransportUnbundled=n.offeredDescription.couldBeUnbundled():n.context.configProvider.mediaConfig.isTransportUnbundled=n.offeredDescription.isUnbundled());var s=Promise.resolve(n.offeredModalities);if(E.hasSendDirectionality(n.offeredModalities.video)||E.hasReceiveDirectionality(n.offeredModalities.video)||E.hasSendDirectionality(n.offeredModalities.sharing)||E.hasReceiveDirectionality(n.offeredModalities.sharing)){var c=n.offeredDescription.getVideoCodecs();s=n.webrtcAdapter.RTCRtpReceiver.getCapabilities("video").then(function(e){if(!e.codecs.some(function(e){return c.some(function(t){return e.mimeType===t})})){n.logger.safe.warn("["+t+"] offer doesn't contain any supported video codecs");var i=v.shallowClone(n.offeredModalities);return i.video=void 0,i.sharing=void 0,i}return n.offeredModalities}).catch(function(e){return n.logger.safe.error("["+t+"] failed to get video capability "+v.stringifyObject(e)),n.offeredModalities})}n.dataChannel||!E.hasSendDirectionality(n.offeredModalities.data)&&!E.hasReceiveDirectionality(n.offeredModalities.data)||(s=s.then(function(e){n.logger.safe.info("["+t+"] Supressing data modality as data channel is not present");var i=v.shallowClone(e);return i.data=void 0,i})),i(s.then(function(e){return n.logger.safe.info("["+t+"] process [offer] offered: "+JSON.stringify(n.offeredModalities)+" acceptable: "+JSON.stringify(e)),e}))})});return this.resetNegotiationQueue(),i},e.prototype.createAnswerAsync=function(e,t){var n=this;return new Promise(function(i){if(e)i({blob:"",contentType:n.mediaContentType});else{n.logger.safe.info("["+t+"] create [answer] offered: "+JSON.stringify(n.offeredModalities)+" configured: "+JSON.stringify(n.configuredModalities)),n.throwIfModalitiesNotConfigured("no configured modalities to create answer for"),n.negotiatingModalities=E.excludePassiveModalities(n.configuredModalities,n.passiveModalities,n.offeredModalities);var r=null,o=n.offeredDescription.getRecvCapabilities();i(n.assurePeerConnectionAsync(t).then(function(){return n.logger.safe.info("["+t+"] updatePeerConnectionStreamsAsync, pc state: "+JSON.stringify(n.peerConnection.signalingState)),r=E.negotiateModalities(n.offeredModalities,n.negotiatingModalities),n.handleCodecSwitchUnsupported(t)}).then(function(){var e=n.offeredDescription.toRemote(r);return n.logger.unsafe.info("["+t+"] create [answer] set remote description', 'negotiated:",r,"sdp:",e),n.peerConnection.setRemoteDescription(new n.webrtcAdapter.RTCSessionDescription({sdp:e,type:"offer"}))}).then(function(){return n.transceiverManager&&n.transceiverManager.syncTransceivers(r),n.assureStreamsAndDataChannel(n.negotiatingModalities,t)}).then(function(){return n.mediaManager.updateMediaEntitiesWithLocalTracks(),n.callbacks.onTransportInitialized&&n.callbacks.onTransportInitialized(),n.peerConnection.createAnswer()}).then(function(e){n.logger.unsafe.debug("["+t+"] create [answer] answer from peer connection","sdp:",e.sdp);var i=n.sessionDescription.createLocalAnswer(e.sdp);n.hasIceCandidates(i)||n.resetCandidateGathering(t),n.stats.startWaitingForStreamStart(r);var o=new n.webrtcAdapter.RTCSessionDescription({sdp:i.toLocal(),type:"answer"});return n.setupIceGatheringTimeout(t),Promise.all([n.peerConnection.setLocalDescription(o),n.iceCandidatesDeferred.promise])}).then(function(){var e=n.sessionDescription.createLocalAnswer(n.peerConnection.localDescription.sdp);n.configProvider.config.insertFakeCandidateIfNeeded&&n.iceCandidateReceived&&e.insertFakeCandidateIfNeeded(n.stats.sessionInfo),e.updateModalities(r),n.checkIceCandidates(e);var i=e.toAnswer();n.streamSendersManager.activate();var a=n.streamSendersManager.getLocalMediaSources();return n.qualityManager.updateRegisteredSources(a),n.applyReceiveCapabilities(o),r=e.getModalities(),E.areNegotiatedDirectionsAcceptable(n.configuredModalities,n.negotiatingModalities,r)||n.triggerRenegotiation(!0,t),n.setNegotiatedModalities(r),n.logger.unsafe.debug("["+t+"] CREATE ANSWER","sdp:",i),{blob:i,contentType:n.mediaContentType}}))}})},e.prototype.processAnswerAsync=function(e,t,n,i){var r=this,o=e.blob;if(this.logger.unsafe.debug(n?"["+t+"] PROCESS PRANSWER":"["+t+"] PROCESS ANSWER","sdp:",o),n)return this.logger.safe.info("["+t+"] process [pranswer] ignored"),Promise.resolve();this.mediaContentType=e.contentType,-1===this.allowedMediaContentType.indexOf(this.mediaContentType)&&this.allowedMediaContentType.push(this.mediaContentType);var a=this.sessionDescription.createRemoteAnswer(o),s=a.getRecvCapabilities(),c=E.invertModalities(a.getModalities());this.assureStreamsAndDataChannel(c,t),this.setNegotiatedModalities(c);var l=a.toRemote(this.negotiatedModalities);this.logger.unsafe.info("["+t+"] process [answer] set remote description","negotiated:",this.negotiatedModalities,"sdp:",l),this.mediaManager.updateMediaEntitiesWithLocalTracks();var u=this.streamSendersManager.getLocalMediaSources();return this.qualityManager.updateRegisteredSources(u),this.applyReceiveCapabilities(s),this.peerConnection.setRemoteDescription(new this.webrtcAdapter.RTCSessionDescription({sdp:l,type:"answer"})).then(function(){r.callbacks.onTransportInitialized&&r.callbacks.onTransportInitialized(),r.transceiverManager&&r.transceiverManager.syncTransceivers(c)})},e.prototype.completeNegotiationAsync=function(e){var t=this;return new Promise(function(n){t.mediaManager.commit();var i=E.excludePassiveModalities(t.configuredModalities,t.passiveModalities,t.offeredModalities),r=t.forceMediaStreamUpdate&&!E.isOnHold(t.negotiatedModalities)||!E.areNegotiatedDirectionsAcceptable(i,t.negotiatingModalities,t.negotiatedModalities)||t.triggerRenegotiationFlag,o=!r;t.canTriggerRenegotiation=!0,t.logger.safe.info("["+e+"] negotiation completed isComplete: "+o+" configured: "+JSON.stringify(t.configuredModalities)+" negotiating: "+JSON.stringify(t.negotiatingModalities)+" offered: "+JSON.stringify(t.offeredModalities)+" negotiated: "+JSON.stringify(t.negotiatedModalities)),r&&t.triggerRenegotiation(!1,e),t.negotiationCompletedPromise.resolve(),n({isComplete:o,activeModalities:t.negotiatedModalities,offeredModalities:t.offeredModalities,attemptedModalities:t.negotiatingModalities,configuredModalities:t.configuredModalities,initiator:t.initiator})})},e.prototype.rejectNegotiationAsync=function(e,t,n){return void 0===n&&(n=!1),i(this,void 0,void 0,function(){var i,o,a;return r(this,function(r){switch(r.label){case 0:if(this.mediaManager.rollback(),this.logger.safe.warn("["+t+"] negotiation rejected isComplete: "+!n+" error: "+e+" configured: "+JSON.stringify(this.configuredModalities)+" negotiating: "+JSON.stringify(this.negotiatingModalities)+" offered: "+JSON.stringify(this.offeredModalities)+" negotiated: "+JSON.stringify(this.negotiatedModalities)),!this.peerConnection)return[3,9];if("have-local-offer"!==this.peerConnection.signalingState)return[3,8];i={},this.logger.safe.info("["+t+"] rolling back local description"),r.label=1;case 1:return r.trys.push([1,6,,7]),this.isRollbackSupported&&!this.configProvider.config.webrtcHandleRollback?[3,3]:(i.type="LocalRN",this.logger.safe.info("["+t+"] rolling back using local renegotiation"),o=[],this.unifiedPlanEnabled&&o.push(new S.MediaRollbackModifier(this.mediaManager,this.logger)),[4,this.negotiationEmulator.renegotiate(o,!0)]);case 2:return r.sent(),this.logger.safe.info("["+t+"] rolling back using local complete"),[3,5];case 3:return this.logger.safe.info("["+t+"] rolling back using rollback"),i.type="Rollback",[4,this.peerConnection.setLocalDescription({type:"rollback"})];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:return a=r.sent(),this.logger.safe.error(a),i.error=a,[3,7];case 7:return[3,9];case 8:this.logger.safe.error("["+t+"] cannot rollback local description in currrent state: "+this.peerConnection.signalingState),r.label=9;case 9:return this.canTriggerRenegotiation=!0,this.negotiationCompletedPromise.reject("negotiation rejected"),[4,this.assureStreamsAndDataChannel(this.negotiatedModalities,t)];case 10:return r.sent(),n&&(this.logger.safe.info("["+t+"] retrying failed negotiation"),this.triggerRenegotiation(!1,t)),[2,{isComplete:!n,activeModalities:this.negotiatedModalities,offeredModalities:this.offeredModalities,attemptedModalities:this.negotiatingModalities,configuredModalities:this.configuredModalities,initiator:this.initiator,rollback:i}]}})})},e.prototype.createRemoteRenderer=function(e){var t=new d.RemoteVideoRenderer(this.logger,this.configProvider,this.subscriptionManager,e);return this.context.maContext.domOverrides.onMediaElementAdded&&this.context.maContext.domOverrides.onMediaElementAdded(t.getVideoElement()),this.remoteVideoManager.addRemoteRenderer(t),t},e.prototype.getStatsAsync=function(){var e=this;return this.stats&&!this.stats.isDisposed&&(this.statisticsReport=this.statisticsReport.then(function(){return e.stats.getReport()}).catch(function(t){return e.logger.safe.error("getting statistics should never fail: "+t.error),t.partialReport})),this.statisticsReport},e.prototype.getLastKnownStats=function(){return this.stats.getLastKnownReport()},e.prototype.isReconnectSupported=function(){return this.configProvider.config.enableReconnectChrome},e.prototype.muteInputTypeAsync=function(e,t){return i(this,void 0,void 0,function(){return r(this,function(n){return this.setMuteAsync(e,!0,t),[2]})})},e.prototype.unmuteInputTypeAsync=function(e,t){return i(this,void 0,void 0,function(){return r(this,function(n){return this.setMuteAsync(e,!1,t),[2]})})},e.prototype.muteInputAsync=function(e){return this.doAudioMute=!0,this.setMuteAsync("Audio",!0,e)},e.prototype.unmuteInputAsync=function(e){return this.doAudioMute=!1,this.setMuteAsync("Audio",!1,e)},e.prototype.muteOutputAsync=function(e){return this.audioRenderer.setMuted(!0,e)},e.prototype.unmuteOutputAsync=function(e){return this.audioRenderer.setMuted(!1,e)},e.prototype.sendDtmf=function(e){return this.dtmfSender.sendDtmf(this.peerConnection,e)},e.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.peerConnection)},e.prototype.pauseNegotiations=function(){var e=this,t=new f.SettablePromise;return this.negotiationCompletedPromise.promise.catch(function(){}).then(function(){e.setNegotiationPromise(t)}),t},e.prototype.getExtensionsManager=function(){return this.extensionsManager},e.prototype.onDeviceEvent=function(e){this.stats.onDeviceEvent(e)},e.prototype._deviceSelectionChanged=function(){this.peerConnection&&this.audioRenderer&&this.audioRenderer.getStream()&&this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId())},e.prototype.terminate=function(e,t,n){return void 0===n&&(n=!0),i(this,void 0,void 0,function(){var t;return r(this,function(i){switch(i.label){case 0:this.logger.safe.info("["+e+"] terminate"),this.stats.setTerminated(),this.terminated=!0,this.canTriggerRenegotiation=!1,this.cleanUp(e),i.label=1;case 1:return i.trys.push([1,4,5,6]),n?[4,this.getStatsAsync()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[3,6];case 4:return t=i.sent(),this.logger.safe.error("["+e+"] Error while gathering stats "+v.stringifyObject(t)),[3,6];case 5:return this.stats.dispose(),[7];case 6:return[2]}})})},e.prototype.cleanUp=function(e){this.activeSpeakerManager.dispose(),this.negotiationQueue.dispose(),this.negotiationCompletedPromise.reject("webRtcSession cleanUp"),this.remoteVideoManager.dispose(),this.dataChannel&&this.dataChannel.dispose(),this.resetPeerConnection(e),this.subscriptionManager&&this.subscriptionManager.dispose(),this.clearIceDisconnectedTimer(),this.extensionsManager&&this.extensionsManager.dispose(),this.callbacks.onTerminated&&this.callbacks.onTerminated(this)},e.prototype.resetPeerConnection=function(e){this.logger.safe.info("["+e+"] reset peer connection"),this.contributingSources.stopPolling(),this.qualityManager&&(this.qualityManager.dispose(),this.qualityManager=null),this.audioRenderer&&this.audioRenderer.dispose(),this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.streamSendersManager&&(this.streamSendersManager.dispose(),this.streamSendersManager=null),this.peerConnection&&this.peerConnection.close(),this.toBeCalledAfterConnected=[],this.videoStreamWatcher.dispose(),this.peerConnection=null,this.negotiationEmulator.configure(null),this.peerConnectionPromise=null,this.resetCandidateGathering(e),this.canTriggerRenegotiation=!0,this.negotiatedModalities={}},e.prototype.resetNegotiationQueue=function(){this.negotiationCompletedPromise.reject("promise expired"),this.setNegotiationPromise(new f.SettablePromise)},e.prototype.setNegotiationPromise=function(e){this.terminated||(this.negotiationCompletedPromise=e,this.negotiationQueue.add(this.negotiationCompletedPromise))},e.prototype.setupExtensionsManager=function(){var e=new _.default(this.logger.createChild("ExtMgr"));return e.addExtension(y.default.EXTENSION_TYPE.dominantSpeakerHistory,{logger:this.logger,callback:this.activeSpeakerManager.onDominantSpeakerHistoryChanged.bind(this.activeSpeakerManager)}),e.addExtension(y.default.EXTENSION_TYPE.videoStreamControl,{logger:this.logger,negotiationEmulator:this.negotiationEmulator,qualityManager:this.qualityManager,configProvider:this.configProvider}),e},e.prototype.resetScreenSharingStream=function(){var e=this;this.logger.safe.warn("Attemping ScreenSharing stream recovery");var t=this.receiveStreamCollection.getStreams().find(function(e){return e.getModality()===y.default.MODALITY.sharing}),n=new S.ModalityToggler(t.getMediaStream().id,this.logger.createChild("SSModalityToggler"));this.negotiationEmulator.renegotiate([n]).then(function(){return e.logger.safe.warn("ScreenSharing recovery: decoder disabled"),e.negotiationEmulator.renegotiate([n])}).then(function(){e.logger.safe.warn("ScreenSharing recovery: decoder should be active again")})},e.prototype.updateQualityLevels=function(e){if(e){this.hwSilent!==e.audioHwSilent&&(this.hwSilent=e.audioHwSilent,this.callbacks.onAudioHwSilentChanged&&this.callbacks.onAudioHwSilentChanged(this.hwSilent)),this.ufdManager.signalEvent("NetworkRecvQuality",e.networkRecvLevel),this.ufdManager.signalEvent("NetworkSendQuality",e.networkSendLevel);var t=!(!e.isSpeaking||!this.doAudioMute);this.ufdManager.signalEvent("DeviceSpeakWhileMuted",t?"Bad":"Good")}},e.prototype.triggerRenegotiation=function(e,t){void 0===t&&(t=a.generateCauseId()),this.canTriggerRenegotiation?(this.canTriggerRenegotiation=!1,this.triggerRenegotiationFlag=!1,this.logger.safe.info("["+t+"] triggering renegotiation"),this.mediaManager.backup(),this.callbacks.onNegotiationRequired&&this.callbacks.onNegotiationRequired(t)):e&&(this.logger.safe.info("["+t+"] renegotiation postponed"),this.triggerRenegotiationFlag=!0)},e.prototype.throwIfModalitiesNotConfigured=function(e){if(!this.configuredModalities)throw new Error(e)},e.prototype.handleCodecSwitchUnsupported=function(e){var t=this;return this.offeredDescription.isCodecSwitchSupported()?Promise.resolve():this.webrtcAdapter.RTCRtpReceiver.getCapabilities(y.default.MEDIA_TYPE.audio).then(function(e){var n=e.codecs.map(function(e){return e.mimeType});t.offeredDescription.usePrimaryAudioCodecOnly(n)}).catch(function(n){t.logger.safe.error("["+e+"] failed to set primary codec based on audio capability "+v.stringifyObject(n))})},e.prototype.assurePeerConnectionAsync=function(e){var t=this;if(!this.peerConnectionPromise){if(!this.relayManagerProvider)throw new Error("relay manager provider is not set!");this.logger.safe.info("["+e+"] fetching relay details from RelayManager...");var n={relayType:"turn",isRemoteClientLync:this.context.config.isRemoteClientLync,useTurnRedirector:this.configProvider.config.useTurnRedirector,turnRedirectorTimeout:this.configProvider.config.turnRedirectorTimeout};this.peerConnectionPromise=this.relayManagerProvider.getRelayManager().queryRelaysAsync(n).then(function(n){return i(t,void 0,void 0,function(){var t,i,s,c,l,u,d,p=this;return r(this,function(r){if(this.terminated)throw new Error("session already disposed");return t={optional:[]},i=U.createIceServers(n,this.configProvider.config),s=this.configureCrypto(t),this.configureCpuThreshold(t),this.logger.safe.info("create peer connection"),c=this.peerConnection=new this.webrtcAdapter.RTCPeerConnection({iceServers:i,rtcpMuxPolicy:"require",iceTransportPolicy:this.iceTransportPolicy,bundlePolicy:this.context.configProvider.mediaConfig.isTransportUnbundled?"balanced":"max-bundle",sdpSemantics:this.unifiedPlanEnabled?"unified-plan":"plan-b",audioPortRange:this.configProvider.mediaConfig.audioPortRange,videoPortRange:this.configProvider.mediaConfig.videoPortRange},t),this.isRollbackSupported=1===s&&this.unifiedPlanEnabled&&this.configProvider.userAgentConfig.isBrowserRollbackSupported,this.negotiationEmulator.configure(c),this.stats.initialize(c),this.stats.sessionInfo.setIceServers(i),this.stats.sessionInfo.setIceTransportPolicy(this.iceTransportPolicy),this.contributingSources.startPolling(),c.onnegotiationneeded=function(){p.logger.safe.info("onnegotiationneeded signalingState: "+c.signalingState)},c.onsignalingstatechange=function(){p.stats.sessionInfo.setSignalingConnectionState(c.signalingState),p.logger.safe.info("onsignalingstatechange signalingState: "+c.signalingState)},c.onicecandidateerror=function(e){var t=o(e.hostCandidate?e.hostCandidate.split(":"):[e.address,e.port],2),n=t[0],i=t[1];p.logger.safe.warn("On ICE candidate error "+e.url+" | "+n+":"+i+": code "+e.errorCode+": "+e.errorText),p.isConnected()&&!p.iceCandidatesDeferred.isPending||p.stats.addIceCandidateError({address:n,port:+i,url:e.url,errorCode:e.errorCode,errorText:e.errorText})},l=function(e,t){if(!p.isConnected())return p.logger.safe.info("ontrack handling postponed till PC is connected"),void p.toBeCalledAfterConnected.push(function(){return l(e,t)});if(p.logger.safe.info("ontrack track "+e.id+", stream: "+t.id),t.active){var n=p.mediaManager.getMediaEntityByStreamId(t.id);if(n||(p.logger.safe.info("cannot find media entity with stream id "+t.id+" trying to fallback"),t.getAudioTracks()[0]&&(n=p.mediaManager.getMediaEntitiesByModality(y.default.MODALITY.audio)[0])),n){var i=p.createReceiveStream(t,n.getModality(),+n.getXSourceStreamId());p.receiveStreamCollection.add(i),p.unifiedPlanEnabled&&(n.setRemoteTrackId(e.id),t.onremovetrack=function(e){p.logger.safe.info("onremovetrack track: "+e.track.id+", stream: "+t.id),p.receiveStreamCollection.remove(t.id)})}else p.logger.safe.error("could not find media entity for an added stream: "+t.id)}else p.logger.safe.info("ontrack ignore non active stream")},c.onaddstream=function(e){p.logger.safe.info("onaddstream stream: "+e.stream.id)},c.ontrack=function(e){return l(e.track,e.streams[0])},u=function(e){if(!p.isConnected())return p.logger.safe.info("onremovestream handling postponed till PC is connected"),void p.toBeCalledAfterConnected.push(function(){return u(e)});p.logger.safe.info("onremovestream stream: "+e.stream),p.receiveStreamCollection.remove(e.stream.id)},c.onremovestream=u,c.onicecandidate=function(t){var n=t.candidate;if(n){var r=E.parseCandidateString(n.candidate);p.logger.safe.info("["+e+"] onicecandidate candidate: prio:"+r.priority+" type:"+r.type+" port:"+r.port),p.logger.unsafe.info("["+e+"] candidate details: "+n.candidate),p.iceCandidateReceived=!0}else p.logger.safe.info("["+e+"] onicecandidate candidate: null");if(p.iceCandidatesDeferred.isPending){var o=!p.initiator||!p.context.config.webrtcIceGatheringTimeoutIncreased,a=p.iceHostCandidateOnly||0===i.length;if(!n&&o||a){n&&p.logger.safe.info("["+e+"] Not waiting for ICE candidates, hoping that host/prflx is enough"),p.logger.safe.info("["+e+"] Is connected:",p.isConnected(),c.iceConnectionState,c.signalingState);var s=!0;p.context.configProvider.mediaConfig.isTransportUnbundled&&n&&(s=p.sessionDescription.createLocalOffer(c.localDescription.sdp).hasUnbundledIceCandidates()),s&&p.completeCandidateGathering(e)}else n&&n.candidate.indexOf("typ relay")>-1&&(s=!0,p.context.configProvider.mediaConfig.isTransportUnbundled&&(s=p.sessionDescription.createLocalOffer(c.localDescription.sdp).hasUnbundledRelayIceCandidates()),s&&(p.stats.clearIceCandidateErrors(),p.completeCandidateGathering(e,{priority:n.priority||n.candidate.split(" ")[3],time:Date.now()-p.iceRelayCandidatesGatherStartTime})))}},c.onicegatheringstatechange=function(){p.logger.safe.info("onicegatheringstatechange iceGatheringState: "+c.iceGatheringState)},d=function(e,t){if(!p.terminated){var n=p.lastTransportConnectionState;if(p.lastTransportConnectionState=e,p.stats.sessionInfo.setIceConnectionState(e),"connected"===e||"completed"===e)p.onTransportConnected(t);else if("failed"===e||"closed"===e&&"failed"!==n){if(p.iceCandidatesDeferred.isPending)return p.logger.safe.info("["+t+"] ice failed while gathering candidates, suppressing error"),void p.completeCandidateGathering(t,!1);p.raiseError({type:y.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport failed"},t),p.configProvider.config.webrtcCloseAfterIceFailure&&c.close(),p.onTransportFailed()}"disconnected"===e?(p.onTransportDisconnected(t),p.startIceDisconnectedTimer(t)):p.clearIceDisconnectedTimer()}},c.oniceconnectionstatechange=function(){var t=p.wasConnected?a.generateCauseId():e;p.logger.safe.info("["+t+"] oniceconnectionstatechange iceConnectionState: "+c.iceConnectionState+" pc.signalingState: "+c.signalingState),0!==s&&T.UserAgentConfig.hasPcConnectionState()||d(c.iceConnectionState,t)},T.UserAgentConfig.hasPcConnectionState()&&(c.onconnectionstatechange=function(){var t=p.wasConnected?a.generateCauseId():e;p.logger.safe.info("["+t+"] onconnectionStatechange connectionState: "+c.connectionState+" pc.signalingState: "+c.signalingState),1===s&&d(c.connectionState,t)}),[2]})})}).then(function(){t.unifiedPlanEnabled&&(t.transceiverManager=new k.default(t.logger,t.peerConnection,t.mediaManager,t.context)),t.streamSendersManager.registerMediaConnection(A.default.build(t.peerConnection,t.transceiverManager)),t.configProvider.config.enableWebRtcDataChannel&&!t.dataChannel&&(t.dataChannel=new M.SessionDataChannel(t.peerConnection,t.logger),t.callback.onDataChannelUpdated(t.dataChannel))})}return this.peerConnectionPromise},e.prototype.configureCrypto=function(e){var t=!1,n=this.multiParty?this.configProvider.config.preferSdesSrtpMultiparty:this.configProvider.config.preferSdesSrtp1on1;if(this.offeredDescription){var i=this.offeredDescription.getSrtpInfo();this.stats.sessionInfo.setOfferedSrtpInfo(i),t=!i.dtls||i.sdes&&n}else t=n;return t&&(this.logger.safe.info("configuring peer connection to use sdes"),e.optional.push({DtlsSrtpKeyAgreement:!1})),this.stats.sessionInfo.setNegotiatedSrtpInfo({dtls:!t,sdes:!!t}),t?0:1},e.prototype.configureCpuThreshold=function(e){this.configProvider.config.webrtcNativeCpuOveruseDisabled&&this.multiParty&&e.optional.push({googCpuOveruseDetection:!1})},e.prototype.completeCandidateGathering=function(e,t){this.iceCandidatesDeferred.isPending&&(t&&this.stats.sessionInfo.setRelayCandidateInfo(t),this.logger.safe.info("["+e+"] ICE candidates gathered completely"),this.iceCandidatesDeferred.resolve())},e.prototype.onTransportConnected=function(e){if(this.logger.safe.info("["+e+"] audio transport connected"),this.stats.clearIceCandidateErrors(),!this.terminated){for(this.wasConnected=!0;this.toBeCalledAfterConnected.length;)this.toBeCalledAfterConnected.shift()();this.callbacks.onAudioStateChanged(y.default.STREAMING_STATE.active,e),this.callbacks.onTransportConnected&&this.callbacks.onTransportConnected(e)}},e.prototype.onTransportDisconnected=function(e){this.callbacks.onTransportDisconnected&&this.callbacks.onTransportDisconnected(e)},e.prototype.onTransportFailed=function(){this.callbacks.onTransportFailed&&this.callbacks.onTransportFailed()},e.prototype.startIceDisconnectedTimer=function(e){var t=this;this.configProvider.config.iceDisconnectedTimeoutMs&&(this.iceDisconnectedTimer=setTimeout(function(){t.logger.safe.error("["+e+"] ice disconnected for "+t.configProvider.config.iceDisconnectedTimeoutMs+"ms. Raise "+y.default.MEDIA_ERROR.iceConnectionError),t.raiseError({type:y.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"},e)},this.configProvider.config.iceDisconnectedTimeoutMs))},e.prototype.clearIceDisconnectedTimer=function(){this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null)},e.prototype.raiseError=function(e,t){void 0===t&&(t=a.generateCauseId()),this.logger.safe.error("["+t+"] Media error occurred type: "+e.type+" detail: "+e.detail),this.callbacks.onSessionErrorOccurred&&this.callbacks.onSessionErrorOccurred(e,t)},e.prototype.createNegotiationConstraints=function(e){function t(e){return!!e&&(E.hasReceiveDirectionality(e)||"inactive"===e)}return{offerToReceiveAudio:t(e.audio),offerToReceiveVideo:t(e.video)||t(e.sharing)}},e.prototype.resetCandidateGathering=function(e){this.logger.safe.info("["+e+"] reset candidate gathering"),this.iceCandidatesDeferred.promise.then(function(){},function(){}),this.iceCandidatesDeferred.reject(new Error("reset candidate gathering")),this.iceCandidatesDeferred=new f.SettablePromise,this.iceCandidateReceived=!1},e.prototype.checkIceCandidates=function(e){var t=this.hasIceCandidates(e);if(t===this.noIceCandidates&&(this.noIceCandidates=!this.noIceCandidates,this.ufdManager.signalEvent("NoNetwork",this.noIceCandidates?"Bad":"Good"),this.noIceCandidates))throw{type:y.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"};if(t){var n=this.hasRelayIceCandidates(e);if(n===this.noRelayIceCandidates){if(!n&&("connected"===this.peerConnection.iceConnectionState||"completed"===this.peerConnection.iceConnectionState))return;this.noRelayIceCandidates=!this.noRelayIceCandidates,this.ufdManager.signalEvent("NetworkRelaysNotReachable",this.noRelayIceCandidates?"Bad":"Good")}}},e.prototype.hasIceCandidates=function(e){return this.configProvider.mediaConfig.isTransportUnbundled?e.hasUnbundledIceCandidates():e.hasIceCandidates()},e.prototype.hasRelayIceCandidates=function(e){return this.configProvider.mediaConfig.isTransportUnbundled?e.hasUnbundledRelayIceCandidates():e.hasRelayIceCandidates()},e.prototype.doRetargetIfNeeded=function(e,t,n){var i=t.isIceRestart();this.logger.safe.info("["+n+"] ICE restart: "+i),this.context.configProvider.mediaConfig.isTransportUnbundled&&this.offeredDescription&&this.offeredDescription.isMSRTC()&&i&&!this.multiParty&&t.getSrtpInfo().sdes&&(e.newOffer=!0)},e.prototype.getStreams=function(){return this.receiveStreamCollection.getStreams()},e.prototype.onStreamsChanged=function(e){this.streamsChangedListener=e},e.prototype.notifyStreamsChanged=function(){var e=this;this.logger.safe.info("Scheduling stream changed notification: "+this.streamsChangedNotificationScheduled),this.streamsChangedNotificationScheduled||this.negotiationCompletedPromise.promise.catch(function(){}).then(function(){e.streamsChangedNotificationScheduled=!1,e.streamsChangedListener&&e.streamsChangedListener()})},e.prototype.streamAdded=function(e){return i(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return y.default.MODALITY.audio!==e.getModality()?[3,3]:[4,this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId())];case 1:return t.sent(),[4,this.audioRenderer.play(e.getMediaStream())];case 2:t.sent(),t.label=3;case 3:return y.default.MODALITY.sharing===e.getModality()&&this.videoStreamWatcher.watchStream(e.getMediaStream()),this.notifyStreamsChanged(),[2]}})})},e.prototype.streamRemoved=function(e){y.default.MODALITY.audio===e.getModality()&&this.audioRenderer.getStream()===e.getMediaStream()&&this.audioRenderer.stop(),y.default.MODALITY.sharing===e.getModality()&&this.videoStreamWatcher.stopWatchingStream(e.getMediaStream()),this.notifyStreamsChanged()},e.prototype.setNegotiatedModalities=function(e){this.negotiatedModalities=e,this.stats.sessionInfo.setNegotiatedModalities(e)},e.prototype.setupIceGatheringTimeout=function(e){var t=this;this.iceRelayCandidatesGatherStartTime=Date.now();var n=this.context.config.webrtcIceGatheringTimeoutIncreased?this.configProvider.config.relayWaitSaneTimeoutMs:this.configProvider.config.webrtcIceGatheringTimeoutMs;if(n){this.iceCandidatesTimer>0&&clearTimeout(this.iceCandidatesTimer);var i=this.iceCandidatesDeferred;this.iceCandidatesTimer=setTimeout(function(){t.iceCandidatesTimer=0,i.isPending&&(t.logger.safe.warn("["+e+"] ICE candidates gathering terminated due to timeout "+n),i.resolve())},n)}},e.prototype.isConnected=function(){return this.peerConnection&&("connected"===this.lastTransportConnectionState||"completed"===this.lastTransportConnectionState)},e.prototype.isFailed=function(){return this.peerConnection&&("failed"===this.lastTransportConnectionState||"closed"===this.lastTransportConnectionState)},e.prototype.createReceiveStream=function(e,t,n){return new L.default(e,t,n,this)},e.prototype.requestSource=function(e,t,n,i){var r=this;if(!this.multiParty)return Promise.resolve();if(this.negotiatedModalities[e]===y.default.MEDIA_STATE.inactive&&n!==h.MediaSourceIdentifiers.SourceNone)return s.delay(10).then(function(){return r.requestSource(e,t,n,i)});if(this.negotiationCompletedPromise.isPending)return this.negotiationCompletedPromise.promise.catch(function(){}).then(function(){return r.requestSource(e,t,n,i)});if(!this.isConnected()){this.logger.safe.info("requestSource is postponed till transport is connected");var o=s.defer();return this.toBeCalledAfterConnected.push(function(){return o.resolve()}),o.promise.then(function(){return r.requestSource(e,t,n,i)})}return Promise.resolve().then(function(){return r.extensionsManager.getExtension(y.default.EXTENSION_TYPE.videoStreamControl).sendSourceRequest(t,n,i)})},e.prototype.assureStreamsAndDataChannel=function(e,t){return i(this,void 0,void 0,function(){var n;return r(this,function(i){switch(i.label){case 0:return[4,this.configureHold(this.negotiatedModalities,e,t)];case 1:return i.sent()?(this.logger.safe.info("["+t+"] Hold is configured. Not updating streams"),[2,e]):[4,this.streamSendersManager.update(e,t)];case 2:return n=i.sent(),this.dataChannel&&(this.dataChannel.updateDataModalityState(e.data),e.data&&(n.data=e.data)),[2,n]}})})},e.prototype.configureHold=function(e,t,n){return i(this,void 0,void 0,function(){var i,o;return r(this,function(r){switch(r.label){case 0:return i=E.isOnHold(e),o=E.isOnHold(t),i===o?[3,2]:[4,this.streamSendersManager.setHold(o,n)];case 1:r.sent(),r.label=2;case 2:return[2,o]}})})},e.prototype.getStreamTransformConfiguration=function(){var e,t,n;return this.unifiedPlanEnabled?{ssrcRange:(e={},e[y.default.MEDIA_LABEL.audio]=0,e[y.default.MEDIA_LABEL.video]=0,e[y.default.MEDIA_LABEL.sharing]=0,e),unifiedPlanEnabled:!0}:this.multiParty?{ssrcRange:(t={},t[y.default.MEDIA_LABEL.audio]=0,t[y.default.MEDIA_LABEL.video]=this.configProvider.config.webrtcNegotiatedSsrcRangeForVideo,t[y.default.MEDIA_LABEL.sharing]=this.configProvider.config.webrtcNegotiatedSsrcRangeForSharing,t),unifiedPlanEnabled:!1}:{ssrcRange:(n={},n[y.default.MEDIA_LABEL.audio]=0,n[y.default.MEDIA_LABEL.video]=this.configProvider.config.webrtcNegotiatedSsrcRangeForVideoOneToOne,n[y.default.MEDIA_LABEL.sharing]=this.configProvider.config.webrtcNegotiatedSsrcRangeForSharingOneToOne,n),unifiedPlanEnabled:!1}},e.prototype.applyReceiveCapabilities=function(e){this.multiParty||this.qualityManager.setMaxCapabilities(e)},e.prototype.onReceiveCapabilitiesChanged=function(e,t,n){var i=this;return this.streamSendersManager?this.streamSendersManager.applyCapabilities(e,n).then(function(){return i.stats.onMaxCapabilitiesApplied({modality:e,causeId:t,capabilities:n}),!0}).catch(function(r){return i.logger.safe.error("Error applying Capabilities "+v.stringifyObject(r)),i.stats.onMaxCapabilitiesApplied({modality:e,causeId:t,capabilities:n,error:r}),!1}):Promise.resolve(!1)},e.prototype.onOptimalVideoReceiversCountChanged=function(e){this.callback.onOptimalVideoReceiversCountChanged&&this.callback.onOptimalVideoReceiversCountChanged(e)},e.prototype.onSendBandwidthChanged=function(e){return i(this,void 0,void 0,function(){var t,n,i=this;return r(this,function(r){return this.isConnected()?(t=this.extensionsManager.getExtension(y.default.EXTENSION_TYPE.videoStreamControl),0===(n=this.mediaManager.getMediaEntities().filter(function(e){return[y.default.MODALITY.video,y.default.MODALITY.sharing].indexOf(e.getModality())>-1}).filter(function(e){return e.isEnabled()}).map(function(e){return e.getMid()})).length?[2]:[2,t.sendBandwidthInfo(n,e).then(function(){i.stats.setReportedSendBandwidth(e)})]):[2]})})},e.prototype.onMaxVideoSendCapabilitiesChanged=function(e,t){var n=this;if("Video"===e&&this.configProvider.config.maxSendVideoCapabilitiesReportingForVideoEnabled||"ScreenShare"===e&&this.configProvider.config.maxSendVideoCapabilitiesReportingForSharingEnabled)return this.isConnected()?void this.notifyMaxVideoCapabilitiesChanged(e,t):(this.logger.safe.info("sendMaxVideoSendCapabilities is postponed till transport is connected"),void this.toBeCalledAfterConnected.push(function(){return n.notifyMaxVideoCapabilitiesChanged(e,t)}))},e.prototype.notifyMaxVideoCapabilitiesChanged=function(e,t){var n=this.extensionsManager.getExtension(y.default.EXTENSION_TYPE.videoStreamControl),i=E.mediaTypeToModality(e),r=this.mediaManager.getMediaEntitiesByModality(i)[0];if(r){var o=r.getMid();n.sendMaxVideoSendCapabilities([o],t)}},e.prototype.createAudioRenderer=function(){this.audioRenderer=new u.default(this.logger.createChild("AudioRenderer"),this.configProvider),this.context.maContext.domOverrides.onMediaElementAdded&&this.audioRenderer.on("onAudioElementAdded",this.context.maContext.domOverrides.onMediaElementAdded),this.context.maContext.domOverrides.onMediaElementRemoved&&this.audioRenderer.on("onAudioElementRemoved",this.context.maContext.domOverrides.onMediaElementRemoved)},e}();t.default={build:function(e,t,n){return new B(e,t,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.peerConnection=e}return Object.defineProperty(e.prototype,"connectionState",{get:function(){return this.peerConnection.connectionState},enumerable:!0,configurable:!0}),e.prototype.createSender=function(e,t,n){return this.peerConnection.addTrack(e,t)},e.prototype.removeSender=function(e){this.peerConnection.removeTrack(e)},e}();t.MediaConnection=i;var r=function(){function e(e,t){this.peerConnection=e,this.tranceiverManager=t}return Object.defineProperty(e.prototype,"connectionState",{get:function(){return this.peerConnection.connectionState},enumerable:!0,configurable:!0}),e.prototype.createSender=function(e,t,n){return this.tranceiverManager.createSender(e,t,n)},e.prototype.removeSender=function(e){return this.tranceiverManager.removeSender(e)},e}(),o=function(){function e(){}return e.build=function(e,t){return t?new r(e,t):new i(e)},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(110),r=n(265),o=function(){function e(){}return e.build=function(e){return e.unifiedPlanEnabled?new r.default(e):new i.default(e)},e}();t.MediaManagerFactory=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(111),o=n(28),a=n(2),s=function(){function e(e){this.mediaEntities=[],this.mediaEntitiesBackup=[],this.mediaTracks=[],this.logger=e.logger.createChild("MM2"),this.configProvider=e.configProvider}return e.prototype.fromOffer=function(e,t){this.syncModalities(e,t)},e.prototype.fromRemote=function(e,t){var n=this;this.syncModalities(e,t),e.media.forEach(function(e,t){var i=n.getMediaEntityByMid(e.mid);if(i){n.saveMsid(i,e);var r=e.xSourceStreamId||n.generateSourceStreamId(t);i.setXSourceStreamId(r)}})},e.prototype.saveMsid=function(e,t){if(t.msid)e.setStreamId(t.msid.split(" ")[0]),e.setRemoteTrackId(t.msid.split(" ")[1]);else if(t.ssrcs){var n=i.find(t.ssrcs,function(e){return"msid"===e.attribute});n?(e.setStreamId(n.value.split(" ")[0]),e.setRemoteTrackId(n.value.split(" ")[1]),e.setRemoteSsrc(n.id.toString())):this.logger.safe.warn("No ssrc msid for media of type "+t.type+" with mid "+t.mid)}},e.prototype.isEmpty=function(){return 0===this.mediaEntities.length},e.prototype.getMediaEntities=function(){return this.mediaEntities},e.prototype.getMediaEntity=function(e){return this.mediaEntities[e]},e.prototype.getMediaEntityByMid=function(e){return i.find(this.mediaEntities,function(t){return t.getMid()===e})},e.prototype.getMediaEntitiesByModality=function(e){return this.mediaEntities.filter(function(t){return t.getModality()===e})},e.prototype.getMediaEntityByStreamId=function(e){return i.find(this.mediaEntities,function(t){return t.getStreamId()===e})},e.prototype.getMediaEntityByLocalTrackId=function(e){return i.find(this.mediaEntities,function(t){return t.getLocalTrackIds().indexOf(e)>=0})},e.prototype.getMediaEntityByXSourceStreamId=function(e){return i.find(this.mediaEntities,function(t){return t.getXSourceStreamId()===e})},e.prototype.reset=function(){this.mediaEntities=[]},e.prototype.syncModalities=function(e,t,n){var i=this;if(void 0===n&&(n=!1),e.media.forEach(function(e,t){i.mediaEntities[t]?0===e.port?i.mediaEntities[t].disable():i.mediaEntities[t].update(i.mediaEntities[t].getModality(),e.mid||i.mediaEntities[t].getMid()):n||i.addMediaEntity(o.getModality(e),e.mid)}),!n&&a.default.MODALITY.sharing in t&&!this.getMediaEntitiesByModality(a.default.MODALITY.sharing).length){var r=this.getMediaEntitiesByModality(a.default.MODALITY.video).pop();r.update(a.default.MODALITY.sharing,r.getMid())}},e.prototype.addMediaEntity=function(e,t){this.mediaEntities.push(r.default.create(this.configProvider,e,t))},e.prototype.setLocalTracksInfo=function(e){this.mediaTracks=e},e.prototype.getLocalTracksInfo=function(){return this.mediaTracks},e.prototype.backup=function(){var e=this;this.mediaEntitiesBackup=[],this.mediaEntities.forEach(function(t){e.mediaEntitiesBackup.push(t.clone())})},e.prototype.commit=function(){this.mediaEntitiesBackup=[]},e.prototype.rollback=function(){var e=this;this.mediaEntitiesBackup.length&&this.mediaEntities.forEach(function(t,n){e.mediaEntitiesBackup[n]?e.mediaEntities[n]=e.mediaEntitiesBackup[n]:t.disable()})},e.prototype.generateSourceStreamId=function(e){return e+10},e.prototype.updateMediaEntitiesWithLocalTracks=function(){var e=this;if(this.mediaTracks){var t=new Map;this.mediaTracks.forEach(function(e){var n=t.get(e.modality);n?n.push(e.trackId):t.set(e.modality,[e.trackId])}),t.forEach(function(t,n){var i=e.getMediaEntitiesByModality(n)[0];i?i.setLocalTrackIds(t):e.logger.safe.error("Media entity is not found for modality: "+JSON.stringify(n))})}},e}();t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),c=n(0),l=n(2),u=n(267),d=n(11),p=function(e){function t(t,n){var i=e.call(this)||this;return i.pc=t,i.dataChannels=new Map,i._state=0,i.logger=n.createChild("PluginlessDataChannel"),i.subscribeOnDatachannel(),i}return r(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),t.prototype.getDataChannel=function(e,t,n){if(void 0===n&&(n=null),!this.dataChannels.has(e))try{var i={};n&&(i.id=n,i.negotiated=!0);var r=new u.WebRtcDataChannel(this.pc.createDataChannel(e,i),this.logger);this.dataChannels.set(e,r),this.subscribeForDataChannelEvents(r)}catch(e){return this.logger.safe.warn("["+t+"] createDataChannel failed: "+c.stringifyObject(e)),null}return this.dataChannels.get(e)},t.prototype.getMainChannel=function(e){return this.getDataChannel("main-channel",e,1)},t.prototype.updateDataModalityState=function(e){e===l.default.MEDIA_STATE.sendReceive?this.setState(1):this.setState(0)},t.prototype.dispose=function(){this.removeAllDataChannels(),e.prototype.dispose.call(this)},t.prototype.subscribeOnDatachannel=function(){var e=this;this.pc.ondatachannel=function(t){e.addDataChannel(new u.WebRtcDataChannel(t.channel,e.logger))}},t.prototype.addDataChannel=function(e){this.logger.safe.info("add DataChannel label="+e.label);var t=this.dataChannels.get(e.label);t&&(this.logger.safe.warn("another data channel with label="+e.label+" already exists, dispose it"),t.dispose(),this.dataChannels.delete(e.label)),this.dataChannels.set(e.label,e),this.subscribeForDataChannelEvents(e)},t.prototype.subscribeForDataChannelEvents=function(e){var t=this;e.on("onStateChanged",function(){"Destroyed"===e.state&&t.dataChannels.has(e.label)&&(t.dataChannels.get(e.label).dispose(),t.dataChannels.delete(e.label))})},t.prototype.setState=function(e){if(this._state!==e){var t=d.generateCauseId();this._state=e,this.logger.safe.info("["+t+"] SessionDataChannelState changed, state="+this._state),0===this._state?this.removeAllDataChannels():1===this._state&&this.getMainChannel(t),this.event("onStateChanged").raise(this._state)}},t.prototype.removeAllDataChannels=function(){var e,t;this.logger.safe.info("removeAllDataChannels");try{for(var n=o(this.dataChannels),i=n.next();!i.done;i=n.next())a(i.value,2)[1].dispose()}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.dataChannels.clear()},t}(s.default);t.SessionDataChannel=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(0),s=function(e){function t(t,n){var i=e.call(this)||this;return i.dataChannel=t,i.stateInternal="Created",i.label=t.label,i.logger=n.createChild("[WebRtcDataChannel "+i.label+"]"),i.subscribeOnDataChannelEvents(),i}return r(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this.stateInternal},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null,this.setState("Destroyed"),e.prototype.dispose.call(this))},t.prototype.sendMessage=function(e,t){var n={msg:e,sourceId:1,recipients:t};this.dataChannel.send(JSON.stringify(n))},t.prototype.subscribeOnDataChannelEvents=function(){var e=this;this.dataChannel.onmessage=function(t){try{var n=JSON.parse(t.data);e.event("onmessage").raise(n.msg,n.sourceId)}catch(t){e.logger.safe.warn("failed to parse incoming message: "+a.stringifyObject(t))}},this.dataChannel.onerror=function(t){e.logger.safe.warn("onerror: "+a.stringifyObject(t))},this.dataChannel.onopen=function(){e.logger.safe.debug("onopen"),e.setState("Connected")},this.dataChannel.onclose=function(){e.logger.safe.debug("onclose"),e.setState("Closed")},this.dataChannel.onbufferedamountlow=function(){e.logger.safe.debug("onbufferedamountlow")}},t.prototype.setState=function(e){this.stateInternal=e,this.event("onStateChanged").raise()},t}(o.default);t.WebRtcDataChannel=s},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=n(14),c=n(12),l=n(2),u=n(9),d=n(27),p=[l.default.MODALITY.audio,l.default.MODALITY.video,l.default.MODALITY.sharing],f=function(){function e(e,t,n,i){this.peerConnection=t,this.mediaManager=n,this.transceiverModality=new Map,this.logger=e.createChild("TM"),this.configProvider=i.configProvider,this.isMultiparty=i.config.isConference,this.numVideoChannels=this.isMultiparty&&this.configProvider.config.numVideoChannelsGvc||1}return e.prototype.getTransceivers=function(){return this.peerConnection.getTransceivers().filter(function(e){return!e.stopped})},e.prototype.assureTransceivers=function(e){var t=this;this.mediaManager.getMediaEntities().forEach(function(e){-1!==p.indexOf(e.getModality())&&(t.getTransceivers().find(function(t){return t.mid===e.getMid()})||t.createTransceiversForModality(e.getModality(),1))}),e.sharing=e.sharing||l.default.MEDIA_STATE.inactive,p.forEach(function(e){if(!t.mediaManager.getMediaEntities().find(function(t){return e===t.getModality()})){var n=e===l.default.MODALITY.video?t.numVideoChannels:1;t.createTransceiversForModality(e,n)}}),this.setDirections(e),this.logTransceiversInfo("assureTransceivers")},e.prototype.createTransceiversForModality=function(e,t){var n=this;this.logger.safe.info("createTransceiversForModality: modality="+e+", number="+t);var i=e===l.default.MODALITY.audio?l.default.MEDIA_TYPE.audio:l.default.MEDIA_TYPE.video;a.times(t,function(){var t=n.peerConnection.addTransceiver(i,{direction:"inactive"});n.setCodecPreferences(t,i,!0),n.addTransceiverToModality(t,e)})},e.prototype.setCodecPreferences=function(e,t,n){var i,a,s,u,p=t===l.default.MEDIA_TYPE.audio?this.isMultiparty?this.configProvider.config.allowedAudioCodecsMultiparty:this.configProvider.config.allowedAudioCodecs1on1:this.isMultiparty?this.configProvider.config.allowedVideoCodecsMultiparty:this.configProvider.config.allowedVideoCodecs1on1;if(p&&p.length&&d.UserAgentConfig.hasCapabilitiesApi()){var f=c.default.window.RTCRtpReceiver.getCapabilities(t);if(f){var g=[];if(n){var m=function(e){var t=f.codecs.filter(function(t){return h(e,t)});g.push.apply(g,r(t))};try{for(var v=o(p),y=v.next();!y.done;y=v.next())m(y.value)}catch(e){i={error:e}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}}else{var S=function(e){p.some(function(t){return h(t,e)})&&g.push(e)};try{for(var _=o(f.codecs),E=_.next();!E.done;E=_.next())S(E.value)}catch(e){s={error:e}}finally{try{E&&!E.done&&(u=_.return)&&u.call(_)}finally{if(s)throw s.error}}}g.length&&e.setCodecPreferences(g)}}},e.prototype.createSender=function(e,t,n){var i=this.assosiateTrackWithTransceiver(e,t,n);if(!i)throw new Error("Transceiver for modality="+n+" is not found");return i.direction=n===l.default.MODALITY.sharing?l.default.MEDIA_STATE.send:l.default.MEDIA_STATE.sendReceive,"Firefox"===s.getBrowserInfo().name&&i.sender.setParameters({encodings:[{active:!0}]}),i.sender},e.prototype.removeSender=function(e){var t=this.getTransceivers().find(function(t){return t.sender===e});if(!t)throw new Error("Transceiver for sender with track="+(e.track&&e.track.id)+" is not found");this.logger.safe.info("Remove sender with track="+(e.track&&e.track.id)+" for transceiver mid="+t.mid),this.peerConnection.removeTrack(e)},e.prototype.assosiateTrackWithTransceiver=function(e,t,n){var i=this,r=this.findAvailableTransceiverToSend(n);return r?(this.logger.safe.info("Associate track="+e.id+" ("+n+") with existing transceiver mid="+r.mid),r.sender.replaceTrack(e).catch(function(e){throw i.logger.safe.error("replaceTrack failed, err "+JSON.stringify(e)),e}),r):null},e.prototype.syncWithMediaEntities=function(){var e=this;this.transceiverModality.clear();var t=this.getTransceivers();this.mediaManager.getMediaEntities().filter(function(e){return e.isEnabled()}).forEach(function(n){var i=n.getModality(),r=t.find(function(e){return e.mid===n.getMid()});r&&e.addTransceiverToModality(r,i)}),this.logTransceiversInfo("syncWithMediaEntities")},e.prototype.getTransceiversByModality=function(e){return this.transceiverModality.has(e)?this.transceiverModality.get(e).filter(function(e){return!e.stopped}):[]},e.prototype.syncTransceivers=function(e){this.syncWithMediaEntities(),this.setDirections(e)},e.prototype.setDirections=function(e){this.transceiverModality.forEach(function(t,n){t.forEach(function(t){t.direction=e[n]||l.default.MEDIA_STATE.inactive})}),this.getTransceiversByModality(l.default.MODALITY.video).slice(1).forEach(function(t){var n,i;t.direction=(n=e[l.default.MODALITY.video],i=n,u.hasSendDirectionality(n)&&(i=u.removeSendDirectionality(n)),i||l.default.MEDIA_STATE.inactive)}),this.logTransceiversInfo("setDirections")},e.prototype.findAvailableTransceiverToSend=function(e){return this.getTransceiversByModality(e)[0]},e.prototype.addTransceiverToModality=function(e,t){this.transceiverModality.has(t)?this.transceiverModality.get(t).push(e):this.transceiverModality.set(t,[e])},e.prototype.logTransceiversInfo=function(e){var t=e+": transceivers details:";this.transceiverModality.forEach(function(e,n){t+=" "+n+"("+e.length+") ["+e.map(function(e){return"mid="+e.mid+", direction="+e.direction}).join(";")+"]"}),this.logger.safe.debug(t)},e}();function h(e,t){return!(!a.isUndefined(e.channels)&&e.channels!==t.channels||!a.isUndefined(e.clockRate)&&e.clockRate!==t.clockRate||!a.isUndefined(e.mimeType)&&e.mimeType!==t.mimeType||!a.isUndefined(e.sdpFmtpLine)&&-1===t.sdpFmtpLine.indexOf(e.sdpFmtpLine))}t.default=f},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},c=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(6),d=n(21),p=n(98),f=n(56),h=n(0),g=n(2),m=n(9),v=n(118),y=n(270),S=function(e){function t(t,n,i,r,o,a,s){var c,l=e.call(this)||this;return l.mediaManager=t,l.settings=n,l.logger=i,l.configProvider=o,l.isMultiparty=s,l.senders=new Map,l.displayStreamSubscriptions=new Map,l.previousMediaModalitites=((c={}).Audio=!1,c.Video=!1,c.ScreenShare=!1,c),l.ssrcGenerator=new f.default,l.serialQueue=new d.PromiseQueue(l.logger),l.muted=new Map([["Audio",!1],["Video",!1]]),l.subs=new Map,l.streamsProvider=new p.SessionStreamsProvider(r,l.serialQueue,l.logger.createChild("StreamsProvider")),l.subscribeToStreamProviderEvents(l.streamsProvider),l.localVideoStreamWatcher=new v.LocalVideoStreamWatcher(a,l.logger,l.configProvider),l.subscribeToStreamWatcherEvents(),l}return r(t,e),Object.defineProperty(t.prototype,"mixer",{get:function(){return this.streamsProvider.streams.Audio&&this.streamsProvider.streams.Audio.getMixer()},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.senders.forEach(function(e){return e.dispose()}),this.senders.clear(),this.subs.forEach(function(e){return e.dispose()}),this.subs.clear(),this.displayStreamSubscriptions.forEach(function(e){return e.dispose()}),this.displayStreamSubscriptions.clear(),this.mediaConnection=null,this.unsubscribeFromStreamProviderEvents(),this.streamsProvider.stop(),this.streamsProvider=null,this.localVideoStreamWatcher.dispose(),this.localVideoStreamWatcher=null,this.mediaManager=null,this.settings=null,this.logger=null},t.prototype.registerMediaConnection=function(e){this.mediaConnection=e},t.prototype.update=function(e,t){return o(this,void 0,void 0,function(){var n,i;return a(this,function(r){switch(r.label){case 0:return n=m.getSendMediaModalities(e),[4,this.updateStreams(n)];case 1:return i=r.sent(),[4,this.updateSenders()];case 2:return r.sent(),this.applyState(t),this.updateLocalTracksInfo(),this.previousMediaModalitites=h.shallowClone(i),[2,m.mergeSendModalities(e,this.previousMediaModalitites)]}})})},t.prototype.activate=function(){return o(this,void 0,void 0,function(){var e=this;return a(this,function(t){switch(t.label){case 0:return[4,Promise.all(c(this.senders.values()).map(function(t){return o(e,void 0,void 0,function(){return a(this,function(e){return[2,t.activate()]})})}))];case 1:return t.sent(),[2]}})})},t.prototype.applyCapabilities=function(e,t){return o(this,void 0,void 0,function(){var n,i;return a(this,function(r){return n=m.modalityToMediaType(e),(i=this.senders.get(n))?(this.logger.safe.info("Applying capabilities "+JSON.stringify(t)+" to mediaType: "+JSON.stringify(n)),[2,i.updateParameters(t)]):(this.logger.safe.info("Capabilities ignored "+JSON.stringify(t)+" ignored, no sender for media type "+JSON.stringify(n)),[2])})})},t.prototype.getLocalMediaSources=function(){var e=this,t=this.getTracksInfo(),n=[];return t.forEach(function(t){n.some(function(e){return e.modality===t.modality})||n.push({sourceId:e.getSourceIdForTrack(t),modality:t.modality,defaultSSRC:t.ssrc})}),n},t.prototype.setMuted=function(e,t,n){this.muted.set(e,t),this.applyState(n)},t.prototype.setHold=function(e,t){return o(this,void 0,void 0,function(){var n=this;return a(this,function(i){switch(i.label){case 0:return[4,Promise.all(c(this.senders.values()).map(function(i){return o(n,void 0,void 0,function(){return a(this,function(n){return[2,i.setHold(e,t)]})})}))];case 1:return i.sent(),[2]}})})},t.prototype.applyState=function(e){var t,n;try{for(var i=l(this.muted),r=i.next();!r.done;r=i.next()){var o=s(r.value,2),a=o[0],c=o[1];this.senders.get(a)&&this.senders.get(a).setMuted(c,e)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},t.prototype.updateLocalTracksInfo=function(){var e=this.getTracksInfo();this.mediaManager.setLocalTracksInfo(e)},t.prototype.getTracksInfo=function(){var e=[];return this.senders.forEach(function(t,n){var i=t.getTrackInfo().map(function(e){return{modality:m.mediaTypeToModality(n),trackId:e.trackId,ssrc:e.ssrc}});e.push.apply(e,c(i))}),e},t.prototype.updateStreams=function(e){return o(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return[4,this.streamsProvider.start(e)];case 1:return t=n.sent(),this.logger.safe.info("Streams updated, modalities requested: "+JSON.stringify(e)+", result: "+JSON.stringify(t)),[2,t]}})})},t.prototype.updateSenders=function(){return o(this,void 0,void 0,function(){var e,t=this;return a(this,function(n){switch(n.label){case 0:return e=m.sendStreamsToModalities(this.streamsProvider.streams),[4,Promise.all(h.keys(e).map(function(n){return o(t,void 0,void 0,function(){var t,i,r;return a(this,function(o){switch(o.label){case 0:return t=e[n],i=this.previousMediaModalitites[n],t===i?(this.logger.safe.info("Sender for mediaType: "+JSON.stringify(n)+" are not changed"),[2]):t?[3,2]:(this.logger.safe.info("Removing sender for mediaType: "+JSON.stringify(n)),[4,this.removeSender(n)]);case 1:return o.sent(),this.logger.safe.info("Removing sender for mediaType: "+JSON.stringify(n)),[2];case 2:return r=this.streamsProvider.streams[n],[4,this.createAndStartSender(r,n)];case 3:return o.sent(),this.logger.safe.info("Sender for mediaType: "+JSON.stringify(n)+" is added"),"ScreenShare"===r.mediaType&&this.addAudioSharingStream(),[2]}})})}))];case 1:return n.sent(),this.logger.safe.info("Senders updated"),[2]}})})},t.prototype.createAndStartSender=function(e,t){var n=this;if(this.senders.get(t))throw new Error("Sender already created, modality: "+JSON.stringify(t));var i=new MediaStream,r="Audio"===t||!this.isMultiparty,o=new y.SimulcastStreamSender(this.mediaConnection,e,i,this.getSimulcastStreamCount(t),this.getSsrcRangeForMediaType(t),this.serialQueue,this.logger.createChild("Sender_"+JSON.stringify(t)),this.configProvider,r);return this.senders.set(t,o),this.subs.set(o,o.on("onSendersParamsChanged",function(e){return n.onActiveSendersChanged(t,e)})),o.start().then(function(){if("Video"===t){var e=n.getTracksInfo().filter(function(e){return e.modality===g.default.MODALITY.video});n.localVideoStreamWatcher.startWatching(e)}})},t.prototype.onActiveSendersChanged=function(e,t){var n={};t.forEach(function(e){n[e.ssrc]=e}),this.event("onActiveLayoutsChanged").raise(e,n)},t.prototype.getSimulcastStreamCount=function(e){switch(e){case"Video":return this.settings.streamsCountForVideo;case"ScreenShare":return this.settings.streamsCountForSharing;default:return 1}},t.prototype.getSsrcRangeForMediaType=function(e){switch(e){case"Audio":return this.ssrcGenerator.nextAudioStreamSsrc();case"Video":case"ScreenShare":return this.ssrcGenerator.nextVideoStreamSsrc();default:return{min:1,max:1}}},t.prototype.removeSender=function(e){return o(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this.senders.has(e)?("Video"===e&&this.localVideoStreamWatcher.stopWatching(),[4,(t=this.senders.get(e)).dispose()]):[3,2];case 1:n.sent(),this.senders.delete(e),this.subs.get(t).dispose(),this.subs.delete(t),this.logger.safe.info("Removed sender with mediaType: "+JSON.stringify(e)),n.label=2;case 2:return[2]}})})},t.prototype.getSourceIdForTrack=function(e){var t=e.trackId,n=this.mediaManager.getMediaEntityByLocalTrackId(t);return n?(this.logger.safe.info("Media entity found: "+JSON.stringify(n.getXSourceStreamId())),n.getXSourceStreamId()):(this.logger.safe.error("Media entity is not found for stream: "+JSON.stringify(t)),0)},t.prototype.subscribeToStreamProviderEvents=function(e){var t=this;this.streamProviderSubscriptions=[e.on("onStreamAdded",function(e){return t.onStreamUpdated(e)}),e.on("onStreamUpdated",function(e){return t.onStreamUpdated(e)})]},t.prototype.unsubscribeFromStreamProviderEvents=function(){this.streamProviderSubscriptions.forEach(function(e){return e.dispose()}),this.streamProviderSubscriptions=null},t.prototype.subscribeToStreamWatcherEvents=function(){var e=this;this.localVideoStreamWatcher.on("onVideoCaptureFreeze",function(t){e.event("onVideoCaptureFreeze").raise(t)})},t.prototype.onStreamUpdated=function(e){if(this.senders.has(e)){var t=this.streamsProvider.streams[e];t||(this.logger.safe.info("Stream is missing for mediaType: "+e+", using fake stream..."),t=new _(e,this.logger.createChild("NullStreamClient"))),"Audio"===t.mediaType&&this.addAudioSharingStream(),this.senders.get(e).updateStream(t)}else this.logger.warn("Sender with media type "+e+" does not exist, do not update media stream")},t.prototype.addAudioSharingStream=function(){var e=this,t=this.streamsProvider.streams.ScreenShare;this.mixer&&t&&t.hasAudio()&&(this.mixer.addSourceStream(t),this.streamProviderSubscriptions.push(this.mixer.on("onAudioScreenSharingDisposed",function(t){return e.event("onAudioScreenSharingDisposed").raise(t)})))},t}(u.default);t.StreamSendersManager=S;var _=function(e){function t(t,n){var i=e.call(this)||this;return i.logger=n,i.id=-1,i.parentId=-1,i.rawStream=null,i.rawTrack=null,i.mediaType=t,i}return r(t,e),t.prototype.start=function(){return this.logger.safe.debug("start"),Promise.reject(new Error("Can't start null stream"))},t.prototype.clone=function(){return this.logger.safe.debug("clone"),this},t.prototype.setMuted=function(e,t){this.logger.safe.debug("setMuted")},t.prototype.setHold=function(e){this.logger.safe.debug("setHold")},t.prototype.getResolution=function(){return this.logger.safe.debug("getResolution"),{width:240,height:180}},t.prototype.getFrameRate=function(){return this.logger.safe.debug("getFrameRate"),1},t.prototype.hasAudio=function(){return this.logger.safe.debug("hasAudio"),!1},t.prototype.hasVideo=function(){return this.logger.safe.debug("hasVideo"),!1},t.prototype.isSameStream=function(e){return this.logger.safe.debug("isSameStream"),e===this},t.prototype.applyCapabilities=function(e){return this.logger.safe.debug("applyCapabilities"),Promise.resolve(!1)},t.prototype.onApplyConstraints=function(e){this.logger.safe.debug("onApplyConstraints")},t.prototype.update=function(e){this.logger.safe.debug("update")},t.prototype.getMixer=function(){return null},t}(u.default)},function(e,t,n){"use strict";var i,r,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(6),d=n(55),p=n(0),f=n(271),h=n(272),g=function(e){function t(n,i,r,o,a,s,c,l,u){var d=e.call(this)||this;return d.mediaConnection=n,d.mainStream=i,d.contextStream=r,d.sendersCount=o,d.ssrcRange=a,d.serialQueue=s,d.logger=c,d.configProvider=l,d.isAlwaysActive=u,d.id=t.senderId++,d.senders=[],d.trackInfo=[],d.isMuted=!1,d.isHold=!1,d.previousParameters=[],d.state=new f.StateMachine(t.transitionStates,"NotStarted",d.logger),d}return o(t,e),t.prototype.start=function(){return c(this,void 0,void 0,function(){return l(this,function(e){return this.state.setState("Started")?(this.senders=this.createSenderModel(this.ssrcRange.min,this.sendersCount),this.trackInfo=this.createTrackInfo(),[2]):[2]})})},t.prototype.activate=function(){return c(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return this.state.setState("Active")?this.isAlwaysActive?(this.logger.safe.info("Sender set to always active. Do not stopping"),[2]):[4,Promise.all(this.senders.map(function(e){return e.stop()}))]:[2];case 1:return e.sent(),[2]}})})},t.prototype.updateStream=function(e){return c(this,void 0,void 0,function(){var t=this;return l(this,function(n){switch(n.label){case 0:return this.state.isCurrentStateMatches("Active")?this.mainStream===e?(this.logger.safe.info("Stream has not been changed. Skipping update"),[2]):(this.mainStream.dispose(),this.mainStream=e,[4,Promise.all(this.senders.map(function(e){return e.setStream(t.mainStream)}))]):[2];case 1:return n.sent(),[2]}})})},t.prototype.updateParameters=function(e){return c(this,void 0,void 0,function(){var t,n;return l(this,function(i){switch(i.label){case 0:return this.state.isCurrentStateMatches("Active")?e.length<0?(this.logger.safe.error("No params defined"),[2]):(1!==e.length||e[0].ssrc||(this.logger.safe.info("Ssrc for params not set, applying to first available sender with ssrc: "+this.senders[0].ssrc),e[0].ssrc=this.senders[0].ssrc),[4,this.applyParameters(e)]):[2];case 1:return i.sent(),t=this.senders.filter(function(t){return e.some(function(e){return e.ssrc===t.ssrc})}),n=p.subtractFrom(this.senders,t),[4,Promise.all(t.map(function(e){return e.start()}))];case 2:return i.sent(),[4,Promise.all(n.map(function(e){return e.stop()}))];case 3:return i.sent(),p.compareArraysBy(this.previousParameters,e,function(e,t){return e.ssrc===t.ssrc})||(this.previousParameters=e,this.event("onSendersParamsChanged").raise(e)),[2]}})})},t.prototype.dispose=function(){return c(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return this.state.setState("Disposed")?(this.logger.safe.info("Disposing streamSender with "+this.senders.length+" active senders"),[4,Promise.all(this.senders.map(function(e){return e.dispose()}))]):[2];case 1:return e.sent(),this.mainStream.dispose(),this.mainStream=null,this.senders=[],this.contextStream=null,this.event("onSendersParamsChanged").raise([]),[2]}})})},t.prototype.setHold=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){switch(n.label){case 0:return this.isHold===e?(this.logger.safe.info("["+t+"] Already in hold="+e+" state"),[2]):(this.logger.safe.info("["+t+"] Setting hold to: "+e),this.isHold=e,[4,Promise.all(this.senders.map(function(n){return n.setHold(e,t)}))]);case 1:return n.sent(),[2]}})})},t.prototype.setMuted=function(e,t){var n=this;this.isMuted!==e?(this.logger.safe.info("["+t+"] Setting muted to: "+e),this.isMuted=e,this.senders.forEach(function(e){return e.setMuted(n.isMuted,t)})):this.logger.safe.info("["+t+"] Already in muted="+e+" state")},t.prototype.getTrackInfo=function(){return this.trackInfo},t.prototype.createTrackInfo=function(){return this.senders.map(function(e){return{trackId:e.trackId,ssrc:e.ssrc}})},t.prototype.createSenderModel=function(e,t){for(var n=[],i=0;i<t;i++){var r=e+i,o=new h.StreamSender(r,this.mediaConnection,this.mainStream,this.contextStream,this.logger.createChild("S:"+r),this.configProvider);n.push(o)}return n},t.prototype.applyParameters=function(e){return c(this,void 0,void 0,function(){var t,n=this;return l(this,function(i){switch(i.label){case 0:return t=e.map(function(e){var t=n.senders.find(function(t){return e.ssrc===t.ssrc});return t?t.setParameters(e):(n.logger.safe.info("Sender for ssrc: "+e.ssrc+" does not exist, skipping"),Promise.resolve())}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},t.senderId=0,t.transitionStates=((r={}).NotStarted=["Started","Disposed"],r.Started=["Active","Disposed"],r.Active=["NotStarted","Disposed"],r.Disposed=[],r),a([d.sequentialize(),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"start",null),a([d.sequentialize(),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"activate",null),a([d.sequentialize(),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"updateStream",null),a([d.sequentialize(),s("design:type",Function),s("design:paramtypes",[Array]),s("design:returntype",Promise)],t.prototype,"updateParameters",null),a([d.sequentialize(),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"dispose",null),a([d.sequentialize(),s("design:type",Function),s("design:paramtypes",[Boolean,String]),s("design:returntype",Promise)],t.prototype,"setHold",null),t}(u.default);t.SimulcastStreamSender=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n){this.transitionStates=e,this.logger=n,this.stateInternal=t}return Object.defineProperty(e.prototype,"state",{get:function(){return this.stateInternal},enumerable:!0,configurable:!0}),e.prototype.isDestinationStateValid=function(e){return this.transitionStates[this.stateInternal].indexOf(e)>-1},e.prototype.setState=function(e){return this.isDestinationStateValid(e)?(this.stateInternal=e,!0):(this.logger.safe.info("Invalid state transition "+this.stateInternal+" -> "+e),!1)},e.prototype.isCurrentStateMatches=function(e){return this.stateInternal===e||(this.logger.safe.info("Invalid state! "+this.stateInternal+". Required: "+e),!1)},e}();t.StateMachine=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=n(0),s=n(9),c=function(){function e(e,t,n,i,r,o){this.ssrc=e,this.mediaConnection=t,this.contextStream=i,this.logger=r,this.configProvider=o,this.isActive=!1,this.isMuted=!1,this.stream=n.clone(),this.sender=this.createSender(this.stream),this.isActive=!0}return Object.defineProperty(e.prototype,"trackId",{get:function(){return this.stream&&this.stream.rawTrack&&this.stream.rawTrack.id},enumerable:!0,configurable:!0}),e.prototype.start=function(){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return this.isActive?(this.logger.safe.info("Already active. Do nothing"),[2]):(this.logger.safe.info("Starting"),this.isActive=!0,this.params?[4,this.applyParams(this.params)]:[3,2]);case 1:e.sent(),e.label=2;case 2:return[4,this.wakeSender()];case 3:return e.sent(),this.logger.safe.info("Started"),[2]}})})},e.prototype.stop=function(){return i(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return this.isActive?(this.logger.safe.info("Stopping"),this.isActive=!1,e=this.configProvider.config.webrtcDisabledSenderBitrate,[4,this.applyBitrate(e)]):(this.logger.safe.info("Already stopped. Do nothing"),[2]);case 1:return t.sent(),[4,this.sleepSender()];case 2:return t.sent(),this.logger.safe.info("Stopped"),[2]}})})},e.prototype.setMuted=function(e,t){this.isMuted=e,this.stream.setMuted(e,t)},e.prototype.setHold=function(e,t){return i(this,void 0,void 0,function(){return r(this,function(n){return[2,this.activateSender(!e,t)]})})},e.prototype.setStream=function(e){return i(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:return this.stream.dispose(),this.stream=e.clone(),this.stream.setMuted(this.isMuted),this.params?[4,this.stream.applyCapabilities(this.params)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isActive?(t=this.stream.rawTrack&&this.stream.rawTrack.id,this.logger.safe.info("Replace sender with track: "+t),[4,this.sender.replaceTrack(this.stream.rawTrack)]):[3,4];case 3:n.sent(),this.logger.safe.info("Replace completed"),n.label=4;case 4:return[2]}})})},e.prototype.setParameters=function(e){return i(this,void 0,void 0,function(){return r(this,function(t){return e?this.params===e?[2]:(this.params=e,this.isActive?[2,this.applyParams(this.params)]:(this.logger.safe.info("Sender is not active, preserving params"),[2])):(this.logger.safe.info("Parameters not found"),[2])})})},e.prototype.dispose=function(){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.disposeSender()];case 1:return e.sent(),this.sender=null,this.stream.dispose(),this.stream=null,this.isActive=!1,[2]}})})},e.prototype.applyParams=function(e){return i(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return this.logger.safe.info("Applying params: "+JSON.stringify(e)),[4,this.stream.applyCapabilities(e)];case 1:return t.sent(),[4,this.applyBitrate(e.maxBr)];case 2:return t.sent(),this.params.keyframe?[4,this.forceKeyframe()]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2]}})})},e.prototype.applyBitrate=function(e){return i(this,void 0,void 0,function(){var t,n;return r(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=this.sender.getParameters(),e?t.encodings[0].maxBitrate=this.getAdjustedBitrate(e):delete t.encodings[0].maxBitrate,[4,this.sender.setParameters(t)];case 1:return i.sent(),this.logger.safe.info("Encodings applied for sender: "+this.ssrc+" br: "+JSON.stringify(t.encodings[0])),[3,3];case 2:return n=i.sent(),this.logger.safe.error("Error setting bitrate: "+a.stringifyObject(n)),[3,3];case 3:return[2]}})})},e.prototype.getAdjustedBitrate=function(e){if("Video"===this.stream.mediaType||"ScreenShare"===this.stream.mediaType){var t=this.stream.getResolution(),n=new o.default(this.configProvider);return Math.min(e,n.getBitrateForResolution(t.width,t.height).maxBitrate)}return e},e.prototype.activateSender=function(e,t){return i(this,void 0,void 0,function(){var n,i;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),(n=this.sender.getParameters()).encodings[0].active=e,[4,this.sender.setParameters(n)];case 1:return r.sent(),this.logger.safe.info("["+t+"] Active state applied for sender: "+this.ssrc+" is active: "+e),[3,3];case 2:return i=r.sent(),this.logger.safe.error("["+t+"] Error holding sender: "+a.stringifyObject(i)),[3,3];case 3:return[2]}})})},e.prototype.forceKeyframe=function(){return i(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return this.sender?(e=this.sender.track)?(this.logger.safe.info("Restoring keyframe starting"),[4,this.sender.replaceTrack(null)]):(this.logger.safe.info("Sender track does not exist, not restoring keyframe"),[2]):(this.logger.safe.error("No sender available"),[2,null]);case 1:return t.sent(),[4,this.sender.replaceTrack(e)];case 2:return t.sent(),this.logger.safe.info("Restoring keyframe finished"),[2]}})})},e.prototype.disposeSender=function(){return i(this,void 0,void 0,function(){var e,t;return r(this,function(n){switch(n.label){case 0:if(this.sender.track)return[3,4];if(!this.stream)throw new Error("Stream is not defined");e=this.stream.rawTrack&&this.stream.rawTrack.id,this.logger.safe.info("Sender track does not exist, setting "+e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.sender.replaceTrack(this.stream.rawTrack)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this.logger.safe.warn("Error replacing track: "+a.stringifyObject(t)),[3,4];case 4:if(this.sender.track&&"closed"!==this.mediaConnection.connectionState){this.logger.safe.info("Sender track exists: "+this.sender.track.id+", removing sender from pc");try{this.mediaConnection.removeSender(this.sender)}catch(e){this.logger.safe.warn("Error removing track: "+a.stringifyObject(e))}}else this.logger.safe.info("Not removing sender from pc, connectioState: "+this.mediaConnection.connectionState+", track exists: "+!!this.sender.track);return[2]}})})},e.prototype.createSender=function(e){var t=e.rawTrack;return this.mediaConnection.createSender(t,this.contextStream,s.mediaTypeToModality(e.mediaType))},e.prototype.wakeSender=function(){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return this.logger.safe.info("Wake started"),[4,this.sender.replaceTrack(this.stream.rawTrack)];case 1:return e.sent(),this.logger.safe.info("Wake completed"),[2]}})})},e.prototype.sleepSender=function(){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return this.logger.safe.info("Sleep started"),[4,this.sender.replaceTrack(null)];case 1:return e.sent(),this.logger.safe.info("Sleep completed"),[2]}})})},e}();t.StreamSender=c},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=function(){function e(t){var n=this;this._prefix=t,this._children=[],this._useConsoleLogger=!1,this.createChild=function(t,i){var r="function"==typeof t?"":t,o=new e((n._prefix||"")+r);return n._children.push(o),n._useConsoleLogger&&o.useConsoleLogger(),o},this.createFnLogger=function(t,i){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var a="["+i+"]["+t+"]",s=new e((n._prefix||"")+a);return n._children.push(s),n._useConsoleLogger&&s.useConsoleLogger(),s}}return e.prototype.logInfo=function(){},e.prototype.logFailure=function(){},e.prototype.logSuccess=function(){},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.useConsoleLogger=function(){var e=this;this._useConsoleLogger=!0;var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.info.apply(console,r([e._prefix||""],t))};this.log=t,this.debug=t,this.info=t,this.warn=t,this.error=t,o.each(this._children,function(e){return e.useConsoleLogger()})},e}();t.default=a},function(e,t,n){var i;window,e.exports=(i=n(8),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(2),s=n(3);!function(e){e[e.OK=200]="OK",e[e.NoContent=204]="NoContent",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError"}(o||(o={}));var c=function(){function e(e){this.config=e,this.logger=this.config.callingLogger.createChild("ImageRenderer")}return e.prototype.createRenderer=function(e){return new l(this.logger,this.config.tokenProvider,this.config.httpRequestDispatcher,this.config.appStateProvider,e)},e}();t.ImageRendererProvider=c;var l=function(e){function t(t,n,i,r,o){var a=e.call(this)||this;return a.logger=t,a.tokenProvider=n,a.httpRequestDispatcher=i,a.appStateProvider=r,a.options=o,a.frameRateInSeconds=0,a.frameUriIndex=0,a.frameTimeoutId=0,a.sequenceNumber=0,a.started=!1,a.currentQuality=1,a.frameUri=o.frameUris,a.id=o.id,a}return r(t,e),t.prototype.start=function(){return this.started?Promise.reject("ImageRenderer already started"):(this.started=!0,this.event("onRendererStarted").raise(this),this.logger.debug("Image based rendering starting for id: "+this.id),this.shouldUseBackgroundImage()?this.frameElement=document.createElement("div"):this.frameElement=document.createElement("img"),this.frameElement.classList.add("image-renderer"),this.options.frameContainer.appendChild(this.frameElement),this.renderSafe())},t.prototype.dispose=function(){clearTimeout(this.frameTimeoutId),this.disposeOnlineSubscriptions(),this.getNextFrameResolve&&(this.getNextFrameResolve(),this.getNextFrameResolve=void 0),this.onlineReject&&(this.onlineReject("image renderer disposed"),this.onlineReject=void 0),this.frameElement&&(this.frameElement.parentNode&&this.frameElement.parentNode.removeChild(this.frameElement),this.frameElement=void 0),this.started=!1,this.event("onRendererDisposed").raise(this)},t.prototype.render=function(e){var t=this;return void 0===e&&(e=a.default()),this.waitForAppOnline().then(function(){return t.tokenProvider()}).then(function(n){var i={"X-Skypetoken":n,"X-Microsoft-Skype-Chain-ID":t.options.callParams.callId,"X-Microsoft-Skype-Message-ID":e};t.sequenceNumber&&(i["x-ms-sequencenumber"]=t.sequenceNumber.toString());var r=t.httpRequestDispatcher.getRequestOptions("GET",i,"",3e4,"blob");return t.sendRequestThrottled(t.frameUri[t.frameUriIndex],r,e).then(function(n){return t.started?t.handleRequestReceived(n,e):Promise.reject("image renderer disposed")})})},t.prototype.waitForAppOnline=function(){return!this.appStateProvider||this.appStateProvider.isOnline()?Promise.resolve():(this.logger.error("Teams is offline, waiting for network before continuing rendering"),this.onQualityChanged(3),this.getAppOnlinePromise())},t.prototype.getAppOnlinePromise=function(){var e=this;return this.onlinePromise||(this.onlinePromise=new Promise(function(t,n){if(e.onlineReject=n,e.appStateProvider){var i=e.appStateProvider;e.onlineSubscription=i.on("onAppStateChanged",function(){i.isOnline()&&(t(),e.disposeOnlineSubscriptions())})}else t()})),this.onlinePromise},t.prototype.disposeOnlineSubscriptions=function(){this.onlineSubscription&&(this.onlineSubscription.dispose(),this.onlineSubscription=void 0),this.onlinePromise&&(this.onlinePromise=void 0)},t.prototype.handleRequestReceived=function(e,t){var n=this;if(!e||!e.status)return this.logger.warn("Received empty XHR, retrying. MessageId: "+t),this.render();switch(this.frameRateInSeconds=this.frameRateInSeconds||1,e.status){case o.OK:return this.handleFrameReceived(e,t).then(function(){n.renderSafe().catch(function(){})}).catch(function(e){return n.render()});case o.NoContent:break;case o.Unauthorized:case o.Forbidden:return this.onQualityChanged(3),Promise.reject("Request not authorized, status: "+e.status);case o.NotFound:return this.onQualityChanged(3),Promise.reject("Meeting/session was not found, status: 404");case o.TooManyRequests:this.onQualityChanged(3);var i=e.getResponseHeader("retry-after");if(i){var r=parseInt(i,10);r&&(this.frameRateInSeconds=r)}break;default:if(e.status>=o.InternalServerError){if(this.frameUriIndex++,this.sequenceNumber=0,this.logger.error("Received internal server error "+e.status+", switching to next frameUrl. MessageId: "+t),this.frameUriIndex===this.frameUri.length)return this.onQualityChanged(3),Promise.reject("No more available frameUris")}else this.logger.error("Received invalid error "+e.status+", retrying. MessageId: "+t)}return this.render()},t.prototype.renderSafe=function(){var e=this,t=a.default();return this.render(t).catch(function(n){return e.logger.error("Getting frame failed with terminal error: "+JSON.stringify(n)+". MessageId: "+t),e.dispose(),Promise.reject(n)})},t.prototype.handleFrameReceived=function(e,t){var n=e.getResponseHeader("x-ms-sequencenumber");if(!n)return this.logger.warn("sequenceNumberHeader not present. MessageId: "+t),this.onQualityChanged(3),this.renderFrame(e.response);var i=parseInt(n,10);if(i&&i>this.sequenceNumber)return this.logger.debug("Received frame number: "+i+". MessageId: "+t),this.sequenceNumber=i,this.onQualityChanged(1),this.renderFrame(e.response,t);if(i&&i===this.sequenceNumber)return Promise.resolve();var r="Received out of sequence frame: "+i+" current sequence: "+this.sequenceNumber+". MessageId: "+t;return this.logger.error(r),this.onQualityChanged(3),Promise.reject(r)},t.prototype.renderFrame=function(e,t){var n=this;return new Promise(function(i,r){var o=new FileReader;o.readAsDataURL(e),o.onloadend=function(){return n.frameElement?(n.shouldUseBackgroundImage()?n.frameElement.style.backgroundImage="url('"+o.result+"')":n.frameElement.src=o.result,i()):r("No frameElement found. MessageId: "+t)},o.onerror=function(e){var i="Failed rendering received image: "+e+". MessageId: "+t;return n.logger.error(i),r(i)}})},t.prototype.sendRequestThrottled=function(e,t,n){var i=this;return this.started?new Promise(function(r){i.getNextFrameResolve=r,i.frameTimeoutId=window.setTimeout(function(){var o=i.httpRequestDispatcher.getAsync(e,t).then(function(e){return e.request}).catch(function(e){return i.logger.error("Getting frame failed with error: "+JSON.stringify(e)+", attempting recovery. MessageId: "+n),e?e.request:{}});r(o)},1e3*i.frameRateInSeconds)}):Promise.reject("image renderer disposed")},t.prototype.shouldUseBackgroundImage=function(){return-1!==navigator.userAgent.indexOf("Trident")},t.prototype.onQualityChanged=function(e){if(this.currentQuality!==e){this.currentQuality=e;var t=this.options.callParams.imageRenderingEventCallbacks;t&&t.onImageRenderingQualityChanged&&t.onImageRenderingQualityChanged({type:51,value:e,isLocalSource:!1,mediaType:3})}},t}(s.default);t.ImageRenderer=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,n){var i,r=this;return i=this.on(e,this._fromEventCallback(function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];i.dispose(n),r._toEventCallback(t).apply(void 0,e)}))},t.prototype.raiseChanged=function(){this.raiseEvents(function(e){return e.changed&&e.changed()})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return t._raiseEventImpl.apply(t,[String(e)].concat(n))})}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents(function(n){var i;return n.on&&n.on.name===e&&(i=n.on).handler.apply(i,t)})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(4).EventSourceImpl);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=function(){function e(e){this.subscriptions=[],this.eventLogger=e}return e.prototype.subscribe=function(e){return new o(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this;this.subscriptions.slice().forEach(function(n){try{void 0!==n.eventHandler&&e(n.eventHandler)}catch(e){t.eventLogger&&t.eventLogger.warn&&t.eventLogger.warn("Event handler exception caught!",e)}})},e}();t.EventSourceImpl=r;var o=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;i.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=void 0},e}()},function(e,t){e.exports=i}]))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(15),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isAudioOutputSelectionSupported=!1,t}return r(t,e),t.prototype.askDevicePermission=function(){return Promise.resolve({audio:!1,video:!1})},t.prototype.getPermissionState=function(e){return"granted"},t.prototype.enumerateDevicesAsync=function(){return Promise.resolve([])},t.prototype.getPreferredCamera=function(){return null},t.prototype.selectDevices=function(){},t.prototype.getSelectedDevices=function(){return{}},t.prototype.createPreview=function(){return Promise.resolve(new s)},t.prototype.createPreviewRenderer=function(){return Promise.resolve(new s)},t.prototype.createScreenSharingPreviewRenderer=function(){return Promise.resolve(new s)},t.prototype.getDeviceNameAsync=function(){return Promise.resolve("")},t.prototype.setDeviceEffectsAsync=function(){return Promise.resolve()},t.prototype.getDeviceEffectsCapabilityAsync=function(){return Promise.resolve(0)},t.prototype.setBackgroundImageAsync=function(){return Promise.resolve()},t.prototype.sendMessageDeviceVideoEffectsAsync=function(){return Promise.resolve({code:0})},t.prototype.setVideoCaptureConfigAsync=function(){return Promise.resolve()},t.prototype.getSpeakerVolume=function(){return Promise.resolve(0)},t.prototype.getSpeakerSystemVolume=function(){return Promise.resolve(0)},t.prototype.setSpeakerVolume=function(e){return Promise.resolve()},t.prototype.setSpeakerSystemVolume=function(e){return Promise.resolve()},t.prototype.unmuteMicrophone=function(){return Promise.resolve()},t.prototype.unmuteSpeaker=function(){return Promise.resolve()},t.prototype.getNrgLevelsForDeviceTuner=function(e){return Promise.resolve(0)},t.prototype.getAudioFeatureCapability=function(e){return Promise.resolve(0)},t.prototype.getMicrophoneVolume=function(){return Promise.resolve(0)},t.prototype.setMicrophoneVolume=function(e){return Promise.resolve()},t.prototype.setDeviceTelemetryData=function(e,t,n){return Promise.resolve(!0)},t.prototype.getSpeakerDeviceDomIdAsync=function(e,t){return Promise.reject()},t}(o.default);t.default=a;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isRendering=!1,t.streamSize={width:0,height:0},t.rendererType=-1,t.frameType=-1,t}return r(t,e),t.prototype.captureFrame=function(){return Promise.resolve(new c)},t.prototype.getStats=function(){return Promise.resolve({framesDropped:0,framesTotal:0})},t.prototype.setScalingMode=function(){return Promise.resolve()},t.prototype.dumpVideoSourceImages=function(){return Promise.resolve(0)},t.prototype.cameraAutoControl=function(e){return Promise.resolve(!1)},t.prototype.dispose=function(){},t}(o.default),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getSize=function(){return{width:0,height:0}},t.prototype.isMirrored=function(){return!1},t}(o.default)},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(277),a=function(){function e(e){this.logger=e}return e.prototype.configure=function(e){},e.prototype.initialize=function(){return i(this,void 0,void 0,function(){return r(this,function(e){return[2]})})},e.prototype.createLiveStream=function(){return new o.LiveStream(this.logger.createChild("LiveStream"))},e.prototype.dispose=function(e){},e}();t.LiveStreamClient=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(15),l=n(278),u=n(281),d=n(282),p=function(e){function t(t){var n=e.call(this)||this;return n.logger=t,n.liveStreamStatistic=new d.LiveStreamStatistic(n.logger.createChild("LiveStreamStatistic")),n.player=new l.AmpLiveStreamPlayer(n.logger,n.liveStreamStatistic),n.playerSubs=[],n.isAvailable=!0,n.subscribeForPlayerEvents(),n}return r(t,e),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype.start=function(e,t){return o(this,void 0,void 0,function(){var n;return a(this,function(i){switch(i.label){case 0:return[4,this.player.configure(t)];case 1:return i.sent(),[4,(n=new u.LiveStreamRenderer(e,this.logger.createChild("LiveStreamRenderer"))).startPlayer(this.player)];case 2:if(!i.sent())throw n.dispose(),new Error("playerLoadFailed");return this.isStreaming=!0,[2,n]}})})},t.prototype.stop=function(){return o(this,void 0,void 0,function(){return a(this,function(e){return[2]})})},t.prototype.setOptions=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){return[2,this.player.configure(e)]})})},t.prototype.getStats=function(){return this.liveStreamStatistic.getPlayerDiagnosticData()},t.prototype.dispose=function(){this.unsubscribeFromPlayerEvents(),this.player.stop(),e.prototype.dispose.call(this)},t.prototype.subscribeForPlayerEvents=function(){var e=this;this.playerSubs.push(this.player.on("playbackStateChanged",function(){return e.onPlaybackStateChanged()})),this.playerSubs.push(this.player.on("playbackError",function(t,n){return e.onPlaybackError(t,n)})),this.playerSubs.push(this.player.on("urlSwitched",function(t){return e.onUrlSwitched(t)}))},t.prototype.unsubscribeFromPlayerEvents=function(){var e,t;try{for(var n=s(this.playerSubs),i=n.next();!i.done;i=n.next())i.value.dispose()}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.playerSubs=[]},t.prototype.onPlaybackStateChanged=function(){var e=this.player.getPlaybackState();switch(e){case"Start":this.event("playbackStarted").raise();break;case"Ended":this.event("playbackNotLive").raise();break;case"Seeked":this.event("playbackSeeked").raise(this.player.getCurrentTime());break;default:this.logger.debug("playbackStateChanged: "+e)}this.event("playbackStateChanged").raise(this.player.getPlaybackState())},t.prototype.onPlaybackError=function(e,t){this.event("error").raise(e,t)},t.prototype.onUrlSwitched=function(e){this.event("urlSwitched").raise(e)},t}(c.default);t.LiveStream=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(8),l=n(31),u=n(15),d=n(279),p=n(280),f=n(127),h={techOrderTypes:{azureHtml5JS:"azureHtml5JS",html5:"html5"},sdnNames:{sdnHiveName:"hive",sdnKollectiveName:"kollective",sdnRamp:"ramp"},textTrackKind:"subtitles",streamingUrlSwitchMaxCount:2,ampErrorCodesEligibleForStreamingUrlSwitch:[4194309,2097564,2097556,2097752,2097753,5242884],defaultPlayerSrc:["//amp.azure.net/libs/amp/latest/azuremediaplayer.min.js"],defaultPlayerCss:["//amp.azure.net/libs/amp/latest/skins/amp-default/azuremediaplayer.min.css"],defaultPlayerStyles:["azuremediaplayer","amp-default-skin","amp-big-play-centered"]},g=[2097152,2097552,2097556,2097557,2097564,2097652,2097654,2097655,2097656,2097752,3145728,4194305,4194306,4194307,4194308,4194309,5242880,5242881,5242882,5242884,5242885,5242886],m=function(e){function t(t,n){var i=e.call(this)||this;return i.logger=t,i.liveStreamStatistic=n,i.videoSourceType="application/dash+xml",i.isVerboseMode=!1,i.retryCount=0,i.maxRetryCount=10,i.sourceResetTimeoutInMs=1e3,i.maxMemoryTraceLogCount=1e4,i.isSwitchStreamingUrlOngoing=!1,i.streamingUrlSwitchCount=0,i.isPlaybackUnsupported=!1,i.playerState="Destroyed",i.sdnPluginLoaded=!1,i._metadataLoaded=null,i._captionsControl=null,i}return r(t,e),Object.defineProperty(t.prototype,"metadataLoaded",{get:function(){var e=this;return this._metadataLoaded||(this._metadataLoaded=l.defer(),this._metadataLoaded.promise.catch(function(t){return e.logger.debug("metadataLoaded rejected: "+JSON.stringify(t))})),this._metadataLoaded},set:function(e){this._metadataLoaded=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captionsControl",{get:function(){return!this._captionsControl&&this.playerInstance&&(this._captionsControl=new p.CaptionsControl(this.playerInstance,this.metadataLoaded.promise)),this._captionsControl},set:function(e){this._captionsControl=e},enumerable:!0,configurable:!0}),t.prototype.configure=function(e){return o(this,void 0,void 0,function(){var t;return a(this,function(n){return f.isStreamValid(e.stream)||f.isStreamValid(e.altStream)?(this.logger.info("Live Stream configuration provided"),this.liveStreamOptions=e,!this.playerInstance||this.isPlaybackUnsupported?(this.selectedStreamDetails=e.stream,[2]):(t=f.isStreamValid(e.stream)?e.stream:e.altStream,this.handleStreamInfoUpdate(t),[2])):(this.logger.error("Invalid Live Stream configuration provided: no valid primary or alternative stream"),[2])})})},t.prototype.loadPlayer=function(e){return o(this,void 0,void 0,function(){var t,n;return a(this,function(i){switch(i.label){case 0:f.assert(!this.playerInstance,"loads a player while current one is still active: "+this.playerState),this.liveStreamStatistic.registerPlayerLoadAttempt(),this.loadSucceeded=!1,this.srcLoadPromise||(this.srcLoadPromise=this.loadPlayerScript()),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.srcLoadPromise];case 2:return i.sent(),[3,4];case 3:return t=i.sent(),this.logger.error("playerLoadFailed: player scripts load failed: "+JSON.stringify(t)),this.liveStreamStatistic.registerPlayerLoadFailed("player scripts load failed"),this.srcLoadPromise=null,[2,!1];case 4:return[4,this.tryLoadSdnPlugin()];case 5:i.sent(),this.createVideoElement(e),n=this.getAmpOptions();try{if(this.playerInstance=amp(this.video.id,n),!this.playerInstance)return this.logger.error("playerLoadFailed: player instance is null"),this.liveStreamStatistic.registerPlayerLoadFailed("player instance is null"),[2,!1]}catch(e){return this.logger.error("playerLoadFailed "+JSON.stringify(e)),this.liveStreamStatistic.registerPlayerLoadFailed("playerLoadFailed "+JSON.stringify(e)),[2,!1]}return this.registerPlayerEvents(),this.diagnosticProvider=new d.AmpDiagnosticProvider(this.playerInstance,this.logger.createChild("AmpDiagnosticProvider")),this.liveStreamStatistic.registerPlaybackDiagnosticProvider(this.diagnosticProvider),f.isStreamValid(this.selectedStreamDetails)?(this.loadSucceeded=this.setPlayerSource(this.selectedStreamDetails),this.logger.info("loadPlayer succeeded: "+this.loadSucceeded),this.liveStreamStatistic.registerPlayerLoadSucceeded()):this.liveStreamStatistic.registerPlayerLoadFailed("invalid stream"),[2,this.loadSucceeded]}})})},t.prototype.stop=function(){this.destroy(),this.logger.debug("Telemetry report: "+JSON.stringify(this.liveStreamStatistic.getReport()))},t.prototype.getPlaybackState=function(){return this.playerState},t.prototype.getCurrentTime=function(){return this.playerInstance?this.liveStreamOptions.overflow?this.playerInstance.currentMediaTime():this.playerInstance.currentTime():0},t.prototype.getCaptionsToggleListener=function(){return new p.CaptionsToggleListener(this.playerInstance,this.metadataLoaded.promise,this.liveStreamOptions.overflow,this.logger)},t.prototype.getCaptionsControl=function(){return this.captionsControl},t.prototype.getStreamSize=function(){if(this.diagnosticProvider){var e=this.diagnosticProvider.getPlayerDiagnosticData();return{width:e.mediaWidth,height:e.mediaHeight}}return{width:0,height:0}},t.prototype.isRendering=function(){var e=this.getStreamSize();return e.width>0&&e.height>0},t.prototype.loadPlayerScript=function(){return o(this,void 0,void 0,function(){var e,t,n,i,r,o,c,l,u,d,p,g,m;return a(this,function(a){switch(a.label){case 0:r=[],o=this.liveStreamOptions.playerConfig?"string"==typeof this.liveStreamOptions.playerConfig.css?[this.liveStreamOptions.playerConfig.css]:this.liveStreamOptions.playerConfig.css:h.defaultPlayerCss;try{for(c=s(o),l=c.next();!l.done;l=c.next())u=l.value,r.push(f.loadCss(document,u))}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}d=this.liveStreamOptions.playerConfig?"string"==typeof this.liveStreamOptions.playerConfig.src?[this.liveStreamOptions.playerConfig.src]:this.liveStreamOptions.playerConfig.src:h.defaultPlayerSrc;try{for(p=s(d),g=p.next();!g.done;g=p.next())m=g.value,r.push(f.loadScript(document,m))}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}return[4,Promise.all(r)];case 1:return a.sent(),[2]}})})},t.prototype.tryLoadSdnPlugin=function(){return o(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:if(this.sdnPluginLoaded||!this.liveStreamOptions.sdn)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,f.loadScript(document,this.liveStreamOptions.sdn.url)];case 2:return t.sent(),this.sdnPluginLoaded=!0,[3,4];case 3:return e=t.sent(),this.logger.error("loadSdnPlugin failed: "+JSON.stringify(e)),[3,4];case 4:return this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,this.sdnPluginLoaded),[2]}})})},t.prototype.createVideoElement=function(e){var t,n;this.video=e.ownerDocument.createElement("video"),this.video.id="amp-player";var i=this.liveStreamOptions.playerConfig?typeof this.liveStreamOptions.playerConfig.styles:h.defaultPlayerStyles;try{for(var r=s(i),o=r.next();!o.done;o=r.next()){var a=o.value;this.video.classList.add(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}e.appendChild(this.video)},t.prototype.setPlayerSource=function(e){if(!this.playerInstance)return this.logger.error("setPlayerSource: playerInstance is null"),!1;this.logger.info("setPlayerSource: AMP source set to: ["+e.url+"]");var t={src:e.url,type:this.videoSourceType,protectionInfo:e.decryptionToken?[{type:"AES",authenticationToken:e.decryptionToken}]:null};this.configureSdnSource(t);var n=this.playerInstance.currentTime();n>0&&(this.lastKnownPlayTime=n);try{return this.logger.info("setPlayerSource: src changed"),this.selectedStreamDetails=e,this.liveStreamStatistic.registerSetSourceAttempt(),this.playerInstance.src([t],this.getTextTracks()),this.liveStreamStatistic.registerSetSourceSucceeded(),!0}catch(e){var i=JSON.stringify(e);return this.logger.error("setPlayerSource: failed with error ["+i+"]"),this.liveStreamStatistic.registerSetSourcedFailed(i),!1}},t.prototype.configureSdnSource=function(e){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn){var t=this.liveStreamOptions.sdn.name;switch(this.logger.info("setPlayerSource: Adding SDN ["+t+"]"),t){case h.sdnNames.sdnHiveName:e.sdnList=[{sdnName:"hive",sdnUrl:this.liveStreamOptions.sdn.context}];break;case h.sdnNames.sdnKollectiveName:e.sdnList=[{sdnName:"kollectiveSDN",playbackInfo:JSON.parse(this.liveStreamOptions.sdn.context)}];break;case h.sdnNames.sdnRamp:e.sdnList=[{sdnName:"RampMOPlugin",videoId:this.video.id}];break;default:this.logger.warn("unsupported SDN provider: "+this.liveStreamOptions.sdn.name)}}},t.prototype.handleStreamInfoUpdate=function(e){var t=document.getElementById(this.video.id);(this.loadSucceeded||t)&&e.url!==this.selectedStreamDetails.url?this.setPlayerSource(e):this.loadSucceeded&&this.playerInstance&&this.playerInstance.currentTime()>0&&this.setPlaybackState("Start")},t.prototype.switchStreamingUrl=function(e){if(this.streamingUrlSwitchCount>=h.streamingUrlSwitchMaxCount||!c.includes(h.ampErrorCodesEligibleForStreamingUrlSwitch,e))return!1;var t=this.selectedStreamDetails.url===(this.liveStreamOptions.stream&&this.liveStreamOptions.stream.url),n=t?this.liveStreamOptions.altStream:this.liveStreamOptions.stream;return f.isStreamValid(n)?(this.logger.error("Stream to switch ("+(t?"alternative":"primary")+") is not valid"),!1):(this.isSwitchStreamingUrlOngoing=!0,this.streamingUrlSwitchCount++,!this.setPlayerSource(n))},t.prototype.destroy=function(){this.liveStreamStatistic.registerPlayerDestroyed(),this.diagnosticProvider&&(this.diagnosticProvider.dispose(),this.diagnosticProvider=null),this.playerInstance&&(this.liveStreamStatistic.stopPlaybackMonitoring(),this.removeEventListeners(),this.playerInstance.getMemoryLog(!0),this.playerInstance.dispose(),this.playerInstance=null,this.setPlaybackState("Destroyed")),this.video&&this.video.parentNode&&(this.video.parentNode.removeChild(this.video),this.video=null),this.metadataLoaded.reject("Player is destroyed"),this.metadataLoaded=null},t.prototype.getAmpOptions=function(){var e=[];this.isVerboseMode?e.push({target:"memory",maxMemoryTraceCount:this.maxMemoryTraceLogCount}):e.push({target:"console"});var t={TraceTargets:e,maxLogLevel:this.isVerboseMode?3:2},n={techOrder:[h.techOrderTypes.azureHtml5JS,h.techOrderTypes.html5],nativeControlsForTouch:!1,autoplay:!0,preload:"auto",controls:!this.liveStreamOptions.overflow,logo:{enabled:!1},height:"100%",width:"100%",traceConfig:t,staleDataTimeLimitInSec:30,heuristicProfile:amp.Player.HeuristicProfile.HighQuality,customPlayerSettings:{customHeuristicSettings:{bandwidthTestWithTimeThresholdDuringLive:!1,windowSizeHeuristics:!0,useBrowserWindowForWindowSizeRule:!0,useVariableFragmentSizeMode:!0}},plugins:{}};return this.initializePluginOptions(n),n},t.prototype.initializePluginOptions=function(e){if(this.liveStreamOptions.sdn)switch(this.liveStreamOptions.sdn.name){case h.sdnNames.sdnHiveName:return void(e.plugins={hive:{debugLevel:this.isVerboseMode?"debug":"notice",telemetryId:"12345678-dead-beef-abcd-000123456789"}});case h.sdnNames.sdnKollectiveName:return void(e.plugins={kollectiveSDN:{playbackInfo:JSON.parse(this.liveStreamOptions.sdn.context),reportSessionId:"12345678-dead-beef-abcd-000123456789"}});case h.sdnNames.sdnRamp:var t=JSON.parse(this.liveStreamOptions.sdn.context);return this.isVerboseMode&&(t.verbose=!0),void(e.plugins={RampMOPlugin:t});default:this.logger.warn("unsupported SDN provider: "+this.liveStreamOptions.sdn.name)}},t.prototype.getTextTracks=function(){var e,t,n=[];if(this.liveStreamOptions.supportedSubtitleLanguages)try{for(var i=s(this.liveStreamOptions.supportedSubtitleLanguages),r=i.next();!r.done;r=i.next()){var o=r.value;n.push({id:"amp-player_"+o.culture,kind:h.textTrackKind,label:o.name||o.culture,src:"",srclang:o.culture.substr(0,2)})}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},t.prototype.registerPlayerEvents=function(){var e=this;this.playerInstance.addEventListener(amp.eventName.error,function(){return e.handlePlaybackError()}),this.playerInstance.addEventListener(amp.eventName.canplaythrough,function(){return e.onCanplaythrough()}),this.playerInstance.addEventListener(amp.eventName.play,function(){return e.onPlay()}),this.playerInstance.addEventListener(amp.eventName.playing,function(){return e.onPlaying()}),this.playerInstance.addEventListener(amp.eventName.pause,function(){return e.onPause()}),this.playerInstance.addEventListener(amp.eventName.resume,function(){return e.onResume()}),this.playerInstance.addEventListener(amp.eventName.start,function(){return e.onStart()}),this.playerInstance.addEventListener(amp.eventName.ended,function(){return e.onEnded()}),this.playerInstance.addEventListener(amp.eventName.seeking,function(){return e.onSeeking()}),this.playerInstance.addEventListener(amp.eventName.seeked,function(){return e.onSeeked()}),this.playerInstance.addEventListener(amp.eventName.loadedmetadata,function(){return e.onMetadataLoaded()}),this.playerInstance.addEventListener(amp.eventName.waiting,function(){return e.onWaiting()}),this.playerInstance.addEventListener(amp.eventName.playbackbitratechanged,function(){return e.onPlaybackBitrateChanged()}),this.playerInstance.addEventListener(amp.eventName.fullscreenchange,function(){return e.onFullscreenChange()}),this.playerInstance.addEventListener("potentialMediaFreeze",function(){return e.onPotentialMediaFreeze()})},t.prototype.removeEventListeners=function(){this.playerInstance.removeEventListener(amp.eventName.error),this.playerInstance.removeEventListener(amp.eventName.canplaythrough),this.playerInstance.removeEventListener(amp.eventName.play),this.playerInstance.removeEventListener(amp.eventName.playing),this.playerInstance.removeEventListener(amp.eventName.pause),this.playerInstance.removeEventListener(amp.eventName.resume),this.playerInstance.removeEventListener(amp.eventName.start),this.playerInstance.removeEventListener(amp.eventName.ended),this.playerInstance.removeEventListener(amp.eventName.seeking),this.playerInstance.removeEventListener(amp.eventName.seeked),this.playerInstance.removeEventListener(amp.eventName.loadedmetadata),this.playerInstance.removeEventListener(amp.eventName.waiting),this.playerInstance.removeEventListener(amp.eventName.playbackbitratechanged),this.playerInstance.removeEventListener(amp.eventName.fullscreenchange),this.playerInstance.removeEventListener("potentialMediaFreeze")},t.prototype.onCanplaythrough=function(){this.diagnosticProvider.initializeBufferEvents(),this.setPlaybackState("Ready")},t.prototype.onPlay=function(){(this.retryCount>0||this.lastKnownPlayTime)&&(this.logger.info("Playing after retry count "+this.retryCount+", Setting current time to "+this.lastKnownPlayTime),this.playerInstance.currentTime(this.lastKnownPlayTime),this.retryCount=0,this.lastKnownPlayTime=void 0),this.setPlaybackState("Play")},t.prototype.onPlaying=function(){this.setPlaybackState("Playing")},t.prototype.onPause=function(){this.setPlaybackState("Paused")},t.prototype.onResume=function(){this.logger.debug("Player started after a pause")},t.prototype.onStart=function(){this.logger.info("Playback started, retry count: "+this.retryCount),this.setPlaybackState("Start"),this.isSwitchStreamingUrlOngoing&&(this.logger.info("Playback started, switch count: "+this.streamingUrlSwitchCount),this.event("urlSwitched").raise(this.selectedStreamDetails===this.liveStreamOptions.altStream),this.isSwitchStreamingUrlOngoing=!1)},t.prototype.onEnded=function(){this.setPlaybackState("Ended")},t.prototype.onSeeking=function(){this.setPlaybackState("Seeking")},t.prototype.onSeeked=function(){this.setPlaybackState("Seeked")},t.prototype.onMetadataLoaded=function(){this.metadataLoaded.resolve(),this.setPlaybackState("LoadedMetadata")},t.prototype.onWaiting=function(){this.setPlaybackState("Buffering")},t.prototype.onPlaybackBitrateChanged=function(){this.liveStreamStatistic.registerPlaybackBitratechanged(this.playerInstance.currentDownloadBitrate())},t.prototype.onFullscreenChange=function(){this.logger.debug("fullscreenchange, isFullscreen="+this.playerInstance.isFullscreen()),this.event("fullscreenToggled").raise(this.playerInstance.isFullscreen())},t.prototype.onPotentialMediaFreeze=function(){this.logger.warn("Player detected a potential media freeze"),this.liveStreamStatistic.registerPotentialMediaFreeze()},t.prototype.setPlaybackState=function(e){this.playerState=e,this.logger.debug("playback state changed: "+e),this.liveStreamStatistic.registerPlaybackStateChanged(e),this.event("playbackStateChanged").raise()},t.prototype.handlePlaybackError=function(){var e=this;this.playerState="Error";var t=this.playerInstance.error(),n=JSON.stringify(t||{});if(this.logger.info("Playback error "+n),!t||!t.code)return this.logger.error("onError: error details are not available"),void this.raisePlaybackError("Unknown",n);if((t.code&amp.errorCode.srcErrUnsupportedPresentation)===amp.errorCode.srcErrUnsupportedPresentation)return this.isPlaybackUnsupported=!0,this.raisePlaybackError("UnsupportedPlatform",n),void this.destroy();this.lastKnownPlayTime=this.playerInstance.currentTime()||this.lastKnownPlayTime;var i=t.code,r=268435455&i;this.logger.error("onError: errorCode: "+i+", errorCodeExcludingTech: "+r.toString(16)+", message: "+t.message),this.retryCount<this.maxRetryCount&&-1!==c.indexOf(g,r)?setTimeout(function(){e.logger.info("Retry loading stream because of error code: "+i.toString(16)),e.retryCount++,e.raisePlaybackError("PlaybackRetried",n),e.setPlayerSource(e.selectedStreamDetails)},this.sourceResetTimeoutInMs):2097753===r||t.message&&t.message.includes(2097753..toString(16))?(this.raisePlaybackError("NetworkError",n),this.destroy()):this.switchStreamingUrl(r)||(this.raisePlaybackError("UrlSwitchFailed",n),this.destroy())},t.prototype.raisePlaybackError=function(e,t){this.liveStreamStatistic.registerPlaybackError(e,t),this.event("playbackError").raise(e,t)},t}(u.default);t.AmpLiveStreamPlayer=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=function(){function e(e,t){this.playerInstance=e,this.logger=t,this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.slidingWindowLengthForLatency=30,this.slidingWindowLengthForDownloadBytes=30,this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this)}return e.prototype.initializeBufferEvents=function(){this.playerVideoBuffer=this.playerInstance.videoBufferData(),this.playerAudioBuffer=this.playerInstance.audioBufferData(),this.registerForPlayerBufferEvents()},e.prototype.getPlayerDiagnosticData=function(){if(!this.playerInstance)return null;var e=window.screen;return{currentPlayPosition:this.playerInstance.currentTime(),livePosition:this.playerInstance.duration(),playbackBitrate:this.playerInstance.currentPlaybackBitrate(),downloadBitrate:this.playerInstance.currentDownloadBitrate(),perceivedBandwidth:this.playerVideoBuffer?this.playerVideoBuffer.perceivedBandwidth:0,streamType:this.playerInstance.isLive()?"LIVE":"DVR",tech:this.playerInstance.currentTechName(),playerVersion:this.playerInstance.getAmpVersion(),isP2PSdnUsed:this.isP2PSdnUsed(),audioBufferLength:this.playerAudioBuffer?this.playerAudioBuffer.bufferLevel:0,videoBufferLength:this.playerVideoBuffer?this.playerVideoBuffer.bufferLevel:0,mediaHeight:this.playerInstance.videoHeight(),mediaWidth:this.playerInstance.videoWidth(),playerHeight:this.playerInstance.height(),playerWidth:this.playerInstance.width(),windowWidth:e?e.width:0,windowHeight:e?e.height:0,isFullscreen:this.playerInstance.isFullscreen(),avgAudioDownloadLatency:i.mean(this.audioDownloadLatencies),avgVideoDownloadLatency:i.mean(this.videoDownloadLatencies),avgAudioDownloadBytes:i.mean(this.audioDownloadBytes),avgVideoDownloadBytes:i.mean(this.videoDownloadBytes),maxVideoDownloadBytes:i.max(this.videoDownloadBytes),minVideoDownloadBytes:i.min(this.videoDownloadBytes),audioDownloadFailureCount:this.audioDownloadFailureCount,audioDownloadSuccessCount:this.audioDownloadSuccessCount,videoDownloadFailureCount:this.videoDownloadFailureCount,videoDownloadSuccessCount:this.videoDownloadSuccessCount}},e.prototype.dispose=function(){this.unsubscribeFromPlayerBufferEvents()},e.prototype.registerForPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.addEventListener(amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.addEventListener(amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.addEventListener(amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.addEventListener(amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},e.prototype.unsubscribeFromPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.removeEventListener(amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.removeEventListener(amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.removeEventListener(amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.removeEventListener(amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},e.prototype.isP2PSdnUsed=function(){return!!(this.playerInstance.options_&&this.playerInstance.options_.sdn&&this.playerInstance.options_.sdn.name)},e.prototype.onVideoDownloadCompleted=function(){this.videoDownloadSuccessCount++,this.videoDownloadLatencies.length>=this.slidingWindowLengthForLatency&&this.videoDownloadLatencies.shift(),this.videoDownloadBytes.length>=this.slidingWindowLengthForDownloadBytes&&this.videoDownloadBytes.shift(),this.videoDownloadLatencies.push(this.playerVideoBuffer.downloadCompleted.totalDownloadMs),this.videoDownloadBytes.push(this.playerVideoBuffer.downloadCompleted.totalBytes)},e.prototype.onAudioDownloadCompleted=function(){this.audioDownloadSuccessCount++,this.audioDownloadLatencies.length>=this.slidingWindowLengthForLatency&&this.audioDownloadLatencies.shift(),this.audioDownloadBytes.length>=this.slidingWindowLengthForDownloadBytes&&this.audioDownloadBytes.shift(),this.audioDownloadLatencies.push(this.playerAudioBuffer.downloadCompleted.totalDownloadMs),this.audioDownloadBytes.push(this.playerAudioBuffer.downloadCompleted.totalBytes)},e.prototype.onVideoDownloadError=function(){this.videoDownloadFailureCount++,this.logger.warn("onDownloadError Code: "+this.playerVideoBuffer.downloadFailed.code+" Bitrate: "+this.playerVideoBuffer.downloadFailed.mediaDownload.bitrate+" Message: "+this.playerVideoBuffer.downloadFailed.message+" Url: "+this.playerVideoBuffer.downloadFailed.mediaDownload.url)},e.prototype.onAudioDownloadError=function(){this.audioDownloadFailureCount++,this.logger.warn("onDownloadError Code: "+this.playerAudioBuffer.downloadFailed.code+" Bitrate: "+this.playerAudioBuffer.downloadFailed.mediaDownload.bitrate+" Message: "+this.playerAudioBuffer.downloadFailed.message+" Url: "+this.playerAudioBuffer.downloadFailed.mediaDownload.url)},e}();t.AmpDiagnosticProvider=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,n,i,r){var o=e.call(this)||this;return o.player=t,o.isOverflow=i,o.logger=r,o.onTextTrackChanged=o.onTextTrackChanged.bind(o),o.initialize(n),o}return r(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this.unsubscribeFromTrackEvents()},t.prototype.initialize=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,e];case 1:return t.sent(),this.logger.info("Player loaded, registering for caption events"),this.subscribeOnTrackEvents(),[2]}})})},t.prototype.subscribeOnTrackEvents=function(){var e=this.player.textTracks();e&&e.addEventListener&&e.addEventListener("change",this.onTextTrackChanged)},t.prototype.unsubscribeFromTrackEvents=function(){var e=this.player.textTracks();e&&e.removeEventListener&&e.removeEventListener("change",this.onTextTrackChanged)},t.prototype.onTextTrackChanged=function(){var e=this.player.getCurrentTextTrack();if(!e||!this.currentTextTrack||this.currentTextTrack.label!==e.label||this.currentTextTrack.mode!==e.mode){if(e||!e&&this.currentTextTrack){var t=!!e&&"showing"===e.mode,n=u(e||this.currentTextTrack),i=this.getCurrentTime();this.logger.info("Turned captions "+(t?"ON":"OFF")+" for culture ["+n+"] at player time ["+i+"]"),this.event("captionsToggled").raise(t,n,i)}this.currentTextTrack=e}},t.prototype.getCurrentTime=function(){return this.isOverflow?this.player.currentMediaTime():this.player.currentTime()},t}(n(15).default);t.CaptionsToggleListener=c;var l=function(){function e(e,t){this.player=e,this.initialize(t)}return e.prototype.initialize=function(e){return o(this,void 0,void 0,function(){var t,n,i,r;return a(this,function(o){switch(o.label){case 0:return[4,e];case 1:o.sent();try{for(i=s(d(this.player.textTracks())),r=i.next();!r.done;r=i.next())r.value.mode="disabled"}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return[2]}})})},e.prototype.addCue=function(e){var t=this.player.getCurrentTextTrack();if(t){var n=e.start,i=e.end,r=e.text,o=new(window.vttjs&&window.vttjs.VTTCue||window.VTTCue)(n,i,r);o.size=100,t.addCue(o)}},e.prototype.clearCues=function(){var e,t,n=this.player.getCurrentTextTrack();try{if(n.cues.setCues_){n.cues_&&(n.cues_.length=0),n.cues.setCues_([]);try{for(var i=s(Object.getOwnPropertyNames(n.cues)),r=i.next();!r.done;r=i.next()){var o=r.value;"length"!==o&&"length_"!==o&&"cues_"!==o&&delete n.cues[o]}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}}}catch(e){}},e.prototype.showCaptions=function(e){e?this.show():this.hide()},e.prototype.getSelectedCulture=function(){return u(this.player.getCurrentTextTrack())},e.prototype.getAvailableCultures=function(){return d(this.player.textTracks()).map(u)},e.prototype.dispose=function(e){},e.prototype.hide=function(){this.previouslyVisibleTextTrack=this.player.getCurrentTextTrack(),this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="disabled"),this.player.captionToggle&&this.player.captionToggle.hide&&this.player.captionToggle.hide(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.hide&&this.player.MoreOptionscaptionSubtitleButton.hide(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.hide&&this.player.MoreOptionscaptionSettingsButton.hide()},e.prototype.show=function(){this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="showing"),this.player.captionToggle&&this.player.captionToggle.show&&this.player.captionToggle.show(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.show&&this.player.MoreOptionscaptionSubtitleButton.show(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.show&&this.player.MoreOptionscaptionSettingsButton.show()},e}();function u(e){if(!e)return"";if(e.id){var t=e.id.split("_")[1];if(t)return t}return""}function d(e){return e&&e.tracks_||[]}t.CaptionsControl=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,n){var i=e.call(this)||this;return i.container=t,i.logger=n,i.playerSubs=[],i}return r(t,e),Object.defineProperty(t.prototype,"isRendering",{get:function(){return!!this.player&&this.player.isRendering()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamSize",{get:function(){return this.player?this.player.getStreamSize():{width:0,height:0}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendererType",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameType",{get:function(){return-1},enumerable:!0,configurable:!0}),t.prototype.startPlayer=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return this.logger.info("startPlayer"),[4,e.loadPlayer(this.container)];case 1:return t.sent()&&(this.player=e,this.captionsToggleListener=this.player.getCaptionsToggleListener(),this.subscribeForPlayerEvents()),[2,!!this.player]}})})},t.prototype.dispose=function(){this.captionsToggleListener&&(this.captionsToggleListener.dispose(),this.captionsToggleListener=null),this.stopPlayer(),e.prototype.dispose.call(this)},t.prototype.captions=function(){return this.player.getCaptionsControl()},t.prototype.getStats=function(){throw new Error("Method not implemented.")},t.prototype.setScalingMode=function(e,t){throw new Error("Method not implemented.")},t.prototype.captureFrame=function(e,t){throw new Error("Method not implemented.")},t.prototype.dumpVideoSourceImages=function(){throw new Error("Method not implemented.")},t.prototype.cameraAutoControl=function(e){throw new Error("Method not implemented.")},t.prototype.stopPlayer=function(){this.logger.info("stopPlayer"),this.player&&(this.unsubscribeFromPlayerEvents(),this.player.stop(),this.player=null)},t.prototype.subscribeForPlayerEvents=function(){var e=this;this.playerSubs.push(this.player.on("fullscreenToggled",function(t){return e.onFullScreenToggled(t)})),this.playerSubs.push(this.captionsToggleListener.on("captionsToggled",function(t,n,i){return e.event("captionsToggled").raise(t,n,i)}))},t.prototype.unsubscribeFromPlayerEvents=function(){var e,t;try{for(var n=s(this.playerSubs),i=n.next();!i.done;i=n.next())i.value.dispose()}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.playerSubs=[]},t.prototype.onFullScreenToggled=function(e){this.event("fullScreenToggled").raise(e)},t}(n(15).default);t.LiveStreamRenderer=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(127),r=function(){function e(e){this.name=e,this.start()}return e.prototype.start=function(){i.assert(!this.startTime,"already started"),this.startTime=(new Date).getTime()},e.prototype.complete=function(){i.assert(this.startTime,"not started"),i.assert(void 0===this.duration,"already completed"),this.duration=(new Date).getTime()-this.startTime},e.prototype.fail=function(e){this.failReason=e,this.complete()},e.prototype.getTelemetryEvent=function(){i.assert(this.startTime,"not started"),i.assert(void 0!==this.duration,"not completed");var e={name:this.name,startTime:this.startTime,duration:this.duration};return this.failReason&&(e.failReason=this.failReason),e},e}(),o=function(){function e(e){this.logger=e,this.currentScenarioMap=new Map,this.playerEvents=[],this.playbackEvents=[],this.tickInterval=6e4}return e.prototype.registerPlayerLoadAttempt=function(){this.registerScenario("Load")},e.prototype.registerPlayerLoadSucceeded=function(){this.completeScenario("Load")},e.prototype.registerPlayerLoadFailed=function(e){this.completeScenario("Load",e)},e.prototype.registerSetSourceAttempt=function(){this.registerScenario("SetSource")},e.prototype.registerSetSourceSucceeded=function(){this.completeScenario("SetSource")},e.prototype.registerSetSourcedFailed=function(e){this.completeScenario("SetSource",e)},e.prototype.registerPlayerDestroyed=function(){this.registerScenario("Destroyed"),this.completeScenario("Destroyed")},e.prototype.registerPlaybackStateChanged=function(e){var t={eventType:"StateChanged",timestamp:(new Date).getTime(),payload:e};this.playbackEvents.push(t),this.logTelemetryEvent(t)},e.prototype.registerPlaybackError=function(e,t){var n={errorType:e,details:t},i={eventType:"Error",timestamp:(new Date).getTime(),payload:JSON.stringify(n)};this.playbackEvents.push(i),this.logTelemetryEvent(i)},e.prototype.registerPlaybackBitratechanged=function(e){var t={eventType:"BitrateChanged",timestamp:(new Date).getTime(),payload:e.toString()};this.playbackEvents.push(t),this.logTelemetryEvent(t)},e.prototype.registerPotentialMediaFreeze=function(){var e={eventType:"PotentialMediaFreeze",timestamp:(new Date).getTime()};this.playbackEvents.push(e),this.logTelemetryEvent(e)},e.prototype.registerSdnPluginLoad=function(e,t){var n=JSON.stringify({name:e,succeeded:t}),i={eventType:"SdnPluginLoad",timestamp:(new Date).getTime(),payload:n};this.playbackEvents.push(i),this.logTelemetryEvent(i)},e.prototype.registerPlaybackDiagnosticProvider=function(e){this.diagnosticProvider=e,this.activateTimer()},e.prototype.activateTimer=function(){var e=this;i.assert(!this.timer,"already activated"),this.timer=window.setInterval(function(){return e.logger.debug("PlayerDiagnosticData: "+JSON.stringify(e.getPlayerDiagnosticData()))},this.tickInterval)},e.prototype.stopPlaybackMonitoring=function(){i.assert(this.timer,"not activated"),clearInterval(this.timer),this.timer=0,this.diagnosticProvider=null},e.prototype.getPlayerDiagnosticData=function(){return this.diagnosticProvider?this.diagnosticProvider.getPlayerDiagnosticData():null},e.prototype.getReport=function(){return{playerEvents:this.playerEvents.map(function(e){return e.getTelemetryEvent()}),playbackEvents:this.playbackEvents}},e.prototype.registerScenario=function(e){i.assert(!this.currentScenarioMap.has(e),"previous scenario is not completed");var t=new r(e);this.currentScenarioMap.set(e,t),this.playerEvents.push(t)},e.prototype.completeScenario=function(e,t){var n=this.currentScenarioMap.get(e);i.assert(n,"no scenario to complete"),t?n.fail(t):n.complete(),this.currentScenarioMap.delete(e)},e.prototype.logTelemetryEvent=function(e){this.logger.debug("PlayerTelemetryEvent: "+JSON.stringify(e)),this.logger.debug("PlayerDiagnosticData: "+JSON.stringify(this.getPlayerDiagnosticData()))},e}();t.LiveStreamStatistic=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(26),r=n(284),o=n(285),a=n(286);t.initLogger=function(e,t){if(!i.RootToolsManager.isDelegateSet()){var n=new a.RootToolsManagerDelegate(e.telemetryService,t);if(i.RootToolsManager.setDelegate(n),e.logger){var s=new o.RedirectingLogAppender(e.logger);i.LogFactory.instance().addAppender(s)}}e.logger=new r.TsCallingLogger("JS.TsCalling.Pluginless",!0),e.mediaAgentFactoryConfig.logger=new r.TsCallingLogger("JS.TsCalling.MediaAgentUnsafe",!1),e.mediaAgentFactoryConfig.safeLogger=new r.TsCallingLogger("JS.TsCalling.MediaAgent",!0),e.signalingAgentConfig.logger=new r.TsCallingLogger("JS.TsCalling.SignalingAgent",!0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(26),r=n(8),o=function(){function e(e,t,n){void 0===n&&(n=""),this.ulLogComponent=e,this.ulSafeComponent=t,this._getPrefix=r.isFunction(n)?n:function(){return n},this.logComponent=i.LogFactory.instance().component(this.ulLogComponent),i.LogFactory.instance().declareComponentSafe(this.ulLogComponent,t)}return e.prototype.createChild=function(t){var n=this,i=r.isFunction(t)?t:function(){return t};return new e(this.ulLogComponent,this.ulSafeComponent,function(){return n._getPrefix()?n._getPrefix()+"/"+i():i()})},e.prototype.log=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug2(null,t)},t)},e.prototype.debug=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug4(null,t)},t)},e.prototype.info=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug1(null,t)},t)},e.prototype.warn=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.warn(null,t)},t)},e.prototype.error=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.error(null,t)},t)},e.prototype._apply=function(e,t){void 0===t&&(t=[]),this._addPrefix(t),e(t.map(function(e){return e instanceof DOMException?e.toString():e}).map(function(e){return r.isObject(e)?JSON.stringify(e):e}).join(", "))},e.prototype._addPrefix=function(e){if(e&&e[0]){var t=this._getPrefix()+" "+e[0];e[0]=t}},e}();t.TsCallingLogger=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(26),a=function(e){function t(t){var n=e.call(this,new o.StandardLogFormatter(o.SLF_Flags.Component))||this;return n._logger=t,n}return r(t,e),t.prototype.log=function(e,t,n,i){if(this._logger){var r=e.level<=o.LogLevel.Debug4?this._logger.debug:e.level<=o.LogLevel.Debug2?this._logger.log:e.level<=o.LogLevel.Debug1?this._logger.info:e.level<=o.LogLevel.Warning?this._logger.warn:this._logger.error;r&&r.apply(this._logger,[this.formatter().format(e,t,n,i)])}},t}(o.AbstractLogAppender);t.RedirectingLogAppender=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(26),r=n(287),o=function(){function e(e,t){this._telemetryService=e,this._ecsProvider=t,this._ecsProvider.on("OnECSChanged",function(){return i.RootToolsManager.OnEcsChange()})}return e.prototype.fetchEcsConfig=function(e,t){var n=this;return r.Resolved().then(function(){return n._ecsProvider.getEcsConfig(e,t)})},e.prototype.sendTelemetry=function(e,t){this._telemetryService.getGenericTelemetryLogger&&e?this._telemetryService.getGenericTelemetryLogger(e).sendEvent({eventName:"rt_log",props:t}):this._telemetryService.sendEvents([{eventName:"rt_log",props:t}])},e}();t.RootToolsManagerDelegate=o},function(e,t,n){"use strict";(function(e){function n(e){return null!=e&&"function"==typeof e.then}function i(e){return null!=e&&"function"==typeof e.cancel}function r(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var o,a=[],s=void 0!==e;function c(t){a.push(t),1===a.length&&(s?e(l):setTimeout(l,0))}function l(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function d(e){return(new o.SyncTask).resolve(e).promise()}function p(e){var t=u(),r=!1;return t.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){n(e)?e.then(function(e){r||(r=!0,t.resolve(e))},function(e){r||(r=!0,t.reject(e))}):r||(r=!0,t.resolve(e))}),t.promise()}t.asyncCallback=c,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var i=this,r=new e;return r.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,i._cancelInternal(e)}),t.task=r,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:r._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),r.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?r(function(){var r=t.successFunc(o._storedResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?r(function(){var r=t.failFunc(o._storedErrResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return d([]);var t,r=u(),a=e.length,s=Array(e.length);r.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})});var c=function(){0==--a&&(void 0!==t?r.reject(t):r.resolve(s))};return e.forEach(function(e,i){n(e)?e.then(function(e){s[i]=e,c()},function(e){void 0===t&&(t=void 0===e||e),c()}):(s[i]=e,c())}),r.promise()},t.Defer=u,t.Resolved=d,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=p,t.raceTimer=function(e,t){var n=u(),i=setTimeout(function(){n.resolve({timedOut:!0})},t);return p([e.then(function(e){return clearTimeout(i),{timedOut:!1,result:e}}),n.promise()])}}).call(this,n(288).setImmediate)},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(289),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(61))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r,o,a,s,c=1,l={},u=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){h(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&h(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),i=function(t){e.postMessage(a+t,"*")}):e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){h(e.data)},i=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(r=d.documentElement,i=function(e){var t=d.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):i=function(e){setTimeout(h,0,e)},p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return l[c]=r,i(c),c++},p.clearImmediate=f}function f(e){delete l[e]}function h(e){if(u)setTimeout(h,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{f(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(61),n(290))},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],u=!1,d=-1;function p(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&f())}function f(){if(!u){var e=s(p);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new h(e,t)),1!==l.length||u||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),r=function(){function e(){this.supportedPlatforms=new Map([["Chrome","59.0"],["Edge","13.0"],["EdgeAnaheim","79.0"],["Safari","13.1"],["Electron","3.0"]]),this.experimentalPlatforms=new Map([["Firefox","82.0"]]),this.lightweightSupported=new Set(["Chrome","Edge","EdgeAnaheim","Firefox","Safari","MSIE"])}return e.isVersionGreaterOrEqual=function(e,t){var n=t.split(".").map(function(e){return parseInt(e,10)}),i=e.split(".").map(function(e){return parseInt(e,10)});return i[0]>n[0]||i[0]===n[0]&&i[1]>=n[1]},e.prototype.getPlatformSupportLevel=function(t){var n=i.getBrowserInfo(),r=this.supportedPlatforms.get(n.name);if(t&&r&&e.isVersionGreaterOrEqual(n.version,r))return 1;if(t&&!r){if("Chromium"===n.engine)return 2;var o=this.experimentalPlatforms.get(n.name);if(o&&e.isVersionGreaterOrEqual(n.version,o))return 2}return this.lightweightSupported.has(n.name)?3:0},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=n(15),s=n(32),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.config=null,t}return r(t,e),Object.defineProperty(t.prototype,"ETag",{get:function(){return this.etag},enumerable:!0,configurable:!0}),t.prototype.setEcsConfig=function(e){var t=this;return Promise.resolve().then(function(){t.config=JSON.parse(e.ecsBlob),t.etag=e.etag,t.event("OnECSChanged").raise()})},t.prototype.getEcsQueryParameters=function(){var e={};e.CLRelease=s.getTsCallingVersion();var t="_TS_BUILC_VERSION_".replace("C","D");e.CLRelease===t&&(e.CLRelease="9999.99");var n=o.getBrowserInfo();return e.BrowserName=n.name,e.BrowserEngine=n.engine,e.BrowserVersion=n.version,e.FormFactor=n.formFactor,Promise.resolve(JSON.stringify(e))},t.prototype.shouldTriggerCQF=function(e,t,n){return Promise.reject("Not implemented")},t.prototype.getEcsConfig=function(e,t){var n=this.config&&this.config[e];return t?n&&n[t]:n},t}(a.default);t.PluginlessEcsProvider=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(26),r=n(73),o=n(32),a=n(294);t.callSignalingAgentEcsNS="SkypeCalling";var s=function(){function e(e,t,n){var a=this;this.signalingAgentConfig=e,this.ecsProvider=t,this.logger=n,this.ecsProvider.on("OnECSChanged",function(){return a.onEcsUpdate()}),this.signalingAgentConfig.clientInformation+="/TsCallingVersion="+o.getTsCallingVersion()+"/Ovb="+o.getOvb(),this.signalingAgentConfig.piiScrubber={omit:i.pii.Omit,mri:i.pii.Mri},this.signalingAgent=new r.SignalingAgent(this.getSignalingAgentConfig())}return e.prototype.getSignalingAgent=function(){return this.signalingAgent},e.prototype.onEcsUpdate=function(){var e=this.ecsProvider.getEcsConfig(t.callSignalingAgentEcsNS);this.logger.info("onEcsUpdate, ecsTag="+(this.ecsProvider.ETag||"")+", ecsConfig="+JSON.stringify(e)),this.signalingAgentConfig=a.updateSignalingAgentConfig(this.signalingAgentConfig,e),this.signalingAgentConfig.ecsEtag=this.ecsProvider.ETag,this.signalingAgent.updateSignalingAgentConfig(this.getSignalingAgentConfig())},e.prototype.getSignalingAgentConfig=function(){return this.signalingAgentConfig.handleRosterFromCreateAndJoin=!0,this.signalingAgentConfig},e}();t.SignalingAgentProvider=s,t.signalingAgentProviderFactory={build:function(e,t,n){return new s(e,t,n)}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function r(e,t){return null==e?t:e}function o(e,t){return e||t}Object.defineProperty(t,"__esModule",{value:!0}),t.updateSignalingAgentConfig=function(e,t){if(!t)return e;var n,a,s=i({},e);if(t.ngIncoming&&t.ngOutgoing){var c=function(e,t){return t&&e?"enabled":e?"recvOnly":!1===e&&!1===t?"disabled":void 0}(t.ngIncoming.isVBSSEnabled,t.ngOutgoing.isVBSSEnabled);s.cloudScreenSharingFlag=r(c,e.cloudScreenSharingFlag)}return t.ngOutgoing&&(s.emergencyCallCountry=(n=t.ngOutgoing.isEmergencyCallingEnabled,a=e.emergencyCallCountry,!1===n?"":a),s.isGVCOutgoingEnabled=r(t.ngOutgoing.isGVCEnabled,e.isGVCOutgoingEnabled),s.brokerEnabledOutgoing=r(t.ngOutgoing.isBrokerEnabled,e.brokerEnabledOutgoing)),t.ngIncoming&&(s.isGVCJoiningEnabled=r(t.ngIncoming.isGVCEnabled,e.isGVCJoiningEnabled),s.brokerEnabledIncoming=r(t.ngIncoming.isBrokerEnabled,e.brokerEnabledIncoming)),s.conversationServiceUrl=o(t.conversationServiceUrl,e.conversationServiceUrl),s.uploadLogRequestUrl=o(t.uploadLogRequestUrl,e.uploadLogRequestUrl),s.isConversationServiceUrlFromEcs=!!t.conversationServiceUrl,s.isUploadLogRequestUrlFromEcs=!!t.uploadLogRequestUrl,s.doHostlessCalling=r(t.allowHostlessCalls,e.doHostlessCalling),s.supportsCompressedServicePayload=r(t.supportCompressedTrouterPayload,e.supportsCompressedServicePayload),s.brokerRequestBatching=r(t.allowBrokerSubscribeBatching,e.brokerRequestBatching),s.brokerExclusively=r(t.brokerExclusively,e.brokerExclusively),s.handleRosterFromCreateAndJoin=r(t.handleRosterFromCreateAndJoin,e.handleRosterFromCreateAndJoin),s.handleMediaOfferFromPushNotification=r(t.handleMediaOfferFromPushNotification,e.handleMediaOfferFromPushNotification),s.handleNewOfferRequest=r(t.handleNewOfferRequest,e.handleNewOfferRequest),s.sendProgressFromCC=r(t.sendProgressFromCC,e.sendProgressFromCC),s.handleUnmuteMuteFromResponse=r(t.handleUnmuteMuteFromResponse,e.handleUnmuteMuteFromResponse),s.useInternalHttpDispatcher=r(t.webInternalHttpDispatcher,e.useInternalHttpDispatcher),(t.webInternalHttpDispatcherConfigNetworkRequest||e.requestTypeHttpDispatcherConfigMap)&&(t.webInternalHttpDispatcherConfigNetworkRequest=t.webInternalHttpDispatcherConfigNetworkRequest||{},e.requestTypeHttpDispatcherConfigMap=e.requestTypeHttpDispatcherConfigMap||{},s.requestTypeHttpDispatcherConfigMap=i({},e.requestTypeHttpDispatcherConfigMap,t.webInternalHttpDispatcherConfigNetworkRequest)),(t.operationTypeHttpDispatcherConfigMap||e.operationTypeHttpDispatcherConfigMap)&&(t.operationTypeHttpDispatcherConfigMap=t.operationTypeHttpDispatcherConfigMap||{},e.operationTypeHttpDispatcherConfigMap=e.operationTypeHttpDispatcherConfigMap||{},s.operationTypeHttpDispatcherConfigMap=i({},e.operationTypeHttpDispatcherConfigMap,t.operationTypeHttpDispatcherConfigMap)),s.overrideDisplayName=r(t.overrideDisplayName,e.overrideDisplayName),s.autoJoinOnConflict=r(t.autoJoinOnConflict,e.autoJoinOnConflict),s.enableDeltaRosterWeb=r(t.enableDeltaRosterWeb,e.enableDeltaRosterWeb),s.processSelfDataFromSubscribeResponse=r(t.processSelfDataFromSubscribeResponse,e.processSelfDataFromSubscribeResponse),s.enableMusicOnHoldV2=r(t.enableMusicOnHoldV2,e.enableMusicOnHoldV2),s.enablePstnMasking=r(t.enablePstnMasking,e.enablePstnMasking),s}},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(299),o=n(298),a=n(0),s=n(19),c=function(){function e(e){var t=this;this.settings=e,this.manager=new o.ApplicationInsightsManager,this.managerConfig=this.createConfigForManager(),this.currentTransmitProfile=s.Constants.REPORTING_PROFILE.RT_PROFILE,this.initManager(),this.uiVersion=this.getUiVersion(),this.settings.configProvider.on("configUpdated",function(){return t.updateChannelConfig()})}return e.prototype.createConfigForManager=function(){var e={extensionConfig:{LocalStorage:{storageKey:"TsCalling"}},propertyConfiguration:{populateBrowserInfo:!0,populateOperatingSystemInfo:!0},channelConfiguration:{eventsLimitInMem:this.settings.configProvider.config.eventsLimitInMem},endpointUrl:this.settings.configProvider.config.collectorUrl};if(this.settings.configProvider.config.useLocalStorageForOneDs){var t=new r.LocalStorageChannel;e.channels=[[t]]}return e},e.prototype.getUiVersion=function(){var e=this.settings.clientInfo.match(/^.*?\/(\d+\/)(.*?)\/.*$/);return e?e[1]+e[2]:this.settings.clientInfo},e.prototype.updateChannelConfig=function(){this.settings.configProvider.config.eventsLimitInMem!==this.managerConfig.channelConfiguration.eventsLimitInMem&&this.manager.getPostChannel().setEventQueueLimits(this.settings.configProvider.config.eventsLimitInMem),this.setTransmitProfile()},e.prototype.initManager=function(){var e=this;this.manager.create(this.managerConfig,[]),this.manager.getPostChannel()._notificationManager.addNotificationListener({eventsDiscarded:function(t,n){return e.logDiscardedEvents(t,n)},eventsSent:function(t){return e.logSentEvents(t)}}),this.setTransmitProfile()},e.prototype.createLogger=function(e){return new l(e,this.manager,this.settings.configProvider,this.uiVersion,this.settings.contextProvider,this.settings.logger)},e.prototype.logDiscardedEvents=function(e,t){var n="discarded events:";e.forEach(function(e){return n=n+e.name+";"}),this.settings.logger.info(n+" reason:"+t)},e.prototype.logSentEvents=function(e){var t="sent events: "+(e[0]&&e[0].data&&e[0].data.CorrelationId&&a.getFrom("value",e[0].data.CorrelationId))+":";e.forEach(function(e){t=t+e.name+";"}),this.settings.logger.info(""+t)},e.prototype.setTransmitProfile=function(){var e;this.settings.configProvider.config.transmitProfileTimings.length&&this.manager.getPostChannel()._loadTransmitProfiles(((e={})[this.settings.configProvider.config.transmitProfileName]=this.settings.configProvider.config.transmitProfileTimings,e)),this.settings.configProvider.config.transmitProfileName!==this.currentTransmitProfile&&this.manager.getPostChannel()._setTransmitProfile(this.settings.configProvider.config.transmitProfileName),this.currentTransmitProfile=this.settings.configProvider.config.transmitProfileName},e}();t.OneDsTelemetryTransportLogger=c;var l=function(){function e(e,t,n,i,r,o){this.tenant=e,this.configProvider=n,this.uiVersion=i,this.contextProvider=r,this.logger=o,this.instanceConfig={extensions:[],extensionConfig:[]},this.manager=t,this.telemetryLoggerName=e}return e.prototype.sendEvent=function(e){var t,n,r=e.props&&e.props.CorrelationId?e.props.CorrelationId:"";this.setEnvPropertiesToEveryEvent();var a=this.getLogger(),s=e.props,c={};this.logger.info("preparing event for delievery: "+r+"/"+e.eventName),"signaling"===this.tenant&&(s.SkypeId&&(this.addPropertiesToEvent(s,"user_id",s.SkypeId,0),this.addPropertiesToEvent(s,"Skype_InitiatingUser_Username",s.SkypeId,0),delete s.SkypeId),this.uiVersion&&this.addPropertiesToEvent(s,"ui_version",this.uiVersion,0)),"media"===this.tenant&&this.uiVersion&&this.addPropertiesToEvent(s,"uiVersion",this.uiVersion,0);try{for(var l=i(Object.keys(s)),u=l.next();!u.done;u=l.next()){var d=u.value,p=s[d],f=p&&p.kind?p.kind:0,h=p&&p.hasOwnProperty("value")?p.value:p;this.addPropertiesToEvent(c,d,h,f)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}var g={name:e.eventName,data:c,latency:o.EventLatency.Normal,persistence:o.EventPersistence.Normal};this.logger.info("about to send event from 1ds logger:"+r+"/"+e.eventName),a.track(g)},e.prototype.setEnvPropertiesToEveryEvent=function(){var e=this,t=this.contextProvider&&this.contextProvider();a.deepEqual(this.ctx,t)||(this.ctx=t,a.keys(this.ctx).forEach(function(t){var n=e.ctx[t].piiKind?e.ctx[t].piiKind:0;e.manager.getPropertyManager().setProperty(t,{value:e.ctx[t].value,kind:n})}))},e.prototype.addPropertiesToEvent=function(e,t,n,i){var r={value:n,kind:i};e[t]=r},e.prototype.getLogger=function(){var e=this.configProvider.config.telemetryTenants[this.telemetryLoggerName],t=this.manager.getInst(e);return t||(t=this.manager.newInst(this.configProvider.config.telemetryTenants[this.telemetryLoggerName],this.instanceConfig,[]))},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=100},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(47);t.HttpRequestDispatcherImplementation=i.default;var r=n(126);t.pluginlessStackFactory=r.pluginlessStackFactory;var o=n(32);t.getOvb=o.getOvb,t.getVersion=o.getTsCallingVersion;var a=n(11);t.generateCauseId=a.generateCauseId},function(e,t,n){"use strict";n.r(t),n.d(t,"ApplicationInsightsManager",function(){return et}),n.d(t,"ApplicationInsights",function(){return tt}),n.d(t,"OverridePropertiesPlugin",function(){return Qe}),n.d(t,"PostChannel",function(){return Fe}),n.d(t,"BE_PROFILE",function(){return Ae}),n.d(t,"NRT_PROFILE",function(){return Ie}),n.d(t,"RT_PROFILE",function(){return Ce}),n.d(t,"PropertiesPlugin",function(){return Ee}),n.d(t,"Extensions",function(){return ge}),n.d(t,"AppExtensionKeys",function(){return ie}),n.d(t,"WebExtensionKeys",function(){return re}),n.d(t,"UserExtensionKeys",function(){return oe}),n.d(t,"OSExtKeys",function(){return ae}),n.d(t,"DeviceExtKeys",function(){return pe}),n.d(t,"OperatingSystem",function(){return Q}),n.d(t,"Application",function(){return _}),n.d(t,"Device",function(){return ee}),n.d(t,"Session",function(){return te}),n.d(t,"defaultFlightIdNameSpaces",function(){return g}),n.d(t,"TelemetryContext",function(){return _e}),n.d(t,"ValueKind",function(){return l.e}),n.d(t,"EventLatency",function(){return l.a}),n.d(t,"EventPersistence",function(){return l.b}),n.d(t,"TraceLevel",function(){return l.d}),n.d(t,"MinChannelPriorty",function(){return nt.a}),n.d(t,"NotificationManager",function(){return o.a}),n.d(t,"EventsDiscardedReason",function(){return Te.a}),n.d(t,"CoreUtils",function(){return i.a}),n.d(t,"DiagnosticLogger",function(){return a.a}),n.d(t,"isValueAssigned",function(){return r.isValueAssigned}),n.d(t,"isArray",function(){return r.isArray}),n.d(t,"isBeaconsSupported",function(){return r.isBeaconsSupported}),n.d(t,"isBoolean",function(){return r.isBoolean}),n.d(t,"isLatency",function(){return r.isLatency}),n.d(t,"isNumber",function(){return r.isNumber}),n.d(t,"isReactNative",function(){return r.isReactNative}),n.d(t,"isString",function(){return r.isString}),n.d(t,"isUint8ArrayAvailable",function(){return r.isUint8ArrayAvailable}),n.d(t,"getISOString",function(){return r.getISOString}),n.d(t,"cookieAvailable",function(){return r.cookieAvailable}),n(10);var i=n(1),r=n(3),o=n(64),a=n(34),s=n(23),c=n(24),l=n(13),u=n(129),d=n(4),p=n(7),f=n(62),h=n(5),g=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"];function m(e,t){void 0===t&&(t=g);var n=null;if(e)for(var i=e.split(","),r=0;r<i.length;r++)v(i[r],t)&&(n?n+=","+i[r]:n=i[r]);return n}function v(e,t){if(void 0===t&&(t=g),!e||e.length<4)return!1;for(var n=!1,i=e.substring(0,3).toString().toUpperCase(),r=0;r<t.length;r++)if(t[r]+":"===i&&e.length<=256){n=!0;break}return n}var y,S,_=function(){function e(e){this.appExpId=null,this.flightIdNameSpaces=g.slice(0),this.expIdCookieName="Treatments",this._propertiesConfig=e;var t=Object(h.c)();if(t){var n=t.documentElement;t&&(this.locale=n.lang)}this.env=e.env?e.env:this._getMetaDataFromDOM("awa-").env}return e.prototype.getExpId=function(){return this._propertiesConfig.expId?this._readExpIdFromCoreData(this._propertiesConfig.expId):this._readExpIdFromCookie()},e.prototype._getMetaDataFromDOM=function(e){var t,n={},i=Object(h.c)();if(i){t=i&&i.querySelectorAll("meta");for(var r=0;r<t.length;r++){var o=t[r];o.name&&0===o.name.toLowerCase().indexOf(e)&&(n[o.name.replace(e,"")]=o.content)}}return n},e.prototype._setAppExpId=function(e){e!==this.appExpId&&(this.appExpId=m(e,this.flightIdNameSpaces))},e.prototype._getAppExpId=function(){return this.appExpId},e.prototype._readExpIdFromCookie=function(){return this._setAppExpId(Object(r.getCookie)(this.expIdCookieName)),this._getAppExpId()},e.prototype._readExpIdFromCoreData=function(e){return this._setAppExpId(e),this._getAppExpId()},e.validateAppExpId=m,e._staticInit=void Object(r.objDefineAccessors)(e.prototype,"expId",e.prototype.getExpId),e}(),E=function(){},T=null;
/*!
 * 1DS JS SDK Properties plugin, 3.0.1
 * Copyright (c) Microsoft and contributors. All rights reserved.
 * (Microsoft Internal Only)
 */function C(e,t,n,i){var o="",a="",s=Object(h.c)();if(s){i&&(o=";domain="+i);var c=Object(h.g)();c&&"https:"===c.protocol&&(a=";secure",null===T&&(T=Object(r.disallowsSameSiteNone)((Object(h.i)()||{}).userAgent)),T||(n+=";SameSite=None")),Object(r.cookieAvailable)()&&(s.cookie=t+"="+n+o+";path=/"+a)}}function I(){return void 0===y&&(y=!!b(S.LocalStorage)),y}function A(){return I()?b(S.LocalStorage):null}function b(e){var t,n,i=null;try{var o=Object(h.d)();if(!o)return null;n=new Date,(i=e===S.LocalStorage?o.localStorage:o.sessionStorage)&&Object(r.isFunction)(i.setItem)&&(i.setItem(n,n),t=i.getItem(n)!==n,i.removeItem(n),t&&(i=null))}catch(e){i=null}return i}!function(e){e[e.LocalStorage=0]="LocalStorage",e[e.SessionStorage=1]="SessionStorage"}(S||(S={})),i.a.isDate;var R=i.a.toISOString,O=function(){function e(t,n,o){if(this._logger=o,!t.disableCookiesUsage&&Object(r.cookieAvailable)()){var a=Object(r.getCookie)("MUID");if(a&&this.setLocalId("t:"+a),n.enableApplicationInsightsUser){var s=Object(r.getCookie)(e.userCookieName);if(s){var c=s.split(e.cookieSeparator);c.length>0&&(this.id=c[0])}if(!this.id){this.id=i.a.newId(t&&!i.a.isUndefined(t.idLength)?t.idLength:22);var l=new Date,u=R(l);this.accountAcquisitionDate=u,l.setTime(l.getTime()+31536e6);var d=[this.id,u],p=n.cookieDomain?n.cookieDomain:void 0;C(this._logger,e.userCookieName,d.join(e.cookieSeparator)+";expires="+l.toUTCString(),p)}}}if("undefined"!=typeof navigator){var f=navigator;this.locale=f.userLanguage||f.language}}return e.prototype.getLocalId=function(){if(this._customLocalId)return this._customLocalId;var e=Object(r.getCookie)("MUID");e&&this.setLocalId("t:"+e)},e.prototype.setLocalId=function(e){this._customLocalId=e},e.cookieSeparator="|",e.userCookieName="ai_user",e._staticInit=void Object(r.objDefineAccessors)(e.prototype,"localId",e.prototype.getLocalId,e.prototype.setLocalId),e}(),P="MSIE",N="Chrome",M="Firefox",w="Safari",D="Edge",L="Electron",k="SkypeShell",x="PhantomJS",F=function(){function e(e){this._propertiesConfig=e;var t=Object(h.g)();if(t){var n=t.hostname;n&&(this.domain="file:"===t.protocol?"local":n)}var i="undefined"!=typeof navigator?navigator.userAgent:"";if(e.userAgent&&(i=e.userAgent),e.populateBrowserInfo){if(i){var r=this._getBrowserName(i);this.browser=r,this.browserVer=this._getBrowserVersion(i,r)}var o=this._getScreenResolution();this.screenRes=o.w+"X"+o.h}}return e.prototype.getUserConsent=function(){return this._propertiesConfig.userConsented||!!Object(r.getCookie)(this._propertiesConfig.userConsentCookieName||"MSCC")},e.prototype.getUserConsentDetails=function(){try{if(this._propertiesConfig.callback&&this._propertiesConfig.callback.userConsentDetails){var e=this._propertiesConfig.callback.userConsentDetails();if(e)return JSON.stringify({Required:!!e.Required&&e.Required,Analytics:!!e.Analytics&&e.Analytics,SocialMedia:!!e.SocialMedia&&e.SocialMedia,Advertising:!!e.Advertising&&e.Advertising})}}catch(e){}return null},e.prototype._getBrowserName=function(e){return this._userAgentContainsString("OPR/",e)?"Opera":this._userAgentContainsString(x,e)?x:this._userAgentContainsString(D,e)?D:this._userAgentContainsString(L,e)?L:this._userAgentContainsString(N,e)?N:this._userAgentContainsString("Trident",e)?P:this._userAgentContainsString(M,e)?M:this._userAgentContainsString(w,e)?w:this._userAgentContainsString(k,e)?k:"Unknown"},e.prototype._userAgentContainsString=function(e,t){return t.indexOf(e)>-1},e.prototype._getBrowserVersion=function(e,t){return t===P?this._getIeVersion(e):this._getOtherVersion(t,e)},e.prototype._getIeVersion=function(e){var t=e.match(new RegExp(P+" ([\\d,.]+)"));if(t)return t[1];var n=e.match(new RegExp("rv:([\\d,.]+)"));return n?n[1]:void 0},e.prototype._getOtherVersion=function(e,t){e===w&&(e="Version");var n=t.match(new RegExp(e+"/([\\d,.]+)"));return n?n[1]:"Unknown"},e.prototype._getScreenResolution=function(){var e={h:0,w:0},t=Object(h.k)();return t&&t.screen&&(e.h=screen.height,e.w=screen.width),e},e._staticInit=void Object(r.objDefineAccessors)(e.prototype,"userConsent",e.prototype.getUserConsent),e}(),U="Windows",j="Mac OS X",H="Android",B=/(windows|win32)/i,G=/ arm;/i,V=/windows\sphone\s\d+\.\d+/i,W=/(macintosh|mac os x)/i,q=/(ipad|iphone|ipod)(?=.*like mac os x)/i,K=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,z=/android/i,J=/CrOS/i,Y={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},Q=function(){function e(e){var t="undefined"!=typeof navigator?navigator.userAgent:"";if(e.userAgent&&(t=e.userAgent),t&&e.populateOperatingSystemInfo){var n=this._getOsName(t.toLowerCase());this.name=n,this.ver=this._getOsVersion(t,n)}}return e.prototype._getOsName=function(e){return e.match(V)?"Windows Phone":e.match(G)?"Windows RT":e.match(B)?U:e.match(q)?"iOS":e.match(z)?H:e.match(K)?"Linux":-1!==e.indexOf("x11")?"Unix":-1!==e.indexOf("blackberry")?"BlackBerry":-1!==e.indexOf("symbian")?"Symbian":-1!==e.indexOf("nokia")?"Nokia":e.match(W)?j:e.match(J)?"Chrome OS":"Unknown"},e.prototype._getOsVersion=function(e,t){return t===U?this._getGenericOsVersion(e,"Windows NT"):t===H?this._getGenericOsVersion(e,t):t===j?this._getMacOsxVersion(e):"Unknown"},e.prototype._getGenericOsVersion=function(e,t){var n=e.match(new RegExp(t+" ([\\d,.]+)"));return n?Y[n[1]]?Y[n[1]]:n[1]:"Unknown"},e.prototype._getMacOsxVersion=function(e){var t=e.match(new RegExp(j+" ([\\d,_,.]+)"));if(t){var n=t[1].replace(/_/g,".");if(n){var i=this._getDelimiter(n);return i?n.split(i)[0]:n}}return"Unknown"},e.prototype._getDelimiter=function(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null},e}(),X=function(){function e(e){e.serviceName&&(this.serviceName=e.serviceName)}return e.prototype.getMsfpc=function(){return Object(r.getCookie)("MSFPC")},e.prototype.getAnid=function(){return Object(r.getCookie)("ANON").slice(0,34)},e._staticInit=(Object(r.objDefineAccessors)(e.prototype,"msfpc",e.prototype.getMsfpc),void Object(r.objDefineAccessors)(e.prototype,"anid",e.prototype.getAnid)),e}(),$=function(e){this.popSample=100,this.eventFlags=0,e.hashIdentifiers&&(this.eventFlags=1048576|this.eventFlags),e.dropIdentifiers&&(this.eventFlags=2097152|this.eventFlags)},Z=function(){var e=(new Date).getTimezoneOffset(),t=e%60,n=(e-t)/60,i="+";n>0&&(i="-"),n=Math.abs(n),t=Math.abs(t),this.tz=i+(n<10?"0"+n:n.toString())+":"+(t<10?"0"+t:t.toString())},ee=function(){},te=function(){function e(){}return e.prototype.setId=function(e){this.customId=e},e.prototype.getId=function(){return Object(r.isString)(this.customId)?this.customId:this.automaticId},e._staticInit=void Object(r.objDefineAccessors)(e.prototype,"id",e.prototype.getId,e.prototype.setId),e}(),ne=function(e,t,n,r){if(e.enableApplicationInsightsTrace){this.traceId=t||i.a.generateW3CId(),this.parentId=n,this.name=r;var o=Object(h.g)();o&&o.pathname&&(this.name=o.pathname)}},ie=function(){function e(){}return e.id="id",e.ver="ver",e.appName="name",e.locale="locale",e.expId="expId",e.env="env",e}(),re=function(){function e(){}return e.domain="domain",e.browser="browser",e.browserVer="browserVer",e.screenRes="screenRes",e.userConsent="userConsent",e.consentDetails="consentDetails",e}(),oe=function(){function e(){}return e.locale="locale",e.localId="localId",e.id="id",e}(),ae=function(){function e(){}return e.osName="name",e.ver="ver",e}(),se=function(){function e(){}return e.ver="ver",e.seq="seq",e.installId="installId",e.epoch="epoch",e}(),ce=function(){function e(){}return e.msfpc="msfpc",e.anid="anid",e.serviceName="serviceName",e}(),le=function(){function e(){}return e.popSample="popSample",e.eventFlags="eventFlags",e}(),ue=function(){function e(){}return e.tz="tz",e}(),de=function(){function e(){}return e.sessionId="sesId",e}(),pe=function(){function e(){}return e.localId="localId",e.deviceClass="deviceClass",e.make="make",e.model="model",e}(),fe=function(){function e(){}return e.role="role",e.roleInstance="roleInstance",e.roleVer="roleVer",e}(),he=function(){function e(){}return e.traceId="traceID",e.traceName="name",e.parentId="parentID",e}(),ge=function(){function e(){}return e.UserExt="user",e.DeviceExt="device",e.TraceExt="trace",e.WebExt="web",e.AppExt="app",e.OSExt="os",e.SdkExt="sdk",e.IntWebExt="intweb",e.UtcExt="utc",e.LocExt="loc",e.CloudExt="cloud",e}(),me="MicrosoftApplicationsTelemetryDeviceId",ve=function(){function e(e){if(this._sequenceId=0,this._propertyStorage=e.propertyStorageOverride,this.seq=this._sequenceId,this.epoch=(new Date).getTime().toString(),!e.disableCookiesUsage&&Object(r.cookieAvailable)()||this._propertyStorage){var t=this._getData(me);t||(t=i.a.newGuid()),this._saveData(me,t),this.installId=t}else Object(r.deleteCookie)(me)}return e.prototype.getSequenceId=function(){return++this._sequenceId},e.prototype._saveData=function(e,t){var n=this._propertyStorage;n?n.setProperty(e,t):Object(r.setCookie)(e,t,365)},e.prototype._getData=function(e){return this._propertyStorage?this._propertyStorage.getProperty(e)||"":Object(r.getCookie)(e)},e}(),ye=function(){function e(t,n){var o,s,u;Object(d.a)(e,this,function(d){var p,f={sessionRenewalMs:(p=t).sessionRenewalMs&&function(){return p.sessionRenewalMs},sessionExpirationMs:p.sessionExpirationMs&&function(){return p.sessionExpirationMs},cookieDomain:p.cookieDomain&&function(){return p.cookieDomain},namePrefix:p.namePrefix&&function(){return p.namePrefix},sessionAsGuid:function(){return p.sessionAsGuid},idLength:function(){return p.idLength?p.idLength:22}};function h(e){var t=d.automaticSession,n=e.split("|");n.length>0&&t.setId(n[0]);try{if(n.length>1){var i=+n[1];t.acquisitionDate=+new Date(i),t.acquisitionDate=t.acquisitionDate>0?t.acquisitionDate:0}if(n.length>2){var r=+n[2];t.renewalDate=+new Date(r),t.renewalDate=t.renewalDate>0?t.renewalDate:0}}catch(e){s.throwInternal(c.a.CRITICAL,l.f.ErrorParsingAISessionCookie,"Error parsing ai_session cookie, session will be reset: "+e)}0===t.renewalDate&&s.throwInternal(c.a.WARNING,l.f.SessionRenewalDateIsZero,"AI session renewal date is 0, session will be reset.")}function g(){var e=d.automaticSession,t=(new Date).getTime(),n=d.config.sessionAsGuid();!i.a.isUndefined(n)&&n?i.a.isBoolean(n)?e.setId(Object(r.createGuid)()):e.setId(Object(r.createGuid)(n)):e.setId(i.a.newId(f&&f.idLength?f.idLength():22)),e.acquisitionDate=t,e.renewalDate=t,m(e.getId(),e.acquisitionDate,e.renewalDate),I()||s.throwInternal(c.a.WARNING,l.f.BrowserDoesNotSupportLocalStorage,"Browser does not support local storage. Session durations will be inaccurate.")}function m(e,t,n){var i=t+d.config.sessionExpirationMs(),r=n+d.config.sessionRenewalMs(),a=new Date,s=[e,t,n];i<r?a.setTime(i):a.setTime(r);var c=d.config.cookieDomain?d.config.cookieDomain():null;C(0,u(),s.join("|")+";expires="+a.toUTCString(),c),o=(new Date).getTime()}s=i.a.isNullOrUndefined(n)?new a.a:n,i.a.isFunction(t.sessionExpirationMs)||(f.sessionExpirationMs=function(){return e.acquisitionSpan}),i.a.isFunction(t.sessionRenewalMs)||(f.sessionRenewalMs=function(){return e.renewalSpan}),d.config=f,u=function(){return d.config.namePrefix&&d.config.namePrefix()?e.cookieNameConst+d.config.namePrefix():e.cookieNameConst},d.automaticSession=new te,d.update=function(){d.automaticSession.getId()||function(){var e=Object(r.getCookie)(u());if(e&&i.a.isFunction(e.split))h(e);else{var t=function(e,t){var n=A();if(null!==n)try{return n.getItem(t)}catch(t){y=!1,e.throwInternal(c.a.CRITICAL,l.f.BrowserCannotReadLocalStorage,"Browser failed read of local storage. "+t)}return null}(s,u());t&&h(t)}d.automaticSession.getId()||g()}();var t=d.automaticSession,n=d.config,a=(new Date).getTime(),p=a-t.acquisitionDate>n.sessionExpirationMs(),f=a-t.renewalDate>n.sessionRenewalMs();p||f?g():(!o||a-o>e.cookieUpdateInterval)&&(t.renewalDate=a,m(t.getId(),t.acquisitionDate,t.renewalDate))},d.backup=function(){var e,t,n,i=d.automaticSession;e=i.getId(),t=i.acquisitionDate,n=i.renewalDate,function(e,t,n){var i=A();if(null!==i)try{i.setItem(t,n)}catch(t){y=!1,e.throwInternal(c.a.CRITICAL,l.f.BrowserCannotWriteLocalStorage,"Browser failed write to local storage. "+t)}}(s,u(),[e,t,n].join("|"))}})}return e.acquisitionSpan=864e5,e.renewalSpan=18e5,e.cookieUpdateInterval=6e4,e.cookieNameConst="ai_session",e}(),Se=r.isString,_e=function(){function e(e,t,n){this.app=new _(t),this.cloud=new E,this.user=new O(e,t,n&&n.logger),this.os=new Q(t),this.web=new F(t),this.sdk=new ve(e),this.intWeb=new X(t),this.utc=new $(t),this.loc=new Z,this.device=new ee,this.telemetryTrace=new ne(t),this.sessionManager=new ye(t,n&&n.logger),this.session=new te}return e.prototype.getSessionId=function(){var e=this.session;if(e&&Se(e.customId))return e.customId;var t=this.sessionManager;t.update();var n=t.automaticSession;if(n){var i=n.getId();i&&Se(i)&&(e.automaticId=i)}return e.automaticId},e.prototype.applyApplicationContext=function(e){var t=this.app;Se(t.id)&&(e.ext[ge.AppExt][ie.id]=t.id),Se(t.ver)&&(e.ext[ge.AppExt][ie.ver]=t.ver),Se(t.name)&&(e.ext[ge.AppExt][ie.appName]=t.name),Se(t.locale)&&(e.ext[ge.AppExt][ie.locale]=t.locale);var n=t.getExpId();Se(n)&&(e.ext[ge.AppExt][ie.expId]=n),Se(t.env)&&(e.ext[ge.AppExt][ie.env]=t.env)},e.prototype.applyUserContext=function(e){var t=this.user,n=t.getLocalId();Se(n)&&(e.ext[ge.UserExt][oe.localId]=n),Se(t.locale)&&(e.ext[ge.UserExt][oe.locale]=t.locale),Se(t.id)&&(e.ext[ge.UserExt][oe.id]=t.id)},e.prototype.applyWebContext=function(e){var t=this.web;Se(t.domain)&&(e.ext[ge.WebExt][re.domain]=t.domain),Se(t.browser)&&(e.ext[ge.WebExt][re.browser]=t.browser),Se(t.browserVer)&&(e.ext[ge.WebExt][re.browserVer]=t.browserVer),Se(t.screenRes)&&(e.ext[ge.WebExt][re.screenRes]=t.screenRes),e.ext[ge.WebExt][re.userConsent]=t.getUserConsent(),e.ext[ge.WebExt][re.consentDetails]=t.getUserConsentDetails()},e.prototype.applyOsContext=function(e){var t=this.os;Se(t.name)&&(e.ext[ge.OSExt][ae.osName]=t.name),Se(t.ver)&&(e.ext[ge.OSExt][ae.ver]=t.ver)},e.prototype.applySdkContext=function(e){var t=this.sdk;e.ext[ge.SdkExt][se.seq]=t.getSequenceId(),e.ext[ge.SdkExt][se.epoch]=t.epoch,Se(t.installId)&&(e.ext[ge.SdkExt][se.installId]=t.installId)},e.prototype.applyIntWebContext=function(e){var t=this.intWeb,n=t.getMsfpc();Se(n)&&(e.ext[ge.IntWebExt][ce.msfpc]=n);var i=t.getAnid();Se(i)&&(e.ext[ge.IntWebExt][ce.anid]=i),Se(t.serviceName)&&(e.ext[ge.IntWebExt][ce.serviceName]=t.serviceName)},e.prototype.applyUtcContext=function(e){var t=this.utc;e.ext[ge.UtcExt][le.popSample]=t.popSample,t.eventFlags>0&&(e.ext[ge.UtcExt][le.eventFlags]=t.eventFlags)},e.prototype.applyLocContext=function(e){e.ext[ge.LocExt][ue.tz]=this.loc.tz},e.prototype.applySessionContext=function(e){e.ext[ge.AppExt][de.sessionId]=this.getSessionId()},e.prototype.applyDeviceContext=function(e){var t=this.device;Se(t.localId)&&(e.ext[ge.DeviceExt][pe.localId]=t.localId),Se(t.make)&&(e.ext[ge.DeviceExt][pe.make]=t.make),Se(t.model)&&(e.ext[ge.DeviceExt][pe.model]=t.model),Se(t.deviceClass)&&(e.ext[ge.DeviceExt][pe.deviceClass]=t.deviceClass)},e.prototype.applyCloudContext=function(e){var t=this.cloud;Se(t.role)&&(e.ext[ge.CloudExt][fe.role]=t.role),Se(t.roleInstance)&&(e.ext[ge.CloudExt][fe.roleInstance]=t.roleInstance),Se(t.roleVer)&&(e.ext[ge.CloudExt][fe.roleVer]=t.roleVer)},e.prototype.applyAITraceContext=function(e){var t=this.telemetryTrace;Se(t.traceId)&&(e.ext[ge.TraceExt][he.traceId]=t.traceId),Se(t.name)&&(e.ext[ge.TraceExt][he.traceName]=t.name),Se(t.parentId)&&(e.ext[ge.TraceExt][he.parentId]=t.parentId)},e}(),Ee=function(e){function t(){var n,i=e.call(this)||this;i.identifier="SystemPropertiesCollector",i.priority=3,i.version="3.0.1";var o={};return Object(d.a)(t,i,function(t,a){t.initialize=function(r,o,a){e.prototype.initialize.call(i,r,o,a),n=new _e(r,t._getTelCtx().getExtCfg(t.identifier),o)},t.processTelemetry=function(e,i){Object(r.setProcessTelemetryTimings)(e,t.identifier),i=t._getTelCtx(i);var a,s,c=e.ext=e.ext?e.ext:{};e.data=e.data?e.data:{},c[ge.AppExt]=c[ge.AppExt]||{},c[ge.UserExt]=c[ge.UserExt]||{},c[ge.WebExt]=c[ge.WebExt]||{},c[ge.OSExt]=c[ge.OSExt]||{},c[ge.SdkExt]=c[ge.SdkExt]||{},c[ge.IntWebExt]=c[ge.IntWebExt]||{},c[ge.UtcExt]=c[ge.UtcExt]||{},c[ge.LocExt]=c[ge.LocExt]||{},c[ge.DeviceExt]=c[ge.DeviceExt]||{},c[ge.TraceExt]=c[ge.TraceExt]||{},c[ge.CloudExt]=c[ge.CloudExt]||{},n.applyApplicationContext(e),n.applyUserContext(e),n.applyWebContext(e),n.applyOsContext(e),n.applySdkContext(e),n.applyIntWebContext(e),n.applyUtcContext(e),n.applyLocContext(e),n.applySessionContext(e),n.applyDeviceContext(e),n.applyAITraceContext(e),n.applyCloudContext(e),p.a.arrForEach(p.a.objKeys(c),function(e){0===p.a.objKeys(c[e]).length&&delete c[e]}),a=o,s=e.data,a&&Object(r.objForEachKey)(a,function(e,t){s[e]||(s[e]=t)}),t.processNext(e,i)},t.getPropertiesContext=function(){return n},t.setProperty=function(e,t){o[e]=t}}),i}return __extends(t,e),t}(f.a),Te=n(63),Ce="REAL_TIME",Ie="NEAR_REAL_TIME",Ae="BEST_EFFORT",be=function(){function e(t,n){var r=n?[].concat(n):[],o=i.a.isNullOrUndefined;this.iKey=function(){return t},this.count=function(){return r.length},this.events=function(){return r},this.addEvents=function(e,t){return void 0===t&&(t=!0),e&&e.length>0?(r=t?r.concat(e):e.concat(r),e.length):0},this.split=function(n,i){var a=new e(t);if(n<r.length){var s=r.length-n;o(i)||(s=i<s?i:s),a.addEvents(r.splice(n,s),!0)}return a}}return e.create=function(t,n){return new e(t,n)},e}(),Re=Math.min(2e6,65e3),Oe=/\./,Pe=function e(t,n,o,a){var c=!!a,l=n,u={};Object(d.a)(e,this,function(e){function n(e,t,i,a,s,d){Object(r.objForEachKey)(e,function(e,p){var f=null;if(Object(r.isValueAssigned)(p)){var h=i,g=e,m=s,v=t;if(c&&!a&&Oe.test(e)){var y=e.split("."),S=y.length;if(S>1){m&&(m=m.slice());for(var _=0;_<S-1;_++){var E=y[_];v=v[E]=v[E]||{},h+="."+E,m&&m.push(E)}g=y[S-1]}}if(f=a&&function(e,t){var n=u[e];return void 0===n&&(n=!1,(0===e.indexOf("ext.metadata")||0===e.indexOf("ext.web"))&&(n=!0),u[e]=n),n}(h)||!l||!l.handleField(h,g)?Object(r.sanitizeProperty)(g,p,o):l.value(h,g,p,o)){var T=f.value;if(v[g]=T,d&&d(m,g,f),Object(r.isObject)(T)&&!Object(r.isArray)(T)){var C=m;C&&(C=C.slice()).push(g),n(p,T,h+"."+g,a,C,d)}}}})}e.createPayload=function(e,t,n,i){return{apiKeys:[],payloadBlob:"",overflow:null,sizeExceed:[],batches:[],numEvents:0,retryCnt:e,isTeardown:t,isSync:n,isBeacon:i}},e.appendPayload=function(n,r,o){var a=n&&r&&!n.overflow;return a&&Object(s.b)(t,function(){return"Serializer:appendPayload"},function(){for(var t=r.events(),a=n.payloadBlob,s=n.numEvents,c=!1,l=[],u=n.isBeacon,d=u?65e3:3984588,p=u?Re:2e6,f=0,h=0;f<t.length;){var g=t[f];if(g){if(s>=o){n.overflow=r.split(f);break}var m=e.getEventBlob(g);if(m.length<=p){var v=m.length;if(a.length+v>d){n.overflow=r.split(f);break}a&&(a+="\n"),a+=m,++h>20&&(a.substr(0,1),h=0),c=!0,s++}else l.concat(t.slice(f,1))}f++}if(l&&l.length>0&&n.sizeExceed.push(be.create(r.iKey(),l)),c){n.batches.push(r),n.payloadBlob=a,n.numEvents=s;var y=r.iKey();-1===i.a.arrIndexOf(n.apiKeys,y)&&n.apiKeys.push(y)}},function(){return{payload:n,theBatch:{iKey:r.iKey(),evts:r.events()},max:o}}),a},e.getEventBlob=function(e){return Object(s.b)(t,function(){return"Serializer.getEventBlob"},function(){var t={name:e.name,time:e.time,ver:e.ver,iKey:"o:"+Object(r.getTenantId)(e.iKey)},i={},o=e.ext;o&&(t.ext=i,Object(r.objForEachKey)(o,function(e,t){n(t,i[e]={},"ext."+e,!0,null,null)}));var a=t.data={baseType:e.baseType},s=a.baseData={};return n(e.baseData,s,"baseData",!1,["baseData"],function(e,t,n){Ne(i,e,t,n)}),n(e.data,a,"data",!1,[],function(e,t,n){Ne(i,e,t,n)}),JSON.stringify(t)},function(){return{item:e}})}})};function Ne(e,t,n,i){if(i&&e){var o=Object(r.getCommonSchemaMetaData)(i.value,i.kind,i.propertyType);if(o>-1){var a=e.metadata;a||(a=e.metadata={f:{}});var s=a.f;s||(s=a.f={}),Object(r.arrForEach)(t,function(e){s[e]||(s[e]={f:{}});var t=s[e].f;t||(t=s[e].f={}),s=t}),s=s[n]={},Object(r.isArray)(i.value)?s.a={t:o}:s.t=o}}}
/*!
 * 1DS JS SDK POST plugin, 3.0.1
 * Copyright (c) Microsoft and contributors. All rights reserved.
 * (Microsoft Internal Only)
 */var Me,we=function(){function e(){}return e.shouldRetryForStatus=function(e){return!(e>=300&&e<500&&408!==e&&429!==e||501===e||505===e)},e.getMillisToBackoffForRetry=function(e){var t,n=Math.floor(1200*Math.random())+2400;return t=Math.pow(2,e)*n,Math.min(t,6e5)},e}(),De=((Me={})[1]="requeue",Me[100]="requeue",Me[200]="sent",Me[8004]="drop",Me[8003]="drop",Me);function Le(e){try{return e.responseText}catch(e){}return""}var ke=function e(t,n,o,a){this._responseHandlers=[];var u,p,f,g="?cors=true&content-type=application/x-json-stream&client-id=NO_AUTH&client-version="+r.FullVersionString,m=new function e(){var t={};Object(d.a)(e,this,function(e){e.setKillSwitchTenants=function(e,n){if(e&&n)try{var o=(c=e.split(","),l=[],c&&Object(r.arrForEach)(c,function(e){l.push(Object(r.strTrim)(e))}),l);if("this-request-only"===n)return o;for(var a=1e3*parseInt(n,10),s=0;s<o.length;++s)t[o[s]]=i.a.dateNow()+a}catch(e){return[]}var c,l;return[]},e.isTenantKilled=function(e){var n=t,o=Object(r.strTrim)(e);return void 0!==n[o]&&n[o]>i.a.dateNow()||(delete n[o],!1)}})},v=!1,y=new function e(){var t=!0,n=!0,i=!0,r="use-collector-delta",o=!1;Object(d.a)(e,this,function(e){e.allowRequestSending=function(){return t},e.firstRequestSent=function(){i&&(i=!1,o||(t=!1))},e.shouldAddClockSkewHeaders=function(){return n},e.getClockSkewHeaderValue=function(){return r},e.setClockSkew=function(e){o||(e?(r=e,n=!0,o=!0):n=!1,t=!0)}})},S=!1,_=0,E=!0,T=[],C={},I=[],A=null,b=!1;Object(d.a)(e,this,function(e){var d=!0;function R(e,t){var n=new XDomainRequest;n.open("POST",e.urlString),n.onload=function(){var e=Le(n);N(t,200,{},e),G(e)},n.onerror=function(){N(t,400,{})},n.ontimeout=function(){N(t,500,{})},n.send(e.data)}function O(e,t){var n;fetch(e.urlString,(n={body:e.data,method:"POST",credentials:"include"},n.Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0,n.headers=e.headers,n)).then(function(e){var n={},i="";e.headers&&e.headers.forEach(function(e,t){n[t]=e}),e.body&&e.text().then(function(e){i=e}),N(t,e.status,n,i),G(i)}).catch(function(e){N(t,0,{})})}function P(e,t,n){function i(e,t,n){if(!e[n]&&t&&t.getResponseHeader){var i=t.getResponseHeader(n);i&&(e[n]=Object(r.strTrim)(i))}return e}function o(e,n){N(t,e.status,function(e){var t={};return t=e.getAllResponseHeaders?function(e){var t={};if(Object(r.isString)(e)){var n=Object(r.strTrim)(e).split(/[\r\n]+/);Object(r.arrForEach)(n,function(e){if(e){var n=e.indexOf(": ");if(-1!==n){var i=Object(r.strTrim)(e.substring(0,n)).toLowerCase(),o=Object(r.strTrim)(e.substring(n+1));t[i]=o}else t[Object(r.strTrim)(e)]=1}})}return t}(e.getAllResponseHeaders()):i(t=i(t=i(t,e,"time-delta-millis"),e,"kill-duration"),e,"kill-duration-seconds")}(e),n)}var a=new XMLHttpRequest;try{a.Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0}catch(e){}d&&(a.withCredentials=!0),a.open("POST",e.urlString,!n),Object(r.arrForEach)(Object(r.objKeys)(e.headers),function(t){a.setRequestHeader(t,e.headers[t])}),a.onload=function(){var e=Le(a);o(a,e),G(e)},a.onerror=function(){o(a)},a.ontimeout=function(){o(a)},a.send(e.data)}function N(e,t,n,i){try{e(t,n,i)}catch(e){u.diagLog().throwInternal(c.a.WARNING,l.f.SendPostOnCompleteFailure,e)}}function M(){return!v&&_<n}function w(){var e=I;return I=[],e}function D(e,t,n){var i=!1;return e&&e.length>0&&!v&&p&&A&&(i=t||M()&&(n>0||y.allowRequestSending())),i}function L(e){var t={};return e&&Object(r.arrForEach)(e,function(e,n){t[n]={iKey:e.iKey(),evts:e.events()}}),t}function k(e,n,i,o,a,c){if(e&&0!==e.length)if(v)V(e,1,o);else{var l=e;Object(s.b)(f,function(){return"HttpManager:_sendBatches"},function(s){s&&(e=e.slice(0));for(var l=[],u=null,d=Object(r.getTime)();D(e,o,n);){var p=e.shift();p&&p.count()>0&&(m.isTenantKilled(p.iKey())?l.push(p):(u=u||A.createPayload(n,i,o,c&&F()),A.appendPayload(u,p,t)?null!==u.overflow&&(e=[u.overflow].concat(e),u.overflow=null,j(u,d,Object(r.getTime)(),a),d=Object(r.getTime)(),u=null):(j(u,d,Object(r.getTime)(),a),d=Object(r.getTime)(),e=[p].concat(e),u=null)))}u&&j(u,d,Object(r.getTime)(),a),e.length>0&&(I=e.concat(I)),V(l,8004,o)},function(){return{batches:L(l),retryCount:n,isTeardown:i,isSynchronous:o,sendReason:a,useSendBeacon:c}},!o)}}function x(e){var t=g,n="";Object(r.arrForEach)(e.apiKeys,function(e){n.length>0&&(n+=","),n+=e}),n.length>0&&(t+="&apikey="+n),t+="&upload-time="+i.a.dateNow().toString();var o=function(e){for(var t=0;t<e.batches.length;t++)for(var n=e.batches[t].events(),i=0;i<n.length;i++){var o=(n[i].ext||{}).intweb||{};if(Object(r.isValueAssigned)(o.msfpc))return encodeURIComponent(o.msfpc)}return""}(e);if(Object(r.isValueAssigned)(o)&&(t=t+"&ext.intweb.msfpc="+o),y.shouldAddClockSkewHeaders()&&(t+="&time-delta-to-apply-millis="+y.getClockSkewHeaderValue()),f.getWParam){var a=f.getWParam();a>=0&&(t+="&w="+a)}for(var s=0;s<T.length;s++)t+="&"+T[s].name+"="+T[s].value;return t}function F(){return!E&&S&&Object(r.isBeaconsSupported)()}function U(e,t,n){e[t]=e[t]||{},e[t][u.identifier]=n}function j(t,n,i,a){if(t&&t.payloadBlob&&t.payloadBlob.length>0){var c=x(t),l=Object(r.getTime)();Object(s.b)(f,function(){return"HttpManager:_doPayloadSend"},function(){Object(r.arrForEach)(t.batches,function(e){Object(r.arrForEach)(e.events(),function(e){if(b){var t=e.timings=e.timings||{};U(t,"sendEventStart",l),U(t,"serializationStart",n),U(t,"serializationCompleted",i)}e.sendAttempt>0?e.sendAttempt++:e.sendAttempt=1})}),V(t.batches,1e3+(a||0),t.isSync,!0);var d={data:t.payloadBlob,urlString:c,headers:C},g=null,v=!!e.sendHook;F()&&t.isBeacon?(v=!1,g=function(n){!function(e,t,n){try{if(Object(r.isBeaconsSupported)()){var i=Object(h.i)();if(i.sendBeacon(e.urlString,e.data))return void H(t,200,n,!1);Object(r.arrForEach)(t.batches,function(e){null.push(e.split(0))}),H(t,200,n,!1),V(null,8003,t.isSync,!0)}}catch(e){u.diagLog().warnToConsole("Failed to send telemetry using sendBeacon API. Ex:"+e)}}(n,t,a),e.sendListener&&e.sendListener(d,n,t.isSync||t.isTeardown,!0)}):p&&(g=function(n){y.firstRequestSent();var i=function(e,n){!function(e,t,n,i){var a=9e3,s=null,c=!1,l=!1;try{var u=!0;if(typeof e!==r.strUndefined){if(t){y.setClockSkew(t["time-delta-millis"]);var d=t["kill-duration"]||t["kill-duration-seconds"];Object(r.arrForEach)(m.setKillSwitchTenants(t["kill-tokens"],d),function(e){Object(r.arrForEach)(n.batches,function(t){if(t.iKey()===e){s=s||[];var i=t.split(0);n.numEvents-=i.count(),s.push(i)}})})}if(200===e)return void(a=200);(!we.shouldRetryForStatus(e)||n.numEvents<=0)&&(u=!1),a=9e3+e%1e3}if(u){a=100;var p=n.retryCnt;n.isSync||(p<o?(c=!0,B(function(){n.isSync||_--,k(n.batches,p+1,n.isTeardown,n.isSync,5,n.isBeacon)},!0,we.getMillisToBackoffForRetry(p))):l=!0)}}finally{c||(y.setClockSkew(),H(n,a,i,l)),V(s,8004,n.isSync)}}(e,n,t,a)};try{p.sendPOST(n,i,t.isTeardown||t.isSync),e.sendListener&&e.sendListener(d,n,t.isSync||t.isTeardown,!1)}catch(e){N(i,0,{})}}),Object(s.b)(f,function(){return"HttpManager:_doPayloadSend.sender"},function(){if(g)if(t.isSync||_++,v){var n={data:d.data,urlString:d.urlString,headers:d.headers},i=!1;Object(s.b)(f,function(){return"HttpManager:_doPayloadSend.sendHook"},function(){try{e.sendHook(n,function(e){i=!0,g(e)},t.isSync||t.isTeardown)}catch(e){i||g(d)}})}else g(d)}),V(t.sizeExceed,8003,t.isSync)},function(){return{thePayload:t,serializationStart:n,serializationCompleted:i,sendReason:a}},t.isSync)}}function H(t,n,i,o){try{o&&u._backOffTransmission(),200===n&&(o||t.isSync||u._clearBackOff(),function(e){if(b){var t=Object(r.getTime)();Object(r.arrForEach)(e,function(e){var n,i;e&&e.count()>0&&(n=e.events(),i=t,b&&Object(r.arrForEach)(n,function(e){U(e.timings=e.timings||{},"sendEventCompleted",i)}))})}}(t.batches)),V(t.batches,n,t.isSync,!0)}finally{t.isSync||(_--,5!==i&&e.sendQueuedRequests(i,!t.isSync,t.isBeacon))}}function B(e,t,n){t?e():u._setTimeoutOverride(e,n)}function G(t){var n=e._responseHandlers;try{for(var i=0;i<n.length;i++)try{n[i](t)}catch(e){u.diagLog().throwInternal(c.a.CRITICAL,l.f.PostResponseHandler,"Response handler failed: "+e)}if(t){var o=JSON.parse(t);Object(r.isValueAssigned)(o.webResult)&&Object(r.isValueAssigned)(o.webResult.msfpc)&&Object(r.setCookie)("MSFPC",o.webResult.msfpc,365)}}catch(e){}}function V(e,t,n,i){if(e&&e.length>0&&a){var o=a[(d=t,p=De[d],Object(r.isValueAssigned)(p)||(p="oth",d>=9e3&&d<=9999?p="rspFail":d>=8e3&&d<=8999?p="drop":d>=1e3&&d<=1999&&(p="send")),p)];o&&Object(s.b)(f,function(){return"HttpManager:_sendBatchesNotification"},function(){B(function(){try{o.call(a,e,t,n)}catch(e){u.diagLog().throwInternal(c.a.CRITICAL,l.f.NotificationException,"send request notification failed: "+e)}},i||n,0)},function(){return{batches:L(e),reason:t,isSync:n,sendSync:i}},!n)}var d,p}e.initialize=function(e,t,n,o,a){a||(a={}),g=e+g,b=!(f=t).config.disableEventTimings;var s=!!f.config.enableCompoundKey;u=n;var c=a.valueSanitizer,l=a.stringifyObjects;if(i.a.isUndefined(a.enableCompoundKey)||(s=!!a.enableCompoundKey),A=new Pe(f,c,l,s),!(p=o)){E=!1,S=!Object(r.isReactNative)();var m=Object(h.g)();m&&m.protocol&&"file:"===m.protocol.toLowerCase()&&(d=!1);var v=null;Object(r.useXDomainRequest)()?v=R:Object(r.isReactNative)()?v=O:"undefined"!=typeof XMLHttpRequest&&(v=P),p={sendPOST:v}}},e._getDbgPlgTargets=function(){return[p,m,A]},e.addQueryStringParameter=function(e,t){for(var n=0;n<T.length;n++)if(T[n].name===e)return void(T[n].value=t);T.push({name:e,value:t})},e.addHeader=function(e,t){C[e]=t},e.canSendRequest=function(){return M()&&y.allowRequestSending()},e.sendQueuedRequests=function(e,t,n){var r=!i.a.isNullOrUndefined(t)&&!t;D(I,r,0)&&k(w(),0,!1,r,e||0,!!n)},e.isCompletelyIdle=function(){return!v&&0===_&&0===I.length},e.addBatch=function(e){if(e&&e.count()>0){if(m.isTenantKilled(e.iKey()))return!1;I.push(e)}return!0},e.teardown=function(){I.length>0&&k(w(),0,!0,!0,2,!0)},e.pause=function(){v=!0},e.resume=function(){v=!1,e.sendQueuedRequests(4,!1)},e.sendSynchronousBatch=function(e,t,n){e&&e.count()>0&&k([e],0,!1,!0,t||0,!!n)}})},xe=r.isWindowObjectAvailable?window:void 0,Fe=function(e){function t(){var n,i=e.call(this)||this;i.identifier="PostChannel",i.priority=1011,i.version="3.0.1";var o,a,u,p,f,h=!1,g=[],m=null,v=!1,y=0,S=1e4,_={},E=Ce,T=null,C=0,I=0,A={},b=-1;return Object(d.a)(t,i,function(e,t){function i(e,t){if(e.sendAttempt||(e.sendAttempt=0),e.latency||(e.latency=l.a.Normal),e.ext&&e.ext.trace&&delete e.ext.trace,e.ext&&e.ext.user&&e.ext.user.id&&delete e.ext.user.id,e.sync)if(C||v)e.latency=l.a.RealTime,e.sync=!1;else if(a)return void a.sendSynchronousBatch(be.create(e.iKey,[e]),3);var n=!1;y<S?n=!L(e,t):(n=!0,function(e,t){for(var n=l.a.Normal;n<=t;){var i=w(e,t,!0);if(i&&i.count()>0){var r=i.split(0,20);if(r.count()>0)return j("eventsDiscarded",[r],Te.a.QueueFull),!0}n++}return!1}(e.iKey,e.latency)&&(n=!L(e,t))),n&&U("eventsDiscarded",[e],Te.a.QueueFull)}function d(e,t,n,i){var r=k(e,t,n);return a.sendQueuedRequests(t,n,i),r}function R(){return y>0}function O(){b>=0&&k(b,f,!0)&&a.sendQueuedRequests(f,!0,!1);var e=_[E][1];!T&&!m&&e>=0&&!v&&(R()?T=P(function(){T=null,d(0===I?l.a.RealTime:l.a.Normal,1,!0),I++,I%=2,O()},e):I=0)}function P(t,n){0===n&&C&&(n=1);var i=1e3;return C&&(i=we.getMillisToBackoffForRetry(C-1)),e._setTimeoutOverride(t,n*i)}function N(){null!==T&&(e._clearTimeoutOverride(T),T=null,I=0)}function M(t,n){N(),m&&(e._clearTimeoutOverride(m),m=null),v||d(l.a.Normal,t,n,!0)}function w(e,t,n){var i=A[t];i||(t=l.a.Normal,i=A[t]);var r=i.iKeyMap[e];return!r&&n&&(r=be.create(e),i.batches.push(r),i.iKeyMap[e]=r),r}function D(t,n){a.canSendRequest()&&!C&&(u>0&&y>u&&(n=!0),n&&null==m&&e.flush(t,null,20))}function L(e,t){var n=w(e.iKey,e.latency,!0);return!!n.addEvents([e],t)&&(y++,t&&0===e.sendAttempt&&D(!e.sync,p>0&&n.count()>=p),!0)}function k(t,n,i){var o=!1;return!i||a.canSendRequest()?Object(s.b)(e.core,function(){return"PostChannel._queueBatches"},function(){for(var e=[],n=l.a.RealTime;n>=t;){var i=A[n];i&&i.batches&&(Object(r.arrForEach)(i.batches,function(t){a.addBatch(t)?o=o||t&&t.count()>0:e=e.concat(t.events()),y-=t.count()}),i.batches=[],i.iKeyMap={}),n--}e.length>0&&U("eventsDiscarded",e,Te.a.KillSwitch),o&&b>=t&&(b=-1,f=0)},function(){return{latency:t,sendReason:n}},i):(b=b>=0?Math.min(b,t):t,f=Math.max(f,n)),o}function x(){(_={})[Ce]=[2,1],_[Ie]=[6,3],_[Ae]=[18,9]}function F(t,n){var i=e._notificationManager||{},r=i[t];if(r)try{r.apply(i,n)}catch(n){e.diagLog().throwInternal(c.a.CRITICAL,l.f.NotificationException,t+" notification failed: "+n)}}function U(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];t&&t.length>0&&F(e,[t].concat(n))}function j(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];t&&t.length>0&&Object(r.arrForEach)(t,function(t){t&&t.count()>0&&F(e,[t.events()].concat(n))})}function H(){p=n&&n.disableAutoBatchFlushLimit?0:Math.max(1500,S/6)}x(),A[l.a.RealTime]={batches:[],iKeyMap:{}},A[l.a.CostDeferred]={batches:[],iKeyMap:{}},A[l.a.Normal]={batches:[],iKeyMap:{}},H(),a=new ke(500,2,1,{requeue:function(t,n){var o=[];Object(r.arrForEach)(t,function(t){t&&t.count()>0&&Object(r.arrForEach)(t.events(),function(t){t&&(t.sync&&(t.latency=l.a.RealTime,t.sync=!1),t.sendAttempt<6?(Object(r.setProcessTelemetryTimings)(t,e.identifier),i(t,!1)):o.push(t))})}),o.length>0&&U("eventsDiscarded",o,Te.a.NonRetryableStatus)},send:function(e,t,n){e&&e.length>0&&F("eventsSendRequest",[t>=1e3&&t<=1999?t-1e3:0,!0!==n])},sent:function(e,t){j("eventsSent",e,t),O()},drop:function(e,t){j("eventsDiscarded",e,t>=8e3&&t<=8999?t-8e3:Te.a.Unknown)},rspFail:function(e){j("eventsDiscarded",e,Te.a.NonRetryableStatus),O()},oth:function(e,t){j("eventsDiscarded",e,Te.a.Unknown),O()}}),e._getDbgPlgTargets=function(){return[a]},e.initialize=function(i,c,l){Object(s.b)(c,function(){return"PostChannel:initialize"},function(){var s=c;t.initialize(i,c,l),e.setInitialized(!1);var d=e._getTelCtx();i.extensionConfig[e.identifier]=i.extensionConfig[e.identifier]||{},n=d.getExtCfg(e.identifier),e._setTimeoutOverride=n.setTimeoutOverride?n.setTimeoutOverride:setTimeout.bind(xe),e._clearTimeoutOverride=n.clearTimeoutOverride?n.clearTimeoutOverride:clearTimeout.bind(xe);var p=s.getWParam;s.getWParam=function(){var e=0;return n.ignoreMc1Ms0CookieProcessing&&(e|=2),e|p()},n.eventsLimitInMem>0&&(S=n.eventsLimitInMem),n.autoFlushEventsLimit>0&&(u=n.autoFlushEventsLimit),H(),n.httpXHROverride&&n.httpXHROverride.sendPOST&&(o=n.httpXHROverride),Object(r.isValueAssigned)(i.anonCookieName)&&a.addQueryStringParameter("anoncknm",i.anonCookieName),a.sendHook=n.payloadPreprocessor,a.sendListener=n.payloadListener;var f=n.overrideEndpointUrl?n.overrideEndpointUrl:i.endpointUrl;e._notificationManager=i.extensionConfig.NotificationManager,a.initialize(f,e.core,e,o,n),Object(r.addPageUnloadEventListener)(function(){M(2,!1)}),e.setInitialized(!0)},function(){return{coreConfig:i,core:c,extensions:l}})},e.processTelemetry=function(t,o){Object(r.setProcessTelemetryTimings)(t,e.identifier);var a=(o=e._getTelCtx(o)).getExtCfg(e.identifier),s=!!n.disableTelemetry;a&&(s=s||!!a.disableTelemetry);var c=t;s||h||(n.overrideInstrumentationKey&&(c.iKey=n.overrideInstrumentationKey),a&&a.overrideInstrumentationKey&&(c.iKey=a.overrideInstrumentationKey),i(c,!0),O()),e.processNext(c,o)},e.setEventQueueLimits=function(e,t){S=e>0?e:1e4,u=t>0?t:0,H();var n=y>e;if(!n&&p>0)for(var i=l.a.Normal;!n&&i<=l.a.RealTime;i++){var o=A[i];o&&o.batches&&Object(r.arrForEach)(o.batches,function(e){e&&e.count()>=p&&(n=!0)})}D(!0,n)},e.teardown=function(){M(2,!1),h=!0,a.teardown()},e.pause=function(){N(),v=!0,a.pause()},e.resume=function(){v=!1,a.resume(),O()},e.addResponseHandler=function(e){a._responseHandlers.push(e)},e._loadTransmitProfiles=function(e){N(),x(),E=Ce,O(),Object(r.objForEachKey)(e,function(e,t){if(t.length>=2){if(t.splice(0,t.length-2),t[1]<0&&(t[0]=-1),t[1]>0&&t[0]>0){var n=t[0]/t[1];t[0]=Math.ceil(n)*t[1]}_[e]=t}})},e.flush=function(e,t,n){void 0===e&&(e=!0),v||(N(),n=n||1,e?(k(l.a.Normal,n,e),null==m?m=P(function(){!function e(t,n){d(l.a.Normal,n,!0),function e(t){a.isCompletelyIdle()?t():m=P(function(){e(t)},.25)}(function(){t&&t(),g.length>0?m=P(function(){return e(g.shift(),n)},0):(m=null,R()&&O())})}(t,n)},0):g.push(t)):(d(l.a.Normal,n,!1),null!=t&&t()))},e.setMsaAuthTicket=function(e){a.addHeader("AuthMsaDeviceTicket",e)},e.hasEvents=R,e._setTransmitProfile=function(e){E!==e&&void 0!==_[e]&&(N(),E=e,O())},e._backOffTransmission=function(){C<4&&(C++,N(),O())},e._clearBackOff=function(){C&&(C=0,N(),O())}}),i}return __extends(t,e),t}(f.a),Ue=function(e){this._setOverride=function(t,n){e.setOverride(t,n)},this._getOverride=function(t){return e.getOverride(t)}},je=function(e){function t(t,n){var r=e.call(this,t)||this,o=r;return o.setId=function(e){o._setOverride(ie.id,e)},o.getId=function(){return o._getOverride(ie.id)},o.setVer=function(e){o._setOverride(ie.ver,e)},o.getVer=function(){return o._getOverride(ie.ver)},o.setName=function(e){o._setOverride(ie.appName,e)},o.getName=function(){return o._getOverride(ie.appName)},o.setLocale=function(e){o._setOverride(ie.locale,e)},o.getLocale=function(){return o._getOverride(ie.locale)},o.setEnv=function(e){o._setOverride(ie.env,e)},o.getEnv=function(){return o._getOverride(ie.env)},o.setExpId=function(e){o._setOverride(ie.expId,_.validateAppExpId(e))},o.getExpId=function(){return o._getOverride(ie.expId)},n&&(i.a.isUndefined(n.env)||o.setEnv(n.env),i.a.isNullOrUndefined(n.expId)||o.setExpId(n.expId)),r}return __extends(t,e),t}(Ue),He=function(e){function t(t){var n=e.call(this,t)||this,i=n;return i.setProperty=function(e,t){i._setOverride(e,t)},i.getProperty=function(e){return i._getOverride(e)},n}return __extends(t,e),t}(Ue),Be=function(e){function t(t){var n=e.call(this,t)||this,i=n;return i.setLocalId=function(e){i._setOverride(pe.localId,e)},i.getLocalId=function(){return i._getOverride(pe.localId)},i.setDeviceClass=function(e){i._setOverride(pe.deviceClass,e)},i.getDeviceClass=function(){return i._getOverride(pe.deviceClass)},i.setMake=function(e){i._setOverride(pe.make,e)},i.getMake=function(){return i._getOverride(pe.make)},i.setModel=function(e){i._setOverride(pe.model,e)},i.getModel=function(){return i._getOverride(pe.model)},n}return __extends(t,e),t}(Ue),Ge=function(e){function t(t,n){var i=e.call(this,t)||this,r=i;if(r.setOsName=function(e){r._setOverride(ae.osName,e)},r.getOsName=function(){return r._getOverride(ae.osName)},r.setVer=function(e){r._setOverride(ae.ver,e)},r.getVer=function(){return r._getOverride(ae.ver)},n&&n.userAgent&&n.populateOperatingSystemInfo){var o=new Q(n);r.setOsName(o.name),r.setVer(o.ver)}return i}return __extends(t,e),t}(Ue),Ve=i.a.isNullOrUndefined,We=i.a.arrForEach;function qe(e,t){if(e)for(var n=0;n<t.length;n++){var i=t[n];Ve(e[i])&&(e[i]={}),e=e[i]}return e}var Ke=function(e){var t=[];this.setOverride=function(e,n){e&&t.push({key:e,value:n})},this.hasOverride=function(e){var n=!1;return We(t,function(t){t.key===e&&(n=!0)}),n},this.getOverride=function(e){var n;return We(t,function(t){t.key===e&&(n=t.value)}),n},this.applyOverrides=function(n,r){if(t.length>0)try{var o=qe(n,e);We(t,function(e){!function(e,t,n){if(e&&t){var r=t.split("."),o=r[r.length-1];r.length>1&&(e=qe(e,r.splice(-1,1))),Ve(n)?i.a.isUndefined(e[o])||delete e[o]:e[o]=n}}(o,e.key,e.value)})}catch(e){}}},ze=function(e){function t(t){var n=e.call(this,t)||this,i=n;return i.setLocalId=function(e){i._setOverride(oe.localId,e)},i.getLocalId=function(){return i._getOverride(oe.localId)},i.setLocale=function(e){i._setOverride(oe.locale,e)},i.getLocale=function(){return i._getOverride(oe.locale)},i.setId=function(e){i._setOverride(oe.id,e)},i.getId=function(){return i._getOverride(oe.id)},n}return __extends(t,e),t}(Ue),Je=function(e){function t(t,n){var r=e.call(this,t)||this,o=r;return o.setDomain=function(e){o._setOverride(re.domain,e)},o.getDomain=function(){return o._getOverride(re.domain)},o.setBrowser=function(e){o._setOverride(re.browser,e)},o.getBrowser=function(){return o._getOverride(re.browser)},o.setBrowserVer=function(e){o._setOverride(re.browserVer,e)},o.getBrowserVer=function(){return o._getOverride(re.browserVer)},o.setScreenRes=function(e){o._setOverride(re.screenRes,e)},o.getScreenRes=function(){return o._getOverride(re.screenRes)},o.setUserConsent=function(e){o._setOverride(re.userConsent,e)},o.getUserContext=function(){return o._getOverride(re.userConsent)},n&&(i.a.isUndefined(n.userConsented)||o.setUserConsent(n.userConsented)),r}return __extends(t,e),t}(Ue),Ye=(r.isString,function(e,t,n){var o={};function a(e){for(var t="",n=0;n<e.length;n++)t&&(t+="_"),t+=e[n];return i.a.isUndefined(o[t])&&(o[t]=new Ke(e)),t?o[t]:null}this.data=new He(a(["data"])),this.app=new je(a(["ext",ge.AppExt]),t),this.user=new ze(a(["ext",ge.UserExt])),this.os=new Ge(a(["ext",ge.OSExt]),t),this.web=new Je(a(["ext",ge.WebExt]),t),this.device=new Be(a(["ext",ge.DeviceExt])),this.applyOverrides=function(e,t){var n=Object(r.objKeys)(o);n&&n.length>0&&i.a.arrForEach(n,function(n){o[n].applyOverrides(e,t)})}}),Qe=function(e){function t(){var t=e.call(this)||this;t.identifier="OverridePropertiesPlugin",t.priority=4,t.version="3.0.1";var n=t,i=null;return n._baseInit=function(e,n,r){i=new Ye(e,t._getTelCtx().getExtCfg(t.identifier),n)},n.setProperty=function(e,t){i&&i.data.setProperty(e,t)},n.getOverrideContext=function(){return i},t}return __extends(t,e),t.prototype.initialize=function(t,n,i){e.prototype.initialize.call(this,t,n,i),this._baseInit(t,n,i)},t.prototype.processTelemetry=function(e,t){Object(r.setProcessTelemetryTimings)(e,this.identifier),t=this._getTelCtx(t);var n=this.getOverrideContext();n&&n.applyOverrides(e,t),this.processNext(e,t)},t}(f.a);function Xe(e,t){if(t)for(var n=i.a.objKeys(t),r=0;r<n.length;r++){var o=n[r];i.a.hasOwnProperty(e,o)||(e[o]=t[o])}}function $e(e,t){var n=null;if(t){t.endpointUrl&&(n=t.endpointUrl);var i=(t.extensionConfig||{})[e]||{};i.overrideEndpointUrl&&(n=i.overrideEndpointUrl)}return n}var Ze=function(e){function t(n,i){var o=e.call(this)||this;return Object(d.a)(t,o,function(e,t){function o(e){var t=[];return e&&Object(r.arrForEach)(e,function(e){e.iKey===n&&t.push(e)}),t}function a(t){if(e[t]&&e.listeners)for(var n=0;n<e.listeners.length;n++){var i=e.listeners[n];if(i&&i[t])return!0}return!1}var s={eventsSent:function(t){if(a("eventsSent")){var n=o(t);n.length>0&&e.eventsSent(n)}},eventsDiscarded:function(t,n){if(a("eventsDiscarded")){var i=o(t);i.length>0&&e.eventsDiscarded(i,n)}},eventsSendRequest:function(t,n){a("eventsSendRequest")&&e.eventsSendRequest(t,n)},perfEvent:function(t){a("perfEvent")&&e.perfEvent(t)}};i.addNotificationListener(s)}),o}return __extends(t,e),t}(o.a),et=function(){function e(){var t,n,u,p,f,h,g,m={},v=[],y=null,S=[],_=[],E={};Object(d.a)(e,this,function(e){function d(e,t){if(void 0===t&&(t=null),e){(!function(e){return e.pause&&e.teardown&&e.flush}(e)?S:_).push(e);var n=e.identifier;m.extensionConfig[n]=m.extensionConfig[n]||{},Xe(m.extensionConfig[n],t)}return e}function T(n){if(!y){var i=C(n||m.instrumentationKey||"_not_defined_",{});t=new o.a,(y=new tt(e,e.diagLog(),t)).initialize(i,v),u&&(p=$e(u.identifier,i))}}function C(e,t){var n={};return n.instrumentationKey=e,n.channels=function(e){var t=[[]];return m.channels&&Object(r.arrForEach)(m.channels,function(e,n){i.a.isFunction(e)||(t[n]=t[n]||[],t[n]=t[n].concat(e))}),e&&e.channels&&Object(r.arrForEach)(e.channels,function(e,n){i.a.isFunction(e)||(t[n]=t[n]||[],t[n]=t[n].concat(e))}),t}(t),function(e){var t=[];m.extensions&&m.extensions.length>0&&(t=t.concat(m.extensions)),e&&e.extensions&&e.extensions.length>0&&(t=t.concat(e.extensions)),t.length>0&&(e.extensions=t),e.extensionConfig=e.extensionConfig||{},Xe(e.extensionConfig,m.extensionConfig)}(n),Xe(n,t),Xe(n,m),n}e.diagLog=function(){return f||(f=new a.a(m)),f},e.getPerfMgr=function(){return g||m&&m.enablePerfMgr&&(g=new s.a(e.getNotifyMgr())),g},e.setPerfMgr=function(e){g=e},e.create=function(e,t){var r,o,a,s;r=(m=e||{}).channels||[[]],o=new Fe,a=o.identifier,s=!1,u=null,p=null,i.a.arrForEach(r,function(e){i.a.arrForEach(e,function(e){i.a.isFunction(e)||(d(e),e.identifier===a&&(s=!0,u=e))})}),s||(r[0].push(o),u=d(o,m.channelConfiguration)),m.channels=r,function(e){v=[],n=d(new Ee,m.propertyConfiguration),v.push(n),m.extensions&&i.a.arrForEach(m.extensions,function(e){i.a.isFunction(e)||d(e)}),e&&i.a.arrForEach(e,function(e){e&&!i.a.isFunction(e)&&v.push(d(e))})}(t)},e.getInst=function(e){return(E[e]||{}).inst},e.newInst=function(n,i,r){var o=e.getInst(n);if(o)return e.diagLog().throwInternal(c.a.WARNING,l.f.FailedToInitializeSDK,"Instance already exists for ["+n+"]"),o;T(n);var a=C(n,i);if(u){var s=$e(u.identifier,a);p&&s&&p!==s&&e.diagLog().throwInternal(c.a.WARNING,l.f.ErrorProvidedChannels,"The endpointUrl mismatch, shared Url ["+p+"] is different from configured ["+s+"] shared will be used!")}var d=new Ze(n,t);return o=new tt(e,e.diagLog(),d),E[n]={iKey:n,inst:o,notifyMgr:d},o.setPerfMgr(e.getPerfMgr()),o.initialize(a,function(e){var t=[];return v&&v.length>0&&(t=t.concat(v)),e&&e.length>0&&(t=t.concat(e)),t}(r)),o},e.getSharedPlugin=function(e){T();var t=null;return i.a.arrForEach(S,function(n){e===n.identifier&&(t=n)}),t||i.a.arrForEach(_,function(n){e===n.identifier&&(t=n)}),t},e.getPropertyManager=function(){return T(),n},e.getPostChannel=function(){return T(),u},e.getNotifyMgr=function(){return h||(h=new o.a),h}})}return e.prototype.getNotifyMgr=function(){return null},e.prototype.getPerfMgr=function(){return null},e.prototype.setPerfMgr=function(e){},e}(),tt=function(e){function t(n,i,r){var o,a=e.call(this)||this,u=n;return Object(d.a)(t,a,function(e,t){e.getSharedPropertyManager=function(){return u.getPropertyManager()},e.getSharedPostChannel=function(){return u.getPostChannel()},e.getOverridePropertyManager=function(){return o},e.initialize=function(n,a){Object(s.b)(e,function(){return"ApplicationInsights:initialize"},function(){var s=[o=new Qe];a&&(s=s.concat(a)),n.extensionConfig=n.extensionConfig||[];var u=n.propertyConfiguration||{};n.propertyConfiguration&&delete n.propertyConfiguration,n.extensionConfig[o.identifier]=u;try{t.initialize(n,s,i,r)}catch(t){e.logger.throwInternal(c.a.CRITICAL,l.f.FailedToInitializeSDK,"Failed to initialize SDK."+t)}},function(){return{config:n,extensions:a}})}}),a}return __extends(t,e),t.prototype.initialize=function(e,t){},t}(u.a),nt=n(296)},function(e,t,n){"use strict";n.r(t),n.d(t,"LocalStorageChannel",function(){return B}),n.d(t,"StorageProviders",function(){return i}),n.d(t,"BaseTelemetryPlugin",function(){return d.a}),n(10);var i,r=n(23),o=n(128),a=n(3),s=n(1),c=n(29),l=n(20),u=n(13),d=n(62),p=n(4);function f(e){return Object(a.isNumber)(e)&&e>=u.b.Normal&&e<=u.b.Critical}!function(e){e[e.LocalStorage=1]="LocalStorage",e[e.SessionStorage=2]="SessionStorage",e[e.IndexedDb=3]="IndexedDb"}(i||(i={}));var h=n(5);function g(e){var t=Object(h.d)()||{},n=null;try{if(n=t[e]){var i="__storage_test__";n.setItem(i,i),n.removeItem(i)}}catch(e){(function(e,t){var n=!1;return t instanceof DOMException&&(22!==t.code&&"QuotaExceededError"!==t.name&&1014!==t.code&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||e&&0!==e.length&&(n=!0)),n})(n,e)||(n=null)}return n}function m(e,t){if(e)for(var n=Object(a.objKeys)(e),i=0;i<n.length;i++){var r=n[i];if(!t(e[r],r))break}}function v(e){var t=!0;return m(e,function(e,n){return e&&(t=!1),t}),t}function y(e,t){for(var n=1,i=0,r=function(){var e=[],r=t[n];if(m(r,function(t,n){return e.push(n),++i<10}),i>0){for(var o=0;o<e.length;o++)delete r[e[o]];return{value:!0}}n++};n<=e&&i<10;){var o=r();if("object"==typeof o)return o.value}return i>0}var S=f,_=function(){function e(t,n){Object(p.a)(e,this,function(e){var i=null,r="AWTEvents",o=null,l=null,u=null,d=5e6,p=null,f=null;function h(e,t){return{key:e,db:t}}function _(e,t){void 0===t&&(t=!0);var n=i.getItem(e),r=null;if(n)try{r=JSON.parse(n)}catch(t){i.removeItem(e)}return t&&!r&&(r={events:{1:{},2:{},3:{}},lastAccessTime:0}),h(e,r)}function E(e,t){void 0===t&&(t=!0);var n=!0,r=e.db;if(r){t&&(r.lastAccessTime=(new Date).getTime());for(var o=1;o<=2;o++)if(!v(r.events[o])){n=!1;break}}try{if(n)i.removeItem(e.key);else{var a=JSON.stringify(r);if(a.length>d)return!1;i.setItem(e.key,a)}}catch(e){return!1}return!0}e.id=n,i=g(t),e.initialize=function(t){if(null===i)return!1;var n=t.storageConfig||{};return d=n.maxStorageSizeInBytes>0?n.maxStorageSizeInBytes:d,r=n.storageKey||"AWTEvents",o=e.id||t.id||s.a.newGuid(),f=r+"."+o,p=r+"Version",l=t.itemCtx.getCfg().instrumentationKey,u=Object(a.getTenantId)(l)||l,function(){for(var e=i.getItem(p),t=[],n=_(f),o=!1,s=0;s<i.length;s++){var c=i.key(s);if(0===c.indexOf(r)&&c!==p){if("3"!==e){t.push(h(c,null));continue}var l=_(c,!1),d=l.db;if(d){if((new Date).getTime()-d.lastAccessTime>6e5){for(var g=1,v=function(){var e=d.events[g],t=n.db.events[g];m(e,function(n,i){return(Object(a.getTenantId)(n.iKey)||n.iKey)===u&&(t[i]=n,delete e[i]),!0}),g++};g<=2;)v();o=!0,t.push(l)}}else t.push(h(c,null))}}for(s=0;s<t.length;s++)E(t[s],!1);o&&E(n),i.setItem(p,"3")}(),!0},e.supportsSyncRequests=function(){return!0},e.getAllEvents=function(){try{var e=[],t=_(f,!1).db;if(t)for(var n=t.events,i=2;i>=1;i--)m(n[i],function(t){return t&&(Object(a.getTenantId)(t.iKey)||t.iKey)===u&&e.push(t),!0});return c.a.resolve(e)}catch(e){return c.a.reject(e)}},e.addEvent=function(e,t,n){try{var i=_(f);t.id=t.id||s.a.newGuid(),S(t.persistence)||(t.persistence=1);for(var r=t.persistence,o=t.id,a=i.db.events;;){if(a[r][o]=t,E(i))return c.a.resolve(t);if(delete a[r][o],!y(r,a))return c.a.reject(new Error("Unable to free up event space"))}}catch(e){return c.a.reject(e)}},e.removeEvents=function(e){try{var t=_(f,!1),n=t.db;if(n){var r=n.events;try{for(var o=0;o<e.length;++o){var a=e[o];delete r[a.persistence][a.id]}if(E(t))return c.a.resolve(e)}catch(e){}e=function(e){var t=[],n=_(e,!1),r=n.db;if(r){var o=r.events;try{for(var a=1;a<=2;a++)m(o[a],function(e,n){return e&&t.push(e),!0})}catch(e){}i.removeItem(n.key)}return t}(t.key)}return c.a.resolve(e)}catch(e){return c.a.reject(e)}},e.clear=function(){try{var e=[],t=_(f,!1),n=t.db;if(n){for(var i=n.events,r=function(t){var n=i[t];m(n,function(t){return t&&(Object(a.getTenantId)(t.iKey)||t.iKey)===u&&(delete n[t.id],e.push(t)),!0})},o=2;o>=1;o--)r(o);E(t)}return c.a.resolve(e)}catch(e){return c.a.reject(e)}},e.teardown=function(){try{var e=_(f,!1),t=e.db;t&&(t.lastAccessTime=0,E(e,!1))}catch(e){}}})}return e.prototype.initialize=function(e){return!1},e.prototype.supportsSyncRequests=function(){return!1},e.prototype.getAllEvents=function(){},e.prototype.addEvent=function(e,t,n){},e.prototype.removeEvents=function(e){},e.prototype.clear=function(){},e.prototype.teardown=function(){},e}(),E=["indexedDB"],T=a.isFunction,C=a.isString;function I(e,t){QUnit&&console&&console.log("IndexedDbHelper ["+e+"] "+t)}function A(e,t,n){e&&e.warnToConsole("IndexedDbHelper ["+t+"] "+n)}function b(e,t,n,i){return function(r){n(new Error(t)),I(e,"["+i+"] event rejected")}}var R=[];function O(e,t){for(var n=null,i=0;i<R.length;i++){var r=R[i];if(r.name===e)return r}return n={name:e,sch:new o.a("IndexedDbHelper["+e+"]",t),dbHdl:[],add:function(t){n.dbHdl.push(t),I(e,"- dbOpened (add) -- hdls ["+n.dbHdl.length+"]")},remove:function(t){for(var i=n.dbHdl,r=0;r<i.length;r++)if(i[r]==t){i.splice(r,1);break}I(e,"- dbClosed (remove) -- hdls ["+n.dbHdl.length+"]")},isOpen:function(){return n.dbHdl.length>0},openHdl:function(){return n.dbHdl.length>0?n.dbHdl[0]:null}},R.push(n),n}var P=function(){function e(t){Object(p.a)(e,this,function(e){var n=function(){var e=Object(h.d)()||{},t=null;if(e)try{for(var n=0;n<E.length;n++)if((t=e[E[n]])&&T(t.open))return t}catch(e){t=null}return t}();function i(e,n){var i=e.db.transaction(n,"readwrite");return i.onabort=function(){A(t,e.dbName,"txn.onabort")},i.onerror=function(){A(t,e.dbName,"txn.onerror")},i.oncomplete=function(){I(e.dbName,"txn.oncomplete")},{db:e,store:i.objectStore(n),tx:i,tbl:n,openCursor:function(t,i){return o(e,n,t,i)},newTransaction:function(t){return r(e,n,t)}}}function r(e,t,n){if(!e||!e.db)return c.a.reject(new Error("Database is not open"));try{var r=n(i(e,t));return r instanceof c.a?r:c.a.resolve(r)}catch(e){return c.a.reject(e)}}function o(e,t,n,r){if(!e||!e.db)return c.a.reject(new Error("Database is not open"));var o=null;return n&&C(n)?o=new N(n):n&&n.isMatch&&(o=n),new c.a(function(n,a){var s=[],c=null,l=null;o&&o.keyRange&&(l=o.keyRange());var u=i(e,t);(c=l?u.store.openCursor(l):u.store.openCursor()).onerror=b(u.db.dbName,"DBError: Failed to Open Cursor",a,"openCursor"),c.onsuccess=function(e){var t=e.target.result;if(t){var i={store:u,cursor:t,continue:function(){t.continue()},done:function(){n(s)}},c=t.value;if(!o||o.isMatch(c))if(r)try{switch(r(i,c,s)){case 2:n(s);break;case 1:break;case 0:default:i.continue()}}catch(e){a(e)}else s.push(c),i.continue();else i.continue()}else n(s)}})}function a(e,t,n,i){return O(e).sch.scheduleEvent(n,t,i)}e.isAvailable=function(){return null!=n},e.openDb=function(e,i,s,l){return a(e,"openDb",function(a){return new c.a(function(c,u){var d=!1;function p(t,n,a,s,c){var l={db:n,dbName:e,dbVersion:i,ctx:null,isNew:s,txn:a?a.transaction:null};return c||(l.openStore=function(e,t){return r(l,e,t)},l.openCursor=function(e,t,n){return o(l,e,t,n)}),l}var f=O(e);if(null==n)u(new Error("No available storage factory"));else if(f.isOpen()){var h=p(0,f.openHdl(),null,!1);s(h).then(c,u)}else{var g=n.open(e,i);g.onblocked=function(n){A(t,e,"Db Open Blocked event ["+a+"] - "+(g.error||"")),u(new Error("DBError: Unable to open database"))},g.onerror=function(n){A(t,e,"Db Open Error event ["+a+"] - "+(g.error||"")),u(new Error("DBError: Unable to open database"))},g.onupgradeneeded=function(t){I(e,"Db Open Create/Upgrade needed event ["+a+"]");try{var n=t.target.result;if(!n)return void u(new Error("DBError: Unable to open database"));!function(e,t){var n=p(0,e,t,!0,!0);if(l)d=!0,l(n).then(function(){n.txn||(n.txn=t.transaction)},function(e){try{t.transaction&&t.transaction.abort()}finally{u(e)}});else try{t.transaction&&t.transaction.abort()}finally{u(new Error("DBError: Database upgrade required"))}}(n,g)}catch(t){b(e,"DBError: Unable to open database",u,a)(t)}},g.onsuccess=function(n){var i=n.target.result;i?function(n,i){var r=O(e);r.add(n),n.onabort=function(i){A(t,e,"onabort -- closing the Db"),r.remove(n)},n.onerror=function(i){A(t,e,"onerror -- closing the Db"),r.remove(n)},n.onclose=function(i){A(t,e,"onclose -- closing the Db"),r.remove(n)},n.onversionchange=function(i){A(t,e,"onversionchange -- force closing the Db"),n.close(),r.remove(n)};var o,a=null;r.dbHdl.length>0&&(a=r.dbHdl[0]),o=p(0,a,i,d);try{s(o).then(function(e){c(e)},u)}catch(e){u(e)}}(i,g):u(new Error("DBError: Unable to open database"))}}})})},e.closeDb=function(e){a(e,"closeDb",function(t){var n=O(e),i=n.dbHdl,r=i.length;if(r>0){for(var o=0;o<r;o++)i[o].close();n.dbHdl=[]}return c.a.resolve(1)})},e.deleteDb=function(e){return null==n?c.a.resolve(!1):a(e,"deleteDb",function(i){var r=O(e),o=r.dbHdl,a=o.length;if(a>0){A(t,e,"Db is open ["+a+"] force closing");for(var s=0;s<a;s++)o[s].close();r.dbHdl=[]}return new c.a(function(r,o){setTimeout(function(){try{I(e,"["+i+"] starting");var a=n.deleteDatabase(e);a.onerror=function(n){A(t,e,"["+i+"] error!!"),o(new Error("DBError: Failed to delete the database"))},a.onblocked=function(n){A(t,e,"["+i+"] blocked!!"),o(new Error("DBError: Failed to delete the database"))},a.onupgradeneeded=function(n){A(t,e,"["+i+"] upgrade needed!!"),o(new Error("DBError: Failed to delete the database"))},a.onsuccess=function(t){I(e,"["+i+"] complete"),r(!0)},I(e,"["+i+"] started")}catch(n){A(t,e,"["+i+"] threw - "+n),o(new Error("DBError: Failed to delete the database - "+n))}},0)})})},e.getDbDetails=function(e){return a(e,"getDbDetails",function(t){return null!=n&&n.databases?new c.a(function(t,i){n.databases().then(function(n){for(var r=0;r<n.length;r++)if(n[r].name==e)return void t(n[r]);i(new Error("DBError: Database does not exist"))},i)}):c.a.reject(new Error("DBError: Feature not supported"))},2e3)}})}return e.prototype.isAvailable=function(){return!1},e.prototype.openDb=function(e,t,n,i){},e.prototype.closeDb=function(e){},e.prototype.deleteDb=function(e){},e.prototype.getDbDetails=function(e){},e}(),N=function e(t){var n=[],i=null;Object(p.a)(e,this,function(e){e.keyRange=function(){return i},e.parseQuery=function(t){if(n=[],t)for(var r=t.split(";"),o=0;o<r.length;o++){var a=r[o],s=a.indexOf("=");if(-1!==s){var c=a.substring(0,s),l=a.substring(s+1);0==c.indexOf("#")&&(c=c.substring(1),i||(i=IDBKeyRange.bound(l,l+"ï¿¿"))),e.startsWith(c,l)}}},e.startsWith=function(e,t){n.push({name:e,value:t,type:0})},e.contains=function(e,t){n.push({name:e,value:t,type:1})},e.isMatch=function(e){if(!n||0==n.length)return!0;if(!e)return!1;for(var t=0;t<n.length;t++){var i=n[t],r=e[i.name];if(r)if(0==i.type){if(0!=r.indexOf(i.value))return!1}else if(1==i.type&&-1==r.indexOf(i.value))return!1}return!0},t&&e.parseQuery(t)})},M=f;function w(){return(new Date).getTime()}function D(e){return e.openStore("iKey",function(t){return new c.a(function(n,i){var r,o={iKey:e.ctx.iKey,tm:w()},a=t.store.put(o);a.onsuccess=function(e){n(a.result.toString())},a.onerror=function(e){i(new Error("DBError: Unable to add event"))},a.onerror=(r=i,function(e){return r(new Error("DBError: Unable to update iKey"))})})})}function L(e){for(var t=[],n=u.b.Critical;n>=u.b.Normal;n--)for(var i=0;i<e.length;i++){var r=e[i];r&&r.evt.persistence==n&&t.push(r.evt)}return t}function k(e){return function(t){return e.continue()}}function x(e){var t=e.cursor.delete();return t.onerror=k(e),t.onsuccess=k(e),1}function F(e,t,n){return e.openCursor("Evts",t,function(e,t,i){return n(t)?(i.push(t),x(e)):0})}function U(e){return new c.a(function(t,n){(function(e){return new c.a(function(t,n){var i=!1;e.openCursor("iKey",null,function(e,t,n){var r=t.tm;return w()-r<1008e4?0:(i=!0,2)}).then(function(){if(i){var r={};F(e,null,function(e){if(!e||!e.evt||!e.evt.iKey)return!0;var t=e.tm;return w()-t>1008e4||(r[e.evt.iKey]=1,!1)}).then(function(){var i=[];e.openCursor("iKey",null,function(e,t,n){var o=t.tm;return w()-o<1008e4||r[t.iKey]?0:(i.push(t),x(e))}).then(function(){t(i)},n)},n)}else t([])},n)})})(e).then(function(){(function(e){return e.openCursor("Evts","#key="+e.ctx.iKeyPrefix(),function(t,n){var i,r=n.key;if(0===r.indexOf(e.ctx.iKeyPrefix())&&-1==r.indexOf(e.ctx.evtKeyPrefix())&&(i=n.tm,w()-i>6e5)){n.key=e.ctx.evtKeyPrefix()+n.id;var o=t.store.store.put(n);return o.onerror=k(t),o.onsuccess=function(e){try{x(t)}catch(e){t.continue()}},1}return 0})})(e).then(t,t)},n)})}var j=function(){function e(t){Object(p.a)(e,this,function(e){var n=null,i=null,r="Unknown",o=null,a=null,l=null,d=-1,p=0;function f(e){return n.openDb(i,1,function(t){return new c.a(function(n,i){var s={iKey:r,storageId:o,iKeyPrefix:function(){return a},evtKeyPrefix:function(){return l}};t.ctx=s,D(t).then(function(){e(t).then(n,i)},i)})},function(e){return new c.a(function(t,n){var i;(i=e.db).objectStoreNames.contains("Evts")||i.createObjectStore("Evts",{keyPath:"key"}).createIndex("EvntId","key",{unique:!1}),i.objectStoreNames.contains("iKey")||i.createObjectStore("iKey",{keyPath:"iKey"}).createIndex("iKey","iKey",{unique:!0}),t()})})}e.id=t,e.initialize=function(t){var u=t.itemCtx.diagLog();if(!(n=new P(u)).isAvailable())return n=null,!1;var p=t.itemCtx.getCfg(),h=t.storageConfig||{};return i=h.indexedDbName||"AppInsightEvents.1",r=p.instrumentationKey||r,o=e.id||t.id||s.a.newGuid(),l=(a=r+"::")+o+"::",d=h.maxStorageItems>0?h.maxStorageItems:d,f(function(e){return e.isNew?c.a.resolve(!0):U(e)}).then(function(e){},function(e){u.warnToConsole("IndexedDbProvider failed to initialize - "+(e||"<unknown>")),n=null}),!0},e.supportsSyncRequests=function(){return!1},e.getAllEvents=function(){return null!=n&&n.isAvailable()?f(function(e){return new c.a(function(t,n){(function(e,t){return e.openCursor("Evts",t,function(e,t,n){return n.push(t),0})})(e,"#key="+e.ctx.evtKeyPrefix()).then(function(e){p=e.length,t(L(e))},n)})}):c.a.resolve([])},e.addEvent=function(e,t,i){return null!=n&&n.isAvailable()?(t.id=t.id||s.a.newGuid(),M(t.persistence)||(t.persistence=u.b.Normal),f(function(n){var i=e||t.id,r={key:n.ctx.evtKeyPrefix()+i,id:i,evt:t,tm:w(),v:1};return function e(t,n,i){return new c.a(function(r,o){function a(e,n){(function(e,t){return new c.a(function(n,i){var r=0,o=e.ctx.evtKeyPrefix();function a(){n(r)}function s(e,t){return new c.a(function(n){var i=e.store.delete(t.key);i.onsuccess=function(e){r++,n()},i.onerror=function(e){n()}})}e.openCursor("Evts","#key="+o,function(e,n,i){return n.evt.persistence<=t&&0===n.key.indexOf(o)&&(function(e,t){for(var n=0;n<e.length;n++)if(t.tm<e[n].tm)return void e.splice(n,0,t);e.push(t)}(i,n),i.length>10&&i.splice(i.length-1,1)),0}).then(function(t){0!=t.length?e.openStore("Evts",function(e){for(var n=[],i=0;i<t.length;i++)n.push(s(e,t[i]));return c.a.all(n).then(a,a)}):a()},function(){n(0)})})})(t,e).then(function(e){e>0&&(p-=e),n(e)},function(e){n(0)})}function s(e){r(n.evt)}function l(){t.openStore("Evts",function(c){var l=c.store.put(n);l.onsuccess=function(e){i&&D(t).then(s,s),p++,r(n.evt)},l.onerror=function(s){function c(i){0==i&&o(new Error("DBError: Unable to add event")),e(t,n,!1).then(function(e){r(n.evt)},function(){o(new Error("DBError: Unable to add event"))})}i?a(u.b.Normal,function(e){e>0?c(e):n.evt.persistence>=u.b.Critical?a(u.b.Critical,function(e){c(e)}):o(new Error("DBError: Unable to add event"))}):o(new Error("DBError: Unable to add event"))}})}d>0&&p>=d?a(u.b.Normal,function(e){0==e?n.evt.persistence>=u.b.Critical?a(u.b.Critical,function(e){l()}):o(new Error("DBError: Unable to add event")):l()}):l()})}(n,r,!0)})):c.a.resolve(t)},e.removeEvents=function(e){if(null==n||!n.isAvailable())return c.a.resolve([]);var t=[];return new c.a(function(n,i){f(function(n){return n.openCursor("Evts","#key="+n.ctx.iKey,function(n,i,r){if(-1!=function(e,t){for(var n=t.length,i=0;i<n;i++)if(e==t[i].id)return i;return-1}(i.id,e)){var o=n.cursor.delete();return o.onerror=k(n),o.onsuccess=function(){t.push(i.evt),n.continue()},1}return 0})}).then(function(e){p-=t.length,n(t)},function(e){p-=t.length,n(t)})})},e.clear=function(){return null!=n&&n.isAvailable()?new c.a(function(e,t){f(function(e){return F(e,"#key="+e.ctx.evtKeyPrefix(),function(t){return 0==t.key.indexOf(e.ctx.evtKeyPrefix())})}).then(function(t){p=0,e(L(t))},t)}):c.a.resolve([])},e.teardown=function(){n&&n.closeDb(i)}})}return e.prototype.initialize=function(e){return!1},e.prototype.supportsSyncRequests=function(){return!1},e.prototype.getAllEvents=function(){},e.prototype.addEvent=function(e,t,n){},e.prototype.removeEvents=function(e){},e.prototype.clear=function(){},e.prototype.teardown=function(){},e}(),H=f,B=function(e){function t(){var n=e.call(this)||this;return n.identifier="LocalStorage",n.priority=1009,n.version="2.4.5",Object(p.a)(t,n,function(e,t){var n=!1,d=!1,p=null,h=[];function g(e,t){p||(p=new o.a("LocalStorage")),p.scheduleEvent(function(e){return t(e)},e)}function m(t){Object(r.b)(e.core,function(){return"LocalStorageChannel:_sendStoredEventsToNextPlugin"},function(){g("sendToNext",function(n){return t.provider.getAllEvents().then(function(n){for(var i=0;i<n.length;i++)try{var r=n[i];(Object(a.getTenantId)(r.iKey)||r.iKey)===t.tenantId&&e.processNext(r,t.coreRootCtx.createNew())}catch(e){}})})},function(){return{iKeyConfig:t}})}function v(t,n){Object(r.b)(e.core,function(){return"LocalStorageChannel:_removeEvents"},function(){g("removeEvents",function(e){var i=[];return s.a.arrForEach(n,function(e){(Object(a.getTenantId)(e.iKey)||e.iKey)===t.tenantId&&i.push(e)}),i.length>0?t.provider.removeEvents(i).then(function(e){}).catch(function(e){}):c.a.resolve()})},function(){return{iKeyConfig:t,events:n}})}function y(e){var t=new j;return t.initialize(e)||(t=null),t}function S(e,t){var n=new _(e);return n.initialize(t)||(n=null),n}e.initialize=function(s,c,d,f){Object(r.b)(c,function(){return"LocalStorageChannel.initialize"},function(){n||(t.initialize(s,c,d),t.setInitialized(!1),n=!0,p=new o.a("LocalStorage",c.logger)),function(t,n,r,o){var s=e.identifier,c=t.extensionConfig=t.extensionConfig||[],d=c[s]=c[s]||{};d.providers||(d.providers=[i.LocalStorage,i.IndexedDb]);var p=function(t,n,i,r){t&&(t.extensionConfig=t.extensionConfig||[]),!r&&n&&(r=n.getProcessTelContext().getNext());var o=null,a=e._getTelCtx().getNext();return a&&(o=a.getPlugin()),new l.a(r,t,n,o)}(t,n,0,o),f={itemCtx:p,storageConfig:d,id:e.id},g=function(e){for(var t=e.storageConfig.providers,n=null,r=0;!n&&r<t.length&&r<5;)switch(t[r++]){case i.LocalStorage:n=S("localStorage",e);break;case i.SessionStorage:n=S("sessionStorage",e);break;case i.IndexedDb:n=y(e)}return n}(f);if(g){var _={iKey:t.instrumentationKey,tenantId:Object(a.getTenantId)(t.instrumentationKey)||t.instrumentationKey,minPersistenceCacheLevel:u.b.Normal,coreRootCtx:p,providerContext:f,provider:g};H(d.minPersistenceLevel||-1)&&(_.minPersistenceCacheLevel=d.minPersistenceLevel),h.push(_),n.addNotificationListener({eventsSent:function(e){v(_,e)},eventsDiscarded:function(e,t){v(_,e)}}),m(_)}}(s,c,0,f)},function(){return{coreConfig:s,core:c,extensions:d,pluginChain:f}})},e.processTelemetry=function(t,n){n=e._getTelCtx(n),Object(a.setProcessTelemetryTimings)(t,e.identifier);var i=null;s.a.arrForEach(h,function(e){e.iKey===t.iKey&&(i=e)});var r=d,o=i?i.provider:null,c=t;!c.sync&&o?(c.id=c.id||s.a.newGuid(),f(c.persistence)||(c.persistence=1),function(e,t){return!(t.sync||t.persistence<e.minPersistenceCacheLevel)}(i,c)&&g("processTelemetry",function(e){return o.addEvent(c.id,c,n)}),r||e.processNext(c,n)):e.processNext(c,n)},e.pause=function(){d=!0},e.resume=function(){Object(r.b)(e.core,function(){return"LocalStorageChannel:resume"},function(){d=!1,s.a.arrForEach(h,function(e){e.provider&&m(e)})})},e.teardown=function(){s.a.arrForEach(h,function(e){var t=e.provider;t&&t.teardown()}),h=[]},e.flush=function(e,t){void 0===e&&(e=!0)}}),n}return __extends(t,e),t.prototype.initialize=function(e,t,n,i){},t.prototype.processTelemetry=function(e,t){},t.prototype.pause=function(){},t.prototype.resume=function(){},t.prototype.teardown=function(){},t.prototype.flush=function(e,t){},t}(d.a)}])}(n(98),n(96),n(93),n(73))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loggerKeySymbol=Symbol("loggerKeySymbol")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(21),r=n(31),o=function(){function e(){}return e.logManagerContext=new i.default,e.sessionEnabled=!0,e.loggingEnabled=!1,e.defaultTenantToken="",e.semanticContext=new r.default(!0,e.logManagerContext),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(22),o=n(49),a=n(54),s=n(15),c=n(10),l=n(30),u=function(){function e(){}return e.initialize=function(e,t){if(void 0===t&&(t={}),!this._isInitialized)return this._isInitialized=!0,o.default.defaultTenantToken=e,this._overrideValuesFromConfig(t),this._config.disableCookiesUsage&&!this._config.propertyStorageOverride&&(o.default.sessionEnabled=!1),l.default.addPropertyStorageOverride(this._config.propertyStorageOverride),l.default.autoCollect(o.default.semanticContext,this._config.disableCookiesUsage,this._config.userAgent),s.default.initialize(this._config),o.default.loggingEnabled=!0,this._config.enableAutoUserSession&&(this.getLogger().logSession(r.AWTSessionState.Started),window.addEventListener("beforeunload",this.flushAndTeardown)),this.getLogger()},e.getSemanticContext=function(){return o.default.semanticContext},e.flush=function(e){this._isInitialized&&!this._isDestroyed&&s.default.flush(e)},e.flushAndTeardown=function(){this._isInitialized&&!this._isDestroyed&&(this._config.enableAutoUserSession&&this.getLogger().logSession(r.AWTSessionState.Ended),s.default.flushAndTeardown(),o.default.loggingEnabled=!1,this._isDestroyed=!0)},e.pauseTransmission=function(){this._isInitialized&&!this._isDestroyed&&s.default.pauseTransmission()},e.resumeTransmision=function(){this._isInitialized&&!this._isDestroyed&&s.default.resumeTransmision()},e.setTransmitProfile=function(e){this._isInitialized&&!this._isDestroyed&&s.default.setTransmitProfile(e)},e.loadTransmitProfiles=function(e){this._isInitialized&&!this._isDestroyed&&s.default.loadTransmitProfiles(e)},e.setContext=function(e,t,n){void 0===n&&(n=i.AWTPropertyType.Unspecified),o.default.logManagerContext.setProperty(e,t,n)},e.setContextWithPii=function(e,t,n,r){void 0===r&&(r=i.AWTPropertyType.Unspecified),o.default.logManagerContext.setPropertyWithPii(e,t,n,r)},e.setContextWithCustomerContent=function(e,t,n,r){void 0===r&&(r=i.AWTPropertyType.Unspecified),o.default.logManagerContext.setPropertyWithCustomerContent(e,t,n,r)},e.getLogger=function(e){var t=e;return t&&t!==o.default.defaultTenantToken||(t=""),this._loggers[t]||(this._loggers[t]=new a.default(t)),this._loggers[t]},e.addNotificationListener=function(e){c.default.addNotificationListener(e)},e.removeNotificationListener=function(e){c.default.removeNotificationListener(e)},e._overrideValuesFromConfig=function(e){e.collectorUri&&(this._config.collectorUri=e.collectorUri),e.cacheMemorySizeLimitInNumberOfEvents>0&&(this._config.cacheMemorySizeLimitInNumberOfEvents=e.cacheMemorySizeLimitInNumberOfEvents),e.httpXHROverride&&e.httpXHROverride.sendPOST&&(this._config.httpXHROverride=e.httpXHROverride),e.propertyStorageOverride&&e.propertyStorageOverride.getProperty&&e.propertyStorageOverride.setProperty&&(this._config.propertyStorageOverride=e.propertyStorageOverride),e.userAgent&&(this._config.userAgent=e.userAgent),e.disableCookiesUsage&&(this._config.disableCookiesUsage=e.disableCookiesUsage),e.canSendStatEvent&&(this._config.canSendStatEvent=e.canSendStatEvent),e.enableAutoUserSession&&"undefined"!=typeof window&&window.addEventListener&&(this._config.enableAutoUserSession=e.enableAutoUserSession),e.clockSkewRefreshDurationInMins>0&&(this._config.clockSkewRefreshDurationInMins=e.clockSkewRefreshDurationInMins)},e._loggers={},e._isInitialized=!1,e._isDestroyed=!1,e._config={collectorUri:"https://browser.pipe.aria.microsoft.com/Collector/3.0/",cacheMemorySizeLimitInNumberOfEvents:1e4,disableCookiesUsage:!1,canSendStatEvent:function(e){return!0},clockSkewRefreshDurationInMins:0},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Version="1.8.3",t.FullVersionString="AWT-Web-JS-"+t.Version},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(110),r=n(1),o=n(10),a=n(6),s=function(){function e(){}return e.getPayloadBlob=function(e,t){var n,s=!1,c=new i.IO.MemoryStream,l=new i.CompactBinaryProtocolWriter(c);for(var u in l._WriteFieldBegin(i._BondDataType._BT_MAP,3,null),l._WriteMapContainerBegin(t,i._BondDataType._BT_STRING,i._BondDataType._BT_LIST),e)if(s)n||(n={}),n[u]=e[u],delete e[u];else if(e.hasOwnProperty(u)){l._WriteString(u);var d=e[u];l._WriteContainerBegin(1,i._BondDataType._BT_STRUCT),l._WriteFieldBegin(i._BondDataType._BT_STRING,2,null),l._WriteString("act_default_source"),l._WriteFieldBegin(i._BondDataType._BT_STRING,5,null),l._WriteString(a.newGuid()),l._WriteFieldBegin(i._BondDataType._BT_INT64,6,null),l._WriteInt64(a.numberToBondInt64(Date.now())),l._WriteFieldBegin(i._BondDataType._BT_LIST,8,null);var p=c._GetBuffer().length+1;l._WriteContainerBegin(e[u].length,i._BondDataType._BT_STRUCT);for(var f=c._GetBuffer().length-p,h=0;h<d.length;++h){var g=c._GetBuffer().length;if(this.writeEvent(d[h],l),c._GetBuffer().length-g>2936012)o.default.eventsRejected([d[h]],r.AWTEventsRejectedReason.SizeLimitExceeded),d.splice(h--,1),c._GetBuffer().splice(g),this._addNewDataPackageSize(d.length,c,f,p);else if(c._GetBuffer().length>2936012){c._GetBuffer().splice(g),n||(n={}),e[u]=d.splice(0,h),n[u]=d,this._addNewDataPackageSize(e[u].length,c,f,p),s=!0;break}}l._WriteStructEnd(!1)}return l._WriteStructEnd(!1),{payloadBlob:c._GetBuffer(),remainingRequest:n}},e._addNewDataPackageSize=function(e,t,n,r){for(var o=i._Encoding._Varint_GetBytes(i.Number._ToUInt32(e)),a=0;a<n;++a){if(!(a<o.length)){t._GetBuffer().slice(r+a,n-a);break}t._GetBuffer()[r+a]=o[a]}},e.writeEvent=function(e,t){t._WriteFieldBegin(i._BondDataType._BT_STRING,1,null),t._WriteString(e.id),t._WriteFieldBegin(i._BondDataType._BT_INT64,3,null),t._WriteInt64(a.numberToBondInt64(e.timestamp)),t._WriteFieldBegin(i._BondDataType._BT_STRING,5,null),t._WriteString(e.type),t._WriteFieldBegin(i._BondDataType._BT_STRING,6,null),t._WriteString(e.name);var n={},o=0,s={},c=0,l={},u=0,d={},p=0,f={},h=0,g={},m=0,v={},y=0;for(var S in e.properties){if(e.properties.hasOwnProperty(S))if((E=e.properties[S]).cc>0)v[S]=E,y++;else if(E.pii>0)g[S]=E,m++;else switch(E.type){case r.AWTPropertyType.String:n[S]=E.value,o++;break;case r.AWTPropertyType.Int64:s[S]=E.value,c++;break;case r.AWTPropertyType.Double:l[S]=E.value,u++;break;case r.AWTPropertyType.Boolean:d[S]=E.value,p++;break;case r.AWTPropertyType.Date:f[S]=E.value,h++}}if(o)for(var S in t._WriteFieldBegin(i._BondDataType._BT_MAP,13,null),t._WriteMapContainerBegin(o,i._BondDataType._BT_STRING,i._BondDataType._BT_STRING),n)if(n.hasOwnProperty(S)){var _=n[S];t._WriteString(S),t._WriteString(_.toString())}if(m)for(var S in t._WriteFieldBegin(i._BondDataType._BT_MAP,30,null),t._WriteMapContainerBegin(m,i._BondDataType._BT_STRING,i._BondDataType._BT_STRUCT),g)if(g.hasOwnProperty(S)){var E=g[S];t._WriteString(S),t._WriteFieldBegin(i._BondDataType._BT_INT32,1,null),t._WriteInt32(1),t._WriteFieldBegin(i._BondDataType._BT_INT32,2,null),t._WriteInt32(E.pii),t._WriteFieldBegin(i._BondDataType._BT_STRING,3,null),t._WriteString(E.value.toString()),t._WriteStructEnd(!1)}if(p)for(var S in t._WriteFieldBegin(i._BondDataType._BT_MAP,31,null),t._WriteMapContainerBegin(p,i._BondDataType._BT_STRING,i._BondDataType._BT_BOOL),d)if(d.hasOwnProperty(S)){_=d[S];t._WriteString(S),t._WriteBool(_)}if(h)for(var S in t._WriteFieldBegin(i._BondDataType._BT_MAP,32,null),t._WriteMapContainerBegin(h,i._BondDataType._BT_STRING,i._BondDataType._BT_INT64),f)if(f.hasOwnProperty(S)){_=f[S];t._WriteString(S),t._WriteInt64(a.numberToBondInt64(_))}if(c)for(var S in t._WriteFieldBegin(i._BondDataType._BT_MAP,33,null),t._WriteMapContainerBegin(c,i._BondDataType._BT_STRING,i._BondDataType._BT_INT64),s)if(s.hasOwnProperty(S)){_=s[S];t._WriteString(S),t._WriteInt64(a.numberToBondInt64(_))}if(u)for(var S in t._WriteFieldBegin(i._BondDataType._BT_MAP,34,null),t._WriteMapContainerBegin(u,i._BondDataType._BT_STRING,i._BondDataType._BT_DOUBLE),l)if(l.hasOwnProperty(S)){_=l[S];t._WriteString(S),t._WriteDouble(_)}if(y)for(var S in t._WriteFieldBegin(i._BondDataType._BT_MAP,36,null),t._WriteMapContainerBegin(y,i._BondDataType._BT_STRING,i._BondDataType._BT_STRUCT),v)if(v.hasOwnProperty(S)){E=v[S];t._WriteString(S),t._WriteFieldBegin(i._BondDataType._BT_INT32,1,null),t._WriteInt32(E.cc),t._WriteFieldBegin(i._BondDataType._BT_STRING,2,null),t._WriteString(E.value.toString()),t._WriteStructEnd(!1)}t._WriteStructEnd(!1)},e.base64Encode=function(e){return i._Encoding._Base64_GetString(e)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(10),o=n(1),a=function(){function e(){}return e.initialize=function(e){var t=this;this._sendStats=e,this._isInitalized=!0,r.default.addNotificationListener({eventsSent:function(e){t._addStat("records_sent_count",e.length,e[0].apiKey)},eventsDropped:function(e,n){switch(n){case o.AWTEventsDroppedReason.NonRetryableStatus:t._addStat("d_send_fail",e.length,e[0].apiKey),t._addStat("records_dropped_count",e.length,e[0].apiKey);break;case o.AWTEventsDroppedReason.QueueFull:t._addStat("d_queue_full",e.length,e[0].apiKey)}},eventsRejected:function(e,n){switch(n){case o.AWTEventsRejectedReason.InvalidEvent:t._addStat("r_inv",e.length,e[0].apiKey);break;case o.AWTEventsRejectedReason.KillSwitch:t._addStat("r_kl",e.length,e[0].apiKey);break;case o.AWTEventsRejectedReason.SizeLimitExceeded:t._addStat("r_size",e.length,e[0].apiKey)}t._addStat("r_count",e.length,e[0].apiKey)},eventsRetrying:null}),setTimeout(function(){return t.flush()},6e4)},e.teardown=function(){this._isInitalized&&(this.flush(),this._isInitalized=!1)},e.eventReceived=function(t){e._addStat("records_received_count",1,t)},e.flush=function(){var e=this;if(this._isInitalized){for(var t in this._stats)this._stats.hasOwnProperty(t)&&this._sendStats(this._stats[t],t);this._stats={},setTimeout(function(){return e.flush()},6e4)}},e._addStat=function(e,t,n){if(this._isInitalized&&n!==i.StatsApiKey){var r=i.getTenantId(n);this._stats[r]||(this._stats[r]={}),this._stats[r][e]?this._stats[r][e]=this._stats[r][e]+t:this._stats[r][e]=t}},e._isInitalized=!1,e._stats={},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(22),o=n(21),a=n(6),s=n(53),c=n(10),l=n(15),u=n(49),d=n(51),p=n(31),f=n(30),h=function(){function e(e){this._apiKey=e,this._contextProperties=new o.default,this._semanticContext=new p.default(!1,this._contextProperties),this._sessionStartTime=0,this._createInitId()}return e.prototype.setContext=function(e,t,n){void 0===n&&(n=i.AWTPropertyType.Unspecified),this._contextProperties.setProperty(e,t,n)},e.prototype.setContextWithPii=function(e,t,n,r){void 0===r&&(r=i.AWTPropertyType.Unspecified),this._contextProperties.setPropertyWithPii(e,t,n,r)},e.prototype.setContextWithCustomerContent=function(e,t,n,r){void 0===r&&(r=i.AWTPropertyType.Unspecified),this._contextProperties.setPropertyWithCustomerContent(e,t,n,r)},e.prototype.getSemanticContext=function(){return this._semanticContext},e.prototype.logEvent=function(t){if(u.default.loggingEnabled){this._apiKey||(this._apiKey=u.default.defaultTenantToken,this._createInitId());var n=!0;a.isString(t)?t={name:t}:t instanceof o.default&&(t=t.getEvent(),n=!1),s.default.eventReceived(this._apiKey),e._logEvent(e._getInternalEvent(t,this._apiKey,n),this._contextProperties)}},e.prototype.logSession=function(t,n){if(u.default.sessionEnabled){var o={name:"session",type:"session",properties:{}};if(e._addPropertiesToEvent(o,n),o.priority=i.AWTEventPriority.High,t===r.AWTSessionState.Started){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime(),this._sessionId=a.newGuid(),this.setContext("Session.Id",this._sessionId),o.properties["Session.State"]="Started"}else{if(t!==r.AWTSessionState.Ended)return;if(0===this._sessionStartTime)return;var s=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);o.properties["Session.Id"]=this._sessionId,o.properties["Session.State"]="Ended",o.properties["Session.Duration"]=s.toString(),o.properties["Session.DurationBucket"]=e._getSessionDurationFromTime(s),this._sessionStartTime=0,this.setContext("Session.Id",null),this._sessionId=void 0}o.properties["Session.FirstLaunchTime"]=f.default.firstLaunchTime,this.logEvent(o)}},e.prototype.getSessionId=function(){return this._sessionId},e.prototype.logFailure=function(t,n,r,o,a){if(t&&n){var s={name:"failure",type:"failure",properties:{}};e._addPropertiesToEvent(s,a),s.properties["Failure.Signature"]=t,s.properties["Failure.Detail"]=n,r&&(s.properties["Failure.Category"]=r),o&&(s.properties["Failure.Id"]=o),s.priority=i.AWTEventPriority.High,this.logEvent(s)}},e.prototype.logPageView=function(t,n,i,r,o,a){if(t&&n){var s={name:"pageview",type:"pageview",properties:{}};e._addPropertiesToEvent(s,a),s.properties["PageView.Id"]=t,s.properties["PageView.Name"]=n,i&&(s.properties["PageView.Category"]=i),r&&(s.properties["PageView.Uri"]=r),o&&(s.properties["PageView.ReferrerUri"]=o),this.logEvent(s)}},e.prototype._createInitId=function(){!e._initIdMap[this._apiKey]&&this._apiKey&&(e._initIdMap[this._apiKey]=a.newGuid())},e._addPropertiesToEvent=function(e,t){if(t)for(var n in t instanceof o.default&&(t=t.getEvent()),t.name&&(e.name=t.name),t.priority&&(e.priority=t.priority),t.properties)t.properties.hasOwnProperty(n)&&(e.properties[n]=t.properties[n])},e._getSessionDurationFromTime=function(e){return e<0?"Undefined":e<=3?"UpTo3Sec":e<=10?"UpTo10Sec":e<=30?"UpTo30Sec":e<=60?"UpTo60Sec":e<=180?"UpTo3Min":e<=600?"UpTo10Min":e<=1800?"UpTo30Min":"Above30Min"},e._logEvent=function(e,t){e.name&&a.isString(e.name)?(e.name=e.name.toLowerCase(),e.name=e.name.replace(a.EventNameDotRegex,"_"),e.type&&a.isString(e.type)?e.type=e.type.toLowerCase():e.type="custom",a.EventNameAndTypeRegex.test(e.name)&&a.EventNameAndTypeRegex.test(e.type)?((!a.isNumber(e.timestamp)||e.timestamp<0)&&(e.timestamp=(new Date).getTime()),e.properties||(e.properties={}),this._addContextIfAbsent(e,t.getPropertyMap()),this._addContextIfAbsent(e,u.default.logManagerContext.getPropertyMap()),this._setDefaultProperty(e,"EventInfo.InitId",this._getInitId(e.apiKey)),this._setDefaultProperty(e,"EventInfo.Sequence",this._getSequenceId(e.apiKey)),this._setDefaultProperty(e,"EventInfo.SdkVersion",d.FullVersionString),this._setDefaultProperty(e,"EventInfo.Name",e.name),this._setDefaultProperty(e,"EventInfo.Time",new Date(e.timestamp).toISOString()),a.isPriority(e.priority)||(e.priority=i.AWTEventPriority.Normal),this._sendEvent(e)):c.default.eventsRejected([e],i.AWTEventsRejectedReason.InvalidEvent)):c.default.eventsRejected([e],i.AWTEventsRejectedReason.InvalidEvent)},e._addContextIfAbsent=function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e.properties[n]||(e.properties[n]=t[n]))},e._setDefaultProperty=function(e,t,n){e.properties[t]={value:n,pii:i.AWTPiiKind.NotSet,type:i.AWTPropertyType.String}},e._sendEvent=function(e){l.default.sendEvent(e)},e._getInternalEvent=function(e,t,n){if(e.properties=e.properties||{},n)for(var i in e.properties)e.properties.hasOwnProperty(i)&&(e.properties[i]=a.sanitizeProperty(i,e.properties[i]),null===e.properties[i]&&delete e.properties[i]);var r=e;return r.id=a.newGuid(),r.apiKey=t,r},e._getInitId=function(t){return e._initIdMap[t]},e._getSequenceId=function(t){return void 0===e._sequenceIdMap[t]&&(e._sequenceIdMap[t]=0),(++e._sequenceIdMap[t]).toString()},e._sequenceIdMap={},e._initIdMap={},e}();t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AWT_REAL_TIME="REAL_TIME",t.AWT_NEAR_REAL_TIME="NEAR_REAL_TIME",t.AWT_BEST_EFFORT="BEST_EFFORT"},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=n(7),c=n(33),l=n(57);function u(e){return!!e&&0===e.indexOf("application/json")}function d(e,t){return t.canceled||!t.statusCode||t.statusCode>=400&&t.statusCode<600?a.DoNotRetry:a.RetryCountedWithBackoff}!function(e){e[e.DontCare=0]="DontCare",e[e.Low=1]="Low",e[e.Normal=2]="Normal",e[e.High=3]="High",e[e.Critical=4]="Critical"}(o=t.WebRequestPriority||(t.WebRequestPriority={})),function(e){e[e.DoNotRetry=0]="DoNotRetry",e[e.RetryUncountedImmediately=1]="RetryUncountedImmediately",e[e.RetryUncountedWithBackoff=2]="RetryUncountedWithBackoff",e[e.RetryCountedWithBackoff=3]="RetryCountedWithBackoff",e[e.PauseUntilResumed=4]="PauseUntilResumed"}(a=t.ErrorHandlingType||(t.ErrorHandlingType={})),t.DefaultOptions={priority:o.Normal},t.SimpleWebRequestOptions={MaxSimultaneousRequests:5,HungRequestCleanupIntervalMs:1e4,setTimeout:function(e,t){return setTimeout(e,t)},clearTimeout:function(e){return clearTimeout(e)}},t.DefaultErrorHandler=d;var p,f=[],h=[],g=[],m=0,v=0,y=function(){function e(e,n,i,o,a){this._action=e,this._url=n,this.options=i,this._getHeaders=o,this._blockRequestUntil=a,this._aborted=!1,this._timedOut=!1,this._paused=!1,this._created=Date.now(),this._finishHandled=!1,this._retryExponentialTime=new l.ExponentialTime(1e3,3e5),this._options=r(r({},t.DefaultOptions),i)}return e.prototype.getPriority=function(){return this._options.priority||o.DontCare},e.checkQueueProcessing=function(){for(var e=function(){var e=f.shift();h.push(e),(e._blockRequestUntil&&e._blockRequestUntil()||s.Resolved()).finally(function(){c.remove(h,e)}).then(function(){g.length<t.SimpleWebRequestOptions.MaxSimultaneousRequests&&!e._aborted?(g.push(e),S._scheduleHungRequestCleanupIfNeeded(),e._fire()):e._enqueue()},function(t){e._respond("_blockRequestUntil rejected: "+t)})};f.length>0&&g.length<t.SimpleWebRequestOptions.MaxSimultaneousRequests;)e()},e._scheduleHungRequestCleanupIfNeeded=function(){g.length>0&&void 0===p?p=t.SimpleWebRequestOptions.setTimeout(this._hungRequestCleanupTimerCallback,t.SimpleWebRequestOptions.HungRequestCleanupIntervalMs):0===g.length&&p&&(t.SimpleWebRequestOptions.clearTimeout(p),p=void 0)},e.prototype._removeFromQueue=function(){c.remove(g,this),c.remove(f,this)},e.prototype._assertAndClean=function(e,t){e||(this._removeFromQueue(),console.error(t),c.assert(e,t))},e.prototype._fire=function(){var n=this;this._xhr=new XMLHttpRequest,this._xhrRequestHeaders={};var i=c.attempt(function(){n._xhr.open(n._action,n._url,!0)});if(i)this._respond(i.toString());else{if(this._options.timeout){var r=v;3!==r&&(this._assertAndClean(!this._requestTimeoutTimer,"Double-fired requestTimeoutTimer"),this._requestTimeoutTimer=t.SimpleWebRequestOptions.setTimeout(function(){n._requestTimeoutTimer=void 0,n._timedOut=!0,n.abort()},this._options.timeout)),(3===r||r<=1)&&(this._xhr.timeout=this._options.timeout,this._xhr.ontimeout=function(){v=3,3===r&&(n._timedOut=!0,n._aborted=!0,n._respond("TimedOut"))})}var o=m;3!==o?(0===o&&(m=1),this._xhr.onreadystatechange=function(){n._xhr&&(3!==n._xhr.readyState||!n._options.streamingDownloadProgress||n._aborted?4===n._xhr.readyState&&(0===o&&1===m&&t.SimpleWebRequestOptions.setTimeout(function(){3!==m&&(m=2)},1e4),n._respond()):n._options.streamingDownloadProgress(n._xhr.responseText))}):this._options.streamingDownloadProgress&&(this._xhr.onreadystatechange=function(){n._xhr&&3===n._xhr.readyState&&n._options.streamingDownloadProgress&&!n._aborted&&n._options.streamingDownloadProgress(n._xhr.responseText)}),2!==o&&(this._xhr.onload=function(){m=3,3===o&&n._respond()},this._xhr.onerror=function(){m=3,3===o&&n._respond()}),this._xhr.onabort=function(){n._aborted=!0,n._respond("Aborted")},this._xhr.upload&&this._options.onProgress&&(this._xhr.upload.onprogress=this._options.onProgress);var a=this._options.acceptType||"json",s=this._options.customResponseType||e._getResponseType(a),l=c.attempt(function(){n._xhr.responseType=s});if(l&&"json"!==s)throw l;S._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Accept",e.mapContentType(a)),this._xhr.withCredentials=!!this._options.withCredentials;var u=this.getRequestHeaders(),d={};if(Object.keys(u).forEach(function(e){var t=u[e],i=e.toLowerCase();"content-type"!==i?"accept"!==i?(n._assertAndClean(!d[i],"Setting duplicate header key: "+d[i]+" and "+e),null!=t?(d[i]=!0,S._setRequestHeader(n._xhr,n._xhrRequestHeaders,e,t)):console.warn('Tried to set header "'+e+'" on request with "'+t+'" value, header will be dropped')):n._assertAndClean(!1,"Don't set Accept with options.headers -- use it with the options.acceptType property"):n._assertAndClean(!1,"Don't set Content-Type with options.headers -- use it with the options.contentType property")}),this._options.sendData){var p=e.mapContentType(this._options.contentType||"json");S._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Content-Type",p);var f=e.mapBody(this._options.sendData,p);this._xhr.send(f)}else this._xhr.send()}},e._setRequestHeader=function(e,t,n,i){e.setRequestHeader(n,i),t[n]=i},e.mapContentType=function(e){return"json"===e?"application/json":"form"===e?"application/x-www-form-urlencoded":e},e.mapBody=function(e,t){if(u(t)){if(!c.isString(e))return JSON.stringify(e)}else if(function(e){return!!e&&0===e.indexOf("application/x-www-form-urlencoded")}(t)){if(!c.isString(e)&&c.isObject(e)){var n=e;return Object.keys(n).map(function(e){return encodeURIComponent(e)+(n[e]?"="+encodeURIComponent(n[e].toString()):"")}).join("&")}}else if(function(e){return!!e&&0===e.indexOf("multipart/form-data")}(t)){if(c.isObject(e)){var i=new FormData,r=e;return Object.keys(r).forEach(function(e){return i.append(e,r[e])}),i}c.assert(!1,"contentType multipart/form-data must include an object as sendData")}return e},e.prototype.setUrl=function(e){this._url=e},e.prototype.setHeader=function(e,t){this._options.augmentHeaders||(this._options.augmentHeaders={}),t?this._options.augmentHeaders[e]=t:delete this._options.augmentHeaders[e]},e.prototype.getRequestHeaders=function(){var e={};return!this._getHeaders||this._options.overrideGetHeaders||this._options.headers||(e=r(r({},e),this._getHeaders())),this._options.overrideGetHeaders&&(e=r(r({},e),this._options.overrideGetHeaders)),this._options.headers&&(e=r(r({},e),this._options.headers)),this._options.augmentHeaders&&(e=r(r({},e),this._options.augmentHeaders)),e},e.prototype.getOptions=function(){return c.clone(this._options)},e.prototype.setPriority=function(e){this._options.priority!==e&&(this._options.priority=e,this._paused||this._xhr||(c.remove(f,this),this._enqueue()))},e.prototype.resumeRetrying=function(){this._paused?(this._paused=!1,this._enqueue()):c.assert(!1,"resumeRetrying() called but not paused!")},e.prototype._enqueue=function(){var t=this;if(!this._aborted&&!(g.indexOf(this)>=0||h.indexOf(this)>=0||f.indexOf(this)>=0)){var n=f.findIndex(function(e){return e.getPriority()===t.getPriority()&&e._created>t._created||e.getPriority()<t.getPriority()});n>-1?f.splice(n,0,this):f.push(this),e.checkQueueProcessing()}},e._getResponseType=function(e){return"blob"===e?"arraybuffer":"text/xml"===e||"application/xml"===e?"document":"text/plain"===e?"text":"json"},e._hungRequestCleanupTimerCallback=function(){p=void 0,g.filter(function(e){return!(!e._xhr||4!==e._xhr.readyState)&&(console.warn("SimpleWebRequests found a completed XHR that hasn't invoked it's callback functions, manually responding"),!0)}).forEach(function(e){e._respond()}),S._scheduleHungRequestCleanupIfNeeded()},e}();t.SimpleWebRequestBase=y;var S=function(e){function n(t,n,i,r,o){return e.call(this,t,n,i,r,o)||this}return i(n,e),n.prototype.abort=function(){this._aborted?c.assert(!1,"Already aborted "+this._action+" request to "+this._url):(this._aborted=!0,this._retryTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._deferred?(this._respond("Aborted"),this._xhr&&this._xhr.abort()):c.assert(!1,"Haven't even fired start() yet -- can't abort"))},n.prototype.start=function(){var e=this;return this._deferred?(c.assert(!1,"WebRequest already started"),s.Rejected("WebRequest already started")):(this._deferred=s.Defer(),this._deferred.onCancel(function(){e.abort()}),this._enqueue(),this._deferred.promise())},n.prototype._respond=function(e){var n=this;if(!this._finishHandled){this._finishHandled=!0,this._removeFromQueue(),this._retryTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0);var i,r=0;if(this._xhr)try{r=this._xhr.status,i=this._xhr.statusText||e}catch(e){}else i=e||"Browser Error - Possible CORS or Connectivity Issue";var o,s,l={};if(this._xhr){if((this._xhr.getAllResponseHeaders()||"").split(/\r?\n/).forEach(function(e){if(0!==e.length){var t=e.indexOf(":");-1===t?l[e]="":l[e.substr(0,t).toLowerCase()]=e.substr(t+1).trim()}}),!l["content-type"]){var p=this._xhr.getResponseHeader("content-type");p&&(l["content-type"]=p)}if(o=this._xhr.response,l["content-type"]&&u(l["content-type"])&&(!o||!c.isObject(o))&&("text"===this._xhr.responseType||""===this._xhr.responseType)&&this._xhr.responseText)try{o=JSON.parse(this._xhr.responseText)}catch(e){s=e,console.warn("Failed to parse XHR JSON response")}}if(this._xhr&&4===this._xhr.readyState&&(r>=200&&r<300||304===r)){var f={url:this._xhr.responseURL||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:r,statusText:i,headers:l,body:o,responseParsingException:s};this._deferred.resolve(f)}else{var h={url:(this._xhr?this._xhr.responseURL:void 0)||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:r,statusText:i,headers:l,body:o,canceled:this._aborted,timedOut:this._timedOut,responseParsingException:s};this._options.augmentErrorResponse&&this._options.augmentErrorResponse(h);var g=this._options.customErrorHandler?this._options.customErrorHandler(this,h):d(0,h);g!==a.DoNotRetry&&(this._options.retries&&this._options.retries>0||g===a.PauseUntilResumed||g===a.RetryUncountedImmediately||g===a.RetryUncountedWithBackoff)?(g===a.RetryCountedWithBackoff&&this._options.retries--,this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._aborted=!1,this._timedOut=!1,this._finishHandled=!1,this._xhr&&(this._xhr.onabort=null,this._xhr.onerror=null,this._xhr.onload=null,this._xhr.onprogress=null,this._xhr.onreadystatechange=null,this._xhr.ontimeout=null,this._xhr=void 0,this._xhrRequestHeaders=void 0),g===a.PauseUntilResumed?this._paused=!0:g===a.RetryUncountedImmediately?this._enqueue():this._retryTimer=t.SimpleWebRequestOptions.setTimeout(function(){n._retryTimer=void 0,n._enqueue()},this._retryExponentialTime.getTimeAndCalculateNext())):this._deferred.reject(h)}y.checkQueueProcessing()}},n}(y);t.SimpleWebRequest=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33);t.DEFAULT_TIME_GROW_FACTOR=2.718281828459045,t.DEFAULT_TIME_JITTER=.11962656472;var r=function(){function e(e,n,r,o){void 0===r&&(r=t.DEFAULT_TIME_GROW_FACTOR),void 0===o&&(o=t.DEFAULT_TIME_JITTER),this._initialTime=e,this._maxTime=n,this._growFactor=r,this._jitterFactor=o,i.assert(this._initialTime>0,"Initial delay must be positive"),i.assert(this._maxTime>0,"Delay upper bound must be positive"),i.assert(this._growFactor>=0,"Ratio must be non-negative"),i.assert(this._jitterFactor>=0,"Jitter factor must be non-negative"),this.reset()}return e.prototype.reset=function(){this._incrementCount=0,this._currentTime=Math.round(this._initialTime*(1+Math.random()*this._jitterFactor))},e.prototype.getTime=function(){return this._currentTime},e.prototype.getIncrementCount=function(){return this._incrementCount},e.prototype.calculateNext=function(){var e=this._currentTime*this._growFactor;return e>this._maxTime&&(e=this._maxTime),this._jitterFactor<1e-5?this._currentTime=e:this._currentTime=Math.round(Math.random()*e*this._jitterFactor+e),this._currentTime<this._initialTime&&(this._currentTime=this._initialTime),this._currentTime>this._maxTime&&(this._currentTime=this._maxTime),this._incrementCount++,this._currentTime},e.prototype.getTimeAndCalculateNext=function(){var e=this.getTime();return this.calculateNext(),e},e}();t.ExponentialTime=r},function(e,t,n){"use strict";var i=n(134);function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new r("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(i(e.split(".")[n]))}catch(e){throw new r("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=r},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(25),s=n(8),c=n(14),l=n(4),u=n(3),d=n(18),p=n(36);class f{constructor(e,t){this.videoStream=e,this.options=t,this._eventEmitter=new s.EventEmitter,this._isRendering=!1,this.scalingMode=(null==t?void 0:t.scalingMode)||"Crop",this.mirrored=!!((null==t?void 0:t.mirrored)||this.videoStream instanceof a.LocalVideoStream),this.target=document.createElement("div"),this.target.style.width="100%",this.target.style.height="100%"}get isRendering(){return this._isRendering}render(){var e,t,n;return o(this,void 0,void 0,function*(){if(this.videoStream instanceof a.LocalVideoStream){const t=c.CallStack.getInitializedTsStack();null==t||t.getDeviceManager().selectDevices({camera:this.videoStream.getSource().id}),this.tsRenderer=yield null==t?void 0:t.getDeviceManager().createPreview(this.target,{kind:"camera"},{scalingMode:d.toTsScalingMode(null===(e=this.options)||void 0===e?void 0:e.scalingMode),transparent:!1,ignoreMirroring:!1,disposeRendererWhenStreamisNotAvailable:()=>!0}),this.mirrored&&(this.target.style.webkitTransform="rotateY(180deg)")}if(this.videoStream instanceof p.RemoteVideoStreamImpl){const e=yield this.videoStream.render(this.target,null===(t=this.options)||void 0===t?void 0:t.scalingMode);this.tsRenderer=e._tsRenderer}this.tsRendererChangedSubs=null===(n=this.tsRenderer)||void 0===n?void 0:n.changed(()=>{var e,t;this._isRendering!==(null===(e=this.tsRenderer)||void 0===e?void 0:e.isRendering)&&this._updateIsRendering(!!(null===(t=this.tsRenderer)||void 0===t?void 0:t.isRendering))})})}on(e,t){this._eventEmitter.on(e,t)}off(e,t){this._eventEmitter.on(e,t)}updateScalingMode(e){var t;return o(this,void 0,void 0,function*(){null===(t=this.tsRenderer)||void 0===t||t.setScalingMode(d.toTsScalingMode(e))})}dispose(){var e,t,n;this._updateIsRendering(!1),null===(e=this.tsRendererChangedSubs)||void 0===e||e.dispose(),null===(t=this.tsRenderer)||void 0===t||t.dispose(),this.tsRenderer=void 0;try{null===(n=this.target.parentElement)||void 0===n||n.removeChild(this.target)}catch(e){return}}_updateIsRendering(e){this._isRendering=e,this._eventEmitter.emit("isRenderingChanged")}}i([l.asyncOperation(u.RendererViewOperation.Render),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],f.prototype,"render",null),i([l.asyncOperation(u.RendererViewOperation.UpdateScalingMode),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],f.prototype,"updateScalingMode",null),i([l.syncOperation(u.RendererViewOperation.Dispose),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],f.prototype,"dispose",null),t.RendererViewImpl=f},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(4),s=n(2),c=n(3),l=n(59);class u{constructor(e){this.videoStream=e,this.size={height:0,width:0},this.views=[],this.disposed=!1}createView(e){return o(this,void 0,void 0,function*(){if(this.disposed)throw new s.CommunicationErrorImpl("Renderer is disposed").setCode(400);const t=new l.RendererViewImpl(this.videoStream,e);return yield t.render(),this.views.push(t),t})}dispose(){this.views.forEach(e=>e.dispose()),this.disposed=!0}}i([a.asyncOperation(c.RendererOperation.CreateView),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"createView",null),i([a.syncOperation(c.RendererOperation.Dispose),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],u.prototype,"dispose",null),t.Renderer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(37);class r{constructor(e,t=[]){this._azureLogger=e,this._namespace=t}createChild(e){return new r(this._azureLogger,[...this._namespace,"string"==typeof e?()=>e:e])}createFnLogger(e,t,...n){return this.createChild(this.getPrefix(e,t)+n.join(""))}log(...e){this._azureLogger.verbose(this.getMessage(e))}debug(...e){this._azureLogger.verbose(this.getMessage(e))}info(...e){this._azureLogger.info(this.getMessage(e))}warn(...e){this._azureLogger.warning(this.getMessage(e))}error(...e){this._azureLogger.error(this.getMessage(e))}getMessage(...e){const t=new Date;return`${i.formatTimeOnBrowser(t)} ${this.getNamespace()} ${e.join(" ")}`}getNamespace(){return this._namespace.map(e=>e()).join("")}getPrefix(e,t){let n="";return t&&(n+=`[${t}]`),e&&(n+=`[${e}]`),n}}t.DefaultLogger=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2);t.parseMeetingUrl=function(e){try{const t=new URL(e),n=t.pathname.split("/"),r=decodeURIComponent(n[3]),o=n[4],a=JSON.parse(decodeURIComponent(t.search.replace("?context=","")));return{threadId:r,messageId:o,organizerId:a.Oid,tenantId:a.Tid}}catch(e){throw new i.CommunicationErrorImpl("Invalid meeting link").setCode(400)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AudioDeviceInfoImpl=class{constructor(e,t,n,i){this._name=e,this._id=t,this._isSystemDefault=n,this._deviceType=i}get name(){return this._name}get id(){return this._id}get isSystemDefault(){return this._isSystemDefault}get deviceType(){return this._deviceType}}},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(8),s=n(4),c=n(63),l=n(3),u=n(38);class d{constructor(e,t){this._tsDeviceManager=e,this._videoDevices=[],this._audioDevices=[],this._eventEmitter=new a.EventEmitter,this._cameraPositionToCameraFacingMap={0:"Unknown",1:"Front",2:"Back",3:"External",4:"LeftFront",5:"RightFront",6:"Panoramic"},this._tsDeviceTypeToAudioDeviceType={2:"Microphone",3:"Speaker",4:"CompositeAudioDevice"},this.tsToSpoolPermissionState=(e=>"prompt"===e?"Prompt":"granted"===e?"Granted":"denied"===e?"Denied":"Unknown"),this._logger=t.createChild(()=>"[DeviceManager]"),this._dmPermissionStateChangedSub=this._tsDeviceManager.on("onPermissionStateChanged",()=>{this._eventEmitter.emit("permissionStateChanged")})}initialize(){return o(this,void 0,void 0,function*(){const e=yield this._tsDeviceManager.enumerateDevicesAsync();this._logger.info(`tsDevicesList:${JSON.stringify(e)}`),e.forEach(e=>{if(1===e.kind){const t=e;this._videoDevices.push(new u.VideoDeviceInfoImpl(t.label,t.id,this._cameraPositionToCameraFacingMap[t.position],"UsbCamera"))}else if(2===e.kind||3===e.kind){const t=e,n=new c.AudioDeviceInfoImpl(t.label,t.id,t.isSystemDefault,this._tsDeviceTypeToAudioDeviceType[t.kind]);2===e.kind&&t.isSystemDefault&&(this._currentMicrophone=n),3===e.kind&&t.isSystemDefault&&(this._currentSpeaker=n),this._audioDevices.push(n)}}),this._dmDevicesChangedSub=this._tsDeviceManager.on("devicesChanged",e=>{const t=[];let n=[];const i=[];let r=[];e.map(e=>{if(1!==e.kind||this._videoDevices.find(t=>t.id===e.id)){if((2===e.kind||3===e.kind)&&!this._audioDevices.find(t=>t.id===e.id)){const t=new c.AudioDeviceInfoImpl(e.label,e.id,e.isSystemDefault,this._tsDeviceTypeToAudioDeviceType[e.kind]);i.push(t),this._audioDevices.push(t)}}else{const n=new u.VideoDeviceInfoImpl(e.label,e.id,this._cameraPositionToCameraFacingMap[e.position],"UsbCamera");t.push(n),this._videoDevices.push(n)}});const o=t=>{const n=t.filter(t=>!e.find(e=>e.id===t.id));return n.map(e=>{t.splice(t.indexOf(e),1)}),n};n=o(this._videoDevices),r=o(this._audioDevices),(t.length>0||n.length>0)&&this._eventEmitter.emit("videoDevicesUpdated",{added:t,removed:n}),(i.length>0||r.length>0)&&this._eventEmitter.emit("audioDevicesUpdated",{added:i,removed:r})})})}on(e,t){this._eventEmitter.on(e,t)}off(e,t){this._eventEmitter.off(e,t)}getTsDeviceManager(){return this._tsDeviceManager}getCameraList(){return this._videoDevices}getMicrophoneList(){return this._audioDevices.filter(e=>"Microphone"===e.deviceType)}getSpeakerList(){return this._audioDevices.filter(e=>"Speaker"===e.deviceType)}getMicrophone(){return this._currentMicrophone}setMicrophone(e){this._logger.info(`setMicrophone: device id:${e.id}`),this._currentMicrophone!==e?(this._tsDeviceManager.selectDevices({microphone:e.id}),this._currentMicrophone=e):this._logger.warn(`microphoneDeviceInfo: ${e} is already active`)}getSpeaker(){return this._currentSpeaker}setSpeaker(e){this._logger.info(`setSpeaker: device id:${e.id}`),this._currentSpeaker!==e?(this._tsDeviceManager.selectDevices({speaker:e.id}),this._currentSpeaker=e):this._logger.warn(`speakerDeviceInfo: ${e} is already active`)}askDevicePermission(e,t){return o(this,void 0,void 0,function*(){return this._logger.info(`askDevicePermission: audio:${e}, video:${t}`),this._tsDeviceManager.askDevicePermission({audio:e,video:t})})}getPermissionState(e){return o(this,void 0,void 0,function*(){let t="camera";return"Microphone"===e&&(t="microphone"),this.tsToSpoolPermissionState(this._tsDeviceManager.getPermissionState(t))})}dispose(){this._dmPermissionStateChangedSub&&this._dmPermissionStateChangedSub.dispose(),this._dmPermissionStateChangedSub=void 0,this._dmDevicesChangedSub&&this._dmDevicesChangedSub.dispose(),this._dmDevicesChangedSub=void 0}}i([s.syncOperation(l.DeviceManagerOperation.GetCameraList),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Array)],d.prototype,"getCameraList",null),i([s.syncOperation(l.DeviceManagerOperation.GetMicrophoneList),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Array)],d.prototype,"getMicrophoneList",null),i([s.syncOperation(l.DeviceManagerOperation.GetSpeakerList),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Array)],d.prototype,"getSpeakerList",null),i([s.syncOperation(l.DeviceManagerOperation.GetMicrophone),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Object)],d.prototype,"getMicrophone",null),i([s.syncOperation(l.DeviceManagerOperation.SetMicrophone),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",void 0)],d.prototype,"setMicrophone",null),i([s.syncOperation(l.DeviceManagerOperation.GetSpeaker),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Object)],d.prototype,"getSpeaker",null),i([s.syncOperation(l.DeviceManagerOperation.SetSpeaker),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",void 0)],d.prototype,"setSpeaker",null),i([s.asyncOperation(l.DeviceManagerOperation.AskDevicePermission),r("design:type",Function),r("design:paramtypes",[Boolean,Boolean]),r("design:returntype",Promise)],d.prototype,"askDevicePermission",null),i([s.asyncOperation(l.DeviceManagerOperation.GetPermissionState),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],d.prototype,"getPermissionState",null),t.DeviceManagerImpl=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(48);t.loggerProperty=function(e,t){Reflect.defineMetadata(i.loggerKeySymbol,t,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={0:"Undefined",1:"Success",2:"NoNgcEndpoint",3:"NetworkError",4:"MediaDroppedError",5:"BadRequest",6:"CallEstablishmentTimeout",7:"CallSetupError",8:"NoPermission",9:"Missed",10:"Declined",11:"Busy",12:"Cancelled",13:"Dropped",14:"PstnInsufficientFunds",15:"PstnSkypeoutAccountBlocked",16:"PstnCouldNotConnectToSkypeProxy",17:"PstnBlockedByUs",18:"PstnBlockedRegulatoryIndia",19:"PstnInvalidNumber",20:"PstnNumberForbidden",21:"PstnCallTerminated",22:"PstnNumberUnavailable",23:"PstnEmergencyCallDenied",24:"CallNotFound",25:"LocalError",26:"NotAcceptableHere",27:"CallForwarded",28:"CallForwardedToVoicemail",29:"SkypeTokenError",30:"CallAccepted",31:"LocalHttpStackError",32:"UnknownError",33:"PstnNoSubscriptionCover",34:"SessionNotFound",35:"SessionTimedOut",36:"PstnCreditExpired",37:"PstnCreditExpiredButEnough",38:"RetargetNotSupported",39:"EnterprisePstnInternalError",40:"EnterprisePstnUnavailable",41:"EnterprisePstnForbidden",42:"EnterprisePstnInvalidNumber",43:"EnterprisePstnMiscError",44:"Kicked",45:"NetworkRequestTimeoutError",46:"CallDoesNotExist",47:"MediaSetupFailure",48:"ServiceUnavailable",49:"SignalingError",50:"ConversationEstablishmentFailed",51:"TemporarilyUnavailable",52:"CannotConnectToNetworkError",53:"MediaRelayWhiteListingIssue",54:"NoSignalingFromPeer",55:"DeniedInLobby",56:"TimedOutInLobby",57:"CallFailedConflict",58:"DevicePermissionDenied",59:"ConfParticipantCountLimitReached",60:"ActionNotAllowed",61:"Abandoned",62:"ForbiddenDueToPolicy",63:"InsufficientCapabilitiesForCallee",64:"UserBlocked",65:"AccessDenied",66:"AnonymousJoinDisabledByPolicy",67:"NoLobbyForBroadcastJoin",68:"NotAllowedDueToInformationBarrier",69:"BroadcastLimitReached",70:"TeamParkPolicyDisabled",71:"B2bJoinDisabledByPolicy",72:"LocationBasedRoutingError",73:"ConfLobbyParticipantCountLimitReached"};t.convertTerminatedReasonToString=(e=>{return"number"==typeof e&&i[e]||"UnknownError"});const r={0:"None",1:"AddingFailed",2:"NoResponse",3:"Declined",4:"NotReachable",5:"Blocked",6:"NotFriendOrAuthorized",7:"CallLimitReached",8:"CallNotFound",9:"NetworkError",10:"MediaDroppedError",11:"OtherError",12:"PstnInsufficientFunds",13:"PstnSkypeoutAccountBlocked",14:"PstnCouldNotConnectToSkypeProxy",15:"PstnBlockedByUs",16:"PstnBlockedRegulatoryIndia",17:"PstnInvalidNumber",18:"PstnNumberForbidden",19:"Busy",20:"PstnCallTerminated",21:"PstnNumberUnavailable",22:"PstnEmergencyCallDenied",23:"Cancelled",24:"Dropped",25:"PstnNoSubscriptionCover",26:"PstnCreditExpired",27:"PstnCreditExpiredButEnough",28:"EnterprisePstnInternalError",29:"EnterprisePstnUnavailable",30:"EnterprisePstnForbidden",31:"EnterprisePstnInvalidNumber",32:"EnterprisePstnMiscError",33:"Kicked",34:"NetworkRequestTimeoutError",35:"CallDoesNotExist",36:"MediaSetupFailure",37:"ServiceUnavailable",38:"SignalingError",39:"ConversationEstablishmentFailed",40:"TemporarilyUnavailable",41:"CannotConnectToNetworkError",42:"NoSignalingFromPeer",43:"ParticipantDoesNotExist",44:"DeniedInLobby",45:"TimedOutInLobby",46:"ConfParticipantCountLimitReached",47:"Abandoned",48:"ActionNotAllowed",49:"ForbiddenDueToPolicy",50:"InsufficientCapabilitiesForCallee",51:"AccessDenied",52:"NoPermission",53:"AnonymousJoinDisabledByPolicy",54:"NoLobbyForBroadcastJoin",55:"NotAllowedDueToInformationBarrier",56:"BroadcastLimitReached",57:"B2bJoinDisabledByPolicy",58:"LocationBasedRoutingError",59:"ConfLobbyParticipantCountLimitReached",60:"LobbyUserLeft"};t.convertParticipantStateReasonToString=(e=>{return"number"==typeof e&&r[e]||"UnknownError"})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defer=function(){let e,t,n=!0;return{isPending:()=>n,promise:new Promise((n,i)=>{e=n,t=i}),resolve:t=>{n&&(e(t),n=!1)},reject:e=>{n&&(t(e),n=!1)}}}},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(8),s=n(4),c=n(67),l=n(3),u=n(18);class d{constructor(e,t,n,i){this._target=e,this._tsStream=t,this._logger=n,this._onDisposed=i,this._eventEmitter=new a.EventEmitter,this._isRendering=!1,this._disposed=!1,this._handleTsRendererChanged=(()=>{this._tsRenderer&&this._tsRenderer.isRendering!==this._isRendering&&(this._isRendering=this._tsRenderer.isRendering,this._isRendering&&this._renderingDeferred&&(this._renderingDeferred.resolve(),this._renderingDeferred=void 0),this._logger.log(`isRendering change to ${this._isRendering}`),this._eventEmitter.emit("isRenderingChanged"))}),this._logger=this._logger.createChild("[Renderer]"),this._logger.log("created")}get isRendering(){return this._isRendering}get scalingMode(){return this._scalingMode}get target(){return this._target}on(e,t){this._eventEmitter.on(e,t)}off(e,t){this._eventEmitter.off(e,t)}start(e){return o(this,void 0,void 0,function*(){this._logger.log("start");try{return this._tsRenderer=yield this._tsStream.start(this._target,{scalingMode:u.toTsScalingMode(e||"Stretch"),transparent:!1,disposeRendererWhenStreamisNotAvailable:()=>!1}),this._scalingMode=e||"Stretch",this._renderingDeferred=c.defer(),this._tsRendererChanged=this._tsRenderer.changed(this._handleTsRendererChanged),yield this._renderingDeferred.promise,this}catch(e){throw this.dispose(),new Error("Failed to start renderer")}})}setScalingMode(e){if(!this._tsRenderer)throw new Error("Failed to start renderer");this._tsRenderer.setScalingMode(u.toTsScalingMode(e)),this._scalingMode=e,this._eventEmitter.emit("changed")}dispose(){this._disposed||(this._disposed=!0,this._renderingDeferred&&this._renderingDeferred.reject(),this._tsRendererChanged&&this._tsRendererChanged.dispose(),this._tsRenderer?(this._logger.log("dispose"),this._tsRenderer.dispose()):this._target&&this._target.remove(),this._onDisposed&&this._onDisposed(this),this._eventEmitter.removeAllListeners())}}i([s.syncOperation(l.RemoteVideoRendererOperation.SetScalingMode),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",void 0)],d.prototype,"setScalingMode",null),t.RemoteVideoRenderer=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(13),r=n(8),o=n(37),a=n(36);t.RemoteParticipantImpl=class{constructor(e,t){this._eventEmitter=new r.EventEmitter,this._mappedStreams=new Map,this._state="Idle",this._lastTsParticipantState=0,this._isMuted=!1,this._isSpeaking=!1,this._displayName="",this.acsToTsStreamType=(e=>"Video"===e?0:"ScreenSharing"===e?1:void 0),this._identifier=e,this._logger=t.createChild(()=>`[RemoteParticipant{${i.getIdentifierKind(this._identifier).kind}}]`),this._logger.log("created")}get identifier(){return this._identifier}get state(){return this._state}get videoStreams(){return[...this._mappedStreams.values()]}get isMuted(){return this._isMuted}get isSpeaking(){return this._isSpeaking}get callEndReason(){return this._callEndReason}get displayName(){return this._displayName}on(e,t){this._eventEmitter.on(e,t)}off(e,t){this._eventEmitter.off(e,t)}dispose(){this._logger.log("dispose"),this._participantChangedHandler&&this._participantChangedHandler.dispose(),this._mappedStreams.forEach(e=>e.dispose()),this._mappedStreams.clear(),this._eventEmitter.removeAllListeners()}setCallEndReason(e){this._callEndReason=e}observeParticipant(e){this._tsParticipant=e,this._displayName=e.displayName,this._tsParticipant&&(this._participantChangedHandler=this._tsParticipant.changed(()=>{if(this._tsParticipant&&this._tsParticipant.state!==this._lastTsParticipantState&&(this._lastTsParticipantState=this._tsParticipant.state,this._mapTsParticipantState(this._tsParticipant.state)),this._mapStreams(),this._tsParticipant&&this._tsParticipant.isServerMuted!==this._isMuted&&(this._isMuted=this._tsParticipant.isServerMuted,this._eventEmitter.emit("isMutedChanged")),this._tsParticipant&&this._tsParticipant.displayName!==this._displayName&&(this._displayName=e.displayName,this._eventEmitter.emit("displayNameChanged")),this._tsParticipant){const e=0!==this._tsParticipant.voiceLevel;e!==this._isSpeaking&&(this._isSpeaking=e,this._eventEmitter.emit("isSpeakingChanged"))}}),this._mapTsParticipantState(this._tsParticipant.state),this._mapStreams())}_mapTsParticipantState(e){let t;const n={0:"Idle",1:"Connecting",2:"Connecting",3:"Connected",4:"Disconnected",5:"OnHold",7:"InLobby",6:"EarlyMedia"};n[e]?(t=n[e],this._logger.log(`mapped tsParticipant ${e}=>${this._state}`),this._setParticipantState(t)):this._logger.log(`unable to map tsCall state=${e} to call state`),"Disconnected"===this._state&&this.dispose()}_setParticipantState(e){e!==this._state&&(this._logger.log(`state changed ${this._state}=>${this.state}`),this._state=e,this._eventEmitter.emit("participantStateChanged",this._state))}_mapStreams(){const e=[],t=[],n=e=>{this._mappedStreams.set(e.id,e)},i=e=>{const t=this._mappedStreams.get(e.id);t&&(this._logger.log(`stream removed, type==${t.type} id=${e.id}`),this._mappedStreams.delete(e.id),t.dispose())},r=n=>{if(this._tsParticipant)if(o.isNonEmptyArray(this._tsParticipant.streams&&this._tsParticipant.streams[n])){let i=[];this._tsParticipant&&(i=this._tsParticipant.streams[n]),i.forEach(t=>{if(!this._mappedStreams.get(t.id)){const n=new a.RemoteVideoStreamImpl(t,this._logger);this._logger.log(`stream created, type==${n.type} id=${t.id}`),e.push(n)}}),this._mappedStreams.forEach(e=>{this.acsToTsStreamType(e.type)===n&&(i.some(t=>t.id===e.id)||t.push(e))})}else this._mappedStreams.forEach(e=>{this.acsToTsStreamType(e.type)===n&&t.push(e)})};r(0),r(1),(e.length>0||t.length>0)&&(e.forEach(n),t.forEach(i),this._eventEmitter.emit("videoStreamsUpdated",{added:e,removed:t}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(32),r="53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413",o="1cae5691997646c98b01d15beddae7a3-ce16e198-bc32-420f-ac64-42bb916111af-6865";class a{constructor(){this._eventToTenantId={skypecosi_concore_web_csa_conversation_httprequest:r,skypecosi_concore_web_ts_calling_in_call_session:r,skypecosi_concore_web_ts_calling_call_setup_session:r,skypecosi_concore_native_ts_calling_in_call_session:r,skypecosi_concore_native_ts_calling_call_setup_session:r,skypecosi_concore_web_pluginless_call_session:r,skypecosi_concore_web_pluginless_modality_session:r,skypecosi_concore_web_csa_conversation_callmodality:r,mdsc_webrtc_session:o,mdsc_webrtc_session_initial:o,mdsc_ortc_reports:o,mdsc_ortc_reports_initial:o,mdsc_rt_log:o,foo:""},this.getTenant=(e=>this._eventToTenantId[e]?this._eventToTenantId[e]:""),this.getCallingAdapter=(()=>({sendEvent:(e,t)=>{i.TelemetryLogManager.instance.sendEvent({tenant:this.getTenant(e),name:e,properties:t})}})),this.getGenericTelemetryLogger=(e=>({sendEvent:e=>{i.TelemetryLogManager.instance.sendEvent({tenant:this.getTenant(e.eventName),name:e.eventName,properties:e.props})}})),this.getMediaAdapter=(()=>({sendEvent:(e,t)=>{i.TelemetryLogManager.instance.sendEvent({tenant:this.getTenant(e),name:e,properties:t})}})),this.sendEvents=(e=>(e.forEach(e=>{i.TelemetryLogManager.instance.sendEvent({tenant:this.getTenant(e.eventName),name:e.eventName,properties:e.props})}),Promise.resolve()))}}t.TelemetryService=a,a.instance=new a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(40),r=n(17),o=n(26),a=n(16),s=n(29);class c{constructor(e){this.logEvent=(e=>{this._logger.debug(e)}),this._logger=e}}t.Trouter=class{init(e,t,n,r){return this._logger=e,this._logger.info("Trouterservice init"),n(!1),this._trouterService?this._logger.error("Trouterservice already initialized"):(this._options=this._getTrouterConfig(e,t,n),this._trouterService=i.createTrouterService(e.createChild("[Trouter]"))),this}start(e){this._logger.info("Trouterservice start"),this._trouterService?(e&&(this._options.trouterSettings.environment=e.environment||"",this._options.trouterSettings.sessionId=e.sessionId),this._trouterService.start(this._options)):this._logger.error("Trouterservice not initialized")}stop(){this._logger.info("Trouterservice stop"),this._trouterService?(this._trouterService.stop(),this._trouterService=void 0):this._logger.error("Trouterservice not inited")}registerMessageHandler(e){this._logger.info("Trouterservice registerMessageHandler"),this._trouterService&&this._trouterService.registerMessageHandler(e)}clearMessageHandlers(){this._trouterService&&this._trouterService.clearMessageHandlers()}checkConnection(){this._trouterService&&this._trouterService.checkConnection()}state(){return this._logger.info("Trouterservice state"),this._trouterService?this._trouterService.state():i.TrouterState.Unknown}onStateChanged(e){this._logger.info("Trouterservice onStateChanged"),this._trouterService&&this._trouterService.onStateChanged(e)}offStateChanged(e){this._logger.info("Trouterservice offStateChanged"),this._trouterService&&this._trouterService.offStateChanged(e)}getTrouterUrlAsync(){return this._trouterService?(this._logger.info("getTrouterUrlAsync called"),this._trouterService.getTrouterUrlAsync()):Promise.reject("Trouterservice not started yet")}_getSettings(e){return{registrationId:s.generateGuid(),registrarServiceUrl:e.registrarServiceUrl||o.EcsProvider.instance.getTrouterSettings().registrarServiceUrl,registrarTtlInSeconds:o.EcsProvider.instance.getTrouterSettings().registrarTtlInSeconds,maxRegistrationTimeInMs:o.EcsProvider.instance.getTrouterSettings().maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:o.EcsProvider.instance.getTrouterSettings().registrarRefreshTimeoutInMs,pnhAppId:o.EcsProvider.instance.getTrouterSettings().pnhAppId,pnhTemplate:o.EcsProvider.instance.getTrouterSettings().pnhTemplate,platform:o.EcsProvider.instance.getTrouterSettings().platform,platformUIVersion:`${r.getPlatformId()}/${a.getSdkVersion()}`,trouterServiceUrl:o.EcsProvider.instance.getTrouterSettings().trouterServiceUrl,version:o.EcsProvider.instance.getTrouterSettings().version,trouterConnectTimeoutInMs:o.EcsProvider.instance.getTrouterSettings().trouterConnectTimeoutInMs,productName:o.EcsProvider.instance.getTrouterSettings().productName,sessionId:e.sessionId||o.EcsProvider.instance.getTrouterSettings().sessionId,environment:o.EcsProvider.instance.getTrouterSettings().environment,incallModeTimeoutMs:0}}_createTrouterTelemetryConfig(e){return{eventLogger:new c(e.createChild("[TrouterTelemetry]")),settings:{enabled:o.EcsProvider.instance.getTrouterTelemetryConfig().enabled,logHealthCheckError:o.EcsProvider.instance.getTrouterTelemetryConfig().logHealthCheckError,trouter_js_client_connected:o.EcsProvider.instance.getTrouterTelemetryConfig().trouter_js_client_connected,trouter_js_client_disconnected:o.EcsProvider.instance.getTrouterTelemetryConfig().trouter_js_client_disconnected,trouter_js_client_error:o.EcsProvider.instance.getTrouterTelemetryConfig().trouter_js_client_error,trouter_js_client_progress:o.EcsProvider.instance.getTrouterTelemetryConfig().trouter_js_client_progress,trouter_js_client_response:o.EcsProvider.instance.getTrouterTelemetryConfig().trouter_js_client_response,numberOfStepsToMaintain:o.EcsProvider.instance.getTrouterTelemetryConfig().numberOfStepsToMaintain,sendProgressTimeoutSecs:o.EcsProvider.instance.getTrouterTelemetryConfig().sendProgressTimeoutSecs}}}_getTrouterConfig(e,t,n){return{trouterSettings:this._getSettings(t),skypeTokenProvider:n,telemetryConfig:this._createTrouterTelemetryConfig(e)}}}},function(e,t,n){e.exports=function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}};var i=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=i},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(a=(a=c.trys).length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),s=function(e){function t(t){var n=e.call(this,t)||this;return n.name="CancelationError",n}return i(t,e),t}(Error),c=function(){function e(t,n,i){this.logger=t,this.maxBackoffInMs=n,this.initialDelay=i,this.backoffCount=0,this.id=++e.idCounter}return e.prototype.delay=function(e){var t=this;if(void 0!==this.timerHandle)throw new Error("Retry sequence logical failure");if(-1===this.backoffCount)return new Promise(function(e,t){t(new s("Cancelled"))});var n=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off "+e+" for "+n+" milliseconds with ID "+this.id),new Promise(function(i,r){t.cancelFunc=r,t.timerHandle=setTimeout(function(){t.logger.info("[RegistrarClient] Back off for "+e+" with ID "+t.id+" complete"),t.timerHandle=void 0,i()},n)})},e.prototype.cancel=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),void 0!==this.cancelFunc&&this.cancelFunc(new s("Cancelled"))),this.backoffCount=-1},e.prototype.calculateNextBackoffMs=function(){var e=1+.4*(Math.random()-.5),t=this.initialDelay*Math.pow(2,this.backoffCount)*e;return t=Math.round(t),Math.min(this.maxBackoffInMs,t)},e.idCounter=0,e}(),l=function(){function e(e,t,n){this.logger=e,this.skypeTokenProvider=t,this.options=n,this.backoffs={}}return e.prototype.setTelemetryLogger=function(e){this.eventLogger=e},e.prototype.register=function(e,t){return r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,this.performRegistration(e,t,"pr_set_registration")];case 1:return n.sent(),this.cachedRegistrationParams=[e,t],[2]}})})},e.prototype.unregister=function(){return r(this,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),e=new Request(this.options.registrarUrl+"/"+this.options.registrationId,{method:"DELETE",mode:"cors",headers:new Headers({accept:"application/json, text/javascript"})}),[4,this.callRegistrar(e,"pr_delete_registration")];case 1:return t.sent(),[2]}})})},e.prototype.cancelPendingRequests=function(){var e=this;Object.keys(this.backoffs).forEach(function(t){e.backoffs[t].cancel()}),this.backoffs={}},e.prototype.resendRegistration=function(){return r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return e.sent(),[2]}})})},e.prototype.performRegistration=function(e,t,n){return r(this,void 0,void 0,function(){var i,r;return o(this,function(o){switch(o.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),i={clientDescription:e,registrationId:this.options.registrationId,nodeId:"",transports:t},r=new Request(this.options.registrarUrl,{method:"POST",mode:"cors",headers:new Headers({"content-type":"application/json",accept:"application/json, text/javascript"}),body:a.toJson(i)}),[4,this.callRegistrar(r,n)];case 1:return o.sent(),[2]}})})},e.prototype.startBackoff=function(){var e=new c(this.logger,this.options.maxRetryDelayMs,this.options.initialRetryDelayMs);return this.backoffs[e.id]=e,e},e.prototype.stopBackoff=function(e){e.cancel(),delete this.backoffs[e.id]},e.prototype.getSkypeToken=function(){return r(this,void 0,void 0,function(){var e,t,n;return o(this,function(i){switch(i.label){case 0:e=this.startBackoff(),i.label=1;case 1:return i.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new skypetoken"),[4,this.skypeTokenProvider(!0)];case 2:return t=i.sent(),this.stopBackoff(e),[2,t];case 3:i.sent(),i.label=4;case 4:return i.trys.push([4,6,,7]),[4,e.delay("Fetching a new skypetoken")];case 5:return i.sent(),[3,8];case 6:throw n=i.sent(),this.stopBackoff(e),n;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})},e.prototype.callRegistrar=function(e,t){return r(this,void 0,void 0,function(){var n,i,r,s,c,l,u,d,p;return o(this,function(o){switch(o.label){case 0:return n=this.startBackoff(),[4,this.skypeTokenProvider(!1)];case 1:i=o.sent(),this.setSkypeTokenHeader(e,i),r=new a.Timespan,o.label=2;case 2:s=void 0,o.label=3;case 3:return o.trys.push([3,8,13,14]),c=e.clone(),[4,this.fetchWithTimeout(c)];case 4:return 401!==(s=o.sent()).status?[3,6]:(l=this.setSkypeTokenHeader,u=[e],[4,this.getSkypeToken()]);case 5:return l.apply(this,u.concat([o.sent()])),[3,15];case 6:if(s.status>=500&&s.status<600)throw new Error("Fetch for '"+e.url+"' failed with "+s.status+" "+s.statusText);o.label=7;case 7:return[3,14];case 8:d=o.sent(),this.logger.error("[RegistrarClient] Request failed with "+d),o.label=9;case 9:return o.trys.push([9,11,,12]),[4,n.delay("Registrar call retry")];case 10:return o.sent(),[3,15];case 11:throw p=o.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(n),p;case 12:return[3,14];case 13:return this.sendTelemetryEvent(t,e,s,r),[7];case 14:if(this.stopBackoff(n),s.ok)return[2,s];throw new Error("Fetch for '"+e.url+"' failed with "+s.status+" "+s.statusText);case 15:return[3,2];case 16:return[2]}})})},e.prototype.setSkypeTokenHeader=function(e,t){e.headers.set("X-Skypetoken",t)},e.prototype.fetchWithTimeout=function(e){var t=this;return new Promise(function(n,i){fetch(e).then(n).catch(i),0!==t.options.requestTimeoutMs&&setTimeout(i,t.options.requestTimeoutMs,new Error("Fetch for '"+e.url+"' timed out"))})},e.prototype.sendTelemetryEvent=function(e,t,n,i){if(void 0!==this.eventLogger){var r={name:e,properties:{url:{value:t.url},result_code:{value:void 0!==n?n.status:0},begin_timestamp:{value:i.startTime},elapsed:{value:i.duration}}};this.eventLogger.logEvent(r)}},e}();t.RegistrarClient=l,t.createRegistrarClient=function(e,t,n){return new l(e,t,n)}}])},function(e,t,n){"use strict";const i={success:/^(2)\d{2}/,redirection:/^(3)\d{2}/,serverError:/^(5)\d{2}/};e.exports=new class{isTransientCheck(e){return this._isTimeout(e)||this._statusCodeMatch(e,i.serverError)}isSuccessCheck(e){return this._statusCodeMatch(e,i.success)||this._statusCodeMatch(e,i.redirection)}_isTimeout(e){return 0===e.status}_statusCodeMatch(e,t){return t.test(e.status.toString())}}},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";var i=n(41);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new i(e),t(n.reason))})}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r(function(t){e=t}),cancel:e}},e.exports=r},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";var i=n(0);e.exports=function(e,t,n){return i.forEach(n,function(n){e=n(e,t)}),e}},function(e,t,n){"use strict";var i=n(0),r=n(78),o=n(42),a=n(27),s=n(77),c=n(76);function l(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return l(e),e.baseURL&&!s(e.url)&&(e.url=c(e.baseURL,e.url)),e.headers=e.headers||{},e.data=r(e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),i.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function(t){return l(e),t.data=r(t.data,t.headers,e.transformResponse),t},function(t){return o(t)||(l(e),t&&t.response&&(t.response.data=r(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,n){"use strict";var i=n(0);function r(){this.handlers=[]}r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=r},function(e,t,n){"use strict";var i=n(0);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,n,r,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),i.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),i.isString(r)&&s.push("path="+r),i.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(){this.message="String contains an invalid character"}r.prototype=new Error,r.prototype.code=5,r.prototype.name="InvalidCharacterError",e.exports=function(e){for(var t,n,o=String(e),a="",s=0,c=i;o.charAt(0|s)||(c="=",s%1);a+=c.charAt(63&t>>8-s%1*8)){if((n=o.charCodeAt(s+=.75))>255)throw new r;t=t<<8|n}return a}},function(e,t,n){"use strict";var i=n(0);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var i=e;return t&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=i.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var i=n(0),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(i.forEach(e.split("\n"),function(e){if(o=e.indexOf(":"),t=i.trim(e.substr(0,o)).toLowerCase(),n=i.trim(e.substr(o+1)),t){if(a[t]&&r.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}}),a):a}},function(e,t,n){"use strict";var i=n(0);function r(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(i.isURLSearchParams(t))o=t.toString();else{var a=[];i.forEach(t,function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),a.push(r(t)+"="+r(e))}))}),o=a.join("&")}return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e}},function(e,t,n){"use strict";e.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e}},function(e,t,n){"use strict";var i=n(43);e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(i("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";var i=n(0);e.exports=function(e,t){i.forEach(e,function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])})}},function(e,t,n){"use strict";var i=n(27),r=n(0),o=n(80),a=n(79);function s(e){this.defaults=e,this.interceptors={request:new o,response:new o}}s.prototype.request=function(e){"string"==typeof e&&(e=r.merge({url:arguments[0]},arguments[1])),(e=r.merge(i,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},r.forEach(["delete","get","head","options"],function(e){s.prototype[e]=function(t,n){return this.request(r.merge(n||{},{method:e,url:t}))}}),r.forEach(["post","put","patch"],function(e){s.prototype[e]=function(t,n,i){return this.request(r.merge(i||{},{method:e,url:t,data:n}))}}),e.exports=s},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,n){"use strict";var i=n(0),r=n(45),o=n(89),a=n(27);function s(e){var t=new o(e),n=r(o.prototype.request,t);return i.extend(n,o.prototype,t),i.extend(n,t),n}var c=s(a);c.Axios=o,c.create=function(e){return s(i.merge(a,e))},c.Cancel=n(41),c.CancelToken=n(75),c.isCancel=n(42),c.all=function(e){return Promise.all(e)},c.spread=n(74),e.exports=c,e.exports.default=c},function(e,t,n){e.exports=n(91)},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};const r=(this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(n(92));e.exports=new class{constructor(){this.isThenable=(e=>e&&e.then&&"function"==typeof e.then)}get(e,t){return this.sendRequest(e,t,"GET")}post(e,t){return this.sendRequest(e,t,"POST")}put(e,t){return this.sendRequest(e,t,"PUT")}remove(e,t){return this.sendRequest(e,t,"DELETE")}sendRequest(e,t,n){return i(this,void 0,void 0,function*(){console.log(`Send request, method: ${n}, URL: ${e}`);const i=Date.now();let o;t.headers=t.headers||{},t.headers["content-type"]||(t.headers["content-type"]=t.contentType||"application/json");const a=r.default.request({url:e,method:n,headers:t.headers||{},timeout:"number"==typeof t.timeout?t.timeout:45e3,data:t.payload||"",responseType:t.responseType||t.dataType||"json",withCredentials:function(e,t){return void 0!==e?e:t}(t.withCredentials,!1),cancelToken:new r.default.CancelToken(e=>{o=e})});this.isThenable(t.timeout)&&t.timeout.then(()=>{console.log("Aborting pending request",e),o()}).catch(()=>{console.log("Timeout promise rejected, ignoring")});try{return{response:(yield a).data,request:(yield a).request,duration:Date.now()-i}}catch(e){throw e.request}})}}},function(e,t,n){"use strict";
/*!
 *  pii.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2017-01-16
 *  Copyright 2017 Microsoft. All rights reserved.
 *
 */Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e},r=!0,o=i,a={},s=0;var c,l=/^([0-9][0-9]?):([^<>\*\{\}&'\"\/\\?^`|~\s]+)$/;!function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.InternalSkype=48]="InternalSkype"}(c||(c={}));var u=[c.Thread,c.InternalSkype,c.Bot];t.enableAnonymization=function(e){r=e},t.useTagger=function(e){o=e||i},function(e){function t(e){return r?e?a[e]||function(e){return a[e]="u"+ ++s}(e):null:e}e.UserName=function(e){var n=t(e);return o(n)},e.Mri=function(e){var n,i=e.match(l);if(i){var r=Number(i[1]),a=i[2];n=-1!=u.indexOf(r)?e:r+":"+t(a)}else n=t(e);return o(n)},e.Omit=function(e){var t;return t=r?"number"==typeof e?19229:"string"==typeof e?e.charAt(0)+"...":null:e,o(t)}}(t.pii||(t.pii={}))},function(e,t,n){"use strict";
/*!
 *  RootToolsManager.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(28),a=n(19),s=n(46),c=o.LogFactory.instance().component("RootToolsManager");o.LogFactory.instance().declareComponentSafe("RootToolsManager",!0);var l;!function(e){e[e.InternalBuild=0]="InternalBuild",e[e.PublicBuild=1]="PublicBuild"}(l=t.BuildType||(t.BuildType={}));var u=l.InternalBuild;function d(e,t){var n=[];for(var i in e)n.push(t(i,e[i]));return n}function p(e,t,n){if(null==e)return null==t||0===t.length;if(null==t)return null==e||0===e.length;if(e.length===t.length){for(var i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}return!1}function f(e,t){return null==e?null==t:null==t?null==e:e.arg===t.arg&&e.op===t.op&&e.value===t.value}function h(e,t){return null==e?null==t||0===t.logId:null==t?null==e||0===e.logId:e.logId===t.logId&&e.name===t.name&&p(e.matchers,t.matchers,f)}function g(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.parsedLevel===t.level}function m(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.level===t.level}function v(e){for(var t=[],n=0;n<e.length;n++)"string"==typeof e[n]||"number"==typeof e[n]?t.push(e[n]):t.push(JSON.stringify(e[n]));return t}t.setBuildType=function(e){var t=u;return u=e,t};var y=function(e){function t(t,n,i){var r=e.call(this)||this;return r._unmetConditions=[],r._rtMan=t,r._triggerCallback=n,r._ecsConfig=i,r.resetConditions(),r}return i(t,e),t.prototype.config=function(){return this._ecsConfig},t.prototype.configEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.mutualSubmissionType===e.mutualSubmissionType&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&this._ecsConfig.experimentTarget===e.experimentTarget&&h(this._ecsConfig.resetCondition,e.resetCondition)&&p(this._ecsConfig.conditions,e.conditions,h)&&p(this._ecsConfig.filters,e.filters,m)},t.prototype.nativeConfigEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&h(this._ecsConfig.resetCondition,e.resetCondition)&&p(this._ecsConfig.conditions,e.conditions,h)&&p(this._ecsConfig.filters,e.filters,g)},t.prototype.needReset=function(e){return!this.configEquals(e)},t.prototype.resetConditions=function(){this._unmetConditions=[];for(var e=0;e<this._ecsConfig.conditions.length;e++)this._unmetConditions.push(e)},t.prototype.matcherMatches=function(e,t){if(e.arg>=t.length)return!1;var n=t[e.arg],i="string"==typeof n?e.value:parseInt(e.value,10);return"="===e.op||"=="===e.op?n===i:"!="===e.op?n!==i:"<"===e.op?n<i:"<="===e.op?n<=i:">"===e.op?n>i:">="===e.op?n>=i:"CONTAINS"===e.op.toUpperCase()&&(""+n).indexOf(e.value)>=0},t.prototype.conditionMatches=function(e,t,n){if(t!==e.logId)return!1;if(e.matchers)for(var i=0;i<e.matchers.length;i++)if(!this.matcherMatches(e.matchers[i],n))return!1;return!0},t.prototype.log=function(e,t,n,i){if(0!==this._unmetConditions.length&&e.component!==c){var r=this._ecsConfig;r.resetCondition&&this.conditionMatches(r.resetCondition,t,i)&&(c.debug4("LogTrigger %s: resetCondition met",r.name),this.resetConditions());for(var o=0;o<this._unmetConditions.length;o++){var a=this._unmetConditions[o];if(this.conditionMatches(r.conditions[a],t,i)){c.debug4("LogTrigger %s: condition %s met",r.name,r.conditions[a].name),this._unmetConditions.splice(o,1);break}}0===this._unmetConditions.length&&(c.debug1("LogTrigger %s has triggered, trying to send the log",r.name),this._triggerCallback.call(this._rtMan,r),r.reenableAfterTriggering&&this.resetConditions())}},t.prototype.receiveAll=function(){return!0},t}(s.AbstractLogAppender),S=function(e){function t(t,n,i){var r=e.call(this)||this;return r._circularBuffer=[],r._circularBufferMaxSize=0,r._onBufferOverflow=null,r._circularBuffer=[],r._circularBufferMaxSize=n,r._includeUnsafe=t,r._onBufferOverflow=i||function(){return r._circularBuffer.shift()},r}return i(t,e),t.prototype.log=function(e,t,n,i){if((this._includeUnsafe||e.component.safe())&&!(this._circularBuffer.length>this._circularBufferMaxSize)){var r={md:e,logId:t,messages:v(i)};this._circularBuffer.push(r),this._circularBuffer.length>this._circularBufferMaxSize&&this._onBufferOverflow()}},t.prototype.visitReverseOrder=function(e){for(var t=this._circularBuffer.length-1;t>=0;t--){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.visitForwardOrder=function(e){for(var t=0;t<this._circularBuffer.length;t++){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.needReset=function(e,t){return e!==this._includeUnsafe||t!==this._circularBufferMaxSize},t.prototype.dumpLogBuffer=function(e,t,n){var i=this,r=new _(e.reverse),o=e.filter.map(function(e){return{component:"root"===e.component?"":e.component,parsedLevel:e.level}}),a=n||{matchedLines:0,totalLines:0};return(e.reverse?this.visitReverseOrder:this.visitForwardOrder).apply(this,[function(e,n,s){return a.totalLines++,i.filterMatches(e,n,s,o)&&(a.matchedLines++,r.log(e.component,e.timestamp,e.level,n,s)),!t||r._data.length<t}]),r.close(),r.data()},t.prototype.filterMatches=function(e,t,n,i){for(var r=0;r<i.length;r++)if((""===i[r].component||e.component.name()===i[r].component||e.component.name().substr(0,i[r].component.length)===i[r].component&&"."===e.component.name().charAt(i[r].component.length))&&e.level>=i[r].parsedLevel)return!0;return!1},t.prototype.clear=function(){this._circularBuffer=[]},t.prototype.size=function(){return this._circularBuffer.length},t.prototype.empty=function(){return 0===this.size()},t.prototype.capacity=function(){return this._circularBufferMaxSize},t}(s.AbstractLogAppender);t.CircularBuffer=S;var _=function(){function e(e){this._reverse=e,this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this._data="ULOG2"+String.fromCharCode(33)+String.fromCharCode(32),this._data+=e?String.fromCharCode(34):String.fromCharCode(32),this._data+=String.fromCharCode(32)}return e.prototype._add8=function(e){if(this._pending.push(255&e),3===this._pending.length){var t=(this._pending[0]<<16)+(this._pending[1]<<8)+(this._pending[2]<<0),n=this._base64chars[t>>18&63]+this._base64chars[t>>12&63]+this._base64chars[t>>6&63]+this._base64chars[t>>0&63];this._data+=n,this._pending=[]}},e.prototype._add16=function(e){this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add32=function(e){this._add8(e>>24&255),this._add8(e>>16&255),this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add64=function(e){this._add32(e/4294967296|0),this._add32(0|e)},e.prototype._addS=function(e){for(var t=0;t<e.length;t++)this._add8(e.charCodeAt(t));this._add8(0)},e.prototype._close=function(){for(;this._pending.length;)this._add8(0)},e.prototype.log=function(e,t,n,i,r){var o=this._components[e.name()];o||(o=++this._componentCount,this._components[e.name()]=o,this._add8(2),this._add16(o),this._addS(e.name()),this._addS(""),this._addS(""),this._add8(e.safe()?1:0));var a=128;this._first&&(a|=2);var s=t-this._lastts;this._lastts=t,s>-128&&s<128&&(a|=1),this._add8(a),1&a?this._add8(s):this._add64(1e3*t),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(o),this._add8(n),this._add32(i),this._add8(r.length);for(var c=0;c<r.length;c++)this._add8(8),this._addS(""+r[c]);this._first=!1},e.prototype.close=function(){this._add8(7),this._close()},e.prototype.data=function(){return this._data},e.prototype.empty=function(){return this._first},e}(),E=function(e){function t(t,n,i,r){var o=e.call(this)||this;return o._capacity=t,o._onBufferOverflow=n,o._enableThrottling=i,o._maxVerbosityLevel=r,o._outputFormatter=new _(!1),o._linesStored=0,o._throttling=!1,o._linesThrottled=0,o}return i(t,e),t.prototype.log=function(e,t,n,i){this._maxVerbosityLevel&&e.level<this._maxVerbosityLevel||(this._throttling?this._linesThrottled++:(this._linesStored++,this._outputFormatter.log(e.component,e.timestamp,e.level,t,v(i))),this._linesStored>this._capacity&&(this._enableThrottling?this._throttling||(this._throttling=!0):this._onBufferOverflow()))},t.prototype.dumpAndReset=function(){if(this._outputFormatter.empty())return"";this._linesThrottled>0&&this._outputFormatter.log(c,(new Date).getTime(),a.LogLevel.Fatal,-1,["RooToolsManager: Log buffer overflow! "+this._linesThrottled+" lines thrown away"]),this._outputFormatter.close();var e=this._outputFormatter.data();return this.clearBuffer(),e},t.prototype.empty=function(){return this._outputFormatter.empty()},t.prototype.clearBuffer=function(){this._outputFormatter=new _(!1),this._linesStored=0,this._linesThrottled=0,this._throttling=!1},t.prototype.capacity=function(){return this._capacity},t.prototype.throttlingEnabled=function(){return this._enableThrottling},t.prototype.size=function(){return this._linesStored},t.prototype.maxVerbosityLevel=function(){return this._maxVerbosityLevel},t}(s.AbstractLogAppender);function T(e){return"Native"===e||"JavaScript"===e||"Mixed"===e}t.DumperBuffer=E;var C=function(){function e(){this._maxUploadSize=0,this._jsToNativeBuffer=null,this._jsToNativeBufferHandle=null,this._jsToNativeFlushTimer=null,this._jsToNativeFlushInterval=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:a.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget="Mixed",this._BRBCallback=null}return e.prototype.setDelegate=function(e){this._glue=e,this.registerListeners()},e.prototype.isDelegateSet=function(){return null!=this._glue},e.prototype.setNativeFunctions=function(e){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=e,this._native&&this._native.log_config.addLogTriggerListener(this)},e.prototype.applyLogLevels=function(){var e={};for(var t in this._localLogLevels)e[t]=this._localLogLevels[t];e[""]=e.root||a.LogLevel.Debug4,delete e.root;var n=d(e,function(e,t){return{component:e,level:t}});n.sort(function(e,t){return e.component.length-t.component.length}),n.forEach(function(e){return o.LogFactory.instance().component(e.component).setLevel(e.level)}),this._native&&this._native.log_config.setLogLevelConfig(n)},e.prototype.setLocalLogLevelConfig=function(e){this._localLogLevels=e,this.applyLogLevels()},e.prototype.parseMatcher=function(e){return null==e||null==e.arg||null==e.op||null==e.value?null:{arg:e.arg,op:e.op,value:e.value}},e.prototype.parseCondition=function(e){if(null==e||null==e.logId)return null;if(e.matchers&&!(e.matchers instanceof Array))return null;var t={name:e.name||function(e){return(4294967296+e).toString(16).substr(-8)}(e.logId),logId:e.logId,matchers:[]};if(e.matchers&&e.matchers.length)for(var n=0,i=e.matchers;n<i.length;n++){var r=i[n],o=this.parseMatcher(r);o&&t.matchers.push(o)}return t},e.prototype.parseFilter=function(e){return null==e||null==e.component||0===e.component.length?null:{component:e.component,level:e.level,parsedLevel:o.LogFactory.levelFromString(e.level)}},e.prototype.parseConfig=function(e,t,n){if(null==e)return null;if(!(e.conditions instanceof Array)||0==e.conditions.length)return null;if(!(e.filters instanceof Array)||0==e.filters.length)return null;if(e.resetCondition&&!this.parseCondition(e.resetCondition))return null;for(var i={name:e.name||t+"->"+n,ecsNs:t,reenableAfterTriggering:e.reenableAfterTriggering||!1,mutualSubmissionType:e.mutualSubmissionType||"",includeUnsafe:u!==l.PublicBuild&&(e.includeUnsafe||!1),experimentTarget:T(e.experimentTarget)&&e.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==e.resetCondition?e.resetCondition:this.parseCondition(e.resetCondition),filters:[]},r=0,o=e.conditions;r<o.length;r++){var a=o[r],s=this.parseCondition(a);s&&i.conditions.push(s)}for(var c=0,d=e.filters;c<d.length;c++){var p=d[c],f=this.parseFilter(p);f&&i.filters.push(f)}return 0===i.conditions.length?null:i},e.prototype.isExperimentListed=function(e,t,n,i){return!!e&&(!(!i||!e.some(function(e){return"*"===e.namespace}))||e.some(function(e){return e.namespace===t&&(e.experiment===n||"*"==e.experiment)}))},e.prototype.isExperimentAllowed=function(e,t,n){return!this.isExperimentListed(e.blacklist,t,n,!0)||this.isExperimentListed(e.whitelist,t,n,!1)},e.prototype.findTrigger=function(e,t){for(var n in e)if(e[n].configEquals(t))return n;return null},e.prototype.findTriggerByNativeConfig=function(e,t){for(var n in e)if(e[n].nativeConfigEquals(t))return n;return null},e.prototype.OnEcsChange=function(){var e=this;return null==this._glue?r.Resolved():this._glue.fetchEcsConfig("SkypeRootTools","ULBaseline").then(function(t){c.debug4("Reloading ULBaseline config - new config: %@",t),t||(c.warn("No ULBaseline config"),t={}),e._maxUploadSize=t.logUpload&&t.logUpload.maxSize||1024;var n=[],i=e._triggers;e._triggers={};var l=(t.logUpload&&t.logUpload.maxSize||1024)/100,u=t.circularBuffer&&t.circularBuffer.enabled,p=t.circularBuffer&&t.circularBuffer.buffers||e._defaultBuffers,f=t.circularBuffer&&t.circularBuffer.storeUnsafe;e._defaultExperimentTarget=T(t.defaultExperimentTarget)&&t.defaultExperimentTarget||"Mixed";var h=t.killswitch||e._defaultKillswitch,g=t.blacklists||e._defaultBlacklists;g.component.length>0&&o.LogFactory.instance().setComponentBlacklist(g.component);var m={};(t.componentLevels||[]).forEach(function(e){return m[e.component]=e.level}),function e(t,n,i){return n<t.length?i(t[n]).then(function(){return e(t,n+1,i)}):r.Resolved()}(t.configPaths||[],0,function(t){return e._glue.fetchEcsConfig(t.ns,t.key).then(function(r){var o=r instanceof Array?r:[r];c.debug4("Reloading ECS config for %s->%s - new config: %@",t.ns,t.key,o);for(var a=0,s=o;a<s.length;a++){var l=s[a];if(null!=l){var d=e.parseConfig(l,t.ns,t.key);if(null!=d)if("JavaScript"===d.experimentTarget||"Mixed"===d.experimentTarget)if(c.debug2("Parsed ECS config for %s->%s - %@",t.ns,t.key,d),e.isExperimentAllowed(h,t.ns,d.name)){c.debug2("Allowing %s->%s:%s according to killswitch",t.ns,t.key,d.name),u=!0;var p=e.findTrigger(i,d);null!=p?(c.debug2("Triggers updated, keeping trigger %s",d.name),e._triggers[p]=i[p],delete i[p]):n.push(d),d.filters&&d.filters.forEach(function(e){return m[e.component]=Math.min(m[e.component]||255,e.parsedLevel)}),d.includeUnsafe&&(f=!0)}else c.debug2("Disallowing %s->%s according to killswitch",t.ns,t.key);else c.debug4("Skipping %s->%s, targeted for %s",t.ns,t.key,d);else c.error("Failed to parse ECS config for %s->%s",t.ns,t.key)}}})}).always(function(){for(var t in e.applyLogLevels(),i)c.debug2("Triggers updated, removing trigger %s",i[t].config().name),o.LogFactory.instance().removeAppender(+t);if(n.forEach(function(t){c.debug2("Triggers updated, adding trigger %s",t.name);var n=new y(e,e._triggered,t),i=o.LogFactory.instance().addAppender(n);e._triggers[String(i)]=n}),m[""]=m.root||a.LogLevel.Debug4,delete m.root,!e._circularBuffer||u&&!e._circularBuffer.needReset(f,l)?e._circularBuffer&&(Object.keys(i).length>0||n.length>0?(c.debug2("Buffer updated, reapplying log levels, removing log levels wrapper"),o.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBufferHandle=null):c.debug2("Buffer updated, no change")):(c.debug2("Buffer updated, removing existing buffer"),o.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBuffer=null,e._circularBufferHandle=null),u&&(e._circularBuffer||(c.debug2("Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)",f,l),e._circularBuffer=new S(f,l)),null==e._circularBufferHandle&&(c.debug2("Creating log level wrapper"),e._circularBufferHandle=o.LogFactory.instance().addAppender(s.wrapAppenderWithLogLevels(e._circularBuffer,m),a.AppenderFlags.InsertFront))),e._native){var r=d(m,function(e,t){return{component:e,level:t}});r.sort(function(e,t){return e.component.length-t.component.length}),e._native.log_config.setLogBufferConfig(u,{storeUnsafe:f,buffers:p},r);var h=[];for(var g in e._triggers){var v=e._triggers[g].config();h.push({name:v.name,ecsNs:v.ecsNs,conditions:v.conditions,resetCondition:v.resetCondition,includeUnsafe:v.includeUnsafe,reenableAfterTriggering:v.reenableAfterTriggering,filters:v.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),dumpFile:!1,metadata:{}})}e._native.log_config.setLogTriggerConfig(h,{})}})})},e.prototype._send=function(e,t){null!=this._glue&&(this._glue.sendTelemetry("638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104",{logTriggerName:e.name,logEcsNs:e.ecsNs,logdata:t}),c.debug4("LogSender::send, sent %d bytes",t.length))},e.prototype.triggered=function(e,t){},e.prototype.triggeredPartially=function(e,t,n,i,r){var a=this.findTriggerByNativeConfig(this._triggers,e);if(a){var s={level:t.level,component:o.LogFactory.instance().component(t.component),timestamp:t.timestamp};this._triggers[a].log(s,n,i,r)}},e.prototype.reset=function(e){var t=this.findTriggerByNativeConfig(this._triggers,e);t&&this._triggers[t].resetConditions()},e.prototype.dumpLogBuffer=function(e,t){if(this._circularBuffer){var n={matchedLines:0,totalLines:0},i=this._circularBuffer.dumpLogBuffer(e,this._maxUploadSize,n);if(c.debug4("dumpLogBuffer: dumped %d of %d lines, size of payload: %d",n.matchedLines,n.totalLines,null!=i?i.length:0),this._native){var o=r.Defer();return this._native.log_config.mergeAndDumpLogBuffer(i,e,t,function(e){return o.resolve(e)}),o.promise()}return r.Resolved(i)}return c.warn("dumpLogBuffer: no log buffer enabled"),r.Rejected()},e.prototype._triggered=function(e){var t=this,n={compression:a.LogFileCompression.Compress,encoding:a.LogFileEncoding.Base64,encryption:a.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},i={includeUnsafe:e.includeUnsafe,filter:e.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),reverse:!0};this.dumpLogBuffer(i,n).then(function(n){return t._send(e,n)})},e.prototype.sendBRBEvent=function(e){try{if(c.debug2("sendBRBEvent %s",JSON.stringify(e)),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var t={eventType:"uploadBRB",mutualSubmissionType:"call",payload:e};this._glue.sendLoggingEventToNative(JSON.stringify(t),"")}}catch(e){c.error("sendBRBEvent %s: %s",e.name,e.message)}},e.prototype.setBRBCallback=function(e){c.debug2("setBRBCallback"),null!=this._glue?"function"==typeof this._glue.setNativeLoggingEventCallback?this._BRBCallback=e:c.warn("setBRBCallback: RootToolsManagerDelegate missing setNativeLoggingEventCallback method"):c.warn("setBRBCallback: RootToolsManagerDelegate is not set")},e.prototype.registerListeners=function(){var e=this;null!=this._glue&&"function"==typeof this._glue.setNativeLoggingEventCallback?this._glue.setNativeLoggingEventCallback(function(t,n){return e.handleNativeLoggingEvent(t,n)}):c.warn("registerListeners: RootToolsManagerDelegate missing setNativeLoggingEventCallback method")},e.prototype.handleNativeLoggingEvent=function(e,t){try{c.debug2("Native Log event message: %s aux: %s",e,t);var n=JSON.parse(e);if(n.eventType&&"uploadBRB"===n.eventType){if("function"!=typeof this._BRBCallback)return void c.warn("BRBCallback not set, ignoring native event");c.debug4("Sending BRB callback: %@",n.payload),this._BRBCallback(n.payload)}else n.eventType&&"jsLogFileConfiguration"===n.eventType&&this.handleLogFileConfigEvent(n)}catch(e){c.error("handleNativeLoggingEvent %s: %s",e.name,e.message)}},e.prototype.handleLogFileConfigEvent=function(e){if(e.payload){var t=e.payload;if(t.enabled){if(t.chunkSize&&t.flushInterval){var n={chunkSize:t.chunkSize,flushInterval:t.flushInterval,enableThrottling:t.enableThrottling,maxVerbosityLevel:t.maxVerbosityLevel};this.startJsToNativeLogging(n)}}else this.flushDisableJsToNativeLogging()}},e.prototype.logExternalForDDL=function(e,t){try{if(c.debug2("logExternalForDDL %s %s",e,t),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var n={eventType:"logInSClog",payload:{message:e,parameters:t}};this._glue.sendLoggingEventToNative(JSON.stringify(n),"")}else c.warn("ignoring logExternalForDDL, delegate misconfigured")}catch(e){c.error("logExternalForDDL %s: %s",e.name,e.message)}},e.prototype.startJsToNativeLogging=function(e){var t=this,n=e.chunkSize,i=e.flushInterval,r=e.enableThrottling,a=this._getVerbosityLevelFromConfig(e.maxVerbosityLevel);if(this._jsToNativeBuffer){if(this._jsToNativeBuffer.capacity()===n&&this._jsToNativeFlushInterval===i&&this._jsToNativeBuffer.throttlingEnabled()===r&&this._jsToNativeBuffer.maxVerbosityLevel()===a)return void c.debug1("Same JS2Native settings received - doing nothing");c.debug1("Reapplying js to native settings"),this.flushDisableJsToNativeLogging()}this._jsToNativeBuffer=new E(n,function(){t.onJsToNativeBufferReady(t._jsToNativeBuffer)},r,a),this.setJsToNativeFlushTimeout(i),this._jsToNativeFlushInterval=i,this._jsToNativeBufferHandle=o.LogFactory.instance().addAppender(this._jsToNativeBuffer)},e.prototype._getVerbosityLevelFromConfig=function(e){return e?o.LogFactory.levelFromString(e):null},e.prototype.flushDisableJsToNativeLogging=function(){this._jsToNativeBuffer&&this.onJsToNativeBufferReady(this._jsToNativeBuffer),this.plainDisableJsToNativeLogging()},e.prototype.plainDisableJsToNativeLogging=function(){this.clearJsToNativeFlushTimeout(),this._jsToNativeBufferHandle&&(o.LogFactory.instance().removeAppender(this._jsToNativeBufferHandle),this._jsToNativeBufferHandle=0,this._jsToNativeBuffer=null,c.debug1("Disabling forwarding JS logs to native"))},e.prototype.onJsToNativeBufferReady=function(e){null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative?(this.clearJsToNativeFlushTimeout(),this.dumpJsToNativeBuffer(e),this.setJsToNativeFlushTimeout(this._jsToNativeFlushInterval)):this.plainDisableJsToNativeLogging()},e.prototype.dumpJsToNativeBuffer=function(e){if(!e.empty()){var t=e.dumpAndReset();this._glue.sendLoggingEventToNative(JSON.stringify({eventType:"writeLogData"}),t)}},e.prototype.clearJsToNativeFlushTimeout=function(){this._jsToNativeFlushTimer&&(clearTimeout(this._jsToNativeFlushTimer),this._jsToNativeFlushTimer=null)},e.prototype.setJsToNativeFlushTimeout=function(e){var t=this;!this._jsToNativeFlushTimer&&e&&(this._jsToNativeFlushTimer=setTimeout(function(){t._jsToNativeFlushTimer=null,t.onJsToNativeBufferReady(t._jsToNativeBuffer)},e))},e.prototype.stopAsyncOperations=function(){this.flushDisableJsToNativeLogging()},e}();t.RootToolsManager=new C},function(e,t,n){"use strict";
/*!
 *  index.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(19)),i(n(28)),i(n(95)),i(n(46)),i(n(94))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){(function(e,i){var r;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o,a=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",c="Expected a function",l="__lodash_hash_undefined__",u=500,d="__lodash_placeholder__",p=1,f=2,h=4,g=1,m=2,v=1,y=2,S=4,_=8,E=16,T=32,C=64,I=128,A=256,b=512,R=30,O="...",P=800,N=16,M=1,w=2,D=1/0,L=9007199254740991,k=1.7976931348623157e308,x=NaN,F=4294967295,U=F-1,j=F>>>1,H=[["ary",I],["bind",v],["bindKey",y],["curry",_],["curryRight",E],["flip",b],["partial",T],["partialRight",C],["rearg",A]],B="[object Arguments]",G="[object Array]",V="[object AsyncFunction]",W="[object Boolean]",q="[object Date]",K="[object DOMException]",z="[object Error]",J="[object Function]",Y="[object GeneratorFunction]",Q="[object Map]",X="[object Number]",$="[object Null]",Z="[object Object]",ee="[object Proxy]",te="[object RegExp]",ne="[object Set]",ie="[object String]",re="[object Symbol]",oe="[object Undefined]",ae="[object WeakMap]",se="[object WeakSet]",ce="[object ArrayBuffer]",le="[object DataView]",ue="[object Float32Array]",de="[object Float64Array]",pe="[object Int8Array]",fe="[object Int16Array]",he="[object Int32Array]",ge="[object Uint8Array]",me="[object Uint8ClampedArray]",ve="[object Uint16Array]",ye="[object Uint32Array]",Se=/\b__p \+= '';/g,_e=/\b(__p \+=) '' \+/g,Ee=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Te=/&(?:amp|lt|gt|quot|#39);/g,Ce=/[&<>"']/g,Ie=RegExp(Te.source),Ae=RegExp(Ce.source),be=/<%-([\s\S]+?)%>/g,Re=/<%([\s\S]+?)%>/g,Oe=/<%=([\s\S]+?)%>/g,Pe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ne=/^\w*$/,Me=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,we=/[\\^$.*+?()[\]{}|]/g,De=RegExp(we.source),Le=/^\s+|\s+$/g,ke=/^\s+/,xe=/\s+$/,Fe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ue=/\{\n\/\* \[wrapped with (.+)\] \*/,je=/,? & /,He=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Be=/\\(\\)?/g,Ge=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ve=/\w*$/,We=/^[-+]0x[0-9a-f]+$/i,qe=/^0b[01]+$/i,Ke=/^\[object .+?Constructor\]$/,ze=/^0o[0-7]+$/i,Je=/^(?:0|[1-9]\d*)$/,Ye=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Qe=/($^)/,Xe=/['\n\r\u2028\u2029\\]/g,$e="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ze="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",et="[\\ud800-\\udfff]",tt="["+Ze+"]",nt="["+$e+"]",it="\\d+",rt="[\\u2700-\\u27bf]",ot="[a-z\\xdf-\\xf6\\xf8-\\xff]",at="[^\\ud800-\\udfff"+Ze+it+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",st="\\ud83c[\\udffb-\\udfff]",ct="[^\\ud800-\\udfff]",lt="(?:\\ud83c[\\udde6-\\uddff]){2}",ut="[\\ud800-\\udbff][\\udc00-\\udfff]",dt="[A-Z\\xc0-\\xd6\\xd8-\\xde]",pt="(?:"+ot+"|"+at+")",ft="(?:"+dt+"|"+at+")",ht="(?:"+nt+"|"+st+")"+"?",gt="[\\ufe0e\\ufe0f]?"+ht+("(?:\\u200d(?:"+[ct,lt,ut].join("|")+")[\\ufe0e\\ufe0f]?"+ht+")*"),mt="(?:"+[rt,lt,ut].join("|")+")"+gt,vt="(?:"+[ct+nt+"?",nt,lt,ut,et].join("|")+")",yt=RegExp("['â]","g"),St=RegExp(nt,"g"),_t=RegExp(st+"(?="+st+")|"+vt+gt,"g"),Et=RegExp([dt+"?"+ot+"+(?:['â](?:d|ll|m|re|s|t|ve))?(?="+[tt,dt,"$"].join("|")+")",ft+"+(?:['â](?:D|LL|M|RE|S|T|VE))?(?="+[tt,dt+pt,"$"].join("|")+")",dt+"?"+pt+"+(?:['â](?:d|ll|m|re|s|t|ve))?",dt+"+(?:['â](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",it,mt].join("|"),"g"),Tt=RegExp("[\\u200d\\ud800-\\udfff"+$e+"\\ufe0e\\ufe0f]"),Ct=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,It=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],At=-1,bt={};bt[ue]=bt[de]=bt[pe]=bt[fe]=bt[he]=bt[ge]=bt[me]=bt[ve]=bt[ye]=!0,bt[B]=bt[G]=bt[ce]=bt[W]=bt[le]=bt[q]=bt[z]=bt[J]=bt[Q]=bt[X]=bt[Z]=bt[te]=bt[ne]=bt[ie]=bt[ae]=!1;var Rt={};Rt[B]=Rt[G]=Rt[ce]=Rt[le]=Rt[W]=Rt[q]=Rt[ue]=Rt[de]=Rt[pe]=Rt[fe]=Rt[he]=Rt[Q]=Rt[X]=Rt[Z]=Rt[te]=Rt[ne]=Rt[ie]=Rt[re]=Rt[ge]=Rt[me]=Rt[ve]=Rt[ye]=!0,Rt[z]=Rt[J]=Rt[ae]=!1;var Ot={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Pt=parseFloat,Nt=parseInt,Mt="object"==typeof e&&e&&e.Object===Object&&e,wt="object"==typeof self&&self&&self.Object===Object&&self,Dt=Mt||wt||Function("return this")(),Lt="object"==typeof t&&t&&!t.nodeType&&t,kt=Lt&&"object"==typeof i&&i&&!i.nodeType&&i,xt=kt&&kt.exports===Lt,Ft=xt&&Mt.process,Ut=function(){try{var e=kt&&kt.require&&kt.require("util").types;return e||Ft&&Ft.binding&&Ft.binding("util")}catch(e){}}(),jt=Ut&&Ut.isArrayBuffer,Ht=Ut&&Ut.isDate,Bt=Ut&&Ut.isMap,Gt=Ut&&Ut.isRegExp,Vt=Ut&&Ut.isSet,Wt=Ut&&Ut.isTypedArray;function qt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Kt(e,t,n,i){for(var r=-1,o=null==e?0:e.length;++r<o;){var a=e[r];t(i,a,n(a),e)}return i}function zt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}function Jt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Yt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}function Qt(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var a=e[n];t(a,n,e)&&(o[r++]=a)}return o}function Xt(e,t){return!!(null==e?0:e.length)&&cn(e,t,0)>-1}function $t(e,t,n){for(var i=-1,r=null==e?0:e.length;++i<r;)if(n(t,e[i]))return!0;return!1}function Zt(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}function en(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}function tn(e,t,n,i){var r=-1,o=null==e?0:e.length;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}function nn(e,t,n,i){var r=null==e?0:e.length;for(i&&r&&(n=e[--r]);r--;)n=t(n,e[r],r,e);return n}function rn(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}var on=pn("length");function an(e,t,n){var i;return n(e,function(e,n,r){if(t(e,n,r))return i=n,!1}),i}function sn(e,t,n,i){for(var r=e.length,o=n+(i?1:-1);i?o--:++o<r;)if(t(e[o],o,e))return o;return-1}function cn(e,t,n){return t==t?function(e,t,n){var i=n-1,r=e.length;for(;++i<r;)if(e[i]===t)return i;return-1}(e,t,n):sn(e,un,n)}function ln(e,t,n,i){for(var r=n-1,o=e.length;++r<o;)if(i(e[r],t))return r;return-1}function un(e){return e!=e}function dn(e,t){var n=null==e?0:e.length;return n?gn(e,t)/n:x}function pn(e){return function(t){return null==t?o:t[e]}}function fn(e){return function(t){return null==e?o:e[t]}}function hn(e,t,n,i,r){return r(e,function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)}),n}function gn(e,t){for(var n,i=-1,r=e.length;++i<r;){var a=t(e[i]);a!==o&&(n=n===o?a:n+a)}return n}function mn(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function vn(e){return function(t){return e(t)}}function yn(e,t){return Zt(t,function(t){return e[t]})}function Sn(e,t){return e.has(t)}function _n(e,t){for(var n=-1,i=e.length;++n<i&&cn(t,e[n],0)>-1;);return n}function En(e,t){for(var n=e.length;n--&&cn(t,e[n],0)>-1;);return n}var Tn=fn({"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã":"C","Ã§":"c","Ã":"D","Ã°":"d","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã":"N","Ã±":"n","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã":"Ae","Ã¦":"ae","Ã":"Th","Ã¾":"th","Ã":"ss","Ä":"A","Ä":"A","Ä":"A","Ä":"a","Ä":"a","Ä":"a","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"D","Ä":"D","Ä":"d","Ä":"d","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"G","Ä":"G","Ä ":"G","Ä¢":"G","Ä":"g","Ä":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å":"l","Å":"l","Å":"N","Å":"N","Å":"N","Å":"N","Å":"n","Å":"n","Å":"n","Å":"n","Å":"O","Å":"O","Å":"O","Å":"o","Å":"o","Å":"o","Å":"R","Å":"R","Å":"R","Å":"r","Å":"r","Å":"r","Å":"S","Å":"S","Å":"S","Å ":"S","Å":"s","Å":"s","Å":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å":"Oe","Å":"oe","Å":"'n","Å¿":"s"}),Cn=fn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function In(e){return"\\"+Ot[e]}function An(e){return Tt.test(e)}function bn(e){var t=-1,n=Array(e.size);return e.forEach(function(e,i){n[++t]=[i,e]}),n}function Rn(e,t){return function(n){return e(t(n))}}function On(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var a=e[n];a!==t&&a!==d||(e[n]=d,o[r++]=n)}return o}function Pn(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function Nn(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function Mn(e){return An(e)?function(e){var t=_t.lastIndex=0;for(;_t.test(e);)++t;return t}(e):on(e)}function wn(e){return An(e)?function(e){return e.match(_t)||[]}(e):function(e){return e.split("")}(e)}var Dn=fn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Ln=function e(t){var n=(t=null==t?Dt:Ln.defaults(Dt.Object(),t,Ln.pick(Dt,It))).Array,i=t.Date,r=t.Error,$e=t.Function,Ze=t.Math,et=t.Object,tt=t.RegExp,nt=t.String,it=t.TypeError,rt=n.prototype,ot=$e.prototype,at=et.prototype,st=t["__core-js_shared__"],ct=ot.toString,lt=at.hasOwnProperty,ut=0,dt=function(){var e=/[^.]+$/.exec(st&&st.keys&&st.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),pt=at.toString,ft=ct.call(et),ht=Dt._,gt=tt("^"+ct.call(lt).replace(we,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),mt=xt?t.Buffer:o,vt=t.Symbol,_t=t.Uint8Array,Tt=mt?mt.allocUnsafe:o,Ot=Rn(et.getPrototypeOf,et),Mt=et.create,wt=at.propertyIsEnumerable,Lt=rt.splice,kt=vt?vt.isConcatSpreadable:o,Ft=vt?vt.iterator:o,Ut=vt?vt.toStringTag:o,on=function(){try{var e=Uo(et,"defineProperty");return e({},"",{}),e}catch(e){}}(),fn=t.clearTimeout!==Dt.clearTimeout&&t.clearTimeout,kn=i&&i.now!==Dt.Date.now&&i.now,xn=t.setTimeout!==Dt.setTimeout&&t.setTimeout,Fn=Ze.ceil,Un=Ze.floor,jn=et.getOwnPropertySymbols,Hn=mt?mt.isBuffer:o,Bn=t.isFinite,Gn=rt.join,Vn=Rn(et.keys,et),Wn=Ze.max,qn=Ze.min,Kn=i.now,zn=t.parseInt,Jn=Ze.random,Yn=rt.reverse,Qn=Uo(t,"DataView"),Xn=Uo(t,"Map"),$n=Uo(t,"Promise"),Zn=Uo(t,"Set"),ei=Uo(t,"WeakMap"),ti=Uo(et,"create"),ni=ei&&new ei,ii={},ri=ua(Qn),oi=ua(Xn),ai=ua($n),si=ua(Zn),ci=ua(ei),li=vt?vt.prototype:o,ui=li?li.valueOf:o,di=li?li.toString:o;function pi(e){if(Rs(e)&&!ms(e)&&!(e instanceof mi)){if(e instanceof gi)return e;if(lt.call(e,"__wrapped__"))return da(e)}return new gi(e)}var fi=function(){function e(){}return function(t){if(!bs(t))return{};if(Mt)return Mt(t);e.prototype=t;var n=new e;return e.prototype=o,n}}();function hi(){}function gi(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=o}function mi(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=F,this.__views__=[]}function vi(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function yi(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Si(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function _i(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Si;++t<n;)this.add(e[t])}function Ei(e){var t=this.__data__=new yi(e);this.size=t.size}function Ti(e,t){var n=ms(e),i=!n&&gs(e),r=!n&&!i&&_s(e),o=!n&&!i&&!r&&ks(e),a=n||i||r||o,s=a?mn(e.length,nt):[],c=s.length;for(var l in e)!t&&!lt.call(e,l)||a&&("length"==l||r&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||qo(l,c))||s.push(l);return s}function Ci(e){var t=e.length;return t?e[_r(0,t-1)]:o}function Ii(e,t){return sa(to(e),Di(t,0,e.length))}function Ai(e){return sa(to(e))}function bi(e,t,n){(n===o||ps(e[t],n))&&(n!==o||t in e)||Mi(e,t,n)}function Ri(e,t,n){var i=e[t];lt.call(e,t)&&ps(i,n)&&(n!==o||t in e)||Mi(e,t,n)}function Oi(e,t){for(var n=e.length;n--;)if(ps(e[n][0],t))return n;return-1}function Pi(e,t,n,i){return Ui(e,function(e,r,o){t(i,e,n(e),o)}),i}function Ni(e,t){return e&&no(t,ic(t),e)}function Mi(e,t,n){"__proto__"==t&&on?on(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function wi(e,t){for(var i=-1,r=t.length,a=n(r),s=null==e;++i<r;)a[i]=s?o:$s(e,t[i]);return a}function Di(e,t,n){return e==e&&(n!==o&&(e=e<=n?e:n),t!==o&&(e=e>=t?e:t)),e}function Li(e,t,n,i,r,a){var s,c=t&p,l=t&f,u=t&h;if(n&&(s=r?n(e,i,r,a):n(e)),s!==o)return s;if(!bs(e))return e;var d=ms(e);if(d){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&lt.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!c)return to(e,s)}else{var g=Bo(e),m=g==J||g==Y;if(_s(e))return Yr(e,c);if(g==Z||g==B||m&&!r){if(s=l||m?{}:Vo(e),!c)return l?function(e,t){return no(e,Ho(e),t)}(e,function(e,t){return e&&no(t,rc(t),e)}(s,e)):function(e,t){return no(e,jo(e),t)}(e,Ni(s,e))}else{if(!Rt[g])return r?e:{};s=function(e,t,n){var i=e.constructor;switch(t){case ce:return Qr(e);case W:case q:return new i(+e);case le:return function(e,t){var n=t?Qr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case ue:case de:case pe:case fe:case he:case ge:case me:case ve:case ye:return Xr(e,n);case Q:return new i;case X:case ie:return new i(e);case te:return function(e){var t=new e.constructor(e.source,Ve.exec(e));return t.lastIndex=e.lastIndex,t}(e);case ne:return new i;case re:return function(e){return ui?et(ui.call(e)):{}}(e)}}(e,g,c)}}a||(a=new Ei);var v=a.get(e);if(v)return v;a.set(e,s),ws(e)?e.forEach(function(i){s.add(Li(i,t,n,i,e,a))}):Os(e)&&e.forEach(function(i,r){s.set(r,Li(i,t,n,r,e,a))});var y=d?o:(u?l?Mo:No:l?rc:ic)(e);return zt(y||e,function(i,r){y&&(i=e[r=i]),Ri(s,r,Li(i,t,n,r,e,a))}),s}function ki(e,t,n){var i=n.length;if(null==e)return!i;for(e=et(e);i--;){var r=n[i],a=t[r],s=e[r];if(s===o&&!(r in e)||!a(s))return!1}return!0}function xi(e,t,n){if("function"!=typeof e)throw new it(c);return ia(function(){e.apply(o,n)},t)}function Fi(e,t,n,i){var r=-1,o=Xt,s=!0,c=e.length,l=[],u=t.length;if(!c)return l;n&&(t=Zt(t,vn(n))),i?(o=$t,s=!1):t.length>=a&&(o=Sn,s=!1,t=new _i(t));e:for(;++r<c;){var d=e[r],p=null==n?d:n(d);if(d=i||0!==d?d:0,s&&p==p){for(var f=u;f--;)if(t[f]===p)continue e;l.push(d)}else o(t,p,i)||l.push(d)}return l}pi.templateSettings={escape:be,evaluate:Re,interpolate:Oe,variable:"",imports:{_:pi}},pi.prototype=hi.prototype,pi.prototype.constructor=pi,gi.prototype=fi(hi.prototype),gi.prototype.constructor=gi,mi.prototype=fi(hi.prototype),mi.prototype.constructor=mi,vi.prototype.clear=function(){this.__data__=ti?ti(null):{},this.size=0},vi.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},vi.prototype.get=function(e){var t=this.__data__;if(ti){var n=t[e];return n===l?o:n}return lt.call(t,e)?t[e]:o},vi.prototype.has=function(e){var t=this.__data__;return ti?t[e]!==o:lt.call(t,e)},vi.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ti&&t===o?l:t,this},yi.prototype.clear=function(){this.__data__=[],this.size=0},yi.prototype.delete=function(e){var t=this.__data__,n=Oi(t,e);return!(n<0||(n==t.length-1?t.pop():Lt.call(t,n,1),--this.size,0))},yi.prototype.get=function(e){var t=this.__data__,n=Oi(t,e);return n<0?o:t[n][1]},yi.prototype.has=function(e){return Oi(this.__data__,e)>-1},yi.prototype.set=function(e,t){var n=this.__data__,i=Oi(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},Si.prototype.clear=function(){this.size=0,this.__data__={hash:new vi,map:new(Xn||yi),string:new vi}},Si.prototype.delete=function(e){var t=xo(this,e).delete(e);return this.size-=t?1:0,t},Si.prototype.get=function(e){return xo(this,e).get(e)},Si.prototype.has=function(e){return xo(this,e).has(e)},Si.prototype.set=function(e,t){var n=xo(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},_i.prototype.add=_i.prototype.push=function(e){return this.__data__.set(e,l),this},_i.prototype.has=function(e){return this.__data__.has(e)},Ei.prototype.clear=function(){this.__data__=new yi,this.size=0},Ei.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ei.prototype.get=function(e){return this.__data__.get(e)},Ei.prototype.has=function(e){return this.__data__.has(e)},Ei.prototype.set=function(e,t){var n=this.__data__;if(n instanceof yi){var i=n.__data__;if(!Xn||i.length<a-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new Si(i)}return n.set(e,t),this.size=n.size,this};var Ui=oo(Ki),ji=oo(zi,!0);function Hi(e,t){var n=!0;return Ui(e,function(e,i,r){return n=!!t(e,i,r)}),n}function Bi(e,t,n){for(var i=-1,r=e.length;++i<r;){var a=e[i],s=t(a);if(null!=s&&(c===o?s==s&&!Ls(s):n(s,c)))var c=s,l=a}return l}function Gi(e,t){var n=[];return Ui(e,function(e,i,r){t(e,i,r)&&n.push(e)}),n}function Vi(e,t,n,i,r){var o=-1,a=e.length;for(n||(n=Wo),r||(r=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?Vi(s,t-1,n,i,r):en(r,s):i||(r[r.length]=s)}return r}var Wi=ao(),qi=ao(!0);function Ki(e,t){return e&&Wi(e,t,ic)}function zi(e,t){return e&&qi(e,t,ic)}function Ji(e,t){return Qt(t,function(t){return Cs(e[t])})}function Yi(e,t){for(var n=0,i=(t=qr(t,e)).length;null!=e&&n<i;)e=e[la(t[n++])];return n&&n==i?e:o}function Qi(e,t,n){var i=t(e);return ms(e)?i:en(i,n(e))}function Xi(e){return null==e?e===o?oe:$:Ut&&Ut in et(e)?function(e){var t=lt.call(e,Ut),n=e[Ut];try{e[Ut]=o;var i=!0}catch(e){}var r=pt.call(e);return i&&(t?e[Ut]=n:delete e[Ut]),r}(e):function(e){return pt.call(e)}(e)}function $i(e,t){return e>t}function Zi(e,t){return null!=e&&lt.call(e,t)}function er(e,t){return null!=e&&t in et(e)}function tr(e,t,i){for(var r=i?$t:Xt,a=e[0].length,s=e.length,c=s,l=n(s),u=1/0,d=[];c--;){var p=e[c];c&&t&&(p=Zt(p,vn(t))),u=qn(p.length,u),l[c]=!i&&(t||a>=120&&p.length>=120)?new _i(c&&p):o}p=e[0];var f=-1,h=l[0];e:for(;++f<a&&d.length<u;){var g=p[f],m=t?t(g):g;if(g=i||0!==g?g:0,!(h?Sn(h,m):r(d,m,i))){for(c=s;--c;){var v=l[c];if(!(v?Sn(v,m):r(e[c],m,i)))continue e}h&&h.push(m),d.push(g)}}return d}function nr(e,t,n){var i=null==(e=ea(e,t=qr(t,e)))?e:e[la(Ta(t))];return null==i?o:qt(i,e,n)}function ir(e){return Rs(e)&&Xi(e)==B}function rr(e,t,n,i,r){return e===t||(null==e||null==t||!Rs(e)&&!Rs(t)?e!=e&&t!=t:function(e,t,n,i,r,a){var s=ms(e),c=ms(t),l=s?G:Bo(e),u=c?G:Bo(t),d=(l=l==B?Z:l)==Z,p=(u=u==B?Z:u)==Z,f=l==u;if(f&&_s(e)){if(!_s(t))return!1;s=!0,d=!1}if(f&&!d)return a||(a=new Ei),s||ks(e)?Oo(e,t,n,i,r,a):function(e,t,n,i,r,o,a){switch(n){case le:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ce:return!(e.byteLength!=t.byteLength||!o(new _t(e),new _t(t)));case W:case q:case X:return ps(+e,+t);case z:return e.name==t.name&&e.message==t.message;case te:case ie:return e==t+"";case Q:var s=bn;case ne:var c=i&g;if(s||(s=Pn),e.size!=t.size&&!c)return!1;var l=a.get(e);if(l)return l==t;i|=m,a.set(e,t);var u=Oo(s(e),s(t),i,r,o,a);return a.delete(e),u;case re:if(ui)return ui.call(e)==ui.call(t)}return!1}(e,t,l,n,i,r,a);if(!(n&g)){var h=d&&lt.call(e,"__wrapped__"),v=p&&lt.call(t,"__wrapped__");if(h||v){var y=h?e.value():e,S=v?t.value():t;return a||(a=new Ei),r(y,S,n,i,a)}}return!!f&&(a||(a=new Ei),function(e,t,n,i,r,a){var s=n&g,c=No(e),l=c.length,u=No(t).length;if(l!=u&&!s)return!1;for(var d=l;d--;){var p=c[d];if(!(s?p in t:lt.call(t,p)))return!1}var f=a.get(e),h=a.get(t);if(f&&h)return f==t&&h==e;var m=!0;a.set(e,t),a.set(t,e);for(var v=s;++d<l;){p=c[d];var y=e[p],S=t[p];if(i)var _=s?i(S,y,p,t,e,a):i(y,S,p,e,t,a);if(!(_===o?y===S||r(y,S,n,i,a):_)){m=!1;break}v||(v="constructor"==p)}if(m&&!v){var E=e.constructor,T=t.constructor;E!=T&&"constructor"in e&&"constructor"in t&&!("function"==typeof E&&E instanceof E&&"function"==typeof T&&T instanceof T)&&(m=!1)}return a.delete(e),a.delete(t),m}(e,t,n,i,r,a))}(e,t,n,i,rr,r))}function or(e,t,n,i){var r=n.length,a=r,s=!i;if(null==e)return!a;for(e=et(e);r--;){var c=n[r];if(s&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++r<a;){var l=(c=n[r])[0],u=e[l],d=c[1];if(s&&c[2]){if(u===o&&!(l in e))return!1}else{var p=new Ei;if(i)var f=i(u,d,l,e,t,p);if(!(f===o?rr(d,u,g|m,i,p):f))return!1}}return!0}function ar(e){return!(!bs(e)||function(e){return!!dt&&dt in e}(e))&&(Cs(e)?gt:Ke).test(ua(e))}function sr(e){return"function"==typeof e?e:null==e?Pc:"object"==typeof e?ms(e)?fr(e[0],e[1]):pr(e):Uc(e)}function cr(e){if(!Qo(e))return Vn(e);var t=[];for(var n in et(e))lt.call(e,n)&&"constructor"!=n&&t.push(n);return t}function lr(e){if(!bs(e))return function(e){var t=[];if(null!=e)for(var n in et(e))t.push(n);return t}(e);var t=Qo(e),n=[];for(var i in e)("constructor"!=i||!t&&lt.call(e,i))&&n.push(i);return n}function ur(e,t){return e<t}function dr(e,t){var i=-1,r=ys(e)?n(e.length):[];return Ui(e,function(e,n,o){r[++i]=t(e,n,o)}),r}function pr(e){var t=Fo(e);return 1==t.length&&t[0][2]?$o(t[0][0],t[0][1]):function(n){return n===e||or(n,e,t)}}function fr(e,t){return zo(e)&&Xo(t)?$o(la(e),t):function(n){var i=$s(n,e);return i===o&&i===t?Zs(n,e):rr(t,i,g|m)}}function hr(e,t,n,i,r){e!==t&&Wi(t,function(a,s){if(r||(r=new Ei),bs(a))!function(e,t,n,i,r,a,s){var c=ta(e,n),l=ta(t,n),u=s.get(l);if(u)bi(e,n,u);else{var d=a?a(c,l,n+"",e,t,s):o,p=d===o;if(p){var f=ms(l),h=!f&&_s(l),g=!f&&!h&&ks(l);d=l,f||h||g?ms(c)?d=c:Ss(c)?d=to(c):h?(p=!1,d=Yr(l,!0)):g?(p=!1,d=Xr(l,!0)):d=[]:Ns(l)||gs(l)?(d=c,gs(c)?d=Vs(c):bs(c)&&!Cs(c)||(d=Vo(l))):p=!1}p&&(s.set(l,d),r(d,l,i,a,s),s.delete(l)),bi(e,n,d)}}(e,t,s,n,hr,i,r);else{var c=i?i(ta(e,s),a,s+"",e,t,r):o;c===o&&(c=a),bi(e,s,c)}},rc)}function gr(e,t){var n=e.length;if(n)return qo(t+=t<0?n:0,n)?e[t]:o}function mr(e,t,n){t=t.length?Zt(t,function(e){return ms(e)?function(t){return Yi(t,1===e.length?e[0]:e)}:e}):[Pc];var i=-1;return t=Zt(t,vn(ko())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(dr(e,function(e,n,r){return{criteria:Zt(t,function(t){return t(e)}),index:++i,value:e}}),function(e,t){return function(e,t,n){for(var i=-1,r=e.criteria,o=t.criteria,a=r.length,s=n.length;++i<a;){var c=$r(r[i],o[i]);if(c){if(i>=s)return c;var l=n[i];return c*("desc"==l?-1:1)}}return e.index-t.index}(e,t,n)})}function vr(e,t,n){for(var i=-1,r=t.length,o={};++i<r;){var a=t[i],s=Yi(e,a);n(s,a)&&Ar(o,qr(a,e),s)}return o}function yr(e,t,n,i){var r=i?ln:cn,o=-1,a=t.length,s=e;for(e===t&&(t=to(t)),n&&(s=Zt(e,vn(n)));++o<a;)for(var c=0,l=t[o],u=n?n(l):l;(c=r(s,u,c,i))>-1;)s!==e&&Lt.call(s,c,1),Lt.call(e,c,1);return e}function Sr(e,t){for(var n=e?t.length:0,i=n-1;n--;){var r=t[n];if(n==i||r!==o){var o=r;qo(r)?Lt.call(e,r,1):Fr(e,r)}}return e}function _r(e,t){return e+Un(Jn()*(t-e+1))}function Er(e,t){var n="";if(!e||t<1||t>L)return n;do{t%2&&(n+=e),(t=Un(t/2))&&(e+=e)}while(t);return n}function Tr(e,t){return ra(Zo(e,t,Pc),e+"")}function Cr(e){return Ci(pc(e))}function Ir(e,t){var n=pc(e);return sa(n,Di(t,0,n.length))}function Ar(e,t,n,i){if(!bs(e))return e;for(var r=-1,a=(t=qr(t,e)).length,s=a-1,c=e;null!=c&&++r<a;){var l=la(t[r]),u=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(r!=s){var d=c[l];(u=i?i(d,l,c):o)===o&&(u=bs(d)?d:qo(t[r+1])?[]:{})}Ri(c,l,u),c=c[l]}return e}var br=ni?function(e,t){return ni.set(e,t),e}:Pc,Rr=on?function(e,t){return on(e,"toString",{configurable:!0,enumerable:!1,value:bc(t),writable:!0})}:Pc;function Or(e){return sa(pc(e))}function Pr(e,t,i){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(i=i>o?o:i)<0&&(i+=o),o=t>i?0:i-t>>>0,t>>>=0;for(var a=n(o);++r<o;)a[r]=e[r+t];return a}function Nr(e,t){var n;return Ui(e,function(e,i,r){return!(n=t(e,i,r))}),!!n}function Mr(e,t,n){var i=0,r=null==e?i:e.length;if("number"==typeof t&&t==t&&r<=j){for(;i<r;){var o=i+r>>>1,a=e[o];null!==a&&!Ls(a)&&(n?a<=t:a<t)?i=o+1:r=o}return r}return wr(e,t,Pc,n)}function wr(e,t,n,i){var r=0,a=null==e?0:e.length;if(0===a)return 0;for(var s=(t=n(t))!=t,c=null===t,l=Ls(t),u=t===o;r<a;){var d=Un((r+a)/2),p=n(e[d]),f=p!==o,h=null===p,g=p==p,m=Ls(p);if(s)var v=i||g;else v=u?g&&(i||f):c?g&&f&&(i||!h):l?g&&f&&!h&&(i||!m):!h&&!m&&(i?p<=t:p<t);v?r=d+1:a=d}return qn(a,U)}function Dr(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var a=e[n],s=t?t(a):a;if(!n||!ps(s,c)){var c=s;o[r++]=0===a?0:a}}return o}function Lr(e){return"number"==typeof e?e:Ls(e)?x:+e}function kr(e){if("string"==typeof e)return e;if(ms(e))return Zt(e,kr)+"";if(Ls(e))return di?di.call(e):"";var t=e+"";return"0"==t&&1/e==-D?"-0":t}function xr(e,t,n){var i=-1,r=Xt,o=e.length,s=!0,c=[],l=c;if(n)s=!1,r=$t;else if(o>=a){var u=t?null:To(e);if(u)return Pn(u);s=!1,r=Sn,l=new _i}else l=t?[]:c;e:for(;++i<o;){var d=e[i],p=t?t(d):d;if(d=n||0!==d?d:0,s&&p==p){for(var f=l.length;f--;)if(l[f]===p)continue e;t&&l.push(p),c.push(d)}else r(l,p,n)||(l!==c&&l.push(p),c.push(d))}return c}function Fr(e,t){return null==(e=ea(e,t=qr(t,e)))||delete e[la(Ta(t))]}function Ur(e,t,n,i){return Ar(e,t,n(Yi(e,t)),i)}function jr(e,t,n,i){for(var r=e.length,o=i?r:-1;(i?o--:++o<r)&&t(e[o],o,e););return n?Pr(e,i?0:o,i?o+1:r):Pr(e,i?o+1:0,i?r:o)}function Hr(e,t){var n=e;return n instanceof mi&&(n=n.value()),tn(t,function(e,t){return t.func.apply(t.thisArg,en([e],t.args))},n)}function Br(e,t,i){var r=e.length;if(r<2)return r?xr(e[0]):[];for(var o=-1,a=n(r);++o<r;)for(var s=e[o],c=-1;++c<r;)c!=o&&(a[o]=Fi(a[o]||s,e[c],t,i));return xr(Vi(a,1),t,i)}function Gr(e,t,n){for(var i=-1,r=e.length,a=t.length,s={};++i<r;){var c=i<a?t[i]:o;n(s,e[i],c)}return s}function Vr(e){return Ss(e)?e:[]}function Wr(e){return"function"==typeof e?e:Pc}function qr(e,t){return ms(e)?e:zo(e,t)?[e]:ca(Ws(e))}var Kr=Tr;function zr(e,t,n){var i=e.length;return n=n===o?i:n,!t&&n>=i?e:Pr(e,t,n)}var Jr=fn||function(e){return Dt.clearTimeout(e)};function Yr(e,t){if(t)return e.slice();var n=e.length,i=Tt?Tt(n):new e.constructor(n);return e.copy(i),i}function Qr(e){var t=new e.constructor(e.byteLength);return new _t(t).set(new _t(e)),t}function Xr(e,t){var n=t?Qr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function $r(e,t){if(e!==t){var n=e!==o,i=null===e,r=e==e,a=Ls(e),s=t!==o,c=null===t,l=t==t,u=Ls(t);if(!c&&!u&&!a&&e>t||a&&s&&l&&!c&&!u||i&&s&&l||!n&&l||!r)return 1;if(!i&&!a&&!u&&e<t||u&&n&&r&&!i&&!a||c&&n&&r||!s&&r||!l)return-1}return 0}function Zr(e,t,i,r){for(var o=-1,a=e.length,s=i.length,c=-1,l=t.length,u=Wn(a-s,0),d=n(l+u),p=!r;++c<l;)d[c]=t[c];for(;++o<s;)(p||o<a)&&(d[i[o]]=e[o]);for(;u--;)d[c++]=e[o++];return d}function eo(e,t,i,r){for(var o=-1,a=e.length,s=-1,c=i.length,l=-1,u=t.length,d=Wn(a-c,0),p=n(d+u),f=!r;++o<d;)p[o]=e[o];for(var h=o;++l<u;)p[h+l]=t[l];for(;++s<c;)(f||o<a)&&(p[h+i[s]]=e[o++]);return p}function to(e,t){var i=-1,r=e.length;for(t||(t=n(r));++i<r;)t[i]=e[i];return t}function no(e,t,n,i){var r=!n;n||(n={});for(var a=-1,s=t.length;++a<s;){var c=t[a],l=i?i(n[c],e[c],c,n,e):o;l===o&&(l=e[c]),r?Mi(n,c,l):Ri(n,c,l)}return n}function io(e,t){return function(n,i){var r=ms(n)?Kt:Pi,o=t?t():{};return r(n,e,ko(i,2),o)}}function ro(e){return Tr(function(t,n){var i=-1,r=n.length,a=r>1?n[r-1]:o,s=r>2?n[2]:o;for(a=e.length>3&&"function"==typeof a?(r--,a):o,s&&Ko(n[0],n[1],s)&&(a=r<3?o:a,r=1),t=et(t);++i<r;){var c=n[i];c&&e(t,c,i,a)}return t})}function oo(e,t){return function(n,i){if(null==n)return n;if(!ys(n))return e(n,i);for(var r=n.length,o=t?r:-1,a=et(n);(t?o--:++o<r)&&!1!==i(a[o],o,a););return n}}function ao(e){return function(t,n,i){for(var r=-1,o=et(t),a=i(t),s=a.length;s--;){var c=a[e?s:++r];if(!1===n(o[c],c,o))break}return t}}function so(e){return function(t){var n=An(t=Ws(t))?wn(t):o,i=n?n[0]:t.charAt(0),r=n?zr(n,1).join(""):t.slice(1);return i[e]()+r}}function co(e){return function(t){return tn(Cc(gc(t).replace(yt,"")),e,"")}}function lo(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=fi(e.prototype),i=e.apply(n,t);return bs(i)?i:n}}function uo(e){return function(t,n,i){var r=et(t);if(!ys(t)){var a=ko(n,3);t=ic(t),n=function(e){return a(r[e],e,r)}}var s=e(t,n,i);return s>-1?r[a?t[s]:s]:o}}function po(e){return Po(function(t){var n=t.length,i=n,r=gi.prototype.thru;for(e&&t.reverse();i--;){var a=t[i];if("function"!=typeof a)throw new it(c);if(r&&!s&&"wrapper"==Do(a))var s=new gi([],!0)}for(i=s?i:n;++i<n;){var l=Do(a=t[i]),u="wrapper"==l?wo(a):o;s=u&&Jo(u[0])&&u[1]==(I|_|T|A)&&!u[4].length&&1==u[9]?s[Do(u[0])].apply(s,u[3]):1==a.length&&Jo(a)?s[l]():s.thru(a)}return function(){var e=arguments,i=e[0];if(s&&1==e.length&&ms(i))return s.plant(i).value();for(var r=0,o=n?t[r].apply(this,e):i;++r<n;)o=t[r].call(this,o);return o}})}function fo(e,t,i,r,a,s,c,l,u,d){var p=t&I,f=t&v,h=t&y,g=t&(_|E),m=t&b,S=h?o:lo(e);return function v(){for(var y=arguments.length,_=n(y),E=y;E--;)_[E]=arguments[E];if(g)var T=Lo(v),C=function(e,t){for(var n=e.length,i=0;n--;)e[n]===t&&++i;return i}(_,T);if(r&&(_=Zr(_,r,a,g)),s&&(_=eo(_,s,c,g)),y-=C,g&&y<d){var I=On(_,T);return _o(e,t,fo,v.placeholder,i,_,I,l,u,d-y)}var A=f?i:this,b=h?A[e]:e;return y=_.length,l?_=function(e,t){for(var n=e.length,i=qn(t.length,n),r=to(e);i--;){var a=t[i];e[i]=qo(a,n)?r[a]:o}return e}(_,l):m&&y>1&&_.reverse(),p&&u<y&&(_.length=u),this&&this!==Dt&&this instanceof v&&(b=S||lo(b)),b.apply(A,_)}}function ho(e,t){return function(n,i){return function(e,t,n,i){return Ki(e,function(e,r,o){t(i,n(e),r,o)}),i}(n,e,t(i),{})}}function go(e,t){return function(n,i){var r;if(n===o&&i===o)return t;if(n!==o&&(r=n),i!==o){if(r===o)return i;"string"==typeof n||"string"==typeof i?(n=kr(n),i=kr(i)):(n=Lr(n),i=Lr(i)),r=e(n,i)}return r}}function mo(e){return Po(function(t){return t=Zt(t,vn(ko())),Tr(function(n){var i=this;return e(t,function(e){return qt(e,i,n)})})})}function vo(e,t){var n=(t=t===o?" ":kr(t)).length;if(n<2)return n?Er(t,e):t;var i=Er(t,Fn(e/Mn(t)));return An(t)?zr(wn(i),0,e).join(""):i.slice(0,e)}function yo(e){return function(t,i,r){return r&&"number"!=typeof r&&Ko(t,i,r)&&(i=r=o),t=js(t),i===o?(i=t,t=0):i=js(i),function(e,t,i,r){for(var o=-1,a=Wn(Fn((t-e)/(i||1)),0),s=n(a);a--;)s[r?a:++o]=e,e+=i;return s}(t,i,r=r===o?t<i?1:-1:js(r),e)}}function So(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=Gs(t),n=Gs(n)),e(t,n)}}function _o(e,t,n,i,r,a,s,c,l,u){var d=t&_;t|=d?T:C,(t&=~(d?C:T))&S||(t&=~(v|y));var p=[e,t,r,d?a:o,d?s:o,d?o:a,d?o:s,c,l,u],f=n.apply(o,p);return Jo(e)&&na(f,p),f.placeholder=i,oa(f,e,t)}function Eo(e){var t=Ze[e];return function(e,n){if(e=Gs(e),(n=null==n?0:qn(Hs(n),292))&&Bn(e)){var i=(Ws(e)+"e").split("e");return+((i=(Ws(t(i[0]+"e"+(+i[1]+n)))+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}var To=Zn&&1/Pn(new Zn([,-0]))[1]==D?function(e){return new Zn(e)}:Lc;function Co(e){return function(t){var n=Bo(t);return n==Q?bn(t):n==ne?Nn(t):function(e,t){return Zt(t,function(t){return[t,e[t]]})}(t,e(t))}}function Io(e,t,i,r,a,s,l,u){var p=t&y;if(!p&&"function"!=typeof e)throw new it(c);var f=r?r.length:0;if(f||(t&=~(T|C),r=a=o),l=l===o?l:Wn(Hs(l),0),u=u===o?u:Hs(u),f-=a?a.length:0,t&C){var h=r,g=a;r=a=o}var m=p?o:wo(e),b=[e,t,i,r,a,h,g,s,l,u];if(m&&function(e,t){var n=e[1],i=t[1],r=n|i,o=r<(v|y|I),a=i==I&&n==_||i==I&&n==A&&e[7].length<=t[8]||i==(I|A)&&t[7].length<=t[8]&&n==_;if(!o&&!a)return e;i&v&&(e[2]=t[2],r|=n&v?0:S);var s=t[3];if(s){var c=e[3];e[3]=c?Zr(c,s,t[4]):s,e[4]=c?On(e[3],d):t[4]}(s=t[5])&&(c=e[5],e[5]=c?eo(c,s,t[6]):s,e[6]=c?On(e[5],d):t[6]),(s=t[7])&&(e[7]=s),i&I&&(e[8]=null==e[8]?t[8]:qn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=r}(b,m),e=b[0],t=b[1],i=b[2],r=b[3],a=b[4],!(u=b[9]=b[9]===o?p?0:e.length:Wn(b[9]-f,0))&&t&(_|E)&&(t&=~(_|E)),t&&t!=v)R=t==_||t==E?function(e,t,i){var r=lo(e);return function a(){for(var s=arguments.length,c=n(s),l=s,u=Lo(a);l--;)c[l]=arguments[l];var d=s<3&&c[0]!==u&&c[s-1]!==u?[]:On(c,u);return(s-=d.length)<i?_o(e,t,fo,a.placeholder,o,c,d,o,o,i-s):qt(this&&this!==Dt&&this instanceof a?r:e,this,c)}}(e,t,u):t!=T&&t!=(v|T)||a.length?fo.apply(o,b):function(e,t,i,r){var o=t&v,a=lo(e);return function t(){for(var s=-1,c=arguments.length,l=-1,u=r.length,d=n(u+c),p=this&&this!==Dt&&this instanceof t?a:e;++l<u;)d[l]=r[l];for(;c--;)d[l++]=arguments[++s];return qt(p,o?i:this,d)}}(e,t,i,r);else var R=function(e,t,n){var i=t&v,r=lo(e);return function t(){return(this&&this!==Dt&&this instanceof t?r:e).apply(i?n:this,arguments)}}(e,t,i);return oa((m?br:na)(R,b),e,t)}function Ao(e,t,n,i){return e===o||ps(e,at[n])&&!lt.call(i,n)?t:e}function bo(e,t,n,i,r,a){return bs(e)&&bs(t)&&(a.set(t,e),hr(e,t,o,bo,a),a.delete(t)),e}function Ro(e){return Ns(e)?o:e}function Oo(e,t,n,i,r,a){var s=n&g,c=e.length,l=t.length;if(c!=l&&!(s&&l>c))return!1;var u=a.get(e),d=a.get(t);if(u&&d)return u==t&&d==e;var p=-1,f=!0,h=n&m?new _i:o;for(a.set(e,t),a.set(t,e);++p<c;){var v=e[p],y=t[p];if(i)var S=s?i(y,v,p,t,e,a):i(v,y,p,e,t,a);if(S!==o){if(S)continue;f=!1;break}if(h){if(!rn(t,function(e,t){if(!Sn(h,t)&&(v===e||r(v,e,n,i,a)))return h.push(t)})){f=!1;break}}else if(v!==y&&!r(v,y,n,i,a)){f=!1;break}}return a.delete(e),a.delete(t),f}function Po(e){return ra(Zo(e,o,va),e+"")}function No(e){return Qi(e,ic,jo)}function Mo(e){return Qi(e,rc,Ho)}var wo=ni?function(e){return ni.get(e)}:Lc;function Do(e){for(var t=e.name+"",n=ii[t],i=lt.call(ii,t)?n.length:0;i--;){var r=n[i],o=r.func;if(null==o||o==e)return r.name}return t}function Lo(e){return(lt.call(pi,"placeholder")?pi:e).placeholder}function ko(){var e=pi.iteratee||Nc;return e=e===Nc?sr:e,arguments.length?e(arguments[0],arguments[1]):e}function xo(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function Fo(e){for(var t=ic(e),n=t.length;n--;){var i=t[n],r=e[i];t[n]=[i,r,Xo(r)]}return t}function Uo(e,t){var n=function(e,t){return null==e?o:e[t]}(e,t);return ar(n)?n:o}var jo=jn?function(e){return null==e?[]:(e=et(e),Qt(jn(e),function(t){return wt.call(e,t)}))}:Bc,Ho=jn?function(e){for(var t=[];e;)en(t,jo(e)),e=Ot(e);return t}:Bc,Bo=Xi;function Go(e,t,n){for(var i=-1,r=(t=qr(t,e)).length,o=!1;++i<r;){var a=la(t[i]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++i!=r?o:!!(r=null==e?0:e.length)&&As(r)&&qo(a,r)&&(ms(e)||gs(e))}function Vo(e){return"function"!=typeof e.constructor||Qo(e)?{}:fi(Ot(e))}function Wo(e){return ms(e)||gs(e)||!!(kt&&e&&e[kt])}function qo(e,t){var n=typeof e;return!!(t=null==t?L:t)&&("number"==n||"symbol"!=n&&Je.test(e))&&e>-1&&e%1==0&&e<t}function Ko(e,t,n){if(!bs(n))return!1;var i=typeof t;return!!("number"==i?ys(n)&&qo(t,n.length):"string"==i&&t in n)&&ps(n[t],e)}function zo(e,t){if(ms(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ls(e))||Ne.test(e)||!Pe.test(e)||null!=t&&e in et(t)}function Jo(e){var t=Do(e),n=pi[t];if("function"!=typeof n||!(t in mi.prototype))return!1;if(e===n)return!0;var i=wo(n);return!!i&&e===i[0]}(Qn&&Bo(new Qn(new ArrayBuffer(1)))!=le||Xn&&Bo(new Xn)!=Q||$n&&"[object Promise]"!=Bo($n.resolve())||Zn&&Bo(new Zn)!=ne||ei&&Bo(new ei)!=ae)&&(Bo=function(e){var t=Xi(e),n=t==Z?e.constructor:o,i=n?ua(n):"";if(i)switch(i){case ri:return le;case oi:return Q;case ai:return"[object Promise]";case si:return ne;case ci:return ae}return t});var Yo=st?Cs:Gc;function Qo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||at)}function Xo(e){return e==e&&!bs(e)}function $o(e,t){return function(n){return null!=n&&n[e]===t&&(t!==o||e in et(n))}}function Zo(e,t,i){return t=Wn(t===o?e.length-1:t,0),function(){for(var r=arguments,o=-1,a=Wn(r.length-t,0),s=n(a);++o<a;)s[o]=r[t+o];o=-1;for(var c=n(t+1);++o<t;)c[o]=r[o];return c[t]=i(s),qt(e,this,c)}}function ea(e,t){return t.length<2?e:Yi(e,Pr(t,0,-1))}function ta(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var na=aa(br),ia=xn||function(e,t){return Dt.setTimeout(e,t)},ra=aa(Rr);function oa(e,t,n){var i=t+"";return ra(e,function(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(Fe,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return zt(H,function(n){var i="_."+n[0];t&n[1]&&!Xt(e,i)&&e.push(i)}),e.sort()}(function(e){var t=e.match(Ue);return t?t[1].split(je):[]}(i),n)))}function aa(e){var t=0,n=0;return function(){var i=Kn(),r=N-(i-n);if(n=i,r>0){if(++t>=P)return arguments[0]}else t=0;return e.apply(o,arguments)}}function sa(e,t){var n=-1,i=e.length,r=i-1;for(t=t===o?i:t;++n<t;){var a=_r(n,r),s=e[a];e[a]=e[n],e[n]=s}return e.length=t,e}var ca=function(e){var t=as(e,function(e){return n.size===u&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Me,function(e,n,i,r){t.push(i?r.replace(Be,"$1"):n||e)}),t});function la(e){if("string"==typeof e||Ls(e))return e;var t=e+"";return"0"==t&&1/e==-D?"-0":t}function ua(e){if(null!=e){try{return ct.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function da(e){if(e instanceof mi)return e.clone();var t=new gi(e.__wrapped__,e.__chain__);return t.__actions__=to(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var pa=Tr(function(e,t){return Ss(e)?Fi(e,Vi(t,1,Ss,!0)):[]}),fa=Tr(function(e,t){var n=Ta(t);return Ss(n)&&(n=o),Ss(e)?Fi(e,Vi(t,1,Ss,!0),ko(n,2)):[]}),ha=Tr(function(e,t){var n=Ta(t);return Ss(n)&&(n=o),Ss(e)?Fi(e,Vi(t,1,Ss,!0),o,n):[]});function ga(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:Hs(n);return r<0&&(r=Wn(i+r,0)),sn(e,ko(t,3),r)}function ma(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i-1;return n!==o&&(r=Hs(n),r=n<0?Wn(i+r,0):qn(r,i-1)),sn(e,ko(t,3),r,!0)}function va(e){return null!=e&&e.length?Vi(e,1):[]}function ya(e){return e&&e.length?e[0]:o}var Sa=Tr(function(e){var t=Zt(e,Vr);return t.length&&t[0]===e[0]?tr(t):[]}),_a=Tr(function(e){var t=Ta(e),n=Zt(e,Vr);return t===Ta(n)?t=o:n.pop(),n.length&&n[0]===e[0]?tr(n,ko(t,2)):[]}),Ea=Tr(function(e){var t=Ta(e),n=Zt(e,Vr);return(t="function"==typeof t?t:o)&&n.pop(),n.length&&n[0]===e[0]?tr(n,o,t):[]});function Ta(e){var t=null==e?0:e.length;return t?e[t-1]:o}var Ca=Tr(Ia);function Ia(e,t){return e&&e.length&&t&&t.length?yr(e,t):e}var Aa=Po(function(e,t){var n=null==e?0:e.length,i=wi(e,t);return Sr(e,Zt(t,function(e){return qo(e,n)?+e:e}).sort($r)),i});function ba(e){return null==e?e:Yn.call(e)}var Ra=Tr(function(e){return xr(Vi(e,1,Ss,!0))}),Oa=Tr(function(e){var t=Ta(e);return Ss(t)&&(t=o),xr(Vi(e,1,Ss,!0),ko(t,2))}),Pa=Tr(function(e){var t=Ta(e);return t="function"==typeof t?t:o,xr(Vi(e,1,Ss,!0),o,t)});function Na(e){if(!e||!e.length)return[];var t=0;return e=Qt(e,function(e){if(Ss(e))return t=Wn(e.length,t),!0}),mn(t,function(t){return Zt(e,pn(t))})}function Ma(e,t){if(!e||!e.length)return[];var n=Na(e);return null==t?n:Zt(n,function(e){return qt(t,o,e)})}var wa=Tr(function(e,t){return Ss(e)?Fi(e,t):[]}),Da=Tr(function(e){return Br(Qt(e,Ss))}),La=Tr(function(e){var t=Ta(e);return Ss(t)&&(t=o),Br(Qt(e,Ss),ko(t,2))}),ka=Tr(function(e){var t=Ta(e);return t="function"==typeof t?t:o,Br(Qt(e,Ss),o,t)}),xa=Tr(Na);var Fa=Tr(function(e){var t=e.length,n=t>1?e[t-1]:o;return Ma(e,n="function"==typeof n?(e.pop(),n):o)});function Ua(e){var t=pi(e);return t.__chain__=!0,t}function ja(e,t){return t(e)}var Ha=Po(function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,r=function(t){return wi(t,e)};return!(t>1||this.__actions__.length)&&i instanceof mi&&qo(n)?((i=i.slice(n,+n+(t?1:0))).__actions__.push({func:ja,args:[r],thisArg:o}),new gi(i,this.__chain__).thru(function(e){return t&&!e.length&&e.push(o),e})):this.thru(r)});var Ba=io(function(e,t,n){lt.call(e,n)?++e[n]:Mi(e,n,1)});var Ga=uo(ga),Va=uo(ma);function Wa(e,t){return(ms(e)?zt:Ui)(e,ko(t,3))}function qa(e,t){return(ms(e)?Jt:ji)(e,ko(t,3))}var Ka=io(function(e,t,n){lt.call(e,n)?e[n].push(t):Mi(e,n,[t])});var za=Tr(function(e,t,i){var r=-1,o="function"==typeof t,a=ys(e)?n(e.length):[];return Ui(e,function(e){a[++r]=o?qt(t,e,i):nr(e,t,i)}),a}),Ja=io(function(e,t,n){Mi(e,n,t)});function Ya(e,t){return(ms(e)?Zt:dr)(e,ko(t,3))}var Qa=io(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});var Xa=Tr(function(e,t){if(null==e)return[];var n=t.length;return n>1&&Ko(e,t[0],t[1])?t=[]:n>2&&Ko(t[0],t[1],t[2])&&(t=[t[0]]),mr(e,Vi(t,1),[])}),$a=kn||function(){return Dt.Date.now()};function Za(e,t,n){return t=n?o:t,t=e&&null==t?e.length:t,Io(e,I,o,o,o,o,t)}function es(e,t){var n;if("function"!=typeof t)throw new it(c);return e=Hs(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=o),n}}var ts=Tr(function(e,t,n){var i=v;if(n.length){var r=On(n,Lo(ts));i|=T}return Io(e,i,t,n,r)}),ns=Tr(function(e,t,n){var i=v|y;if(n.length){var r=On(n,Lo(ns));i|=T}return Io(t,i,e,n,r)});function is(e,t,n){var i,r,a,s,l,u,d=0,p=!1,f=!1,h=!0;if("function"!=typeof e)throw new it(c);function g(t){var n=i,a=r;return i=r=o,d=t,s=e.apply(a,n)}function m(e){var n=e-u;return u===o||n>=t||n<0||f&&e-d>=a}function v(){var e=$a();if(m(e))return y(e);l=ia(v,function(e){var n=t-(e-u);return f?qn(n,a-(e-d)):n}(e))}function y(e){return l=o,h&&i?g(e):(i=r=o,s)}function S(){var e=$a(),n=m(e);if(i=arguments,r=this,u=e,n){if(l===o)return function(e){return d=e,l=ia(v,t),p?g(e):s}(u);if(f)return Jr(l),l=ia(v,t),g(u)}return l===o&&(l=ia(v,t)),s}return t=Gs(t)||0,bs(n)&&(p=!!n.leading,a=(f="maxWait"in n)?Wn(Gs(n.maxWait)||0,t):a,h="trailing"in n?!!n.trailing:h),S.cancel=function(){l!==o&&Jr(l),d=0,i=u=r=l=o},S.flush=function(){return l===o?s:y($a())},S}var rs=Tr(function(e,t){return xi(e,1,t)}),os=Tr(function(e,t,n){return xi(e,Gs(t)||0,n)});function as(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new it(c);var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=e.apply(this,i);return n.cache=o.set(r,a)||o,a};return n.cache=new(as.Cache||Si),n}function ss(e){if("function"!=typeof e)throw new it(c);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}as.Cache=Si;var cs=Kr(function(e,t){var n=(t=1==t.length&&ms(t[0])?Zt(t[0],vn(ko())):Zt(Vi(t,1),vn(ko()))).length;return Tr(function(i){for(var r=-1,o=qn(i.length,n);++r<o;)i[r]=t[r].call(this,i[r]);return qt(e,this,i)})}),ls=Tr(function(e,t){var n=On(t,Lo(ls));return Io(e,T,o,t,n)}),us=Tr(function(e,t){var n=On(t,Lo(us));return Io(e,C,o,t,n)}),ds=Po(function(e,t){return Io(e,A,o,o,o,t)});function ps(e,t){return e===t||e!=e&&t!=t}var fs=So($i),hs=So(function(e,t){return e>=t}),gs=ir(function(){return arguments}())?ir:function(e){return Rs(e)&&lt.call(e,"callee")&&!wt.call(e,"callee")},ms=n.isArray,vs=jt?vn(jt):function(e){return Rs(e)&&Xi(e)==ce};function ys(e){return null!=e&&As(e.length)&&!Cs(e)}function Ss(e){return Rs(e)&&ys(e)}var _s=Hn||Gc,Es=Ht?vn(Ht):function(e){return Rs(e)&&Xi(e)==q};function Ts(e){if(!Rs(e))return!1;var t=Xi(e);return t==z||t==K||"string"==typeof e.message&&"string"==typeof e.name&&!Ns(e)}function Cs(e){if(!bs(e))return!1;var t=Xi(e);return t==J||t==Y||t==V||t==ee}function Is(e){return"number"==typeof e&&e==Hs(e)}function As(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=L}function bs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Rs(e){return null!=e&&"object"==typeof e}var Os=Bt?vn(Bt):function(e){return Rs(e)&&Bo(e)==Q};function Ps(e){return"number"==typeof e||Rs(e)&&Xi(e)==X}function Ns(e){if(!Rs(e)||Xi(e)!=Z)return!1;var t=Ot(e);if(null===t)return!0;var n=lt.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ct.call(n)==ft}var Ms=Gt?vn(Gt):function(e){return Rs(e)&&Xi(e)==te};var ws=Vt?vn(Vt):function(e){return Rs(e)&&Bo(e)==ne};function Ds(e){return"string"==typeof e||!ms(e)&&Rs(e)&&Xi(e)==ie}function Ls(e){return"symbol"==typeof e||Rs(e)&&Xi(e)==re}var ks=Wt?vn(Wt):function(e){return Rs(e)&&As(e.length)&&!!bt[Xi(e)]};var xs=So(ur),Fs=So(function(e,t){return e<=t});function Us(e){if(!e)return[];if(ys(e))return Ds(e)?wn(e):to(e);if(Ft&&e[Ft])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Ft]());var t=Bo(e);return(t==Q?bn:t==ne?Pn:pc)(e)}function js(e){return e?(e=Gs(e))===D||e===-D?(e<0?-1:1)*k:e==e?e:0:0===e?e:0}function Hs(e){var t=js(e),n=t%1;return t==t?n?t-n:t:0}function Bs(e){return e?Di(Hs(e),0,F):0}function Gs(e){if("number"==typeof e)return e;if(Ls(e))return x;if(bs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=bs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Le,"");var n=qe.test(e);return n||ze.test(e)?Nt(e.slice(2),n?2:8):We.test(e)?x:+e}function Vs(e){return no(e,rc(e))}function Ws(e){return null==e?"":kr(e)}var qs=ro(function(e,t){if(Qo(t)||ys(t))no(t,ic(t),e);else for(var n in t)lt.call(t,n)&&Ri(e,n,t[n])}),Ks=ro(function(e,t){no(t,rc(t),e)}),zs=ro(function(e,t,n,i){no(t,rc(t),e,i)}),Js=ro(function(e,t,n,i){no(t,ic(t),e,i)}),Ys=Po(wi);var Qs=Tr(function(e,t){e=et(e);var n=-1,i=t.length,r=i>2?t[2]:o;for(r&&Ko(t[0],t[1],r)&&(i=1);++n<i;)for(var a=t[n],s=rc(a),c=-1,l=s.length;++c<l;){var u=s[c],d=e[u];(d===o||ps(d,at[u])&&!lt.call(e,u))&&(e[u]=a[u])}return e}),Xs=Tr(function(e){return e.push(o,bo),qt(ac,o,e)});function $s(e,t,n){var i=null==e?o:Yi(e,t);return i===o?n:i}function Zs(e,t){return null!=e&&Go(e,t,er)}var ec=ho(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=pt.call(t)),e[t]=n},bc(Pc)),tc=ho(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=pt.call(t)),lt.call(e,t)?e[t].push(n):e[t]=[n]},ko),nc=Tr(nr);function ic(e){return ys(e)?Ti(e):cr(e)}function rc(e){return ys(e)?Ti(e,!0):lr(e)}var oc=ro(function(e,t,n){hr(e,t,n)}),ac=ro(function(e,t,n,i){hr(e,t,n,i)}),sc=Po(function(e,t){var n={};if(null==e)return n;var i=!1;t=Zt(t,function(t){return t=qr(t,e),i||(i=t.length>1),t}),no(e,Mo(e),n),i&&(n=Li(n,p|f|h,Ro));for(var r=t.length;r--;)Fr(n,t[r]);return n});var cc=Po(function(e,t){return null==e?{}:function(e,t){return vr(e,t,function(t,n){return Zs(e,n)})}(e,t)});function lc(e,t){if(null==e)return{};var n=Zt(Mo(e),function(e){return[e]});return t=ko(t),vr(e,n,function(e,n){return t(e,n[0])})}var uc=Co(ic),dc=Co(rc);function pc(e){return null==e?[]:yn(e,ic(e))}var fc=co(function(e,t,n){return t=t.toLowerCase(),e+(n?hc(t):t)});function hc(e){return Tc(Ws(e).toLowerCase())}function gc(e){return(e=Ws(e))&&e.replace(Ye,Tn).replace(St,"")}var mc=co(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),vc=co(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),yc=so("toLowerCase");var Sc=co(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});var _c=co(function(e,t,n){return e+(n?" ":"")+Tc(t)});var Ec=co(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Tc=so("toUpperCase");function Cc(e,t,n){return e=Ws(e),(t=n?o:t)===o?function(e){return Ct.test(e)}(e)?function(e){return e.match(Et)||[]}(e):function(e){return e.match(He)||[]}(e):e.match(t)||[]}var Ic=Tr(function(e,t){try{return qt(e,o,t)}catch(e){return Ts(e)?e:new r(e)}}),Ac=Po(function(e,t){return zt(t,function(t){t=la(t),Mi(e,t,ts(e[t],e))}),e});function bc(e){return function(){return e}}var Rc=po(),Oc=po(!0);function Pc(e){return e}function Nc(e){return sr("function"==typeof e?e:Li(e,p))}var Mc=Tr(function(e,t){return function(n){return nr(n,e,t)}}),wc=Tr(function(e,t){return function(n){return nr(e,n,t)}});function Dc(e,t,n){var i=ic(t),r=Ji(t,i);null!=n||bs(t)&&(r.length||!i.length)||(n=t,t=e,e=this,r=Ji(t,ic(t)));var o=!(bs(n)&&"chain"in n&&!n.chain),a=Cs(e);return zt(r,function(n){var i=t[n];e[n]=i,a&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__);return(n.__actions__=to(this.__actions__)).push({func:i,args:arguments,thisArg:e}),n.__chain__=t,n}return i.apply(e,en([this.value()],arguments))})}),e}function Lc(){}var kc=mo(Zt),xc=mo(Yt),Fc=mo(rn);function Uc(e){return zo(e)?pn(la(e)):function(e){return function(t){return Yi(t,e)}}(e)}var jc=yo(),Hc=yo(!0);function Bc(){return[]}function Gc(){return!1}var Vc=go(function(e,t){return e+t},0),Wc=Eo("ceil"),qc=go(function(e,t){return e/t},1),Kc=Eo("floor");var zc=go(function(e,t){return e*t},1),Jc=Eo("round"),Yc=go(function(e,t){return e-t},0);return pi.after=function(e,t){if("function"!=typeof t)throw new it(c);return e=Hs(e),function(){if(--e<1)return t.apply(this,arguments)}},pi.ary=Za,pi.assign=qs,pi.assignIn=Ks,pi.assignInWith=zs,pi.assignWith=Js,pi.at=Ys,pi.before=es,pi.bind=ts,pi.bindAll=Ac,pi.bindKey=ns,pi.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return ms(e)?e:[e]},pi.chain=Ua,pi.chunk=function(e,t,i){t=(i?Ko(e,t,i):t===o)?1:Wn(Hs(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var a=0,s=0,c=n(Fn(r/t));a<r;)c[s++]=Pr(e,a,a+=t);return c},pi.compact=function(e){for(var t=-1,n=null==e?0:e.length,i=0,r=[];++t<n;){var o=e[t];o&&(r[i++]=o)}return r},pi.concat=function(){var e=arguments.length;if(!e)return[];for(var t=n(e-1),i=arguments[0],r=e;r--;)t[r-1]=arguments[r];return en(ms(i)?to(i):[i],Vi(t,1))},pi.cond=function(e){var t=null==e?0:e.length,n=ko();return e=t?Zt(e,function(e){if("function"!=typeof e[1])throw new it(c);return[n(e[0]),e[1]]}):[],Tr(function(n){for(var i=-1;++i<t;){var r=e[i];if(qt(r[0],this,n))return qt(r[1],this,n)}})},pi.conforms=function(e){return function(e){var t=ic(e);return function(n){return ki(n,e,t)}}(Li(e,p))},pi.constant=bc,pi.countBy=Ba,pi.create=function(e,t){var n=fi(e);return null==t?n:Ni(n,t)},pi.curry=function e(t,n,i){var r=Io(t,_,o,o,o,o,o,n=i?o:n);return r.placeholder=e.placeholder,r},pi.curryRight=function e(t,n,i){var r=Io(t,E,o,o,o,o,o,n=i?o:n);return r.placeholder=e.placeholder,r},pi.debounce=is,pi.defaults=Qs,pi.defaultsDeep=Xs,pi.defer=rs,pi.delay=os,pi.difference=pa,pi.differenceBy=fa,pi.differenceWith=ha,pi.drop=function(e,t,n){var i=null==e?0:e.length;return i?Pr(e,(t=n||t===o?1:Hs(t))<0?0:t,i):[]},pi.dropRight=function(e,t,n){var i=null==e?0:e.length;return i?Pr(e,0,(t=i-(t=n||t===o?1:Hs(t)))<0?0:t):[]},pi.dropRightWhile=function(e,t){return e&&e.length?jr(e,ko(t,3),!0,!0):[]},pi.dropWhile=function(e,t){return e&&e.length?jr(e,ko(t,3),!0):[]},pi.fill=function(e,t,n,i){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&Ko(e,t,n)&&(n=0,i=r),function(e,t,n,i){var r=e.length;for((n=Hs(n))<0&&(n=-n>r?0:r+n),(i=i===o||i>r?r:Hs(i))<0&&(i+=r),i=n>i?0:Bs(i);n<i;)e[n++]=t;return e}(e,t,n,i)):[]},pi.filter=function(e,t){return(ms(e)?Qt:Gi)(e,ko(t,3))},pi.flatMap=function(e,t){return Vi(Ya(e,t),1)},pi.flatMapDeep=function(e,t){return Vi(Ya(e,t),D)},pi.flatMapDepth=function(e,t,n){return n=n===o?1:Hs(n),Vi(Ya(e,t),n)},pi.flatten=va,pi.flattenDeep=function(e){return null!=e&&e.length?Vi(e,D):[]},pi.flattenDepth=function(e,t){return null!=e&&e.length?Vi(e,t=t===o?1:Hs(t)):[]},pi.flip=function(e){return Io(e,b)},pi.flow=Rc,pi.flowRight=Oc,pi.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,i={};++t<n;){var r=e[t];i[r[0]]=r[1]}return i},pi.functions=function(e){return null==e?[]:Ji(e,ic(e))},pi.functionsIn=function(e){return null==e?[]:Ji(e,rc(e))},pi.groupBy=Ka,pi.initial=function(e){return null!=e&&e.length?Pr(e,0,-1):[]},pi.intersection=Sa,pi.intersectionBy=_a,pi.intersectionWith=Ea,pi.invert=ec,pi.invertBy=tc,pi.invokeMap=za,pi.iteratee=Nc,pi.keyBy=Ja,pi.keys=ic,pi.keysIn=rc,pi.map=Ya,pi.mapKeys=function(e,t){var n={};return t=ko(t,3),Ki(e,function(e,i,r){Mi(n,t(e,i,r),e)}),n},pi.mapValues=function(e,t){var n={};return t=ko(t,3),Ki(e,function(e,i,r){Mi(n,i,t(e,i,r))}),n},pi.matches=function(e){return pr(Li(e,p))},pi.matchesProperty=function(e,t){return fr(e,Li(t,p))},pi.memoize=as,pi.merge=oc,pi.mergeWith=ac,pi.method=Mc,pi.methodOf=wc,pi.mixin=Dc,pi.negate=ss,pi.nthArg=function(e){return e=Hs(e),Tr(function(t){return gr(t,e)})},pi.omit=sc,pi.omitBy=function(e,t){return lc(e,ss(ko(t)))},pi.once=function(e){return es(2,e)},pi.orderBy=function(e,t,n,i){return null==e?[]:(ms(t)||(t=null==t?[]:[t]),ms(n=i?o:n)||(n=null==n?[]:[n]),mr(e,t,n))},pi.over=kc,pi.overArgs=cs,pi.overEvery=xc,pi.overSome=Fc,pi.partial=ls,pi.partialRight=us,pi.partition=Qa,pi.pick=cc,pi.pickBy=lc,pi.property=Uc,pi.propertyOf=function(e){return function(t){return null==e?o:Yi(e,t)}},pi.pull=Ca,pi.pullAll=Ia,pi.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?yr(e,t,ko(n,2)):e},pi.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?yr(e,t,o,n):e},pi.pullAt=Aa,pi.range=jc,pi.rangeRight=Hc,pi.rearg=ds,pi.reject=function(e,t){return(ms(e)?Qt:Gi)(e,ss(ko(t,3)))},pi.remove=function(e,t){var n=[];if(!e||!e.length)return n;var i=-1,r=[],o=e.length;for(t=ko(t,3);++i<o;){var a=e[i];t(a,i,e)&&(n.push(a),r.push(i))}return Sr(e,r),n},pi.rest=function(e,t){if("function"!=typeof e)throw new it(c);return Tr(e,t=t===o?t:Hs(t))},pi.reverse=ba,pi.sampleSize=function(e,t,n){return t=(n?Ko(e,t,n):t===o)?1:Hs(t),(ms(e)?Ii:Ir)(e,t)},pi.set=function(e,t,n){return null==e?e:Ar(e,t,n)},pi.setWith=function(e,t,n,i){return i="function"==typeof i?i:o,null==e?e:Ar(e,t,n,i)},pi.shuffle=function(e){return(ms(e)?Ai:Or)(e)},pi.slice=function(e,t,n){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&Ko(e,t,n)?(t=0,n=i):(t=null==t?0:Hs(t),n=n===o?i:Hs(n)),Pr(e,t,n)):[]},pi.sortBy=Xa,pi.sortedUniq=function(e){return e&&e.length?Dr(e):[]},pi.sortedUniqBy=function(e,t){return e&&e.length?Dr(e,ko(t,2)):[]},pi.split=function(e,t,n){return n&&"number"!=typeof n&&Ko(e,t,n)&&(t=n=o),(n=n===o?F:n>>>0)?(e=Ws(e))&&("string"==typeof t||null!=t&&!Ms(t))&&!(t=kr(t))&&An(e)?zr(wn(e),0,n):e.split(t,n):[]},pi.spread=function(e,t){if("function"!=typeof e)throw new it(c);return t=null==t?0:Wn(Hs(t),0),Tr(function(n){var i=n[t],r=zr(n,0,t);return i&&en(r,i),qt(e,this,r)})},pi.tail=function(e){var t=null==e?0:e.length;return t?Pr(e,1,t):[]},pi.take=function(e,t,n){return e&&e.length?Pr(e,0,(t=n||t===o?1:Hs(t))<0?0:t):[]},pi.takeRight=function(e,t,n){var i=null==e?0:e.length;return i?Pr(e,(t=i-(t=n||t===o?1:Hs(t)))<0?0:t,i):[]},pi.takeRightWhile=function(e,t){return e&&e.length?jr(e,ko(t,3),!1,!0):[]},pi.takeWhile=function(e,t){return e&&e.length?jr(e,ko(t,3)):[]},pi.tap=function(e,t){return t(e),e},pi.throttle=function(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new it(c);return bs(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),is(e,t,{leading:i,maxWait:t,trailing:r})},pi.thru=ja,pi.toArray=Us,pi.toPairs=uc,pi.toPairsIn=dc,pi.toPath=function(e){return ms(e)?Zt(e,la):Ls(e)?[e]:to(ca(Ws(e)))},pi.toPlainObject=Vs,pi.transform=function(e,t,n){var i=ms(e),r=i||_s(e)||ks(e);if(t=ko(t,4),null==n){var o=e&&e.constructor;n=r?i?new o:[]:bs(e)&&Cs(o)?fi(Ot(e)):{}}return(r?zt:Ki)(e,function(e,i,r){return t(n,e,i,r)}),n},pi.unary=function(e){return Za(e,1)},pi.union=Ra,pi.unionBy=Oa,pi.unionWith=Pa,pi.uniq=function(e){return e&&e.length?xr(e):[]},pi.uniqBy=function(e,t){return e&&e.length?xr(e,ko(t,2)):[]},pi.uniqWith=function(e,t){return t="function"==typeof t?t:o,e&&e.length?xr(e,o,t):[]},pi.unset=function(e,t){return null==e||Fr(e,t)},pi.unzip=Na,pi.unzipWith=Ma,pi.update=function(e,t,n){return null==e?e:Ur(e,t,Wr(n))},pi.updateWith=function(e,t,n,i){return i="function"==typeof i?i:o,null==e?e:Ur(e,t,Wr(n),i)},pi.values=pc,pi.valuesIn=function(e){return null==e?[]:yn(e,rc(e))},pi.without=wa,pi.words=Cc,pi.wrap=function(e,t){return ls(Wr(t),e)},pi.xor=Da,pi.xorBy=La,pi.xorWith=ka,pi.zip=xa,pi.zipObject=function(e,t){return Gr(e||[],t||[],Ri)},pi.zipObjectDeep=function(e,t){return Gr(e||[],t||[],Ar)},pi.zipWith=Fa,pi.entries=uc,pi.entriesIn=dc,pi.extend=Ks,pi.extendWith=zs,Dc(pi,pi),pi.add=Vc,pi.attempt=Ic,pi.camelCase=fc,pi.capitalize=hc,pi.ceil=Wc,pi.clamp=function(e,t,n){return n===o&&(n=t,t=o),n!==o&&(n=(n=Gs(n))==n?n:0),t!==o&&(t=(t=Gs(t))==t?t:0),Di(Gs(e),t,n)},pi.clone=function(e){return Li(e,h)},pi.cloneDeep=function(e){return Li(e,p|h)},pi.cloneDeepWith=function(e,t){return Li(e,p|h,t="function"==typeof t?t:o)},pi.cloneWith=function(e,t){return Li(e,h,t="function"==typeof t?t:o)},pi.conformsTo=function(e,t){return null==t||ki(e,t,ic(t))},pi.deburr=gc,pi.defaultTo=function(e,t){return null==e||e!=e?t:e},pi.divide=qc,pi.endsWith=function(e,t,n){e=Ws(e),t=kr(t);var i=e.length,r=n=n===o?i:Di(Hs(n),0,i);return(n-=t.length)>=0&&e.slice(n,r)==t},pi.eq=ps,pi.escape=function(e){return(e=Ws(e))&&Ae.test(e)?e.replace(Ce,Cn):e},pi.escapeRegExp=function(e){return(e=Ws(e))&&De.test(e)?e.replace(we,"\\$&"):e},pi.every=function(e,t,n){var i=ms(e)?Yt:Hi;return n&&Ko(e,t,n)&&(t=o),i(e,ko(t,3))},pi.find=Ga,pi.findIndex=ga,pi.findKey=function(e,t){return an(e,ko(t,3),Ki)},pi.findLast=Va,pi.findLastIndex=ma,pi.findLastKey=function(e,t){return an(e,ko(t,3),zi)},pi.floor=Kc,pi.forEach=Wa,pi.forEachRight=qa,pi.forIn=function(e,t){return null==e?e:Wi(e,ko(t,3),rc)},pi.forInRight=function(e,t){return null==e?e:qi(e,ko(t,3),rc)},pi.forOwn=function(e,t){return e&&Ki(e,ko(t,3))},pi.forOwnRight=function(e,t){return e&&zi(e,ko(t,3))},pi.get=$s,pi.gt=fs,pi.gte=hs,pi.has=function(e,t){return null!=e&&Go(e,t,Zi)},pi.hasIn=Zs,pi.head=ya,pi.identity=Pc,pi.includes=function(e,t,n,i){e=ys(e)?e:pc(e),n=n&&!i?Hs(n):0;var r=e.length;return n<0&&(n=Wn(r+n,0)),Ds(e)?n<=r&&e.indexOf(t,n)>-1:!!r&&cn(e,t,n)>-1},pi.indexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:Hs(n);return r<0&&(r=Wn(i+r,0)),cn(e,t,r)},pi.inRange=function(e,t,n){return t=js(t),n===o?(n=t,t=0):n=js(n),function(e,t,n){return e>=qn(t,n)&&e<Wn(t,n)}(e=Gs(e),t,n)},pi.invoke=nc,pi.isArguments=gs,pi.isArray=ms,pi.isArrayBuffer=vs,pi.isArrayLike=ys,pi.isArrayLikeObject=Ss,pi.isBoolean=function(e){return!0===e||!1===e||Rs(e)&&Xi(e)==W},pi.isBuffer=_s,pi.isDate=Es,pi.isElement=function(e){return Rs(e)&&1===e.nodeType&&!Ns(e)},pi.isEmpty=function(e){if(null==e)return!0;if(ys(e)&&(ms(e)||"string"==typeof e||"function"==typeof e.splice||_s(e)||ks(e)||gs(e)))return!e.length;var t=Bo(e);if(t==Q||t==ne)return!e.size;if(Qo(e))return!cr(e).length;for(var n in e)if(lt.call(e,n))return!1;return!0},pi.isEqual=function(e,t){return rr(e,t)},pi.isEqualWith=function(e,t,n){var i=(n="function"==typeof n?n:o)?n(e,t):o;return i===o?rr(e,t,o,n):!!i},pi.isError=Ts,pi.isFinite=function(e){return"number"==typeof e&&Bn(e)},pi.isFunction=Cs,pi.isInteger=Is,pi.isLength=As,pi.isMap=Os,pi.isMatch=function(e,t){return e===t||or(e,t,Fo(t))},pi.isMatchWith=function(e,t,n){return n="function"==typeof n?n:o,or(e,t,Fo(t),n)},pi.isNaN=function(e){return Ps(e)&&e!=+e},pi.isNative=function(e){if(Yo(e))throw new r(s);return ar(e)},pi.isNil=function(e){return null==e},pi.isNull=function(e){return null===e},pi.isNumber=Ps,pi.isObject=bs,pi.isObjectLike=Rs,pi.isPlainObject=Ns,pi.isRegExp=Ms,pi.isSafeInteger=function(e){return Is(e)&&e>=-L&&e<=L},pi.isSet=ws,pi.isString=Ds,pi.isSymbol=Ls,pi.isTypedArray=ks,pi.isUndefined=function(e){return e===o},pi.isWeakMap=function(e){return Rs(e)&&Bo(e)==ae},pi.isWeakSet=function(e){return Rs(e)&&Xi(e)==se},pi.join=function(e,t){return null==e?"":Gn.call(e,t)},pi.kebabCase=mc,pi.last=Ta,pi.lastIndexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i;return n!==o&&(r=(r=Hs(n))<0?Wn(i+r,0):qn(r,i-1)),t==t?function(e,t,n){for(var i=n+1;i--;)if(e[i]===t)return i;return i}(e,t,r):sn(e,un,r,!0)},pi.lowerCase=vc,pi.lowerFirst=yc,pi.lt=xs,pi.lte=Fs,pi.max=function(e){return e&&e.length?Bi(e,Pc,$i):o},pi.maxBy=function(e,t){return e&&e.length?Bi(e,ko(t,2),$i):o},pi.mean=function(e){return dn(e,Pc)},pi.meanBy=function(e,t){return dn(e,ko(t,2))},pi.min=function(e){return e&&e.length?Bi(e,Pc,ur):o},pi.minBy=function(e,t){return e&&e.length?Bi(e,ko(t,2),ur):o},pi.stubArray=Bc,pi.stubFalse=Gc,pi.stubObject=function(){return{}},pi.stubString=function(){return""},pi.stubTrue=function(){return!0},pi.multiply=zc,pi.nth=function(e,t){return e&&e.length?gr(e,Hs(t)):o},pi.noConflict=function(){return Dt._===this&&(Dt._=ht),this},pi.noop=Lc,pi.now=$a,pi.pad=function(e,t,n){e=Ws(e);var i=(t=Hs(t))?Mn(e):0;if(!t||i>=t)return e;var r=(t-i)/2;return vo(Un(r),n)+e+vo(Fn(r),n)},pi.padEnd=function(e,t,n){e=Ws(e);var i=(t=Hs(t))?Mn(e):0;return t&&i<t?e+vo(t-i,n):e},pi.padStart=function(e,t,n){e=Ws(e);var i=(t=Hs(t))?Mn(e):0;return t&&i<t?vo(t-i,n)+e:e},pi.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),zn(Ws(e).replace(ke,""),t||0)},pi.random=function(e,t,n){if(n&&"boolean"!=typeof n&&Ko(e,t,n)&&(t=n=o),n===o&&("boolean"==typeof t?(n=t,t=o):"boolean"==typeof e&&(n=e,e=o)),e===o&&t===o?(e=0,t=1):(e=js(e),t===o?(t=e,e=0):t=js(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var r=Jn();return qn(e+r*(t-e+Pt("1e-"+((r+"").length-1))),t)}return _r(e,t)},pi.reduce=function(e,t,n){var i=ms(e)?tn:hn,r=arguments.length<3;return i(e,ko(t,4),n,r,Ui)},pi.reduceRight=function(e,t,n){var i=ms(e)?nn:hn,r=arguments.length<3;return i(e,ko(t,4),n,r,ji)},pi.repeat=function(e,t,n){return t=(n?Ko(e,t,n):t===o)?1:Hs(t),Er(Ws(e),t)},pi.replace=function(){var e=arguments,t=Ws(e[0]);return e.length<3?t:t.replace(e[1],e[2])},pi.result=function(e,t,n){var i=-1,r=(t=qr(t,e)).length;for(r||(r=1,e=o);++i<r;){var a=null==e?o:e[la(t[i])];a===o&&(i=r,a=n),e=Cs(a)?a.call(e):a}return e},pi.round=Jc,pi.runInContext=e,pi.sample=function(e){return(ms(e)?Ci:Cr)(e)},pi.size=function(e){if(null==e)return 0;if(ys(e))return Ds(e)?Mn(e):e.length;var t=Bo(e);return t==Q||t==ne?e.size:cr(e).length},pi.snakeCase=Sc,pi.some=function(e,t,n){var i=ms(e)?rn:Nr;return n&&Ko(e,t,n)&&(t=o),i(e,ko(t,3))},pi.sortedIndex=function(e,t){return Mr(e,t)},pi.sortedIndexBy=function(e,t,n){return wr(e,t,ko(n,2))},pi.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var i=Mr(e,t);if(i<n&&ps(e[i],t))return i}return-1},pi.sortedLastIndex=function(e,t){return Mr(e,t,!0)},pi.sortedLastIndexBy=function(e,t,n){return wr(e,t,ko(n,2),!0)},pi.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=Mr(e,t,!0)-1;if(ps(e[n],t))return n}return-1},pi.startCase=_c,pi.startsWith=function(e,t,n){return e=Ws(e),n=null==n?0:Di(Hs(n),0,e.length),t=kr(t),e.slice(n,n+t.length)==t},pi.subtract=Yc,pi.sum=function(e){return e&&e.length?gn(e,Pc):0},pi.sumBy=function(e,t){return e&&e.length?gn(e,ko(t,2)):0},pi.template=function(e,t,n){var i=pi.templateSettings;n&&Ko(e,t,n)&&(t=o),e=Ws(e),t=zs({},t,i,Ao);var r,a,s=zs({},t.imports,i.imports,Ao),c=ic(s),l=yn(s,c),u=0,d=t.interpolate||Qe,p="__p += '",f=tt((t.escape||Qe).source+"|"+d.source+"|"+(d===Oe?Ge:Qe).source+"|"+(t.evaluate||Qe).source+"|$","g"),h="//# sourceURL="+(lt.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++At+"]")+"\n";e.replace(f,function(t,n,i,o,s,c){return i||(i=o),p+=e.slice(u,c).replace(Xe,In),n&&(r=!0,p+="' +\n__e("+n+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),i&&(p+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),u=c+t.length,t}),p+="';\n";var g=lt.call(t,"variable")&&t.variable;g||(p="with (obj) {\n"+p+"\n}\n"),p=(a?p.replace(Se,""):p).replace(_e,"$1").replace(Ee,"$1;"),p="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var m=Ic(function(){return $e(c,h+"return "+p).apply(o,l)});if(m.source=p,Ts(m))throw m;return m},pi.times=function(e,t){if((e=Hs(e))<1||e>L)return[];var n=F,i=qn(e,F);t=ko(t),e-=F;for(var r=mn(i,t);++n<e;)t(n);return r},pi.toFinite=js,pi.toInteger=Hs,pi.toLength=Bs,pi.toLower=function(e){return Ws(e).toLowerCase()},pi.toNumber=Gs,pi.toSafeInteger=function(e){return e?Di(Hs(e),-L,L):0===e?e:0},pi.toString=Ws,pi.toUpper=function(e){return Ws(e).toUpperCase()},pi.trim=function(e,t,n){if((e=Ws(e))&&(n||t===o))return e.replace(Le,"");if(!e||!(t=kr(t)))return e;var i=wn(e),r=wn(t);return zr(i,_n(i,r),En(i,r)+1).join("")},pi.trimEnd=function(e,t,n){if((e=Ws(e))&&(n||t===o))return e.replace(xe,"");if(!e||!(t=kr(t)))return e;var i=wn(e);return zr(i,0,En(i,wn(t))+1).join("")},pi.trimStart=function(e,t,n){if((e=Ws(e))&&(n||t===o))return e.replace(ke,"");if(!e||!(t=kr(t)))return e;var i=wn(e);return zr(i,_n(i,wn(t))).join("")},pi.truncate=function(e,t){var n=R,i=O;if(bs(t)){var r="separator"in t?t.separator:r;n="length"in t?Hs(t.length):n,i="omission"in t?kr(t.omission):i}var a=(e=Ws(e)).length;if(An(e)){var s=wn(e);a=s.length}if(n>=a)return e;var c=n-Mn(i);if(c<1)return i;var l=s?zr(s,0,c).join(""):e.slice(0,c);if(r===o)return l+i;if(s&&(c+=l.length-c),Ms(r)){if(e.slice(c).search(r)){var u,d=l;for(r.global||(r=tt(r.source,Ws(Ve.exec(r))+"g")),r.lastIndex=0;u=r.exec(d);)var p=u.index;l=l.slice(0,p===o?c:p)}}else if(e.indexOf(kr(r),c)!=c){var f=l.lastIndexOf(r);f>-1&&(l=l.slice(0,f))}return l+i},pi.unescape=function(e){return(e=Ws(e))&&Ie.test(e)?e.replace(Te,Dn):e},pi.uniqueId=function(e){var t=++ut;return Ws(e)+t},pi.upperCase=Ec,pi.upperFirst=Tc,pi.each=Wa,pi.eachRight=qa,pi.first=ya,Dc(pi,function(){var e={};return Ki(pi,function(t,n){lt.call(pi.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),pi.VERSION="4.17.20",zt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){pi[e].placeholder=pi}),zt(["drop","take"],function(e,t){mi.prototype[e]=function(n){n=n===o?1:Wn(Hs(n),0);var i=this.__filtered__&&!t?new mi(this):this.clone();return i.__filtered__?i.__takeCount__=qn(n,i.__takeCount__):i.__views__.push({size:qn(n,F),type:e+(i.__dir__<0?"Right":"")}),i},mi.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),zt(["filter","map","takeWhile"],function(e,t){var n=t+1,i=n==M||3==n;mi.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:ko(e,3),type:n}),t.__filtered__=t.__filtered__||i,t}}),zt(["head","last"],function(e,t){var n="take"+(t?"Right":"");mi.prototype[e]=function(){return this[n](1).value()[0]}}),zt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");mi.prototype[e]=function(){return this.__filtered__?new mi(this):this[n](1)}}),mi.prototype.compact=function(){return this.filter(Pc)},mi.prototype.find=function(e){return this.filter(e).head()},mi.prototype.findLast=function(e){return this.reverse().find(e)},mi.prototype.invokeMap=Tr(function(e,t){return"function"==typeof e?new mi(this):this.map(function(n){return nr(n,e,t)})}),mi.prototype.reject=function(e){return this.filter(ss(ko(e)))},mi.prototype.slice=function(e,t){e=Hs(e);var n=this;return n.__filtered__&&(e>0||t<0)?new mi(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==o&&(n=(t=Hs(t))<0?n.dropRight(-t):n.take(t-e)),n)},mi.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},mi.prototype.toArray=function(){return this.take(F)},Ki(mi.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),r=pi[i?"take"+("last"==t?"Right":""):t],a=i||/^find/.test(t);r&&(pi.prototype[t]=function(){var t=this.__wrapped__,s=i?[1]:arguments,c=t instanceof mi,l=s[0],u=c||ms(t),d=function(e){var t=r.apply(pi,en([e],s));return i&&p?t[0]:t};u&&n&&"function"==typeof l&&1!=l.length&&(c=u=!1);var p=this.__chain__,f=!!this.__actions__.length,h=a&&!p,g=c&&!f;if(!a&&u){t=g?t:new mi(this);var m=e.apply(t,s);return m.__actions__.push({func:ja,args:[d],thisArg:o}),new gi(m,p)}return h&&g?e.apply(this,s):(m=this.thru(d),h?i?m.value()[0]:m.value():m)})}),zt(["pop","push","shift","sort","splice","unshift"],function(e){var t=rt[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);pi.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var r=this.value();return t.apply(ms(r)?r:[],e)}return this[n](function(n){return t.apply(ms(n)?n:[],e)})}}),Ki(mi.prototype,function(e,t){var n=pi[t];if(n){var i=n.name+"";lt.call(ii,i)||(ii[i]=[]),ii[i].push({name:t,func:n})}}),ii[fo(o,y).name]=[{name:"wrapper",func:o}],mi.prototype.clone=function(){var e=new mi(this.__wrapped__);return e.__actions__=to(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=to(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=to(this.__views__),e},mi.prototype.reverse=function(){if(this.__filtered__){var e=new mi(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},mi.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=ms(e),i=t<0,r=n?e.length:0,o=function(e,t,n){for(var i=-1,r=n.length;++i<r;){var o=n[i],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=qn(t,e+a);break;case"takeRight":e=Wn(e,t-a)}}return{start:e,end:t}}(0,r,this.__views__),a=o.start,s=o.end,c=s-a,l=i?s:a-1,u=this.__iteratees__,d=u.length,p=0,f=qn(c,this.__takeCount__);if(!n||!i&&r==c&&f==c)return Hr(e,this.__actions__);var h=[];e:for(;c--&&p<f;){for(var g=-1,m=e[l+=t];++g<d;){var v=u[g],y=v.iteratee,S=v.type,_=y(m);if(S==w)m=_;else if(!_){if(S==M)continue e;break e}}h[p++]=m}return h},pi.prototype.at=Ha,pi.prototype.chain=function(){return Ua(this)},pi.prototype.commit=function(){return new gi(this.value(),this.__chain__)},pi.prototype.next=function(){this.__values__===o&&(this.__values__=Us(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?o:this.__values__[this.__index__++]}},pi.prototype.plant=function(e){for(var t,n=this;n instanceof hi;){var i=da(n);i.__index__=0,i.__values__=o,t?r.__wrapped__=i:t=i;var r=i;n=n.__wrapped__}return r.__wrapped__=e,t},pi.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof mi){var t=e;return this.__actions__.length&&(t=new mi(this)),(t=t.reverse()).__actions__.push({func:ja,args:[ba],thisArg:o}),new gi(t,this.__chain__)}return this.thru(ba)},pi.prototype.toJSON=pi.prototype.valueOf=pi.prototype.value=function(){return Hr(this.__wrapped__,this.__actions__)},pi.prototype.first=pi.prototype.head,Ft&&(pi.prototype[Ft]=function(){return this}),pi}();Dt._=Ln,(r=function(){return Ln}.call(t,n,t,i))===o||(i.exports=r)}).call(this)}).call(this,n(24),n(97)(e))},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(13),s=n(8),c=n(4),l=n(2),u=n(14),d=n(3),p=n(25),f=n(69),h=n(35),g=n(66);class m{constructor(e,t){this._callAgent=t,this.localVideoStreams=[],this.remoteParticipants=[],this._eventEmitter=new s.EventEmitter,this._lastTsCallState=0,this._state="None",this._isScreenSharingOn=!1,this._isIncoming=!1,this._disposed=!1,this._complianceRecordingBots=new Map,this._recordingBotChangedSubs=new WeakMap,this._isRecordingActive=!1,this.getAlternateCallerIdMri=(e=>{let t;if(e){if(null==e?void 0:e.alternateCallerId){if("PhoneNumber"!==a.getIdentifierKind(e.alternateCallerId).kind)throw new l.CommunicationErrorImpl("Only PhoneNumber identifier can be used for alternateCallerId option");t=h.getMriFromIdentifier(e.alternateCallerId)}return t}}),this._getCallEndReason=((e,t=0)=>{let n=t,i=0,r=e||"Unknown";this._tsCall&&(n=this._tsCall.callEndDiagnosticsInfo&&this._tsCall.callEndDiagnosticsInfo.callControllerCode||t,i=this._tsCall.callEndDiagnosticsInfo&&this._tsCall.callEndDiagnosticsInfo.callControllerSubCode||0,r=g.convertTerminatedReasonToString(this._tsCall.terminatedReason));const o={code:n,subCode:i};return this._logger[0===n?"info":"error"](`Call end reason=${r}, code=${n}, subCode=${i}`),o}),this._updateIsCallRecorded=(e=>{this._isRecordingActive!==e&&(this._isRecordingActive=e,this._logger.info(`Updating isCallRecorded to ${e}`),this._eventEmitter.emit("isRecordingActiveChanged"))}),this._isCallingApplication=(e=>{const t=h.constructIdentifierFromMri(e.id);return"CallingApplication"===a.getIdentifierKind(t).kind}),this._handleCallingApplication=(e=>{this._isClosedCaptionsBot(e)?this._logger.info("Handle participant: Ignore closed captions application"):this._handleRecordingBotAdded(e)}),this._isConvenienceRecordingBot=(e=>"28:bdd75849-e0a6-4cce-8fc1-d7c0d4da43e5"===e.id),this._isClosedCaptionsBot=(e=>"28:b1902c3e-b9f7-4650-9b23-5772bd429747"===e.id),this._isComplianceRecordingBot=(e=>{var t;try{if(null===(t=e.endpoints)||void 0===t?void 0:t.endpointDetails.some(e=>{var t,n,i;return null===(i=null===(n=null===(t=null==e?void 0:e.endpointMetadata)||void 0===t?void 0:t.__platform)||void 0===n?void 0:n.recording)||void 0===i?void 0:i.compliance}))return!0}catch(e){return!1}return!1}),this._isConvenienceRecordingEnabled=(()=>{var e,t,n,i;let r=!1;if(!this._convenienceRecordingBot)return r;try{const o=null===(e=this._convenienceRecordingBot.endpoints)||void 0===e?void 0:e.endpointDetails[0];r="Active"===(null===(i=null===(n=null===(t=null==o?void 0:o.endpointMetadata)||void 0===t?void 0:t.processingModes)||void 0===n?void 0:n.recording)||void 0===i?void 0:i.state)}catch(e){this._logger.info("Unable to read convenience recording state")}return r}),this._isComplianceRecordingEnabled=(()=>{let e=!1;try{this._complianceRecordingBots.forEach(t=>{var n;e||(e=!!(null===(n=t.endpoints)||void 0===n?void 0:n.endpointDetails.some(e=>{var t,n,i,r;return"Active"===(null===(r=null===(i=null===(n=null===(t=null==e?void 0:e.endpointMetadata)||void 0===t?void 0:t.__platform)||void 0===n?void 0:n.recording)||void 0===i?void 0:i.compliance)||void 0===r?void 0:r.state)})))})}catch(e){this._logger.info("Unable to read compliance recording state")}return e}),this._handleRecordingBotAdded=(e=>{const t=()=>{this._isComplianceRecordingBot(e)&&!this._complianceRecordingBots.has(e.id)&&(this._logger.info("Adding compliance recording bot"),this._complianceRecordingBots.set(e.id,e)),this._isConvenienceRecordingBot(e)&&!this._convenienceRecordingBot&&(this._logger.info("Adding convenience recording bot"),this._convenienceRecordingBot=e),this._updateIsCallRecorded(this._isConvenienceRecordingEnabled()||this._isComplianceRecordingEnabled())};t(),this._recordingBotChangedSubs.set(e,e.changed(t))}),this._handleRecordingBotRemoved=(e=>{var t;this._isComplianceRecordingBot(e)&&this._complianceRecordingBots.delete(e.id),this._isConvenienceRecordingBot(e)&&(this._convenienceRecordingBot=void 0),null===(t=this._recordingBotChangedSubs.get(e))||void 0===t||t.dispose(),this._recordingBotChangedSubs.delete(e),this._updateIsCallRecorded(this._isConvenienceRecordingEnabled()||this._isComplianceRecordingEnabled())}),this._handleCallOperationFailure=(e=>{throw this.dispose(),this._getCallEndReason(e,500)}),this._handleParticipantOperationFailure=((e,t)=>{let n,i=0,r=0;return this._logger.log("Participant operation failure",n),t&&(i=t.callEndDiagnosticsInfo?t.callEndDiagnosticsInfo.callControllerCode||500:0,r=t.callEndDiagnosticsInfo&&t.callEndDiagnosticsInfo.callControllerSubCode||0),n=g.convertParticipantStateReasonToString(e),new l.CommunicationErrorImpl(n).setCode(i).setSubcode(r)}),this._handleVideoOperationFailure=(e=>{let t=0;let n=e||"UnknownError";if(this._logger.log("Video operation operation failure",n),e&&e.type)switch(e.type){case d.VideoOperationFailureMessages.SourceUnavailableError:n=d.VideoOperationFailureMessages.SourceUnavailableError,t=412;break;case d.VideoOperationFailureMessages.PermissionDeniedError:n=d.VideoOperationFailureMessages.PermissionDeniedError,t=403;break;default:n=d.VideoOperationFailureMessages.UnknownFailureForVideoOperation,t=500}return new l.CommunicationErrorImpl(n).setCode(t).setSubcode(0)}),this._id=e.callId,this._isIncoming=!!e.isIncoming,this._logger=this._callAgent.logger.createChild(()=>`[ACSCall{${this._id}}{${this._state}}]`)}get id(){return this._id}get callerIdentity(){return this._callerIdentity}get state(){return this._state}get isIncoming(){return this._isIncoming}get isMicrophoneMuted(){return this._tsCall.isMuted}get isScreenSharingOn(){return this._isScreenSharingOn}get callEndReason(){return this._callEndReason}get isRecordingActive(){return this._isRecordingActive}bindTsCall(e){return o(this,void 0,void 0,function*(){this._tsCall=e,this.isIncoming&&(this._callerIdentity=h.constructIdentifierFromMri(this._tsCall.callerMri)),this._lastTsCallState=this._tsCall.state,this.mapTsCallState(this._tsCall.state),this._tsCall.changed(()=>{this._tsCall.callId!==this._id&&(this._logger.log(`tsCall callId changed=${this._tsCall.callId}`),this._id=this._tsCall.callId,this._eventEmitter.emit("callIdChanged")),this._tsCall.state!==this._lastTsCallState&&(this._logger.log(`tsCall state changed=${this._tsCall.state}`),this._lastTsCallState=this._tsCall.state,this.mapTsCallState(this._tsCall.state)),this._isScreenSharingOn!==this._tsCall.isScreenSharingOn&&(this._logger.log(`tsCall isScreenSharingOn changed=${this._tsCall.isScreenSharingOn}`),this._isScreenSharingOn=this._tsCall.isScreenSharingOn,this._eventEmitter.emit("isScreenSharingOnChanged"))}),this._tsCall.on("participantAdded",e=>o(this,void 0,void 0,function*(){if(this._isCallingApplication(e))return this._logger.info("Add participant: Handle calling application"),void this._handleCallingApplication(e);this._handleRemoteRingingForOutgoingCall(e);try{const t=e.id;let n=this.remoteParticipants.find(e=>h.getMriFromIdentifier(e.identifier)===t);n||(n=this.getOrCreateRemoteParticipant(t),this._eventEmitter.emit("remoteParticipantsUpdated",{added:[n],removed:[]})),n.observeParticipant(e)}catch(e){this._logger.log("unable to map call participant to ACS user")}})),this._tsCall.participants.forEach(e=>{const t=e.id,n=this.getOrCreateRemoteParticipant(t);this._eventEmitter.emit("remoteParticipantsUpdated",{added:[n],removed:[]}),n.observeParticipant(e)}),this._tsCall.on("participantRemoved",e=>o(this,void 0,void 0,function*(){if(this._isCallingApplication(e))return this._handleRecordingBotRemoved(e),void this._logger.info("Remove participant: Ignore calling application");const t=e.id;if(t){const n=this.remoteParticipants.find(e=>h.getMriFromIdentifier(e.identifier)===t);n?(0!==e.stateReason&&n.setCallEndReason(this._handleParticipantOperationFailure(e.stateReason,e)),this.remoteParticipants.splice(this.remoteParticipants.indexOf(n),1),this._eventEmitter.emit("remoteParticipantsUpdated",{added:[],removed:[n]})):this._logger.log("unable to find participant to remove")}}))})}startCallInternal(e){var t;return o(this,void 0,void 0,function*(){const n=this.getLocalVideoStreamFromCallOptions(e);let i=!!(null===(t=null==e?void 0:e.audioOptions)||void 0===t?void 0:t.muted);void 0===i&&(i=!1);const r=this.getAlternateCallerIdMri(e);yield this.setNewLocalVideoStream(n),this._tsCall.start({withVideo:!!n,muted:i,ringOthers:!0,alternateId:r}).catch(e=>{this.removeLocalVideoStreamSettingFailure(n);const t=this._getCallEndReason(e);this._logger.error("Failed to start the call",t)})})}accept(e={}){return o(this,void 0,void 0,function*(){const t=this.getLocalVideoStreamFromCallOptions(e);return yield this.setNewLocalVideoStream(t),this._tsCall.accept({withVideo:!!t}).catch(this._handleCallOperationFailure)})}reject(){return o(this,void 0,void 0,function*(){return this._tsCall.reject().catch(this._handleCallOperationFailure)})}mute(){return o(this,void 0,void 0,function*(){return this._tsCall.mute().catch(e=>{throw this._logger.error("Failed to mute microphone",e),new l.CommunicationErrorImpl("Failed to mute microphone")})})}unmute(){return o(this,void 0,void 0,function*(){return this._tsCall.unmute().catch(e=>{throw this._logger.error("Failed to unmute microphone",e),new l.CommunicationErrorImpl("Failed to unmute microphone")})})}sendDtmf(e){return o(this,void 0,void 0,function*(){const t=this._toDtmfTone(e);return this._tsCall.sendDtmfTone(t).catch(e=>{throw this._logger.error("Failed to send DTMF tone",e),new l.CommunicationErrorImpl("Failed to send DTMF tone")})})}startVideo(e){return o(this,void 0,void 0,function*(){if(!e)throw new l.CommunicationErrorImpl("localVideoStream cannot be null");if(!(e instanceof p.LocalVideoStream))throw new l.CommunicationErrorImpl("localVideoStream is not an instance of LocalVideoStream");if(this._tsCall.isVideoOn)throw(new l.CommunicationErrorImpl).setMessage("Local video is already on").setCode(409);yield this.setNewLocalVideoStream(e);try{yield this._tsCall.startVideo()}catch(t){throw this.localVideoStreams.splice(this.localVideoStreams.indexOf(e),1),this._eventEmitter.emit("localVideoStreamsUpdated",{added:[],removed:[e]}),this._handleVideoOperationFailure(t)}})}stopVideo(e){return o(this,void 0,void 0,function*(){if(!this._tsCall.isVideoOn)throw(new l.CommunicationErrorImpl).setMessage("Local video is already off").setCode(409);try{yield this._tsCall.stopVideo(),this.removeLocalVideoStreamSettingFailure(e)}catch(e){throw new l.CommunicationErrorImpl("Failed to stop local video")}})}addParticipant(e,t){const n=this.getAlternateCallerIdMri(t);if(this.remoteParticipants.find(t=>h.getMriFromIdentifier(t.identifier)===h.getMriFromIdentifier(e)))throw new l.CommunicationErrorImpl(`${a.getIdentifierKind(e).kind} is already in the call`);const i=this.getOrCreateRemoteParticipant(h.getMriFromIdentifier(e));return this._eventEmitter.emit("remoteParticipantsUpdated",{added:[i],removed:[]}),this._tsCall.addParticipant(h.getMriFromIdentifier(e),{alternateId:n}).catch(t=>{this.remoteParticipants.find(t=>h.getMriFromIdentifier(t.identifier)===h.getMriFromIdentifier(e))&&(this.remoteParticipants.splice(this.remoteParticipants.indexOf(i)),i.setCallEndReason(this._handleParticipantOperationFailure(t,void 0)),this._eventEmitter.emit("remoteParticipantsUpdated",{added:[],removed:[i]}))}),i}removeParticipant(e,t){return o(this,void 0,void 0,function*(){if("Unknown"===a.getIdentifierKind(e).kind)throw new l.CommunicationErrorImpl("Unkown identifiers are not allowed");try{yield this._tsCall.removeParticipant(h.getMriFromIdentifier(e))}catch(e){throw this._handleParticipantOperationFailure(e,void 0)}})}hold(){return o(this,void 0,void 0,function*(){return this._tsCall.hold().catch(()=>{throw new l.CommunicationErrorImpl("Hold failed")})})}unhold(){return o(this,void 0,void 0,function*(){return this._tsCall.unhold().catch(()=>{throw new l.CommunicationErrorImpl("Unhold failed")})})}hangUp(e){return o(this,void 0,void 0,function*(){return this._tsCall.stop(null==e?void 0:e.forEveryone).catch(this._handleCallOperationFailure)})}startScreenSharing(){return o(this,void 0,void 0,function*(){return this._tsCall.startScreenSharing().catch(()=>{throw new l.CommunicationErrorImpl("Start screen share failed")})})}stopScreenSharing(){return o(this,void 0,void 0,function*(){return this._tsCall.stopScreenSharing().catch(()=>{throw new l.CommunicationErrorImpl("Stop screen share failed")})})}on(e,t){this._eventEmitter.on(e,t)}off(e,t){this._eventEmitter.off(e,t)}dispose(){this._disposed||(this._updateIsCallRecorded(!1),this._eventEmitter.removeAllListeners(),this._disposed=!0)}mapTsCallState(e){let t,n;const i={0:"None",1:"Incoming",2:"Connecting",3:"Connected",4:"Hold",5:"Hold",10:"InLobby",9:"EarlyMedia",6:"Disconnecting",7:"Disconnected"};i[e]?("Disconnected"===(t=i[e])&&(n=this._getCallEndReason(),this._callEndReason=n),this._logger.log(`Mapped tsCall state:${e} to ${t}`),this._setCallState(t)):this._logger.log("Unable to map tsCall to ACS Call state")}_setCallState(e){e!==this._state&&(this._logger.log(`state changed from ${this._state} to ${this.state}`),this._state=e,this._eventEmitter.emit("callStateChanged"))}_handleRemoteRingingForOutgoingCall(e){e.changed(()=>{2!==e.state||"Connected"===this._state||this._isIncoming||this._setCallState("Ringing")})}getOrCreateRemoteParticipant(e){let t=this.remoteParticipants.find(t=>h.getMriFromIdentifier(t.identifier)===e);if(!t){const n=h.constructIdentifierFromMri(e);t=new f.RemoteParticipantImpl(n,this._logger),this.remoteParticipants.push(t)}return t}_toDtmfTone(e){switch(e){case"Num0":return 0;case"Num1":return 1;case"Num2":return 2;case"Num3":return 3;case"Num4":return 4;case"Num5":return 5;case"Num6":return 6;case"Num7":return 7;case"Num8":return 8;case"Num9":return 9;case"Star":return 10;case"Pound":return 11;case"A":return 12;case"B":return 13;case"C":return 14;case"D":return 15;case"Flash":return 16;default:throw(new l.CommunicationErrorImpl).setMessage("Invalid value passed to DtfmTone").setCode(400)}}getLocalVideoStreamFromCallOptions(e){var t,n,i;let r;if(Array.isArray(null===(t=null==e?void 0:e.videoOptions)||void 0===t?void 0:t.localVideoStreams)){if(1!==(null===(n=null==e?void 0:e.videoOptions)||void 0===n?void 0:n.localVideoStreams.length))throw new l.CommunicationErrorImpl("Only single LocalVideoStream is supported currently").setCode(400);if(!((r=null===(i=null==e?void 0:e.videoOptions)||void 0===i?void 0:i.localVideoStreams[0])instanceof p.LocalVideoStream))throw new l.CommunicationErrorImpl("localVideoStream[0] is not an instance of LocalVideoStream").setCode(400)}return r}setNewLocalVideoStream(e){var t;return o(this,void 0,void 0,function*(){e&&(this.localVideoStreams.push(e),yield null===(t=u.CallStack.getInitializedTsStack())||void 0===t?void 0:t.getDeviceManager().selectDevices({camera:e.getSource().id}),this._eventEmitter.emit("localVideoStreamsUpdated",{added:[e],removed:[]}))})}removeLocalVideoStreamSettingFailure(e){if(e){if(0===this.localVideoStreams.splice(this.localVideoStreams.indexOf(e),1).length)throw new l.CommunicationErrorImpl("Failed to remove local video");this._eventEmitter.emit("localVideoStreamsUpdated",{added:[],removed:[e]})}}}i([c.asyncOperation(d.CallOperation.Accept),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],m.prototype,"accept",null),i([c.asyncOperation(d.CallOperation.Reject),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],m.prototype,"reject",null),i([c.asyncOperation(d.CallOperation.Mute),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],m.prototype,"mute",null),i([c.asyncOperation(d.CallOperation.Unmute),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],m.prototype,"unmute",null),i([c.asyncOperation(d.CallOperation.SendDtmf),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],m.prototype,"sendDtmf",null),i([c.asyncOperation(d.CallOperation.StartVideo),r("design:type",Function),r("design:paramtypes",[p.LocalVideoStream]),r("design:returntype",Promise)],m.prototype,"startVideo",null),i([c.asyncOperation(d.CallOperation.StopVideo),r("design:type",Function),r("design:paramtypes",[p.LocalVideoStream]),r("design:returntype",Promise)],m.prototype,"stopVideo",null),i([c.syncOperation(d.CallOperation.AddParticipant),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Object)],m.prototype,"addParticipant",null),i([c.asyncOperation(d.CallOperation.RemoveParticipant),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Promise)],m.prototype,"removeParticipant",null),i([c.asyncOperation(d.CallOperation.Hold),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],m.prototype,"hold",null),i([c.asyncOperation(d.CallOperation.Unhold),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],m.prototype,"unhold",null),i([c.asyncOperation(d.CallOperation.HangUp),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],m.prototype,"hangUp",null),i([c.asyncOperation(d.CallOperation.StartScreenShare),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],m.prototype,"startScreenSharing",null),i([c.asyncOperation(d.CallOperation.StopScreenShare),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],m.prototype,"stopScreenSharing",null),t.CallImpl=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),r=function(){function e(){}return e.setEventsHandler=function(e){i.default.setEventsHandler(e)},e.getEventsHandler=function(){return i.default.getEventsHandler()},e.scheduleTimer=function(){i.default.scheduleTimer()},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function e(e,t){this._outboundQueue=e,this._maxNumberOfEvents=t,this._currentBatch={},this._currentNumEventsInBatch=0}return e.prototype.addEventToBatch=function(e){if(e.priority===i.AWTEventPriority.Immediate_sync){var t={};return t[e.apiKey]=[e],t}return this._currentNumEventsInBatch>=this._maxNumberOfEvents&&this.flushBatch(),void 0===this._currentBatch[e.apiKey]&&(this._currentBatch[e.apiKey]=[]),this._currentBatch[e.apiKey].push(e),this._currentNumEventsInBatch++,null},e.prototype.flushBatch=function(){this._currentNumEventsInBatch>0&&(this._outboundQueue.push(this._currentBatch),this._currentBatch={},this._currentNumEventsInBatch=0)},e.prototype.hasBatch=function(){return this._currentNumEventsInBatch>0},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.clockSkewRefreshDurationInMins=e,this._reset()}return e.prototype.allowRequestSending=function(){return this._isFirstRequest&&!this._clockSkewSet?(this._isFirstRequest=!1,this._allowRequestSending=!1,!0):this._allowRequestSending},e.prototype.shouldAddClockSkewHeaders=function(){return this._shouldAddClockSkewHeaders},e.prototype.getClockSkewHeaderValue=function(){return this._clockSkewHeaderValue},e.prototype.setClockSkew=function(e){this._clockSkewSet||(e?this._clockSkewHeaderValue=e:this._shouldAddClockSkewHeaders=!1,this._clockSkewSet=!0,this._allowRequestSending=!0)},e.prototype._reset=function(){var e=this;this._isFirstRequest=!0,this._clockSkewSet=!1,this._allowRequestSending=!0,this._shouldAddClockSkewHeaders=!0,this._clockSkewHeaderValue="use-collector-delta",this.clockSkewRefreshDurationInMins>0&&setTimeout(function(){return e._reset()},6e4*this.clockSkewRefreshDurationInMins)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._killedTokenDictionary={}}return e.prototype.setKillSwitchTenants=function(e,t){if(e&&t)try{var n=e.split(",");if("this-request-only"===t)return n;for(var i=1e3*parseInt(t,10),r=0;r<n.length;++r)this._killedTokenDictionary[n[r]]=Date.now()+i}catch(e){return[]}return[]},e.prototype.isTenantKilled=function(e){return void 0!==this._killedTokenDictionary[e]&&this._killedTokenDictionary[e]>Date.now()||(delete this._killedTokenDictionary[e],!1)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.shouldRetryForStatus=function(e){return!(e>=300&&e<500&&408!==e||501===e||505===e)},e.getMillisToBackoffForRetry=function(e){var t,n=Math.floor(1200*Math.random())+2400;return t=Math.pow(4,e)*n,Math.min(t,12e4)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),r=function(){function e(){this._buffer=[]}return e.prototype._WriteByte=function(e){this._buffer.push(i.Number._ToByte(e))},e.prototype._Write=function(e,t,n){for(;n--;)this._WriteByte(e[t++])},e.prototype._GetBuffer=function(){return this._buffer},e}();t.MemoryStream=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e._IsDataViewSupport=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},e}();t.BrowserChecker=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e._ConvertNumberToArray=function(e,t){if(!e)return t?this._doubleZero:this._floatZero;var n=t?52:23,i=(1<<(t?11:8)-1)-1,r=1-i,o=i,a=e<0?1:0;e=Math.abs(e);for(var s=Math.floor(e),c=e-s,l=2*(i+2)+n,u=new Array(l),d=0;d<l;)u[d++]=0;for(d=i+2;d&&s;)u[--d]=s%2,s=Math.floor(s/2);for(d=i+1;d<l-1&&c>0;)(c*=2)>=1?(u[++d]=1,--c):u[++d]=0;for(var p=0;p<l&&!u[p];)p++;var f=i+1-p,h=p+n;if(u[h+1]){for(d=h;d>p&&(u[d]=1-u[d],!u);--d);d===p&&++f}if(f>o||s)return a?t?this._doubleNegInifinity:this._floatNegInifinity:t?this._doubleInifinity:this._floatInifinity;if(f<r)return t?this._doubleZero:this._floatZero;if(t){var g=0;for(d=0;d<20;++d)g=g<<1|u[++p];for(var m=0;d<52;++d)m=m<<1|u[++p];return[255&m,m>>8&255,m>>16&255,m>>>24,255&(g=a<<31|2147483647&(g|=f+i<<20)),g>>8&255,g>>16&255,g>>>24]}var v=0;for(d=0;d<23;++d)v=v<<1|u[++p];return[255&(v=a<<31|2147483647&(v|=f+i<<23)),v>>8&255,v>>16&255,v>>>24]},e._floatZero=[0,0,0,0],e._doubleZero=[0,0,0,0,0,0,0,0],e._floatInifinity=[0,0,128,127],e._floatNegInifinity=[0,0,128,255],e._doubleInifinity=[0,0,0,0,0,0,240,127],e._doubleNegInifinity=[0,0,0,0,0,0,240,255],e}();t.FloatUtils=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),r=n(107),o=n(106);t._Utf8_GetBytes=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||i>=57344?t.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++n)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return t},t._Base64_GetString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],i=e.length%3,r=function(e){return[t.charAt(e>>18&63),t.charAt(e>>12&63),t.charAt(e>>6&63),t.charAt(63&e)].join("")},o=0,a=e.length-i;o<a;o+=3){var s=(e[o]<<16)+(e[o+1]<<8)+e[o+2];n.push(r(s))}switch(i){case 1:s=e[e.length-1],n.push(t.charAt(s>>2)),n.push(t.charAt(s<<4&63)),n.push("==");break;case 2:var c=(e[e.length-2]<<8)+e[e.length-1];n.push(t.charAt(c>>10)),n.push(t.charAt(c>>4&63)),n.push(t.charAt(c<<2&63)),n.push("=")}return n.join("")},t._Varint_GetBytes=function(e){for(var t=[];4294967168&e;)t.push(127&e|128),e>>>=7;return t.push(127&e),t},t._Varint64_GetBytes=function(e){for(var t=e.low,n=e.high,i=[];n||4294967168&t;)i.push(127&t|128),t=(127&n)<<25|t>>>7,n>>>=7;return i.push(127&t),i},t._Double_GetBytes=function(e){if(o.BrowserChecker._IsDataViewSupport()){var t=new DataView(new ArrayBuffer(8));t.setFloat64(0,e,!0);for(var n=[],i=0;i<8;++i)n.push(t.getUint8(i));return n}return r.FloatUtils._ConvertNumberToArray(e,!0)},t._Zigzag_EncodeZigzag32=function(e){return(e=i.Number._ToInt32(e))<<1^e>>31},t._Zigzag_EncodeZigzag64=function(e){var t=e.low,n=e.high,r=n<<1|t>>>31,o=t<<1;2147483648&n&&(r=~r,o=~o);var a=new i.UInt64("0");return a.low=o,a.high=r,a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e._BT_STOP=0]="_BT_STOP",e[e._BT_STOP_BASE=1]="_BT_STOP_BASE",e[e._BT_BOOL=2]="_BT_BOOL",e[e._BT_DOUBLE=8]="_BT_DOUBLE",e[e._BT_STRING=9]="_BT_STRING",e[e._BT_STRUCT=10]="_BT_STRUCT",e[e._BT_LIST=11]="_BT_LIST",e[e._BT_MAP=13]="_BT_MAP",e[e._BT_INT32=16]="_BT_INT32",e[e._BT_INT64=17]="_BT_INT64"}(t._BondDataType||(t._BondDataType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(109);t._BondDataType=i._BondDataType;var r=n(108);t._Encoding=r;var o=n(105);t.IO=o;var a=n(20);t.Int64=a.Int64,t.UInt64=a.UInt64,t.Number=a.Number;var s=function(){function e(e){this._stream=e}return e.prototype._WriteBlob=function(e){this._stream._Write(e,0,e.length)},e.prototype._WriteBool=function(e){this._stream._WriteByte(e?1:0)},e.prototype._WriteContainerBegin=function(e,t){this._WriteUInt8(t),this._WriteUInt32(e)},e.prototype._WriteMapContainerBegin=function(e,t,n){this._WriteUInt8(t),this._WriteUInt8(n),this._WriteUInt32(e)},e.prototype._WriteDouble=function(e){var t=r._Double_GetBytes(e);this._stream._Write(t,0,t.length)},e.prototype._WriteFieldBegin=function(e,t,n){t<=5?this._stream._WriteByte(e|t<<5):t<=255?(this._stream._WriteByte(192|e),this._stream._WriteByte(t)):(this._stream._WriteByte(224|e),this._stream._WriteByte(t),this._stream._WriteByte(t>>8))},e.prototype._WriteInt32=function(e){e=r._Zigzag_EncodeZigzag32(e),this._WriteUInt32(e)},e.prototype._WriteInt64=function(e){this._WriteUInt64(r._Zigzag_EncodeZigzag64(e))},e.prototype._WriteString=function(e){if(""===e)this._WriteUInt32(0);else{var t=r._Utf8_GetBytes(e);this._WriteUInt32(t.length),this._stream._Write(t,0,t.length)}},e.prototype._WriteStructEnd=function(e){this._WriteUInt8(e?i._BondDataType._BT_STOP_BASE:i._BondDataType._BT_STOP)},e.prototype._WriteUInt32=function(e){var t=r._Varint_GetBytes(a.Number._ToUInt32(e));this._stream._Write(t,0,t.length)},e.prototype._WriteUInt64=function(e){var t=r._Varint64_GetBytes(e);this._stream._Write(t,0,t.length)},e.prototype._WriteUInt8=function(e){this._stream._WriteByte(a.Number._ToUInt8(e))},e}();t.CompactBinaryProtocolWriter=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(52),o=n(104),a=n(103),s=n(102),c=n(51),l=n(6),u=n(10),d=n(15),p="POST",f=function(){function e(e,t,n,i,r){var o=this;this._requestQueue=e,this._queueManager=n,this._httpInterface=i,this._urlString="?qsp=true&content-type=application%2Fbond-compact-binary&client-id=NO_AUTH&sdk-version="+c.FullVersionString,this._killSwitch=new a.default,this._paused=!1,this._useBeacons=!1,this._activeConnections=0,this._clockSkewManager=new s.default(r),l.isUint8ArrayAvailable()||(this._urlString+="&content-encoding=base64"),this._urlString=t+this._urlString,this._httpInterface||(this._useBeacons=!l.isReactNative(),this._httpInterface={sendPOST:function(e,t,n,i,r,a){try{if(l.useXDomainRequest()){var s=new XDomainRequest;s.open(p,e),s.onload=function(){r(200,null)},s.onerror=function(){i(400,null)},s.ontimeout=function(){n(500,null)},s.send(t)}else if(l.isReactNative())fetch(e,{body:t,method:p}).then(function(e){var t={};e.headers&&e.headers.forEach(function(e,n){t[n]=e}),r(e.status,t)}).catch(function(e){i(0,{})});else{var c=new XMLHttpRequest;c.open(p,e,!a),c.onload=function(){r(c.status,o._convertAllHeadersToMap(c.getAllResponseHeaders()))},c.onerror=function(){i(c.status,o._convertAllHeadersToMap(c.getAllResponseHeaders()))},c.ontimeout=function(){n(c.status,o._convertAllHeadersToMap(c.getAllResponseHeaders()))},c.send(t)}}catch(e){i(400,null)}}})}return e.prototype.hasIdleConnection=function(){return this._activeConnections<2},e.prototype.sendQueuedRequests=function(){for(;this.hasIdleConnection()&&!this._paused&&this._requestQueue.length>0&&this._clockSkewManager.allowRequestSending();)this._activeConnections++,this._sendRequest(this._requestQueue.shift(),0,!1);this.hasIdleConnection()&&d.default.scheduleTimer()},e.prototype.isCompletelyIdle=function(){return 0===this._activeConnections},e.prototype.teardown=function(){for(;this._requestQueue.length>0;)this._sendRequest(this._requestQueue.shift(),0,!0)},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){this._paused=!1,this.sendQueuedRequests()},e.prototype.removeQueuedRequests=function(){this._requestQueue.length=0},e.prototype.sendSynchronousRequest=function(e,t){this._paused&&(e[t][0].priority=i.AWTEventPriority.High),this._activeConnections++,this._sendRequest(e,0,!1,!0)},e.prototype._sendRequest=function(e,t,n,o){var a=this;void 0===o&&(o=!1);try{if(this._paused)return this._activeConnections--,void this._queueManager.addBackRequest(e);var s=0,c="";for(var d in e)e.hasOwnProperty(d)&&(this._killSwitch.isTenantKilled(d)?(u.default.eventsRejected(e[d],i.AWTEventsRejectedReason.KillSwitch),delete e[d]):(c.length>0&&(c+=","),c+=d,s++));if(s>0){var p=r.default.getPayloadBlob(e,s);p.remainingRequest&&this._requestQueue.push(p.remainingRequest);var f=this._urlString+"&x-apikey="+c+"&client-time-epoch-millis="+Date.now().toString();this._clockSkewManager.shouldAddClockSkewHeaders()&&(f=f+"&time-delta-to-apply-millis="+this._clockSkewManager.getClockSkewHeaderValue());var h=void 0;for(var d in h=l.isUint8ArrayAvailable()?new Uint8Array(p.payloadBlob):r.default.base64Encode(p.payloadBlob),e)if(e.hasOwnProperty(d))for(var g=0;g<e[d].length;++g)e[d][g].sendAttempt>0?e[d][g].sendAttempt++:e[d][g].sendAttempt=1;if(this._useBeacons&&n&&l.isBeaconsSupported()&&navigator.sendBeacon(f,h))return;this._httpInterface.sendPOST(f,h,function(i,r){a._retryRequestIfNeeded(i,r,e,s,c,t,n,o)},function(i,r){a._retryRequestIfNeeded(i,r,e,s,c,t,n,o)},function(i,r){a._retryRequestIfNeeded(i,r,e,s,c,t,n,o)},n||o)}else n||this._handleRequestFinished(!1,{},n,o)}catch(e){this._handleRequestFinished(!1,{},n,o)}},e.prototype._retryRequestIfNeeded=function(e,t,n,r,a,s,c,l){var p=this,f=!0;if(void 0!==e){if(t){var h=this._killSwitch.setKillSwitchTenants(t["kill-tokens"],t["kill-duration-seconds"]);this._clockSkewManager.setClockSkew(t["time-delta-millis"]);for(var g=0;g<h.length;++g)u.default.eventsRejected(n[h[g]],i.AWTEventsRejectedReason.KillSwitch),delete n[h[g]],r--}else this._clockSkewManager.setClockSkew(null);if(200===e)return void this._handleRequestFinished(!0,n,c,l);(!o.default.shouldRetryForStatus(e)||r<=0)&&(f=!1)}if(f)if(l)this._activeConnections--,n[a][0].priority=i.AWTEventPriority.High,this._queueManager.addBackRequest(n);else if(s<1){for(var m in n)n.hasOwnProperty(m)&&u.default.eventsRetrying(n[m]);setTimeout(function(){return p._sendRequest(n,s+1,!1)},o.default.getMillisToBackoffForRetry(s))}else this._activeConnections--,d.default.backOffTransmission(),this._queueManager.addBackRequest(n);else this._handleRequestFinished(!1,n,c,l)},e.prototype._handleRequestFinished=function(e,t,n,r){for(var o in e&&d.default.clearBackOff(),t)t.hasOwnProperty(o)&&(e?u.default.eventsSent(t[o]):u.default.eventsDropped(t[o],i.AWTEventsDroppedReason.NonRetryableStatus));this._activeConnections--,r||n||this.sendQueuedRequests()},e.prototype._convertAllHeadersToMap=function(e){var t={};if(e)for(var n=e.split("\n"),i=0;i<n.length;++i){var r=n[i].split(": ");t[r[0]]=r[1]}return t},e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(111),o=n(15),a=n(101),s=n(10),c=n(6),l=500,u=function(){function e(e,t,n,o){this._queueSizeLimit=t,this._isCurrentlyUploadingNow=!1,this._uploadNowQueue=[],this._shouldDropEventsOnPause=!1,this._paused=!1,this._queueSize=0,this._outboundQueue=[],this._inboundQueues={},this._inboundQueues[i.AWTEventPriority.High]=[],this._inboundQueues[i.AWTEventPriority.Normal]=[],this._inboundQueues[i.AWTEventPriority.Low]=[],this._addEmptyQueues(),this._batcher=new a.default(this._outboundQueue,l),this._httpManager=new r.default(this._outboundQueue,e,this,n,o)}return e.prototype.addEvent=function(e){c.isPriority(e.priority)||(e.priority=i.AWTEventPriority.Normal),e.priority===i.AWTEventPriority.Immediate_sync?this._httpManager.sendSynchronousRequest(this._batcher.addEventToBatch(e),e.apiKey):this._queueSize<this._queueSizeLimit?this._addEventToProperQueue(e):this._dropEventWithPriorityOrLess(e.priority)?this._addEventToProperQueue(e):s.default.eventsDropped([e],i.AWTEventsDroppedReason.QueueFull)},e.prototype.sendEventsForPriorityAndAbove=function(e){this._batchEvents(e),this._httpManager.sendQueuedRequests()},e.prototype.hasEvents=function(){return(this._inboundQueues[i.AWTEventPriority.High][0].length>0||this._inboundQueues[i.AWTEventPriority.Normal][0].length>0||this._inboundQueues[i.AWTEventPriority.Low][0].length>0||this._batcher.hasBatch())&&this._httpManager.hasIdleConnection()},e.prototype.addBackRequest=function(e){if(!this._paused||!this._shouldDropEventsOnPause){for(var t in e)if(e.hasOwnProperty(t))for(var n=0;n<e[t].length;++n)e[t][n].sendAttempt<6?this.addEvent(e[t][n]):s.default.eventsDropped([e[t][n]],i.AWTEventsDroppedReason.NonRetryableStatus);o.default.scheduleTimer()}},e.prototype.teardown=function(){this._paused||(this._batchEvents(i.AWTEventPriority.Low),this._httpManager.teardown())},e.prototype.uploadNow=function(e){var t=this;this._addEmptyQueues(),this._isCurrentlyUploadingNow?this._uploadNowQueue.push(e):(this._isCurrentlyUploadingNow=!0,setTimeout(function(){return t._uploadNow(e)},0))},e.prototype.pauseTransmission=function(){this._paused=!0,this._httpManager.pause(),this.shouldDropEventsOnPause&&(this._queueSize-=this._inboundQueues[i.AWTEventPriority.High][0].length+this._inboundQueues[i.AWTEventPriority.Normal][0].length+this._inboundQueues[i.AWTEventPriority.Low][0].length,this._inboundQueues[i.AWTEventPriority.High][0]=[],this._inboundQueues[i.AWTEventPriority.Normal][0]=[],this._inboundQueues[i.AWTEventPriority.Low][0]=[],this._httpManager.removeQueuedRequests())},e.prototype.resumeTransmission=function(){this._paused=!1,this._httpManager.resume()},e.prototype.shouldDropEventsOnPause=function(e){this._shouldDropEventsOnPause=e},e.prototype._removeFirstQueues=function(){this._inboundQueues[i.AWTEventPriority.High].shift(),this._inboundQueues[i.AWTEventPriority.Normal].shift(),this._inboundQueues[i.AWTEventPriority.Low].shift()},e.prototype._addEmptyQueues=function(){this._inboundQueues[i.AWTEventPriority.High].push([]),this._inboundQueues[i.AWTEventPriority.Normal].push([]),this._inboundQueues[i.AWTEventPriority.Low].push([])},e.prototype._addEventToProperQueue=function(e){this._paused&&this._shouldDropEventsOnPause||(this._queueSize++,this._inboundQueues[e.priority][this._inboundQueues[e.priority].length-1].push(e))},e.prototype._dropEventWithPriorityOrLess=function(e){for(var t=i.AWTEventPriority.Low;t<=e;){if(this._inboundQueues[t][this._inboundQueues[t].length-1].length>0)return s.default.eventsDropped([this._inboundQueues[t][this._inboundQueues[t].length-1].shift()],i.AWTEventsDroppedReason.QueueFull),!0;t++}return!1},e.prototype._batchEvents=function(e){for(var t=i.AWTEventPriority.High;t>=e;){for(;this._inboundQueues[t][0].length>0;){var n=this._inboundQueues[t][0].pop();this._queueSize--,this._batcher.addEventToBatch(n)}t--}this._batcher.flushBatch()},e.prototype._uploadNow=function(e){var t=this;this.hasEvents()&&this.sendEventsForPriorityAndAbove(i.AWTEventPriority.Low),this._checkOutboundQueueEmptyAndSent(function(){t._removeFirstQueues(),null!=e&&e(),t._uploadNowQueue.length>0?setTimeout(function(){return t._uploadNow(t._uploadNowQueue.shift())},0):(t._isCurrentlyUploadingNow=!1,t.hasEvents()&&o.default.scheduleTimer())})},e.prototype._checkOutboundQueueEmptyAndSent=function(e){var t=this;this._httpManager.isCompletelyIdle()?e():setTimeout(function(){return t._checkOutboundQueueEmptyAndSent(e)},250)},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.AWTPropertyType=i.AWTPropertyType,t.AWTPiiKind=i.AWTPiiKind,t.AWTEventPriority=i.AWTEventPriority,t.AWTEventsDroppedReason=i.AWTEventsDroppedReason,t.AWTEventsRejectedReason=i.AWTEventsRejectedReason,t.AWTCustomerContentKind=i.AWTCustomerContentKind;var r=n(22);t.AWTUserIdType=r.AWTUserIdType,t.AWTSessionState=r.AWTSessionState;var o=n(55);t.AWT_BEST_EFFORT=o.AWT_BEST_EFFORT,t.AWT_NEAR_REAL_TIME=o.AWT_NEAR_REAL_TIME,t.AWT_REAL_TIME=o.AWT_REAL_TIME;var a=n(21);t.AWTEventProperties=a.default;var s=n(54);t.AWTLogger=s.default;var c=n(50);t.AWTLogManager=c.default;var l=n(100);t.AWTTransmissionManager=l.default;var u=n(52);t.AWTSerializer=u.default;var d=n(31);t.AWTSemanticContext=d.default,t.AWT_COLLECTOR_URL_UNITED_STATES="https://us.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_GERMANY="https://de.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_JAPAN="https://jp.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_AUSTRALIA="https://au.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_EUROPE="https://eu.pipe.aria.microsoft.com/Collector/3.0/",t.AWT_COLLECTOR_URL_USGOV_DOD="https://pf.pipe.aria.microsoft.com/Collector/3.0",t.AWT_COLLECTOR_URL_USGOV_DOJ="https://tb.pipe.aria.microsoft.com/Collector/3.0"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Default=0]="Default",e[e.User=1]="User"}(t.EcsConfigType||(t.EcsConfigType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_NAME="Skype",t.CONFIG_ID="ConfigIDs",t.GATEWAY_PATH={compositeToken:"rtcgateway/token/composite",ecs:"rtcgateway/ecs",registration:"rtcgateway/registrar/registrations"},t.HOSTS={urls:["https://ecs.office.com"]},t.ERR_UNSUPPORTED_TYPE="This type of config is not currently supported.",t.ERR_EARLY_CALL="Ecs Service has not yet responded. Try calling this API again in sometime.",t.ERR_DUPLICATE_INIT="Possible duplicate call. Ecs already initialized for this confiugration definition."},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),r=function(){function e(e){this._cache=e,this.telemetryEventAdded=new i.default}return e.prototype.sendTelemetryEvent=function(t){var n=t.getEventName(),i=t.getAttributes(),r=!1,o=this._cache.getEcsConfig();if(o&&e._containsEcsClientTelemetryConfig(o.config)){var a=o.config.ECSCONFIG;a&&a.ecsClientTelemetry&&(r=!!a.ecsClientTelemetry[n])}r&&this.telemetryEventAdded.fire(n,i)},e._containsEcsClientTelemetryConfig=function(e){return!!e&&!!e.ECSCONFIG&&!!e.ECSCONFIG.ecsClientTelemetry},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),r=n(7),o=function(){function e(){this.skypeTokenChanged=new i.default}return e.prototype.putSkypeTokenData=function(e){if(this._data=e,this.isSkypeTokenValid()&&this.skypeTokenChanged.fire(),this.isSkypeTokenValid()&&this._validSkypeTokenDeferral){var t=this._validSkypeTokenDeferral;this._validSkypeTokenDeferral=void 0,t.resolve(void 0)}},e.prototype.isSkypeTokenValid=function(){var e=this._data;return!!e&&!!e.skypeToken&&e.skypeTokenExpiration>Date.now()},e.prototype.getSkypeToken=function(){var e=this._data;if(!e||!e.skypeToken)throw"No Skype Token provided";return e.skypeToken},e.prototype.getSkypeTokenHash=function(e){return void 0===e?0:e.split("").reduce(function(e,t){return(101*e+t.charCodeAt(0))%999727999},e.length)},e.prototype.waitForValidSkypeToken=function(){return this.isSkypeTokenValid()?r.Resolved():(this._validSkypeTokenDeferral||(this._validSkypeTokenDeferral=r.Defer()),this._validSkypeTokenDeferral.promise())},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.getAttributes=function(){return{Source:"ecs_client"}},e}();t.TelemetryEventBase=i},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n,i,r,o,a,s,c,l,u,d,p,f){var h=e.call(this)||this;return h._responseTime=t,h._responseCode=n,h._fetchAttempts=i,h._hasValidToken=r,h._serverEndpoint=o,h._etag=a,h._fetchDurationValid=s,h._cacheAvailable=c,h._responseSize=l,h._configAge=u,h._configExpired=d,h._fetchStart=p,h._fetchEnd=f,h}return i(t,e),t.prototype.getEventName=function(){return"ecs_tsclient_fetch_config"},t.prototype.getAttributes=function(){var t=e.prototype.getAttributes.call(this);return t.fetch_delay_ms=this._responseTime,t.fetch_response_code=this._responseCode,t.fetch_attempts=this._fetchAttempts,t.authenticated_user=this._hasValidToken,t.url=this._serverEndpoint,t.fetched_etag=this._etag,t.fetch_duration_valid=this._fetchDurationValid,t.cache_available=this._cacheAvailable,t.response_size=this._responseSize,t.config_age=this._configAge,t.config_expired=this._configExpired,t.fetch_start=this._fetchStart,t.fetch_end=this._fetchEnd,t},t}(n(118).TelemetryEventBase);t.EcsConfigFetchResponse=r},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(33),o=n(56),a=function(){function e(e){this._defaultOptions={excludeEndpointUrl:!1,withCredentials:!1,retries:0},this._endpointUrl=e}return e.prototype._performApiCall=function(e,t,n,a){var s=this;void 0===a&&(a={});var c=i(i({},this._defaultOptions),a);n&&(c.sendData=n),c.eTag&&(c.augmentHeaders||(c.augmentHeaders={}),c.augmentHeaders["If-None-Match"]=c.eTag),c.contentType||(c.contentType=r.isString(c.sendData)?"form":"json");var l=c.excludeEndpointUrl?e:this._endpointUrl+e;return new o.SimpleWebRequest(t,l,c,function(){return s._getHeaders(c)},function(){return s._blockRequestUntil(c)}).start().then(function(e){return s._processSuccessResponse(e),e})},e.prototype._getHeaders=function(e){return{}},e.prototype._blockRequestUntil=function(e){},e.prototype._processSuccessResponse=function(e){},e.prototype.performApiGet=function(e,t){return this.performApiGetDetailed(e,t).then(function(e){return e.body})},e.prototype.performApiGetDetailed=function(e,t){return this._performApiCall(e,"GET",void 0,t)},e.prototype.performApiPost=function(e,t,n){return this.performApiPostDetailed(e,t,n).then(function(e){return e.body})},e.prototype.performApiPostDetailed=function(e,t,n){return this._performApiCall(e,"POST",t,n)},e.prototype.performApiPatch=function(e,t,n){return this.performApiPatchDetailed(e,t,n).then(function(e){return e.body})},e.prototype.performApiPatchDetailed=function(e,t,n){return this._performApiCall(e,"PATCH",t,n)},e.prototype.performApiPut=function(e,t,n){return this.performApiPutDetailed(e,t,n).then(function(e){return e.body})},e.prototype.performApiPutDetailed=function(e,t,n){return this._performApiCall(e,"PUT",t,n)},e.prototype.performApiDelete=function(e,t,n){return this.performApiDeleteDetailed(e,t,n).then(function(e){return e.body})},e.prototype.performApiDeleteDetailed=function(e,t,n){return this._performApiCall(e,"DELETE",t,n)},e}();t.GenericRestClient=a},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(57)),i(n(120)),i(n(56))},function(e,t,n){e.exports=n(121)},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=n(122),c=n(7),l=n(23),u=n(119),d=function(e){function t(t,n,i,r,o,a,s,c){var l=e.call(this,t)||this;if(l._config=n,l._skypeTokenData=i,l._appActiveData=r,l._allowBackgroundFetchData=o,l._etag=a,l._getUserConfig=s,l._apiPath="/config/v1/"+l._config.getConfig().clientName+"/"+l._config.getConfig().clientVersion,c){var u=Object.keys(c).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(c[e].toString())});u&&(l._apiPath+="?"+u.join("&"))}return l}return i(t,e),t.prototype._blockRequestUntil=function(e){var t=this;if(this._getUserConfig&&!this._skypeTokenData.isSkypeTokenValid()&&console.log("ECS - Delaying User config fetch until we have a valid SkypeToken"),!this._appActiveData.isAppActive()&&!this._allowBackgroundFetchData.isBackgroundFetchAllowed()){var n=this._getUserConfig?"User config":"config";console.log("ECS - Delaying "+n+" fetch until the app is active (or background fetch is allowed)")}return c.race([this._appActiveData.waitForAppActive(),this._allowBackgroundFetchData.waitForBackgroundFetchAllowed()]).then(function(){if(t._getUserConfig)return t._skypeTokenData.waitForValidSkypeToken()}).then(function(){a=Date.now()})},t.prototype._getHeaders=function(){var e={};return this._etag&&(e["If-None-Match"]=this._etag),this._getUserConfig&&(e.Authorization=this._skypeTokenData.getSkypeToken()),e},t.prototype.getConfig=function(){var t=this._config.getConfig().fetchTimeout;return void 0!==t&&(t<0?t=0:t>0&&t<3e4&&(t=3e4)),e.prototype.performApiGetDetailed.call(this,this._apiPath,{timeout:t})},t}(s.GenericRestClient),p=function(){function e(e,t,n,i,r){this._config=e,this._skypeTokenData=t,this._appActiveData=n,this._allowBackgroundFetchData=i,this._telemetryManager=r,this._ecsFailureBackoffTimer=new s.ExponentialTime(1e3,3e5),this._cacheMaxAgeRegex=/.*max-age=(\d+).*/gi,this._serverIndex=NaN}return e.prototype.getConfig=function(e,t,n){var i=this,s=this._config.getConfig().hosts;if((isNaN(this._serverIndex)||this._serverIndex>s.length-1)&&(this._serverIndex=Math.floor(Math.random()*s.length)),!s||!s.length)return c.Rejected(new Error("no configuration service endpoint"));var p=c.Defer(),f=0,h=function(){var g=e&&e.eTag?e.eTag:void 0,m=new d(s[i._serverIndex],i._config,i._skypeTokenData,i._appActiveData,i._allowBackgroundFetchData,g,t,n);f++,m.getConfig().then(function(n){var d=n.headers.etag,h=n.headers.expires;if(n.body&&n.body.Headers&&(d||(d=n.body.Headers.ETag),h||(h=n.body.Headers.Expires)),o=Date.now(),!d||!h)return console.warn("ECS - Service returned an empty ETag or Expiration header: "+JSON.stringify(n)),c.Rejected();var m,v=new Date(i._calculateExpirationDate(n.headers)).getTime();if(304===n.statusCode&&e)(m=r({},e)).eTag=d,m.expiration=v,m.cacheUpdateTime=o,m.lastFetchTokenHash=i._skypeTokenData.getSkypeTokenHash(n.requestHeaders.Authorization);else{if("object"!=typeof n.body)return console.warn("ECS - Service returned invalid response "+JSON.stringify(n)),c.Rejected();m={config:n.body,configType:t?l.EcsConfigType.User:l.EcsConfigType.Default,eTag:d,expiration:v,cacheUpdateTime:a,lastFetchTokenHash:i._skypeTokenData.getSkypeTokenHash(n.requestHeaders.Authorization),appVersion:i._config.getConfig().clientVersion}}var y=o-a,S=!(y<0||y>31536e6),_=e?Date.now()-e.cacheUpdateTime:0;i._telemetryManager.sendTelemetryEvent(new u.EcsConfigFetchResponse(y,n.statusCode,f,i._skypeTokenData.isSkypeTokenValid(),s[i._serverIndex],d,S,!!g,JSON.stringify(n).length,_,!(e&&e.expiration-Date.now()>0),a,o)),i._ecsFailureBackoffTimer.reset(),p.resolve(m)}).catch(function(){i._serverIndex=(i._serverIndex+1)%s.length,setTimeout(function(){h()},i._ecsFailureBackoffTimer.getTimeAndCalculateNext())})};return h(),p.promise()},e.prototype._calculateExpirationDate=function(e){var t=Date.now()+1728e5;if(e.date&&e.expires){var n=new Date(e.date).getTime(),i=Date.now()-n,r=new Date(e.expires).getTime();return isNaN(r)?t:Math.min(t,r+i)}var o=this._cacheMaxAgeRegex.exec(e["cache-control"]);return this._cacheMaxAgeRegex.lastIndex=0,o&&2===o.length?Math.min(t,Date.now()+1e3*Number(o[1])):Date.now()+18e5},e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(23),r=n(123),o=function(){function e(e,t,n,o,a,s){var c=this;this._config=e,this._skypeTokenData=t,this._cache=n,this._isFetchingSettings={},this._pendingFetch={},this._paused=!1,this._fetchEcsSettingsIfNeeded=function(e){var t=c._config.getConfig(),n=c._cache.getEcsConfigByType(e);if(-1!==t.configsToFetch.indexOf(e)&&!c._isFetchingSettings[e])if(n||!c._pendingFetch[e]){var r=n?n.expiration-Date.now():-1;r<=0?c._fetchSkypeEcsSettings(e):n&&e===i.EcsConfigType.User&&c._skypeTokenData.isSkypeTokenValid()&&n.lastFetchTokenHash!==c._skypeTokenData.getSkypeTokenHash(c._skypeTokenData.getSkypeToken())?c._fetchSkypeEcsSettings(e):setTimeout(function(){return c._fetchEcsSettingsIfNeeded(e)},r)}else c._fetchSkypeEcsSettings(e)},this._fetchSkypeEcsSettings=function(e,t){(void 0===t&&(t=!1),c._isFetchingSettings[e]||c._paused&&!t)?c._pendingFetch[e]=!0:(c._pendingFetch[e]=!1,c._isFetchingSettings[e]=!0,c._config.getConfig().getEcsParameters().catch(function(){return console.warn("ECS - Failed to fetch ECS fetching parameters"),{}}).then(function(t){return c._ecsClient.getConfig(c._cache.getEcsConfig(),e===i.EcsConfigType.User,t)}).then(function(t){console.log("ECS - Config fetch complete"),c._isFetchingSettings[e]=!1,c._cache.putConfig(t),c._fetchEcsSettingsIfNeeded(e)}))},this._ecsClient=new r.default(this._config,this._skypeTokenData,o,a,s)}return e.prototype.initialize=function(){var e=this;this.updateConfigsToFetch(),this._skypeTokenData.skypeTokenChanged.subscribe(function(){return e._fetchEcsSettingsIfNeeded(i.EcsConfigType.User)})},e.prototype.updateConfigsToFetch=function(){for(var e=this._config.getConfig(),t=0,n=e.configsToFetch;t<n.length;t++){(o=n[t])in this._isFetchingSettings||(this._isFetchingSettings[o]=!1),o in this._isFetchingSettings||(this._pendingFetch[o]=!1)}for(var i=0,r=e.configsToFetch;i<r.length;i++){var o=r[i],a=this._cache.getEcsConfigByType(o);!a||a.appVersion&&a.appVersion!==e.clientVersion?this._fetchSkypeEcsSettings(o,!0):this._fetchEcsSettingsIfNeeded(o)}},e.prototype.requestUpdate=function(){for(var e=0,t=this._config.getConfig().configsToFetch;e<t.length;e++){var n=t[e];this._fetchSkypeEcsSettings(n)}},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){this._paused=!1;for(var e=0,t=this._config.getConfig().configsToFetch;e<t.length;e++){var n=t[e];this._fetchEcsSettingsIfNeeded(n)}},e}();t.default=o},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.initialize=function(e){if(this._config)throw"ECS Configuration already initialized";this._config=e},e.prototype.getConfig=function(){if(!this._config)throw"ECS Configuration not yet initialized";return this._config},e.prototype.setConfigsToFetch=function(e){if(!this._config)throw"ECS Configuration not yet initialized";this._config=i({},this._config,{configsToFetch:e})},e.prototype.setFetchTimeout=function(e){if(!this._config)throw"ECS Configuration not yet initialized";this._config=i({},this._config,{fetchTimeout:e})},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),r=n(7),o=n(23),a=function(){function e(e){this._config=e,this.configUpdated=new i.default,this._cachedConfigs={}}return e.prototype.initialize=function(){return this.updateConfigsToFetch()},e.prototype.updateConfigsToFetch=function(){var e=this,t=this._config.getConfig(),n=t.databaseInterface,i=t.configsToFetch;if(!n)return r.Resolved();for(var o=[],a=function(t){if(s._cachedConfigs[t])return"continue";o.push(n.getData(t).then(function(n){n&&(e._cachedConfigs[t]=n)}).catch(function(){return r.Resolved()}))},s=this,c=0,l=i;c<l.length;c++){a(l[c])}return r.all(o).then(function(){o.length>0&&e.configUpdated.fire()})},e.prototype.getEcsConfig=function(){return this._cachedConfigs[o.EcsConfigType.User]||this._cachedConfigs[o.EcsConfigType.Default]},e.prototype.getEcsConfigByType=function(e){return this._cachedConfigs[e]},e.prototype.putConfig=function(e){var t=this.getEcsConfig();this._cachedConfigs[e.configType]=e;var n=this.getEcsConfig();(n&&n.configType===e.configType||t&&n&&t.configType!==n.configType)&&this.configUpdated.fire();var i=this._config.getConfig().databaseInterface;return i?i.putData(e.configType,e):r.Resolved()},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),r=function(){function e(){this._isActive=!1}return e.prototype.putAppActive=function(e){if(this._isActive=e,this.isAppActive()&&this._appActiveDeferral){var t=this._appActiveDeferral;this._appActiveDeferral=void 0,t.resolve(void 0)}},e.prototype.isAppActive=function(){return this._isActive},e.prototype.waitForAppActive=function(){return this.isAppActive()?i.Resolved():(this._appActiveDeferral||(this._appActiveDeferral=i.Defer()),this._appActiveDeferral.promise())},e}();t.default=r},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r=1,o={},a=!1,s=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){u(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&u(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),i=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){u(e.data)},i=function(t){e.port2.postMessage(t)}}():s&&"onreadystatechange"in s.createElement("script")?function(){var e=s.documentElement;i=function(t){var n=s.createElement("script");n.onreadystatechange=function(){u(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():i=function(e){setTimeout(u,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var a={callback:e,args:t};return o[r]=a,i(r),r++},c.clearImmediate=l}function l(e){delete o[e]}function u(e){if(a)setTimeout(u,0,e);else{var t=o[e];if(t){a=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}(t)}finally{l(e),a=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(24),n(11))},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(128),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(24))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),r=function(){function e(){this._isAllowed=!1}return e.prototype.putBackgroundFetchAllowed=function(e){if(this._isAllowed=e,this.isBackgroundFetchAllowed()&&this._isAllowedDeferral){var t=this._isAllowedDeferral;this._isAllowedDeferral=void 0,t.resolve(void 0)}},e.prototype.isBackgroundFetchAllowed=function(){return this._isAllowed},e.prototype.waitForBackgroundFetchAllowed=function(){return this.isBackgroundFetchAllowed()?i.Resolved():(this._isAllowedDeferral||(this._isAllowedDeferral=i.Defer()),this._isAllowedDeferral.promise())},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(130),r=n(127),o=n(126),a=n(125),s=n(23);t.Models=s;var c=n(124),l=n(117),u=n(116),d=function(){function e(){this._allowBackgroundFetchData=new i.default,this._appActiveData=new r.default,this._config=new a.default,this._cache=new o.default(this._config),this._skypeTokenData=new l.default,this._telemetryManager=new u.default(this._cache),this._scheduler=new c.default(this._config,this._skypeTokenData,this._cache,this._appActiveData,this._allowBackgroundFetchData,this._telemetryManager),this.telemetryEventAdded=this._telemetryManager.telemetryEventAdded,this.configUpdated=this._cache.configUpdated}return e.prototype.initialize=function(e){var t=this;return this._config.initialize(e),this._skypeTokenData.putSkypeTokenData(e.initialSkypeTokenData),this._appActiveData.putAppActive(e.initialAppActiveState),this._cache.initialize().then(function(){t._scheduler.initialize()})},e.prototype.getConfig=function(){return this._cache.getEcsConfig()},e.prototype.getConfigType=function(){var e=this._cache.getEcsConfig();if(e)return e.configType},e.prototype.requestUpdate=function(){this._scheduler.requestUpdate()},e.prototype.pause=function(){this._scheduler.pause()},e.prototype.resume=function(){this._scheduler.resume()},e.prototype.setAllowBackgroundFetch=function(e){this._allowBackgroundFetchData.putBackgroundFetchAllowed(e)},e.prototype.useSkypeToken=function(e,t){this._skypeTokenData.putSkypeTokenData({skypeToken:e,skypeTokenExpiration:t})},e.prototype.setAppActive=function(e){this._appActiveData.putAppActive(e)},e.prototype.setConfigsToFetch=function(e){var t=this;return this._config.setConfigsToFetch(e),this._cache.updateConfigsToFetch().then(function(){t._scheduler.updateConfigsToFetch()})},e.prototype.setFetchTimeout=function(e){this._config.setFetchTimeout(e)},e}();t.default=d},function(e,t,n){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(131)),o=i(n(7)),a=n(17),s=i(n(115)),c=n(114);t.EcsConfigType=c.EcsConfigType;class l{constructor(e,t){this.skypeToken=e,this.skypeTokenExpiration=t}}t.EcsSkypeToken=l;t.EcsConfigObj=class{constructor(e,t,n,i,r=!0,o,a,s,c){this.configType=e,this.queryParameters=t,this.ecsConfigReceiver=n,this.platformId=i,this.isAppInitiallyInForeground=r,this.userRawSkypeToken=o,this.userSkypeTokenExpiration=a,this.projectName=s,this.ecsHosts=c}};t.EcsConfigFetcher=class{constructor(e,t){this._logger=e,this._ecsClient=t||new r.default,this._isSubscribed=this._initialized=!1}subscribeEcsConfig(e){return e.configType!==c.EcsConfigType.Default&&e.configType!==c.EcsConfigType.User?Promise.reject(s.ERR_UNSUPPORTED_TYPE):(this._resetConfigCache(e),this._initialized||this._isSubscribed?Promise.reject(s.ERR_DUPLICATE_INIT):Promise.resolve(this._initializeEcsConfig(e).then(()=>{this._ecsClient.configUpdated.subscribe(()=>{this._isSubscribed=!0,this._config=this._ecsClient.getConfig(),void 0!==e.ecsConfigReceiver&&this._config&&e.ecsConfigReceiver(this._config.config)})})))}dispose(){try{this._ecsClient.configUpdated.dispose()}catch(e){this._logger.warn(`Failed to dispose ECS config update, e=${e}`)}}getConfigType(){return void 0===this._configDefCache?Promise.reject(s.ERR_EARLY_CALL):Promise.resolve(this._configDefCache.configType)}getETag(){return void 0===this._config?Promise.reject(s.ERR_EARLY_CALL):Promise.resolve(this._config.eTag)}getConfigId(e){return void 0===this._config?Promise.reject(s.ERR_EARLY_CALL):Promise.resolve(this._config.config[s.CONFIG_ID][e])}setAllowBackgroundFetch(e){return this._ecsClient.setAllowBackgroundFetch(e),Promise.resolve()}setSkypeToken(e,t){return this._ecsClient.useSkypeToken(e,t),Promise.resolve()}setAppActiveState(e){return this._ecsClient.setAppActive(e),Promise.resolve()}_resetConfigCache(e){void 0===e||void 0===this._configDefCache||e.queryParameters===this._configDefCache.queryParameters&&e.configType===this._configDefCache.configType||(this._isSubscribed=!1,this._initialized=!1,this._config=void 0),this._configDefCache=e}_initializeEcsConfig(e){this._initialized=!0;const t={hosts:e.ecsHosts?e.ecsHosts:this._getHostUrls(),clientName:s.CLIENT_NAME,clientVersion:this._getClientVersion(e.platformId),configsToFetch:this._getLibConfigType(e.configType),getEcsParameters:()=>this._getQueryParameterPromise(e.queryParameters),initialAppActiveState:e.isAppInitiallyInForeground,initialSkypeTokenData:new l(e.userRawSkypeToken,e.userSkypeTokenExpiration)};return new Promise((e,n)=>{this._ecsClient.initialize(t).then(e,n)})}_getHostUrls(){return s.HOSTS.urls}_getClientVersion(e){let t="";return t+=e||a.getPlatformId(),t+="_",t+=a.UI_VERSION}_getLibConfigType(e){return[e===c.EcsConfigType.Default?r.Models.EcsConfigType.Default:r.Models.EcsConfigType.User]}_getQueryParameterPromise(e={}){return o.Resolved(e)}}},function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function i(e){this.message=e}i.prototype=new Error,i.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new i("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,o,a=0,s=0,c="";o=t.charAt(s++);~o&&(r=a%4?64*r+o:o,a++%4)?c+=String.fromCharCode(255&r>>(-2*a&6)):0)o=n.indexOf(o);return c}},function(e,t,n){var i=n(133);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(i(e).replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}(t)}catch(e){return i(t)}}},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),c=n(8),l=n(132),u=n(16),d=n(32),p=n(29),f=n(99),h=n(3),g=a(n(18)),m=n(47),v=n(4),y=n(65),S=n(26),_=n(2),E=n(14),T=n(64),C=n(35),I=n(62);class A{constructor(e){this._pendingOutgoingCalls=new Map,this._eventEmitter=new c.EventEmitter,this._calls=[],this._getCallRegistry=((e,t)=>o(this,void 0,void 0,function*(){const n={id:t,displayName:"",tokenProvider:this.tokenProvider},i=yield e.createCallRegistry(n);return yield i.login(n),i.setConfiguration({acsResourceId:this.resourceId,clientType:"none"}),i.on("callAdded",this._handleCallAdded),i.on("callRemoved",this._handleCallRemoved),i})),this._createCall=(e=>{var t,n,i,r,o,a,s,c,l,u,d;let v,y,S,T=null===(t=null==e?void 0:e.callContext)||void 0===t?void 0:t.threadId;const A=null===(n=null==e?void 0:e.callContext)||void 0===n?void 0:n.groupId,b=null===(i=null==e?void 0:e.callContext)||void 0===i?void 0:i.meetingLink;if(this.validateCallConfiguration(null==e?void 0:e.callContext),A){const e=A.startsWith("19:")||A.startsWith("99:");if(!g.validateGuid(A)&&!e)throw new _.CommunicationErrorImpl("Group Id must be a valid GUID");T=e?A:`99:${this.resourceId}.${A}`}if(b&&(T=(y=I.parseMeetingUrl(b)).threadId,v=y.messageId),(null===(r=null==e?void 0:e.callContext)||void 0===r?void 0:r.threadId)&&(null===(o=null==e?void 0:e.callContext)||void 0===o?void 0:o.organizerId)&&(null===(a=null==e?void 0:e.callContext)||void 0===a?void 0:a.tenantId)&&(y={threadId:T=null===(s=null==e?void 0:e.callContext)||void 0===s?void 0:s.threadId,messageId:v=(null===(c=null==e?void 0:e.callContext)||void 0===c?void 0:c.messageId)?null===(l=null==e?void 0:e.callContext)||void 0===l?void 0:l.messageId.toString():"0",organizerId:null===(u=null==e?void 0:e.callContext)||void 0===u?void 0:u.organizerId,tenantId:null===(d=null==e?void 0:e.callContext)||void 0===d?void 0:d.tenantId}),E.CallStack.getInitializedTsStack()){const t=m.generateCauseId(),n=p.generateGuid(),i=p.generateGuid(),r=new f.CallImpl({callId:n,groupId:A},this);this._pendingOutgoingCalls.set(n,r),this._calls.push(r);const o=this._tsCallRegistry.createCall(T||"",n,i,v,t);return r.bindTsCall(o),this._observeSpoolCall(r),this._eventEmitter.emit("callsUpdated",{added:[r],removed:[]}),y&&(S={meetingType:"0"===y.messageId?1:2,tenantId:y.tenantId,organizerId:y.organizerId,replyChainMessageId:y.messageId}||void 0),o.init({threadId:T||"",messageId:v||"",meetingInfo:S,mediaPeerType:2}),e.participants&&e.participants.forEach(e=>{o.addParticipant(C.getMriFromIdentifier(e))}),r.startCallInternal(e.startCallOptions),this.sendCallStartedEvent({direction:h.CallDirection.Outgoing,joinExistingCall:!1,call:r}),r}throw new _.CommunicationErrorImpl("Call stack did not initialize").setCode(500)}),this._handleCallAdded=(e=>{if(this._pendingOutgoingCalls.get(e.callId)){const t=e.callId;this._pendingOutgoingCalls.delete(t)}else{const t=e.on("callStateChanged",()=>{if(1===e.state){let n=e.threadId;n&&n.startsWith("99:")&&(n=n.substr(3).split(".")[1]);const i=e.callId;t.dispose();const r=new f.CallImpl({callId:i,groupId:n,isIncoming:!0},this);this._calls.splice(this._calls.indexOf(r),1),this._calls.push(r),this._eventEmitter.emit("callsUpdated",{added:[r],removed:[]}),r.bindTsCall(e),this._observeSpoolCall(r)}})}}),this._observeSpoolCall=(e=>{e.on("callIdChanged",()=>{this._calls.splice(this._calls.indexOf(e),1),this._calls.push(e)}),e.on("callStateChanged",()=>{if("Disconnected"===e.state){E.CallStack.getInitializedTsStack()?this._tsCallRegistry.deleteCall(e._tsCall):this.logger.info("Unable to remove call from registry")}})}),this._handleCallRemoved=(e=>{this.logger.info(`removing callId=${e.callId}`);const t=this._calls.find(t=>t.id===e.callId);t&&(this._calls.splice(this._calls.indexOf(t),1),t.dispose(),this._eventEmitter.emit("callsUpdated",{added:[],removed:[t]}),this.logger.info("call removed"))}),this.logger=e,this._ecsFetcher=new l.EcsConfigFetcher(this.logger)}get calls(){return this._calls}get deviceManager(){if(!this._deviceManager)throw this.logger.error("DeviceManager is undefined"),new _.CommunicationErrorImpl("Device manager is undefined").setCode(500);return this._deviceManager}on(e,t){this._eventEmitter.on(e,t)}off(e,t){this._eventEmitter.off(e,t)}getTelemetryMetadata(){return{resourceId:this.resourceId}}call(e,t={}){var n;if(this.assertCallUserIds(e),this.assertCallOptions(t),e.some(e=>"Unknown"===s.getIdentifierKind(e).kind))throw new _.CommunicationErrorImpl("Unkown identifiers are not allowed");let i=null===(n=t.audioOptions)||void 0===n?void 0:n.muted;return void 0===i&&(i=!1),this.logger.info(`call with video=${!!t.videoOptions},muted=${i}`),this._createCall({participants:e,startCallOptions:t})}join(e,t){var n;let i=null===(n=t.audioOptions)||void 0===n?void 0:n.muted;return void 0===i&&(i=!1),this.logger.info(`join with video=${!!t.videoOptions},muted=${i}`),this._createCall({callContext:e,startCallOptions:t})}initialize(e,t,n,i){var r;return o(this,void 0,void 0,function*(){if(this.onDisposedCallback=n,this._callStack=e,!t){const e=new _.CommunicationErrorImpl("No CommunicationUserCredential provided");throw e.setCode(400),e}const a=null===(r=yield t.getToken())||void 0===r?void 0:r.token;if(!a)throw new _.CommunicationErrorImpl("Client token not provided").setCode(400);const s=g.parseJWT(a);this.resourceId=null==s?void 0:s.resourceId;const c=null==s?void 0:s.skypeid;if(!c)throw new _.CommunicationErrorImpl("Token does not contain identity").setCode(400);this.tokenProvider=(()=>o(this,void 0,void 0,function*(){var e;const n=yield t.getToken(),i=null==n?void 0:n.token;if(this.resourceId=null===(e=g.parseJWT(i))||void 0===e?void 0:e.resourceId,i)return i;throw new _.CommunicationErrorImpl("Unable to get token from token credential").setCode(400)})),this.logger.info(`registry created for version number=${u.getSdkVersion()}`);const d=yield this._callStack.getStack(this),p=(yield t.getToken()).token,f=new l.EcsConfigObj(l.EcsConfigType.User,yield this.getEcsQueryParameters(d),e=>o(this,void 0,void 0,function*(){S.EcsProvider.instance.setConfig(e),this._ecsFetcher&&d&&void 0!==e&&d.getEcsProvider().setEcsConfig({ecsBlob:JSON.stringify(e),userIdentity:"",etag:yield this._ecsFetcher.getETag()})}),void 0,void 0,p,1e3*g.parseJWT(p).exp);this._ecsFetcher.subscribeEcsConfig(f),this._tsCallRegistry=yield this._getCallRegistry(d,c),(null==i?void 0:i.displayName)&&(this._tsCallRegistry.updateDisplayName(null==i?void 0:i.displayName),this.displayName=null==i?void 0:i.displayName),this._deviceManager=new T.DeviceManagerImpl(d.getDeviceManager(),this.logger),yield this._deviceManager.initialize()})}dispose(){var e,t;return o(this,void 0,void 0,function*(){yield null===(e=this._callStack)||void 0===e?void 0:e.dispose(),delete this._callStack,null===(t=this._deviceManager)||void 0===t||t.dispose(),this.onDisposedCallback()})}getEcsQueryParameters(e){return o(this,void 0,void 0,function*(){let t;try{if(!(t=JSON.parse(yield e.getEcsProvider().getEcsQueryParameters())))throw new _.CommunicationErrorImpl("ecs query parms empty");t.CLRelease.match(/^\d+\.\d+\.\d+\.\d+$/)||delete t.CLRelease}catch(e){throw this.logger.error(e),new _.CommunicationErrorImpl("Failed to initialize callclient")}return t})}sendCallStartedEvent(e){d.TelemetryLogManager.instance.sendEvent({name:d.Events.spool_tscalling_call_started,tenant:d.TelemetryLogManager.SPOOL_TENANT,properties:{direction:e.direction,groupCall:2===e.call._tsCall.callType,joinExistingCall:e.joinExistingCall,callId:e.call.id,participantId:e.call._tsCall.participantId,endpointId:e.call._tsCall.endpointId}})}validateCallConfiguration(e){if(e&&(e.threadId&&e.groupId||e.threadId&&e.meetingLink||e.groupId&&e.meetingLink))throw new _.CommunicationErrorImpl("Invalid call configuartion").setCode(400)}assertCallUserIds(e){return g.assertIsObject(e,"userIds must be object"),g.assertNotNull(e,"userIds cannot be null"),e instanceof Array&&g.assertIsArrayOfSupportedIdentifiers(e,"userIds must be array of CommunicationUser or PhoneNumber or CallingApplication"),!0}assertCallOptions(e){var t;return g.assertIsObject(e,"Place call options must be object"),g.assertNotNull(e,"options cannot be null"),e.hasOwnProperty("muted")&&g.assertIsBoolean(null===(t=e.audioOptions)||void 0===t?void 0:t.muted,"muted property of options must be boolean"),!0}}i([y.loggerProperty,r("design:type",Object)],A.prototype,"logger",void 0),i([v.syncOperation(h.CallAgentOperation.Call),r("design:type",Function),r("design:paramtypes",[Array,Object]),r("design:returntype",Object)],A.prototype,"call",null),i([v.syncOperation(h.CallAgentOperation.Join),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Object)],A.prototype,"join",null),i([v.asyncOperation(h.CallAgentOperation.Dispose),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],A.prototype,"dispose",null),t.CallAgentImpl=A},function(e,t,n){(function(e,t){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;!function(n){!function(i){var r="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=a(n);function a(e,t){return function(n,i){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:i}),t&&t(n,i)}}void 0===r.Reflect?r.Reflect=n:o=a(r.Reflect,o),function(t){var n=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,r=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,c=!a&&!s,l={create:a?function(){return L(Object.create(null))}:s?function(){return L({__proto__:null})}:function(){return L({})},has:c?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),d="object"==typeof e&&e.env&&"true"===e.env.REFLECT_METADATA_USE_MAP_POLYFILL,p=d||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[o]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var i=this._keys.length,r=n+1;r<i;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,i)},t.prototype.values=function(){return new n(this._keys,this._values,r)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[o]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function i(e,t){return e}function r(e,t){return t}function a(e,t){return[e,t]}}():Map,f=d||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new p}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[o]=function(){return this.keys()},e}():Set,h=new(d||"function"!=typeof WeakMap?function(){var e=16,t=l.create(),i=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&l.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?l.get(t,this._key):void 0},e.prototype.set=function(e,t){var n=o(e,!0);return n[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var e;do{e="@@WeakMap@@"+s()}while(l.has(t,e));return t[e]=!0,e}function o(e,t){if(!n.call(e,i)){if(!t)return;Object.defineProperty(e,i,{value:l.create()})}return e[i]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(){var t=function(e){if("function"==typeof Uint8Array)return"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e);return a(new Array(e),e)}(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",i=0;i<e;++i){var r=t[i];4!==i&&6!==i&&8!==i||(n+="-"),r<16&&(n+="0"),n+=r.toString(16).toLowerCase()}return n}}():WeakMap);function g(e,t,n){var i=h.get(e);if(E(i)){if(!n)return;i=new p,h.set(e,i)}var r=i.get(t);if(E(r)){if(!n)return;r=new p,i.set(t,r)}return r}function m(e,t,n){var i=g(t,n,!1);return!E(i)&&function(e){return!!e}(i.has(e))}function v(e,t,n){var i=g(t,n,!1);if(!E(i))return i.get(e)}function y(e,t,n,i){var r=g(n,i,!0);r.set(e,t)}function S(e,t){var n=[],i=g(e,t,!1);if(E(i))return n;for(var r=i.keys(),a=function(e){var t=P(e,o);if(!R(t))throw new TypeError;var n=t.call(e);if(!C(n))throw new TypeError;return n}(r),s=0;;){var c=M(a);if(!c)return n.length=s,n;var l=N(c);try{n[s]=l}catch(e){try{w(a)}finally{throw e}}s++}}function _(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function E(e){return void 0===e}function T(e){return null===e}function C(e){return"object"==typeof e?null!==e:"function"==typeof e}function I(e,t){switch(_(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=P(e,r);if(void 0!==i){var o=i.call(e,n);if(C(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(R(n)){var i=n.call(e);if(!C(i))return i}var r=e.valueOf;if(R(r)){var i=r.call(e);if(!C(i))return i}}else{var r=e.valueOf;if(R(r)){var i=r.call(e);if(!C(i))return i}var o=e.toString;if(R(o)){var i=o.call(e);if(!C(i))return i}}throw new TypeError}(e,"default"===n?"number":n)}function A(e){var t=I(e,3);return function(e){return"symbol"==typeof e}(t)?t:function(e){return""+e}(t)}function b(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function R(e){return"function"==typeof e}function O(e){return"function"==typeof e}function P(e,t){var n=e[t];if(null!=n){if(!R(n))throw new TypeError;return n}}function N(e){return e.value}function M(e){var t=e.next();return!t.done&&t}function w(e){var t=e.return;t&&t.call(e)}function D(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var n=e.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return t;var r=i.constructor;return"function"!=typeof r?t:r===e?t:r}function L(e){return e.__=void 0,delete e.__,e}t("decorate",function(e,t,n,i){if(E(n)){if(!b(e))throw new TypeError;if(!O(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var i=e[n],r=i(t);if(!E(r)&&!T(r)){if(!O(r))throw new TypeError;t=r}}return t}(e,t)}if(!b(e))throw new TypeError;if(!C(t))throw new TypeError;if(!C(i)&&!E(i)&&!T(i))throw new TypeError;return T(i)&&(i=void 0),n=A(n),function(e,t,n,i){for(var r=e.length-1;r>=0;--r){var o=e[r],a=o(t,n,i);if(!E(a)&&!T(a)){if(!C(a))throw new TypeError;i=a}}return i}(e,t,n,i)}),t("metadata",function(e,t){return function(n,i){if(!C(n))throw new TypeError;if(!E(i)&&!function(e){switch(_(e)){case 3:case 4:return!0;default:return!1}}(i))throw new TypeError;y(e,t,n,i)}}),t("defineMetadata",function(e,t,n,i){if(!C(n))throw new TypeError;E(i)||(i=A(i));return y(e,t,n,i)}),t("hasMetadata",function(e,t,n){if(!C(t))throw new TypeError;E(n)||(n=A(n));return function e(t,n,i){var r=m(t,n,i);if(r)return!0;var o=D(n);if(!T(o))return e(t,o,i);return!1}(e,t,n)}),t("hasOwnMetadata",function(e,t,n){if(!C(t))throw new TypeError;E(n)||(n=A(n));return m(e,t,n)}),t("getMetadata",function(e,t,n){if(!C(t))throw new TypeError;E(n)||(n=A(n));return function e(t,n,i){var r=m(t,n,i);if(r)return v(t,n,i);var o=D(n);if(!T(o))return e(t,o,i);return}(e,t,n)}),t("getOwnMetadata",function(e,t,n){if(!C(t))throw new TypeError;E(n)||(n=A(n));return v(e,t,n)}),t("getMetadataKeys",function(e,t){if(!C(e))throw new TypeError;E(t)||(t=A(t));return function e(t,n){var i=S(t,n);var r=D(t);if(null===r)return i;var o=e(r,n);if(o.length<=0)return i;if(i.length<=0)return o;var a=new f;var s=[];for(var c=0,l=i;c<l.length;c++){var u=l[c],d=a.has(u);d||(a.add(u),s.push(u))}for(var p=0,h=o;p<h.length;p++){var u=h[p],d=a.has(u);d||(a.add(u),s.push(u))}return s}(e,t)}),t("getOwnMetadataKeys",function(e,t){if(!C(e))throw new TypeError;E(t)||(t=A(t));return S(e,t)}),t("deleteMetadata",function(e,t,n){if(!C(t))throw new TypeError;E(n)||(n=A(n));var i=g(t,n,!1);if(E(i))return!1;if(!i.delete(e))return!1;if(i.size>0)return!0;var r=h.get(t);return r.delete(n),r.size>0||(h.delete(t),!0)})}(o)}()}(n||(n={}))}).call(this,n(11),n(24))},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"AzureLogger",function(){return c}),n.d(t,"setLogLevel",function(){return u}),n.d(t,"getLogLevel",function(){return d}),n.d(t,"createClientLogger",function(){return f});var i,r=n(5),o=n(12),a=new Set,s=void 0!==e&&e.env&&e.env.AZURE_LOG_LEVEL||void 0,c=Object(o.a)("azure");c.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.a.log.apply(o.a,Object(r.a)(e))};var l=["verbose","info","warning","error"];function u(e){var t,n;if(e&&!v(e))throw new Error("Unknown log level '"+e+"'. Acceptable values: "+l.join(","));i=e;var s=[];try{for(var c=Object(r.b)(a),u=c.next();!u.done;u=c.next()){var d=u.value;m(d)&&s.push(d.namespace)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}o.a.enable(s.join(","))}function d(){return i}s&&(v(s)?u(s):console.error("AZURE_LOG_LEVEL set to unknown log level '"+s+"'; logging is not enabled. Acceptable values: "+l.join(", ")+"."));var p={verbose:400,info:300,warning:200,error:100};function f(e){var t=c.extend(e);return h(c,t),{error:g(t,"error"),warning:g(t,"warning"),info:g(t,"info"),verbose:g(t,"verbose")}}function h(e,t){t.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.log.apply(e,Object(r.a)(t))}}function g(e,t){var n=Object.assign(e.extend(t),{level:t});if(h(e,n),m(n)){var i=o.a.disable();o.a.enable(i+","+n.namespace)}return a.add(n),n}function m(e){return!!(i&&p[e.level]<=p[i])}function v(e){return l.includes(e)}}.call(this,n(11))},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(137);n(136);const s=n(135),c=n(14),l=n(3),u=n(4),d=n(2),p=n(61);class f{constructor(e){if(!f.callClientInstance){if(null==e?void 0:e.logger)this._logger=new p.DefaultLogger(e.logger,[()=>"[CallClient]"]);else{const e=a.createClientLogger("ACS");a.setLogLevel("warning"),e.verbose.log=((...e)=>{console.log(...e)}),e.info.log=((...e)=>{console.info(...e)}),e.warning.log=((...e)=>{console.warn(...e)}),e.error.log=((...e)=>{console.error(...e)}),this._logger=new p.DefaultLogger(e,[()=>"[CallClient]"])}this._logger.info("CallClient created"),this._callStack=new c.CallStack(this._logger),f.callClientInstance=this}return f.callClientInstance}createCallAgent(e,t){return o(this,void 0,void 0,function*(){if(f.callAgentInstance)throw new d.CommunicationErrorImpl("A Call Agent instance has already been created.Please dispose of it before creating a new Call Client instance").setCode(400);try{const n=()=>{f.callAgentInstance=void 0};return f.callAgentInstance=new s.CallAgentImpl(this._logger),yield f.callAgentInstance.initialize(this._callStack,e,n,t),f.callAgentInstance}catch(e){throw f.callAgentInstance=void 0,new d.CommunicationErrorImpl(e)}})}getDeviceManager(){return o(this,void 0,void 0,function*(){if(!f.callAgentInstance)throw new d.CommunicationErrorImpl("Initialize CallAgent first").setCode(400);return f.callAgentInstance.deviceManager})}}i([u.asyncOperation(l.CallClientOpeartion.CreateCallAgent),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Promise)],f.prototype,"createCallAgent",null),i([u.asyncOperation(l.CallClientOpeartion.GetDeviceManager),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],f.prototype,"getDeviceManager",null),t.CallClient=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(138);t.CallClient=i.CallClient;var r=n(25);t.LocalVideoStream=r.LocalVideoStream;var o=n(60);t.Renderer=o.Renderer},function(e,t,n){"use strict";var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),r=new Uint8Array(16);var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(e){return"string"==typeof e&&o.test(e)},s=[],c=0;c<256;++c)s.push((c+256).toString(16).substr(1));var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n};t.a=function(e,t,n){var o=(e=e||{}).random||(e.rng||function(){if(!i)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=o[a];return t}return l(o)}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i={coreHttpVersion:"1.1.8",HTTP:"http:",HTTPS:"https:",HTTP_PROXY:"HTTP_PROXY",HTTPS_PROXY:"HTTPS_PROXY",HttpConstants:{HttpVerbs:{PUT:"PUT",GET:"GET",DELETE:"DELETE",POST:"POST",MERGE:"MERGE",HEAD:"HEAD",PATCH:"PATCH"},StatusCodes:{TooManyRequests:429}},HeaderConstants:{AUTHORIZATION:"authorization",AUTHORIZATION_SCHEME:"Bearer",RETRY_AFTER:"Retry-After",USER_AGENT:"User-Agent"}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(5),r=console.debug||console.log;function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.apply(void 0,Object(i.a)(e))}}])});


/***/ }),
/* 2 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _communicationUserCredential__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(3);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AzureCommunicationUserCredential", function() { return _communicationUserCredential__WEBPACK_IMPORTED_MODULE_0__["AzureCommunicationUserCredential"]; });

/* harmony import */ var _credential__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(11);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "createCommunicationAccessKeyCredentialPolicy", function() { return _credential__WEBPACK_IMPORTED_MODULE_1__["createCommunicationAccessKeyCredentialPolicy"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isKeyCredential", function() { return _credential__WEBPACK_IMPORTED_MODULE_1__["isKeyCredential"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "parseClientArguments", function() { return _credential__WEBPACK_IMPORTED_MODULE_1__["parseClientArguments"]; });

/* harmony import */ var _identifierModels__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(153);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isCommunicationUser", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__["isCommunicationUser"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isPhoneNumber", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__["isPhoneNumber"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isCallingApplication", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__["isCallingApplication"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isUnknownIdentifier", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__["isUnknownIdentifier"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getIdentifierKind", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__["getIdentifierKind"]; });

// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



//# sourceMappingURL=index.js.map

/***/ }),
/* 3 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AzureCommunicationUserCredential", function() { return AzureCommunicationUserCredential; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4);
/* harmony import */ var _tokenParser__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(5);
/* harmony import */ var _staticTokenCredential__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(9);
/* harmony import */ var _autoRefreshUserCredential__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(10);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.




/**
 * The CommunicationUserCredential implementation with support for proactive token refresh.
 */
class AzureCommunicationUserCredential {
    constructor(tokenOrRefreshOptions) {
        this.disposed = false;
        if (typeof tokenOrRefreshOptions === "string") {
            this.userCredential = new _staticTokenCredential__WEBPACK_IMPORTED_MODULE_2__["StaticTokenCredential"](Object(_tokenParser__WEBPACK_IMPORTED_MODULE_1__["parseToken"])(tokenOrRefreshOptions));
        }
        else {
            this.userCredential = new _autoRefreshUserCredential__WEBPACK_IMPORTED_MODULE_3__["AutoRefreshUserCredential"](tokenOrRefreshOptions);
        }
    }
    /**
     * Gets an `AccessToken` for the user. Throws if already disposed.
     * @param abortSignal An implementation of `AbortSignalLike` to cancel the operation.
     */
    getToken(abortSignal) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function* () {
            this.throwIfDisposed();
            const token = yield this.userCredential.getToken(abortSignal);
            this.throwIfDisposed();
            return token;
        });
    }
    /**
     * Disposes the CommunicationUserCredential and cancels any internal auto-refresh operation.
     */
    dispose() {
        this.disposed = true;
        this.userCredential.dispose();
    }
    throwIfDisposed() {
        if (this.disposed) {
            throw new Error("User credential is disposed");
        }
    }
}
//# sourceMappingURL=communicationUserCredential.js.map

/***/ }),
/* 4 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__extends", function() { return __extends; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__assign", function() { return __assign; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__rest", function() { return __rest; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__decorate", function() { return __decorate; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__param", function() { return __param; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__metadata", function() { return __metadata; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__awaiter", function() { return __awaiter; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__generator", function() { return __generator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__createBinding", function() { return __createBinding; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__exportStar", function() { return __exportStar; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__values", function() { return __values; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__read", function() { return __read; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spread", function() { return __spread; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spreadArrays", function() { return __spreadArrays; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spreadArray", function() { return __spreadArray; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__await", function() { return __await; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncGenerator", function() { return __asyncGenerator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncDelegator", function() { return __asyncDelegator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncValues", function() { return __asyncValues; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__makeTemplateObject", function() { return __makeTemplateObject; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__importStar", function() { return __importStar; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__importDefault", function() { return __importDefault; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__classPrivateFieldGet", function() { return __classPrivateFieldGet; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__classPrivateFieldSet", function() { return __classPrivateFieldSet; });
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    if (typeof b !== "function" && b !== null)
        throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    }
    return __assign.apply(this, arguments);
}

function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __param(paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

var __createBinding = Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
});

function __exportStar(m, o) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);
}

function __values(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

/** @deprecated */
function __spread() {
    for (var ar = [], i = 0; i < arguments.length; i++)
        ar = ar.concat(__read(arguments[i]));
    return ar;
}

/** @deprecated */
function __spreadArrays() {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
}

function __spreadArray(to, from) {
    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)
        to[j] = from[i];
    return to;
}

function __await(v) {
    return this instanceof __await ? (this.v = v, this) : new __await(v);
}

function __asyncGenerator(thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
}

function __asyncDelegator(o) {
    var i, p;
    return i = {}, verb("next"), verb("throw", function (e) { throw e; }), verb("return"), i[Symbol.iterator] = function () { return this; }, i;
    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }
}

function __asyncValues(o) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }
}

function __makeTemplateObject(cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};

var __setModuleDefault = Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
};

function __importStar(mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
}

function __importDefault(mod) {
    return (mod && mod.__esModule) ? mod : { default: mod };
}

function __classPrivateFieldGet(receiver, privateMap) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to get private field on non-instance");
    }
    return privateMap.get(receiver);
}

function __classPrivateFieldSet(receiver, privateMap, value) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to set private field on non-instance");
    }
    privateMap.set(receiver, value);
    return value;
}


/***/ }),
/* 5 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "parseToken", function() { return parseToken; });
/* harmony import */ var jwt_decode__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(6);
/* harmony import */ var jwt_decode__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jwt_decode__WEBPACK_IMPORTED_MODULE_0__);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

const parseToken = (token) => {
    const { exp } = jwt_decode__WEBPACK_IMPORTED_MODULE_0___default()(token);
    return {
        token,
        expiresOnTimestamp: exp * 1000
    };
};
//# sourceMappingURL=tokenParser.js.map

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var base64_url_decode = __webpack_require__(7);

function InvalidTokenError(message) {
  this.message = message;
}

InvalidTokenError.prototype = new Error();
InvalidTokenError.prototype.name = 'InvalidTokenError';

module.exports = function (token,options) {
  if (typeof token !== 'string') {
    throw new InvalidTokenError('Invalid token specified');
  }

  options = options || {};
  var pos = options.header === true ? 0 : 1;
  try {
    return JSON.parse(base64_url_decode(token.split('.')[pos]));
  } catch (e) {
    throw new InvalidTokenError('Invalid token specified: ' + e.message);
  }
};

module.exports.InvalidTokenError = InvalidTokenError;


/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

var atob = __webpack_require__(8);

function b64DecodeUnicode(str) {
  return decodeURIComponent(atob(str).replace(/(.)/g, function (m, p) {
    var code = p.charCodeAt(0).toString(16).toUpperCase();
    if (code.length < 2) {
      code = '0' + code;
    }
    return '%' + code;
  }));
}

module.exports = function(str) {
  var output = str.replace(/-/g, "+").replace(/_/g, "/");
  switch (output.length % 4) {
    case 0:
      break;
    case 2:
      output += "==";
      break;
    case 3:
      output += "=";
      break;
    default:
      throw "Illegal base64url string!";
  }

  try{
    return b64DecodeUnicode(output);
  } catch (err) {
    return atob(output);
  }
};


/***/ }),
/* 8 */
/***/ (function(module, exports) {

/**
 * The code was extracted from:
 * https://github.com/davidchambers/Base64.js
 */

var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';

function InvalidCharacterError(message) {
  this.message = message;
}

InvalidCharacterError.prototype = new Error();
InvalidCharacterError.prototype.name = 'InvalidCharacterError';

function polyfill (input) {
  var str = String(input).replace(/=+$/, '');
  if (str.length % 4 == 1) {
    throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");
  }
  for (
    // initialize result and counters
    var bc = 0, bs, buffer, idx = 0, output = '';
    // get next character
    buffer = str.charAt(idx++);
    // character found in table? initialize bit storage and add its ascii value;
    ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,
      // and if not first of each 4 characters,
      // convert the first 8 bits to one ascii character
      bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0
  ) {
    // try to find character in table (0-63, not found => -1)
    buffer = chars.indexOf(buffer);
  }
  return output;
}


module.exports = typeof window !== 'undefined' && window.atob && window.atob.bind(window) || polyfill;


/***/ }),
/* 9 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "StaticTokenCredential", function() { return StaticTokenCredential; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

/**
 * StaticTokenCredential
 */
class StaticTokenCredential {
    constructor(token) {
        this.token = token;
    }
    getToken() {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function* () {
            return this.token;
        });
    }
    dispose() {
        /* intentionally empty */
    }
}
//# sourceMappingURL=staticTokenCredential.js.map

/***/ }),
/* 10 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AutoRefreshUserCredential", function() { return AutoRefreshUserCredential; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4);
/* harmony import */ var _tokenParser__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(5);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


const expiredToken = { token: "", expiresOnTimestamp: -10 };
const minutesToMs = (minutes) => minutes * 1000 * 60;
const defaultRefreshingInterval = minutesToMs(10);
class AutoRefreshUserCredential {
    constructor(refreshArgs) {
        this.refreshingIntervalInMs = defaultRefreshingInterval;
        this.activeTokenFetching = null;
        this.activeTokenUpdating = null;
        this.disposed = false;
        const { tokenRefresher, initialToken, refreshProactively } = refreshArgs;
        this.refresh = tokenRefresher;
        this.currentToken = initialToken ? Object(_tokenParser__WEBPACK_IMPORTED_MODULE_1__["parseToken"])(initialToken) : expiredToken;
        this.refreshProactively = refreshProactively !== null && refreshProactively !== void 0 ? refreshProactively : false;
        if (this.refreshProactively) {
            this.scheduleRefresh();
        }
    }
    getToken(abortSignal) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function* () {
            if (!this.isCurrentTokenExpiringSoon) {
                return this.currentToken;
            }
            const updatePromise = this.updateTokenAndReschedule(abortSignal);
            if (!this.isCurrentTokenValid) {
                yield updatePromise;
            }
            return this.currentToken;
        });
    }
    dispose() {
        this.disposed = true;
        this.activeTokenFetching = null;
        this.activeTokenUpdating = null;
        this.currentToken = expiredToken;
        if (this.activeTimeout) {
            clearTimeout(this.activeTimeout);
        }
    }
    updateTokenAndReschedule(abortSignal) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function* () {
            if (this.activeTokenUpdating) {
                return this.activeTokenUpdating;
            }
            this.activeTokenUpdating = this.refreshTokenAndReschedule(abortSignal);
            try {
                yield this.activeTokenUpdating;
            }
            finally {
                this.activeTokenUpdating = null;
            }
        });
    }
    refreshTokenAndReschedule(abortSignal) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function* () {
            this.currentToken = yield this.refreshToken(abortSignal);
            if (this.refreshProactively) {
                this.scheduleRefresh();
            }
        });
    }
    refreshToken(abortSignal) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function* () {
            try {
                if (!this.activeTokenFetching) {
                    this.activeTokenFetching = this.refresh(abortSignal);
                }
                return Object(_tokenParser__WEBPACK_IMPORTED_MODULE_1__["parseToken"])(yield this.activeTokenFetching);
            }
            finally {
                this.activeTokenFetching = null;
            }
        });
    }
    scheduleRefresh() {
        if (this.disposed) {
            return;
        }
        if (this.activeTimeout) {
            clearTimeout(this.activeTimeout);
        }
        const timespanInMs = this.currentToken.expiresOnTimestamp - Date.now() - this.refreshingIntervalInMs;
        this.activeTimeout = setTimeout(() => this.updateTokenAndReschedule(), timespanInMs);
    }
    get isCurrentTokenValid() {
        return this.currentToken && Date.now() < this.currentToken.expiresOnTimestamp;
    }
    get isCurrentTokenExpiringSoon() {
        return (!this.currentToken ||
            Date.now() >= this.currentToken.expiresOnTimestamp - this.refreshingIntervalInMs);
    }
}
//# sourceMappingURL=autoRefreshUserCredential.js.map

/***/ }),
/* 11 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _communicationAccessKeyCredentialPolicy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(12);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "createCommunicationAccessKeyCredentialPolicy", function() { return _communicationAccessKeyCredentialPolicy__WEBPACK_IMPORTED_MODULE_0__["createCommunicationAccessKeyCredentialPolicy"]; });

/* harmony import */ var _clientArguments__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(151);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isKeyCredential", function() { return _clientArguments__WEBPACK_IMPORTED_MODULE_1__["isKeyCredential"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "parseClientArguments", function() { return _clientArguments__WEBPACK_IMPORTED_MODULE_1__["parseClientArguments"]; });

// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


//# sourceMappingURL=index.js.map

/***/ }),
/* 12 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createCommunicationAccessKeyCredentialPolicy", function() { return createCommunicationAccessKeyCredentialPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4);
/* harmony import */ var _azure_core_http__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(13);
/* harmony import */ var _cryptoUtils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(149);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



/**
 * Creates an HTTP pipeline policy to authenticate a request
 * using an `KeyCredential`
 *
 * @param {KeyCredential} credential The key credential
 */
const createCommunicationAccessKeyCredentialPolicy = (credential) => {
    return {
        create: (nextpolicy, options) => {
            return new CommunicationAccessKeyCredentialPolicy(credential, nextpolicy, options);
        }
    };
};
/**
 * CommunicationAccessKeyCredentialPolicy provides a means of signing requests made through
 * the SmsClient.
 */
class CommunicationAccessKeyCredentialPolicy extends _azure_core_http__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"] {
    /**
     * Initializes a new instance of the CommunicationAccessKeyCredential class
     * using a base64 encoded key.
     * @param accessKey The base64 encoded key to be used for signing.
     */
    constructor(accessKey, nextPolicy, options) {
        super(nextPolicy, options);
        this.accessKey = accessKey;
    }
    /**
     * Signs a request with the provided access key.
     *
     * @param {WebResource} webResource The WebResource to be signed.
     */
    signRequest(webResource) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function* () {
            const verb = webResource.method.toUpperCase();
            const utcNow = new Date().toUTCString();
            const contentHash = yield Object(_cryptoUtils__WEBPACK_IMPORTED_MODULE_2__["shaHash"])(webResource.body || "");
            const dateHeader = _azure_core_http__WEBPACK_IMPORTED_MODULE_1__["isNode"] ? "date" : "x-ms-date";
            const signedHeaders = `${dateHeader};host;x-ms-content-sha256`;
            const url = _azure_core_http__WEBPACK_IMPORTED_MODULE_1__["URLBuilder"].parse(webResource.url);
            const query = url.getQuery();
            const urlPathAndQuery = query ? `${url.getPath()}?${query}` : url.getPath();
            const port = url.getPort();
            const hostAndPort = port ? `${url.getHost()}:${port}` : url.getHost();
            const stringToSign = `${verb}\n${urlPathAndQuery}\n${utcNow};${hostAndPort};${contentHash}`;
            const signature = yield Object(_cryptoUtils__WEBPACK_IMPORTED_MODULE_2__["shaHMAC"])(this.accessKey.key, stringToSign);
            if (_azure_core_http__WEBPACK_IMPORTED_MODULE_1__["isNode"]) {
                webResource.headers.set("Host", hostAndPort || "");
            }
            webResource.headers.set(dateHeader, utcNow);
            webResource.headers.set("x-ms-content-sha256", contentHash);
            webResource.headers.set("Authorization", `HMAC-SHA256 SignedHeaders=${signedHeaders}&Signature=${signature}`);
            return webResource;
        });
    }
    /**
     * Signs the request and calls the next policy in the factory.
     *
     * @param {WebResourceLike} webResource
     */
    sendRequest(webResource) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function* () {
            if (!webResource) {
                throw new Error("webResource cannot be null or undefined");
            }
            return this._nextPolicy.sendRequest(yield this.signRequest(webResource));
        });
    }
}
//# sourceMappingURL=communicationAccessKeyCredentialPolicy.js.map

/***/ }),
/* 13 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _webResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(14);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "WebResource", function() { return _webResource__WEBPACK_IMPORTED_MODULE_0__["WebResource"]; });

/* harmony import */ var _defaultHttpClient__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(38);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "DefaultHttpClient", function() { return _defaultHttpClient__WEBPACK_IMPORTED_MODULE_1__["DefaultHttpClient"]; });

/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(15);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HttpHeaders", function() { return _httpHeaders__WEBPACK_IMPORTED_MODULE_2__["HttpHeaders"]; });

/* harmony import */ var _httpPipelineLogLevel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(49);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "HttpPipelineLogLevel", function() { return _httpPipelineLogLevel__WEBPACK_IMPORTED_MODULE_3__["HttpPipelineLogLevel"]; });

/* harmony import */ var _restError__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(44);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "RestError", function() { return _restError__WEBPACK_IMPORTED_MODULE_4__["RestError"]; });

/* harmony import */ var _operationOptions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(50);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "operationOptionsToRequestOptionsBase", function() { return _operationOptions__WEBPACK_IMPORTED_MODULE_5__["operationOptionsToRequestOptionsBase"]; });

/* harmony import */ var _serviceClient__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(51);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ServiceClient", function() { return _serviceClient__WEBPACK_IMPORTED_MODULE_6__["ServiceClient"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "flattenResponse", function() { return _serviceClient__WEBPACK_IMPORTED_MODULE_6__["flattenResponse"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "createPipelineFromOptions", function() { return _serviceClient__WEBPACK_IMPORTED_MODULE_6__["createPipelineFromOptions"]; });

/* harmony import */ var _createSpan__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(145);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "createSpanFunction", function() { return _createSpan__WEBPACK_IMPORTED_MODULE_7__["createSpanFunction"]; });

/* harmony import */ var _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(76);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "QueryCollectionFormat", function() { return _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_8__["QueryCollectionFormat"]; });

/* harmony import */ var _util_constants__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(36);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Constants", function() { return _util_constants__WEBPACK_IMPORTED_MODULE_9__["Constants"]; });

/* harmony import */ var _policies_bearerTokenAuthenticationPolicy__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(72);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "bearerTokenAuthenticationPolicy", function() { return _policies_bearerTokenAuthenticationPolicy__WEBPACK_IMPORTED_MODULE_10__["bearerTokenAuthenticationPolicy"]; });

/* harmony import */ var _policies_logPolicy__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(55);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "logPolicy", function() { return _policies_logPolicy__WEBPACK_IMPORTED_MODULE_11__["logPolicy"]; });

/* harmony import */ var _policies_requestPolicy__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(56);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "BaseRequestPolicy", function() { return _policies_requestPolicy__WEBPACK_IMPORTED_MODULE_12__["BaseRequestPolicy"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "RequestPolicyOptions", function() { return _policies_requestPolicy__WEBPACK_IMPORTED_MODULE_12__["RequestPolicyOptions"]; });

/* harmony import */ var _policies_generateClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(67);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "generateClientRequestIdPolicy", function() { return _policies_generateClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_13__["generateClientRequestIdPolicy"]; });

/* harmony import */ var _policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(65);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "exponentialRetryPolicy", function() { return _policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_14__["exponentialRetryPolicy"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "RetryMode", function() { return _policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_14__["RetryMode"]; });

/* harmony import */ var _policies_systemErrorRetryPolicy__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(75);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "systemErrorRetryPolicy", function() { return _policies_systemErrorRetryPolicy__WEBPACK_IMPORTED_MODULE_15__["systemErrorRetryPolicy"]; });

/* harmony import */ var _policies_throttlingRetryPolicy__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(78);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "throttlingRetryPolicy", function() { return _policies_throttlingRetryPolicy__WEBPACK_IMPORTED_MODULE_16__["throttlingRetryPolicy"]; });

/* harmony import */ var _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(77);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getDefaultProxySettings", function() { return _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_17__["getDefaultProxySettings"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "proxyPolicy", function() { return _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_17__["proxyPolicy"]; });

/* harmony import */ var _policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(70);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "redirectPolicy", function() { return _policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_18__["redirectPolicy"]; });

/* harmony import */ var _policies_keepAlivePolicy__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(80);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "keepAlivePolicy", function() { return _policies_keepAlivePolicy__WEBPACK_IMPORTED_MODULE_19__["keepAlivePolicy"]; });

/* harmony import */ var _policies_disableResponseDecompressionPolicy__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(143);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "disableResponseDecompressionPolicy", function() { return _policies_disableResponseDecompressionPolicy__WEBPACK_IMPORTED_MODULE_20__["disableResponseDecompressionPolicy"]; });

/* harmony import */ var _policies_signingPolicy__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(79);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "signingPolicy", function() { return _policies_signingPolicy__WEBPACK_IMPORTED_MODULE_21__["signingPolicy"]; });

/* harmony import */ var _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(68);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "userAgentPolicy", function() { return _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_22__["userAgentPolicy"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getDefaultUserAgentValue", function() { return _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_22__["getDefaultUserAgentValue"]; });

/* harmony import */ var _policies_deserializationPolicy__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(63);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "deserializationPolicy", function() { return _policies_deserializationPolicy__WEBPACK_IMPORTED_MODULE_23__["deserializationPolicy"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "deserializeResponseBody", function() { return _policies_deserializationPolicy__WEBPACK_IMPORTED_MODULE_23__["deserializeResponseBody"]; });

/* harmony import */ var _policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(81);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "tracingPolicy", function() { return _policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_24__["tracingPolicy"]; });

/* harmony import */ var _serializer__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(16);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "MapperType", function() { return _serializer__WEBPACK_IMPORTED_MODULE_25__["MapperType"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "Serializer", function() { return _serializer__WEBPACK_IMPORTED_MODULE_25__["Serializer"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "serializeObject", function() { return _serializer__WEBPACK_IMPORTED_MODULE_25__["serializeObject"]; });

/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(19);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "stripRequest", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["stripRequest"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "stripResponse", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["stripResponse"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "delay", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["delay"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "executePromisesSequentially", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["executePromisesSequentially"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "generateUuid", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["generateUuid"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "encodeUri", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["encodeUri"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "promiseToCallback", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["promiseToCallback"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "promiseToServiceCallback", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["promiseToServiceCallback"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isValidUuid", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["isValidUuid"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "applyMixins", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["applyMixins"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isNode", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["isNode"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isDuration", function() { return _util_utils__WEBPACK_IMPORTED_MODULE_26__["isDuration"]; });

/* harmony import */ var _url__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(47);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "URLBuilder", function() { return _url__WEBPACK_IMPORTED_MODULE_27__["URLBuilder"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "URLQuery", function() { return _url__WEBPACK_IMPORTED_MODULE_27__["URLQuery"]; });

/* harmony import */ var _azure_core_auth__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(52);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isTokenCredential", function() { return _azure_core_auth__WEBPACK_IMPORTED_MODULE_28__["isTokenCredential"]; });

/* harmony import */ var _credentials_accessTokenCache__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(73);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ExpiringAccessTokenCache", function() { return _credentials_accessTokenCache__WEBPACK_IMPORTED_MODULE_29__["ExpiringAccessTokenCache"]; });

/* harmony import */ var _credentials_accessTokenRefresher__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(74);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AccessTokenRefresher", function() { return _credentials_accessTokenRefresher__WEBPACK_IMPORTED_MODULE_30__["AccessTokenRefresher"]; });

/* harmony import */ var _credentials_basicAuthenticationCredentials__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(146);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "BasicAuthenticationCredentials", function() { return _credentials_basicAuthenticationCredentials__WEBPACK_IMPORTED_MODULE_31__["BasicAuthenticationCredentials"]; });

/* harmony import */ var _credentials_apiKeyCredentials__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(147);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "ApiKeyCredentials", function() { return _credentials_apiKeyCredentials__WEBPACK_IMPORTED_MODULE_32__["ApiKeyCredentials"]; });

/* harmony import */ var _credentials_topicCredentials__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(148);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TopicCredentials", function() { return _credentials_topicCredentials__WEBPACK_IMPORTED_MODULE_33__["TopicCredentials"]; });

/* harmony import */ var _util_xml__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(64);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "parseXML", function() { return _util_xml__WEBPACK_IMPORTED_MODULE_34__["parseXML"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "stringifyXML", function() { return _util_xml__WEBPACK_IMPORTED_MODULE_34__["stringifyXML"]; });

/* harmony import */ var _util_serializer_common__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(37);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "XML_ATTRKEY", function() { return _util_serializer_common__WEBPACK_IMPORTED_MODULE_35__["XML_ATTRKEY"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "XML_CHARKEY", function() { return _util_serializer_common__WEBPACK_IMPORTED_MODULE_35__["XML_CHARKEY"]; });

// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/* eslint-disable-next-line @typescript-eslint/triple-slash-reference */
/// <reference path="../dom-shim.d.ts" />




























// Credentials








//# sourceMappingURL=coreHttp.js.map

/***/ }),
/* 14 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isWebResourceLike", function() { return isWebResourceLike; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WebResource", function() { return WebResource; });
/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(15);
/* harmony import */ var _serializer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(16);
/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(19);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



function isWebResourceLike(object) {
    if (typeof object !== "object") {
        return false;
    }
    if (typeof object.url === "string" &&
        typeof object.method === "string" &&
        typeof object.headers === "object" &&
        Object(_httpHeaders__WEBPACK_IMPORTED_MODULE_0__["isHttpHeadersLike"])(object.headers) &&
        typeof object.validateRequestProperties === "function" &&
        typeof object.prepare === "function" &&
        typeof object.clone === "function") {
        return true;
    }
    return false;
}
/**
 * Creates a new WebResource object.
 *
 * This class provides an abstraction over a REST call by being library / implementation agnostic and wrapping the necessary
 * properties to initiate a request.
 *
 * @constructor
 */
var WebResource = /** @class */ (function () {
    function WebResource(url, method, body, query, headers, streamResponseBody, withCredentials, abortSignal, timeout, onUploadProgress, onDownloadProgress, proxySettings, keepAlive, decompressResponse) {
        this.streamResponseBody = streamResponseBody;
        this.url = url || "";
        this.method = method || "GET";
        this.headers = Object(_httpHeaders__WEBPACK_IMPORTED_MODULE_0__["isHttpHeadersLike"])(headers) ? headers : new _httpHeaders__WEBPACK_IMPORTED_MODULE_0__["HttpHeaders"](headers);
        this.body = body;
        this.query = query;
        this.formData = undefined;
        this.withCredentials = withCredentials || false;
        this.abortSignal = abortSignal;
        this.timeout = timeout || 0;
        this.onUploadProgress = onUploadProgress;
        this.onDownloadProgress = onDownloadProgress;
        this.proxySettings = proxySettings;
        this.keepAlive = keepAlive;
        this.decompressResponse = decompressResponse;
        this.requestId = this.headers.get("x-ms-client-request-id") || Object(_util_utils__WEBPACK_IMPORTED_MODULE_2__["generateUuid"])();
    }
    /**
     * Validates that the required properties such as method, url, headers["Content-Type"],
     * headers["accept-language"] are defined. It will throw an error if one of the above
     * mentioned properties are not defined.
     */
    WebResource.prototype.validateRequestProperties = function () {
        if (!this.method) {
            throw new Error("WebResource.method is required.");
        }
        if (!this.url) {
            throw new Error("WebResource.url is required.");
        }
    };
    /**
     * Prepares the request.
     * @param {RequestPrepareOptions} options Options to provide for preparing the request.
     * @returns {WebResource} Returns the prepared WebResource (HTTP Request) object that needs to be given to the request pipeline.
     */
    WebResource.prototype.prepare = function (options) {
        if (!options) {
            throw new Error("options object is required");
        }
        if (options.method === undefined ||
            options.method === null ||
            typeof options.method.valueOf() !== "string") {
            throw new Error("options.method must be a string.");
        }
        if (options.url && options.pathTemplate) {
            throw new Error("options.url and options.pathTemplate are mutually exclusive. Please provide exactly one of them.");
        }
        if ((options.pathTemplate === undefined ||
            options.pathTemplate === null ||
            typeof options.pathTemplate.valueOf() !== "string") &&
            (options.url === undefined ||
                options.url === null ||
                typeof options.url.valueOf() !== "string")) {
            throw new Error("Please provide exactly one of options.pathTemplate or options.url.");
        }
        // set the url if it is provided.
        if (options.url) {
            if (typeof options.url !== "string") {
                throw new Error('options.url must be of type "string".');
            }
            this.url = options.url;
        }
        // set the method
        if (options.method) {
            var validMethods = ["GET", "PUT", "HEAD", "DELETE", "OPTIONS", "POST", "PATCH", "TRACE"];
            if (validMethods.indexOf(options.method.toUpperCase()) === -1) {
                throw new Error('The provided method "' +
                    options.method +
                    '" is invalid. Supported HTTP methods are: ' +
                    JSON.stringify(validMethods));
            }
        }
        this.method = options.method.toUpperCase();
        // construct the url if path template is provided
        if (options.pathTemplate) {
            var pathTemplate_1 = options.pathTemplate, pathParameters_1 = options.pathParameters;
            if (typeof pathTemplate_1 !== "string") {
                throw new Error('options.pathTemplate must be of type "string".');
            }
            if (!options.baseUrl) {
                options.baseUrl = "https://management.azure.com";
            }
            var baseUrl = options.baseUrl;
            var url_1 = baseUrl +
                (baseUrl.endsWith("/") ? "" : "/") +
                (pathTemplate_1.startsWith("/") ? pathTemplate_1.slice(1) : pathTemplate_1);
            var segments = url_1.match(/({[\w-]*\s*[\w-]*})/gi);
            if (segments && segments.length) {
                if (!pathParameters_1) {
                    throw new Error("pathTemplate: " + pathTemplate_1 + " has been provided. Hence, options.pathParameters must also be provided.");
                }
                segments.forEach(function (item) {
                    var pathParamName = item.slice(1, -1);
                    var pathParam = pathParameters_1[pathParamName];
                    if (pathParam === null ||
                        pathParam === undefined ||
                        !(typeof pathParam === "string" || typeof pathParam === "object")) {
                        var stringifiedPathParameters = JSON.stringify(pathParameters_1, undefined, 2);
                        throw new Error("pathTemplate: " + pathTemplate_1 + " contains the path parameter " + pathParamName +
                            (" however, it is not present in parameters: " + stringifiedPathParameters + ".") +
                            ("The value of the path parameter can either be a \"string\" of the form { " + pathParamName + ": \"some sample value\" } or ") +
                            ("it can be an \"object\" of the form { \"" + pathParamName + "\": { value: \"some sample value\", skipUrlEncoding: true } }."));
                    }
                    if (typeof pathParam.valueOf() === "string") {
                        url_1 = url_1.replace(item, encodeURIComponent(pathParam));
                    }
                    if (typeof pathParam.valueOf() === "object") {
                        if (!pathParam.value) {
                            throw new Error("options.pathParameters[" + pathParamName + "] is of type \"object\" but it does not contain a \"value\" property.");
                        }
                        if (pathParam.skipUrlEncoding) {
                            url_1 = url_1.replace(item, pathParam.value);
                        }
                        else {
                            url_1 = url_1.replace(item, encodeURIComponent(pathParam.value));
                        }
                    }
                });
            }
            this.url = url_1;
        }
        // append query parameters to the url if they are provided. They can be provided with pathTemplate or url option.
        if (options.queryParameters) {
            var queryParameters = options.queryParameters;
            if (typeof queryParameters !== "object") {
                throw new Error("options.queryParameters must be of type object. It should be a JSON object " +
                    "of \"query-parameter-name\" as the key and the \"query-parameter-value\" as the value. " +
                    "The \"query-parameter-value\" may be fo type \"string\" or an \"object\" of the form { value: \"query-parameter-value\", skipUrlEncoding: true }.");
            }
            // append question mark if it is not present in the url
            if (this.url && this.url.indexOf("?") === -1) {
                this.url += "?";
            }
            // construct queryString
            var queryParams = [];
            // We need to populate this.query as a dictionary if the request is being used for Sway's validateRequest().
            this.query = {};
            for (var queryParamName in queryParameters) {
                var queryParam = queryParameters[queryParamName];
                if (queryParam) {
                    if (typeof queryParam === "string") {
                        queryParams.push(queryParamName + "=" + encodeURIComponent(queryParam));
                        this.query[queryParamName] = encodeURIComponent(queryParam);
                    }
                    else if (typeof queryParam === "object") {
                        if (!queryParam.value) {
                            throw new Error("options.queryParameters[" + queryParamName + "] is of type \"object\" but it does not contain a \"value\" property.");
                        }
                        if (queryParam.skipUrlEncoding) {
                            queryParams.push(queryParamName + "=" + queryParam.value);
                            this.query[queryParamName] = queryParam.value;
                        }
                        else {
                            queryParams.push(queryParamName + "=" + encodeURIComponent(queryParam.value));
                            this.query[queryParamName] = encodeURIComponent(queryParam.value);
                        }
                    }
                }
            } // end-of-for
            // append the queryString
            this.url += queryParams.join("&");
        }
        // add headers to the request if they are provided
        if (options.headers) {
            var headers = options.headers;
            for (var _i = 0, _a = Object.keys(options.headers); _i < _a.length; _i++) {
                var headerName = _a[_i];
                this.headers.set(headerName, headers[headerName]);
            }
        }
        // ensure accept-language is set correctly
        if (!this.headers.get("accept-language")) {
            this.headers.set("accept-language", "en-US");
        }
        // ensure the request-id is set correctly
        if (!this.headers.get("x-ms-client-request-id") && !options.disableClientRequestId) {
            this.headers.set("x-ms-client-request-id", this.requestId);
        }
        // default
        if (!this.headers.get("Content-Type")) {
            this.headers.set("Content-Type", "application/json; charset=utf-8");
        }
        // set the request body. request.js automatically sets the Content-Length request header, so we need not set it explicitly
        this.body = options.body;
        if (options.body !== undefined && options.body !== null) {
            // body as a stream special case. set the body as-is and check for some special request headers specific to sending a stream.
            if (options.bodyIsStream) {
                if (!this.headers.get("Transfer-Encoding")) {
                    this.headers.set("Transfer-Encoding", "chunked");
                }
                if (this.headers.get("Content-Type") !== "application/octet-stream") {
                    this.headers.set("Content-Type", "application/octet-stream");
                }
            }
            else {
                if (options.serializationMapper) {
                    this.body = new _serializer__WEBPACK_IMPORTED_MODULE_1__["Serializer"](options.mappers).serialize(options.serializationMapper, options.body, "requestBody");
                }
                if (!options.disableJsonStringifyOnBody) {
                    this.body = JSON.stringify(options.body);
                }
            }
        }
        if (options.spanOptions) {
            this.spanOptions = options.spanOptions;
        }
        this.abortSignal = options.abortSignal;
        this.onDownloadProgress = options.onDownloadProgress;
        this.onUploadProgress = options.onUploadProgress;
        return this;
    };
    /**
     * Clone this WebResource HTTP request object.
     * @returns {WebResource} The clone of this WebResource HTTP request object.
     */
    WebResource.prototype.clone = function () {
        var result = new WebResource(this.url, this.method, this.body, this.query, this.headers && this.headers.clone(), this.streamResponseBody, this.withCredentials, this.abortSignal, this.timeout, this.onUploadProgress, this.onDownloadProgress, this.proxySettings, this.keepAlive, this.decompressResponse);
        if (this.formData) {
            result.formData = this.formData;
        }
        if (this.operationSpec) {
            result.operationSpec = this.operationSpec;
        }
        if (this.shouldDeserialize) {
            result.shouldDeserialize = this.shouldDeserialize;
        }
        if (this.operationResponseGetter) {
            result.operationResponseGetter = this.operationResponseGetter;
        }
        return result;
    };
    return WebResource;
}());

//# sourceMappingURL=webResource.js.map

/***/ }),
/* 15 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isHttpHeadersLike", function() { return isHttpHeadersLike; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HttpHeaders", function() { return HttpHeaders; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * A collection of HttpHeaders that can be sent with a HTTP request.
 */
function getHeaderKey(headerName) {
    return headerName.toLowerCase();
}
function isHttpHeadersLike(object) {
    if (!object || typeof object !== "object") {
        return false;
    }
    if (typeof object.rawHeaders === "function" &&
        typeof object.clone === "function" &&
        typeof object.get === "function" &&
        typeof object.set === "function" &&
        typeof object.contains === "function" &&
        typeof object.remove === "function" &&
        typeof object.headersArray === "function" &&
        typeof object.headerValues === "function" &&
        typeof object.headerNames === "function" &&
        typeof object.toJson === "function") {
        return true;
    }
    return false;
}
/**
 * A collection of HTTP header key/value pairs.
 */
var HttpHeaders = /** @class */ (function () {
    function HttpHeaders(rawHeaders) {
        this._headersMap = {};
        if (rawHeaders) {
            for (var headerName in rawHeaders) {
                this.set(headerName, rawHeaders[headerName]);
            }
        }
    }
    /**
     * Set a header in this collection with the provided name and value. The name is
     * case-insensitive.
     * @param headerName The name of the header to set. This value is case-insensitive.
     * @param headerValue The value of the header to set.
     */
    HttpHeaders.prototype.set = function (headerName, headerValue) {
        this._headersMap[getHeaderKey(headerName)] = {
            name: headerName,
            value: headerValue.toString()
        };
    };
    /**
     * Get the header value for the provided header name, or undefined if no header exists in this
     * collection with the provided name.
     * @param headerName The name of the header.
     */
    HttpHeaders.prototype.get = function (headerName) {
        var header = this._headersMap[getHeaderKey(headerName)];
        return !header ? undefined : header.value;
    };
    /**
     * Get whether or not this header collection contains a header entry for the provided header name.
     */
    HttpHeaders.prototype.contains = function (headerName) {
        return !!this._headersMap[getHeaderKey(headerName)];
    };
    /**
     * Remove the header with the provided headerName. Return whether or not the header existed and
     * was removed.
     * @param headerName The name of the header to remove.
     */
    HttpHeaders.prototype.remove = function (headerName) {
        var result = this.contains(headerName);
        delete this._headersMap[getHeaderKey(headerName)];
        return result;
    };
    /**
     * Get the headers that are contained this collection as an object.
     */
    HttpHeaders.prototype.rawHeaders = function () {
        var result = {};
        for (var headerKey in this._headersMap) {
            var header = this._headersMap[headerKey];
            result[header.name.toLowerCase()] = header.value;
        }
        return result;
    };
    /**
     * Get the headers that are contained in this collection as an array.
     */
    HttpHeaders.prototype.headersArray = function () {
        var headers = [];
        for (var headerKey in this._headersMap) {
            headers.push(this._headersMap[headerKey]);
        }
        return headers;
    };
    /**
     * Get the header names that are contained in this collection.
     */
    HttpHeaders.prototype.headerNames = function () {
        var headerNames = [];
        var headers = this.headersArray();
        for (var i = 0; i < headers.length; ++i) {
            headerNames.push(headers[i].name);
        }
        return headerNames;
    };
    /**
     * Get the header values that are contained in this collection.
     */
    HttpHeaders.prototype.headerValues = function () {
        var headerValues = [];
        var headers = this.headersArray();
        for (var i = 0; i < headers.length; ++i) {
            headerValues.push(headers[i].value);
        }
        return headerValues;
    };
    /**
     * Get the JSON object representation of this HTTP header collection.
     */
    HttpHeaders.prototype.toJson = function () {
        return this.rawHeaders();
    };
    /**
     * Get the string representation of this HTTP header collection.
     */
    HttpHeaders.prototype.toString = function () {
        return JSON.stringify(this.toJson());
    };
    /**
     * Create a deep clone/copy of this HttpHeaders collection.
     */
    HttpHeaders.prototype.clone = function () {
        return new HttpHeaders(this.rawHeaders());
    };
    return HttpHeaders;
}());

//# sourceMappingURL=httpHeaders.js.map

/***/ }),
/* 16 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Serializer", function() { return Serializer; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "serializeObject", function() { return serializeObject; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MapperType", function() { return MapperType; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _util_base64__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(18);
/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(19);
/* harmony import */ var _util_serializer_common__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(37);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/* eslint-disable eqeqeq */




var Serializer = /** @class */ (function () {
    function Serializer(modelMappers, isXML) {
        if (modelMappers === void 0) { modelMappers = {}; }
        this.modelMappers = modelMappers;
        this.isXML = isXML;
    }
    Serializer.prototype.validateConstraints = function (mapper, value, objectName) {
        var failValidation = function (constraintName, constraintValue) {
            throw new Error("\"" + objectName + "\" with value \"" + value + "\" should satisfy the constraint \"" + constraintName + "\": " + constraintValue + ".");
        };
        if (mapper.constraints && value != undefined) {
            var _a = mapper.constraints, ExclusiveMaximum = _a.ExclusiveMaximum, ExclusiveMinimum = _a.ExclusiveMinimum, InclusiveMaximum = _a.InclusiveMaximum, InclusiveMinimum = _a.InclusiveMinimum, MaxItems = _a.MaxItems, MaxLength = _a.MaxLength, MinItems = _a.MinItems, MinLength = _a.MinLength, MultipleOf = _a.MultipleOf, Pattern = _a.Pattern, UniqueItems = _a.UniqueItems;
            if (ExclusiveMaximum != undefined && value >= ExclusiveMaximum) {
                failValidation("ExclusiveMaximum", ExclusiveMaximum);
            }
            if (ExclusiveMinimum != undefined && value <= ExclusiveMinimum) {
                failValidation("ExclusiveMinimum", ExclusiveMinimum);
            }
            if (InclusiveMaximum != undefined && value > InclusiveMaximum) {
                failValidation("InclusiveMaximum", InclusiveMaximum);
            }
            if (InclusiveMinimum != undefined && value < InclusiveMinimum) {
                failValidation("InclusiveMinimum", InclusiveMinimum);
            }
            if (MaxItems != undefined && value.length > MaxItems) {
                failValidation("MaxItems", MaxItems);
            }
            if (MaxLength != undefined && value.length > MaxLength) {
                failValidation("MaxLength", MaxLength);
            }
            if (MinItems != undefined && value.length < MinItems) {
                failValidation("MinItems", MinItems);
            }
            if (MinLength != undefined && value.length < MinLength) {
                failValidation("MinLength", MinLength);
            }
            if (MultipleOf != undefined && value % MultipleOf !== 0) {
                failValidation("MultipleOf", MultipleOf);
            }
            if (Pattern) {
                var pattern = typeof Pattern === "string" ? new RegExp(Pattern) : Pattern;
                if (typeof value !== "string" || value.match(pattern) === null) {
                    failValidation("Pattern", Pattern);
                }
            }
            if (UniqueItems &&
                value.some(function (item, i, ar) { return ar.indexOf(item) !== i; })) {
                failValidation("UniqueItems", UniqueItems);
            }
        }
    };
    /**
     * Serialize the given object based on its metadata defined in the mapper
     *
     * @param {Mapper} mapper The mapper which defines the metadata of the serializable object
     *
     * @param {object|string|Array|number|boolean|Date|stream} object A valid Javascript object to be serialized
     *
     * @param {string} objectName Name of the serialized object
     *
     * @param {options} options additional options to deserialization
     *
     * @returns {object|string|Array|number|boolean|Date|stream} A valid serialized Javascript object
     */
    Serializer.prototype.serialize = function (mapper, object, objectName, options) {
        var _a, _b, _c;
        if (options === void 0) { options = {}; }
        var updatedOptions = {
            rootName: (_a = options.rootName) !== null && _a !== void 0 ? _a : "",
            includeRoot: (_b = options.includeRoot) !== null && _b !== void 0 ? _b : false,
            xmlCharKey: (_c = options.xmlCharKey) !== null && _c !== void 0 ? _c : _util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_CHARKEY"]
        };
        var payload = {};
        var mapperType = mapper.type.name;
        if (!objectName) {
            objectName = mapper.serializedName;
        }
        if (mapperType.match(/^Sequence$/i) !== null) {
            payload = [];
        }
        if (mapper.isConstant) {
            object = mapper.defaultValue;
        }
        // This table of allowed values should help explain
        // the mapper.required and mapper.nullable properties.
        // X means "neither undefined or null are allowed".
        //           || required
        //           || true      | false
        //  nullable || ==========================
        //      true || null      | undefined/null
        //     false || X         | undefined
        // undefined || X         | undefined/null
        var required = mapper.required, nullable = mapper.nullable;
        if (required && nullable && object === undefined) {
            throw new Error(objectName + " cannot be undefined.");
        }
        if (required && !nullable && object == undefined) {
            throw new Error(objectName + " cannot be null or undefined.");
        }
        if (!required && nullable === false && object === null) {
            throw new Error(objectName + " cannot be null.");
        }
        if (object == undefined) {
            payload = object;
        }
        else {
            // Validate Constraints if any
            this.validateConstraints(mapper, object, objectName);
            if (mapperType.match(/^any$/i) !== null) {
                payload = object;
            }
            else if (mapperType.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i) !== null) {
                payload = serializeBasicTypes(mapperType, objectName, object);
            }
            else if (mapperType.match(/^Enum$/i) !== null) {
                var enumMapper = mapper;
                payload = serializeEnumType(objectName, enumMapper.type.allowedValues, object);
            }
            else if (mapperType.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i) !== null) {
                payload = serializeDateTypes(mapperType, object, objectName);
            }
            else if (mapperType.match(/^ByteArray$/i) !== null) {
                payload = serializeByteArrayType(objectName, object);
            }
            else if (mapperType.match(/^Base64Url$/i) !== null) {
                payload = serializeBase64UrlType(objectName, object);
            }
            else if (mapperType.match(/^Sequence$/i) !== null) {
                payload = serializeSequenceType(this, mapper, object, objectName, Boolean(this.isXML), updatedOptions);
            }
            else if (mapperType.match(/^Dictionary$/i) !== null) {
                payload = serializeDictionaryType(this, mapper, object, objectName, Boolean(this.isXML), updatedOptions);
            }
            else if (mapperType.match(/^Composite$/i) !== null) {
                payload = serializeCompositeType(this, mapper, object, objectName, Boolean(this.isXML), updatedOptions);
            }
        }
        return payload;
    };
    /**
     * Deserialize the given object based on its metadata defined in the mapper
     *
     * @param {object} mapper The mapper which defines the metadata of the serializable object
     *
     * @param {object|string|Array|number|boolean|Date|stream} responseBody A valid Javascript entity to be deserialized
     *
     * @param {string} objectName Name of the deserialized object
     *
     * @param options Controls behavior of XML parser and builder.
     *
     * @returns {object|string|Array|number|boolean|Date|stream} A valid deserialized Javascript object
     */
    Serializer.prototype.deserialize = function (mapper, responseBody, objectName, options) {
        var _a, _b, _c;
        if (options === void 0) { options = {}; }
        var updatedOptions = {
            rootName: (_a = options.rootName) !== null && _a !== void 0 ? _a : "",
            includeRoot: (_b = options.includeRoot) !== null && _b !== void 0 ? _b : false,
            xmlCharKey: (_c = options.xmlCharKey) !== null && _c !== void 0 ? _c : _util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_CHARKEY"]
        };
        if (responseBody == undefined) {
            if (this.isXML && mapper.type.name === "Sequence" && !mapper.xmlIsWrapped) {
                // Edge case for empty XML non-wrapped lists. xml2js can't distinguish
                // between the list being empty versus being missing,
                // so let's do the more user-friendly thing and return an empty list.
                responseBody = [];
            }
            // specifically check for undefined as default value can be a falsey value `0, "", false, null`
            if (mapper.defaultValue !== undefined) {
                responseBody = mapper.defaultValue;
            }
            return responseBody;
        }
        var payload;
        var mapperType = mapper.type.name;
        if (!objectName) {
            objectName = mapper.serializedName;
        }
        if (mapperType.match(/^Composite$/i) !== null) {
            payload = deserializeCompositeType(this, mapper, responseBody, objectName, updatedOptions);
        }
        else {
            if (this.isXML) {
                var xmlCharKey = updatedOptions.xmlCharKey;
                /**
                 * If the mapper specifies this as a non-composite type value but the responseBody contains
                 * both header ("$" i.e., XML_ATTRKEY) and body ("#" i.e., XML_CHARKEY) properties,
                 * then just reduce the responseBody value to the body ("#" i.e., XML_CHARKEY) property.
                 */
                if (responseBody[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] != undefined && responseBody[xmlCharKey] != undefined) {
                    responseBody = responseBody[xmlCharKey];
                }
            }
            if (mapperType.match(/^Number$/i) !== null) {
                payload = parseFloat(responseBody);
                if (isNaN(payload)) {
                    payload = responseBody;
                }
            }
            else if (mapperType.match(/^Boolean$/i) !== null) {
                if (responseBody === "true") {
                    payload = true;
                }
                else if (responseBody === "false") {
                    payload = false;
                }
                else {
                    payload = responseBody;
                }
            }
            else if (mapperType.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i) !== null) {
                payload = responseBody;
            }
            else if (mapperType.match(/^(Date|DateTime|DateTimeRfc1123)$/i) !== null) {
                payload = new Date(responseBody);
            }
            else if (mapperType.match(/^UnixTime$/i) !== null) {
                payload = unixTimeToDate(responseBody);
            }
            else if (mapperType.match(/^ByteArray$/i) !== null) {
                payload = _util_base64__WEBPACK_IMPORTED_MODULE_1__["decodeString"](responseBody);
            }
            else if (mapperType.match(/^Base64Url$/i) !== null) {
                payload = base64UrlToByteArray(responseBody);
            }
            else if (mapperType.match(/^Sequence$/i) !== null) {
                payload = deserializeSequenceType(this, mapper, responseBody, objectName, updatedOptions);
            }
            else if (mapperType.match(/^Dictionary$/i) !== null) {
                payload = deserializeDictionaryType(this, mapper, responseBody, objectName, updatedOptions);
            }
        }
        if (mapper.isConstant) {
            payload = mapper.defaultValue;
        }
        return payload;
    };
    return Serializer;
}());

function trimEnd(str, ch) {
    var len = str.length;
    while (len - 1 >= 0 && str[len - 1] === ch) {
        --len;
    }
    return str.substr(0, len);
}
function bufferToBase64Url(buffer) {
    if (!buffer) {
        return undefined;
    }
    if (!(buffer instanceof Uint8Array)) {
        throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");
    }
    // Uint8Array to Base64.
    var str = _util_base64__WEBPACK_IMPORTED_MODULE_1__["encodeByteArray"](buffer);
    // Base64 to Base64Url.
    return trimEnd(str, "=")
        .replace(/\+/g, "-")
        .replace(/\//g, "_");
}
function base64UrlToByteArray(str) {
    if (!str) {
        return undefined;
    }
    if (str && typeof str.valueOf() !== "string") {
        throw new Error("Please provide an input of type string for converting to Uint8Array");
    }
    // Base64Url to Base64.
    str = str.replace(/-/g, "+").replace(/_/g, "/");
    // Base64 to Uint8Array.
    return _util_base64__WEBPACK_IMPORTED_MODULE_1__["decodeString"](str);
}
function splitSerializeName(prop) {
    var classes = [];
    var partialclass = "";
    if (prop) {
        var subwords = prop.split(".");
        for (var _i = 0, subwords_1 = subwords; _i < subwords_1.length; _i++) {
            var item = subwords_1[_i];
            if (item.charAt(item.length - 1) === "\\") {
                partialclass += item.substr(0, item.length - 1) + ".";
            }
            else {
                partialclass += item;
                classes.push(partialclass);
                partialclass = "";
            }
        }
    }
    return classes;
}
function dateToUnixTime(d) {
    if (!d) {
        return undefined;
    }
    if (typeof d.valueOf() === "string") {
        d = new Date(d);
    }
    return Math.floor(d.getTime() / 1000);
}
function unixTimeToDate(n) {
    if (!n) {
        return undefined;
    }
    return new Date(n * 1000);
}
function serializeBasicTypes(typeName, objectName, value) {
    if (value !== null && value !== undefined) {
        if (typeName.match(/^Number$/i) !== null) {
            if (typeof value !== "number") {
                throw new Error(objectName + " with value " + value + " must be of type number.");
            }
        }
        else if (typeName.match(/^String$/i) !== null) {
            if (typeof value.valueOf() !== "string") {
                throw new Error(objectName + " with value \"" + value + "\" must be of type string.");
            }
        }
        else if (typeName.match(/^Uuid$/i) !== null) {
            if (!(typeof value.valueOf() === "string" && _util_utils__WEBPACK_IMPORTED_MODULE_2__["isValidUuid"](value))) {
                throw new Error(objectName + " with value \"" + value + "\" must be of type string and a valid uuid.");
            }
        }
        else if (typeName.match(/^Boolean$/i) !== null) {
            if (typeof value !== "boolean") {
                throw new Error(objectName + " with value " + value + " must be of type boolean.");
            }
        }
        else if (typeName.match(/^Stream$/i) !== null) {
            var objectType = typeof value;
            if (objectType !== "string" &&
                objectType !== "function" &&
                !(value instanceof ArrayBuffer) &&
                !ArrayBuffer.isView(value) &&
                !((typeof Blob === "function" || typeof Blob === "object") && value instanceof Blob)) {
                throw new Error(objectName + " must be a string, Blob, ArrayBuffer, ArrayBufferView, or a function returning NodeJS.ReadableStream.");
            }
        }
    }
    return value;
}
function serializeEnumType(objectName, allowedValues, value) {
    if (!allowedValues) {
        throw new Error("Please provide a set of allowedValues to validate " + objectName + " as an Enum Type.");
    }
    var isPresent = allowedValues.some(function (item) {
        if (typeof item.valueOf() === "string") {
            return item.toLowerCase() === value.toLowerCase();
        }
        return item === value;
    });
    if (!isPresent) {
        throw new Error(value + " is not a valid value for " + objectName + ". The valid values are: " + JSON.stringify(allowedValues) + ".");
    }
    return value;
}
function serializeByteArrayType(objectName, value) {
    var returnValue = "";
    if (value != undefined) {
        if (!(value instanceof Uint8Array)) {
            throw new Error(objectName + " must be of type Uint8Array.");
        }
        returnValue = _util_base64__WEBPACK_IMPORTED_MODULE_1__["encodeByteArray"](value);
    }
    return returnValue;
}
function serializeBase64UrlType(objectName, value) {
    var returnValue = "";
    if (value != undefined) {
        if (!(value instanceof Uint8Array)) {
            throw new Error(objectName + " must be of type Uint8Array.");
        }
        returnValue = bufferToBase64Url(value) || "";
    }
    return returnValue;
}
function serializeDateTypes(typeName, value, objectName) {
    if (value != undefined) {
        if (typeName.match(/^Date$/i) !== null) {
            if (!(value instanceof Date ||
                (typeof value.valueOf() === "string" && !isNaN(Date.parse(value))))) {
                throw new Error(objectName + " must be an instanceof Date or a string in ISO8601 format.");
            }
            value =
                value instanceof Date
                    ? value.toISOString().substring(0, 10)
                    : new Date(value).toISOString().substring(0, 10);
        }
        else if (typeName.match(/^DateTime$/i) !== null) {
            if (!(value instanceof Date ||
                (typeof value.valueOf() === "string" && !isNaN(Date.parse(value))))) {
                throw new Error(objectName + " must be an instanceof Date or a string in ISO8601 format.");
            }
            value = value instanceof Date ? value.toISOString() : new Date(value).toISOString();
        }
        else if (typeName.match(/^DateTimeRfc1123$/i) !== null) {
            if (!(value instanceof Date ||
                (typeof value.valueOf() === "string" && !isNaN(Date.parse(value))))) {
                throw new Error(objectName + " must be an instanceof Date or a string in RFC-1123 format.");
            }
            value = value instanceof Date ? value.toUTCString() : new Date(value).toUTCString();
        }
        else if (typeName.match(/^UnixTime$/i) !== null) {
            if (!(value instanceof Date ||
                (typeof value.valueOf() === "string" && !isNaN(Date.parse(value))))) {
                throw new Error(objectName + " must be an instanceof Date or a string in RFC-1123/ISO8601 format " +
                    "for it to be serialized in UnixTime/Epoch format.");
            }
            value = dateToUnixTime(value);
        }
        else if (typeName.match(/^TimeSpan$/i) !== null) {
            if (!_util_utils__WEBPACK_IMPORTED_MODULE_2__["isDuration"](value)) {
                throw new Error(objectName + " must be a string in ISO 8601 format. Instead was \"" + value + "\".");
            }
        }
    }
    return value;
}
function serializeSequenceType(serializer, mapper, object, objectName, isXml, options) {
    var _a, _b;
    if (!Array.isArray(object)) {
        throw new Error(objectName + " must be of type Array.");
    }
    var elementType = mapper.type.element;
    if (!elementType || typeof elementType !== "object") {
        throw new Error("element\" metadata for an Array must be defined in the " +
            ("mapper and it must of type \"object\" in " + objectName + "."));
    }
    var tempArray = [];
    for (var i = 0; i < object.length; i++) {
        var serializedValue = serializer.serialize(elementType, object[i], objectName, options);
        if (isXml && elementType.xmlNamespace) {
            var xmlnsKey = elementType.xmlNamespacePrefix
                ? "xmlns:" + elementType.xmlNamespacePrefix
                : "xmlns";
            if (elementType.type.name === "Composite") {
                tempArray[i] = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, serializedValue);
                tempArray[i][_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] = (_a = {}, _a[xmlnsKey] = elementType.xmlNamespace, _a);
            }
            else {
                tempArray[i] = {};
                tempArray[i][options.xmlCharKey] = serializedValue;
                tempArray[i][_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] = (_b = {}, _b[xmlnsKey] = elementType.xmlNamespace, _b);
            }
        }
        else {
            tempArray[i] = serializedValue;
        }
    }
    return tempArray;
}
function serializeDictionaryType(serializer, mapper, object, objectName, isXml, options) {
    var _a;
    if (typeof object !== "object") {
        throw new Error(objectName + " must be of type object.");
    }
    var valueType = mapper.type.value;
    if (!valueType || typeof valueType !== "object") {
        throw new Error("\"value\" metadata for a Dictionary must be defined in the " +
            ("mapper and it must of type \"object\" in " + objectName + "."));
    }
    var tempDictionary = {};
    for (var _i = 0, _b = Object.keys(object); _i < _b.length; _i++) {
        var key = _b[_i];
        var serializedValue = serializer.serialize(valueType, object[key], objectName, options);
        // If the element needs an XML namespace we need to add it within the $ property
        tempDictionary[key] = getXmlObjectValue(valueType, serializedValue, isXml, options);
    }
    // Add the namespace to the root element if needed
    if (isXml && mapper.xmlNamespace) {
        var xmlnsKey = mapper.xmlNamespacePrefix ? "xmlns:" + mapper.xmlNamespacePrefix : "xmlns";
        var result = tempDictionary;
        result[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] = (_a = {}, _a[xmlnsKey] = mapper.xmlNamespace, _a);
        return result;
    }
    return tempDictionary;
}
/**
 * Resolves the additionalProperties property from a referenced mapper
 * @param serializer the serializer containing the entire set of mappers
 * @param mapper the composite mapper to resolve
 * @param objectName name of the object being serialized
 */
function resolveAdditionalProperties(serializer, mapper, objectName) {
    var additionalProperties = mapper.type.additionalProperties;
    if (!additionalProperties && mapper.type.className) {
        var modelMapper = resolveReferencedMapper(serializer, mapper, objectName);
        return modelMapper === null || modelMapper === void 0 ? void 0 : modelMapper.type.additionalProperties;
    }
    return additionalProperties;
}
/**
 * Finds the mapper referenced by className
 * @param serializer the serializer containing the entire set of mappers
 * @param mapper the composite mapper to resolve
 * @param objectName name of the object being serialized
 */
function resolveReferencedMapper(serializer, mapper, objectName) {
    var className = mapper.type.className;
    if (!className) {
        throw new Error("Class name for model \"" + objectName + "\" is not provided in the mapper \"" + JSON.stringify(mapper, undefined, 2) + "\".");
    }
    return serializer.modelMappers[className];
}
/**
 * Resolves a composite mapper's modelProperties.
 * @param serializer the serializer containing the entire set of mappers
 * @param mapper the composite mapper to resolve
 */
function resolveModelProperties(serializer, mapper, objectName) {
    var modelProps = mapper.type.modelProperties;
    if (!modelProps) {
        var modelMapper = resolveReferencedMapper(serializer, mapper, objectName);
        if (!modelMapper) {
            throw new Error("mapper() cannot be null or undefined for model \"" + mapper.type.className + "\".");
        }
        modelProps = modelMapper === null || modelMapper === void 0 ? void 0 : modelMapper.type.modelProperties;
        if (!modelProps) {
            throw new Error("modelProperties cannot be null or undefined in the " +
                ("mapper \"" + JSON.stringify(modelMapper) + "\" of type \"" + mapper.type.className + "\" for object \"" + objectName + "\"."));
        }
    }
    return modelProps;
}
function serializeCompositeType(serializer, mapper, object, objectName, isXml, options) {
    var _a, _b;
    if (getPolymorphicDiscriminatorRecursively(serializer, mapper)) {
        mapper = getPolymorphicMapper(serializer, mapper, object, "clientName");
    }
    if (object != undefined) {
        var payload = {};
        var modelProps = resolveModelProperties(serializer, mapper, objectName);
        for (var _i = 0, _c = Object.keys(modelProps); _i < _c.length; _i++) {
            var key = _c[_i];
            var propertyMapper = modelProps[key];
            if (propertyMapper.readOnly) {
                continue;
            }
            var propName = void 0;
            var parentObject = payload;
            if (serializer.isXML) {
                if (propertyMapper.xmlIsWrapped) {
                    propName = propertyMapper.xmlName;
                }
                else {
                    propName = propertyMapper.xmlElementName || propertyMapper.xmlName;
                }
            }
            else {
                var paths = splitSerializeName(propertyMapper.serializedName);
                propName = paths.pop();
                for (var _d = 0, paths_1 = paths; _d < paths_1.length; _d++) {
                    var pathName = paths_1[_d];
                    var childObject = parentObject[pathName];
                    if (childObject == undefined &&
                        (object[key] != undefined || propertyMapper.defaultValue !== undefined)) {
                        parentObject[pathName] = {};
                    }
                    parentObject = parentObject[pathName];
                }
            }
            if (parentObject != undefined) {
                if (isXml && mapper.xmlNamespace) {
                    var xmlnsKey = mapper.xmlNamespacePrefix
                        ? "xmlns:" + mapper.xmlNamespacePrefix
                        : "xmlns";
                    parentObject[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, parentObject[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]]), (_a = {}, _a[xmlnsKey] = mapper.xmlNamespace, _a));
                }
                var propertyObjectName = propertyMapper.serializedName !== ""
                    ? objectName + "." + propertyMapper.serializedName
                    : objectName;
                var toSerialize = object[key];
                var polymorphicDiscriminator = getPolymorphicDiscriminatorRecursively(serializer, mapper);
                if (polymorphicDiscriminator &&
                    polymorphicDiscriminator.clientName === key &&
                    toSerialize == undefined) {
                    toSerialize = mapper.serializedName;
                }
                var serializedValue = serializer.serialize(propertyMapper, toSerialize, propertyObjectName, options);
                if (serializedValue !== undefined && propName != undefined) {
                    var value = getXmlObjectValue(propertyMapper, serializedValue, isXml, options);
                    if (isXml && propertyMapper.xmlIsAttribute) {
                        // XML_ATTRKEY, i.e., $ is the key attributes are kept under in xml2js.
                        // This keeps things simple while preventing name collision
                        // with names in user documents.
                        parentObject[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] = parentObject[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] || {};
                        parentObject[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]][propName] = serializedValue;
                    }
                    else if (isXml && propertyMapper.xmlIsWrapped) {
                        parentObject[propName] = (_b = {}, _b[propertyMapper.xmlElementName] = value, _b);
                    }
                    else {
                        parentObject[propName] = value;
                    }
                }
            }
        }
        var additionalPropertiesMapper = resolveAdditionalProperties(serializer, mapper, objectName);
        if (additionalPropertiesMapper) {
            var propNames = Object.keys(modelProps);
            var _loop_1 = function (clientPropName) {
                var isAdditionalProperty = propNames.every(function (pn) { return pn !== clientPropName; });
                if (isAdditionalProperty) {
                    payload[clientPropName] = serializer.serialize(additionalPropertiesMapper, object[clientPropName], objectName + '["' + clientPropName + '"]', options);
                }
            };
            for (var clientPropName in object) {
                _loop_1(clientPropName);
            }
        }
        return payload;
    }
    return object;
}
function getXmlObjectValue(propertyMapper, serializedValue, isXml, options) {
    var _a;
    if (!isXml || !propertyMapper.xmlNamespace) {
        return serializedValue;
    }
    var xmlnsKey = propertyMapper.xmlNamespacePrefix
        ? "xmlns:" + propertyMapper.xmlNamespacePrefix
        : "xmlns";
    var xmlNamespace = (_a = {}, _a[xmlnsKey] = propertyMapper.xmlNamespace, _a);
    if (["Composite"].includes(propertyMapper.type.name)) {
        if (serializedValue[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]]) {
            return serializedValue;
        }
        else {
            var result_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, serializedValue);
            result_1[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] = xmlNamespace;
            return result_1;
        }
    }
    var result = {};
    result[options.xmlCharKey] = serializedValue;
    result[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]] = xmlNamespace;
    return result;
}
function isSpecialXmlProperty(propertyName, options) {
    return [_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"], options.xmlCharKey].includes(propertyName);
}
function deserializeCompositeType(serializer, mapper, responseBody, objectName, options) {
    var _a;
    if (getPolymorphicDiscriminatorRecursively(serializer, mapper)) {
        mapper = getPolymorphicMapper(serializer, mapper, responseBody, "serializedName");
    }
    var modelProps = resolveModelProperties(serializer, mapper, objectName);
    var instance = {};
    var handledPropertyNames = [];
    for (var _i = 0, _b = Object.keys(modelProps); _i < _b.length; _i++) {
        var key = _b[_i];
        var propertyMapper = modelProps[key];
        var paths = splitSerializeName(modelProps[key].serializedName);
        handledPropertyNames.push(paths[0]);
        var serializedName = propertyMapper.serializedName, xmlName = propertyMapper.xmlName, xmlElementName = propertyMapper.xmlElementName;
        var propertyObjectName = objectName;
        if (serializedName !== "" && serializedName !== undefined) {
            propertyObjectName = objectName + "." + serializedName;
        }
        var headerCollectionPrefix = propertyMapper.headerCollectionPrefix;
        if (headerCollectionPrefix) {
            var dictionary = {};
            for (var _c = 0, _d = Object.keys(responseBody); _c < _d.length; _c++) {
                var headerKey = _d[_c];
                if (headerKey.startsWith(headerCollectionPrefix)) {
                    dictionary[headerKey.substring(headerCollectionPrefix.length)] = serializer.deserialize(propertyMapper.type.value, responseBody[headerKey], propertyObjectName, options);
                }
                handledPropertyNames.push(headerKey);
            }
            instance[key] = dictionary;
        }
        else if (serializer.isXML) {
            if (propertyMapper.xmlIsAttribute && responseBody[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]]) {
                instance[key] = serializer.deserialize(propertyMapper, responseBody[_util_serializer_common__WEBPACK_IMPORTED_MODULE_3__["XML_ATTRKEY"]][xmlName], propertyObjectName, options);
            }
            else {
                var propertyName = xmlElementName || xmlName || serializedName;
                if (propertyMapper.xmlIsWrapped) {
                    /* a list of <xmlElementName> wrapped by <xmlName>
                      For the xml example below
                        <Cors>
                          <CorsRule>...</CorsRule>
                          <CorsRule>...</CorsRule>
                        </Cors>
                      the responseBody has
                        {
                          Cors: {
                            CorsRule: [{...}, {...}]
                          }
                        }
                      xmlName is "Cors" and xmlElementName is"CorsRule".
                    */
                    var wrapped = responseBody[xmlName];
                    var elementList = (_a = wrapped === null || wrapped === void 0 ? void 0 : wrapped[xmlElementName]) !== null && _a !== void 0 ? _a : [];
                    instance[key] = serializer.deserialize(propertyMapper, elementList, propertyObjectName, options);
                }
                else {
                    var property = responseBody[propertyName];
                    instance[key] = serializer.deserialize(propertyMapper, property, propertyObjectName, options);
                }
            }
        }
        else {
            // deserialize the property if it is present in the provided responseBody instance
            var propertyInstance = void 0;
            var res = responseBody;
            // traversing the object step by step.
            for (var _e = 0, paths_2 = paths; _e < paths_2.length; _e++) {
                var item = paths_2[_e];
                if (!res)
                    break;
                res = res[item];
            }
            propertyInstance = res;
            var polymorphicDiscriminator = mapper.type.polymorphicDiscriminator;
            // checking that the model property name (key)(ex: "fishtype") and the
            // clientName of the polymorphicDiscriminator {metadata} (ex: "fishtype")
            // instead of the serializedName of the polymorphicDiscriminator (ex: "fish.type")
            // is a better approach. The generator is not consistent with escaping '\.' in the
            // serializedName of the property (ex: "fish\.type") that is marked as polymorphic discriminator
            // and the serializedName of the metadata polymorphicDiscriminator (ex: "fish.type"). However,
            // the clientName transformation of the polymorphicDiscriminator (ex: "fishtype") and
            // the transformation of model property name (ex: "fishtype") is done consistently.
            // Hence, it is a safer bet to rely on the clientName of the polymorphicDiscriminator.
            if (polymorphicDiscriminator &&
                key === polymorphicDiscriminator.clientName &&
                propertyInstance == undefined) {
                propertyInstance = mapper.serializedName;
            }
            var serializedValue = void 0;
            // paging
            if (Array.isArray(responseBody[key]) && modelProps[key].serializedName === "") {
                propertyInstance = responseBody[key];
                instance = serializer.deserialize(propertyMapper, propertyInstance, propertyObjectName, options);
            }
            else if (propertyInstance !== undefined || propertyMapper.defaultValue !== undefined) {
                serializedValue = serializer.deserialize(propertyMapper, propertyInstance, propertyObjectName, options);
                instance[key] = serializedValue;
            }
        }
    }
    var additionalPropertiesMapper = mapper.type.additionalProperties;
    if (additionalPropertiesMapper) {
        var isAdditionalProperty = function (responsePropName) {
            for (var clientPropName in modelProps) {
                var paths = splitSerializeName(modelProps[clientPropName].serializedName);
                if (paths[0] === responsePropName) {
                    return false;
                }
            }
            return true;
        };
        for (var responsePropName in responseBody) {
            if (isAdditionalProperty(responsePropName)) {
                instance[responsePropName] = serializer.deserialize(additionalPropertiesMapper, responseBody[responsePropName], objectName + '["' + responsePropName + '"]', options);
            }
        }
    }
    else if (responseBody) {
        for (var _f = 0, _g = Object.keys(responseBody); _f < _g.length; _f++) {
            var key = _g[_f];
            if (instance[key] === undefined &&
                !handledPropertyNames.includes(key) &&
                !isSpecialXmlProperty(key, options)) {
                instance[key] = responseBody[key];
            }
        }
    }
    return instance;
}
function deserializeDictionaryType(serializer, mapper, responseBody, objectName, options) {
    var value = mapper.type.value;
    if (!value || typeof value !== "object") {
        throw new Error("\"value\" metadata for a Dictionary must be defined in the " +
            ("mapper and it must of type \"object\" in " + objectName));
    }
    if (responseBody) {
        var tempDictionary = {};
        for (var _i = 0, _a = Object.keys(responseBody); _i < _a.length; _i++) {
            var key = _a[_i];
            tempDictionary[key] = serializer.deserialize(value, responseBody[key], objectName, options);
        }
        return tempDictionary;
    }
    return responseBody;
}
function deserializeSequenceType(serializer, mapper, responseBody, objectName, options) {
    var element = mapper.type.element;
    if (!element || typeof element !== "object") {
        throw new Error("element\" metadata for an Array must be defined in the " +
            ("mapper and it must of type \"object\" in " + objectName));
    }
    if (responseBody) {
        if (!Array.isArray(responseBody)) {
            // xml2js will interpret a single element array as just the element, so force it to be an array
            responseBody = [responseBody];
        }
        var tempArray = [];
        for (var i = 0; i < responseBody.length; i++) {
            tempArray[i] = serializer.deserialize(element, responseBody[i], objectName + "[" + i + "]", options);
        }
        return tempArray;
    }
    return responseBody;
}
function getPolymorphicMapper(serializer, mapper, object, polymorphicPropertyName) {
    var polymorphicDiscriminator = getPolymorphicDiscriminatorRecursively(serializer, mapper);
    if (polymorphicDiscriminator) {
        var discriminatorName = polymorphicDiscriminator[polymorphicPropertyName];
        if (discriminatorName != undefined) {
            var discriminatorValue = object[discriminatorName];
            if (discriminatorValue != undefined) {
                var typeName = mapper.type.uberParent || mapper.type.className;
                var indexDiscriminator = discriminatorValue === typeName
                    ? discriminatorValue
                    : typeName + "." + discriminatorValue;
                var polymorphicMapper = serializer.modelMappers.discriminators[indexDiscriminator];
                if (polymorphicMapper) {
                    mapper = polymorphicMapper;
                }
            }
        }
    }
    return mapper;
}
function getPolymorphicDiscriminatorRecursively(serializer, mapper) {
    return (mapper.type.polymorphicDiscriminator ||
        getPolymorphicDiscriminatorSafely(serializer, mapper.type.uberParent) ||
        getPolymorphicDiscriminatorSafely(serializer, mapper.type.className));
}
function getPolymorphicDiscriminatorSafely(serializer, typeName) {
    return (typeName &&
        serializer.modelMappers[typeName] &&
        serializer.modelMappers[typeName].type.polymorphicDiscriminator);
}
// TODO: why is this here?
function serializeObject(toSerialize) {
    if (toSerialize == undefined)
        return undefined;
    if (toSerialize instanceof Uint8Array) {
        toSerialize = _util_base64__WEBPACK_IMPORTED_MODULE_1__["encodeByteArray"](toSerialize);
        return toSerialize;
    }
    else if (toSerialize instanceof Date) {
        return toSerialize.toISOString();
    }
    else if (Array.isArray(toSerialize)) {
        var array = [];
        for (var i = 0; i < toSerialize.length; i++) {
            array.push(serializeObject(toSerialize[i]));
        }
        return array;
    }
    else if (typeof toSerialize === "object") {
        var dictionary = {};
        for (var property in toSerialize) {
            dictionary[property] = serializeObject(toSerialize[property]);
        }
        return dictionary;
    }
    return toSerialize;
}
/**
 * Utility function to create a K:V from a list of strings
 */
function strEnum(o) {
    var result = {};
    for (var _i = 0, o_1 = o; _i < o_1.length; _i++) {
        var key = o_1[_i];
        result[key] = key;
    }
    return result;
}
var MapperType = strEnum([
    "Base64Url",
    "Boolean",
    "ByteArray",
    "Composite",
    "Date",
    "DateTime",
    "DateTimeRfc1123",
    "Dictionary",
    "Enum",
    "Number",
    "Object",
    "Sequence",
    "String",
    "Stream",
    "TimeSpan",
    "UnixTime"
]);
//# sourceMappingURL=serializer.js.map

/***/ }),
/* 17 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__extends", function() { return __extends; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__assign", function() { return __assign; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__rest", function() { return __rest; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__decorate", function() { return __decorate; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__param", function() { return __param; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__metadata", function() { return __metadata; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__awaiter", function() { return __awaiter; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__generator", function() { return __generator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__createBinding", function() { return __createBinding; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__exportStar", function() { return __exportStar; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__values", function() { return __values; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__read", function() { return __read; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spread", function() { return __spread; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spreadArrays", function() { return __spreadArrays; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spreadArray", function() { return __spreadArray; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__await", function() { return __await; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncGenerator", function() { return __asyncGenerator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncDelegator", function() { return __asyncDelegator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncValues", function() { return __asyncValues; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__makeTemplateObject", function() { return __makeTemplateObject; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__importStar", function() { return __importStar; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__importDefault", function() { return __importDefault; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__classPrivateFieldGet", function() { return __classPrivateFieldGet; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__classPrivateFieldSet", function() { return __classPrivateFieldSet; });
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    if (typeof b !== "function" && b !== null)
        throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    }
    return __assign.apply(this, arguments);
}

function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __param(paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

var __createBinding = Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
});

function __exportStar(m, o) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);
}

function __values(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

/** @deprecated */
function __spread() {
    for (var ar = [], i = 0; i < arguments.length; i++)
        ar = ar.concat(__read(arguments[i]));
    return ar;
}

/** @deprecated */
function __spreadArrays() {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
}

function __spreadArray(to, from) {
    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)
        to[j] = from[i];
    return to;
}

function __await(v) {
    return this instanceof __await ? (this.v = v, this) : new __await(v);
}

function __asyncGenerator(thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
}

function __asyncDelegator(o) {
    var i, p;
    return i = {}, verb("next"), verb("throw", function (e) { throw e; }), verb("return"), i[Symbol.iterator] = function () { return this; }, i;
    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }
}

function __asyncValues(o) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }
}

function __makeTemplateObject(cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};

var __setModuleDefault = Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
};

function __importStar(mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
}

function __importDefault(mod) {
    return (mod && mod.__esModule) ? mod : { default: mod };
}

function __classPrivateFieldGet(receiver, privateMap) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to get private field on non-instance");
    }
    return privateMap.get(receiver);
}

function __classPrivateFieldSet(receiver, privateMap, value) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to set private field on non-instance");
    }
    privateMap.set(receiver, value);
    return value;
}


/***/ }),
/* 18 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "encodeString", function() { return encodeString; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "encodeByteArray", function() { return encodeByteArray; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "decodeString", function() { return decodeString; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * Encodes a string in base64 format.
 * @param value the string to encode
 */
function encodeString(value) {
    return btoa(value);
}
/**
 * Encodes a byte array in base64 format.
 * @param value the Uint8Aray to encode
 */
function encodeByteArray(value) {
    var str = "";
    for (var i = 0; i < value.length; i++) {
        str += String.fromCharCode(value[i]);
    }
    return btoa(str);
}
/**
 * Decodes a base64 string into a byte array.
 * @param value the base64 string to decode
 */
function decodeString(value) {
    var byteString = atob(value);
    var arr = new Uint8Array(byteString.length);
    for (var i = 0; i < byteString.length; i++) {
        arr[i] = byteString.charCodeAt(i);
    }
    return arr;
}
//# sourceMappingURL=base64.browser.js.map

/***/ }),
/* 19 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function(process) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isNode", function() { return isNode; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "urlIsHTTPS", function() { return urlIsHTTPS; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "encodeUri", function() { return encodeUri; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "stripResponse", function() { return stripResponse; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "stripRequest", function() { return stripRequest; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isValidUuid", function() { return isValidUuid; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "generateUuid", function() { return generateUuid; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "executePromisesSequentially", function() { return executePromisesSequentially; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "delay", function() { return delay; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "promiseToCallback", function() { return promiseToCallback; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "promiseToServiceCallback", function() { return promiseToServiceCallback; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "prepareXMLRootList", function() { return prepareXMLRootList; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "applyMixins", function() { return applyMixins; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isDuration", function() { return isDuration; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "replaceAll", function() { return replaceAll; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isPrimitiveType", function() { return isPrimitiveType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getEnvironmentValue", function() { return getEnvironmentValue; });
/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(21);
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(36);
/* harmony import */ var _serializer_common__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(37);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



var validUuidRegex = /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;
/**
 * A constant that indicates whether the environment is node.js or browser based.
 */
var isNode = typeof process !== "undefined" &&
    !!process.version &&
    !!process.versions &&
    !!process.versions.node;
/**
 * Checks if a parsed URL is HTTPS
 *
 * @param {object} urlToCheck The url to check
 * @return {boolean} True if the URL is HTTPS; false otherwise.
 */
function urlIsHTTPS(urlToCheck) {
    return urlToCheck.protocol.toLowerCase() === _constants__WEBPACK_IMPORTED_MODULE_1__["Constants"].HTTPS;
}
/**
 * Encodes an URI.
 *
 * @param {string} uri The URI to be encoded.
 * @return {string} The encoded URI.
 */
function encodeUri(uri) {
    return encodeURIComponent(uri)
        .replace(/!/g, "%21")
        .replace(/"/g, "%27")
        .replace(/\(/g, "%28")
        .replace(/\)/g, "%29")
        .replace(/\*/g, "%2A");
}
/**
 * Returns a stripped version of the Http Response which only contains body,
 * headers and the status.
 *
 * @param {HttpOperationResponse} response The Http Response
 *
 * @return {object} The stripped version of Http Response.
 */
function stripResponse(response) {
    var strippedResponse = {};
    strippedResponse.body = response.bodyAsText;
    strippedResponse.headers = response.headers;
    strippedResponse.status = response.status;
    return strippedResponse;
}
/**
 * Returns a stripped version of the Http Request that does not contain the
 * Authorization header.
 *
 * @param {WebResourceLike} request The Http Request object
 *
 * @return {WebResourceLike} The stripped version of Http Request.
 */
function stripRequest(request) {
    var strippedRequest = request.clone();
    if (strippedRequest.headers) {
        strippedRequest.headers.remove("authorization");
    }
    return strippedRequest;
}
/**
 * Validates the given uuid as a string
 *
 * @param {string} uuid The uuid as a string that needs to be validated
 *
 * @return {boolean} True if the uuid is valid; false otherwise.
 */
function isValidUuid(uuid) {
    return validUuidRegex.test(uuid);
}
/**
 * Generated UUID
 *
 * @return {string} RFC4122 v4 UUID.
 */
function generateUuid() {
    return Object(uuid__WEBPACK_IMPORTED_MODULE_0__["v4"])();
}
/**
 * Executes an array of promises sequentially. Inspiration of this method is here:
 * https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html. An awesome blog on promises!
 *
 * @param {Array} promiseFactories An array of promise factories(A function that return a promise)
 *
 * @param {any} [kickstart] Input to the first promise that is used to kickstart the promise chain.
 * If not provided then the promise chain starts with undefined.
 *
 * @return A chain of resolved or rejected promises
 */
function executePromisesSequentially(promiseFactories, kickstart) {
    var result = Promise.resolve(kickstart);
    promiseFactories.forEach(function (promiseFactory) {
        result = result.then(promiseFactory);
    });
    return result;
}
/**
 * A wrapper for setTimeout that resolves a promise after t milliseconds.
 * @param {number} t The number of milliseconds to be delayed.
 * @param {T} value The value to be resolved with after a timeout of t milliseconds.
 * @returns {Promise<T>} Resolved promise
 */
function delay(t, value) {
    return new Promise(function (resolve) { return setTimeout(function () { return resolve(value); }, t); });
}
/**
 * Converts a Promise to a callback.
 * @param {Promise<any>} promise The Promise to be converted to a callback
 * @returns {Function} A function that takes the callback (cb: Function): void
 * @deprecated generated code should instead depend on responseToBody
 */
function promiseToCallback(promise) {
    if (typeof promise.then !== "function") {
        throw new Error("The provided input is not a Promise.");
    }
    return function (cb) {
        promise
            .then(function (data) {
            // eslint-disable-next-line promise/no-callback-in-promise
            return cb(undefined, data);
        })
            .catch(function (err) {
            // eslint-disable-next-line promise/no-callback-in-promise
            cb(err);
        });
    };
}
/**
 * Converts a Promise to a service callback.
 * @param {Promise<HttpOperationResponse>} promise - The Promise of HttpOperationResponse to be converted to a service callback
 * @returns {Function} A function that takes the service callback (cb: ServiceCallback<T>): void
 */
function promiseToServiceCallback(promise) {
    if (typeof promise.then !== "function") {
        throw new Error("The provided input is not a Promise.");
    }
    return function (cb) {
        promise
            .then(function (data) {
            return process.nextTick(cb, undefined, data.parsedBody, data.request, data);
        })
            .catch(function (err) {
            process.nextTick(cb, err);
        });
    };
}
function prepareXMLRootList(obj, elementName, xmlNamespaceKey, xmlNamespace) {
    var _a, _b, _c;
    if (!Array.isArray(obj)) {
        obj = [obj];
    }
    if (!xmlNamespaceKey || !xmlNamespace) {
        return _a = {}, _a[elementName] = obj, _a;
    }
    var result = (_b = {}, _b[elementName] = obj, _b);
    result[_serializer_common__WEBPACK_IMPORTED_MODULE_2__["XML_ATTRKEY"]] = (_c = {}, _c[xmlNamespaceKey] = xmlNamespace, _c);
    return result;
}
/**
 * Applies the properties on the prototype of sourceCtors to the prototype of targetCtor
 * @param {object} targetCtor The target object on which the properties need to be applied.
 * @param {Array<object>} sourceCtors An array of source objects from which the properties need to be taken.
 */
function applyMixins(targetCtor, sourceCtors) {
    sourceCtors.forEach(function (sourceCtors) {
        Object.getOwnPropertyNames(sourceCtors.prototype).forEach(function (name) {
            targetCtor.prototype[name] = sourceCtors.prototype[name];
        });
    });
}
var validateISODuration = /^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;
/**
 * Indicates whether the given string is in ISO 8601 format.
 * @param {string} value The value to be validated for ISO 8601 duration format.
 * @return {boolean} `true` if valid, `false` otherwise.
 */
function isDuration(value) {
    return validateISODuration.test(value);
}
/**
 * Replace all of the instances of searchValue in value with the provided replaceValue.
 * @param {string | undefined} value The value to search and replace in.
 * @param {string} searchValue The value to search for in the value argument.
 * @param {string} replaceValue The value to replace searchValue with in the value argument.
 * @returns {string | undefined} The value where each instance of searchValue was replaced with replacedValue.
 */
function replaceAll(value, searchValue, replaceValue) {
    return !value || !searchValue ? value : value.split(searchValue).join(replaceValue || "");
}
/**
 * Determines whether the given entity is a basic/primitive type
 * (string, number, boolean, null, undefined).
 * @param {any} value Any entity
 * @return {boolean} - true is it is primitive type, false otherwise.
 */
function isPrimitiveType(value) {
    return (typeof value !== "object" && typeof value !== "function") || value === null;
}
function getEnvironmentValue(name) {
    if (process.env[name]) {
        return process.env[name];
    }
    else if (process.env[name.toLowerCase()]) {
        return process.env[name.toLowerCase()];
    }
    return undefined;
}
//# sourceMappingURL=utils.js.map
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(20)))

/***/ }),
/* 20 */
/***/ (function(module, exports) {

// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };


/***/ }),
/* 21 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _v1_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(22);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "v1", function() { return _v1_js__WEBPACK_IMPORTED_MODULE_0__["default"]; });

/* harmony import */ var _v3_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(27);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "v3", function() { return _v3_js__WEBPACK_IMPORTED_MODULE_1__["default"]; });

/* harmony import */ var _v4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(31);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "v4", function() { return _v4_js__WEBPACK_IMPORTED_MODULE_2__["default"]; });

/* harmony import */ var _v5_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(32);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "v5", function() { return _v5_js__WEBPACK_IMPORTED_MODULE_3__["default"]; });

/* harmony import */ var _nil_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(34);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NIL", function() { return _nil_js__WEBPACK_IMPORTED_MODULE_4__["default"]; });

/* harmony import */ var _version_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(35);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "version", function() { return _version_js__WEBPACK_IMPORTED_MODULE_5__["default"]; });

/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(25);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "validate", function() { return _validate_js__WEBPACK_IMPORTED_MODULE_6__["default"]; });

/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(24);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "stringify", function() { return _stringify_js__WEBPACK_IMPORTED_MODULE_7__["default"]; });

/* harmony import */ var _parse_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(29);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "parse", function() { return _parse_js__WEBPACK_IMPORTED_MODULE_8__["default"]; });











/***/ }),
/* 22 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _rng_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(23);
/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(24);

 // **`v1()` - Generate time-based UUID**
//
// Inspired by https://github.com/LiosK/UUID.js
// and http://docs.python.org/library/uuid.html

var _nodeId;

var _clockseq; // Previous uuid creation time


var _lastMSecs = 0;
var _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details

function v1(options, buf, offset) {
  var i = buf && offset || 0;
  var b = buf || new Array(16);
  options = options || {};
  var node = options.node || _nodeId;
  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not
  // specified.  We do this lazily to minimize issues related to insufficient
  // system entropy.  See #189

  if (node == null || clockseq == null) {
    var seedBytes = options.random || (options.rng || _rng_js__WEBPACK_IMPORTED_MODULE_0__["default"])();

    if (node == null) {
      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)
      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];
    }

    if (clockseq == null) {
      // Per 4.2.2, randomize (14 bit) clockseq
      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;
    }
  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,
  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so
  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'
  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.


  var msecs = options.msecs !== undefined ? options.msecs : Date.now(); // Per 4.2.1.2, use count of uuid's generated during the current clock
  // cycle to simulate higher resolution clock

  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)

  var dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression

  if (dt < 0 && options.clockseq === undefined) {
    clockseq = clockseq + 1 & 0x3fff;
  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new
  // time interval


  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {
    nsecs = 0;
  } // Per 4.2.1.2 Throw error if too many uuids are requested


  if (nsecs >= 10000) {
    throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");
  }

  _lastMSecs = msecs;
  _lastNSecs = nsecs;
  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch

  msecs += 12219292800000; // `time_low`

  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;
  b[i++] = tl >>> 24 & 0xff;
  b[i++] = tl >>> 16 & 0xff;
  b[i++] = tl >>> 8 & 0xff;
  b[i++] = tl & 0xff; // `time_mid`

  var tmh = msecs / 0x100000000 * 10000 & 0xfffffff;
  b[i++] = tmh >>> 8 & 0xff;
  b[i++] = tmh & 0xff; // `time_high_and_version`

  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version

  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)

  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`

  b[i++] = clockseq & 0xff; // `node`

  for (var n = 0; n < 6; ++n) {
    b[i + n] = node[n];
  }

  return buf || Object(_stringify_js__WEBPACK_IMPORTED_MODULE_1__["default"])(b);
}

/* harmony default export */ __webpack_exports__["default"] = (v1);

/***/ }),
/* 23 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return rng; });
// Unique ID creation requires a high quality random # generator. In the browser we therefore
// require the crypto API and do not support built-in fallback to lower quality random number
// generators (like Math.random()).
var getRandomValues;
var rnds8 = new Uint8Array(16);
function rng() {
  // lazy load so that environments that need to polyfill have a chance to do so
  if (!getRandomValues) {
    // getRandomValues needs to be invoked in a context where "this" is a Crypto implementation. Also,
    // find the complete implementation of crypto (msCrypto) on IE11.
    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);

    if (!getRandomValues) {
      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');
    }
  }

  return getRandomValues(rnds8);
}

/***/ }),
/* 24 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(25);

/**
 * Convert array of 16 byte values to UUID string format of the form:
 * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
 */

var byteToHex = [];

for (var i = 0; i < 256; ++i) {
  byteToHex.push((i + 0x100).toString(16).substr(1));
}

function stringify(arr) {
  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  // Note: Be careful editing this code!  It's been tuned for performance
  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434
  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one
  // of the following:
  // - One or more input array values don't map to a hex octet (leading to
  // "undefined" in the uuid)
  // - Invalid input values for the RFC `version` or `variant` fields

  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__["default"])(uuid)) {
    throw TypeError('Stringified UUID is invalid');
  }

  return uuid;
}

/* harmony default export */ __webpack_exports__["default"] = (stringify);

/***/ }),
/* 25 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _regex_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(26);


function validate(uuid) {
  return typeof uuid === 'string' && _regex_js__WEBPACK_IMPORTED_MODULE_0__["default"].test(uuid);
}

/* harmony default export */ __webpack_exports__["default"] = (validate);

/***/ }),
/* 26 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony default export */ __webpack_exports__["default"] = (/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i);

/***/ }),
/* 27 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _v35_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(28);
/* harmony import */ var _md5_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(30);


var v3 = Object(_v35_js__WEBPACK_IMPORTED_MODULE_0__["default"])('v3', 0x30, _md5_js__WEBPACK_IMPORTED_MODULE_1__["default"]);
/* harmony default export */ __webpack_exports__["default"] = (v3);

/***/ }),
/* 28 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DNS", function() { return DNS; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "URL", function() { return URL; });
/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(24);
/* harmony import */ var _parse_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(29);



function stringToBytes(str) {
  str = unescape(encodeURIComponent(str)); // UTF8 escape

  var bytes = [];

  for (var i = 0; i < str.length; ++i) {
    bytes.push(str.charCodeAt(i));
  }

  return bytes;
}

var DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';
var URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';
/* harmony default export */ __webpack_exports__["default"] = (function (name, version, hashfunc) {
  function generateUUID(value, namespace, buf, offset) {
    if (typeof value === 'string') {
      value = stringToBytes(value);
    }

    if (typeof namespace === 'string') {
      namespace = Object(_parse_js__WEBPACK_IMPORTED_MODULE_1__["default"])(namespace);
    }

    if (namespace.length !== 16) {
      throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');
    } // Compute hash of namespace and value, Per 4.3
    // Future: Use spread syntax when supported on all platforms, e.g. `bytes =
    // hashfunc([...namespace, ... value])`


    var bytes = new Uint8Array(16 + value.length);
    bytes.set(namespace);
    bytes.set(value, namespace.length);
    bytes = hashfunc(bytes);
    bytes[6] = bytes[6] & 0x0f | version;
    bytes[8] = bytes[8] & 0x3f | 0x80;

    if (buf) {
      offset = offset || 0;

      for (var i = 0; i < 16; ++i) {
        buf[offset + i] = bytes[i];
      }

      return buf;
    }

    return Object(_stringify_js__WEBPACK_IMPORTED_MODULE_0__["default"])(bytes);
  } // Function#name is not settable on some platforms (#270)


  try {
    generateUUID.name = name; // eslint-disable-next-line no-empty
  } catch (err) {} // For CommonJS default export support


  generateUUID.DNS = DNS;
  generateUUID.URL = URL;
  return generateUUID;
});

/***/ }),
/* 29 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(25);


function parse(uuid) {
  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__["default"])(uuid)) {
    throw TypeError('Invalid UUID');
  }

  var v;
  var arr = new Uint8Array(16); // Parse ########-....-....-....-............

  arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;
  arr[1] = v >>> 16 & 0xff;
  arr[2] = v >>> 8 & 0xff;
  arr[3] = v & 0xff; // Parse ........-####-....-....-............

  arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;
  arr[5] = v & 0xff; // Parse ........-....-####-....-............

  arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;
  arr[7] = v & 0xff; // Parse ........-....-....-####-............

  arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;
  arr[9] = v & 0xff; // Parse ........-....-....-....-############
  // (Use "/" to avoid 32-bit truncation when bit-shifting high-order bytes)

  arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;
  arr[11] = v / 0x100000000 & 0xff;
  arr[12] = v >>> 24 & 0xff;
  arr[13] = v >>> 16 & 0xff;
  arr[14] = v >>> 8 & 0xff;
  arr[15] = v & 0xff;
  return arr;
}

/* harmony default export */ __webpack_exports__["default"] = (parse);

/***/ }),
/* 30 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/*
 * Browser-compatible JavaScript MD5
 *
 * Modification of JavaScript MD5
 * https://github.com/blueimp/JavaScript-MD5
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 *
 * Based on
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */
function md5(bytes) {
  if (typeof bytes === 'string') {
    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape

    bytes = new Uint8Array(msg.length);

    for (var i = 0; i < msg.length; ++i) {
      bytes[i] = msg.charCodeAt(i);
    }
  }

  return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes), bytes.length * 8));
}
/*
 * Convert an array of little-endian words to an array of bytes
 */


function md5ToHexEncodedArray(input) {
  var output = [];
  var length32 = input.length * 32;
  var hexTab = '0123456789abcdef';

  for (var i = 0; i < length32; i += 8) {
    var x = input[i >> 5] >>> i % 32 & 0xff;
    var hex = parseInt(hexTab.charAt(x >>> 4 & 0x0f) + hexTab.charAt(x & 0x0f), 16);
    output.push(hex);
  }

  return output;
}
/**
 * Calculate output length with padding and bit length
 */


function getOutputLength(inputLength8) {
  return (inputLength8 + 64 >>> 9 << 4) + 14 + 1;
}
/*
 * Calculate the MD5 of an array of little-endian words, and a bit length.
 */


function wordsToMd5(x, len) {
  /* append padding */
  x[len >> 5] |= 0x80 << len % 32;
  x[getOutputLength(len) - 1] = len;
  var a = 1732584193;
  var b = -271733879;
  var c = -1732584194;
  var d = 271733878;

  for (var i = 0; i < x.length; i += 16) {
    var olda = a;
    var oldb = b;
    var oldc = c;
    var oldd = d;
    a = md5ff(a, b, c, d, x[i], 7, -680876936);
    d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);
    c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);
    b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);
    a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);
    d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);
    c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);
    b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);
    a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);
    d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);
    c = md5ff(c, d, a, b, x[i + 10], 17, -42063);
    b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);
    a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);
    d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);
    c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);
    b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);
    a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);
    d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);
    c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);
    b = md5gg(b, c, d, a, x[i], 20, -373897302);
    a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);
    d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);
    c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);
    b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);
    a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);
    d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);
    c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);
    b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);
    a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);
    d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);
    c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);
    b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);
    a = md5hh(a, b, c, d, x[i + 5], 4, -378558);
    d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);
    c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);
    b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);
    a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);
    d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);
    c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);
    b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);
    a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);
    d = md5hh(d, a, b, c, x[i], 11, -358537222);
    c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);
    b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);
    a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);
    d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);
    c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);
    b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);
    a = md5ii(a, b, c, d, x[i], 6, -198630844);
    d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);
    c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);
    b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);
    a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);
    d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);
    c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);
    b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);
    a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);
    d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);
    c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);
    b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);
    a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);
    d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);
    c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);
    b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);
    a = safeAdd(a, olda);
    b = safeAdd(b, oldb);
    c = safeAdd(c, oldc);
    d = safeAdd(d, oldd);
  }

  return [a, b, c, d];
}
/*
 * Convert an array bytes to an array of little-endian words
 * Characters >255 have their high-byte silently ignored.
 */


function bytesToWords(input) {
  if (input.length === 0) {
    return [];
  }

  var length8 = input.length * 8;
  var output = new Uint32Array(getOutputLength(length8));

  for (var i = 0; i < length8; i += 8) {
    output[i >> 5] |= (input[i / 8] & 0xff) << i % 32;
  }

  return output;
}
/*
 * Add integers, wrapping at 2^32. This uses 16-bit operations internally
 * to work around bugs in some JS interpreters.
 */


function safeAdd(x, y) {
  var lsw = (x & 0xffff) + (y & 0xffff);
  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
  return msw << 16 | lsw & 0xffff;
}
/*
 * Bitwise rotate a 32-bit number to the left.
 */


function bitRotateLeft(num, cnt) {
  return num << cnt | num >>> 32 - cnt;
}
/*
 * These functions implement the four basic operations the algorithm uses.
 */


function md5cmn(q, a, b, x, s, t) {
  return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b);
}

function md5ff(a, b, c, d, x, s, t) {
  return md5cmn(b & c | ~b & d, a, b, x, s, t);
}

function md5gg(a, b, c, d, x, s, t) {
  return md5cmn(b & d | c & ~d, a, b, x, s, t);
}

function md5hh(a, b, c, d, x, s, t) {
  return md5cmn(b ^ c ^ d, a, b, x, s, t);
}

function md5ii(a, b, c, d, x, s, t) {
  return md5cmn(c ^ (b | ~d), a, b, x, s, t);
}

/* harmony default export */ __webpack_exports__["default"] = (md5);

/***/ }),
/* 31 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _rng_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(23);
/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(24);



function v4(options, buf, offset) {
  options = options || {};
  var rnds = options.random || (options.rng || _rng_js__WEBPACK_IMPORTED_MODULE_0__["default"])(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`

  rnds[6] = rnds[6] & 0x0f | 0x40;
  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided

  if (buf) {
    offset = offset || 0;

    for (var i = 0; i < 16; ++i) {
      buf[offset + i] = rnds[i];
    }

    return buf;
  }

  return Object(_stringify_js__WEBPACK_IMPORTED_MODULE_1__["default"])(rnds);
}

/* harmony default export */ __webpack_exports__["default"] = (v4);

/***/ }),
/* 32 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _v35_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(28);
/* harmony import */ var _sha1_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(33);


var v5 = Object(_v35_js__WEBPACK_IMPORTED_MODULE_0__["default"])('v5', 0x50, _sha1_js__WEBPACK_IMPORTED_MODULE_1__["default"]);
/* harmony default export */ __webpack_exports__["default"] = (v5);

/***/ }),
/* 33 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// Adapted from Chris Veness' SHA1 code at
// http://www.movable-type.co.uk/scripts/sha1.html
function f(s, x, y, z) {
  switch (s) {
    case 0:
      return x & y ^ ~x & z;

    case 1:
      return x ^ y ^ z;

    case 2:
      return x & y ^ x & z ^ y & z;

    case 3:
      return x ^ y ^ z;
  }
}

function ROTL(x, n) {
  return x << n | x >>> 32 - n;
}

function sha1(bytes) {
  var K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];
  var H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];

  if (typeof bytes === 'string') {
    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape

    bytes = [];

    for (var i = 0; i < msg.length; ++i) {
      bytes.push(msg.charCodeAt(i));
    }
  } else if (!Array.isArray(bytes)) {
    // Convert Array-like to Array
    bytes = Array.prototype.slice.call(bytes);
  }

  bytes.push(0x80);
  var l = bytes.length / 4 + 2;
  var N = Math.ceil(l / 16);
  var M = new Array(N);

  for (var _i = 0; _i < N; ++_i) {
    var arr = new Uint32Array(16);

    for (var j = 0; j < 16; ++j) {
      arr[j] = bytes[_i * 64 + j * 4] << 24 | bytes[_i * 64 + j * 4 + 1] << 16 | bytes[_i * 64 + j * 4 + 2] << 8 | bytes[_i * 64 + j * 4 + 3];
    }

    M[_i] = arr;
  }

  M[N - 1][14] = (bytes.length - 1) * 8 / Math.pow(2, 32);
  M[N - 1][14] = Math.floor(M[N - 1][14]);
  M[N - 1][15] = (bytes.length - 1) * 8 & 0xffffffff;

  for (var _i2 = 0; _i2 < N; ++_i2) {
    var W = new Uint32Array(80);

    for (var t = 0; t < 16; ++t) {
      W[t] = M[_i2][t];
    }

    for (var _t = 16; _t < 80; ++_t) {
      W[_t] = ROTL(W[_t - 3] ^ W[_t - 8] ^ W[_t - 14] ^ W[_t - 16], 1);
    }

    var a = H[0];
    var b = H[1];
    var c = H[2];
    var d = H[3];
    var e = H[4];

    for (var _t2 = 0; _t2 < 80; ++_t2) {
      var s = Math.floor(_t2 / 20);
      var T = ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[_t2] >>> 0;
      e = d;
      d = c;
      c = ROTL(b, 30) >>> 0;
      b = a;
      a = T;
    }

    H[0] = H[0] + a >>> 0;
    H[1] = H[1] + b >>> 0;
    H[2] = H[2] + c >>> 0;
    H[3] = H[3] + d >>> 0;
    H[4] = H[4] + e >>> 0;
  }

  return [H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff, H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff, H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff, H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff, H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff];
}

/* harmony default export */ __webpack_exports__["default"] = (sha1);

/***/ }),
/* 34 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony default export */ __webpack_exports__["default"] = ('00000000-0000-0000-0000-000000000000');

/***/ }),
/* 35 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(25);


function version(uuid) {
  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__["default"])(uuid)) {
    throw TypeError('Invalid UUID');
  }

  return parseInt(uuid.substr(14, 1), 16);
}

/* harmony default export */ __webpack_exports__["default"] = (version);

/***/ }),
/* 36 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Constants", function() { return Constants; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
var Constants = {
    /**
     * The core-http version
     * @const
     * @type {string}
     */
    coreHttpVersion: "1.2.1",
    /**
     * Specifies HTTP.
     *
     * @const
     * @type {string}
     */
    HTTP: "http:",
    /**
     * Specifies HTTPS.
     *
     * @const
     * @type {string}
     */
    HTTPS: "https:",
    /**
     * Specifies HTTP Proxy.
     *
     * @const
     * @type {string}
     */
    HTTP_PROXY: "HTTP_PROXY",
    /**
     * Specifies HTTPS Proxy.
     *
     * @const
     * @type {string}
     */
    HTTPS_PROXY: "HTTPS_PROXY",
    /**
     * Specifies NO Proxy.
     *
     * @const
     * @type {string}
     */
    NO_PROXY: "NO_PROXY",
    /**
     * Specifies ALL Proxy.
     *
     * @const
     * @type {string}
     */
    ALL_PROXY: "ALL_PROXY",
    HttpConstants: {
        /**
         * Http Verbs
         *
         * @const
         * @enum {string}
         */
        HttpVerbs: {
            PUT: "PUT",
            GET: "GET",
            DELETE: "DELETE",
            POST: "POST",
            MERGE: "MERGE",
            HEAD: "HEAD",
            PATCH: "PATCH"
        },
        StatusCodes: {
            TooManyRequests: 429
        }
    },
    /**
     * Defines constants for use with HTTP headers.
     */
    HeaderConstants: {
        /**
         * The Authorization header.
         *
         * @const
         * @type {string}
         */
        AUTHORIZATION: "authorization",
        AUTHORIZATION_SCHEME: "Bearer",
        /**
         * The Retry-After response-header field can be used with a 503 (Service
         * Unavailable) or 349 (Too Many Requests) responses to indicate how long
         * the service is expected to be unavailable to the requesting client.
         *
         * @const
         * @type {string}
         */
        RETRY_AFTER: "Retry-After",
        /**
         * The UserAgent header.
         *
         * @const
         * @type {string}
         */
        USER_AGENT: "User-Agent"
    }
};
//# sourceMappingURL=constants.js.map

/***/ }),
/* 37 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "XML_ATTRKEY", function() { return XML_ATTRKEY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "XML_CHARKEY", function() { return XML_CHARKEY; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * Default key used to access the XML attributes.
 */
var XML_ATTRKEY = "$";
/**
 * Default key used to access the XML value content.
 */
var XML_CHARKEY = "_";
//# sourceMappingURL=serializer.common.js.map

/***/ }),
/* 38 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _xhrHttpClient__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(39);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "DefaultHttpClient", function() { return _xhrHttpClient__WEBPACK_IMPORTED_MODULE_0__["XhrHttpClient"]; });

// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

//# sourceMappingURL=defaultHttpClient.browser.js.map

/***/ }),
/* 39 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "XhrHttpClient", function() { return XhrHttpClient; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "parseHeaders", function() { return parseHeaders; });
/* harmony import */ var _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(40);
/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(15);
/* harmony import */ var _restError__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(44);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



/**
 * A HttpClient implementation that uses XMLHttpRequest to send HTTP requests.
 */
var XhrHttpClient = /** @class */ (function () {
    function XhrHttpClient() {
    }
    XhrHttpClient.prototype.sendRequest = function (request) {
        var xhr = new XMLHttpRequest();
        if (request.proxySettings) {
            throw new Error("HTTP proxy is not supported in browser environment");
        }
        var abortSignal = request.abortSignal;
        if (abortSignal) {
            if (abortSignal.aborted) {
                return Promise.reject(new _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__["AbortError"]("The operation was aborted."));
            }
            var listener_1 = function () {
                xhr.abort();
            };
            abortSignal.addEventListener("abort", listener_1);
            xhr.addEventListener("readystatechange", function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    abortSignal.removeEventListener("abort", listener_1);
                }
            });
        }
        addProgressListener(xhr.upload, request.onUploadProgress);
        addProgressListener(xhr, request.onDownloadProgress);
        if (request.formData) {
            var formData = request.formData;
            var requestForm_1 = new FormData();
            var appendFormValue = function (key, value) {
                if (value &&
                    Object.prototype.hasOwnProperty.call(value, "value") &&
                    Object.prototype.hasOwnProperty.call(value, "options")) {
                    requestForm_1.append(key, value.value, value.options);
                }
                else {
                    requestForm_1.append(key, value);
                }
            };
            for (var _i = 0, _a = Object.keys(formData); _i < _a.length; _i++) {
                var formKey = _a[_i];
                var formValue = formData[formKey];
                if (Array.isArray(formValue)) {
                    for (var j = 0; j < formValue.length; j++) {
                        appendFormValue(formKey, formValue[j]);
                    }
                }
                else {
                    appendFormValue(formKey, formValue);
                }
            }
            request.body = requestForm_1;
            request.formData = undefined;
            var contentType = request.headers.get("Content-Type");
            if (contentType && contentType.indexOf("multipart/form-data") !== -1) {
                // browser will automatically apply a suitable content-type header
                request.headers.remove("Content-Type");
            }
        }
        xhr.open(request.method, request.url);
        xhr.timeout = request.timeout;
        xhr.withCredentials = request.withCredentials;
        for (var _b = 0, _c = request.headers.headersArray(); _b < _c.length; _b++) {
            var header = _c[_b];
            xhr.setRequestHeader(header.name, header.value);
        }
        xhr.responseType = request.streamResponseBody ? "blob" : "text";
        // tslint:disable-next-line:no-null-keyword
        xhr.send(request.body === undefined ? null : request.body);
        if (request.streamResponseBody) {
            return new Promise(function (resolve, reject) {
                xhr.addEventListener("readystatechange", function () {
                    // Resolve as soon as headers are loaded
                    if (xhr.readyState === XMLHttpRequest.HEADERS_RECEIVED) {
                        var blobBody = new Promise(function (resolve, reject) {
                            xhr.addEventListener("load", function () {
                                resolve(xhr.response);
                            });
                            rejectOnTerminalEvent(request, xhr, reject);
                        });
                        resolve({
                            request: request,
                            status: xhr.status,
                            headers: parseHeaders(xhr),
                            blobBody: blobBody
                        });
                    }
                });
                rejectOnTerminalEvent(request, xhr, reject);
            });
        }
        else {
            return new Promise(function (resolve, reject) {
                xhr.addEventListener("load", function () {
                    return resolve({
                        request: request,
                        status: xhr.status,
                        headers: parseHeaders(xhr),
                        bodyAsText: xhr.responseText
                    });
                });
                rejectOnTerminalEvent(request, xhr, reject);
            });
        }
    };
    return XhrHttpClient;
}());

function addProgressListener(xhr, listener) {
    if (listener) {
        xhr.addEventListener("progress", function (rawEvent) {
            return listener({
                loadedBytes: rawEvent.loaded
            });
        });
    }
}
// exported locally for testing
function parseHeaders(xhr) {
    var responseHeaders = new _httpHeaders__WEBPACK_IMPORTED_MODULE_1__["HttpHeaders"]();
    var headerLines = xhr
        .getAllResponseHeaders()
        .trim()
        .split(/[\r\n]+/);
    for (var _i = 0, headerLines_1 = headerLines; _i < headerLines_1.length; _i++) {
        var line = headerLines_1[_i];
        var index = line.indexOf(":");
        var headerName = line.slice(0, index);
        var headerValue = line.slice(index + 2);
        responseHeaders.set(headerName, headerValue);
    }
    return responseHeaders;
}
function rejectOnTerminalEvent(request, xhr, reject) {
    xhr.addEventListener("error", function () {
        return reject(new _restError__WEBPACK_IMPORTED_MODULE_2__["RestError"]("Failed to send request to " + request.url, _restError__WEBPACK_IMPORTED_MODULE_2__["RestError"].REQUEST_SEND_ERROR, undefined, request));
    });
    var abortError = new _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__["AbortError"]("The operation was aborted.");
    xhr.addEventListener("abort", function () { return reject(abortError); });
    xhr.addEventListener("timeout", function () { return reject(abortError); });
}
//# sourceMappingURL=xhrHttpClient.js.map

/***/ }),
/* 40 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _AbortController__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(41);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AbortController", function() { return _AbortController__WEBPACK_IMPORTED_MODULE_0__["AbortController"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AbortError", function() { return _AbortController__WEBPACK_IMPORTED_MODULE_0__["AbortError"]; });

/* harmony import */ var _AbortSignal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(43);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AbortSignal", function() { return _AbortSignal__WEBPACK_IMPORTED_MODULE_1__["AbortSignal"]; });

// Changes to Aborter
// * Rename Aborter to AbortSignal
// * Remove withValue and getValue - async context should be solved differently/wholistically, not tied to cancellation
// * Remove withTimeout, it's moved to the controller
// * AbortSignal constructor no longer takes a parent. Cancellation graphs are created from the controller.
// Potential changes to align with DOM Spec
// * dispatchEvent on Signal


//# sourceMappingURL=aborter.js.map

/***/ }),
/* 41 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AbortError", function() { return AbortError; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AbortController", function() { return AbortController; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(42);
/* harmony import */ var _AbortSignal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(43);


/**
 * This error is thrown when an asynchronous operation has been aborted.
 * Check for this error by testing the `name` that the name property of the
 * error matches `"AbortError"`.
 *
 * @example
 * const controller = new AbortController();
 * controller.abort();
 * try {
 *   doAsyncWork(controller.signal)
 * } catch (e) {
 *   if (e.name === 'AbortError') {
 *     // handle abort error here.
 *   }
 * }
 */
var AbortError = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(AbortError, _super);
    function AbortError(message) {
        var _this = _super.call(this, message) || this;
        _this.name = "AbortError";
        return _this;
    }
    return AbortError;
}(Error));

/**
 * An AbortController provides an AbortSignal and the associated controls to signal
 * that an asynchronous operation should be aborted.
 *
 * @example
 * // Abort an operation when another event fires
 * const controller = new AbortController();
 * const signal = controller.signal;
 * doAsyncWork(signal);
 * button.addEventListener('click', () => controller.abort());
 *
 * @example
 * // Share aborter cross multiple operations in 30s
 * // Upload the same data to 2 different data centers at the same time,
 * // abort another when any of them is finished
 * const controller = AbortController.withTimeout(30 * 1000);
 * doAsyncWork(controller.signal).then(controller.abort);
 * doAsyncWork(controller.signal).then(controller.abort);
 *
 * @example
 * // Cascaded aborting
 * // All operations can't take more than 30 seconds
 * const aborter = Aborter.timeout(30 * 1000);
 *
 * // Following 2 operations can't take more than 25 seconds
 * await doAsyncWork(aborter.withTimeout(25 * 1000));
 * await doAsyncWork(aborter.withTimeout(25 * 1000));
 *
 * @export
 * @class AbortController
 * @implements {AbortSignalLike}
 */
var AbortController = /** @class */ (function () {
    function AbortController(parentSignals) {
        var _this = this;
        this._signal = new _AbortSignal__WEBPACK_IMPORTED_MODULE_1__["AbortSignal"]();
        if (!parentSignals) {
            return;
        }
        // coerce parentSignals into an array
        if (!Array.isArray(parentSignals)) {
            parentSignals = arguments;
        }
        for (var _i = 0, parentSignals_1 = parentSignals; _i < parentSignals_1.length; _i++) {
            var parentSignal = parentSignals_1[_i];
            // if the parent signal has already had abort() called,
            // then call abort on this signal as well.
            if (parentSignal.aborted) {
                this.abort();
            }
            else {
                // when the parent signal aborts, this signal should as well.
                parentSignal.addEventListener("abort", function () {
                    _this.abort();
                });
            }
        }
    }
    Object.defineProperty(AbortController.prototype, "signal", {
        /**
         * The AbortSignal associated with this controller that will signal aborted
         * when the abort method is called on this controller.
         *
         * @readonly
         * @type {AbortSignal}
         * @memberof AbortController
         */
        get: function () {
            return this._signal;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Signal that any operations passed this controller's associated abort signal
     * to cancel any remaining work and throw an `AbortError`.
     *
     * @memberof AbortController
     */
    AbortController.prototype.abort = function () {
        Object(_AbortSignal__WEBPACK_IMPORTED_MODULE_1__["abortSignal"])(this._signal);
    };
    /**
     * Creates a new AbortSignal instance that will abort after the provided ms.
     *
     * @static
     * @params {number} ms Elapsed time in milliseconds to trigger an abort.
     * @returns {AbortSignal}
     */
    AbortController.timeout = function (ms) {
        var signal = new _AbortSignal__WEBPACK_IMPORTED_MODULE_1__["AbortSignal"]();
        var timer = setTimeout(_AbortSignal__WEBPACK_IMPORTED_MODULE_1__["abortSignal"], ms, signal);
        // Prevent the active Timer from keeping the Node.js event loop active.
        if (typeof timer.unref === "function") {
            timer.unref();
        }
        return signal;
    };
    return AbortController;
}());

//# sourceMappingURL=AbortController.js.map

/***/ }),
/* 42 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__extends", function() { return __extends; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__assign", function() { return __assign; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__rest", function() { return __rest; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__decorate", function() { return __decorate; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__param", function() { return __param; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__metadata", function() { return __metadata; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__awaiter", function() { return __awaiter; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__generator", function() { return __generator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__createBinding", function() { return __createBinding; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__exportStar", function() { return __exportStar; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__values", function() { return __values; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__read", function() { return __read; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spread", function() { return __spread; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spreadArrays", function() { return __spreadArrays; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__await", function() { return __await; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncGenerator", function() { return __asyncGenerator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncDelegator", function() { return __asyncDelegator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncValues", function() { return __asyncValues; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__makeTemplateObject", function() { return __makeTemplateObject; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__importStar", function() { return __importStar; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__importDefault", function() { return __importDefault; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__classPrivateFieldGet", function() { return __classPrivateFieldGet; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__classPrivateFieldSet", function() { return __classPrivateFieldSet; });
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    }
    return __assign.apply(this, arguments);
}

function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __param(paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

function __createBinding(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}

function __exportStar(m, exports) {
    for (var p in m) if (p !== "default" && !exports.hasOwnProperty(p)) exports[p] = m[p];
}

function __values(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

function __spread() {
    for (var ar = [], i = 0; i < arguments.length; i++)
        ar = ar.concat(__read(arguments[i]));
    return ar;
}

function __spreadArrays() {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};

function __await(v) {
    return this instanceof __await ? (this.v = v, this) : new __await(v);
}

function __asyncGenerator(thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
}

function __asyncDelegator(o) {
    var i, p;
    return i = {}, verb("next"), verb("throw", function (e) { throw e; }), verb("return"), i[Symbol.iterator] = function () { return this; }, i;
    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }
}

function __asyncValues(o) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }
}

function __makeTemplateObject(cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};

function __importStar(mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result.default = mod;
    return result;
}

function __importDefault(mod) {
    return (mod && mod.__esModule) ? mod : { default: mod };
}

function __classPrivateFieldGet(receiver, privateMap) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to get private field on non-instance");
    }
    return privateMap.get(receiver);
}

function __classPrivateFieldSet(receiver, privateMap, value) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to set private field on non-instance");
    }
    privateMap.set(receiver, value);
    return value;
}


/***/ }),
/* 43 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AbortSignal", function() { return AbortSignal; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "abortSignal", function() { return abortSignal; });
var listenersMap = new WeakMap();
var abortedMap = new WeakMap();
/**
 * An aborter instance implements AbortSignal interface, can abort HTTP requests.
 *
 * - Call AbortSignal.none to create a new AbortSignal instance that cannot be cancelled.
 * Use `AbortSignal.none` when you are required to pass a cancellation token but the operation
 * cannot or will not ever be cancelled.
 *
 * @example
 * // Abort without timeout
 * await doAsyncWork(AbortSignal.none);
 *
 * @export
 * @class AbortSignal
 * @implements {AbortSignalLike}
 */
var AbortSignal = /** @class */ (function () {
    function AbortSignal() {
        /**
         * onabort event listener.
         *
         * @memberof AbortSignal
         */
        this.onabort = null;
        listenersMap.set(this, []);
        abortedMap.set(this, false);
    }
    Object.defineProperty(AbortSignal.prototype, "aborted", {
        /**
         * Status of whether aborted or not.
         *
         * @readonly
         * @type {boolean}
         * @memberof AbortSignal
         */
        get: function () {
            if (!abortedMap.has(this)) {
                throw new TypeError("Expected `this` to be an instance of AbortSignal.");
            }
            return abortedMap.get(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AbortSignal, "none", {
        /**
         * Creates a new AbortSignal instance that will never be aborted.
         *
         * @readonly
         * @static
         * @type {AbortSignal}
         * @memberof AbortSignal
         */
        get: function () {
            return new AbortSignal();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Added new "abort" event listener, only support "abort" event.
     *
     * @param {"abort"} _type Only support "abort" event
     * @param {(this: AbortSignalLike, ev: any) => any} listener
     * @memberof AbortSignal
     */
    AbortSignal.prototype.addEventListener = function (
    // tslint:disable-next-line:variable-name
    _type, listener) {
        if (!listenersMap.has(this)) {
            throw new TypeError("Expected `this` to be an instance of AbortSignal.");
        }
        var listeners = listenersMap.get(this);
        listeners.push(listener);
    };
    /**
     * Remove "abort" event listener, only support "abort" event.
     *
     * @param {"abort"} _type Only support "abort" event
     * @param {(this: AbortSignalLike, ev: any) => any} listener
     * @memberof AbortSignal
     */
    AbortSignal.prototype.removeEventListener = function (
    // tslint:disable-next-line:variable-name
    _type, listener) {
        if (!listenersMap.has(this)) {
            throw new TypeError("Expected `this` to be an instance of AbortSignal.");
        }
        var listeners = listenersMap.get(this);
        var index = listeners.indexOf(listener);
        if (index > -1) {
            listeners.splice(index, 1);
        }
    };
    /**
     * Dispatches a synthetic event to the AbortSignal.
     */
    AbortSignal.prototype.dispatchEvent = function (_event) {
        throw new Error("This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.");
    };
    return AbortSignal;
}());

/**
 * Helper to trigger an abort event immediately, the onabort and all abort event listeners will be triggered.
 * Will try to trigger abort event for all linked AbortSignal nodes.
 *
 * - If there is a timeout, the timer will be cancelled.
 * - If aborted is true, nothing will happen.
 *
 * @returns
 * @internal
 */
function abortSignal(signal) {
    if (signal.aborted) {
        return;
    }
    if (signal.onabort) {
        signal.onabort.call(signal);
    }
    var listeners = listenersMap.get(signal);
    if (listeners) {
        listeners.forEach(function (listener) {
            listener.call(signal, { type: "abort" });
        });
    }
    abortedMap.set(signal, true);
}
//# sourceMappingURL=AbortSignal.js.map

/***/ }),
/* 44 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RestError", function() { return RestError; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _util_inspect__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(45);
/* harmony import */ var _util_sanitizer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(46);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



var errorSanitizer = new _util_sanitizer__WEBPACK_IMPORTED_MODULE_2__["Sanitizer"]();
var RestError = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(RestError, _super);
    function RestError(message, code, statusCode, request, response) {
        var _this = _super.call(this, message) || this;
        _this.name = "RestError";
        _this.code = code;
        _this.statusCode = statusCode;
        _this.request = request;
        _this.response = response;
        Object.setPrototypeOf(_this, RestError.prototype);
        return _this;
    }
    /**
     * Logging method for util.inspect in Node
     */
    RestError.prototype[_util_inspect__WEBPACK_IMPORTED_MODULE_1__["custom"]] = function () {
        return "RestError: " + this.message + " \n " + errorSanitizer.sanitize(this);
    };
    RestError.REQUEST_SEND_ERROR = "REQUEST_SEND_ERROR";
    RestError.PARSE_ERROR = "PARSE_ERROR";
    return RestError;
}(Error));

//# sourceMappingURL=restError.js.map

/***/ }),
/* 45 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "custom", function() { return custom; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
var custom = {};
//# sourceMappingURL=inspect.browser.js.map

/***/ }),
/* 46 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Sanitizer", function() { return Sanitizer; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _url__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(47);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


var RedactedString = "REDACTED";
var defaultAllowedHeaderNames = [
    "x-ms-client-request-id",
    "x-ms-return-client-request-id",
    "x-ms-useragent",
    "x-ms-correlation-request-id",
    "x-ms-request-id",
    "client-request-id",
    "return-client-request-id",
    "traceparent",
    "Access-Control-Allow-Credentials",
    "Access-Control-Allow-Headers",
    "Access-Control-Allow-Methods",
    "Access-Control-Allow-Origin",
    "Access-Control-Expose-Headers",
    "Access-Control-Max-Age",
    "Access-Control-Request-Headers",
    "Access-Control-Request-Method",
    "Origin",
    "Accept",
    "Cache-Control",
    "Connection",
    "Content-Length",
    "Content-Type",
    "Date",
    "ETag",
    "Expires",
    "If-Match",
    "If-Modified-Since",
    "If-None-Match",
    "If-Unmodified-Since",
    "Last-Modified",
    "Pragma",
    "Request-Id",
    "Retry-After",
    "Server",
    "Transfer-Encoding",
    "User-Agent"
];
var defaultAllowedQueryParameters = ["api-version"];
var Sanitizer = /** @class */ (function () {
    function Sanitizer(_a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.allowedHeaderNames, allowedHeaderNames = _c === void 0 ? [] : _c, _d = _b.allowedQueryParameters, allowedQueryParameters = _d === void 0 ? [] : _d;
        allowedHeaderNames = Array.isArray(allowedHeaderNames)
            ? defaultAllowedHeaderNames.concat(allowedHeaderNames)
            : defaultAllowedHeaderNames;
        allowedQueryParameters = Array.isArray(allowedQueryParameters)
            ? defaultAllowedQueryParameters.concat(allowedQueryParameters)
            : defaultAllowedQueryParameters;
        this.allowedHeaderNames = new Set(allowedHeaderNames.map(function (n) { return n.toLowerCase(); }));
        this.allowedQueryParameters = new Set(allowedQueryParameters.map(function (p) { return p.toLowerCase(); }));
    }
    Sanitizer.prototype.sanitize = function (obj) {
        return JSON.stringify(obj, this.replacer.bind(this), 2);
    };
    Sanitizer.prototype.replacer = function (key, value) {
        // Ensure Errors include their interesting non-enumerable members
        if (value instanceof Error) {
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, value), { name: value.name, message: value.message });
        }
        if (key === "_headersMap") {
            return this.sanitizeHeaders(key, value);
        }
        else if (key === "url") {
            return this.sanitizeUrl(value);
        }
        else if (key === "query") {
            return this.sanitizeQuery(value);
        }
        else if (key === "body") {
            // Don't log the request body
            return undefined;
        }
        else if (key === "response") {
            // Don't log response again
            return undefined;
        }
        else if (key === "operationSpec") {
            // When using sendOperationRequest, the request carries a massive
            // field with the autorest spec. No need to log it.
            return undefined;
        }
        return value;
    };
    Sanitizer.prototype.sanitizeHeaders = function (_, value) {
        return this.sanitizeObject(value, this.allowedHeaderNames, function (v, k) { return v[k].value; });
    };
    Sanitizer.prototype.sanitizeQuery = function (value) {
        return this.sanitizeObject(value, this.allowedQueryParameters, function (v, k) { return v[k]; });
    };
    Sanitizer.prototype.sanitizeObject = function (value, allowedKeys, accessor) {
        if (typeof value !== "object" || value === null) {
            return value;
        }
        var sanitized = {};
        for (var _i = 0, _a = Object.keys(value); _i < _a.length; _i++) {
            var k = _a[_i];
            if (allowedKeys.has(k.toLowerCase())) {
                sanitized[k] = accessor(value, k);
            }
            else {
                sanitized[k] = RedactedString;
            }
        }
        return sanitized;
    };
    Sanitizer.prototype.sanitizeUrl = function (value) {
        if (typeof value !== "string" || value === null) {
            return value;
        }
        var urlBuilder = _url__WEBPACK_IMPORTED_MODULE_1__["URLBuilder"].parse(value);
        var queryString = urlBuilder.getQuery();
        if (!queryString) {
            return value;
        }
        var query = _url__WEBPACK_IMPORTED_MODULE_1__["URLQuery"].parse(queryString);
        for (var _i = 0, _a = query.keys(); _i < _a.length; _i++) {
            var k = _a[_i];
            if (!this.allowedQueryParameters.has(k.toLowerCase())) {
                query.set(k, RedactedString);
            }
        }
        urlBuilder.setQuery(query.toString());
        return urlBuilder.toString();
    };
    return Sanitizer;
}());

//# sourceMappingURL=sanitizer.js.map

/***/ }),
/* 47 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "URLQuery", function() { return URLQuery; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "URLBuilder", function() { return URLBuilder; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "URLToken", function() { return URLToken; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isAlphaNumericCharacter", function() { return isAlphaNumericCharacter; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "URLTokenizer", function() { return URLTokenizer; });
/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(19);
/* harmony import */ var _util_url__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(48);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "URL", function() { return _util_url__WEBPACK_IMPORTED_MODULE_1__["URL"]; });

// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


/**
 * A class that handles the query portion of a URLBuilder.
 */
var URLQuery = /** @class */ (function () {
    function URLQuery() {
        this._rawQuery = {};
    }
    /**
     * Get whether or not there any query parameters in this URLQuery.
     */
    URLQuery.prototype.any = function () {
        return Object.keys(this._rawQuery).length > 0;
    };
    /**
     * Get the keys of the query string.
     */
    URLQuery.prototype.keys = function () {
        return Object.keys(this._rawQuery);
    };
    /**
     * Set a query parameter with the provided name and value. If the parameterValue is undefined or
     * empty, then this will attempt to remove an existing query parameter with the provided
     * parameterName.
     */
    URLQuery.prototype.set = function (parameterName, parameterValue) {
        if (parameterName) {
            if (parameterValue !== undefined && parameterValue !== null) {
                var newValue = Array.isArray(parameterValue) ? parameterValue : parameterValue.toString();
                this._rawQuery[parameterName] = newValue;
            }
            else {
                delete this._rawQuery[parameterName];
            }
        }
    };
    /**
     * Get the value of the query parameter with the provided name. If no parameter exists with the
     * provided parameter name, then undefined will be returned.
     */
    URLQuery.prototype.get = function (parameterName) {
        return parameterName ? this._rawQuery[parameterName] : undefined;
    };
    /**
     * Get the string representation of this query. The return value will not start with a "?".
     */
    URLQuery.prototype.toString = function () {
        var result = "";
        for (var parameterName in this._rawQuery) {
            if (result) {
                result += "&";
            }
            var parameterValue = this._rawQuery[parameterName];
            if (Array.isArray(parameterValue)) {
                var parameterStrings = [];
                for (var _i = 0, parameterValue_1 = parameterValue; _i < parameterValue_1.length; _i++) {
                    var parameterValueElement = parameterValue_1[_i];
                    parameterStrings.push(parameterName + "=" + parameterValueElement);
                }
                result += parameterStrings.join("&");
            }
            else {
                result += parameterName + "=" + parameterValue;
            }
        }
        return result;
    };
    /**
     * Parse a URLQuery from the provided text.
     */
    URLQuery.parse = function (text) {
        var result = new URLQuery();
        if (text) {
            if (text.startsWith("?")) {
                text = text.substring(1);
            }
            var currentState = "ParameterName";
            var parameterName = "";
            var parameterValue = "";
            for (var i = 0; i < text.length; ++i) {
                var currentCharacter = text[i];
                switch (currentState) {
                    case "ParameterName":
                        switch (currentCharacter) {
                            case "=":
                                currentState = "ParameterValue";
                                break;
                            case "&":
                                parameterName = "";
                                parameterValue = "";
                                break;
                            default:
                                parameterName += currentCharacter;
                                break;
                        }
                        break;
                    case "ParameterValue":
                        switch (currentCharacter) {
                            case "&":
                                result.set(parameterName, parameterValue);
                                parameterName = "";
                                parameterValue = "";
                                currentState = "ParameterName";
                                break;
                            default:
                                parameterValue += currentCharacter;
                                break;
                        }
                        break;
                    default:
                        throw new Error("Unrecognized URLQuery parse state: " + currentState);
                }
            }
            if (currentState === "ParameterValue") {
                result.set(parameterName, parameterValue);
            }
        }
        return result;
    };
    return URLQuery;
}());

/**
 * A class that handles creating, modifying, and parsing URLs.
 */
var URLBuilder = /** @class */ (function () {
    function URLBuilder() {
    }
    /**
     * Set the scheme/protocol for this URL. If the provided scheme contains other parts of a URL
     * (such as a host, port, path, or query), those parts will be added to this URL as well.
     */
    URLBuilder.prototype.setScheme = function (scheme) {
        if (!scheme) {
            this._scheme = undefined;
        }
        else {
            this.set(scheme, "SCHEME");
        }
    };
    /**
     * Get the scheme that has been set in this URL.
     */
    URLBuilder.prototype.getScheme = function () {
        return this._scheme;
    };
    /**
     * Set the host for this URL. If the provided host contains other parts of a URL (such as a
     * port, path, or query), those parts will be added to this URL as well.
     */
    URLBuilder.prototype.setHost = function (host) {
        if (!host) {
            this._host = undefined;
        }
        else {
            this.set(host, "SCHEME_OR_HOST");
        }
    };
    /**
     * Get the host that has been set in this URL.
     */
    URLBuilder.prototype.getHost = function () {
        return this._host;
    };
    /**
     * Set the port for this URL. If the provided port contains other parts of a URL (such as a
     * path or query), those parts will be added to this URL as well.
     */
    URLBuilder.prototype.setPort = function (port) {
        if (port === undefined || port === null || port === "") {
            this._port = undefined;
        }
        else {
            this.set(port.toString(), "PORT");
        }
    };
    /**
     * Get the port that has been set in this URL.
     */
    URLBuilder.prototype.getPort = function () {
        return this._port;
    };
    /**
     * Set the path for this URL. If the provided path contains a query, then it will be added to
     * this URL as well.
     */
    URLBuilder.prototype.setPath = function (path) {
        if (!path) {
            this._path = undefined;
        }
        else {
            var schemeIndex = path.indexOf("://");
            if (schemeIndex !== -1) {
                var schemeStart = path.lastIndexOf("/", schemeIndex);
                // Make sure to only grab the URL part of the path before setting the state back to SCHEME
                // this will handle cases such as "/a/b/c/https://microsoft.com" => "https://microsoft.com"
                this.set(schemeStart === -1 ? path : path.substr(schemeStart + 1), "SCHEME");
            }
            else {
                this.set(path, "PATH");
            }
        }
    };
    /**
     * Append the provided path to this URL's existing path. If the provided path contains a query,
     * then it will be added to this URL as well.
     */
    URLBuilder.prototype.appendPath = function (path) {
        if (path) {
            var currentPath = this.getPath();
            if (currentPath) {
                if (!currentPath.endsWith("/")) {
                    currentPath += "/";
                }
                if (path.startsWith("/")) {
                    path = path.substring(1);
                }
                path = currentPath + path;
            }
            this.set(path, "PATH");
        }
    };
    /**
     * Get the path that has been set in this URL.
     */
    URLBuilder.prototype.getPath = function () {
        return this._path;
    };
    /**
     * Set the query in this URL.
     */
    URLBuilder.prototype.setQuery = function (query) {
        if (!query) {
            this._query = undefined;
        }
        else {
            this._query = URLQuery.parse(query);
        }
    };
    /**
     * Set a query parameter with the provided name and value in this URL's query. If the provided
     * query parameter value is undefined or empty, then the query parameter will be removed if it
     * existed.
     */
    URLBuilder.prototype.setQueryParameter = function (queryParameterName, queryParameterValue) {
        if (queryParameterName) {
            if (!this._query) {
                this._query = new URLQuery();
            }
            this._query.set(queryParameterName, queryParameterValue);
        }
    };
    /**
     * Get the value of the query parameter with the provided query parameter name. If no query
     * parameter exists with the provided name, then undefined will be returned.
     */
    URLBuilder.prototype.getQueryParameterValue = function (queryParameterName) {
        return this._query ? this._query.get(queryParameterName) : undefined;
    };
    /**
     * Get the query in this URL.
     */
    URLBuilder.prototype.getQuery = function () {
        return this._query ? this._query.toString() : undefined;
    };
    /**
     * Set the parts of this URL by parsing the provided text using the provided startState.
     */
    URLBuilder.prototype.set = function (text, startState) {
        var tokenizer = new URLTokenizer(text, startState);
        while (tokenizer.next()) {
            var token = tokenizer.current();
            var tokenPath = void 0;
            if (token) {
                switch (token.type) {
                    case "SCHEME":
                        this._scheme = token.text || undefined;
                        break;
                    case "HOST":
                        this._host = token.text || undefined;
                        break;
                    case "PORT":
                        this._port = token.text || undefined;
                        break;
                    case "PATH":
                        tokenPath = token.text || undefined;
                        if (!this._path || this._path === "/" || tokenPath !== "/") {
                            this._path = tokenPath;
                        }
                        break;
                    case "QUERY":
                        this._query = URLQuery.parse(token.text);
                        break;
                    default:
                        throw new Error("Unrecognized URLTokenType: " + token.type);
                }
            }
        }
    };
    URLBuilder.prototype.toString = function () {
        var result = "";
        if (this._scheme) {
            result += this._scheme + "://";
        }
        if (this._host) {
            result += this._host;
        }
        if (this._port) {
            result += ":" + this._port;
        }
        if (this._path) {
            if (!this._path.startsWith("/")) {
                result += "/";
            }
            result += this._path;
        }
        if (this._query && this._query.any()) {
            result += "?" + this._query.toString();
        }
        return result;
    };
    /**
     * If the provided searchValue is found in this URLBuilder, then replace it with the provided
     * replaceValue.
     */
    URLBuilder.prototype.replaceAll = function (searchValue, replaceValue) {
        if (searchValue) {
            this.setScheme(Object(_util_utils__WEBPACK_IMPORTED_MODULE_0__["replaceAll"])(this.getScheme(), searchValue, replaceValue));
            this.setHost(Object(_util_utils__WEBPACK_IMPORTED_MODULE_0__["replaceAll"])(this.getHost(), searchValue, replaceValue));
            this.setPort(Object(_util_utils__WEBPACK_IMPORTED_MODULE_0__["replaceAll"])(this.getPort(), searchValue, replaceValue));
            this.setPath(Object(_util_utils__WEBPACK_IMPORTED_MODULE_0__["replaceAll"])(this.getPath(), searchValue, replaceValue));
            this.setQuery(Object(_util_utils__WEBPACK_IMPORTED_MODULE_0__["replaceAll"])(this.getQuery(), searchValue, replaceValue));
        }
    };
    URLBuilder.parse = function (text) {
        var result = new URLBuilder();
        result.set(text, "SCHEME_OR_HOST");
        return result;
    };
    return URLBuilder;
}());

var URLToken = /** @class */ (function () {
    function URLToken(text, type) {
        this.text = text;
        this.type = type;
    }
    URLToken.scheme = function (text) {
        return new URLToken(text, "SCHEME");
    };
    URLToken.host = function (text) {
        return new URLToken(text, "HOST");
    };
    URLToken.port = function (text) {
        return new URLToken(text, "PORT");
    };
    URLToken.path = function (text) {
        return new URLToken(text, "PATH");
    };
    URLToken.query = function (text) {
        return new URLToken(text, "QUERY");
    };
    return URLToken;
}());

/**
 * Get whether or not the provided character (single character string) is an alphanumeric (letter or
 * digit) character.
 */
function isAlphaNumericCharacter(character) {
    var characterCode = character.charCodeAt(0);
    return ((48 /* '0' */ <= characterCode && characterCode <= 57) /* '9' */ ||
        (65 /* 'A' */ <= characterCode && characterCode <= 90) /* 'Z' */ ||
        (97 /* 'a' */ <= characterCode && characterCode <= 122) /* 'z' */);
}
/**
 * A class that tokenizes URL strings.
 */
var URLTokenizer = /** @class */ (function () {
    function URLTokenizer(_text, state) {
        this._text = _text;
        this._textLength = _text ? _text.length : 0;
        this._currentState = state !== undefined && state !== null ? state : "SCHEME_OR_HOST";
        this._currentIndex = 0;
    }
    /**
     * Get the current URLToken this URLTokenizer is pointing at, or undefined if the URLTokenizer
     * hasn't started or has finished tokenizing.
     */
    URLTokenizer.prototype.current = function () {
        return this._currentToken;
    };
    /**
     * Advance to the next URLToken and return whether or not a URLToken was found.
     */
    URLTokenizer.prototype.next = function () {
        if (!hasCurrentCharacter(this)) {
            this._currentToken = undefined;
        }
        else {
            switch (this._currentState) {
                case "SCHEME":
                    nextScheme(this);
                    break;
                case "SCHEME_OR_HOST":
                    nextSchemeOrHost(this);
                    break;
                case "HOST":
                    nextHost(this);
                    break;
                case "PORT":
                    nextPort(this);
                    break;
                case "PATH":
                    nextPath(this);
                    break;
                case "QUERY":
                    nextQuery(this);
                    break;
                default:
                    throw new Error("Unrecognized URLTokenizerState: " + this._currentState);
            }
        }
        return !!this._currentToken;
    };
    return URLTokenizer;
}());

/**
 * Read the remaining characters from this Tokenizer's character stream.
 */
function readRemaining(tokenizer) {
    var result = "";
    if (tokenizer._currentIndex < tokenizer._textLength) {
        result = tokenizer._text.substring(tokenizer._currentIndex);
        tokenizer._currentIndex = tokenizer._textLength;
    }
    return result;
}
/**
 * Whether or not this URLTokenizer has a current character.
 */
function hasCurrentCharacter(tokenizer) {
    return tokenizer._currentIndex < tokenizer._textLength;
}
/**
 * Get the character in the text string at the current index.
 */
function getCurrentCharacter(tokenizer) {
    return tokenizer._text[tokenizer._currentIndex];
}
/**
 * Advance to the character in text that is "step" characters ahead. If no step value is provided,
 * then step will default to 1.
 */
function nextCharacter(tokenizer, step) {
    if (hasCurrentCharacter(tokenizer)) {
        if (!step) {
            step = 1;
        }
        tokenizer._currentIndex += step;
    }
}
/**
 * Starting with the current character, peek "charactersToPeek" number of characters ahead in this
 * Tokenizer's stream of characters.
 */
function peekCharacters(tokenizer, charactersToPeek) {
    var endIndex = tokenizer._currentIndex + charactersToPeek;
    if (tokenizer._textLength < endIndex) {
        endIndex = tokenizer._textLength;
    }
    return tokenizer._text.substring(tokenizer._currentIndex, endIndex);
}
/**
 * Read characters from this Tokenizer until the end of the stream or until the provided condition
 * is false when provided the current character.
 */
function readWhile(tokenizer, condition) {
    var result = "";
    while (hasCurrentCharacter(tokenizer)) {
        var currentCharacter = getCurrentCharacter(tokenizer);
        if (!condition(currentCharacter)) {
            break;
        }
        else {
            result += currentCharacter;
            nextCharacter(tokenizer);
        }
    }
    return result;
}
/**
 * Read characters from this Tokenizer until a non-alphanumeric character or the end of the
 * character stream is reached.
 */
function readWhileLetterOrDigit(tokenizer) {
    return readWhile(tokenizer, function (character) { return isAlphaNumericCharacter(character); });
}
/**
 * Read characters from this Tokenizer until one of the provided terminating characters is read or
 * the end of the character stream is reached.
 */
function readUntilCharacter(tokenizer) {
    var terminatingCharacters = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        terminatingCharacters[_i - 1] = arguments[_i];
    }
    return readWhile(tokenizer, function (character) { return terminatingCharacters.indexOf(character) === -1; });
}
function nextScheme(tokenizer) {
    var scheme = readWhileLetterOrDigit(tokenizer);
    tokenizer._currentToken = URLToken.scheme(scheme);
    if (!hasCurrentCharacter(tokenizer)) {
        tokenizer._currentState = "DONE";
    }
    else {
        tokenizer._currentState = "HOST";
    }
}
function nextSchemeOrHost(tokenizer) {
    var schemeOrHost = readUntilCharacter(tokenizer, ":", "/", "?");
    if (!hasCurrentCharacter(tokenizer)) {
        tokenizer._currentToken = URLToken.host(schemeOrHost);
        tokenizer._currentState = "DONE";
    }
    else if (getCurrentCharacter(tokenizer) === ":") {
        if (peekCharacters(tokenizer, 3) === "://") {
            tokenizer._currentToken = URLToken.scheme(schemeOrHost);
            tokenizer._currentState = "HOST";
        }
        else {
            tokenizer._currentToken = URLToken.host(schemeOrHost);
            tokenizer._currentState = "PORT";
        }
    }
    else {
        tokenizer._currentToken = URLToken.host(schemeOrHost);
        if (getCurrentCharacter(tokenizer) === "/") {
            tokenizer._currentState = "PATH";
        }
        else {
            tokenizer._currentState = "QUERY";
        }
    }
}
function nextHost(tokenizer) {
    if (peekCharacters(tokenizer, 3) === "://") {
        nextCharacter(tokenizer, 3);
    }
    var host = readUntilCharacter(tokenizer, ":", "/", "?");
    tokenizer._currentToken = URLToken.host(host);
    if (!hasCurrentCharacter(tokenizer)) {
        tokenizer._currentState = "DONE";
    }
    else if (getCurrentCharacter(tokenizer) === ":") {
        tokenizer._currentState = "PORT";
    }
    else if (getCurrentCharacter(tokenizer) === "/") {
        tokenizer._currentState = "PATH";
    }
    else {
        tokenizer._currentState = "QUERY";
    }
}
function nextPort(tokenizer) {
    if (getCurrentCharacter(tokenizer) === ":") {
        nextCharacter(tokenizer);
    }
    var port = readUntilCharacter(tokenizer, "/", "?");
    tokenizer._currentToken = URLToken.port(port);
    if (!hasCurrentCharacter(tokenizer)) {
        tokenizer._currentState = "DONE";
    }
    else if (getCurrentCharacter(tokenizer) === "/") {
        tokenizer._currentState = "PATH";
    }
    else {
        tokenizer._currentState = "QUERY";
    }
}
function nextPath(tokenizer) {
    var path = readUntilCharacter(tokenizer, "?");
    tokenizer._currentToken = URLToken.path(path);
    if (!hasCurrentCharacter(tokenizer)) {
        tokenizer._currentState = "DONE";
    }
    else {
        tokenizer._currentState = "QUERY";
    }
}
function nextQuery(tokenizer) {
    if (getCurrentCharacter(tokenizer) === "?") {
        nextCharacter(tokenizer);
    }
    var query = readRemaining(tokenizer);
    tokenizer._currentToken = URLToken.query(query);
    tokenizer._currentState = "DONE";
}
//# sourceMappingURL=url.js.map

/***/ }),
/* 48 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "URL", function() { return url; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
var url = URL;

//# sourceMappingURL=url.browser.js.map

/***/ }),
/* 49 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HttpPipelineLogLevel", function() { return HttpPipelineLogLevel; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * The different levels of logs that can be used with the HttpPipelineLogger.
 */
var HttpPipelineLogLevel;
(function (HttpPipelineLogLevel) {
    /**
     * A log level that indicates that no logs will be logged.
     */
    HttpPipelineLogLevel[HttpPipelineLogLevel["OFF"] = 0] = "OFF";
    /**
     * An error log.
     */
    HttpPipelineLogLevel[HttpPipelineLogLevel["ERROR"] = 1] = "ERROR";
    /**
     * A warning log.
     */
    HttpPipelineLogLevel[HttpPipelineLogLevel["WARNING"] = 2] = "WARNING";
    /**
     * An information log.
     */
    HttpPipelineLogLevel[HttpPipelineLogLevel["INFO"] = 3] = "INFO";
})(HttpPipelineLogLevel || (HttpPipelineLogLevel = {}));
//# sourceMappingURL=httpPipelineLogLevel.js.map

/***/ }),
/* 50 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "operationOptionsToRequestOptionsBase", function() { return operationOptionsToRequestOptionsBase; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);

/**
 * Converts an OperationOptions to a RequestOptionsBase
 *
 * @param opts OperationOptions object to convert to RequestOptionsBase
 */
function operationOptionsToRequestOptionsBase(opts) {
    var requestOptions = opts.requestOptions, tracingOptions = opts.tracingOptions, additionalOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__rest"])(opts, ["requestOptions", "tracingOptions"]);
    var result = additionalOptions;
    if (requestOptions) {
        result = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, result), requestOptions);
    }
    if (tracingOptions) {
        result.spanOptions = tracingOptions.spanOptions;
    }
    return result;
}
//# sourceMappingURL=operationOptions.js.map

/***/ }),
/* 51 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ServiceClient", function() { return ServiceClient; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "serializeRequestBody", function() { return serializeRequestBody; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createPipelineFromOptions", function() { return createPipelineFromOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getPropertyParent", function() { return getPropertyParent; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getOperationArgumentValueFromParameterPath", function() { return getOperationArgumentValueFromParameterPath; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "flattenResponse", function() { return flattenResponse; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _azure_core_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(52);
/* harmony import */ var _defaultHttpClient__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(38);
/* harmony import */ var _policies_logPolicy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(55);
/* harmony import */ var _operationParameter__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(61);
/* harmony import */ var _operationSpec__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(62);
/* harmony import */ var _policies_deserializationPolicy__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(63);
/* harmony import */ var _policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(65);
/* harmony import */ var _policies_generateClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(67);
/* harmony import */ var _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(68);
/* harmony import */ var _policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(70);
/* harmony import */ var _policies_requestPolicy__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(56);
/* harmony import */ var _policies_rpRegistrationPolicy__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(71);
/* harmony import */ var _policies_bearerTokenAuthenticationPolicy__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(72);
/* harmony import */ var _policies_systemErrorRetryPolicy__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(75);
/* harmony import */ var _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(76);
/* harmony import */ var _serializer__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(16);
/* harmony import */ var _url__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(47);
/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(19);
/* harmony import */ var _util_xml__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(64);
/* harmony import */ var _webResource__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(14);
/* harmony import */ var _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(77);
/* harmony import */ var _policies_throttlingRetryPolicy__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(78);
/* harmony import */ var _policies_signingPolicy__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(79);
/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(57);
/* harmony import */ var _policies_keepAlivePolicy__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(80);
/* harmony import */ var _policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(81);
/* harmony import */ var _policies_disableResponseDecompressionPolicy__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(143);
/* harmony import */ var _policies_ndJsonPolicy__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(144);
/* harmony import */ var _util_serializer_common__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(37);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
































/**
 * @class
 * Initializes a new instance of the ServiceClient.
 */
var ServiceClient = /** @class */ (function () {
    /**
     * The ServiceClient constructor
     * @constructor
     * @param credentials The credentials used for authentication with the service.
     * @param options The service client options that govern the behavior of the client.
     */
    function ServiceClient(credentials, 
    /* eslint-disable-next-line @azure/azure-sdk/ts-naming-options */
    options) {
        var _this = this;
        if (!options) {
            options = {};
        }
        this._withCredentials = options.withCredentials || false;
        this._httpClient = options.httpClient || new _defaultHttpClient__WEBPACK_IMPORTED_MODULE_2__["DefaultHttpClient"]();
        this._requestPolicyOptions = new _policies_requestPolicy__WEBPACK_IMPORTED_MODULE_11__["RequestPolicyOptions"](options.httpPipelineLogger);
        var requestPolicyFactories;
        if (Array.isArray(options.requestPolicyFactories)) {
            _log__WEBPACK_IMPORTED_MODULE_24__["logger"].info("ServiceClient: using custom request policies");
            requestPolicyFactories = options.requestPolicyFactories;
        }
        else {
            var authPolicyFactory = undefined;
            if (Object(_azure_core_auth__WEBPACK_IMPORTED_MODULE_1__["isTokenCredential"])(credentials)) {
                _log__WEBPACK_IMPORTED_MODULE_24__["logger"].info("ServiceClient: creating bearer token authentication policy from provided credentials");
                // Create a wrapped RequestPolicyFactory here so that we can provide the
                // correct scope to the BearerTokenAuthenticationPolicy at the first time
                // one is requested.  This is needed because generated ServiceClient
                // implementations do not set baseUri until after ServiceClient's constructor
                // is finished, leaving baseUri empty at the time when it is needed to
                // build the correct scope name.
                var wrappedPolicyFactory = function () {
                    var bearerTokenPolicyFactory = undefined;
                    // eslint-disable-next-line @typescript-eslint/no-this-alias
                    var serviceClient = _this;
                    var serviceClientOptions = options;
                    return {
                        create: function (nextPolicy, options) {
                            var credentialScopes = getCredentialScopes(serviceClientOptions, serviceClient.baseUri);
                            if (!credentialScopes) {
                                throw new Error("When using credential, the ServiceClient must contain a baseUri or a credentialScopes in ServiceClientOptions. Unable to create a bearerTokenAuthenticationPolicy");
                            }
                            if (bearerTokenPolicyFactory === undefined || bearerTokenPolicyFactory === null) {
                                bearerTokenPolicyFactory = Object(_policies_bearerTokenAuthenticationPolicy__WEBPACK_IMPORTED_MODULE_13__["bearerTokenAuthenticationPolicy"])(credentials, credentialScopes);
                            }
                            return bearerTokenPolicyFactory.create(nextPolicy, options);
                        }
                    };
                };
                authPolicyFactory = wrappedPolicyFactory();
            }
            else if (credentials && typeof credentials.signRequest === "function") {
                _log__WEBPACK_IMPORTED_MODULE_24__["logger"].info("ServiceClient: creating signing policy from provided credentials");
                authPolicyFactory = Object(_policies_signingPolicy__WEBPACK_IMPORTED_MODULE_23__["signingPolicy"])(credentials);
            }
            else if (credentials !== undefined && credentials !== null) {
                throw new Error("The credentials argument must implement the TokenCredential interface");
            }
            _log__WEBPACK_IMPORTED_MODULE_24__["logger"].info("ServiceClient: using default request policies");
            requestPolicyFactories = createDefaultRequestPolicyFactories(authPolicyFactory, options);
            if (options.requestPolicyFactories) {
                // options.requestPolicyFactories can also be a function that manipulates
                // the default requestPolicyFactories array
                var newRequestPolicyFactories = options.requestPolicyFactories(requestPolicyFactories);
                if (newRequestPolicyFactories) {
                    requestPolicyFactories = newRequestPolicyFactories;
                }
            }
        }
        this._requestPolicyFactories = requestPolicyFactories;
    }
    /**
     * Send the provided httpRequest.
     */
    ServiceClient.prototype.sendRequest = function (options) {
        if (options === null || options === undefined || typeof options !== "object") {
            throw new Error("options cannot be null or undefined and it must be of type object.");
        }
        var httpRequest;
        try {
            if (Object(_webResource__WEBPACK_IMPORTED_MODULE_20__["isWebResourceLike"])(options)) {
                options.validateRequestProperties();
                httpRequest = options;
            }
            else {
                httpRequest = new _webResource__WEBPACK_IMPORTED_MODULE_20__["WebResource"]();
                httpRequest = httpRequest.prepare(options);
            }
        }
        catch (error) {
            return Promise.reject(error);
        }
        var httpPipeline = this._httpClient;
        if (this._requestPolicyFactories && this._requestPolicyFactories.length > 0) {
            for (var i = this._requestPolicyFactories.length - 1; i >= 0; --i) {
                httpPipeline = this._requestPolicyFactories[i].create(httpPipeline, this._requestPolicyOptions);
            }
        }
        return httpPipeline.sendRequest(httpRequest);
    };
    /**
     * Send an HTTP request that is populated using the provided OperationSpec.
     * @param {OperationArguments} operationArguments The arguments that the HTTP request's templated values will be populated from.
     * @param {OperationSpec} operationSpec The OperationSpec to use to populate the httpRequest.
     * @param {ServiceCallback} callback The callback to call when the response is received.
     */
    ServiceClient.prototype.sendOperationRequest = function (operationArguments, operationSpec, callback) {
        var _a;
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var serializerOptions, httpRequest, result, baseUri, requestUrl, _i, _b, urlParameter, urlParameterValue, _c, _d, queryParameter, queryParameterValue, index, item, index, contentType, _e, _f, headerParameter, headerValue, headerCollectionPrefix, _g, _h, key, options, customHeaderName, rawResponse, sendRequestError, error_1, error_2, cb;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_j) {
                switch (_j.label) {
                    case 0:
                        if (typeof operationArguments.options === "function") {
                            callback = operationArguments.options;
                            operationArguments.options = undefined;
                        }
                        serializerOptions = (_a = operationArguments.options) === null || _a === void 0 ? void 0 : _a.serializerOptions;
                        httpRequest = new _webResource__WEBPACK_IMPORTED_MODULE_20__["WebResource"]();
                        _j.label = 1;
                    case 1:
                        _j.trys.push([1, 6, , 7]);
                        baseUri = operationSpec.baseUrl || this.baseUri;
                        if (!baseUri) {
                            throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a baseUri string property that contains the base URL to use.");
                        }
                        httpRequest.method = operationSpec.httpMethod;
                        httpRequest.operationSpec = operationSpec;
                        requestUrl = _url__WEBPACK_IMPORTED_MODULE_17__["URLBuilder"].parse(baseUri);
                        if (operationSpec.path) {
                            requestUrl.appendPath(operationSpec.path);
                        }
                        if (operationSpec.urlParameters && operationSpec.urlParameters.length > 0) {
                            for (_i = 0, _b = operationSpec.urlParameters; _i < _b.length; _i++) {
                                urlParameter = _b[_i];
                                urlParameterValue = getOperationArgumentValueFromParameter(this, operationArguments, urlParameter, operationSpec.serializer);
                                urlParameterValue = operationSpec.serializer.serialize(urlParameter.mapper, urlParameterValue, Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(urlParameter), serializerOptions);
                                if (!urlParameter.skipEncoding) {
                                    urlParameterValue = encodeURIComponent(urlParameterValue);
                                }
                                requestUrl.replaceAll("{" + (urlParameter.mapper.serializedName || Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(urlParameter)) + "}", urlParameterValue);
                            }
                        }
                        if (operationSpec.queryParameters && operationSpec.queryParameters.length > 0) {
                            for (_c = 0, _d = operationSpec.queryParameters; _c < _d.length; _c++) {
                                queryParameter = _d[_c];
                                queryParameterValue = getOperationArgumentValueFromParameter(this, operationArguments, queryParameter, operationSpec.serializer);
                                if (queryParameterValue !== undefined && queryParameterValue !== null) {
                                    queryParameterValue = operationSpec.serializer.serialize(queryParameter.mapper, queryParameterValue, Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(queryParameter), serializerOptions);
                                    if (queryParameter.collectionFormat !== undefined &&
                                        queryParameter.collectionFormat !== null) {
                                        if (queryParameter.collectionFormat === _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_15__["QueryCollectionFormat"].Multi) {
                                            if (queryParameterValue.length === 0) {
                                                // The collection is empty, no need to try serializing the current queryParam
                                                continue;
                                            }
                                            else {
                                                for (index in queryParameterValue) {
                                                    item = queryParameterValue[index];
                                                    queryParameterValue[index] =
                                                        item === undefined || item === null ? "" : item.toString();
                                                }
                                            }
                                        }
                                        else if (queryParameter.collectionFormat === _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_15__["QueryCollectionFormat"].Ssv ||
                                            queryParameter.collectionFormat === _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_15__["QueryCollectionFormat"].Tsv) {
                                            queryParameterValue = queryParameterValue.join(queryParameter.collectionFormat);
                                        }
                                    }
                                    if (!queryParameter.skipEncoding) {
                                        if (Array.isArray(queryParameterValue)) {
                                            for (index in queryParameterValue) {
                                                if (queryParameterValue[index] !== undefined &&
                                                    queryParameterValue[index] !== null) {
                                                    queryParameterValue[index] = encodeURIComponent(queryParameterValue[index]);
                                                }
                                            }
                                        }
                                        else {
                                            queryParameterValue = encodeURIComponent(queryParameterValue);
                                        }
                                    }
                                    if (queryParameter.collectionFormat !== undefined &&
                                        queryParameter.collectionFormat !== null &&
                                        queryParameter.collectionFormat !== _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_15__["QueryCollectionFormat"].Multi &&
                                        queryParameter.collectionFormat !== _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_15__["QueryCollectionFormat"].Ssv &&
                                        queryParameter.collectionFormat !== _queryCollectionFormat__WEBPACK_IMPORTED_MODULE_15__["QueryCollectionFormat"].Tsv) {
                                        queryParameterValue = queryParameterValue.join(queryParameter.collectionFormat);
                                    }
                                    requestUrl.setQueryParameter(queryParameter.mapper.serializedName || Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(queryParameter), queryParameterValue);
                                }
                            }
                        }
                        httpRequest.url = requestUrl.toString();
                        contentType = operationSpec.contentType || this.requestContentType;
                        if (contentType) {
                            httpRequest.headers.set("Content-Type", contentType);
                        }
                        if (operationSpec.headerParameters) {
                            for (_e = 0, _f = operationSpec.headerParameters; _e < _f.length; _e++) {
                                headerParameter = _f[_e];
                                headerValue = getOperationArgumentValueFromParameter(this, operationArguments, headerParameter, operationSpec.serializer);
                                if (headerValue !== undefined && headerValue !== null) {
                                    headerValue = operationSpec.serializer.serialize(headerParameter.mapper, headerValue, Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(headerParameter), serializerOptions);
                                    headerCollectionPrefix = headerParameter.mapper
                                        .headerCollectionPrefix;
                                    if (headerCollectionPrefix) {
                                        for (_g = 0, _h = Object.keys(headerValue); _g < _h.length; _g++) {
                                            key = _h[_g];
                                            httpRequest.headers.set(headerCollectionPrefix + key, headerValue[key]);
                                        }
                                    }
                                    else {
                                        httpRequest.headers.set(headerParameter.mapper.serializedName ||
                                            Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(headerParameter), headerValue);
                                    }
                                }
                            }
                        }
                        options = operationArguments.options;
                        if (options) {
                            if (options.customHeaders) {
                                for (customHeaderName in options.customHeaders) {
                                    httpRequest.headers.set(customHeaderName, options.customHeaders[customHeaderName]);
                                }
                            }
                            if (options.abortSignal) {
                                httpRequest.abortSignal = options.abortSignal;
                            }
                            if (options.timeout) {
                                httpRequest.timeout = options.timeout;
                            }
                            if (options.onUploadProgress) {
                                httpRequest.onUploadProgress = options.onUploadProgress;
                            }
                            if (options.onDownloadProgress) {
                                httpRequest.onDownloadProgress = options.onDownloadProgress;
                            }
                            if (options.spanOptions) {
                                httpRequest.spanOptions = options.spanOptions;
                            }
                            if (options.shouldDeserialize !== undefined && options.shouldDeserialize !== null) {
                                httpRequest.shouldDeserialize = options.shouldDeserialize;
                            }
                        }
                        httpRequest.withCredentials = this._withCredentials;
                        serializeRequestBody(this, httpRequest, operationArguments, operationSpec);
                        if (httpRequest.streamResponseBody === undefined || httpRequest.streamResponseBody === null) {
                            httpRequest.streamResponseBody = Object(_operationSpec__WEBPACK_IMPORTED_MODULE_5__["isStreamOperation"])(operationSpec);
                        }
                        rawResponse = void 0;
                        sendRequestError = void 0;
                        _j.label = 2;
                    case 2:
                        _j.trys.push([2, 4, , 5]);
                        return [4 /*yield*/, this.sendRequest(httpRequest)];
                    case 3:
                        rawResponse = _j.sent();
                        return [3 /*break*/, 5];
                    case 4:
                        error_1 = _j.sent();
                        sendRequestError = error_1;
                        return [3 /*break*/, 5];
                    case 5:
                        if (sendRequestError) {
                            if (sendRequestError.response) {
                                sendRequestError.details = flattenResponse(sendRequestError.response, operationSpec.responses[sendRequestError.statusCode] ||
                                    operationSpec.responses["default"]);
                            }
                            result = Promise.reject(sendRequestError);
                        }
                        else {
                            result = Promise.resolve(flattenResponse(rawResponse, operationSpec.responses[rawResponse.status]));
                        }
                        return [3 /*break*/, 7];
                    case 6:
                        error_2 = _j.sent();
                        result = Promise.reject(error_2);
                        return [3 /*break*/, 7];
                    case 7:
                        cb = callback;
                        if (cb) {
                            result
                                // tslint:disable-next-line:no-null-keyword
                                .then(function (res) { return cb(null, res._response.parsedBody, res._response.request, res._response); })
                                .catch(function (err) { return cb(err); });
                        }
                        return [2 /*return*/, result];
                }
            });
        });
    };
    return ServiceClient;
}());

function serializeRequestBody(serviceClient, httpRequest, operationArguments, operationSpec) {
    var _a, _b, _c, _d, _e, _f;
    var serializerOptions = (_b = (_a = operationArguments.options) === null || _a === void 0 ? void 0 : _a.serializerOptions) !== null && _b !== void 0 ? _b : {};
    var updatedOptions = {
        rootName: (_c = serializerOptions.rootName) !== null && _c !== void 0 ? _c : "",
        includeRoot: (_d = serializerOptions.includeRoot) !== null && _d !== void 0 ? _d : false,
        xmlCharKey: (_e = serializerOptions.xmlCharKey) !== null && _e !== void 0 ? _e : _util_serializer_common__WEBPACK_IMPORTED_MODULE_29__["XML_CHARKEY"]
    };
    var xmlCharKey = serializerOptions.xmlCharKey;
    if (operationSpec.requestBody && operationSpec.requestBody.mapper) {
        httpRequest.body = getOperationArgumentValueFromParameter(serviceClient, operationArguments, operationSpec.requestBody, operationSpec.serializer);
        var bodyMapper = operationSpec.requestBody.mapper;
        var required = bodyMapper.required, xmlName = bodyMapper.xmlName, xmlElementName = bodyMapper.xmlElementName, serializedName = bodyMapper.serializedName, xmlNamespace = bodyMapper.xmlNamespace, xmlNamespacePrefix = bodyMapper.xmlNamespacePrefix;
        var typeName = bodyMapper.type.name;
        try {
            if ((httpRequest.body !== undefined && httpRequest.body !== null) || required) {
                var requestBodyParameterPathString = Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(operationSpec.requestBody);
                httpRequest.body = operationSpec.serializer.serialize(bodyMapper, httpRequest.body, requestBodyParameterPathString, updatedOptions);
                var isStream = typeName === _serializer__WEBPACK_IMPORTED_MODULE_16__["MapperType"].Stream;
                if (operationSpec.isXML) {
                    var xmlnsKey = xmlNamespacePrefix ? "xmlns:" + xmlNamespacePrefix : "xmlns";
                    var value = getXmlValueWithNamespace(xmlNamespace, xmlnsKey, typeName, httpRequest.body, updatedOptions);
                    if (typeName === _serializer__WEBPACK_IMPORTED_MODULE_16__["MapperType"].Sequence) {
                        httpRequest.body = Object(_util_xml__WEBPACK_IMPORTED_MODULE_19__["stringifyXML"])(_util_utils__WEBPACK_IMPORTED_MODULE_18__["prepareXMLRootList"](value, xmlElementName || xmlName || serializedName, xmlnsKey, xmlNamespace), {
                            rootName: xmlName || serializedName,
                            xmlCharKey: xmlCharKey
                        });
                    }
                    else if (!isStream) {
                        httpRequest.body = Object(_util_xml__WEBPACK_IMPORTED_MODULE_19__["stringifyXML"])(value, {
                            rootName: xmlName || serializedName,
                            xmlCharKey: xmlCharKey
                        });
                    }
                }
                else if (typeName === _serializer__WEBPACK_IMPORTED_MODULE_16__["MapperType"].String &&
                    (((_f = operationSpec.contentType) === null || _f === void 0 ? void 0 : _f.match("text/plain")) || operationSpec.mediaType === "text")) {
                    // the String serializer has validated that request body is a string
                    // so just send the string.
                    return;
                }
                else if (!isStream) {
                    httpRequest.body = JSON.stringify(httpRequest.body);
                }
            }
        }
        catch (error) {
            throw new Error("Error \"" + error.message + "\" occurred in serializing the payload - " + JSON.stringify(serializedName, undefined, "  ") + ".");
        }
    }
    else if (operationSpec.formDataParameters && operationSpec.formDataParameters.length > 0) {
        httpRequest.formData = {};
        for (var _i = 0, _g = operationSpec.formDataParameters; _i < _g.length; _i++) {
            var formDataParameter = _g[_i];
            var formDataParameterValue = getOperationArgumentValueFromParameter(serviceClient, operationArguments, formDataParameter, operationSpec.serializer);
            if (formDataParameterValue !== undefined && formDataParameterValue !== null) {
                var formDataParameterPropertyName = formDataParameter.mapper.serializedName || Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(formDataParameter);
                httpRequest.formData[formDataParameterPropertyName] = operationSpec.serializer.serialize(formDataParameter.mapper, formDataParameterValue, Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameter"])(formDataParameter), updatedOptions);
            }
        }
    }
}
/**
 * Adds an xml namespace to the xml serialized object if needed, otherwise it just returns the value itself
 */
function getXmlValueWithNamespace(xmlNamespace, xmlnsKey, typeName, serializedValue, options) {
    var _a;
    // Composite and Sequence schemas already got their root namespace set during serialization
    // We just need to add xmlns to the other schema types
    if (xmlNamespace && !["Composite", "Sequence", "Dictionary"].includes(typeName)) {
        var result = {};
        result[options.xmlCharKey] = serializedValue;
        result[_util_serializer_common__WEBPACK_IMPORTED_MODULE_29__["XML_ATTRKEY"]] = (_a = {}, _a[xmlnsKey] = xmlNamespace, _a);
        return result;
    }
    return serializedValue;
}
function getValueOrFunctionResult(value, defaultValueCreator) {
    var result;
    if (typeof value === "string") {
        result = value;
    }
    else {
        result = defaultValueCreator();
        if (typeof value === "function") {
            result = value(result);
        }
    }
    return result;
}
function createDefaultRequestPolicyFactories(authPolicyFactory, options) {
    var factories = [];
    if (options.generateClientRequestIdHeader) {
        factories.push(Object(_policies_generateClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_8__["generateClientRequestIdPolicy"])(options.clientRequestIdHeaderName));
    }
    if (authPolicyFactory) {
        factories.push(authPolicyFactory);
    }
    var userAgentHeaderName = getValueOrFunctionResult(options.userAgentHeaderName, _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_9__["getDefaultUserAgentHeaderName"]);
    var userAgentHeaderValue = getValueOrFunctionResult(options.userAgent, _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_9__["getDefaultUserAgentValue"]);
    if (userAgentHeaderName && userAgentHeaderValue) {
        factories.push(Object(_policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_9__["userAgentPolicy"])({ key: userAgentHeaderName, value: userAgentHeaderValue }));
    }
    factories.push(Object(_policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_10__["redirectPolicy"])());
    factories.push(Object(_policies_rpRegistrationPolicy__WEBPACK_IMPORTED_MODULE_12__["rpRegistrationPolicy"])(options.rpRegistrationRetryTimeout));
    if (!options.noRetryPolicy) {
        factories.push(Object(_policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_7__["exponentialRetryPolicy"])());
        factories.push(Object(_policies_systemErrorRetryPolicy__WEBPACK_IMPORTED_MODULE_14__["systemErrorRetryPolicy"])());
        factories.push(Object(_policies_throttlingRetryPolicy__WEBPACK_IMPORTED_MODULE_22__["throttlingRetryPolicy"])());
    }
    factories.push(Object(_policies_deserializationPolicy__WEBPACK_IMPORTED_MODULE_6__["deserializationPolicy"])(options.deserializationContentTypes));
    if (_util_utils__WEBPACK_IMPORTED_MODULE_18__["isNode"]) {
        factories.push(Object(_policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_21__["proxyPolicy"])(options.proxySettings));
    }
    factories.push(Object(_policies_logPolicy__WEBPACK_IMPORTED_MODULE_3__["logPolicy"])({ logger: _log__WEBPACK_IMPORTED_MODULE_24__["logger"].info }));
    return factories;
}
function createPipelineFromOptions(pipelineOptions, authPolicyFactory) {
    var requestPolicyFactories = [];
    if (pipelineOptions.sendStreamingJson) {
        requestPolicyFactories.push(Object(_policies_ndJsonPolicy__WEBPACK_IMPORTED_MODULE_28__["ndJsonPolicy"])());
    }
    var userAgentValue = undefined;
    if (pipelineOptions.userAgentOptions && pipelineOptions.userAgentOptions.userAgentPrefix) {
        var userAgentInfo = [];
        userAgentInfo.push(pipelineOptions.userAgentOptions.userAgentPrefix);
        // Add the default user agent value if it isn't already specified
        // by the userAgentPrefix option.
        var defaultUserAgentInfo = Object(_policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_9__["getDefaultUserAgentValue"])();
        if (userAgentInfo.indexOf(defaultUserAgentInfo) === -1) {
            userAgentInfo.push(defaultUserAgentInfo);
        }
        userAgentValue = userAgentInfo.join(" ");
    }
    var keepAliveOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, _policies_keepAlivePolicy__WEBPACK_IMPORTED_MODULE_25__["DefaultKeepAliveOptions"]), pipelineOptions.keepAliveOptions);
    var retryOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, _policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_7__["DefaultRetryOptions"]), pipelineOptions.retryOptions);
    var redirectOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, _policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_10__["DefaultRedirectOptions"]), pipelineOptions.redirectOptions);
    if (_util_utils__WEBPACK_IMPORTED_MODULE_18__["isNode"]) {
        requestPolicyFactories.push(Object(_policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_21__["proxyPolicy"])(pipelineOptions.proxyOptions));
    }
    var deserializationOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, _policies_deserializationPolicy__WEBPACK_IMPORTED_MODULE_6__["DefaultDeserializationOptions"]), pipelineOptions.deserializationOptions);
    var loggingOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, pipelineOptions.loggingOptions);
    requestPolicyFactories.push(Object(_policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_26__["tracingPolicy"])({ userAgent: userAgentValue }), Object(_policies_keepAlivePolicy__WEBPACK_IMPORTED_MODULE_25__["keepAlivePolicy"])(keepAliveOptions), Object(_policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_9__["userAgentPolicy"])({ value: userAgentValue }), Object(_policies_generateClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_8__["generateClientRequestIdPolicy"])(), Object(_policies_deserializationPolicy__WEBPACK_IMPORTED_MODULE_6__["deserializationPolicy"])(deserializationOptions.expectedContentTypes), Object(_policies_throttlingRetryPolicy__WEBPACK_IMPORTED_MODULE_22__["throttlingRetryPolicy"])(), Object(_policies_systemErrorRetryPolicy__WEBPACK_IMPORTED_MODULE_14__["systemErrorRetryPolicy"])(), Object(_policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_7__["exponentialRetryPolicy"])(retryOptions.maxRetries, retryOptions.retryDelayInMs, retryOptions.maxRetryDelayInMs));
    if (redirectOptions.handleRedirects) {
        requestPolicyFactories.push(Object(_policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_10__["redirectPolicy"])(redirectOptions.maxRetries));
    }
    if (authPolicyFactory) {
        requestPolicyFactories.push(authPolicyFactory);
    }
    requestPolicyFactories.push(Object(_policies_logPolicy__WEBPACK_IMPORTED_MODULE_3__["logPolicy"])(loggingOptions));
    if (_util_utils__WEBPACK_IMPORTED_MODULE_18__["isNode"] && pipelineOptions.decompressResponse === false) {
        requestPolicyFactories.push(Object(_policies_disableResponseDecompressionPolicy__WEBPACK_IMPORTED_MODULE_27__["disableResponseDecompressionPolicy"])());
    }
    return {
        httpClient: pipelineOptions.httpClient,
        requestPolicyFactories: requestPolicyFactories
    };
}
/**
 * Get the property parent for the property at the provided path when starting with the provided
 * parent object.
 */
function getPropertyParent(parent, propertyPath) {
    if (parent && propertyPath) {
        var propertyPathLength = propertyPath.length;
        for (var i = 0; i < propertyPathLength - 1; ++i) {
            var propertyName = propertyPath[i];
            if (!parent[propertyName]) {
                parent[propertyName] = {};
            }
            parent = parent[propertyName];
        }
    }
    return parent;
}
function getOperationArgumentValueFromParameter(serviceClient, operationArguments, parameter, serializer) {
    return getOperationArgumentValueFromParameterPath(serviceClient, operationArguments, parameter.parameterPath, parameter.mapper, serializer);
}
function getOperationArgumentValueFromParameterPath(serviceClient, operationArguments, parameterPath, parameterMapper, serializer) {
    var _a;
    var value;
    if (typeof parameterPath === "string") {
        parameterPath = [parameterPath];
    }
    var serializerOptions = (_a = operationArguments.options) === null || _a === void 0 ? void 0 : _a.serializerOptions;
    if (Array.isArray(parameterPath)) {
        if (parameterPath.length > 0) {
            if (parameterMapper.isConstant) {
                value = parameterMapper.defaultValue;
            }
            else {
                var propertySearchResult = getPropertyFromParameterPath(operationArguments, parameterPath);
                if (!propertySearchResult.propertyFound) {
                    propertySearchResult = getPropertyFromParameterPath(serviceClient, parameterPath);
                }
                var useDefaultValue = false;
                if (!propertySearchResult.propertyFound) {
                    useDefaultValue =
                        parameterMapper.required ||
                            (parameterPath[0] === "options" && parameterPath.length === 2);
                }
                value = useDefaultValue ? parameterMapper.defaultValue : propertySearchResult.propertyValue;
            }
            // Serialize just for validation purposes.
            var parameterPathString = Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameterPath"])(parameterPath, parameterMapper);
            serializer.serialize(parameterMapper, value, parameterPathString, serializerOptions);
        }
    }
    else {
        if (parameterMapper.required) {
            value = {};
        }
        for (var propertyName in parameterPath) {
            var propertyMapper = parameterMapper.type.modelProperties[propertyName];
            var propertyPath = parameterPath[propertyName];
            var propertyValue = getOperationArgumentValueFromParameterPath(serviceClient, operationArguments, propertyPath, propertyMapper, serializer);
            // Serialize just for validation purposes.
            var propertyPathString = Object(_operationParameter__WEBPACK_IMPORTED_MODULE_4__["getPathStringFromParameterPath"])(propertyPath, propertyMapper);
            serializer.serialize(propertyMapper, propertyValue, propertyPathString, serializerOptions);
            if (propertyValue !== undefined && propertyValue !== null) {
                if (!value) {
                    value = {};
                }
                value[propertyName] = propertyValue;
            }
        }
    }
    return value;
}
function getPropertyFromParameterPath(parent, parameterPath) {
    var result = { propertyFound: false };
    var i = 0;
    for (; i < parameterPath.length; ++i) {
        var parameterPathPart = parameterPath[i];
        // Make sure to check inherited properties too, so don't use hasOwnProperty().
        if (parent !== undefined && parent !== null && parameterPathPart in parent) {
            parent = parent[parameterPathPart];
        }
        else {
            break;
        }
    }
    if (i === parameterPath.length) {
        result.propertyValue = parent;
        result.propertyFound = true;
    }
    return result;
}
function flattenResponse(_response, responseSpec) {
    var parsedHeaders = _response.parsedHeaders;
    var bodyMapper = responseSpec && responseSpec.bodyMapper;
    var addOperationResponse = function (obj) {
        return Object.defineProperty(obj, "_response", {
            value: _response
        });
    };
    if (bodyMapper) {
        var typeName = bodyMapper.type.name;
        if (typeName === "Stream") {
            return addOperationResponse(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, parsedHeaders), { blobBody: _response.blobBody, readableStreamBody: _response.readableStreamBody }));
        }
        var modelProperties_1 = (typeName === "Composite" && bodyMapper.type.modelProperties) || {};
        var isPageableResponse = Object.keys(modelProperties_1).some(function (k) { return modelProperties_1[k].serializedName === ""; });
        if (typeName === "Sequence" || isPageableResponse) {
            var arrayResponse = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__spreadArrays"])((_response.parsedBody || []));
            for (var _i = 0, _a = Object.keys(modelProperties_1); _i < _a.length; _i++) {
                var key = _a[_i];
                if (modelProperties_1[key].serializedName) {
                    arrayResponse[key] = _response.parsedBody[key];
                }
            }
            if (parsedHeaders) {
                for (var _b = 0, _c = Object.keys(parsedHeaders); _b < _c.length; _b++) {
                    var key = _c[_b];
                    arrayResponse[key] = parsedHeaders[key];
                }
            }
            addOperationResponse(arrayResponse);
            return arrayResponse;
        }
        if (typeName === "Composite" || typeName === "Dictionary") {
            return addOperationResponse(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, parsedHeaders), _response.parsedBody));
        }
    }
    if (bodyMapper ||
        _response.request.method === "HEAD" ||
        _util_utils__WEBPACK_IMPORTED_MODULE_18__["isPrimitiveType"](_response.parsedBody)) {
        // primitive body types and HEAD booleans
        return addOperationResponse(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, parsedHeaders), { body: _response.parsedBody }));
    }
    return addOperationResponse(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, parsedHeaders), _response.parsedBody));
}
function getCredentialScopes(options, baseUri) {
    if (options === null || options === void 0 ? void 0 : options.credentialScopes) {
        var scopes = options.credentialScopes;
        return Array.isArray(scopes)
            ? scopes.map(function (scope) { return new _url__WEBPACK_IMPORTED_MODULE_17__["URL"](scope).toString(); })
            : new _url__WEBPACK_IMPORTED_MODULE_17__["URL"](scopes).toString();
    }
    if (baseUri) {
        return baseUri + "/.default";
    }
    return undefined;
}
//# sourceMappingURL=serviceClient.js.map

/***/ }),
/* 52 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _azureKeyCredential__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(53);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "AzureKeyCredential", function() { return _azureKeyCredential__WEBPACK_IMPORTED_MODULE_0__["AzureKeyCredential"]; });

/* harmony import */ var _tokenCredential__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(54);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "isTokenCredential", function() { return _tokenCredential__WEBPACK_IMPORTED_MODULE_1__["isTokenCredential"]; });

// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


//# sourceMappingURL=index.js.map

/***/ }),
/* 53 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AzureKeyCredential", function() { return AzureKeyCredential; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * A static-key-based credential that supports updating
 * the underlying key value.
 */
var AzureKeyCredential = /** @class */ (function () {
    /**
     * Create an instance of an AzureKeyCredential for use
     * with a service client.
     *
     * @param key the initial value of the key to use in authentication
     */
    function AzureKeyCredential(key) {
        if (!key) {
            throw new Error("key must be a non-empty string");
        }
        this._key = key;
    }
    Object.defineProperty(AzureKeyCredential.prototype, "key", {
        /**
         * The value of the key to be used in authentication
         */
        get: function () {
            return this._key;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * Change the value of the key.
     *
     * Updates will take effect upon the next request after
     * updating the key value.
     *
     * @param newKey the new key value to be used
     */
    AzureKeyCredential.prototype.update = function (newKey) {
        this._key = newKey;
    };
    return AzureKeyCredential;
}());

//# sourceMappingURL=azureKeyCredential.js.map

/***/ }),
/* 54 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isTokenCredential", function() { return isTokenCredential; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * Tests an object to determine whether it implements TokenCredential.
 *
 * @param credential The assumed TokenCredential to be tested.
 */
function isTokenCredential(credential) {
    // Check for an object with a 'getToken' function and possibly with
    // a 'signRequest' function.  We do this check to make sure that
    // a ServiceClientCredentials implementor (like TokenClientCredentials
    // in ms-rest-nodeauth) doesn't get mistaken for a TokenCredential if
    // it doesn't actually implement TokenCredential also.
    return (credential &&
        typeof credential.getToken === "function" &&
        (credential.signRequest === undefined || credential.getToken.length > 0));
}
//# sourceMappingURL=tokenCredential.js.map

/***/ }),
/* 55 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "logPolicy", function() { return logPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "LogPolicy", function() { return LogPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(57);
/* harmony import */ var _util_sanitizer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(46);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.




function logPolicy(loggingOptions) {
    if (loggingOptions === void 0) { loggingOptions = {}; }
    return {
        create: function (nextPolicy, options) {
            return new LogPolicy(nextPolicy, options, loggingOptions);
        }
    };
}
var LogPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(LogPolicy, _super);
    function LogPolicy(nextPolicy, options, _a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.logger, logger = _c === void 0 ? _log__WEBPACK_IMPORTED_MODULE_2__["logger"].info : _c, _d = _b.allowedHeaderNames, allowedHeaderNames = _d === void 0 ? [] : _d, _e = _b.allowedQueryParameters, allowedQueryParameters = _e === void 0 ? [] : _e;
        var _this = _super.call(this, nextPolicy, options) || this;
        _this.logger = logger;
        _this.sanitizer = new _util_sanitizer__WEBPACK_IMPORTED_MODULE_3__["Sanitizer"]({ allowedHeaderNames: allowedHeaderNames, allowedQueryParameters: allowedQueryParameters });
        return _this;
    }
    Object.defineProperty(LogPolicy.prototype, "allowedHeaderNames", {
        /**
         * Header names whose values will be logged when logging is enabled. Defaults to
         * Date, traceparent, x-ms-client-request-id, and x-ms-request id.  Any headers
         * specified in this field will be added to that list.  Any other values will
         * be written to logs as "REDACTED".
         * @deprecated Pass these into the constructor instead.
         */
        get: function () {
            return this.sanitizer.allowedHeaderNames;
        },
        /**
         * Header names whose values will be logged when logging is enabled. Defaults to
         * Date, traceparent, x-ms-client-request-id, and x-ms-request id.  Any headers
         * specified in this field will be added to that list.  Any other values will
         * be written to logs as "REDACTED".
         * @deprecated Pass these into the constructor instead.
         */
        set: function (allowedHeaderNames) {
            this.sanitizer.allowedHeaderNames = allowedHeaderNames;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(LogPolicy.prototype, "allowedQueryParameters", {
        /**
         * Query string names whose values will be logged when logging is enabled. By default no
         * query string values are logged.
         * @deprecated Pass these into the constructor instead.
         */
        get: function () {
            return this.sanitizer.allowedQueryParameters;
        },
        /**
         * Query string names whose values will be logged when logging is enabled. By default no
         * query string values are logged.
         * @deprecated Pass these into the constructor instead.
         */
        set: function (allowedQueryParameters) {
            this.sanitizer.allowedQueryParameters = allowedQueryParameters;
        },
        enumerable: false,
        configurable: true
    });
    LogPolicy.prototype.sendRequest = function (request) {
        var _this = this;
        if (!this.logger.enabled)
            return this._nextPolicy.sendRequest(request);
        this.logRequest(request);
        return this._nextPolicy.sendRequest(request).then(function (response) { return _this.logResponse(response); });
    };
    LogPolicy.prototype.logRequest = function (request) {
        this.logger("Request: " + this.sanitizer.sanitize(request));
    };
    LogPolicy.prototype.logResponse = function (response) {
        this.logger("Response status code: " + response.status);
        this.logger("Headers: " + this.sanitizer.sanitize(response.headers));
        return response;
    };
    return LogPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));

//# sourceMappingURL=logPolicy.js.map

/***/ }),
/* 56 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BaseRequestPolicy", function() { return BaseRequestPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RequestPolicyOptions", function() { return RequestPolicyOptions; });
/* harmony import */ var _httpPipelineLogLevel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(49);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

var BaseRequestPolicy = /** @class */ (function () {
    function BaseRequestPolicy(_nextPolicy, _options) {
        this._nextPolicy = _nextPolicy;
        this._options = _options;
    }
    /**
     * Get whether or not a log with the provided log level should be logged.
     * @param logLevel The log level of the log that will be logged.
     * @returns Whether or not a log with the provided log level should be logged.
     */
    BaseRequestPolicy.prototype.shouldLog = function (logLevel) {
        return this._options.shouldLog(logLevel);
    };
    /**
     * Attempt to log the provided message to the provided logger. If no logger was provided or if
     * the log level does not meat the logger's threshold, then nothing will be logged.
     * @param logLevel The log level of this log.
     * @param message The message of this log.
     */
    BaseRequestPolicy.prototype.log = function (logLevel, message) {
        this._options.log(logLevel, message);
    };
    return BaseRequestPolicy;
}());

/**
 * Optional properties that can be used when creating a RequestPolicy.
 */
var RequestPolicyOptions = /** @class */ (function () {
    function RequestPolicyOptions(_logger) {
        this._logger = _logger;
    }
    /**
     * Get whether or not a log with the provided log level should be logged.
     * @param logLevel The log level of the log that will be logged.
     * @returns Whether or not a log with the provided log level should be logged.
     */
    RequestPolicyOptions.prototype.shouldLog = function (logLevel) {
        return (!!this._logger &&
            logLevel !== _httpPipelineLogLevel__WEBPACK_IMPORTED_MODULE_0__["HttpPipelineLogLevel"].OFF &&
            logLevel <= this._logger.minimumLogLevel);
    };
    /**
     * Attempt to log the provided message to the provided logger. If no logger was provided or if
     * the log level does not meet the logger's threshold, then nothing will be logged.
     * @param logLevel The log level of this log.
     * @param message The message of this log.
     */
    RequestPolicyOptions.prototype.log = function (logLevel, message) {
        if (this._logger && this.shouldLog(logLevel)) {
            this._logger.log(logLevel, message);
        }
    };
    return RequestPolicyOptions;
}());

//# sourceMappingURL=requestPolicy.js.map

/***/ }),
/* 57 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "logger", function() { return logger; });
/* harmony import */ var _azure_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(58);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

var logger = Object(_azure_logger__WEBPACK_IMPORTED_MODULE_0__["createClientLogger"])("core-http");
//# sourceMappingURL=log.js.map

/***/ }),
/* 58 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function(process) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AzureLogger", function() { return AzureLogger; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setLogLevel", function() { return setLogLevel; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getLogLevel", function() { return getLogLevel; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createClientLogger", function() { return createClientLogger; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(42);
/* harmony import */ var _debug__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(59);
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.


var registeredLoggers = new Set();
var logLevelFromEnv = (typeof process !== "undefined" && process.env && process.env.AZURE_LOG_LEVEL) || undefined;
var azureLogLevel;
/**
 * The AzureLogger provides a mechanism for overriding where logs are output to.
 * By default, logs are sent to stderr.
 * Override the `log` method to redirect logs to another location.
 */
var AzureLogger = Object(_debug__WEBPACK_IMPORTED_MODULE_1__["default"])("azure");
AzureLogger.log = function () {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    _debug__WEBPACK_IMPORTED_MODULE_1__["default"].log.apply(_debug__WEBPACK_IMPORTED_MODULE_1__["default"], Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__spread"])(args));
};
var AZURE_LOG_LEVELS = ["verbose", "info", "warning", "error"];
if (logLevelFromEnv) {
    // avoid calling setLogLevel because we don't want a mis-set environment variable to crash
    if (isAzureLogLevel(logLevelFromEnv)) {
        setLogLevel(logLevelFromEnv);
    }
    else {
        console.error("AZURE_LOG_LEVEL set to unknown log level '" + logLevelFromEnv + "'; logging is not enabled. Acceptable values: " + AZURE_LOG_LEVELS.join(", ") + ".");
    }
}
/**
 * Immediately enables logging at the specified log level.
 * @param level The log level to enable for logging.
 * Options from most verbose to least verbose are:
 * - verbose
 * - info
 * - warning
 * - error
 */
function setLogLevel(level) {
    var e_1, _a;
    if (level && !isAzureLogLevel(level)) {
        throw new Error("Unknown log level '" + level + "'. Acceptable values: " + AZURE_LOG_LEVELS.join(","));
    }
    azureLogLevel = level;
    var enabledNamespaces = [];
    try {
        for (var registeredLoggers_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__values"])(registeredLoggers), registeredLoggers_1_1 = registeredLoggers_1.next(); !registeredLoggers_1_1.done; registeredLoggers_1_1 = registeredLoggers_1.next()) {
            var logger = registeredLoggers_1_1.value;
            if (shouldEnable(logger)) {
                enabledNamespaces.push(logger.namespace);
            }
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (registeredLoggers_1_1 && !registeredLoggers_1_1.done && (_a = registeredLoggers_1.return)) _a.call(registeredLoggers_1);
        }
        finally { if (e_1) throw e_1.error; }
    }
    _debug__WEBPACK_IMPORTED_MODULE_1__["default"].enable(enabledNamespaces.join(","));
}
/**
 * Retrieves the currently specified log level.
 */
function getLogLevel() {
    return azureLogLevel;
}
var levelMap = {
    verbose: 400,
    info: 300,
    warning: 200,
    error: 100
};
/**
 * Creates a logger for use by the Azure SDKs that inherits from `AzureLogger`.
 * @param namespace The name of the SDK package.
 * @ignore
 */
function createClientLogger(namespace) {
    var clientRootLogger = AzureLogger.extend(namespace);
    patchLogMethod(AzureLogger, clientRootLogger);
    return {
        error: createLogger(clientRootLogger, "error"),
        warning: createLogger(clientRootLogger, "warning"),
        info: createLogger(clientRootLogger, "info"),
        verbose: createLogger(clientRootLogger, "verbose")
    };
}
function patchLogMethod(parent, child) {
    child.log = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        parent.log.apply(parent, Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__spread"])(args));
    };
}
function createLogger(parent, level) {
    var logger = Object.assign(parent.extend(level), {
        level: level
    });
    patchLogMethod(parent, logger);
    if (shouldEnable(logger)) {
        var enabledNamespaces = _debug__WEBPACK_IMPORTED_MODULE_1__["default"].disable();
        _debug__WEBPACK_IMPORTED_MODULE_1__["default"].enable(enabledNamespaces + "," + logger.namespace);
    }
    registeredLoggers.add(logger);
    return logger;
}
function shouldEnable(logger) {
    if (azureLogLevel && levelMap[logger.level] <= levelMap[azureLogLevel]) {
        return true;
    }
    else {
        return false;
    }
}
function isAzureLogLevel(logLevel) {
    return AZURE_LOG_LEVELS.includes(logLevel);
}
//# sourceMappingURL=logger.js.map
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(20)))

/***/ }),
/* 59 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function(process) {/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(42);
/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(60);
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.


var debugEnvVariable = (typeof process !== "undefined" && process.env && process.env.DEBUG) || undefined;
var enabledString;
var enabledNamespaces = [];
var skippedNamespaces = [];
var debuggers = [];
if (debugEnvVariable) {
    enable(debugEnvVariable);
}
function enable(namespaces) {
    var e_1, _a, e_2, _b;
    enabledString = namespaces;
    enabledNamespaces = [];
    skippedNamespaces = [];
    var wildcard = /\*/g;
    var namespaceList = namespaces.split(",").map(function (ns) { return ns.trim().replace(wildcard, ".*?"); });
    try {
        for (var namespaceList_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__values"])(namespaceList), namespaceList_1_1 = namespaceList_1.next(); !namespaceList_1_1.done; namespaceList_1_1 = namespaceList_1.next()) {
            var ns = namespaceList_1_1.value;
            if (ns.startsWith("-")) {
                skippedNamespaces.push(new RegExp("^" + ns.substr(1) + "$"));
            }
            else {
                enabledNamespaces.push(new RegExp("^" + ns + "$"));
            }
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (namespaceList_1_1 && !namespaceList_1_1.done && (_a = namespaceList_1.return)) _a.call(namespaceList_1);
        }
        finally { if (e_1) throw e_1.error; }
    }
    try {
        for (var debuggers_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__values"])(debuggers), debuggers_1_1 = debuggers_1.next(); !debuggers_1_1.done; debuggers_1_1 = debuggers_1.next()) {
            var instance = debuggers_1_1.value;
            instance.enabled = enabled(instance.namespace);
        }
    }
    catch (e_2_1) { e_2 = { error: e_2_1 }; }
    finally {
        try {
            if (debuggers_1_1 && !debuggers_1_1.done && (_b = debuggers_1.return)) _b.call(debuggers_1);
        }
        finally { if (e_2) throw e_2.error; }
    }
}
function enabled(namespace) {
    var e_3, _a, e_4, _b;
    if (namespace.endsWith("*")) {
        return true;
    }
    try {
        for (var skippedNamespaces_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__values"])(skippedNamespaces), skippedNamespaces_1_1 = skippedNamespaces_1.next(); !skippedNamespaces_1_1.done; skippedNamespaces_1_1 = skippedNamespaces_1.next()) {
            var skipped = skippedNamespaces_1_1.value;
            if (skipped.test(namespace)) {
                return false;
            }
        }
    }
    catch (e_3_1) { e_3 = { error: e_3_1 }; }
    finally {
        try {
            if (skippedNamespaces_1_1 && !skippedNamespaces_1_1.done && (_a = skippedNamespaces_1.return)) _a.call(skippedNamespaces_1);
        }
        finally { if (e_3) throw e_3.error; }
    }
    try {
        for (var enabledNamespaces_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__values"])(enabledNamespaces), enabledNamespaces_1_1 = enabledNamespaces_1.next(); !enabledNamespaces_1_1.done; enabledNamespaces_1_1 = enabledNamespaces_1.next()) {
            var enabled_1 = enabledNamespaces_1_1.value;
            if (enabled_1.test(namespace)) {
                return true;
            }
        }
    }
    catch (e_4_1) { e_4 = { error: e_4_1 }; }
    finally {
        try {
            if (enabledNamespaces_1_1 && !enabledNamespaces_1_1.done && (_b = enabledNamespaces_1.return)) _b.call(enabledNamespaces_1);
        }
        finally { if (e_4) throw e_4.error; }
    }
    return false;
}
function disable() {
    var result = enabledString || "";
    enable("");
    return result;
}
function createDebugger(namespace) {
    function debug() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (!newDebugger.enabled) {
            return;
        }
        if (args.length > 0) {
            args[0] = namespace + " " + args[0];
        }
        newDebugger.log.apply(newDebugger, Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__spread"])(args));
    }
    var newDebugger = Object.assign(debug, {
        enabled: enabled(namespace),
        destroy: destroy,
        log: debugObj.log,
        namespace: namespace,
        extend: extend
    });
    debuggers.push(newDebugger);
    return newDebugger;
}
function destroy() {
    var index = debuggers.indexOf(this);
    if (index >= 0) {
        debuggers.splice(index, 1);
        return true;
    }
    return false;
}
function extend(namespace) {
    var newDebugger = createDebugger(this.namespace + ":" + namespace);
    newDebugger.log = this.log;
    return newDebugger;
}
var debugObj = Object.assign(function (namespace) {
    return createDebugger(namespace);
}, {
    enable: enable,
    enabled: enabled,
    disable: disable,
    log: _log__WEBPACK_IMPORTED_MODULE_1__["log"]
});
/* harmony default export */ __webpack_exports__["default"] = (debugObj);
//# sourceMappingURL=debug.js.map
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(20)))

/***/ }),
/* 60 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "log", function() { return log; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(42);
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var logFunction = console.debug || console.log;
function log() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    logFunction.apply(void 0, Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__spread"])(args));
}
//# sourceMappingURL=log.browser.js.map

/***/ }),
/* 61 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getPathStringFromParameter", function() { return getPathStringFromParameter; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getPathStringFromParameterPath", function() { return getPathStringFromParameterPath; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * Get the path to this parameter's value as a dotted string (a.b.c).
 * @param parameter The parameter to get the path string for.
 * @returns The path to this parameter's value as a dotted string.
 */
function getPathStringFromParameter(parameter) {
    return getPathStringFromParameterPath(parameter.parameterPath, parameter.mapper);
}
function getPathStringFromParameterPath(parameterPath, mapper) {
    var result;
    if (typeof parameterPath === "string") {
        result = parameterPath;
    }
    else if (Array.isArray(parameterPath)) {
        result = parameterPath.join(".");
    }
    else {
        result = mapper.serializedName;
    }
    return result;
}
//# sourceMappingURL=operationParameter.js.map

/***/ }),
/* 62 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isStreamOperation", function() { return isStreamOperation; });
/* harmony import */ var _serializer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(16);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

function isStreamOperation(operationSpec) {
    var result = false;
    for (var statusCode in operationSpec.responses) {
        var operationResponse = operationSpec.responses[statusCode];
        if (operationResponse.bodyMapper &&
            operationResponse.bodyMapper.type.name === _serializer__WEBPACK_IMPORTED_MODULE_0__["MapperType"].Stream) {
            result = true;
            break;
        }
    }
    return result;
}
//# sourceMappingURL=operationSpec.js.map

/***/ }),
/* 63 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "deserializationPolicy", function() { return deserializationPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "defaultJsonContentTypes", function() { return defaultJsonContentTypes; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "defaultXmlContentTypes", function() { return defaultXmlContentTypes; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DefaultDeserializationOptions", function() { return DefaultDeserializationOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DeserializationPolicy", function() { return DeserializationPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "deserializeResponseBody", function() { return deserializeResponseBody; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _operationSpec__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(62);
/* harmony import */ var _restError__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(44);
/* harmony import */ var _serializer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(16);
/* harmony import */ var _util_xml__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(64);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(56);
/* harmony import */ var _util_serializer_common__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(37);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.







/**
 * Create a new serialization RequestPolicyCreator that will serialized HTTP request bodies as they
 * pass through the HTTP pipeline.
 */
function deserializationPolicy(deserializationContentTypes, parsingOptions) {
    return {
        create: function (nextPolicy, options) {
            return new DeserializationPolicy(nextPolicy, options, deserializationContentTypes, parsingOptions);
        }
    };
}
var defaultJsonContentTypes = ["application/json", "text/json"];
var defaultXmlContentTypes = ["application/xml", "application/atom+xml"];
var DefaultDeserializationOptions = {
    expectedContentTypes: {
        json: defaultJsonContentTypes,
        xml: defaultXmlContentTypes
    }
};
/**
 * A RequestPolicy that will deserialize HTTP response bodies and headers as they pass through the
 * HTTP pipeline.
 */
var DeserializationPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(DeserializationPolicy, _super);
    function DeserializationPolicy(nextPolicy, requestPolicyOptions, deserializationContentTypes, parsingOptions) {
        if (parsingOptions === void 0) { parsingOptions = {}; }
        var _a;
        var _this = _super.call(this, nextPolicy, requestPolicyOptions) || this;
        _this.jsonContentTypes =
            (deserializationContentTypes && deserializationContentTypes.json) || defaultJsonContentTypes;
        _this.xmlContentTypes =
            (deserializationContentTypes && deserializationContentTypes.xml) || defaultXmlContentTypes;
        _this.xmlCharKey = (_a = parsingOptions.xmlCharKey) !== null && _a !== void 0 ? _a : _util_serializer_common__WEBPACK_IMPORTED_MODULE_6__["XML_CHARKEY"];
        return _this;
    }
    DeserializationPolicy.prototype.sendRequest = function (request) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var _this = this;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                return [2 /*return*/, this._nextPolicy.sendRequest(request).then(function (response) {
                        return deserializeResponseBody(_this.jsonContentTypes, _this.xmlContentTypes, response, {
                            xmlCharKey: _this.xmlCharKey
                        });
                    })];
            });
        });
    };
    return DeserializationPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_5__["BaseRequestPolicy"]));

function getOperationResponse(parsedResponse) {
    var result;
    var request = parsedResponse.request;
    var operationSpec = request.operationSpec;
    if (operationSpec) {
        var operationResponseGetter = request.operationResponseGetter;
        if (!operationResponseGetter) {
            result = operationSpec.responses[parsedResponse.status];
        }
        else {
            result = operationResponseGetter(operationSpec, parsedResponse);
        }
    }
    return result;
}
function shouldDeserializeResponse(parsedResponse) {
    var shouldDeserialize = parsedResponse.request.shouldDeserialize;
    var result;
    if (shouldDeserialize === undefined) {
        result = true;
    }
    else if (typeof shouldDeserialize === "boolean") {
        result = shouldDeserialize;
    }
    else {
        result = shouldDeserialize(parsedResponse);
    }
    return result;
}
function deserializeResponseBody(jsonContentTypes, xmlContentTypes, response, options) {
    var _a, _b, _c;
    if (options === void 0) { options = {}; }
    var updatedOptions = {
        rootName: (_a = options.rootName) !== null && _a !== void 0 ? _a : "",
        includeRoot: (_b = options.includeRoot) !== null && _b !== void 0 ? _b : false,
        xmlCharKey: (_c = options.xmlCharKey) !== null && _c !== void 0 ? _c : _util_serializer_common__WEBPACK_IMPORTED_MODULE_6__["XML_CHARKEY"]
    };
    return parse(jsonContentTypes, xmlContentTypes, response, updatedOptions).then(function (parsedResponse) {
        if (!shouldDeserializeResponse(parsedResponse)) {
            return parsedResponse;
        }
        var operationSpec = parsedResponse.request.operationSpec;
        if (!operationSpec || !operationSpec.responses) {
            return parsedResponse;
        }
        var responseSpec = getOperationResponse(parsedResponse);
        var _a = handleErrorResponse(parsedResponse, operationSpec, responseSpec), error = _a.error, shouldReturnResponse = _a.shouldReturnResponse;
        if (error) {
            throw error;
        }
        else if (shouldReturnResponse) {
            return parsedResponse;
        }
        // An operation response spec does exist for current status code, so
        // use it to deserialize the response.
        if (responseSpec) {
            if (responseSpec.bodyMapper) {
                var valueToDeserialize = parsedResponse.parsedBody;
                if (operationSpec.isXML && responseSpec.bodyMapper.type.name === _serializer__WEBPACK_IMPORTED_MODULE_3__["MapperType"].Sequence) {
                    valueToDeserialize =
                        typeof valueToDeserialize === "object"
                            ? valueToDeserialize[responseSpec.bodyMapper.xmlElementName]
                            : [];
                }
                try {
                    parsedResponse.parsedBody = operationSpec.serializer.deserialize(responseSpec.bodyMapper, valueToDeserialize, "operationRes.parsedBody", options);
                }
                catch (error) {
                    var restError = new _restError__WEBPACK_IMPORTED_MODULE_2__["RestError"]("Error " + error + " occurred in deserializing the responseBody - " + parsedResponse.bodyAsText, undefined, parsedResponse.status, parsedResponse.request, parsedResponse);
                    throw restError;
                }
            }
            else if (operationSpec.httpMethod === "HEAD") {
                // head methods never have a body, but we return a boolean to indicate presence/absence of the resource
                parsedResponse.parsedBody = response.status >= 200 && response.status < 300;
            }
            if (responseSpec.headersMapper) {
                parsedResponse.parsedHeaders = operationSpec.serializer.deserialize(responseSpec.headersMapper, parsedResponse.headers.rawHeaders(), "operationRes.parsedHeaders", options);
            }
        }
        return parsedResponse;
    });
}
function isOperationSpecEmpty(operationSpec) {
    var expectedStatusCodes = Object.keys(operationSpec.responses);
    return (expectedStatusCodes.length === 0 ||
        (expectedStatusCodes.length === 1 && expectedStatusCodes[0] === "default"));
}
function handleErrorResponse(parsedResponse, operationSpec, responseSpec) {
    var isSuccessByStatus = 200 <= parsedResponse.status && parsedResponse.status < 300;
    var isExpectedStatusCode = isOperationSpecEmpty(operationSpec)
        ? isSuccessByStatus
        : !!responseSpec;
    if (isExpectedStatusCode) {
        if (responseSpec) {
            if (!responseSpec.isError) {
                return { error: null, shouldReturnResponse: false };
            }
        }
        else {
            return { error: null, shouldReturnResponse: false };
        }
    }
    var errorResponseSpec = responseSpec !== null && responseSpec !== void 0 ? responseSpec : operationSpec.responses.default;
    var initialErrorMessage = Object(_operationSpec__WEBPACK_IMPORTED_MODULE_1__["isStreamOperation"])(operationSpec)
        ? "Unexpected status code: " + parsedResponse.status
        : parsedResponse.bodyAsText;
    var error = new _restError__WEBPACK_IMPORTED_MODULE_2__["RestError"](initialErrorMessage, undefined, parsedResponse.status, parsedResponse.request, parsedResponse);
    // If the item failed but there's no error spec or default spec to deserialize the error,
    // we should fail so we just throw the parsed response
    if (!errorResponseSpec) {
        throw error;
    }
    var defaultBodyMapper = errorResponseSpec.bodyMapper;
    var defaultHeadersMapper = errorResponseSpec.headersMapper;
    try {
        // If error response has a body, try to deserialize it using default body mapper.
        // Then try to extract error code & message from it
        if (parsedResponse.parsedBody) {
            var parsedBody = parsedResponse.parsedBody;
            var parsedError = void 0;
            if (defaultBodyMapper) {
                var valueToDeserialize = parsedBody;
                if (operationSpec.isXML && defaultBodyMapper.type.name === _serializer__WEBPACK_IMPORTED_MODULE_3__["MapperType"].Sequence) {
                    valueToDeserialize =
                        typeof parsedBody === "object" ? parsedBody[defaultBodyMapper.xmlElementName] : [];
                }
                parsedError = operationSpec.serializer.deserialize(defaultBodyMapper, valueToDeserialize, "error.response.parsedBody");
            }
            var internalError = parsedBody.error || parsedError || parsedBody;
            error.code = internalError.code;
            if (internalError.message) {
                error.message = internalError.message;
            }
            if (defaultBodyMapper) {
                error.response.parsedBody = parsedError;
            }
        }
        // If error response has headers, try to deserialize it using default header mapper
        if (parsedResponse.headers && defaultHeadersMapper) {
            error.response.parsedHeaders = operationSpec.serializer.deserialize(defaultHeadersMapper, parsedResponse.headers.rawHeaders(), "operationRes.parsedHeaders");
        }
    }
    catch (defaultError) {
        error.message = "Error \"" + defaultError.message + "\" occurred in deserializing the responseBody - \"" + parsedResponse.bodyAsText + "\" for the default response.";
    }
    return { error: error, shouldReturnResponse: false };
}
function parse(jsonContentTypes, xmlContentTypes, operationResponse, opts) {
    var errorHandler = function (err) {
        var msg = "Error \"" + err + "\" occurred while parsing the response body - " + operationResponse.bodyAsText + ".";
        var errCode = err.code || _restError__WEBPACK_IMPORTED_MODULE_2__["RestError"].PARSE_ERROR;
        var e = new _restError__WEBPACK_IMPORTED_MODULE_2__["RestError"](msg, errCode, operationResponse.status, operationResponse.request, operationResponse);
        return Promise.reject(e);
    };
    if (!operationResponse.request.streamResponseBody && operationResponse.bodyAsText) {
        var text_1 = operationResponse.bodyAsText;
        var contentType = operationResponse.headers.get("Content-Type") || "";
        var contentComponents = !contentType
            ? []
            : contentType.split(";").map(function (component) { return component.toLowerCase(); });
        if (contentComponents.length === 0 ||
            contentComponents.some(function (component) { return jsonContentTypes.indexOf(component) !== -1; })) {
            return new Promise(function (resolve) {
                operationResponse.parsedBody = JSON.parse(text_1);
                resolve(operationResponse);
            }).catch(errorHandler);
        }
        else if (contentComponents.some(function (component) { return xmlContentTypes.indexOf(component) !== -1; })) {
            return Object(_util_xml__WEBPACK_IMPORTED_MODULE_4__["parseXML"])(text_1, opts)
                .then(function (body) {
                operationResponse.parsedBody = body;
                return operationResponse;
            })
                .catch(errorHandler);
        }
    }
    return Promise.resolve(operationResponse);
}
//# sourceMappingURL=deserializationPolicy.js.map

/***/ }),
/* 64 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "parseXML", function() { return parseXML; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "stringifyXML", function() { return stringifyXML; });
/* harmony import */ var _serializer_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(37);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

// tslint:disable-next-line:no-null-keyword
var doc = document.implementation.createDocument(null, null, null);
var parser = new DOMParser();
function parseXML(str, opts) {
    var _a, _b, _c;
    if (opts === void 0) { opts = {}; }
    try {
        var updatedOptions = {
            rootName: (_a = opts.rootName) !== null && _a !== void 0 ? _a : "",
            includeRoot: (_b = opts.includeRoot) !== null && _b !== void 0 ? _b : false,
            xmlCharKey: (_c = opts.xmlCharKey) !== null && _c !== void 0 ? _c : _serializer_common__WEBPACK_IMPORTED_MODULE_0__["XML_CHARKEY"]
        };
        var dom = parser.parseFromString(str, "application/xml");
        throwIfError(dom);
        var obj = void 0;
        if (updatedOptions.includeRoot) {
            obj = domToObject(dom, updatedOptions);
        }
        else {
            obj = domToObject(dom.childNodes[0], updatedOptions);
        }
        return Promise.resolve(obj);
    }
    catch (err) {
        return Promise.reject(err);
    }
}
var errorNS = "";
try {
    errorNS = parser.parseFromString("INVALID", "text/xml").getElementsByTagName("parsererror")[0]
        .namespaceURI;
}
catch (ignored) {
    // Most browsers will return a document containing <parsererror>, but IE will throw.
}
function throwIfError(dom) {
    if (errorNS) {
        var parserErrors = dom.getElementsByTagNameNS(errorNS, "parsererror");
        if (parserErrors.length) {
            throw new Error(parserErrors.item(0).innerHTML);
        }
    }
}
function isElement(node) {
    return !!node.attributes;
}
/**
 * Get the Element-typed version of the provided Node if the provided node is an element with
 * attributes. If it isn't, then undefined is returned.
 */
function asElementWithAttributes(node) {
    return isElement(node) && node.hasAttributes() ? node : undefined;
}
function domToObject(node, options) {
    var result = {};
    var childNodeCount = node.childNodes.length;
    var firstChildNode = node.childNodes[0];
    var onlyChildTextValue = (firstChildNode &&
        childNodeCount === 1 &&
        firstChildNode.nodeType === Node.TEXT_NODE &&
        firstChildNode.nodeValue) ||
        undefined;
    var elementWithAttributes = asElementWithAttributes(node);
    if (elementWithAttributes) {
        result[_serializer_common__WEBPACK_IMPORTED_MODULE_0__["XML_ATTRKEY"]] = {};
        for (var i = 0; i < elementWithAttributes.attributes.length; i++) {
            var attr = elementWithAttributes.attributes[i];
            result[_serializer_common__WEBPACK_IMPORTED_MODULE_0__["XML_ATTRKEY"]][attr.nodeName] = attr.nodeValue;
        }
        if (onlyChildTextValue) {
            result[options.xmlCharKey] = onlyChildTextValue;
        }
    }
    else if (childNodeCount === 0) {
        result = "";
    }
    else if (onlyChildTextValue) {
        result = onlyChildTextValue;
    }
    if (!onlyChildTextValue) {
        for (var i = 0; i < childNodeCount; i++) {
            var child = node.childNodes[i];
            // Ignore leading/trailing whitespace nodes
            if (child.nodeType !== Node.TEXT_NODE) {
                var childObject = domToObject(child, options);
                if (!result[child.nodeName]) {
                    result[child.nodeName] = childObject;
                }
                else if (Array.isArray(result[child.nodeName])) {
                    result[child.nodeName].push(childObject);
                }
                else {
                    result[child.nodeName] = [result[child.nodeName], childObject];
                }
            }
        }
    }
    return result;
}
var serializer = new XMLSerializer();
function stringifyXML(content, opts) {
    var _a, _b, _c;
    if (opts === void 0) { opts = {}; }
    var updatedOptions = {
        rootName: (_a = opts.rootName) !== null && _a !== void 0 ? _a : "root",
        includeRoot: (_b = opts.includeRoot) !== null && _b !== void 0 ? _b : false,
        xmlCharKey: (_c = opts.xmlCharKey) !== null && _c !== void 0 ? _c : _serializer_common__WEBPACK_IMPORTED_MODULE_0__["XML_CHARKEY"]
    };
    var dom = buildNode(content, updatedOptions.rootName, updatedOptions)[0];
    return ('<?xml version="1.0" encoding="UTF-8" standalone="yes"?>' + serializer.serializeToString(dom));
}
function buildAttributes(attrs) {
    var result = [];
    for (var _i = 0, _a = Object.keys(attrs); _i < _a.length; _i++) {
        var key = _a[_i];
        var attr = doc.createAttribute(key);
        attr.value = attrs[key].toString();
        result.push(attr);
    }
    return result;
}
function buildNode(obj, elementName, options) {
    if (obj === undefined ||
        obj === null ||
        typeof obj === "string" ||
        typeof obj === "number" ||
        typeof obj === "boolean") {
        var elem = doc.createElement(elementName);
        elem.textContent = obj === undefined || obj === null ? "" : obj.toString();
        return [elem];
    }
    else if (Array.isArray(obj)) {
        var result = [];
        for (var _i = 0, obj_1 = obj; _i < obj_1.length; _i++) {
            var arrayElem = obj_1[_i];
            for (var _a = 0, _b = buildNode(arrayElem, elementName, options); _a < _b.length; _a++) {
                var child = _b[_a];
                result.push(child);
            }
        }
        return result;
    }
    else if (typeof obj === "object") {
        var elem = doc.createElement(elementName);
        for (var _c = 0, _d = Object.keys(obj); _c < _d.length; _c++) {
            var key = _d[_c];
            if (key === _serializer_common__WEBPACK_IMPORTED_MODULE_0__["XML_ATTRKEY"]) {
                for (var _e = 0, _f = buildAttributes(obj[key]); _e < _f.length; _e++) {
                    var attr = _f[_e];
                    elem.attributes.setNamedItem(attr);
                }
            }
            else if (key === options.xmlCharKey) {
                elem.textContent = obj[key].toString();
            }
            else {
                for (var _g = 0, _h = buildNode(obj[key], key, options); _g < _h.length; _g++) {
                    var child = _h[_g];
                    elem.appendChild(child);
                }
            }
        }
        return [elem];
    }
    else {
        throw new Error("Illegal value passed to buildObject: " + obj);
    }
}
//# sourceMappingURL=xml.browser.js.map

/***/ }),
/* 65 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "exponentialRetryPolicy", function() { return exponentialRetryPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RetryMode", function() { return RetryMode; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DefaultRetryOptions", function() { return DefaultRetryOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ExponentialRetryPolicy", function() { return ExponentialRetryPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(19);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(56);
/* harmony import */ var _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(66);
/* harmony import */ var _restError__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(44);
/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(57);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.






function exponentialRetryPolicy(retryCount, retryInterval, maxRetryInterval) {
    return {
        create: function (nextPolicy, options) {
            return new ExponentialRetryPolicy(nextPolicy, options, retryCount, retryInterval, maxRetryInterval);
        }
    };
}
/**
 * Describes the Retry Mode type. Currently supporting only Exponential.
 * @enum RetryMode
 */
var RetryMode;
(function (RetryMode) {
    RetryMode[RetryMode["Exponential"] = 0] = "Exponential";
})(RetryMode || (RetryMode = {}));
var DefaultRetryOptions = {
    maxRetries: _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_RETRY_COUNT"],
    retryDelayInMs: _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_RETRY_INTERVAL"],
    maxRetryDelayInMs: _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_MAX_RETRY_INTERVAL"]
};
/**
 * @class
 * Instantiates a new "ExponentialRetryPolicyFilter" instance.
 */
var ExponentialRetryPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(ExponentialRetryPolicy, _super);
    /**
     * @constructor
     * @param {RequestPolicy} nextPolicy The next RequestPolicy in the pipeline chain.
     * @param {RequestPolicyOptions} options The options for this RequestPolicy.
     * @param {number} [retryCount]        The client retry count.
     * @param {number} [retryInterval]     The client retry interval, in milliseconds.
     * @param {number} [minRetryInterval]  The minimum retry interval, in milliseconds.
     * @param {number} [maxRetryInterval]  The maximum retry interval, in milliseconds.
     */
    function ExponentialRetryPolicy(nextPolicy, options, retryCount, retryInterval, maxRetryInterval) {
        var _this = _super.call(this, nextPolicy, options) || this;
        _this.retryCount = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["isNumber"])(retryCount) ? retryCount : _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_RETRY_COUNT"];
        _this.retryInterval = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["isNumber"])(retryInterval) ? retryInterval : _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_RETRY_INTERVAL"];
        _this.maxRetryInterval = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["isNumber"])(maxRetryInterval)
            ? maxRetryInterval
            : _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_MAX_RETRY_INTERVAL"];
        return _this;
    }
    ExponentialRetryPolicy.prototype.sendRequest = function (request) {
        var _this = this;
        return this._nextPolicy
            .sendRequest(request.clone())
            .then(function (response) { return retry(_this, request, response); })
            .catch(function (error) { return retry(_this, request, error.response, undefined, error); });
    };
    return ExponentialRetryPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_2__["BaseRequestPolicy"]));

function retry(policy, request, response, retryData, requestError) {
    return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
        function shouldPolicyRetry(response) {
            var statusCode = response === null || response === void 0 ? void 0 : response.status;
            if (statusCode === undefined ||
                (statusCode < 500 && statusCode !== 408) ||
                statusCode === 501 ||
                statusCode === 505) {
                return false;
            }
            return true;
        }
        var isAborted, res, err_1, err;
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
            switch (_a.label) {
                case 0:
                    retryData = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["updateRetryData"])({
                        retryInterval: policy.retryInterval,
                        minRetryInterval: 0,
                        maxRetryInterval: policy.maxRetryInterval
                    }, retryData, requestError);
                    isAborted = request.abortSignal && request.abortSignal.aborted;
                    if (!(!isAborted && Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["shouldRetry"])(policy.retryCount, shouldPolicyRetry, retryData, response))) return [3 /*break*/, 6];
                    _log__WEBPACK_IMPORTED_MODULE_5__["logger"].info("Retrying request in " + retryData.retryInterval);
                    _a.label = 1;
                case 1:
                    _a.trys.push([1, 4, , 5]);
                    return [4 /*yield*/, _util_utils__WEBPACK_IMPORTED_MODULE_1__["delay"](retryData.retryInterval)];
                case 2:
                    _a.sent();
                    return [4 /*yield*/, policy._nextPolicy.sendRequest(request.clone())];
                case 3:
                    res = _a.sent();
                    return [2 /*return*/, retry(policy, request, res, retryData)];
                case 4:
                    err_1 = _a.sent();
                    return [2 /*return*/, retry(policy, request, response, retryData, err_1)];
                case 5: return [3 /*break*/, 7];
                case 6:
                    if (isAborted || requestError || !response) {
                        err = retryData.error ||
                            new _restError__WEBPACK_IMPORTED_MODULE_4__["RestError"]("Failed to send the request.", _restError__WEBPACK_IMPORTED_MODULE_4__["RestError"].REQUEST_SEND_ERROR, response && response.status, response && response.request, response);
                        throw err;
                    }
                    else {
                        return [2 /*return*/, response];
                    }
                    _a.label = 7;
                case 7: return [2 /*return*/];
            }
        });
    });
}
//# sourceMappingURL=exponentialRetryPolicy.js.map

/***/ }),
/* 66 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEFAULT_CLIENT_RETRY_COUNT", function() { return DEFAULT_CLIENT_RETRY_COUNT; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEFAULT_CLIENT_RETRY_INTERVAL", function() { return DEFAULT_CLIENT_RETRY_INTERVAL; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEFAULT_CLIENT_MAX_RETRY_INTERVAL", function() { return DEFAULT_CLIENT_MAX_RETRY_INTERVAL; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEFAULT_CLIENT_MIN_RETRY_INTERVAL", function() { return DEFAULT_CLIENT_MIN_RETRY_INTERVAL; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isNumber", function() { return isNumber; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "shouldRetry", function() { return shouldRetry; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "updateRetryData", function() { return updateRetryData; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
var DEFAULT_CLIENT_RETRY_COUNT = 3;
// intervals are in ms
var DEFAULT_CLIENT_RETRY_INTERVAL = 1000 * 30;
var DEFAULT_CLIENT_MAX_RETRY_INTERVAL = 1000 * 90;
var DEFAULT_CLIENT_MIN_RETRY_INTERVAL = 1000 * 3;
function isNumber(n) {
    return typeof n === "number";
}
/**
 * @internal
 * Determines if the operation should be retried.
 *
 * @param {number} retryLimit Specifies the max number of retries.
 * @param {(response?: HttpOperationResponse, error?: RetryError) => boolean} predicate Initial chekck on whether to retry based on given responses or errors
 * @param {RetryData} retryData  The retry data.
 * @return {boolean} True if the operation qualifies for a retry; false otherwise.
 */
function shouldRetry(retryLimit, predicate, retryData, response, error) {
    if (!predicate(response, error)) {
        return false;
    }
    return retryData.retryCount < retryLimit;
}
/**
 * @internal
 * Updates the retry data for the next attempt.
 *
 * @param {RetryPolicyOptions} retryOptions specifies retry interval, and its lower bound and upper bound.
 * @param {RetryData} [retryData]  The retry data.
 * @param {RetryError} [err] The operation"s error, if any.
 */
function updateRetryData(retryOptions, retryData, err) {
    if (retryData === void 0) { retryData = { retryCount: 0, retryInterval: 0 }; }
    if (err) {
        if (retryData.error) {
            err.innerError = retryData.error;
        }
        retryData.error = err;
    }
    // Adjust retry count
    retryData.retryCount++;
    // Adjust retry interval
    var incrementDelta = Math.pow(2, retryData.retryCount - 1) - 1;
    var boundedRandDelta = retryOptions.retryInterval * 0.8 +
        Math.floor(Math.random() * (retryOptions.retryInterval * 0.4));
    incrementDelta *= boundedRandDelta;
    retryData.retryInterval = Math.min(retryOptions.minRetryInterval + incrementDelta, retryOptions.maxRetryInterval);
    return retryData;
}
//# sourceMappingURL=exponentialBackoffStrategy.js.map

/***/ }),
/* 67 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "generateClientRequestIdPolicy", function() { return generateClientRequestIdPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "GenerateClientRequestIdPolicy", function() { return GenerateClientRequestIdPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


function generateClientRequestIdPolicy(requestIdHeaderName) {
    if (requestIdHeaderName === void 0) { requestIdHeaderName = "x-ms-client-request-id"; }
    return {
        create: function (nextPolicy, options) {
            return new GenerateClientRequestIdPolicy(nextPolicy, options, requestIdHeaderName);
        }
    };
}
var GenerateClientRequestIdPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(GenerateClientRequestIdPolicy, _super);
    function GenerateClientRequestIdPolicy(nextPolicy, options, _requestIdHeaderName) {
        var _this = _super.call(this, nextPolicy, options) || this;
        _this._requestIdHeaderName = _requestIdHeaderName;
        return _this;
    }
    GenerateClientRequestIdPolicy.prototype.sendRequest = function (request) {
        if (!request.headers.contains(this._requestIdHeaderName)) {
            request.headers.set(this._requestIdHeaderName, request.requestId);
        }
        return this._nextPolicy.sendRequest(request);
    };
    return GenerateClientRequestIdPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));

//# sourceMappingURL=generateClientRequestIdPolicy.js.map

/***/ }),
/* 68 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getDefaultUserAgentHeaderName", function() { return getDefaultUserAgentHeaderName; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getDefaultUserAgentValue", function() { return getDefaultUserAgentValue; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "userAgentPolicy", function() { return userAgentPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "UserAgentPolicy", function() { return UserAgentPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(15);
/* harmony import */ var _util_constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(36);
/* harmony import */ var _msRestUserAgentPolicy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(69);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.





function getRuntimeInfo() {
    var msRestRuntime = {
        key: "core-http",
        value: _util_constants__WEBPACK_IMPORTED_MODULE_2__["Constants"].coreHttpVersion
    };
    return [msRestRuntime];
}
function getUserAgentString(telemetryInfo, keySeparator, valueSeparator) {
    if (keySeparator === void 0) { keySeparator = " "; }
    if (valueSeparator === void 0) { valueSeparator = "/"; }
    return telemetryInfo
        .map(function (info) {
        var value = info.value ? "" + valueSeparator + info.value : "";
        return "" + info.key + value;
    })
        .join(keySeparator);
}
var getDefaultUserAgentHeaderName = _msRestUserAgentPolicy__WEBPACK_IMPORTED_MODULE_3__["getDefaultUserAgentKey"];
function getDefaultUserAgentValue() {
    var runtimeInfo = getRuntimeInfo();
    var platformSpecificData = Object(_msRestUserAgentPolicy__WEBPACK_IMPORTED_MODULE_3__["getPlatformSpecificData"])();
    var userAgent = getUserAgentString(runtimeInfo.concat(platformSpecificData));
    return userAgent;
}
function userAgentPolicy(userAgentData) {
    var key = !userAgentData || userAgentData.key === undefined || userAgentData.key === null
        ? Object(_msRestUserAgentPolicy__WEBPACK_IMPORTED_MODULE_3__["getDefaultUserAgentKey"])()
        : userAgentData.key;
    var value = !userAgentData || userAgentData.value === undefined || userAgentData.value === null
        ? getDefaultUserAgentValue()
        : userAgentData.value;
    return {
        create: function (nextPolicy, options) {
            return new UserAgentPolicy(nextPolicy, options, key, value);
        }
    };
}
var UserAgentPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(UserAgentPolicy, _super);
    function UserAgentPolicy(_nextPolicy, _options, headerKey, headerValue) {
        var _this = _super.call(this, _nextPolicy, _options) || this;
        _this._nextPolicy = _nextPolicy;
        _this._options = _options;
        _this.headerKey = headerKey;
        _this.headerValue = headerValue;
        return _this;
    }
    UserAgentPolicy.prototype.sendRequest = function (request) {
        this.addUserAgentHeader(request);
        return this._nextPolicy.sendRequest(request);
    };
    UserAgentPolicy.prototype.addUserAgentHeader = function (request) {
        if (!request.headers) {
            request.headers = new _httpHeaders__WEBPACK_IMPORTED_MODULE_1__["HttpHeaders"]();
        }
        if (!request.headers.get(this.headerKey) && this.headerValue) {
            request.headers.set(this.headerKey, this.headerValue);
        }
    };
    return UserAgentPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_4__["BaseRequestPolicy"]));

//# sourceMappingURL=userAgentPolicy.js.map

/***/ }),
/* 69 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getDefaultUserAgentKey", function() { return getDefaultUserAgentKey; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getPlatformSpecificData", function() { return getPlatformSpecificData; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
function getDefaultUserAgentKey() {
    return "x-ms-useragent";
}
function getPlatformSpecificData() {
    var navigator = window.navigator;
    var osInfo = {
        key: "OS",
        value: (navigator.oscpu || navigator.platform).replace(" ", "")
    };
    return [osInfo];
}
//# sourceMappingURL=msRestUserAgentPolicy.browser.js.map

/***/ }),
/* 70 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DefaultRedirectOptions", function() { return DefaultRedirectOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "redirectPolicy", function() { return redirectPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RedirectPolicy", function() { return RedirectPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _url__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(47);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



/**
 * Methods that are allowed to follow redirects 301 and 302
 */
var allowedRedirect = ["GET", "HEAD"];
var DefaultRedirectOptions = {
    handleRedirects: true,
    maxRetries: 20
};
function redirectPolicy(maximumRetries) {
    if (maximumRetries === void 0) { maximumRetries = 20; }
    return {
        create: function (nextPolicy, options) {
            return new RedirectPolicy(nextPolicy, options, maximumRetries);
        }
    };
}
var RedirectPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(RedirectPolicy, _super);
    function RedirectPolicy(nextPolicy, options, maxRetries) {
        if (maxRetries === void 0) { maxRetries = 20; }
        var _this = _super.call(this, nextPolicy, options) || this;
        _this.maxRetries = maxRetries;
        return _this;
    }
    RedirectPolicy.prototype.sendRequest = function (request) {
        var _this = this;
        return this._nextPolicy
            .sendRequest(request)
            .then(function (response) { return handleRedirect(_this, response, 0); });
    };
    return RedirectPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_2__["BaseRequestPolicy"]));

function handleRedirect(policy, response, currentRetries) {
    var request = response.request, status = response.status;
    var locationHeader = response.headers.get("location");
    if (locationHeader &&
        (status === 300 ||
            (status === 301 && allowedRedirect.includes(request.method)) ||
            (status === 302 && allowedRedirect.includes(request.method)) ||
            (status === 303 && request.method === "POST") ||
            status === 307) &&
        (!policy.maxRetries || currentRetries < policy.maxRetries)) {
        var builder = _url__WEBPACK_IMPORTED_MODULE_1__["URLBuilder"].parse(request.url);
        builder.setPath(locationHeader);
        request.url = builder.toString();
        // POST request with Status code 303 should be converted into a
        // redirected GET request if the redirect url is present in the location header
        if (status === 303) {
            request.method = "GET";
            delete request.body;
        }
        return policy._nextPolicy
            .sendRequest(request)
            .then(function (res) { return handleRedirect(policy, res, currentRetries + 1); });
    }
    return Promise.resolve(response);
}
//# sourceMappingURL=redirectPolicy.js.map

/***/ }),
/* 71 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "rpRegistrationPolicy", function() { return rpRegistrationPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RPRegistrationPolicy", function() { return RPRegistrationPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(19);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



function rpRegistrationPolicy(retryTimeout) {
    if (retryTimeout === void 0) { retryTimeout = 30; }
    return {
        create: function (nextPolicy, options) {
            return new RPRegistrationPolicy(nextPolicy, options, retryTimeout);
        }
    };
}
var RPRegistrationPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(RPRegistrationPolicy, _super);
    function RPRegistrationPolicy(nextPolicy, options, _retryTimeout) {
        if (_retryTimeout === void 0) { _retryTimeout = 30; }
        var _this = _super.call(this, nextPolicy, options) || this;
        _this._retryTimeout = _retryTimeout;
        return _this;
    }
    RPRegistrationPolicy.prototype.sendRequest = function (request) {
        var _this = this;
        return this._nextPolicy
            .sendRequest(request.clone())
            .then(function (response) { return registerIfNeeded(_this, request, response); });
    };
    return RPRegistrationPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_2__["BaseRequestPolicy"]));

function registerIfNeeded(policy, request, response) {
    if (response.status === 409) {
        var rpName = checkRPNotRegisteredError(response.bodyAsText);
        if (rpName) {
            var urlPrefix = extractSubscriptionUrl(request.url);
            return (registerRP(policy, urlPrefix, rpName, request)
                // Autoregistration of ${provider} failed for some reason. We will not return this error
                // instead will return the initial response with 409 status code back to the user.
                // do nothing here as we are returning the original response at the end of this method.
                .catch(function () { return false; })
                .then(function (registrationStatus) {
                if (registrationStatus) {
                    // Retry the original request. We have to change the x-ms-client-request-id
                    // otherwise Azure endpoint will return the initial 409 (cached) response.
                    request.headers.set("x-ms-client-request-id", _util_utils__WEBPACK_IMPORTED_MODULE_1__["generateUuid"]());
                    return policy._nextPolicy.sendRequest(request.clone());
                }
                return response;
            }));
        }
    }
    return Promise.resolve(response);
}
/**
 * Reuses the headers of the original request and url (if specified).
 * @param {WebResourceLike} originalRequest The original request
 * @param {boolean} reuseUrlToo Should the url from the original request be reused as well. Default false.
 * @returns {object} A new request object with desired headers.
 */
function getRequestEssentials(originalRequest, reuseUrlToo) {
    if (reuseUrlToo === void 0) { reuseUrlToo = false; }
    var reqOptions = originalRequest.clone();
    if (reuseUrlToo) {
        reqOptions.url = originalRequest.url;
    }
    // We have to change the x-ms-client-request-id otherwise Azure endpoint
    // will return the initial 409 (cached) response.
    reqOptions.headers.set("x-ms-client-request-id", _util_utils__WEBPACK_IMPORTED_MODULE_1__["generateUuid"]());
    // Set content-type to application/json
    reqOptions.headers.set("Content-Type", "application/json; charset=utf-8");
    return reqOptions;
}
/**
 * Validates the error code and message associated with 409 response status code. If it matches to that of
 * RP not registered then it returns the name of the RP else returns undefined.
 * @param {string} body The response body received after making the original request.
 * @returns {string} The name of the RP if condition is satisfied else undefined.
 */
function checkRPNotRegisteredError(body) {
    var result, responseBody;
    if (body) {
        try {
            responseBody = JSON.parse(body);
        }
        catch (err) {
            // do nothing;
        }
        if (responseBody &&
            responseBody.error &&
            responseBody.error.message &&
            responseBody.error.code &&
            responseBody.error.code === "MissingSubscriptionRegistration") {
            var matchRes = responseBody.error.message.match(/.*'(.*)'/i);
            if (matchRes) {
                result = matchRes.pop();
            }
        }
    }
    return result;
}
/**
 * Extracts the first part of the URL, just after subscription:
 * https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/
 * @param {string} url The original request url
 * @returns {string} The url prefix as explained above.
 */
function extractSubscriptionUrl(url) {
    var result;
    var matchRes = url.match(/.*\/subscriptions\/[a-f0-9-]+\//gi);
    if (matchRes && matchRes[0]) {
        result = matchRes[0];
    }
    else {
        throw new Error("Unable to extract subscriptionId from the given url - " + url + ".");
    }
    return result;
}
/**
 * Registers the given provider.
 * @param {RPRegistrationPolicy} policy The RPRegistrationPolicy this function is being called against.
 * @param {string} urlPrefix https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/
 * @param {string} provider The provider name to be registered.
 * @param {WebResourceLike} originalRequest The original request sent by the user that returned a 409 response
 * with a message that the provider is not registered.
 * @param {registrationCallback} callback The callback that handles the RP registration
 */
function registerRP(policy, urlPrefix, provider, originalRequest) {
    var postUrl = urlPrefix + "providers/" + provider + "/register?api-version=2016-02-01";
    var getUrl = urlPrefix + "providers/" + provider + "?api-version=2016-02-01";
    var reqOptions = getRequestEssentials(originalRequest);
    reqOptions.method = "POST";
    reqOptions.url = postUrl;
    return policy._nextPolicy.sendRequest(reqOptions).then(function (response) {
        if (response.status !== 200) {
            throw new Error("Autoregistration of " + provider + " failed. Please try registering manually.");
        }
        return getRegistrationStatus(policy, getUrl, originalRequest);
    });
}
/**
 * Polls the registration status of the provider that was registered. Polling happens at an interval of 30 seconds.
 * Polling will happen till the registrationState property of the response body is "Registered".
 * @param {RPRegistrationPolicy} policy The RPRegistrationPolicy this function is being called against.
 * @param {string} url The request url for polling
 * @param {WebResourceLike} originalRequest The original request sent by the user that returned a 409 response
 * with a message that the provider is not registered.
 * @returns {Promise<boolean>} True if RP Registration is successful.
 */
function getRegistrationStatus(policy, url, originalRequest) {
    var reqOptions = getRequestEssentials(originalRequest);
    reqOptions.url = url;
    reqOptions.method = "GET";
    return policy._nextPolicy.sendRequest(reqOptions).then(function (res) {
        var obj = res.parsedBody;
        if (res.parsedBody && obj.registrationState && obj.registrationState === "Registered") {
            return true;
        }
        else {
            return _util_utils__WEBPACK_IMPORTED_MODULE_1__["delay"](policy._retryTimeout * 1000)
                .then(function () { return getRegistrationStatus(policy, url, originalRequest); });
        }
    });
}
//# sourceMappingURL=rpRegistrationPolicy.js.map

/***/ }),
/* 72 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "bearerTokenAuthenticationPolicy", function() { return bearerTokenAuthenticationPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BearerTokenAuthenticationPolicy", function() { return BearerTokenAuthenticationPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _policies_requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
/* harmony import */ var _util_constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(36);
/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(15);
/* harmony import */ var _credentials_accessTokenCache__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(73);
/* harmony import */ var _credentials_accessTokenRefresher__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(74);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.






/**
 * The automated token refresh will only start to happen at the
 * expiration date minus the value of timeBetweenRefreshAttemptsInMs,
 * which is by default 30 seconds.
 */
var timeBetweenRefreshAttemptsInMs = 30000;
/**
 * Creates a new BearerTokenAuthenticationPolicy factory.
 *
 * @param credential The TokenCredential implementation that can supply the bearer token.
 * @param scopes The scopes for which the bearer token applies.
 */
function bearerTokenAuthenticationPolicy(credential, scopes) {
    var tokenCache = new _credentials_accessTokenCache__WEBPACK_IMPORTED_MODULE_4__["ExpiringAccessTokenCache"]();
    var tokenRefresher = new _credentials_accessTokenRefresher__WEBPACK_IMPORTED_MODULE_5__["AccessTokenRefresher"](credential, scopes, timeBetweenRefreshAttemptsInMs);
    return {
        create: function (nextPolicy, options) {
            return new BearerTokenAuthenticationPolicy(nextPolicy, options, tokenCache, tokenRefresher);
        }
    };
}
/**
 *
 * Provides a RequestPolicy that can request a token from a TokenCredential
 * implementation and then apply it to the Authorization header of a request
 * as a Bearer token.
 *
 */
var BearerTokenAuthenticationPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(BearerTokenAuthenticationPolicy, _super);
    /**
     * Creates a new BearerTokenAuthenticationPolicy object.
     *
     * @param nextPolicy The next RequestPolicy in the request pipeline.
     * @param options Options for this RequestPolicy.
     * @param credential The TokenCredential implementation that can supply the bearer token.
     * @param scopes The scopes for which the bearer token applies.
     * @param tokenCache The cache for the most recent AccessToken returned from the TokenCredential.
     */
    function BearerTokenAuthenticationPolicy(nextPolicy, options, tokenCache, tokenRefresher) {
        var _this = _super.call(this, nextPolicy, options) || this;
        _this.tokenCache = tokenCache;
        _this.tokenRefresher = tokenRefresher;
        return _this;
    }
    /**
     * Applies the Bearer token to the request through the Authorization header.
     * @param webResource
     */
    BearerTokenAuthenticationPolicy.prototype.sendRequest = function (webResource) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var token;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!webResource.headers)
                            webResource.headers = new _httpHeaders__WEBPACK_IMPORTED_MODULE_3__["HttpHeaders"]();
                        return [4 /*yield*/, this.getToken({
                                abortSignal: webResource.abortSignal,
                                tracingOptions: {
                                    spanOptions: webResource.spanOptions
                                }
                            })];
                    case 1:
                        token = _a.sent();
                        webResource.headers.set(_util_constants__WEBPACK_IMPORTED_MODULE_2__["Constants"].HeaderConstants.AUTHORIZATION, "Bearer " + token);
                        return [2 /*return*/, this._nextPolicy.sendRequest(webResource)];
                }
            });
        });
    };
    /**
     * Attempts a token update if any other time related conditionals have been reached based on the tokenRefresher class.
     */
    BearerTokenAuthenticationPolicy.prototype.updateTokenIfNeeded = function (options) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var accessToken;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.tokenRefresher.isReady()) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.tokenRefresher.refresh(options)];
                    case 1:
                        accessToken = _a.sent();
                        this.tokenCache.setCachedToken(accessToken);
                        _a.label = 2;
                    case 2: return [2 /*return*/];
                }
            });
        });
    };
    BearerTokenAuthenticationPolicy.prototype.getToken = function (options) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var accessToken;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        accessToken = this.tokenCache.getCachedToken();
                        if (!(accessToken === undefined)) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.tokenRefresher.refresh(options)];
                    case 1:
                        // Waiting for the next refresh only if the cache is unable to retrieve the access token,
                        // which means that it has expired, or it has never been set.
                        accessToken = _a.sent();
                        this.tokenCache.setCachedToken(accessToken);
                        return [3 /*break*/, 3];
                    case 2:
                        // If we still have a cached access token,
                        // And any other time related conditionals have been reached based on the tokenRefresher class,
                        // then attempt to refresh without waiting.
                        this.updateTokenIfNeeded(options);
                        _a.label = 3;
                    case 3: return [2 /*return*/, accessToken ? accessToken.token : undefined];
                }
            });
        });
    };
    return BearerTokenAuthenticationPolicy;
}(_policies_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));

//# sourceMappingURL=bearerTokenAuthenticationPolicy.js.map

/***/ }),
/* 73 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TokenRefreshBufferMs", function() { return TokenRefreshBufferMs; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ExpiringAccessTokenCache", function() { return ExpiringAccessTokenCache; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * Defines the default token refresh buffer duration.
 */
var TokenRefreshBufferMs = 2 * 60 * 1000; // 2 Minutes
/**
 * Provides an {@link AccessTokenCache} implementation which clears
 * the cached {@link AccessToken}'s after the expiresOnTimestamp has
 * passed.
 */
var ExpiringAccessTokenCache = /** @class */ (function () {
    /**
     * Constructs an instance of {@link ExpiringAccessTokenCache} with
     * an optional expiration buffer time.
     */
    function ExpiringAccessTokenCache(tokenRefreshBufferMs) {
        if (tokenRefreshBufferMs === void 0) { tokenRefreshBufferMs = TokenRefreshBufferMs; }
        this.cachedToken = undefined;
        this.tokenRefreshBufferMs = tokenRefreshBufferMs;
    }
    ExpiringAccessTokenCache.prototype.setCachedToken = function (accessToken) {
        this.cachedToken = accessToken;
    };
    ExpiringAccessTokenCache.prototype.getCachedToken = function () {
        if (this.cachedToken &&
            Date.now() + this.tokenRefreshBufferMs >= this.cachedToken.expiresOnTimestamp) {
            this.cachedToken = undefined;
        }
        return this.cachedToken;
    };
    return ExpiringAccessTokenCache;
}());

//# sourceMappingURL=accessTokenCache.js.map

/***/ }),
/* 74 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AccessTokenRefresher", function() { return AccessTokenRefresher; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

/**
 * Helps the core-http token authentication policies with requesting a new token if we're not currently waiting for a new token.
 */
var AccessTokenRefresher = /** @class */ (function () {
    function AccessTokenRefresher(credential, scopes, requiredMillisecondsBeforeNewRefresh) {
        if (requiredMillisecondsBeforeNewRefresh === void 0) { requiredMillisecondsBeforeNewRefresh = 30000; }
        this.credential = credential;
        this.scopes = scopes;
        this.requiredMillisecondsBeforeNewRefresh = requiredMillisecondsBeforeNewRefresh;
        this.lastCalled = 0;
    }
    /**
     * Returns true if the required milliseconds(defaulted to 30000) have been passed signifying
     * that we are ready for a new refresh.
     *
     * @returns {boolean}
     */
    AccessTokenRefresher.prototype.isReady = function () {
        // We're only ready for a new refresh if the required milliseconds have passed.
        return (!this.lastCalled || Date.now() - this.lastCalled > this.requiredMillisecondsBeforeNewRefresh);
    };
    /**
     * Stores the time in which it is called,
     * then requests a new token,
     * then sets this.promise to undefined,
     * then returns the token.
     * @param options getToken options
     */
    AccessTokenRefresher.prototype.getToken = function (options) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var token;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.lastCalled = Date.now();
                        return [4 /*yield*/, this.credential.getToken(this.scopes, options)];
                    case 1:
                        token = _a.sent();
                        this.promise = undefined;
                        return [2 /*return*/, token || undefined];
                }
            });
        });
    };
    /**
     * Requests a new token if we're not currently waiting for a new token.
     * Returns null if the required time between each call hasn't been reached.
     * @param options getToken options
     */
    AccessTokenRefresher.prototype.refresh = function (options) {
        if (!this.promise) {
            this.promise = this.getToken(options);
        }
        return this.promise;
    };
    return AccessTokenRefresher;
}());

//# sourceMappingURL=accessTokenRefresher.js.map

/***/ }),
/* 75 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "systemErrorRetryPolicy", function() { return systemErrorRetryPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SystemErrorRetryPolicy", function() { return SystemErrorRetryPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(19);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(56);
/* harmony import */ var _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(66);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.




function systemErrorRetryPolicy(retryCount, retryInterval, minRetryInterval, maxRetryInterval) {
    return {
        create: function (nextPolicy, options) {
            return new SystemErrorRetryPolicy(nextPolicy, options, retryCount, retryInterval, minRetryInterval, maxRetryInterval);
        }
    };
}
/**
 * @class
 * Instantiates a new "ExponentialRetryPolicyFilter" instance.
 *
 * @constructor
 * @param {number} retryCount        The client retry count.
 * @param {number} retryInterval     The client retry interval, in milliseconds.
 * @param {number} minRetryInterval  The minimum retry interval, in milliseconds.
 * @param {number} maxRetryInterval  The maximum retry interval, in milliseconds.
 */
var SystemErrorRetryPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(SystemErrorRetryPolicy, _super);
    function SystemErrorRetryPolicy(nextPolicy, options, retryCount, retryInterval, minRetryInterval, maxRetryInterval) {
        var _this = _super.call(this, nextPolicy, options) || this;
        _this.retryCount = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["isNumber"])(retryCount) ? retryCount : _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_RETRY_COUNT"];
        _this.retryInterval = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["isNumber"])(retryInterval) ? retryInterval : _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_RETRY_INTERVAL"];
        _this.minRetryInterval = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["isNumber"])(minRetryInterval)
            ? minRetryInterval
            : _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_MIN_RETRY_INTERVAL"];
        _this.maxRetryInterval = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["isNumber"])(maxRetryInterval)
            ? maxRetryInterval
            : _util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["DEFAULT_CLIENT_MAX_RETRY_INTERVAL"];
        return _this;
    }
    SystemErrorRetryPolicy.prototype.sendRequest = function (request) {
        var _this = this;
        return this._nextPolicy
            .sendRequest(request.clone())
            .catch(function (error) { return retry(_this, request, error.response, error); });
    };
    return SystemErrorRetryPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_2__["BaseRequestPolicy"]));

function retry(policy, request, operationResponse, err, retryData) {
    return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
        function shouldPolicyRetry(_response, error) {
            if (error &&
                error.code &&
                (error.code === "ETIMEDOUT" ||
                    error.code === "ESOCKETTIMEDOUT" ||
                    error.code === "ECONNREFUSED" ||
                    error.code === "ECONNRESET" ||
                    error.code === "ENOENT")) {
                return true;
            }
            return false;
        }
        var err_1;
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
            switch (_a.label) {
                case 0:
                    retryData = Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["updateRetryData"])(policy, retryData, err);
                    if (!Object(_util_exponentialBackoffStrategy__WEBPACK_IMPORTED_MODULE_3__["shouldRetry"])(policy.retryCount, shouldPolicyRetry, retryData, operationResponse, err)) return [3 /*break*/, 5];
                    _a.label = 1;
                case 1:
                    _a.trys.push([1, 3, , 4]);
                    return [4 /*yield*/, _util_utils__WEBPACK_IMPORTED_MODULE_1__["delay"](retryData.retryInterval)];
                case 2:
                    _a.sent();
                    return [2 /*return*/, policy._nextPolicy.sendRequest(request.clone())];
                case 3:
                    err_1 = _a.sent();
                    return [2 /*return*/, retry(policy, request, operationResponse, err_1, retryData)];
                case 4: return [3 /*break*/, 6];
                case 5:
                    if (err) {
                        // If the operation failed in the end, return all errors instead of just the last one
                        return [2 /*return*/, Promise.reject(retryData.error)];
                    }
                    return [2 /*return*/, operationResponse];
                case 6: return [2 /*return*/];
            }
        });
    });
}
//# sourceMappingURL=systemErrorRetryPolicy.js.map

/***/ }),
/* 76 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QueryCollectionFormat", function() { return QueryCollectionFormat; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * The format that will be used to join an array of values together for a query parameter value.
 */
var QueryCollectionFormat;
(function (QueryCollectionFormat) {
    QueryCollectionFormat["Csv"] = ",";
    QueryCollectionFormat["Ssv"] = " ";
    QueryCollectionFormat["Tsv"] = "\t";
    QueryCollectionFormat["Pipes"] = "|";
    QueryCollectionFormat["Multi"] = "Multi";
})(QueryCollectionFormat || (QueryCollectionFormat = {}));
//# sourceMappingURL=queryCollectionFormat.js.map

/***/ }),
/* 77 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getDefaultProxySettings", function() { return getDefaultProxySettings; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "proxyPolicy", function() { return proxyPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ProxyPolicy", function() { return ProxyPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


var proxyNotSupportedInBrowser = new Error("ProxyPolicy is not supported in browser environment");
function getDefaultProxySettings(_proxyUrl) {
    return undefined;
}
function proxyPolicy(_proxySettings) {
    return {
        create: function (_nextPolicy, _options) {
            throw proxyNotSupportedInBrowser;
        }
    };
}
var ProxyPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(ProxyPolicy, _super);
    function ProxyPolicy(nextPolicy, options) {
        var _this = _super.call(this, nextPolicy, options) || this;
        throw proxyNotSupportedInBrowser;
        return _this;
    }
    ProxyPolicy.prototype.sendRequest = function (_request) {
        throw proxyNotSupportedInBrowser;
    };
    return ProxyPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));

//# sourceMappingURL=proxyPolicy.browser.js.map

/***/ }),
/* 78 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "throttlingRetryPolicy", function() { return throttlingRetryPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ThrottlingRetryPolicy", function() { return ThrottlingRetryPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
/* harmony import */ var _util_constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(36);
/* harmony import */ var _util_utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(19);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.




var StatusCodes = _util_constants__WEBPACK_IMPORTED_MODULE_2__["Constants"].HttpConstants.StatusCodes;
function throttlingRetryPolicy() {
    return {
        create: function (nextPolicy, options) {
            return new ThrottlingRetryPolicy(nextPolicy, options);
        }
    };
}
/**
 * To learn more, please refer to
 * https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-request-limits,
 * https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits and
 * https://docs.microsoft.com/en-us/azure/virtual-machines/troubleshooting/troubleshooting-throttling-errors
 */
var ThrottlingRetryPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(ThrottlingRetryPolicy, _super);
    function ThrottlingRetryPolicy(nextPolicy, options, _handleResponse) {
        var _this = _super.call(this, nextPolicy, options) || this;
        _this._handleResponse = _handleResponse || _this._defaultResponseHandler;
        return _this;
    }
    ThrottlingRetryPolicy.prototype.sendRequest = function (httpRequest) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var _this = this;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                return [2 /*return*/, this._nextPolicy.sendRequest(httpRequest.clone()).then(function (response) {
                        if (response.status !== StatusCodes.TooManyRequests) {
                            return response;
                        }
                        else {
                            return _this._handleResponse(httpRequest, response);
                        }
                    })];
            });
        });
    };
    ThrottlingRetryPolicy.prototype._defaultResponseHandler = function (httpRequest, httpResponse) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var retryAfterHeader, delayInMs;
            var _this = this;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                retryAfterHeader = httpResponse.headers.get(_util_constants__WEBPACK_IMPORTED_MODULE_2__["Constants"].HeaderConstants.RETRY_AFTER);
                if (retryAfterHeader) {
                    delayInMs = ThrottlingRetryPolicy.parseRetryAfterHeader(retryAfterHeader);
                    if (delayInMs) {
                        return [2 /*return*/, Object(_util_utils__WEBPACK_IMPORTED_MODULE_3__["delay"])(delayInMs).then(function (_) { return _this._nextPolicy.sendRequest(httpRequest); })];
                    }
                }
                return [2 /*return*/, httpResponse];
            });
        });
    };
    ThrottlingRetryPolicy.parseRetryAfterHeader = function (headerValue) {
        var retryAfterInSeconds = Number(headerValue);
        if (Number.isNaN(retryAfterInSeconds)) {
            return ThrottlingRetryPolicy.parseDateRetryAfterHeader(headerValue);
        }
        else {
            return retryAfterInSeconds * 1000;
        }
    };
    ThrottlingRetryPolicy.parseDateRetryAfterHeader = function (headerValue) {
        try {
            var now = Date.now();
            var date = Date.parse(headerValue);
            var diff = date - now;
            return Number.isNaN(diff) ? undefined : diff;
        }
        catch (error) {
            return undefined;
        }
    };
    return ThrottlingRetryPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));

//# sourceMappingURL=throttlingRetryPolicy.js.map

/***/ }),
/* 79 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "signingPolicy", function() { return signingPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SigningPolicy", function() { return SigningPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


function signingPolicy(authenticationProvider) {
    return {
        create: function (nextPolicy, options) {
            return new SigningPolicy(nextPolicy, options, authenticationProvider);
        }
    };
}
var SigningPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(SigningPolicy, _super);
    function SigningPolicy(nextPolicy, options, authenticationProvider) {
        var _this = _super.call(this, nextPolicy, options) || this;
        _this.authenticationProvider = authenticationProvider;
        return _this;
    }
    SigningPolicy.prototype.signRequest = function (request) {
        return this.authenticationProvider.signRequest(request);
    };
    SigningPolicy.prototype.sendRequest = function (request) {
        var _this = this;
        return this.signRequest(request).then(function (nextRequest) {
            return _this._nextPolicy.sendRequest(nextRequest);
        });
    };
    return SigningPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));

//# sourceMappingURL=signingPolicy.js.map

/***/ }),
/* 80 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DefaultKeepAliveOptions", function() { return DefaultKeepAliveOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "keepAlivePolicy", function() { return keepAlivePolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "KeepAlivePolicy", function() { return KeepAlivePolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


var DefaultKeepAliveOptions = {
    enable: true
};
function keepAlivePolicy(keepAliveOptions) {
    return {
        create: function (nextPolicy, options) {
            return new KeepAlivePolicy(nextPolicy, options, keepAliveOptions || DefaultKeepAliveOptions);
        }
    };
}
/**
 * KeepAlivePolicy is a policy used to control keep alive settings for every request.
 */
var KeepAlivePolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(KeepAlivePolicy, _super);
    /**
     * Creates an instance of KeepAlivePolicy.
     *
     * @param {RequestPolicy} nextPolicy
     * @param {RequestPolicyOptions} options
     * @param {KeepAliveOptions} [keepAliveOptions]
     */
    function KeepAlivePolicy(nextPolicy, options, keepAliveOptions) {
        var _this = _super.call(this, nextPolicy, options) || this;
        _this.keepAliveOptions = keepAliveOptions;
        return _this;
    }
    /**
     * Sends out request.
     *
     * @param {WebResourceLike} request
     * @returns {Promise<HttpOperationResponse>}
     * @memberof KeepAlivePolicy
     */
    KeepAlivePolicy.prototype.sendRequest = function (request) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                request.keepAlive = this.keepAliveOptions.enable;
                return [2 /*return*/, this._nextPolicy.sendRequest(request)];
            });
        });
    };
    return KeepAlivePolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));

//# sourceMappingURL=keepAlivePolicy.js.map

/***/ }),
/* 81 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "tracingPolicy", function() { return tracingPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TracingPolicy", function() { return TracingPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _azure_core_tracing__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(82);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(86);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_opentelemetry_api__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(56);
/* harmony import */ var _url__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(47);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.





function tracingPolicy(tracingOptions) {
    if (tracingOptions === void 0) { tracingOptions = {}; }
    return {
        create: function (nextPolicy, options) {
            return new TracingPolicy(nextPolicy, options, tracingOptions);
        }
    };
}
var TracingPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(TracingPolicy, _super);
    function TracingPolicy(nextPolicy, options, tracingOptions) {
        var _this = _super.call(this, nextPolicy, options) || this;
        _this.userAgent = tracingOptions.userAgent;
        return _this;
    }
    TracingPolicy.prototype.sendRequest = function (request) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var tracer, spanOptions, path, span, spanContext, traceParentHeader, traceState, response, serviceRequestId, err_1;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!request.spanOptions || !request.spanOptions.parent) {
                            return [2 /*return*/, this._nextPolicy.sendRequest(request)];
                        }
                        tracer = Object(_azure_core_tracing__WEBPACK_IMPORTED_MODULE_1__["getTracer"])();
                        spanOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, request.spanOptions), { kind: _opentelemetry_api__WEBPACK_IMPORTED_MODULE_2__["SpanKind"].CLIENT });
                        path = _url__WEBPACK_IMPORTED_MODULE_4__["URLBuilder"].parse(request.url).getPath() || "/";
                        span = tracer.startSpan(path, spanOptions);
                        span.setAttributes({
                            "http.method": request.method,
                            "http.url": request.url,
                            requestId: request.requestId
                        });
                        if (this.userAgent) {
                            span.setAttribute("http.user_agent", this.userAgent);
                        }
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        spanContext = span.context();
                        traceParentHeader = Object(_azure_core_tracing__WEBPACK_IMPORTED_MODULE_1__["getTraceParentHeader"])(spanContext);
                        if (traceParentHeader) {
                            request.headers.set("traceparent", traceParentHeader);
                            traceState = spanContext.traceState && spanContext.traceState.serialize();
                            // if tracestate is set, traceparent MUST be set, so only set tracestate after traceparent
                            if (traceState) {
                                request.headers.set("tracestate", traceState);
                            }
                        }
                        return [4 /*yield*/, this._nextPolicy.sendRequest(request)];
                    case 2:
                        response = _a.sent();
                        span.setAttribute("http.status_code", response.status);
                        serviceRequestId = response.headers.get("x-ms-request-id");
                        if (serviceRequestId) {
                            span.setAttribute("serviceRequestId", serviceRequestId);
                        }
                        span.end();
                        return [2 /*return*/, response];
                    case 3:
                        err_1 = _a.sent();
                        span.end();
                        throw err_1;
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    return TracingPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_3__["BaseRequestPolicy"]));

//# sourceMappingURL=tracingPolicy.js.map

/***/ }),
/* 82 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _tracerProxy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(83);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getTracer", function() { return _tracerProxy__WEBPACK_IMPORTED_MODULE_0__["getTracer"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "setTracer", function() { return _tracerProxy__WEBPACK_IMPORTED_MODULE_0__["setTracer"]; });

/* harmony import */ var _tracers_noop_noOpSpan__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(85);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NoOpSpan", function() { return _tracers_noop_noOpSpan__WEBPACK_IMPORTED_MODULE_1__["NoOpSpan"]; });

/* harmony import */ var _tracers_noop_noOpTracer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(84);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "NoOpTracer", function() { return _tracers_noop_noOpTracer__WEBPACK_IMPORTED_MODULE_2__["NoOpTracer"]; });

/* harmony import */ var _tracers_opencensus_openCensusSpanWrapper__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(137);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "OpenCensusSpanWrapper", function() { return _tracers_opencensus_openCensusSpanWrapper__WEBPACK_IMPORTED_MODULE_3__["OpenCensusSpanWrapper"]; });

/* harmony import */ var _tracers_opencensus_openCensusTracerWrapper__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(139);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "OpenCensusTracerWrapper", function() { return _tracers_opencensus_openCensusTracerWrapper__WEBPACK_IMPORTED_MODULE_4__["OpenCensusTracerWrapper"]; });

/* harmony import */ var _tracers_test_testTracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(140);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TestTracer", function() { return _tracers_test_testTracer__WEBPACK_IMPORTED_MODULE_5__["TestTracer"]; });

/* harmony import */ var _tracers_test_testSpan__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(141);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "TestSpan", function() { return _tracers_test_testSpan__WEBPACK_IMPORTED_MODULE_6__["TestSpan"]; });

/* harmony import */ var _utils_traceParentHeader__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(142);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "extractSpanContextFromTraceParentHeader", function() { return _utils_traceParentHeader__WEBPACK_IMPORTED_MODULE_7__["extractSpanContextFromTraceParentHeader"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getTraceParentHeader", function() { return _utils_traceParentHeader__WEBPACK_IMPORTED_MODULE_7__["getTraceParentHeader"]; });

// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

// Tracers and wrappers






// Utilities

//# sourceMappingURL=index.js.map

/***/ }),
/* 83 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setTracer", function() { return setTracer; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getTracer", function() { return getTracer; });
/* harmony import */ var _tracers_noop_noOpTracer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(84);
/* harmony import */ var _utils_cache__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(135);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


var defaultTracer;
function getDefaultTracer() {
    if (!defaultTracer) {
        defaultTracer = new _tracers_noop_noOpTracer__WEBPACK_IMPORTED_MODULE_0__["NoOpTracer"]();
    }
    return defaultTracer;
}
/**
 * Sets the global tracer, enabling tracing for the Azure SDK.
 * @param tracer An OpenTelemetry Tracer instance.
 */
function setTracer(tracer) {
    var cache = Object(_utils_cache__WEBPACK_IMPORTED_MODULE_1__["getCache"])();
    cache.tracer = tracer;
}
/**
 * Retrieves the active tracer, or returns a
 * no-op implementation if one is not set.
 */
function getTracer() {
    var cache = Object(_utils_cache__WEBPACK_IMPORTED_MODULE_1__["getCache"])();
    if (!cache.tracer) {
        return getDefaultTracer();
    }
    return cache.tracer;
}
//# sourceMappingURL=tracerProxy.js.map

/***/ }),
/* 84 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NoOpTracer", function() { return NoOpTracer; });
/* harmony import */ var _noOpSpan__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(85);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

/**
 * A no-op implementation of Tracer that can be used when tracing
 * is disabled.
 */
var NoOpTracer = /** @class */ (function () {
    function NoOpTracer() {
    }
    /**
     * Starts a new Span.
     * @param _name The name of the span.
     * @param _options The SpanOptions used during Span creation.
     */
    NoOpTracer.prototype.startSpan = function (_name, _options) {
        return new _noOpSpan__WEBPACK_IMPORTED_MODULE_0__["NoOpSpan"]();
    };
    /**
     * Returns the current Span from the current context, if available.
     */
    NoOpTracer.prototype.getCurrentSpan = function () {
        return new _noOpSpan__WEBPACK_IMPORTED_MODULE_0__["NoOpSpan"]();
    };
    /**
     * Executes the given function within the context provided by a Span.
     * @param _span The span that provides the context.
     * @param fn The function to be executed.
     */
    NoOpTracer.prototype.withSpan = function (_span, fn) {
        return fn();
    };
    /**
     * Bind a Span as the target's scope
     * @param target An object to bind the scope.
     * @param _span A specific Span to use. Otherwise, use the current one.
     */
    NoOpTracer.prototype.bind = function (target, _span) {
        return target;
    };
    return NoOpTracer;
}());

//# sourceMappingURL=noOpTracer.js.map

/***/ }),
/* 85 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NoOpSpan", function() { return NoOpSpan; });
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(86);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_opentelemetry_api__WEBPACK_IMPORTED_MODULE_0__);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

/**
 * A no-op implementation of Span that can safely be used without side-effects.
 */
var NoOpSpan = /** @class */ (function () {
    function NoOpSpan() {
    }
    /**
     * Returns the SpanContext associated with this Span.
     */
    NoOpSpan.prototype.context = function () {
        return {
            spanId: "",
            traceId: "",
            traceFlags: _opentelemetry_api__WEBPACK_IMPORTED_MODULE_0__["TraceFlags"].NONE
        };
    };
    /**
     * Marks the end of Span execution.
     * @param _endTime The time to use as the Span's end time. Defaults to
     * the current time.
     */
    NoOpSpan.prototype.end = function (_endTime) {
        /* Noop */
    };
    /**
     * Sets an attribute on the Span
     * @param _key the attribute key
     * @param _value the attribute value
     */
    NoOpSpan.prototype.setAttribute = function (_key, _value) {
        return this;
    };
    /**
     * Sets attributes on the Span
     * @param _attributes the attributes to add
     */
    NoOpSpan.prototype.setAttributes = function (_attributes) {
        return this;
    };
    /**
     * Adds an event to the Span
     * @param _name The name of the event
     * @param _attributes The associated attributes to add for this event
     */
    NoOpSpan.prototype.addEvent = function (_name, _attributes) {
        return this;
    };
    /**
     * Sets a status on the span. Overrides the default of CanonicalCode.OK.
     * @param _status The status to set.
     */
    NoOpSpan.prototype.setStatus = function (_status) {
        return this;
    };
    /**
     * Updates the name of the Span
     * @param _name the new Span name
     */
    NoOpSpan.prototype.updateName = function (_name) {
        return this;
    };
    /**
     * Returns whether this span will be recorded
     */
    NoOpSpan.prototype.isRecording = function () {
        return false;
    };
    return NoOpSpan;
}());

//# sourceMappingURL=noOpSpan.js.map

/***/ }),
/* 86 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.propagation = exports.metrics = exports.trace = exports.context = void 0;
__exportStar(__webpack_require__(87), exports);
__exportStar(__webpack_require__(88), exports);
__exportStar(__webpack_require__(89), exports);
__exportStar(__webpack_require__(90), exports);
__exportStar(__webpack_require__(91), exports);
__exportStar(__webpack_require__(92), exports);
__exportStar(__webpack_require__(93), exports);
__exportStar(__webpack_require__(94), exports);
__exportStar(__webpack_require__(95), exports);
__exportStar(__webpack_require__(96), exports);
__exportStar(__webpack_require__(97), exports);
__exportStar(__webpack_require__(98), exports);
__exportStar(__webpack_require__(99), exports);
__exportStar(__webpack_require__(100), exports);
__exportStar(__webpack_require__(101), exports);
__exportStar(__webpack_require__(102), exports);
__exportStar(__webpack_require__(103), exports);
__exportStar(__webpack_require__(104), exports);
__exportStar(__webpack_require__(105), exports);
__exportStar(__webpack_require__(106), exports);
__exportStar(__webpack_require__(107), exports);
__exportStar(__webpack_require__(108), exports);
__exportStar(__webpack_require__(109), exports);
__exportStar(__webpack_require__(111), exports);
__exportStar(__webpack_require__(112), exports);
__exportStar(__webpack_require__(113), exports);
__exportStar(__webpack_require__(114), exports);
__exportStar(__webpack_require__(115), exports);
__exportStar(__webpack_require__(116), exports);
__exportStar(__webpack_require__(117), exports);
__exportStar(__webpack_require__(118), exports);
__exportStar(__webpack_require__(119), exports);
__exportStar(__webpack_require__(120), exports);
__exportStar(__webpack_require__(110), exports);
__exportStar(__webpack_require__(121), exports);
__exportStar(__webpack_require__(122), exports);
__exportStar(__webpack_require__(123), exports);
var context_base_1 = __webpack_require__(124);
Object.defineProperty(exports, "Context", { enumerable: true, get: function () { return context_base_1.Context; } });
var context_1 = __webpack_require__(128);
/** Entrypoint for context API */
exports.context = context_1.ContextAPI.getInstance();
var trace_1 = __webpack_require__(132);
/** Entrypoint for trace API */
exports.trace = trace_1.TraceAPI.getInstance();
var metrics_1 = __webpack_require__(133);
/** Entrypoint for metrics API */
exports.metrics = metrics_1.MetricsAPI.getInstance();
var propagation_1 = __webpack_require__(134);
/** Entrypoint for propagation API */
exports.propagation = propagation_1.PropagationAPI.getInstance();
exports.default = {
    trace: exports.trace,
    metrics: exports.metrics,
    context: exports.context,
    propagation: exports.propagation,
};
//# sourceMappingURL=index.js.map

/***/ }),
/* 87 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=Logger.js.map

/***/ }),
/* 88 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=Time.js.map

/***/ }),
/* 89 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.defaultGetter = void 0;
/**
 * Default getter which just does a simple property access. Returns
 * undefined if the key is not set.
 *
 * @param carrier
 * @param key
 */
function defaultGetter(carrier, key) {
    return carrier[key];
}
exports.defaultGetter = defaultGetter;
//# sourceMappingURL=getter.js.map

/***/ }),
/* 90 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=HttpTextPropagator.js.map

/***/ }),
/* 91 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NOOP_HTTP_TEXT_PROPAGATOR = exports.NoopHttpTextPropagator = void 0;
/**
 * No-op implementations of {@link HttpTextPropagator}.
 */
var NoopHttpTextPropagator = /** @class */ (function () {
    function NoopHttpTextPropagator() {
    }
    /** Noop inject function does nothing */
    NoopHttpTextPropagator.prototype.inject = function (context, carrier, setter) { };
    /** Noop extract function does nothing and returns the input context */
    NoopHttpTextPropagator.prototype.extract = function (context, carrier, getter) {
        return context;
    };
    return NoopHttpTextPropagator;
}());
exports.NoopHttpTextPropagator = NoopHttpTextPropagator;
exports.NOOP_HTTP_TEXT_PROPAGATOR = new NoopHttpTextPropagator();
//# sourceMappingURL=NoopHttpTextPropagator.js.map

/***/ }),
/* 92 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.defaultSetter = void 0;
/**
 * Default setter which sets value via direct property access
 *
 * @param carrier
 * @param key
 */
function defaultSetter(carrier, key, value) {
    carrier[key] = value;
}
exports.defaultSetter = defaultSetter;
//# sourceMappingURL=setter.js.map

/***/ }),
/* 93 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=CorrelationContext.js.map

/***/ }),
/* 94 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.EntryTtl = void 0;
/**
 * EntryTtl is an integer that represents number of hops an entry can propagate.
 *
 * For now, ONLY special values (0 and -1) are supported.
 */
var EntryTtl;
(function (EntryTtl) {
    /**
     * NO_PROPAGATION is considered to have local context and is used within the
     * process it created.
     */
    EntryTtl[EntryTtl["NO_PROPAGATION"] = 0] = "NO_PROPAGATION";
    /** UNLIMITED_PROPAGATION can propagate unlimited hops. */
    EntryTtl[EntryTtl["UNLIMITED_PROPAGATION"] = -1] = "UNLIMITED_PROPAGATION";
})(EntryTtl = exports.EntryTtl || (exports.EntryTtl = {}));
//# sourceMappingURL=EntryValue.js.map

/***/ }),
/* 95 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=BatchObserverResult.js.map

/***/ }),
/* 96 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=BoundInstrument.js.map

/***/ }),
/* 97 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=Meter.js.map

/***/ }),
/* 98 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=MeterProvider.js.map

/***/ }),
/* 99 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ValueType = void 0;
/** The Type of value. It describes how the data is reported. */
var ValueType;
(function (ValueType) {
    ValueType[ValueType["INT"] = 0] = "INT";
    ValueType[ValueType["DOUBLE"] = 1] = "DOUBLE";
})(ValueType = exports.ValueType || (exports.ValueType = {}));
//# sourceMappingURL=Metric.js.map

/***/ }),
/* 100 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.NOOP_BATCH_OBSERVER_METRIC = exports.NOOP_SUM_OBSERVER_METRIC = exports.NOOP_UP_DOWN_SUM_OBSERVER_METRIC = exports.NOOP_VALUE_OBSERVER_METRIC = exports.NOOP_BOUND_BASE_OBSERVER = exports.NOOP_VALUE_RECORDER_METRIC = exports.NOOP_BOUND_VALUE_RECORDER = exports.NOOP_COUNTER_METRIC = exports.NOOP_BOUND_COUNTER = exports.NOOP_METER = exports.NoopBoundBaseObserver = exports.NoopBoundValueRecorder = exports.NoopBoundCounter = exports.NoopBatchObserverMetric = exports.NoopBaseObserverMetric = exports.NoopValueRecorderMetric = exports.NoopCounterMetric = exports.NoopMetric = exports.NoopMeter = void 0;
/**
 * NoopMeter is a noop implementation of the {@link Meter} interface. It reuses
 * constant NoopMetrics for all of its methods.
 */
var NoopMeter = /** @class */ (function () {
    function NoopMeter() {
    }
    /**
     * Returns constant noop value recorder.
     * @param name the name of the metric.
     * @param [options] the metric options.
     */
    NoopMeter.prototype.createValueRecorder = function (name, options) {
        return exports.NOOP_VALUE_RECORDER_METRIC;
    };
    /**
     * Returns a constant noop counter.
     * @param name the name of the metric.
     * @param [options] the metric options.
     */
    NoopMeter.prototype.createCounter = function (name, options) {
        return exports.NOOP_COUNTER_METRIC;
    };
    /**
     * Returns a constant noop UpDownCounter.
     * @param name the name of the metric.
     * @param [options] the metric options.
     */
    NoopMeter.prototype.createUpDownCounter = function (name, options) {
        return exports.NOOP_COUNTER_METRIC;
    };
    /**
     * Returns constant noop value observer.
     * @param name the name of the metric.
     * @param [options] the metric options.
     * @param [callback] the value observer callback
     */
    NoopMeter.prototype.createValueObserver = function (name, options, callback) {
        return exports.NOOP_VALUE_OBSERVER_METRIC;
    };
    /**
     * Returns constant noop batch observer.
     * @param name the name of the metric.
     * @param callback the batch observer callback
     */
    NoopMeter.prototype.createBatchObserver = function (name, callback) {
        return exports.NOOP_BATCH_OBSERVER_METRIC;
    };
    return NoopMeter;
}());
exports.NoopMeter = NoopMeter;
var NoopMetric = /** @class */ (function () {
    function NoopMetric(instrument) {
        this._instrument = instrument;
    }
    /**
     * Returns a Bound Instrument associated with specified Labels.
     * It is recommended to keep a reference to the Bound Instrument instead of
     * always calling this method for every operations.
     * @param labels key-values pairs that are associated with a specific metric
     *     that you want to record.
     */
    NoopMetric.prototype.bind = function (labels) {
        return this._instrument;
    };
    /**
     * Removes the Binding from the metric, if it is present.
     * @param labels key-values pairs that are associated with a specific metric.
     */
    NoopMetric.prototype.unbind = function (labels) {
        return;
    };
    /**
     * Clears all timeseries from the Metric.
     */
    NoopMetric.prototype.clear = function () {
        return;
    };
    return NoopMetric;
}());
exports.NoopMetric = NoopMetric;
var NoopCounterMetric = /** @class */ (function (_super) {
    __extends(NoopCounterMetric, _super);
    function NoopCounterMetric() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    NoopCounterMetric.prototype.add = function (value, labels) {
        this.bind(labels).add(value);
    };
    return NoopCounterMetric;
}(NoopMetric));
exports.NoopCounterMetric = NoopCounterMetric;
var NoopValueRecorderMetric = /** @class */ (function (_super) {
    __extends(NoopValueRecorderMetric, _super);
    function NoopValueRecorderMetric() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    NoopValueRecorderMetric.prototype.record = function (value, labels, correlationContext, spanContext) {
        if (typeof correlationContext === 'undefined') {
            this.bind(labels).record(value);
        }
        else if (typeof spanContext === 'undefined') {
            this.bind(labels).record(value, correlationContext);
        }
        else {
            this.bind(labels).record(value, correlationContext, spanContext);
        }
    };
    return NoopValueRecorderMetric;
}(NoopMetric));
exports.NoopValueRecorderMetric = NoopValueRecorderMetric;
var NoopBaseObserverMetric = /** @class */ (function (_super) {
    __extends(NoopBaseObserverMetric, _super);
    function NoopBaseObserverMetric() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    NoopBaseObserverMetric.prototype.observation = function () {
        return {
            observer: this,
            value: 0,
        };
    };
    return NoopBaseObserverMetric;
}(NoopMetric));
exports.NoopBaseObserverMetric = NoopBaseObserverMetric;
var NoopBatchObserverMetric = /** @class */ (function (_super) {
    __extends(NoopBatchObserverMetric, _super);
    function NoopBatchObserverMetric() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return NoopBatchObserverMetric;
}(NoopMetric));
exports.NoopBatchObserverMetric = NoopBatchObserverMetric;
var NoopBoundCounter = /** @class */ (function () {
    function NoopBoundCounter() {
    }
    NoopBoundCounter.prototype.add = function (value) {
        return;
    };
    return NoopBoundCounter;
}());
exports.NoopBoundCounter = NoopBoundCounter;
var NoopBoundValueRecorder = /** @class */ (function () {
    function NoopBoundValueRecorder() {
    }
    NoopBoundValueRecorder.prototype.record = function (value, correlationContext, spanContext) {
        return;
    };
    return NoopBoundValueRecorder;
}());
exports.NoopBoundValueRecorder = NoopBoundValueRecorder;
var NoopBoundBaseObserver = /** @class */ (function () {
    function NoopBoundBaseObserver() {
    }
    NoopBoundBaseObserver.prototype.update = function (value) { };
    return NoopBoundBaseObserver;
}());
exports.NoopBoundBaseObserver = NoopBoundBaseObserver;
exports.NOOP_METER = new NoopMeter();
exports.NOOP_BOUND_COUNTER = new NoopBoundCounter();
exports.NOOP_COUNTER_METRIC = new NoopCounterMetric(exports.NOOP_BOUND_COUNTER);
exports.NOOP_BOUND_VALUE_RECORDER = new NoopBoundValueRecorder();
exports.NOOP_VALUE_RECORDER_METRIC = new NoopValueRecorderMetric(exports.NOOP_BOUND_VALUE_RECORDER);
exports.NOOP_BOUND_BASE_OBSERVER = new NoopBoundBaseObserver();
exports.NOOP_VALUE_OBSERVER_METRIC = new NoopBaseObserverMetric(exports.NOOP_BOUND_BASE_OBSERVER);
exports.NOOP_UP_DOWN_SUM_OBSERVER_METRIC = new NoopBaseObserverMetric(exports.NOOP_BOUND_BASE_OBSERVER);
exports.NOOP_SUM_OBSERVER_METRIC = new NoopBaseObserverMetric(exports.NOOP_BOUND_BASE_OBSERVER);
exports.NOOP_BATCH_OBSERVER_METRIC = new NoopBatchObserverMetric();
//# sourceMappingURL=NoopMeter.js.map

/***/ }),
/* 101 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NOOP_METER_PROVIDER = exports.NoopMeterProvider = void 0;
var NoopMeter_1 = __webpack_require__(100);
/**
 * An implementation of the {@link MeterProvider} which returns an impotent Meter
 * for all calls to `getMeter`
 */
var NoopMeterProvider = /** @class */ (function () {
    function NoopMeterProvider() {
    }
    NoopMeterProvider.prototype.getMeter = function (_name, _version) {
        return NoopMeter_1.NOOP_METER;
    };
    return NoopMeterProvider;
}());
exports.NoopMeterProvider = NoopMeterProvider;
exports.NOOP_METER_PROVIDER = new NoopMeterProvider();
//# sourceMappingURL=NoopMeterProvider.js.map

/***/ }),
/* 102 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=Observation.js.map

/***/ }),
/* 103 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=ObserverResult.js.map

/***/ }),
/* 104 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=attributes.js.map

/***/ }),
/* 105 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=Event.js.map

/***/ }),
/* 106 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=Plugin.js.map

/***/ }),
/* 107 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=link_context.js.map

/***/ }),
/* 108 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=link.js.map

/***/ }),
/* 109 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NOOP_SPAN = exports.NoopSpan = exports.INVALID_SPAN_ID = exports.INVALID_TRACE_ID = void 0;
var trace_flags_1 = __webpack_require__(110);
exports.INVALID_TRACE_ID = '0';
exports.INVALID_SPAN_ID = '0';
var INVALID_SPAN_CONTEXT = {
    traceId: exports.INVALID_TRACE_ID,
    spanId: exports.INVALID_SPAN_ID,
    traceFlags: trace_flags_1.TraceFlags.NONE,
};
/**
 * The NoopSpan is the default {@link Span} that is used when no Span
 * implementation is available. All operations are no-op including context
 * propagation.
 */
var NoopSpan = /** @class */ (function () {
    function NoopSpan(_spanContext) {
        if (_spanContext === void 0) { _spanContext = INVALID_SPAN_CONTEXT; }
        this._spanContext = _spanContext;
    }
    // Returns a SpanContext.
    NoopSpan.prototype.context = function () {
        return this._spanContext;
    };
    // By default does nothing
    NoopSpan.prototype.setAttribute = function (key, value) {
        return this;
    };
    // By default does nothing
    NoopSpan.prototype.setAttributes = function (attributes) {
        return this;
    };
    // By default does nothing
    NoopSpan.prototype.addEvent = function (name, attributes) {
        return this;
    };
    // By default does nothing
    NoopSpan.prototype.setStatus = function (status) {
        return this;
    };
    // By default does nothing
    NoopSpan.prototype.updateName = function (name) {
        return this;
    };
    // By default does nothing
    NoopSpan.prototype.end = function (endTime) { };
    // isRecording always returns false for noopSpan.
    NoopSpan.prototype.isRecording = function () {
        return false;
    };
    return NoopSpan;
}());
exports.NoopSpan = NoopSpan;
exports.NOOP_SPAN = new NoopSpan();
//# sourceMappingURL=NoopSpan.js.map

/***/ }),
/* 110 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.TraceFlags = void 0;
/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var TraceFlags;
(function (TraceFlags) {
    /** Represents no flag set. */
    TraceFlags[TraceFlags["NONE"] = 0] = "NONE";
    /** Bit to represent whether trace is sampled in trace flags. */
    TraceFlags[TraceFlags["SAMPLED"] = 1] = "SAMPLED";
})(TraceFlags = exports.TraceFlags || (exports.TraceFlags = {}));
//# sourceMappingURL=trace_flags.js.map

/***/ }),
/* 111 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NOOP_TRACER = exports.NoopTracer = void 0;
var NoopSpan_1 = __webpack_require__(109);
/**
 * No-op implementations of {@link Tracer}.
 */
var NoopTracer = /** @class */ (function () {
    function NoopTracer() {
    }
    NoopTracer.prototype.getCurrentSpan = function () {
        return NoopSpan_1.NOOP_SPAN;
    };
    // startSpan starts a noop span.
    NoopTracer.prototype.startSpan = function (name, options) {
        return NoopSpan_1.NOOP_SPAN;
    };
    NoopTracer.prototype.withSpan = function (span, fn) {
        return fn();
    };
    NoopTracer.prototype.bind = function (target, span) {
        return target;
    };
    return NoopTracer;
}());
exports.NoopTracer = NoopTracer;
exports.NOOP_TRACER = new NoopTracer();
//# sourceMappingURL=NoopTracer.js.map

/***/ }),
/* 112 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NOOP_TRACER_PROVIDER = exports.NoopTracerProvider = void 0;
var NoopTracer_1 = __webpack_require__(111);
/**
 * An implementation of the {@link TracerProvider} which returns an impotent
 * Tracer for all calls to `getTracer`.
 *
 * All operations are no-op.
 */
var NoopTracerProvider = /** @class */ (function () {
    function NoopTracerProvider() {
    }
    NoopTracerProvider.prototype.getTracer = function (_name, _version) {
        return NoopTracer_1.NOOP_TRACER;
    };
    return NoopTracerProvider;
}());
exports.NoopTracerProvider = NoopTracerProvider;
exports.NOOP_TRACER_PROVIDER = new NoopTracerProvider();
//# sourceMappingURL=NoopTracerProvider.js.map

/***/ }),
/* 113 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=Sampler.js.map

/***/ }),
/* 114 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SamplingDecision = void 0;
/**
 * A sampling decision that determines how a {@link Span} will be recorded
 * and collected.
 */
var SamplingDecision;
(function (SamplingDecision) {
    /**
     * `Span.isRecording() === false`, span will not be recorded and all events
     * and attributes will be dropped.
     */
    SamplingDecision[SamplingDecision["NOT_RECORD"] = 0] = "NOT_RECORD";
    /**
     * `Span.isRecording() === true`, but `Sampled` flag in {@link TraceFlags}
     * MUST NOT be set.
     */
    SamplingDecision[SamplingDecision["RECORD"] = 1] = "RECORD";
    /**
     * `Span.isRecording() === true` AND `Sampled` flag in {@link TraceFlags}
     * MUST be set.
     */
    SamplingDecision[SamplingDecision["RECORD_AND_SAMPLED"] = 2] = "RECORD_AND_SAMPLED";
})(SamplingDecision = exports.SamplingDecision || (exports.SamplingDecision = {}));
//# sourceMappingURL=SamplingResult.js.map

/***/ }),
/* 115 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=span_context.js.map

/***/ }),
/* 116 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.SpanKind = void 0;
/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var SpanKind;
(function (SpanKind) {
    /** Default value. Indicates that the span is used internally. */
    SpanKind[SpanKind["INTERNAL"] = 0] = "INTERNAL";
    /**
     * Indicates that the span covers server-side handling of an RPC or other
     * remote request.
     */
    SpanKind[SpanKind["SERVER"] = 1] = "SERVER";
    /**
     * Indicates that the span covers the client-side wrapper around an RPC or
     * other remote request.
     */
    SpanKind[SpanKind["CLIENT"] = 2] = "CLIENT";
    /**
     * Indicates that the span describes producer sending a message to a
     * broker. Unlike client and server, there is no direct critical path latency
     * relationship between producer and consumer spans.
     */
    SpanKind[SpanKind["PRODUCER"] = 3] = "PRODUCER";
    /**
     * Indicates that the span describes consumer receiving a message from a
     * broker. Unlike client and server, there is no direct critical path latency
     * relationship between producer and consumer spans.
     */
    SpanKind[SpanKind["CONSUMER"] = 4] = "CONSUMER";
})(SpanKind = exports.SpanKind || (exports.SpanKind = {}));
//# sourceMappingURL=span_kind.js.map

/***/ }),
/* 117 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=span.js.map

/***/ }),
/* 118 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=SpanOptions.js.map

/***/ }),
/* 119 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.CanonicalCode = void 0;
/**
 * An enumeration of canonical status codes.
 */
var CanonicalCode;
(function (CanonicalCode) {
    /**
     * Not an error; returned on success
     */
    CanonicalCode[CanonicalCode["OK"] = 0] = "OK";
    /**
     * The operation was cancelled (typically by the caller).
     */
    CanonicalCode[CanonicalCode["CANCELLED"] = 1] = "CANCELLED";
    /**
     * Unknown error.  An example of where this error may be returned is
     * if a status value received from another address space belongs to
     * an error-space that is not known in this address space.  Also
     * errors raised by APIs that do not return enough error information
     * may be converted to this error.
     */
    CanonicalCode[CanonicalCode["UNKNOWN"] = 2] = "UNKNOWN";
    /**
     * Client specified an invalid argument.  Note that this differs
     * from FAILED_PRECONDITION.  INVALID_ARGUMENT indicates arguments
     * that are problematic regardless of the state of the system
     * (e.g., a malformed file name).
     */
    CanonicalCode[CanonicalCode["INVALID_ARGUMENT"] = 3] = "INVALID_ARGUMENT";
    /**
     * Deadline expired before operation could complete.  For operations
     * that change the state of the system, this error may be returned
     * even if the operation has completed successfully.  For example, a
     * successful response from a server could have been delayed long
     * enough for the deadline to expire.
     */
    CanonicalCode[CanonicalCode["DEADLINE_EXCEEDED"] = 4] = "DEADLINE_EXCEEDED";
    /**
     * Some requested entity (e.g., file or directory) was not found.
     */
    CanonicalCode[CanonicalCode["NOT_FOUND"] = 5] = "NOT_FOUND";
    /**
     * Some entity that we attempted to create (e.g., file or directory)
     * already exists.
     */
    CanonicalCode[CanonicalCode["ALREADY_EXISTS"] = 6] = "ALREADY_EXISTS";
    /**
     * The caller does not have permission to execute the specified
     * operation.  PERMISSION_DENIED must not be used for rejections
     * caused by exhausting some resource (use RESOURCE_EXHAUSTED
     * instead for those errors).  PERMISSION_DENIED must not be
     * used if the caller can not be identified (use UNAUTHENTICATED
     * instead for those errors).
     */
    CanonicalCode[CanonicalCode["PERMISSION_DENIED"] = 7] = "PERMISSION_DENIED";
    /**
     * Some resource has been exhausted, perhaps a per-user quota, or
     * perhaps the entire file system is out of space.
     */
    CanonicalCode[CanonicalCode["RESOURCE_EXHAUSTED"] = 8] = "RESOURCE_EXHAUSTED";
    /**
     * Operation was rejected because the system is not in a state
     * required for the operation's execution.  For example, directory
     * to be deleted may be non-empty, an rmdir operation is applied to
     * a non-directory, etc.
     *
     * A litmus test that may help a service implementor in deciding
     * between FAILED_PRECONDITION, ABORTED, and UNAVAILABLE:
     *
     *  - Use UNAVAILABLE if the client can retry just the failing call.
     *  - Use ABORTED if the client should retry at a higher-level
     *    (e.g., restarting a read-modify-write sequence).
     *  - Use FAILED_PRECONDITION if the client should not retry until
     *    the system state has been explicitly fixed.  E.g., if an "rmdir"
     *    fails because the directory is non-empty, FAILED_PRECONDITION
     *    should be returned since the client should not retry unless
     *    they have first fixed up the directory by deleting files from it.
     *  - Use FAILED_PRECONDITION if the client performs conditional
     *    REST Get/Update/Delete on a resource and the resource on the
     *    server does not match the condition. E.g., conflicting
     *    read-modify-write on the same resource.
     */
    CanonicalCode[CanonicalCode["FAILED_PRECONDITION"] = 9] = "FAILED_PRECONDITION";
    /**
     * The operation was aborted, typically due to a concurrency issue
     * like sequencer check failures, transaction aborts, etc.
     *
     * See litmus test above for deciding between FAILED_PRECONDITION,
     * ABORTED, and UNAVAILABLE.
     */
    CanonicalCode[CanonicalCode["ABORTED"] = 10] = "ABORTED";
    /**
     * Operation was attempted past the valid range.  E.g., seeking or
     * reading past end of file.
     *
     * Unlike INVALID_ARGUMENT, this error indicates a problem that may
     * be fixed if the system state changes. For example, a 32-bit file
     * system will generate INVALID_ARGUMENT if asked to read at an
     * offset that is not in the range [0,2^32-1], but it will generate
     * OUT_OF_RANGE if asked to read from an offset past the current
     * file size.
     *
     * There is a fair bit of overlap between FAILED_PRECONDITION and
     * OUT_OF_RANGE.  We recommend using OUT_OF_RANGE (the more specific
     * error) when it applies so that callers who are iterating through
     * a space can easily look for an OUT_OF_RANGE error to detect when
     * they are done.
     */
    CanonicalCode[CanonicalCode["OUT_OF_RANGE"] = 11] = "OUT_OF_RANGE";
    /**
     * Operation is not implemented or not supported/enabled in this service.
     */
    CanonicalCode[CanonicalCode["UNIMPLEMENTED"] = 12] = "UNIMPLEMENTED";
    /**
     * Internal errors.  Means some invariants expected by underlying
     * system has been broken.  If you see one of these errors,
     * something is very broken.
     */
    CanonicalCode[CanonicalCode["INTERNAL"] = 13] = "INTERNAL";
    /**
     * The service is currently unavailable.  This is a most likely a
     * transient condition and may be corrected by retrying with
     * a backoff.
     *
     * See litmus test above for deciding between FAILED_PRECONDITION,
     * ABORTED, and UNAVAILABLE.
     */
    CanonicalCode[CanonicalCode["UNAVAILABLE"] = 14] = "UNAVAILABLE";
    /**
     * Unrecoverable data loss or corruption.
     */
    CanonicalCode[CanonicalCode["DATA_LOSS"] = 15] = "DATA_LOSS";
    /**
     * The request does not have valid authentication credentials for the
     * operation.
     */
    CanonicalCode[CanonicalCode["UNAUTHENTICATED"] = 16] = "UNAUTHENTICATED";
})(CanonicalCode = exports.CanonicalCode || (exports.CanonicalCode = {}));
//# sourceMappingURL=status.js.map

/***/ }),
/* 120 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=TimedEvent.js.map

/***/ }),
/* 121 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=trace_state.js.map

/***/ }),
/* 122 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=tracer_provider.js.map

/***/ }),
/* 123 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=tracer.js.map

/***/ }),
/* 124 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
__exportStar(__webpack_require__(125), exports);
__exportStar(__webpack_require__(126), exports);
__exportStar(__webpack_require__(127), exports);
//# sourceMappingURL=index.js.map

/***/ }),
/* 125 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
//# sourceMappingURL=types.js.map

/***/ }),
/* 126 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.Context = void 0;
/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Context = /** @class */ (function () {
    /**
     * Construct a new context which inherits values from an optional parent context.
     *
     * @param parentContext a context from which to inherit values
     */
    function Context(parentContext) {
        this._currentContext = parentContext ? new Map(parentContext) : new Map();
    }
    /** Get a key to uniquely identify a context value */
    Context.createKey = function (description) {
        return Symbol(description);
    };
    /**
     * Get a value from the context.
     *
     * @param key key which identifies a context value
     */
    Context.prototype.getValue = function (key) {
        return this._currentContext.get(key);
    };
    /**
     * Create a new context which inherits from this context and has
     * the given key set to the given value.
     *
     * @param key context key for which to set the value
     * @param value value to set for the given key
     */
    Context.prototype.setValue = function (key, value) {
        var context = new Context(this._currentContext);
        context._currentContext.set(key, value);
        return context;
    };
    /**
     * Return a new context which inherits from this context but does
     * not contain a value for the given key.
     *
     * @param key context key for which to clear a value
     */
    Context.prototype.deleteValue = function (key) {
        var context = new Context(this._currentContext);
        context._currentContext.delete(key);
        return context;
    };
    /** The root context is used as the default parent context when there is no active context */
    Context.ROOT_CONTEXT = new Context();
    /**
     * This is another identifier to the root context which allows developers to easily search the
     * codebase for direct uses of context which need to be removed in later PRs.
     *
     * It's existence is temporary and it should be removed when all references are fixed.
     */
    Context.TODO = Context.ROOT_CONTEXT;
    return Context;
}());
exports.Context = Context;
//# sourceMappingURL=context.js.map

/***/ }),
/* 127 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NoopContextManager = void 0;
var context_1 = __webpack_require__(126);
var NoopContextManager = /** @class */ (function () {
    function NoopContextManager() {
    }
    NoopContextManager.prototype.active = function () {
        return context_1.Context.ROOT_CONTEXT;
    };
    NoopContextManager.prototype.with = function (context, fn) {
        return fn();
    };
    NoopContextManager.prototype.bind = function (target, context) {
        return target;
    };
    NoopContextManager.prototype.enable = function () {
        return this;
    };
    NoopContextManager.prototype.disable = function () {
        return this;
    };
    return NoopContextManager;
}());
exports.NoopContextManager = NoopContextManager;
//# sourceMappingURL=NoopContextManager.js.map

/***/ }),
/* 128 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContextAPI = void 0;
var context_base_1 = __webpack_require__(124);
var global_utils_1 = __webpack_require__(129);
var NOOP_CONTEXT_MANAGER = new context_base_1.NoopContextManager();
/**
 * Singleton object which represents the entry point to the OpenTelemetry Context API
 */
var ContextAPI = /** @class */ (function () {
    /** Empty private constructor prevents end users from constructing a new instance of the API */
    function ContextAPI() {
    }
    /** Get the singleton instance of the Context API */
    ContextAPI.getInstance = function () {
        if (!this._instance) {
            this._instance = new ContextAPI();
        }
        return this._instance;
    };
    /**
     * Set the current context manager. Returns the initialized context manager
     */
    ContextAPI.prototype.setGlobalContextManager = function (contextManager) {
        if (global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY]) {
            // global context manager has already been set
            return this._getContextManager();
        }
        global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY] = global_utils_1.makeGetter(global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION, contextManager, NOOP_CONTEXT_MANAGER);
        return contextManager;
    };
    /**
     * Get the currently active context
     */
    ContextAPI.prototype.active = function () {
        return this._getContextManager().active();
    };
    /**
     * Execute a function with an active context
     *
     * @param context context to be active during function execution
     * @param fn function to execute in a context
     */
    ContextAPI.prototype.with = function (context, fn) {
        return this._getContextManager().with(context, fn);
    };
    /**
     * Bind a context to a target function or event emitter
     *
     * @param target function or event emitter to bind
     * @param context context to bind to the event emitter or function. Defaults to the currently active context
     */
    ContextAPI.prototype.bind = function (target, context) {
        if (context === void 0) { context = this.active(); }
        return this._getContextManager().bind(target, context);
    };
    ContextAPI.prototype._getContextManager = function () {
        var _a, _b;
        return ((_b = (_a = global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY]) === null || _a === void 0 ? void 0 : _a.call(global_utils_1._global, global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION)) !== null && _b !== void 0 ? _b : NOOP_CONTEXT_MANAGER);
    };
    /** Disable and remove the global context manager */
    ContextAPI.prototype.disable = function () {
        this._getContextManager().disable();
        delete global_utils_1._global[global_utils_1.GLOBAL_CONTEXT_MANAGER_API_KEY];
    };
    return ContextAPI;
}());
exports.ContextAPI = ContextAPI;
//# sourceMappingURL=context.js.map

/***/ }),
/* 129 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.API_BACKWARDS_COMPATIBILITY_VERSION = exports.makeGetter = exports._global = exports.GLOBAL_TRACE_API_KEY = exports.GLOBAL_PROPAGATION_API_KEY = exports.GLOBAL_METRICS_API_KEY = exports.GLOBAL_CONTEXT_MANAGER_API_KEY = void 0;
var platform_1 = __webpack_require__(130);
exports.GLOBAL_CONTEXT_MANAGER_API_KEY = Symbol.for('io.opentelemetry.js.api.context');
exports.GLOBAL_METRICS_API_KEY = Symbol.for('io.opentelemetry.js.api.metrics');
exports.GLOBAL_PROPAGATION_API_KEY = Symbol.for('io.opentelemetry.js.api.propagation');
exports.GLOBAL_TRACE_API_KEY = Symbol.for('io.opentelemetry.js.api.trace');
exports._global = platform_1._globalThis;
/**
 * Make a function which accepts a version integer and returns the instance of an API if the version
 * is compatible, or a fallback version (usually NOOP) if it is not.
 *
 * @param requiredVersion Backwards compatibility version which is required to return the instance
 * @param instance Instance which should be returned if the required version is compatible
 * @param fallback Fallback instance, usually NOOP, which will be returned if the required version is not compatible
 */
function makeGetter(requiredVersion, instance, fallback) {
    return function (version) {
        return version === requiredVersion ? instance : fallback;
    };
}
exports.makeGetter = makeGetter;
/**
 * A number which should be incremented each time a backwards incompatible
 * change is made to the API. This number is used when an API package
 * attempts to access the global API to ensure it is getting a compatible
 * version. If the global API is not compatible with the API package
 * attempting to get it, a NOOP API implementation will be returned.
 */
exports.API_BACKWARDS_COMPATIBILITY_VERSION = 0;
//# sourceMappingURL=global-utils.js.map

/***/ }),
/* 130 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
__exportStar(__webpack_require__(131), exports);
//# sourceMappingURL=index.js.map

/***/ }),
/* 131 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports._globalThis = void 0;
/** only globals that common to node and browsers are allowed */
// eslint-disable-next-line node/no-unsupported-features/es-builtins, no-undef
exports._globalThis = typeof globalThis === 'object' ? globalThis : window;
//# sourceMappingURL=globalThis.js.map

/***/ }),
/* 132 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TraceAPI = void 0;
var NoopTracerProvider_1 = __webpack_require__(112);
var global_utils_1 = __webpack_require__(129);
/**
 * Singleton object which represents the entry point to the OpenTelemetry Tracing API
 */
var TraceAPI = /** @class */ (function () {
    /** Empty private constructor prevents end users from constructing a new instance of the API */
    function TraceAPI() {
    }
    /** Get the singleton instance of the Trace API */
    TraceAPI.getInstance = function () {
        if (!this._instance) {
            this._instance = new TraceAPI();
        }
        return this._instance;
    };
    /**
     * Set the current global tracer. Returns the initialized global tracer provider
     */
    TraceAPI.prototype.setGlobalTracerProvider = function (provider) {
        if (global_utils_1._global[global_utils_1.GLOBAL_TRACE_API_KEY]) {
            // global tracer provider has already been set
            return this.getTracerProvider();
        }
        global_utils_1._global[global_utils_1.GLOBAL_TRACE_API_KEY] = global_utils_1.makeGetter(global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION, provider, NoopTracerProvider_1.NOOP_TRACER_PROVIDER);
        return this.getTracerProvider();
    };
    /**
     * Returns the global tracer provider.
     */
    TraceAPI.prototype.getTracerProvider = function () {
        var _a, _b;
        return ((_b = (_a = global_utils_1._global[global_utils_1.GLOBAL_TRACE_API_KEY]) === null || _a === void 0 ? void 0 : _a.call(global_utils_1._global, global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION)) !== null && _b !== void 0 ? _b : NoopTracerProvider_1.NOOP_TRACER_PROVIDER);
    };
    /**
     * Returns a tracer from the global tracer provider.
     */
    TraceAPI.prototype.getTracer = function (name, version) {
        return this.getTracerProvider().getTracer(name, version);
    };
    /** Remove the global tracer provider */
    TraceAPI.prototype.disable = function () {
        delete global_utils_1._global[global_utils_1.GLOBAL_TRACE_API_KEY];
    };
    return TraceAPI;
}());
exports.TraceAPI = TraceAPI;
//# sourceMappingURL=trace.js.map

/***/ }),
/* 133 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricsAPI = void 0;
var NoopMeterProvider_1 = __webpack_require__(101);
var global_utils_1 = __webpack_require__(129);
/**
 * Singleton object which represents the entry point to the OpenTelemetry Metrics API
 */
var MetricsAPI = /** @class */ (function () {
    /** Empty private constructor prevents end users from constructing a new instance of the API */
    function MetricsAPI() {
    }
    /** Get the singleton instance of the Metrics API */
    MetricsAPI.getInstance = function () {
        if (!this._instance) {
            this._instance = new MetricsAPI();
        }
        return this._instance;
    };
    /**
     * Set the current global meter. Returns the initialized global meter provider.
     */
    MetricsAPI.prototype.setGlobalMeterProvider = function (provider) {
        if (global_utils_1._global[global_utils_1.GLOBAL_METRICS_API_KEY]) {
            // global meter provider has already been set
            return this.getMeterProvider();
        }
        global_utils_1._global[global_utils_1.GLOBAL_METRICS_API_KEY] = global_utils_1.makeGetter(global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION, provider, NoopMeterProvider_1.NOOP_METER_PROVIDER);
        return provider;
    };
    /**
     * Returns the global meter provider.
     */
    MetricsAPI.prototype.getMeterProvider = function () {
        var _a, _b;
        return ((_b = (_a = global_utils_1._global[global_utils_1.GLOBAL_METRICS_API_KEY]) === null || _a === void 0 ? void 0 : _a.call(global_utils_1._global, global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION)) !== null && _b !== void 0 ? _b : NoopMeterProvider_1.NOOP_METER_PROVIDER);
    };
    /**
     * Returns a meter from the global meter provider.
     */
    MetricsAPI.prototype.getMeter = function (name, version) {
        return this.getMeterProvider().getMeter(name, version);
    };
    /** Remove the global meter provider */
    MetricsAPI.prototype.disable = function () {
        delete global_utils_1._global[global_utils_1.GLOBAL_METRICS_API_KEY];
    };
    return MetricsAPI;
}());
exports.MetricsAPI = MetricsAPI;
//# sourceMappingURL=metrics.js.map

/***/ }),
/* 134 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.PropagationAPI = void 0;
var getter_1 = __webpack_require__(89);
var NoopHttpTextPropagator_1 = __webpack_require__(91);
var setter_1 = __webpack_require__(92);
var context_1 = __webpack_require__(128);
var global_utils_1 = __webpack_require__(129);
var contextApi = context_1.ContextAPI.getInstance();
/**
 * Singleton object which represents the entry point to the OpenTelemetry Propagation API
 */
var PropagationAPI = /** @class */ (function () {
    /** Empty private constructor prevents end users from constructing a new instance of the API */
    function PropagationAPI() {
    }
    /** Get the singleton instance of the Propagator API */
    PropagationAPI.getInstance = function () {
        if (!this._instance) {
            this._instance = new PropagationAPI();
        }
        return this._instance;
    };
    /**
     * Set the current propagator. Returns the initialized propagator
     */
    PropagationAPI.prototype.setGlobalPropagator = function (propagator) {
        if (global_utils_1._global[global_utils_1.GLOBAL_PROPAGATION_API_KEY]) {
            // global propagator has already been set
            return this._getGlobalPropagator();
        }
        global_utils_1._global[global_utils_1.GLOBAL_PROPAGATION_API_KEY] = global_utils_1.makeGetter(global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION, propagator, NoopHttpTextPropagator_1.NOOP_HTTP_TEXT_PROPAGATOR);
        return propagator;
    };
    /**
     * Inject context into a carrier to be propagated inter-process
     *
     * @param carrier carrier to inject context into
     * @param setter Function used to set values on the carrier
     * @param context Context carrying tracing data to inject. Defaults to the currently active context.
     */
    PropagationAPI.prototype.inject = function (carrier, setter, context) {
        if (setter === void 0) { setter = setter_1.defaultSetter; }
        if (context === void 0) { context = contextApi.active(); }
        return this._getGlobalPropagator().inject(context, carrier, setter);
    };
    /**
     * Extract context from a carrier
     *
     * @param carrier Carrier to extract context from
     * @param getter Function used to extract keys from a carrier
     * @param context Context which the newly created context will inherit from. Defaults to the currently active context.
     */
    PropagationAPI.prototype.extract = function (carrier, getter, context) {
        if (getter === void 0) { getter = getter_1.defaultGetter; }
        if (context === void 0) { context = contextApi.active(); }
        return this._getGlobalPropagator().extract(context, carrier, getter);
    };
    /** Remove the global propagator */
    PropagationAPI.prototype.disable = function () {
        delete global_utils_1._global[global_utils_1.GLOBAL_PROPAGATION_API_KEY];
    };
    PropagationAPI.prototype._getGlobalPropagator = function () {
        var _a, _b;
        return ((_b = (_a = global_utils_1._global[global_utils_1.GLOBAL_PROPAGATION_API_KEY]) === null || _a === void 0 ? void 0 : _a.call(global_utils_1._global, global_utils_1.API_BACKWARDS_COMPATIBILITY_VERSION)) !== null && _b !== void 0 ? _b : NoopHttpTextPropagator_1.NOOP_HTTP_TEXT_PROPAGATOR);
    };
    return PropagationAPI;
}());
exports.PropagationAPI = PropagationAPI;
//# sourceMappingURL=propagation.js.map

/***/ }),
/* 135 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getCache", function() { return getCache; });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(136);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

// V1 = OpenTelemetry 0.1
// V2 = OpenTelemetry 0.2
// V3 = OpenTelemetry 0.6.1
var GLOBAL_TRACER_VERSION = 3;
// preview5 shipped with @azure/core-tracing.tracerCache
// and didn't have smart detection for collisions
var GLOBAL_TRACER_SYMBOL = Symbol.for("@azure/core-tracing.tracerCache2");
var cache;
function loadTracerCache() {
    var globalObj = Object(_global__WEBPACK_IMPORTED_MODULE_0__["getGlobalObject"])();
    var existingCache = globalObj[GLOBAL_TRACER_SYMBOL];
    var setGlobalCache = true;
    if (existingCache) {
        if (existingCache.version === GLOBAL_TRACER_VERSION) {
            cache = existingCache;
        }
        else {
            setGlobalCache = false;
            if (existingCache.tracer) {
                throw new Error("Two incompatible versions of @azure/core-tracing have been loaded.\n          This library is " + GLOBAL_TRACER_VERSION + ", existing is " + existingCache.version + ".");
            }
        }
    }
    if (!cache) {
        cache = {
            tracer: undefined,
            version: GLOBAL_TRACER_VERSION
        };
    }
    if (setGlobalCache) {
        globalObj[GLOBAL_TRACER_SYMBOL] = cache;
    }
}
function getCache() {
    if (!cache) {
        loadTracerCache();
    }
    return cache;
}
//# sourceMappingURL=cache.js.map

/***/ }),
/* 136 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getGlobalObject", function() { return getGlobalObject; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
function getGlobalObject() {
    return self;
}
//# sourceMappingURL=global.browser.js.map

/***/ }),
/* 137 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "OpenCensusSpanWrapper", function() { return OpenCensusSpanWrapper; });
/* harmony import */ var _openCensusTraceStateWrapper__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(138);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

function isWrappedSpan(span) {
    return !!span && span.getWrappedSpan !== undefined;
}
function isTracer(tracerOrSpan) {
    return tracerOrSpan.getWrappedTracer !== undefined;
}
/**
 * An implementation of OpenTelemetry Span that wraps an OpenCensus Span.
 */
var OpenCensusSpanWrapper = /** @class */ (function () {
    function OpenCensusSpanWrapper(tracerOrSpan, name, options) {
        if (name === void 0) { name = ""; }
        if (options === void 0) { options = {}; }
        if (isTracer(tracerOrSpan)) {
            var parent = isWrappedSpan(options.parent) ? options.parent.getWrappedSpan() : undefined;
            this._span = tracerOrSpan.getWrappedTracer().startChildSpan({
                name: name,
                childOf: parent
            });
            this._span.start();
            if (options.links) {
                for (var _i = 0, _a = options.links; _i < _a.length; _i++) {
                    var link = _a[_i];
                    // Since there is no way to set the link relationship, leave it as Unspecified.
                    this._span.addLink(link.context.traceId, link.context.spanId, 0 /* LinkType.UNSPECIFIED */, link.attributes);
                }
            }
        }
        else {
            this._span = tracerOrSpan;
        }
    }
    /**
     * The underlying OpenCensus Span
     */
    OpenCensusSpanWrapper.prototype.getWrappedSpan = function () {
        return this._span;
    };
    /**
     * Marks the end of Span execution.
     * @param endTime The time to use as the Span's end time. Defaults to
     * the current time.
     */
    OpenCensusSpanWrapper.prototype.end = function (_endTime) {
        this._span.end();
    };
    /**
     * Returns the SpanContext associated with this Span.
     */
    OpenCensusSpanWrapper.prototype.context = function () {
        var openCensusSpanContext = this._span.spanContext;
        return {
            spanId: openCensusSpanContext.spanId,
            traceId: openCensusSpanContext.traceId,
            traceFlags: openCensusSpanContext.options,
            traceState: new _openCensusTraceStateWrapper__WEBPACK_IMPORTED_MODULE_0__["OpenCensusTraceStateWrapper"](openCensusSpanContext.traceState)
        };
    };
    /**
     * Sets an attribute on the Span
     * @param key the attribute key
     * @param value the attribute value
     */
    OpenCensusSpanWrapper.prototype.setAttribute = function (key, value) {
        this._span.addAttribute(key, value);
        return this;
    };
    /**
     * Sets attributes on the Span
     * @param attributes the attributes to add
     */
    OpenCensusSpanWrapper.prototype.setAttributes = function (attributes) {
        this._span.attributes = attributes;
        return this;
    };
    /**
     * Adds an event to the Span
     * @param name The name of the event
     * @param attributes The associated attributes to add for this event
     */
    OpenCensusSpanWrapper.prototype.addEvent = function (_name, _attributes) {
        throw new Error("Method not implemented.");
    };
    /**
     * Sets a status on the span. Overrides the default of CanonicalCode.OK.
     * @param status The status to set.
     */
    OpenCensusSpanWrapper.prototype.setStatus = function (status) {
        this._span.setStatus(status.code, status.message);
        return this;
    };
    /**
     * Updates the name of the Span
     * @param name the new Span name
     */
    OpenCensusSpanWrapper.prototype.updateName = function (name) {
        this._span.name = name;
        return this;
    };
    /**
     * Returns whether this span will be recorded
     */
    OpenCensusSpanWrapper.prototype.isRecording = function () {
        // NoRecordSpans have an empty traceId
        return !!this._span.traceId;
    };
    return OpenCensusSpanWrapper;
}());

//# sourceMappingURL=openCensusSpanWrapper.js.map

/***/ }),
/* 138 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "OpenCensusTraceStateWrapper", function() { return OpenCensusTraceStateWrapper; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * @ignore
 * @internal
 */
var OpenCensusTraceStateWrapper = /** @class */ (function () {
    function OpenCensusTraceStateWrapper(state) {
        this._state = state;
    }
    OpenCensusTraceStateWrapper.prototype.get = function (_key) {
        throw new Error("Method not implemented.");
    };
    OpenCensusTraceStateWrapper.prototype.set = function (_key, _value) {
        throw new Error("Method not implemented.");
    };
    OpenCensusTraceStateWrapper.prototype.unset = function (_key) {
        throw new Error("Method not implemented");
    };
    OpenCensusTraceStateWrapper.prototype.serialize = function () {
        return this._state || "";
    };
    return OpenCensusTraceStateWrapper;
}());

//# sourceMappingURL=openCensusTraceStateWrapper.js.map

/***/ }),
/* 139 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "OpenCensusTracerWrapper", function() { return OpenCensusTracerWrapper; });
/* harmony import */ var _openCensusSpanWrapper__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(137);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

/**
 * An implementation of OpenTelemetry Tracer that wraps an OpenCensus Tracer.
 */
var OpenCensusTracerWrapper = /** @class */ (function () {
    /**
     * Create a new wrapper around a given OpenCensus Tracer.
     * @param tracer The OpenCensus Tracer to wrap.
     */
    function OpenCensusTracerWrapper(tracer) {
        this._tracer = tracer;
    }
    /**
     * The wrapped OpenCensus Tracer
     */
    OpenCensusTracerWrapper.prototype.getWrappedTracer = function () {
        return this._tracer;
    };
    /**
     * Starts a new Span.
     * @param name The name of the span.
     * @param options The SpanOptions used during Span creation.
     */
    OpenCensusTracerWrapper.prototype.startSpan = function (name, options) {
        return new _openCensusSpanWrapper__WEBPACK_IMPORTED_MODULE_0__["OpenCensusSpanWrapper"](this, name, options);
    };
    /**
     * Returns the current Span from the current context, if available.
     */
    OpenCensusTracerWrapper.prototype.getCurrentSpan = function () {
        return undefined;
    };
    /**
     * Executes the given function within the context provided by a Span.
     * @param _span The span that provides the context.
     * @param _fn The function to be executed.
     */
    OpenCensusTracerWrapper.prototype.withSpan = function (_span, _fn) {
        throw new Error("Method not implemented.");
    };
    /**
     * Bind a Span as the target's scope
     * @param target An object to bind the scope.
     * @param _span A specific Span to use. Otherwise, use the current one.
     */
    OpenCensusTracerWrapper.prototype.bind = function (_target, _span) {
        throw new Error("Method not implemented.");
    };
    return OpenCensusTracerWrapper;
}());

//# sourceMappingURL=openCensusTracerWrapper.js.map

/***/ }),
/* 140 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TestTracer", function() { return TestTracer; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _testSpan__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(141);
/* harmony import */ var _noop_noOpTracer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(84);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(86);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_opentelemetry_api__WEBPACK_IMPORTED_MODULE_3__);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.




/**
 * A mock tracer useful for testing
 */
var TestTracer = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(TestTracer, _super);
    function TestTracer() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.traceIdCounter = 0;
        _this.spanIdCounter = 0;
        _this.rootSpans = [];
        _this.knownSpans = [];
        return _this;
    }
    TestTracer.prototype.getNextTraceId = function () {
        this.traceIdCounter++;
        return String(this.traceIdCounter);
    };
    TestTracer.prototype.getNextSpanId = function () {
        this.spanIdCounter++;
        return String(this.spanIdCounter);
    };
    /**
     * Returns all Spans that were created without a parent
     */
    TestTracer.prototype.getRootSpans = function () {
        return this.rootSpans;
    };
    /**
     * Returns all Spans this Tracer knows about
     */
    TestTracer.prototype.getKnownSpans = function () {
        return this.knownSpans;
    };
    /**
     * Returns all Spans where end() has not been called
     */
    TestTracer.prototype.getActiveSpans = function () {
        return this.knownSpans.filter(function (span) {
            return !span.endCalled;
        });
    };
    /**
     * Return all Spans for a particular trace, grouped by their
     * parent Span in a tree-like structure
     * @param traceId The traceId to return the graph for
     */
    TestTracer.prototype.getSpanGraph = function (traceId) {
        var traceSpans = this.knownSpans.filter(function (span) {
            return span.context().traceId === traceId;
        });
        var roots = [];
        var nodeMap = new Map();
        for (var _i = 0, traceSpans_1 = traceSpans; _i < traceSpans_1.length; _i++) {
            var span = traceSpans_1[_i];
            var spanId = span.context().spanId;
            var node = {
                name: span.name,
                children: []
            };
            nodeMap.set(spanId, node);
            if (span.parentSpanId) {
                var parent = nodeMap.get(span.parentSpanId);
                if (!parent) {
                    throw new Error("Span with name " + node.name + " has an unknown parentSpan with id " + span.parentSpanId);
                }
                parent.children.push(node);
            }
            else {
                roots.push(node);
            }
        }
        return {
            roots: roots
        };
    };
    /**
     * Starts a new Span.
     * @param name The name of the span.
     * @param options The SpanOptions used during Span creation.
     */
    TestTracer.prototype.startSpan = function (name, options) {
        if (options === void 0) { options = {}; }
        var parentContext = this._getParentContext(options);
        var traceId;
        var isRootSpan = false;
        if (parentContext && parentContext.traceId) {
            traceId = parentContext.traceId;
        }
        else {
            traceId = this.getNextTraceId();
            isRootSpan = true;
        }
        var context = {
            traceId: traceId,
            spanId: this.getNextSpanId(),
            traceFlags: _opentelemetry_api__WEBPACK_IMPORTED_MODULE_3__["TraceFlags"].NONE
        };
        var span = new _testSpan__WEBPACK_IMPORTED_MODULE_1__["TestSpan"](this, name, context, options.kind || _opentelemetry_api__WEBPACK_IMPORTED_MODULE_3__["SpanKind"].INTERNAL, parentContext ? parentContext.spanId : undefined, options.startTime);
        this.knownSpans.push(span);
        if (isRootSpan) {
            this.rootSpans.push(span);
        }
        return span;
    };
    TestTracer.prototype._getParentContext = function (options) {
        var parent = options.parent;
        var result;
        if (parent) {
            if ("traceId" in parent) {
                result = parent;
            }
            else {
                result = parent.context();
            }
        }
        return result;
    };
    return TestTracer;
}(_noop_noOpTracer__WEBPACK_IMPORTED_MODULE_2__["NoOpTracer"]));

//# sourceMappingURL=testTracer.js.map

/***/ }),
/* 141 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TestSpan", function() { return TestSpan; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(86);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_opentelemetry_api__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _noop_noOpSpan__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(85);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



/**
 * A mock span useful for testing.
 */
var TestSpan = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(TestSpan, _super);
    /**
     * Starts a new Span.
     * @param parentTracer The tracer that created this Span
     * @param name The name of the span.
     * @param context The SpanContext this span belongs to
     * @param kind The SpanKind of this Span
     * @param parentSpanId The identifier of the parent Span
     * @param startTime The startTime of the event (defaults to now)
     */
    function TestSpan(parentTracer, name, context, kind, parentSpanId, startTime) {
        if (startTime === void 0) { startTime = Date.now(); }
        var _this = _super.call(this) || this;
        _this._tracer = parentTracer;
        _this.name = name;
        _this.kind = kind;
        _this.startTime = startTime;
        _this.parentSpanId = parentSpanId;
        _this.status = {
            code: _opentelemetry_api__WEBPACK_IMPORTED_MODULE_1__["CanonicalCode"].OK
        };
        _this.endCalled = false;
        _this._context = context;
        _this.attributes = {};
        return _this;
    }
    /**
     * Returns the Tracer that created this Span
     */
    TestSpan.prototype.tracer = function () {
        return this._tracer;
    };
    /**
     * Returns the SpanContext associated with this Span.
     */
    TestSpan.prototype.context = function () {
        return this._context;
    };
    /**
     * Marks the end of Span execution.
     * @param _endTime The time to use as the Span's end time. Defaults to
     * the current time.
     */
    TestSpan.prototype.end = function (_endTime) {
        this.endCalled = true;
    };
    /**
     * Sets a status on the span. Overrides the default of CanonicalCode.OK.
     * @param status The status to set.
     */
    TestSpan.prototype.setStatus = function (status) {
        this.status = status;
        return this;
    };
    /**
     * Returns whether this span will be recorded
     */
    TestSpan.prototype.isRecording = function () {
        return true;
    };
    /**
     * Sets an attribute on the Span
     * @param key the attribute key
     * @param value the attribute value
     */
    TestSpan.prototype.setAttribute = function (key, value) {
        this.attributes[key] = value;
        return this;
    };
    /**
     * Sets attributes on the Span
     * @param attributes the attributes to add
     */
    TestSpan.prototype.setAttributes = function (attributes) {
        for (var _i = 0, _a = Object.keys(attributes); _i < _a.length; _i++) {
            var key = _a[_i];
            this.attributes[key] = attributes[key];
        }
        return this;
    };
    return TestSpan;
}(_noop_noOpSpan__WEBPACK_IMPORTED_MODULE_2__["NoOpSpan"]));

//# sourceMappingURL=testSpan.js.map

/***/ }),
/* 142 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "extractSpanContextFromTraceParentHeader", function() { return extractSpanContextFromTraceParentHeader; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getTraceParentHeader", function() { return getTraceParentHeader; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
var VERSION = "00";
/**
 * Generates a `SpanContext` given a `traceparent` header value.
 * @param traceParent Serialized span context data as a `traceparent` header value.
 * @returns The `SpanContext` generated from the `traceparent` value.
 */
function extractSpanContextFromTraceParentHeader(traceParentHeader) {
    var parts = traceParentHeader.split("-");
    if (parts.length !== 4) {
        return;
    }
    var version = parts[0], traceId = parts[1], spanId = parts[2], traceOptions = parts[3];
    if (version !== VERSION) {
        return;
    }
    var traceFlags = parseInt(traceOptions, 16);
    var spanContext = {
        spanId: spanId,
        traceId: traceId,
        traceFlags: traceFlags
    };
    return spanContext;
}
/**
 * Generates a `traceparent` value given a span context.
 * @param spanContext Contains context for a specific span.
 * @returns The `spanContext` represented as a `traceparent` value.
 */
function getTraceParentHeader(spanContext) {
    var missingFields = [];
    if (!spanContext.traceId) {
        missingFields.push("traceId");
    }
    if (!spanContext.spanId) {
        missingFields.push("spanId");
    }
    if (missingFields.length) {
        return;
    }
    var flags = spanContext.traceFlags || 0 /* NONE */;
    var hexFlags = flags.toString(16);
    var traceFlags = hexFlags.length === 1 ? "0" + hexFlags : hexFlags;
    // https://www.w3.org/TR/trace-context/#traceparent-header-field-values
    return VERSION + "-" + spanContext.traceId + "-" + spanContext.spanId + "-" + traceFlags;
}
//# sourceMappingURL=traceParentHeader.js.map

/***/ }),
/* 143 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "disableResponseDecompressionPolicy", function() { return disableResponseDecompressionPolicy; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DisableResponseDecompressionPolicy", function() { return DisableResponseDecompressionPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

/*
 * NOTE: When moving this file, please update "browser" section in package.json
 */

var DisbleResponseDecompressionNotSupportedInBrowser = new Error("DisableResponseDecompressionPolicy is not supported in browser environment");
/**
 * {@link DisableResponseDecompressionPolicy} is not supported in browser and attempting
 * to use it will results in error being thrown.
 */
function disableResponseDecompressionPolicy() {
    return {
        create: function (_nextPolicy, _options) {
            throw DisbleResponseDecompressionNotSupportedInBrowser;
        }
    };
}
var DisableResponseDecompressionPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(DisableResponseDecompressionPolicy, _super);
    function DisableResponseDecompressionPolicy(nextPolicy, options) {
        var _this = _super.call(this, nextPolicy, options) || this;
        throw DisbleResponseDecompressionNotSupportedInBrowser;
        return _this;
    }
    DisableResponseDecompressionPolicy.prototype.sendRequest = function (_request) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                throw DisbleResponseDecompressionNotSupportedInBrowser;
            });
        });
    };
    return DisableResponseDecompressionPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));

//# sourceMappingURL=disableResponseDecompressionPolicy.browser.js.map

/***/ }),
/* 144 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ndJsonPolicy", function() { return ndJsonPolicy; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _requestPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(56);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

// BaseRequestPolicy has a protected constructor.
/* eslint-disable @typescript-eslint/no-useless-constructor */

function ndJsonPolicy() {
    return {
        create: function (nextPolicy, options) {
            return new NdJsonPolicy(nextPolicy, options);
        }
    };
}
/**
 * NdJsonPolicy that formats a JSON array as newline-delimited JSON
 */
var NdJsonPolicy = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(NdJsonPolicy, _super);
    /**
     * Creates an instance of KeepAlivePolicy.
     *
     * @param nextPolicy
     * @param options
     */
    function NdJsonPolicy(nextPolicy, options) {
        return _super.call(this, nextPolicy, options) || this;
    }
    /**
     * Sends a request.
     *
     * @param request
     */
    NdJsonPolicy.prototype.sendRequest = function (request) {
        return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(this, void 0, void 0, function () {
            var body;
            return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__generator"])(this, function (_a) {
                // There currently isn't a good way to bypass the serializer
                if (typeof request.body === "string" && request.body.startsWith("[")) {
                    body = JSON.parse(request.body);
                    if (Array.isArray(body)) {
                        request.body = body.map(function (item) { return JSON.stringify(item) + "\n"; }).join("");
                    }
                }
                return [2 /*return*/, this._nextPolicy.sendRequest(request)];
            });
        });
    };
    return NdJsonPolicy;
}(_requestPolicy__WEBPACK_IMPORTED_MODULE_1__["BaseRequestPolicy"]));
//# sourceMappingURL=ndJsonPolicy.js.map

/***/ }),
/* 145 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createSpanFunction", function() { return createSpanFunction; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(86);
/* harmony import */ var _opentelemetry_api__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_opentelemetry_api__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _azure_core_tracing__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(82);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



/**
 * Creates a function called createSpan to create spans using the global tracer.
 * @ignore
 * @param spanConfig The name of the operation being performed.
 * @param tracingOptions The options for the underlying http request.
 */
function createSpanFunction(_a) {
    var packagePrefix = _a.packagePrefix, namespace = _a.namespace;
    return function (operationName, operationOptions) {
        var tracer = Object(_azure_core_tracing__WEBPACK_IMPORTED_MODULE_2__["getTracer"])();
        var tracingOptions = operationOptions.tracingOptions || {};
        var spanOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, tracingOptions.spanOptions), { kind: _opentelemetry_api__WEBPACK_IMPORTED_MODULE_1__["SpanKind"].INTERNAL });
        var span = tracer.startSpan(packagePrefix + "." + operationName, spanOptions);
        span.setAttribute("az.namespace", namespace);
        var newSpanOptions = tracingOptions.spanOptions || {};
        if (span.isRecording()) {
            newSpanOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, tracingOptions.spanOptions), { parent: span.context(), attributes: Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, spanOptions.attributes), { "az.namespace": namespace }) });
        }
        var newTracingOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, tracingOptions), { spanOptions: newSpanOptions });
        var newOperationOptions = Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])(Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__assign"])({}, operationOptions), { tracingOptions: newTracingOptions });
        return {
            span: span,
            updatedOptions: newOperationOptions
        };
    };
}
//# sourceMappingURL=createSpan.js.map

/***/ }),
/* 146 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BasicAuthenticationCredentials", function() { return BasicAuthenticationCredentials; });
/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(15);
/* harmony import */ var _util_base64__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(18);
/* harmony import */ var _util_constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(36);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.



var HeaderConstants = _util_constants__WEBPACK_IMPORTED_MODULE_2__["Constants"].HeaderConstants;
var DEFAULT_AUTHORIZATION_SCHEME = "Basic";
var BasicAuthenticationCredentials = /** @class */ (function () {
    /**
     * Creates a new BasicAuthenticationCredentials object.
     *
     * @constructor
     * @param {string} userName User name.
     * @param {string} password Password.
     * @param {string} [authorizationScheme] The authorization scheme.
     */
    function BasicAuthenticationCredentials(userName, password, authorizationScheme) {
        if (authorizationScheme === void 0) { authorizationScheme = DEFAULT_AUTHORIZATION_SCHEME; }
        this.authorizationScheme = DEFAULT_AUTHORIZATION_SCHEME;
        if (userName === null || userName === undefined || typeof userName.valueOf() !== "string") {
            throw new Error("userName cannot be null or undefined and must be of type string.");
        }
        if (password === null || password === undefined || typeof password.valueOf() !== "string") {
            throw new Error("password cannot be null or undefined and must be of type string.");
        }
        this.userName = userName;
        this.password = password;
        this.authorizationScheme = authorizationScheme;
    }
    /**
     * Signs a request with the Authentication header.
     *
     * @param {WebResourceLike} webResource The WebResourceLike to be signed.
     * @returns {Promise<WebResourceLike>} The signed request object.
     */
    BasicAuthenticationCredentials.prototype.signRequest = function (webResource) {
        var credentials = this.userName + ":" + this.password;
        var encodedCredentials = this.authorizationScheme + " " + _util_base64__WEBPACK_IMPORTED_MODULE_1__["encodeString"](credentials);
        if (!webResource.headers)
            webResource.headers = new _httpHeaders__WEBPACK_IMPORTED_MODULE_0__["HttpHeaders"]();
        webResource.headers.set(HeaderConstants.AUTHORIZATION, encodedCredentials);
        return Promise.resolve(webResource);
    };
    return BasicAuthenticationCredentials;
}());

//# sourceMappingURL=basicAuthenticationCredentials.js.map

/***/ }),
/* 147 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ApiKeyCredentials", function() { return ApiKeyCredentials; });
/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(15);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

/**
 * Authenticates to a service using an API key.
 */
var ApiKeyCredentials = /** @class */ (function () {
    /**
     * @constructor
     * @param {object} options   Specifies the options to be provided for auth. Either header or query needs to be provided.
     */
    function ApiKeyCredentials(options) {
        if (!options || (options && !options.inHeader && !options.inQuery)) {
            throw new Error("options cannot be null or undefined. Either \"inHeader\" or \"inQuery\" property of the options object needs to be provided.");
        }
        this.inHeader = options.inHeader;
        this.inQuery = options.inQuery;
    }
    /**
     * Signs a request with the values provided in the inHeader and inQuery parameter.
     *
     * @param {WebResourceLike} webResource The WebResourceLike to be signed.
     * @returns {Promise<WebResourceLike>} The signed request object.
     */
    ApiKeyCredentials.prototype.signRequest = function (webResource) {
        if (!webResource) {
            return Promise.reject(new Error("webResource cannot be null or undefined and must be of type \"object\"."));
        }
        if (this.inHeader) {
            if (!webResource.headers) {
                webResource.headers = new _httpHeaders__WEBPACK_IMPORTED_MODULE_0__["HttpHeaders"]();
            }
            for (var headerName in this.inHeader) {
                webResource.headers.set(headerName, this.inHeader[headerName]);
            }
        }
        if (this.inQuery) {
            if (!webResource.url) {
                return Promise.reject(new Error("url cannot be null in the request object."));
            }
            if (webResource.url.indexOf("?") < 0) {
                webResource.url += "?";
            }
            for (var key in this.inQuery) {
                if (!webResource.url.endsWith("?")) {
                    webResource.url += "&";
                }
                webResource.url += key + "=" + this.inQuery[key];
            }
        }
        return Promise.resolve(webResource);
    };
    return ApiKeyCredentials;
}());

//# sourceMappingURL=apiKeyCredentials.js.map

/***/ }),
/* 148 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TopicCredentials", function() { return TopicCredentials; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(17);
/* harmony import */ var _apiKeyCredentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(147);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


var TopicCredentials = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(TopicCredentials, _super);
    /**
     * Creates a new EventGrid TopicCredentials object.
     *
     * @constructor
     * @param {string} topicKey   The EventGrid topic key
     */
    function TopicCredentials(topicKey) {
        var _this = this;
        if (!topicKey || (topicKey && typeof topicKey !== "string")) {
            throw new Error("topicKey cannot be null or undefined and must be of type string.");
        }
        var options = {
            inHeader: {
                "aeg-sas-key": topicKey
            }
        };
        _this = _super.call(this, options) || this;
        return _this;
    }
    return TopicCredentials;
}(_apiKeyCredentials__WEBPACK_IMPORTED_MODULE_1__["ApiKeyCredentials"]));

//# sourceMappingURL=topicCredentials.js.map

/***/ }),
/* 149 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "shaHash", function() { return shaHash; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "shaHMAC", function() { return shaHMAC; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4);
/* harmony import */ var _encodeUtils_browser__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(150);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


const globalRef = globalThis;
const getCrypto = () => {
    if (!globalRef) {
        throw new Error("Could not find global");
    }
    if (!globalRef.crypto || !globalRef.crypto.subtle) {
        throw new Error("Browser does not support cryptography functions");
    }
    return globalRef.crypto.subtle;
};
const shaHash = (content) => Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(void 0, void 0, void 0, function* () {
    const data = Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_1__["encodeUTF8"])(content);
    const hash = yield getCrypto().digest("SHA-256", data);
    return Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_1__["encodeBase64"])(hash);
});
const shaHMAC = (secret, content) => Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__awaiter"])(void 0, void 0, void 0, function* () {
    const importParams = { name: "HMAC", hash: { name: "SHA-256" } };
    const encodedMessage = Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_1__["encodeUTF8"])(content);
    const encodedKey = Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_1__["encodeUTF8fromBase64"])(secret);
    const crypto = getCrypto();
    const cryptoKey = yield crypto.importKey("raw", encodedKey, importParams, false, ["sign"]);
    const signature = yield crypto.sign(importParams, cryptoKey, encodedMessage);
    return Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_1__["encodeBase64"])(signature);
});
//# sourceMappingURL=cryptoUtils.browser.js.map

/***/ }),
/* 150 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "encodeUTF8", function() { return encodeUTF8; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "encodeUTF8fromBase64", function() { return encodeUTF8fromBase64; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "encodeBase64", function() { return encodeBase64; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
const encodeUTF8 = (str) => new TextEncoder().encode(str);
function encodeUTF8fromBase64(str) {
    if (typeof atob !== "function") {
        throw new Error("Your browser environment is missing the global `atob` function");
    }
    const binary = atob(str);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
    }
    return bytes;
}
function encodeBase64(value) {
    if (typeof btoa !== "function") {
        throw new Error("Your browser environment is missing the global `btoa` function");
    }
    const bytes = new Uint8Array(value);
    let binary = "";
    for (const byte of bytes) {
        binary += String.fromCharCode(byte);
    }
    return btoa(binary);
}
//# sourceMappingURL=encodeUtils.browser.js.map

/***/ }),
/* 151 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isKeyCredential", function() { return isKeyCredential; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "parseClientArguments", function() { return parseClientArguments; });
/* harmony import */ var _azure_core_http__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(13);
/* harmony import */ var _connectionString__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(152);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.


const isValidEndpoint = (host) => {
    var _a;
    const url = _azure_core_http__WEBPACK_IMPORTED_MODULE_0__["URLBuilder"].parse(host);
    return (!!((_a = url.getScheme()) === null || _a === void 0 ? void 0 : _a.match(/^http[s]?/)) &&
        url.getHost() !== undefined &&
        url.getHost() !== "" &&
        (url.getPath() === undefined || url.getPath() === "" || url.getPath() === "/"));
};
const assertValidEndpoint = (host) => {
    if (!isValidEndpoint(host)) {
        throw new Error(`Invalid endpoint url ${host}`);
    }
};
/**
 * Checks whether a value is a KeyCredential.
 *
 * @param {*} credential The credential being checked.
 */
const isKeyCredential = (credential) => {
    return credential && typeof credential.key === "string" && credential.getToken === undefined;
};
/**
 * Parses arguments passed to a communication client.
 *
 * @param {string} connectionStringOrUrl
 * @param {*} [credentialOrOptions]
 */
const parseClientArguments = (connectionStringOrUrl, credentialOrOptions) => {
    if (isKeyCredential(credentialOrOptions)) {
        assertValidEndpoint(connectionStringOrUrl);
        return { url: connectionStringOrUrl, credential: credentialOrOptions };
    }
    else {
        const { endpoint: host, credential } = Object(_connectionString__WEBPACK_IMPORTED_MODULE_1__["parseConnectionString"])(connectionStringOrUrl);
        assertValidEndpoint(host);
        return { url: host, credential };
    }
};
//# sourceMappingURL=clientArguments.js.map

/***/ }),
/* 152 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "parseConnectionString", function() { return parseConnectionString; });
/* harmony import */ var _azure_core_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(52);
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.

// TODO: update when connection string format is finalized
const CONNECTION_STRING_REGEX = /endpoint=(.*);accesskey=(.*)/i;
const tryParseConnectionString = (s) => {
    const match = s.match(CONNECTION_STRING_REGEX);
    if ((match === null || match === void 0 ? void 0 : match[1]) && match[2]) {
        return { endpoint: match[1], credential: new _azure_core_auth__WEBPACK_IMPORTED_MODULE_0__["AzureKeyCredential"](match[2]) };
    }
    return undefined;
};
const parseConnectionString = (connectionString) => {
    const parsedConnectionString = tryParseConnectionString(connectionString);
    if (parsedConnectionString) {
        return parsedConnectionString;
    }
    else {
        throw new Error(`Invalid connection string ${connectionString}`);
    }
};
//# sourceMappingURL=connectionString.js.map

/***/ }),
/* 153 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isCommunicationUser", function() { return isCommunicationUser; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isPhoneNumber", function() { return isPhoneNumber; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isCallingApplication", function() { return isCallingApplication; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isUnknownIdentifier", function() { return isUnknownIdentifier; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getIdentifierKind", function() { return getIdentifierKind; });
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
/**
 * Tests an Identifier to determine whether it implements CommunicationUser.
 *
 * @param identifier The assumed CommunicationUser to be tested.
 */
const isCommunicationUser = (identifier) => {
    return typeof identifier.communicationUserId === "string";
};
/**
 * Tests an Identifier to determine whether it implements PhoneNumber.
 *
 * @param identifier The assumed PhoneNumber to be tested.
 */
const isPhoneNumber = (identifier) => {
    return typeof identifier.phoneNumber === "string";
};
/**
 * Tests an Identifier to determine whether it implements CallingApplication.
 *
 * @param identifier The assumed CallingApplication to be tested.
 */
const isCallingApplication = (identifier) => {
    return typeof identifier.callingApplicationId === "string";
};
/**
 * Tests an Identifier to determine whether it implements UnknownIdentifier.
 *
 * @param identifier The assumed UnknownIdentifier to be tested.
 */
const isUnknownIdentifier = (identifier) => {
    return typeof identifier.id === "string";
};
/**
 * Returns the IdentifierKind for a given Identifier. Returns undefined if the kind couldn't be inferred.
 *
 * @param identifier The identifier whose kind is to be inferred.
 */
const getIdentifierKind = (identifier) => {
    if (isCommunicationUser(identifier)) {
        return Object.assign(Object.assign({}, identifier), { kind: "CommunicationUser" });
    }
    if (isPhoneNumber(identifier)) {
        return Object.assign(Object.assign({}, identifier), { kind: "PhoneNumber" });
    }
    if (isCallingApplication(identifier)) {
        return Object.assign(Object.assign({}, identifier), { kind: "CallingApplication" });
    }
    return Object.assign(Object.assign({}, identifier), { kind: "Unknown" });
};
//# sourceMappingURL=identifierModels.js.map

/***/ }),
/* 154 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setCookie", function() { return setCookie; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getCookie", function() { return getCookie; });
ï»¿
function setCookie(name, value) {
    let date = new Date();
    date.setTime(date.getTime() + (30 * 24 * 60 * 60 * 1000));
    let expires = "; expires=" + date.toGMTString();
    document.cookie = name + "=" + value + expires + "; path=/";
}

function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}



/***/ })
/******/ ]);